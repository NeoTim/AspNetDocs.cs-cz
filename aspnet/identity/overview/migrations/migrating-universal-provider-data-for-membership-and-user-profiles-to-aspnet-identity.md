---
uid: identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
title: Migrace dat Universal Provider pro členství a profily uživatelů do ASP.NET Identity (C#)-ASP.NET 4. x
author: rustd
description: Tento kurz popisuje kroky, které je potřeba k migraci dat uživatelů a rolí a dat profilů uživatelů vytvořených pomocí univerzálních zprostředkovatelů existující aplikace...
ms.author: riande
ms.date: 12/13/2013
ms.custom: seoapril2019
ms.assetid: 2e260430-d13c-4658-bd05-e256fc0d63b8
msc.legacyurl: /identity/overview/migrations/migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity
msc.type: authoredcontent
ms.openlocfilehash: 31f02a0cec3c531c45c37b7aad8456e01e80b5ea
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 02/19/2020
ms.locfileid: "77456111"
---
# <a name="migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity-c"></a><span data-ttu-id="44304-103">Migrace členských dat od univerzálního zprostředkovatele a uživatelských profilů na ASP.NET Identity (C#)</span><span class="sxs-lookup"><span data-stu-id="44304-103">Migrating Universal Provider Data for Membership and User Profiles to ASP.NET Identity (C#)</span></span>

<span data-ttu-id="44304-104">od [Pranav Rastogi předvádí](https://github.com/rustd), [Rick Anderson](https://twitter.com/RickAndMSFT), [Robert blog](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span><span class="sxs-lookup"><span data-stu-id="44304-104">by [Pranav Rastogi](https://github.com/rustd), [Rick Anderson](https://twitter.com/RickAndMSFT), [Robert McMurray](https://github.com/rmcmurray), [Suhas Joshi](https://github.com/suhasj)</span></span>

> <span data-ttu-id="44304-105">Tento kurz popisuje kroky, které jsou nezbytné k migraci dat uživatelů a rolí a dat profilů uživatelů vytvořených pomocí univerzálních zprostředkovatelů existující aplikace do modelu ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="44304-105">This tutorial describes the steps that are necessary to migrate user and role data and user profile data created using Universal Providers of an existing application to the ASP.NET Identity model.</span></span> <span data-ttu-id="44304-106">Výše zmíněný postup pro migraci dat profilu uživatele lze použít také v aplikaci s členstvím v SQL.</span><span class="sxs-lookup"><span data-stu-id="44304-106">The approach mentioned here to migrate user profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="44304-107">V rámci vydání Visual Studio 2013 představil tým ASP.NET nový ASP.NET Identity systém a další informace o tomto vydání si můžete přečíst [zde](../../index.md).</span><span class="sxs-lookup"><span data-stu-id="44304-107">With the release of Visual Studio 2013, the ASP.NET team introduced a new ASP.NET Identity system, and you can read more about that release [here](../../index.md).</span></span> <span data-ttu-id="44304-108">V tomto článku najdete postup, jak migrovat webové aplikace z [členství SQL do nového systému identit](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md). Tento článek popisuje kroky pro migraci stávajících aplikací, které následují po modelu zprostředkovatelů pro správu uživatelů a rolí na nový model identity.</span><span class="sxs-lookup"><span data-stu-id="44304-108">Following up on the article to migrate web applications from [SQL Membership to the new Identity system](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md), this article illustrates the steps to migrate existing applications that follow the Providers model for user and role management to the new Identity model.</span></span> <span data-ttu-id="44304-109">Zaměření tohoto kurzu bude primárně zaměřeno na migraci dat profilu uživatele, aby se plynule připojila k novému systému.</span><span class="sxs-lookup"><span data-stu-id="44304-109">The focus of this tutorial will be primarily on migrating the user profile data to seamlessly hook it into the new system.</span></span> <span data-ttu-id="44304-110">Migrace informací o uživatelích a rolích je podobná členství SQL.</span><span class="sxs-lookup"><span data-stu-id="44304-110">Migrating user and role information is similar for SQL membership.</span></span> <span data-ttu-id="44304-111">Přístup následovaný k migraci dat profilu lze použít také v aplikaci s členstvím v SQL.</span><span class="sxs-lookup"><span data-stu-id="44304-111">The approach followed to migrate profile data can be used in an application with SQL membership as well.</span></span>

<span data-ttu-id="44304-112">Jako příklad se spustí webová aplikace vytvořená pomocí sady Visual Studio 2012, která používá model poskytovatelů.</span><span class="sxs-lookup"><span data-stu-id="44304-112">As an example, we will start with a web app created using Visual Studio 2012 which uses the Providers model.</span></span> <span data-ttu-id="44304-113">Pak přidáme kód pro správu profilů, zaregistrujete uživatele, přidáte profil pro uživatele, migrujete schéma databáze a pak změníte aplikaci tak, aby používala systém identit pro správu uživatelů a rolí.</span><span class="sxs-lookup"><span data-stu-id="44304-113">We'll then add code for profile management, register a user, add profile data for the users, migrate the database schema, and then change the application to use the Identity system for user and role management.</span></span> <span data-ttu-id="44304-114">Jako test migrace by se uživatelé, kteří vytvořili pomocí univerzálních zprostředkovatelů, mohli přihlásit a noví uživatelé by měli být schopni se zaregistrovat.</span><span class="sxs-lookup"><span data-stu-id="44304-114">As a test of migration, users created using Universal Providers should be able to log in and new users should be able to register.</span></span>

> [!NOTE]
> <span data-ttu-id="44304-115">Úplnou ukázku najdete na [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span><span class="sxs-lookup"><span data-stu-id="44304-115">You can find the complete sample at [https://github.com/suhasj/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations).</span></span>

## <a name="profile-data-migration-summary"></a><span data-ttu-id="44304-116">Souhrn migrace dat profilu</span><span class="sxs-lookup"><span data-stu-id="44304-116">Profile data migration summary</span></span>

<span data-ttu-id="44304-117">Než začnete s migracemi, můžeme se podívat na možnosti ukládání dat profilu do modelu poskytovatelů.</span><span class="sxs-lookup"><span data-stu-id="44304-117">Before starting with the migrations, let us look at the experience of storing profile data in the Providers model.</span></span> <span data-ttu-id="44304-118">Data profilu pro uživatele aplikace je možné ukládat různými způsoby. mezi nimi nejčastěji využívají poskytovatelé předdefinovaných profilů dodávané společně s univerzálními poskytovateli.</span><span class="sxs-lookup"><span data-stu-id="44304-118">Profile data for application users can be stored in multiple ways, the most common among them being using the inbuilt profile providers shipped along with the Universal Providers.</span></span> <span data-ttu-id="44304-119">Tyto kroky by zahrnovaly</span><span class="sxs-lookup"><span data-stu-id="44304-119">The steps would include</span></span>

1. <span data-ttu-id="44304-120">Přidejte třídu, která má vlastnosti používané k ukládání dat profilu.</span><span class="sxs-lookup"><span data-stu-id="44304-120">Add a class that has properties used to store Profile data.</span></span>
2. <span data-ttu-id="44304-121">Přidejte třídu, která rozšiřuje ' ProfileBase ' a implementuje metody pro získání výše uvedených dat profilu pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="44304-121">Add a class that extends 'ProfileBase' and implements methods to get the above profile data for the user.</span></span>
3. <span data-ttu-id="44304-122">Povolte použití výchozích zprostředkovatelů profilů v souboru *Web. config* a Definujte třídu deklarovanou v kroku #2, která se má použít při přístupu k informacím profilu.</span><span class="sxs-lookup"><span data-stu-id="44304-122">Enable using default profile providers in the *web.config* file and define the class declared in step #2 to be used in accessing profile information.</span></span>

<span data-ttu-id="44304-123">Informace o profilu jsou uloženy jako Serializovaná data XML a binární data v tabulce Profiles v databázi.</span><span class="sxs-lookup"><span data-stu-id="44304-123">The profile information is stored as serialized xml and binary data in the 'Profiles' table in the database.</span></span>

<span data-ttu-id="44304-124">Po migraci aplikace, aby používala nový ASP.NET Identity systém, jsou informace o profilu deserializovány a uloženy jako vlastnosti třídy uživatel.</span><span class="sxs-lookup"><span data-stu-id="44304-124">After migrating the application to use the new ASP.NET Identity system, the profile information is deserialized and stored as properties on the user class.</span></span> <span data-ttu-id="44304-125">Každá vlastnost se pak dá namapovat na sloupce v uživatelské tabulce.</span><span class="sxs-lookup"><span data-stu-id="44304-125">Each property can then be mapped onto columns in the user table.</span></span> <span data-ttu-id="44304-126">Výhodou je, že vlastnosti lze pracovat přímo pomocí třídy uživatele kromě toho, že při přístupu k nim nemusíte serializovat nebo deserializovat informace o datech.</span><span class="sxs-lookup"><span data-stu-id="44304-126">The advantage here is that the properties can be worked on directly using the user class in addition to not having to serialize/deserialize data information each time when accessing it.</span></span>

## <a name="getting-started"></a><span data-ttu-id="44304-127">Začínáme</span><span class="sxs-lookup"><span data-stu-id="44304-127">Getting Started</span></span>

1. <span data-ttu-id="44304-128">Vytvořte novou aplikaci webových formulářů ASP.NET 4,5 v aplikaci Visual Studio 2012.</span><span class="sxs-lookup"><span data-stu-id="44304-128">Create a new ASP.NET 4.5 Web Forms application in Visual Studio 2012.</span></span> <span data-ttu-id="44304-129">Aktuální ukázka používá šablonu webových formulářů, ale můžete použít také aplikaci MVC.</span><span class="sxs-lookup"><span data-stu-id="44304-129">The current sample uses the Web Forms template, but you could use MVC Application as well.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.jpg)
2. <span data-ttu-id="44304-130">Vytvořte novou složku ' modely ' pro uložení informací o profilu</span><span class="sxs-lookup"><span data-stu-id="44304-130">Create a new folder 'Models' to store profile information</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image1.png)
3. <span data-ttu-id="44304-131">Jako příklad si můžeme uložit datum narození, město, výšku a váhu uživatele v profilu.</span><span class="sxs-lookup"><span data-stu-id="44304-131">As an example, let us store the date of birth, city, height and weight of the user in profile.</span></span> <span data-ttu-id="44304-132">Výška a váha jsou uloženy jako vlastní třída s názvem ' PersonalStats '.</span><span class="sxs-lookup"><span data-stu-id="44304-132">The height and weight are stored as a custom class called 'PersonalStats'.</span></span> <span data-ttu-id="44304-133">Abychom mohli profil uložit a načíst, potřebujeme třídu, která rozšiřuje ' ProfileBase '.</span><span class="sxs-lookup"><span data-stu-id="44304-133">To store and retrieve the profile, we need a class that extends 'ProfileBase'.</span></span> <span data-ttu-id="44304-134">Pojďme vytvořit novou třídu ' AppProfile ' k získání a uložení informací o profilu.</span><span class="sxs-lookup"><span data-stu-id="44304-134">Let's create a new class 'AppProfile' to get and store profile information.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample1.cs)]
4. <span data-ttu-id="44304-135">Povolte profil v souboru *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="44304-135">Enable profile in the *web.config* file.</span></span> <span data-ttu-id="44304-136">Zadejte název třídy, který se použije k uložení nebo načtení informací o uživateli vytvořených v kroku #3.</span><span class="sxs-lookup"><span data-stu-id="44304-136">Enter the class name to be used to store/retrieve user information created in step #3.</span></span>

    [!code-xml[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample2.xml)]
5. <span data-ttu-id="44304-137">Přidejte stránku webových formulářů do složky Account (účet), abyste získali data profilu od uživatele a ukládali je.</span><span class="sxs-lookup"><span data-stu-id="44304-137">Add a web forms page in 'Account' folder to get the profile data from the user and store it.</span></span> <span data-ttu-id="44304-138">Klikněte pravým tlačítkem na projekt a vyberte Přidat novou položku.</span><span class="sxs-lookup"><span data-stu-id="44304-138">Right click on project and select 'Add new Item'.</span></span> <span data-ttu-id="44304-139">Přidejte novou stránku webových formulářů se stránkou předlohy ' AddProfileData. aspx '.</span><span class="sxs-lookup"><span data-stu-id="44304-139">Add a new webforms page with master page 'AddProfileData.aspx'.</span></span> <span data-ttu-id="44304-140">V části "MainContent" zkopírujte následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="44304-140">Copy the following in the 'MainContent' section:</span></span>

    [!code-html[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample3.html)]

   <span data-ttu-id="44304-141">Do kódu na pozadí přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="44304-141">Add the following code in the code behind:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample4.cs)]

   <span data-ttu-id="44304-142">Přidejte obor názvů, pod kterým je definována třída AppProfile pro odebrání chyb kompilace.</span><span class="sxs-lookup"><span data-stu-id="44304-142">Add the namespace under which AppProfile class is defined to remove the compilation errors.</span></span>
6. <span data-ttu-id="44304-143">Spusťte aplikaci a vytvořte nového uživatele s uživatelským jménem '**olduser '.**</span><span class="sxs-lookup"><span data-stu-id="44304-143">Run the app and create a new user with username '**olduser'.**</span></span> <span data-ttu-id="44304-144">Přejděte na stránku ' AddProfileData ' a přidejte informace o profilu pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="44304-144">Navigate to the 'AddProfileData' page and add profile information for the user.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.png)

<span data-ttu-id="44304-145">V tabulce Profiles můžete ověřit, že jsou data uložena jako serializovaná XML, a to pomocí okna Průzkumník serveru.</span><span class="sxs-lookup"><span data-stu-id="44304-145">You can verify that the data is stored as serialized xml in the 'Profiles' table using the Server Explorer window.</span></span> <span data-ttu-id="44304-146">V aplikaci Visual Studio v nabídce zobrazení vyberte možnost ' Průzkumník serveru '.</span><span class="sxs-lookup"><span data-stu-id="44304-146">In Visual Studio, from 'View' menu, choose 'Server Explorer'.</span></span> <span data-ttu-id="44304-147">Pro databázi, která je definována v souboru *Web. config* , by mělo být datové připojení.</span><span class="sxs-lookup"><span data-stu-id="44304-147">There should be a data connection for the database defined in the *web.config* file.</span></span> <span data-ttu-id="44304-148">Kliknutím na datové připojení se zobrazí různé podkategorie.</span><span class="sxs-lookup"><span data-stu-id="44304-148">Clicking on the data connection shows different sub categories.</span></span> <span data-ttu-id="44304-149">Rozbalte ' Tables ' pro zobrazení různých tabulek v databázi, klikněte pravým tlačítkem na ' profily ' a zvolte možnost ' Zobrazit data tabulky ' pro zobrazení dat profilu uložených v tabulce profily.</span><span class="sxs-lookup"><span data-stu-id="44304-149">Expand 'Tables' to show the different tables in your database, then right click on 'Profiles' and choose 'Show Table Data' to view the profile data stored in the Profiles table.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.png)

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image4.png)

## <a name="migrating-database-schema"></a><span data-ttu-id="44304-150">Migruje se schéma databáze.</span><span class="sxs-lookup"><span data-stu-id="44304-150">Migrating database schema</span></span>

<span data-ttu-id="44304-151">Aby mohla stávající databáze fungovat se systémem identity, musíme aktualizovat schéma v databázi identit tak, aby podporovalo pole, která jsme přidali do původní databáze.</span><span class="sxs-lookup"><span data-stu-id="44304-151">To make the existing database work with the Identity system, we need to update the schema in the Identity database to support the fields we added to the original database.</span></span> <span data-ttu-id="44304-152">To lze provést pomocí skriptů SQL pro vytvoření nových tabulek a zkopírování stávajících informací.</span><span class="sxs-lookup"><span data-stu-id="44304-152">This can be done using SQL scripts to create new tables and copy the existing information.</span></span> <span data-ttu-id="44304-153">V okně ' Průzkumník serveru ' rozbalte ' DefaultConnection ' pro zobrazení tabulek.</span><span class="sxs-lookup"><span data-stu-id="44304-153">In the 'Server Explorer' window, expand the 'DefaultConnection' to display the tables.</span></span> <span data-ttu-id="44304-154">Klikněte pravým tlačítkem na tabulky a vyberte nový dotaz.</span><span class="sxs-lookup"><span data-stu-id="44304-154">Right click Tables and select 'New Query'</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image5.png)

<span data-ttu-id="44304-155">Vložte skript SQL z [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) a spusťte ho.</span><span class="sxs-lookup"><span data-stu-id="44304-155">Paste the SQL script from [https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt](https://raw.github.com/suhasj/UniversalProviders-Identity-Migrations/master/Migration.txt) and run it.</span></span> <span data-ttu-id="44304-156">Pokud se aktualizuje ' DefaultConnection ', uvidíme, že se přidaly nové tabulky.</span><span class="sxs-lookup"><span data-stu-id="44304-156">If the 'DefaultConnection' is refreshed, we can see that the new tables are added.</span></span> <span data-ttu-id="44304-157">Můžete kontrolovat data v tabulkách, abyste viděli, že se informace migrovali.</span><span class="sxs-lookup"><span data-stu-id="44304-157">You can check the data inside the tables to see that the information has been migrated.</span></span>

![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image6.png)

## <a name="migrating-the-application-to-use-aspnet-identity"></a><span data-ttu-id="44304-158">Migrace aplikace pro použití ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="44304-158">Migrating the application to use ASP.NET Identity</span></span>

1. <span data-ttu-id="44304-159">Nainstalujte balíčky NuGet potřebné pro ASP.NET Identity:</span><span class="sxs-lookup"><span data-stu-id="44304-159">Install the Nuget packages needed for ASP.NET Identity:</span></span>

    - <span data-ttu-id="44304-160">Microsoft.AspNet.Identity.EntityFramework</span><span class="sxs-lookup"><span data-stu-id="44304-160">Microsoft.AspNet.Identity.EntityFramework</span></span>
    - <span data-ttu-id="44304-161">Microsoft.AspNet.Identity.Owin</span><span class="sxs-lookup"><span data-stu-id="44304-161">Microsoft.AspNet.Identity.Owin</span></span>
    - <span data-ttu-id="44304-162">Microsoft.Owin.Host.SystemWeb</span><span class="sxs-lookup"><span data-stu-id="44304-162">Microsoft.Owin.Host.SystemWeb</span></span>
    - <span data-ttu-id="44304-163">Microsoft.Owin.Security.Facebook</span><span class="sxs-lookup"><span data-stu-id="44304-163">Microsoft.Owin.Security.Facebook</span></span>
    - <span data-ttu-id="44304-164">Microsoft.Owin.Security.Google</span><span class="sxs-lookup"><span data-stu-id="44304-164">Microsoft.Owin.Security.Google</span></span>
    - <span data-ttu-id="44304-165">Microsoft.Owin.Security.MicrosoftAccount</span><span class="sxs-lookup"><span data-stu-id="44304-165">Microsoft.Owin.Security.MicrosoftAccount</span></span>
    - <span data-ttu-id="44304-166">Microsoft.Owin.Security.Twitter</span><span class="sxs-lookup"><span data-stu-id="44304-166">Microsoft.Owin.Security.Twitter</span></span>

   <span data-ttu-id="44304-167">Další informace o správě balíčků NuGet najdete [tady](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog) .</span><span class="sxs-lookup"><span data-stu-id="44304-167">More information on managing Nuget packages can be found [here](http://docs.nuget.org/docs/start-here/Managing-NuGet-Packages-Using-The-Dialog)</span></span>
2. <span data-ttu-id="44304-168">Abychom mohli pracovat se stávajícími daty v tabulce, musíme vytvořit třídy modelů, které se mapují zpátky na tabulky a zapojte je do systému identit.</span><span class="sxs-lookup"><span data-stu-id="44304-168">To work with existing data in the table, we need to create model classes which map back to the tables and hook them up in the Identity system.</span></span> <span data-ttu-id="44304-169">V rámci kontraktu identity by třídy modelu měly buď implementovat rozhraní definovaná v knihovně DLL identity. Core, nebo mohou roztáhnout stávající implementaci těchto rozhraní, která jsou k dispozici v souboru Microsoft. AspNet. identity. EntityFramework.</span><span class="sxs-lookup"><span data-stu-id="44304-169">As part of the Identity contract, the model classes should either implement the interfaces defined in the Identity.Core dll or can extend the existing implementation of these interfaces available in Microsoft.AspNet.Identity.EntityFramework.</span></span> <span data-ttu-id="44304-170">Pro role, přihlášení uživatelů a deklarace identity uživatelů budeme používat existující třídy.</span><span class="sxs-lookup"><span data-stu-id="44304-170">We will be using the existing classes for role, user logins and user claims.</span></span> <span data-ttu-id="44304-171">Pro naši ukázku musíme použít vlastního uživatele.</span><span class="sxs-lookup"><span data-stu-id="44304-171">We need to use a custom user for our sample.</span></span> <span data-ttu-id="44304-172">Klikněte pravým tlačítkem na projekt a vytvořte novou složku ' IdentityModels '.</span><span class="sxs-lookup"><span data-stu-id="44304-172">Right click on the project and create new folder 'IdentityModels'.</span></span> <span data-ttu-id="44304-173">Přidejte novou třídu User, jak je znázorněno níže:</span><span class="sxs-lookup"><span data-stu-id="44304-173">Add a new 'User' class as shown below:</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample5.cs)]

   <span data-ttu-id="44304-174">Všimněte si, že ' ProfileInfo ' je nyní vlastnost třídy User.</span><span class="sxs-lookup"><span data-stu-id="44304-174">Notice that the 'ProfileInfo' is now a property on the user class.</span></span> <span data-ttu-id="44304-175">Proto můžeme použít třídu User k přímé práci s daty profilu.</span><span class="sxs-lookup"><span data-stu-id="44304-175">Hence we can use the user class to directly work with profile data.</span></span>

<span data-ttu-id="44304-176">Zkopírujte soubory ve složkách **IdentityModels** a **IdentityAccount** ze zdroje stahování ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span><span class="sxs-lookup"><span data-stu-id="44304-176">Copy the files in the **IdentityModels** and **IdentityAccount** folders from the download source ( [https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations](https://github.com/suhasj/UniversalProviders-Identity-Migrations/tree/master/UniversalProviders-Identity-Migrations) ).</span></span> <span data-ttu-id="44304-177">Mají zbývající třídy modelu a nové stránky, které jsou potřeba pro správu uživatelů a rolí pomocí rozhraní API ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="44304-177">These have the remaining model classes and the new pages needed for user and role management using the ASP.NET Identity APIs.</span></span> <span data-ttu-id="44304-178">Použitý přístup je podobný členství SQL a podrobné vysvětlení najdete [tady](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span><span class="sxs-lookup"><span data-stu-id="44304-178">The approach used is similar to the SQL Membership and the detailed explanation can be found [here](migrating-an-existing-website-from-sql-membership-to-aspnet-identity.md).</span></span>

[!INCLUDE[](../../../includes/identity/alter-command-exception.md)]

## <a name="copying-profile-data-to-the-new-tables"></a><span data-ttu-id="44304-179">Kopírování dat profilu do nových tabulek</span><span class="sxs-lookup"><span data-stu-id="44304-179">Copying Profile data to the new tables</span></span>

<span data-ttu-id="44304-180">Jak bylo zmíněno dříve, musíme deserializovat data XML v tabulkách profilů a uložit je do sloupců tabulky AspNetUsers.</span><span class="sxs-lookup"><span data-stu-id="44304-180">As mentioned earlier, we need to deserialize the xml data in the Profiles tables and store it in the columns of the AspNetUsers table.</span></span> <span data-ttu-id="44304-181">V tabulce uživatelů v předchozím kroku byly vytvořeny nové sloupce, takže všechny zbývá, abyste tyto sloupce naplnili potřebnými daty.</span><span class="sxs-lookup"><span data-stu-id="44304-181">The new columns were created in the users table in the previous step so all that is left is to populate those columns with the necessary data.</span></span> <span data-ttu-id="44304-182">K tomu použijeme konzolovou aplikaci, která se spustí jednou k naplnění nově vytvořených sloupců v tabulce Users.</span><span class="sxs-lookup"><span data-stu-id="44304-182">To do this, we will use a console application which is run once to populate the newly created columns in the users table.</span></span>

1. <span data-ttu-id="44304-183">Vytvořte novou konzolovou aplikaci ve výstupu řešení.</span><span class="sxs-lookup"><span data-stu-id="44304-183">Create a new console application in the exiting solution.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image2.jpg)
2. <span data-ttu-id="44304-184">Nainstalujte nejnovější verzi balíčku Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="44304-184">Install the latest version of the Entity Framework package.</span></span>
3. <span data-ttu-id="44304-185">Přidejte webovou aplikaci vytvořenou výše jako odkaz na konzolovou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="44304-185">Add the web application created above as a reference to the console application.</span></span> <span data-ttu-id="44304-186">Provedete to tak, že kliknete pravým tlačítkem na projekt, pak na Přidat odkazy, pak na řešení a potom kliknete na projekt a kliknete na OK.</span><span class="sxs-lookup"><span data-stu-id="44304-186">To do this right click on Project, then 'Add References', then Solution, then click on the project and click OK.</span></span>
4. <span data-ttu-id="44304-187">Zkopírujte následující kód do třídy Program.cs.</span><span class="sxs-lookup"><span data-stu-id="44304-187">Copy the below code in the Program.cs class.</span></span> <span data-ttu-id="44304-188">Tato logika načte data profilu pro každého uživatele, zaregistruje ho jako objekt ProfileInfo a uloží ho zpátky do databáze.</span><span class="sxs-lookup"><span data-stu-id="44304-188">This logic reads profile data for each user, serializes it as 'ProfileInfo' object and stores it back to the database.</span></span>

    [!code-csharp[Main](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/samples/sample6.cs)]

   <span data-ttu-id="44304-189">Některé použité modely jsou definovány ve složce ' IdentityModels ' projektu webové aplikace, takže musíte zahrnout odpovídající obory názvů.</span><span class="sxs-lookup"><span data-stu-id="44304-189">Some of the models used are defined in the 'IdentityModels' folder of the web application project, so you must include the corresponding namespaces.</span></span>
5. <span data-ttu-id="44304-190">Výše uvedený kód funguje na databázovém souboru ve složce App\_data projektu webové aplikace, který jste vytvořili v předchozích krocích.</span><span class="sxs-lookup"><span data-stu-id="44304-190">The above code works on the database file in the App\_Data folder of the web application project created in the previous steps.</span></span> <span data-ttu-id="44304-191">Chcete-li se na něj odkazovat, aktualizujte připojovací řetězec v souboru App. config konzolové aplikace pomocí připojovacího řetězce v souboru Web. config webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="44304-191">To reference that, update the connection string in the app.config file of the console application with the connection string in the web.config of the web application.</span></span> <span data-ttu-id="44304-192">Zadejte také úplnou fyzickou cestu ve vlastnosti ' AttachDbFilename '.</span><span class="sxs-lookup"><span data-stu-id="44304-192">Also provide the complete physical path in the 'AttachDbFilename' property.</span></span>
6. <span data-ttu-id="44304-193">Otevřete příkazový řádek a přejděte do složky bin výše uvedené konzolové aplikace.</span><span class="sxs-lookup"><span data-stu-id="44304-193">Open a command prompt and navigate to the bin folder of the above console application.</span></span> <span data-ttu-id="44304-194">Spusťte spustitelný soubor a zkontrolujte výstup protokolu, jak je znázorněno na následujícím obrázku.</span><span class="sxs-lookup"><span data-stu-id="44304-194">Run the executable and review the log output as shown in the following image.</span></span>  
    ![](migrating-universal-provider-data-for-membership-and-user-profiles-to-aspnet-identity/_static/image3.jpg)
7. <span data-ttu-id="44304-195">Otevřete tabulku ' AspNetUsers ' v Průzkumník serveru a ověřte data v nových sloupcích, které obsahují vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="44304-195">Open the 'AspNetUsers' table in the Server Explorer and verify the data in the new columns that hold the properties.</span></span> <span data-ttu-id="44304-196">Měly by se aktualizovat odpovídajícími hodnotami vlastností.</span><span class="sxs-lookup"><span data-stu-id="44304-196">They should be updated with the corresponding property values.</span></span>

## <a name="verify-functionality"></a><span data-ttu-id="44304-197">Ověřit funkčnost</span><span class="sxs-lookup"><span data-stu-id="44304-197">Verify functionality</span></span>

<span data-ttu-id="44304-198">Použijte nově přidané stránky členství, které jsou implementované pomocí ASP.NET Identity pro přihlášení uživatele z původní databáze.</span><span class="sxs-lookup"><span data-stu-id="44304-198">Use the newly added membership pages that are implemented using ASP.NET Identity to login a user from the old database.</span></span> <span data-ttu-id="44304-199">Uživatel by měl být schopný přihlásit se pomocí stejných přihlašovacích údajů.</span><span class="sxs-lookup"><span data-stu-id="44304-199">The user should be able to log in using the same credentials.</span></span> <span data-ttu-id="44304-200">Vyzkoušejte jiné funkce, jako je přidání OAuth, vytvoření nového uživatele, změna hesla, přidání rolí, přidání uživatelů do rolí atd.</span><span class="sxs-lookup"><span data-stu-id="44304-200">Try the other functionalities like adding OAuth, creating a new user, changing a password, adding roles, add users to roles, etc.</span></span>

<span data-ttu-id="44304-201">Data profilu pro starého uživatele a nové uživatele by se měla načíst a uložit v tabulce uživatelé.</span><span class="sxs-lookup"><span data-stu-id="44304-201">The Profile data for the old user and the new users should be retrieved and stored in the users table.</span></span> <span data-ttu-id="44304-202">Na starou tabulku již nelze odkazovat.</span><span class="sxs-lookup"><span data-stu-id="44304-202">The old table should no longer be referenced.</span></span>

## <a name="conclusion"></a><span data-ttu-id="44304-203">Závěr</span><span class="sxs-lookup"><span data-stu-id="44304-203">Conclusion</span></span>

<span data-ttu-id="44304-204">Článek popisuje proces migrace webových aplikací, které používaly model poskytovatele pro členství ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="44304-204">The article described the process of migrating web applications that used the provider model for membership to ASP.NET Identity.</span></span> <span data-ttu-id="44304-205">Článek navíc popisuje migraci dat profilu pro uživatele, kteří se budou připojovat do systému identit.</span><span class="sxs-lookup"><span data-stu-id="44304-205">The article additionally outlined migrating profile data for users to be hooked into the Identity system.</span></span> <span data-ttu-id="44304-206">Pro otázky a problémy, které se při migraci vaší aplikace vyskytují, prosím nechejte komentáře uvedené níže.</span><span class="sxs-lookup"><span data-stu-id="44304-206">Please leave comments below for questions and issues encountered when you migrate your app.</span></span>

<span data-ttu-id="44304-207">*Děkujeme Rick Anderson a Robert blog pro kontrolu článku.*</span><span class="sxs-lookup"><span data-stu-id="44304-207">*Thanks to Rick Anderson and Robert McMurray for reviewing the article.*</span></span>
