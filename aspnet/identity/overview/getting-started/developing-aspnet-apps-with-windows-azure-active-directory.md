---
uid: identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
title: Vývoj aplikací ASP.NET s využitím Azure Active Directory-ASP.NET 4. x
author: Rick-Anderson
description: Microsoft ASP.NET nástroje pro Azure Active Directory usnadňují ověřování pro webové aplikace hostované v Azure. Můžete použít Azure předběžné...
ms.author: riande
ms.date: 08/14/2014
ms.assetid: 457d7eaf-ee76-4ceb-9082-c7c1721435ad
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/developing-aspnet-apps-with-windows-azure-active-directory
msc.type: authoredcontent
ms.openlocfilehash: 28425ea8d1312dfc6e14df9677396f2cbcf6f16d
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78583851"
---
# <a name="developing-aspnet-apps-with-azure-active-directory"></a><span data-ttu-id="b3ed7-104">Vývoj aplikací ASP.NET s použitím Azure Active Directory</span><span class="sxs-lookup"><span data-stu-id="b3ed7-104">Developing ASP.NET Apps with Azure Active Directory</span></span>

<span data-ttu-id="b3ed7-105">od [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="b3ed7-105">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="b3ed7-106">Microsoft ASP.NET nástroje pro Azure Active Directory zjednodušují povolení ověřování pro webové aplikace hostované v [Azure](https://www.windowsazure.com/home/features/web-sites/).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-106">Microsoft ASP.NET tools for Azure Active Directory simplifies enabling authentication for web apps hosted on [Azure](https://www.windowsazure.com/home/features/web-sites/).</span></span> <span data-ttu-id="b3ed7-107">Ověřování Azure můžete použít k ověření uživatelů Office 365 z vaší organizace a firemních účtů synchronizovaných z místní služby Active Directory nebo uživatelů vytvořených ve vlastní Azure Active Directory doméně.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-107">You can use Azure Authentication to authenticate Office 365 users from your organization, corporate accounts synced from your on-premise Active Directory or users created in your own custom Azure Active Directory domain.</span></span> <span data-ttu-id="b3ed7-108">Povolení ověřování Windows Azure nakonfiguruje vaši aplikaci tak, aby ověřovala uživatele pomocí jednoho [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenanta.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-108">Enabling Windows Azure Authentication configures your application to authenticate users using a single [Azure Active Directory](https://docs.microsoft.com/azure/active-directory/) tenant.</span></span>

<span data-ttu-id="b3ed7-109">V tomto kurzu se dozvíte, jak vytvořit aplikaci ASP.NET, která je nakonfigurovaná pro přihlašování pomocí [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-109">This tutorial will show you how to create an ASP.NET application that is configured for sign-on with [Azure Active Directory](https://msdn.microsoft.com/library/azure/mt168838.aspx) (Azure AD).</span></span> <span data-ttu-id="b3ed7-110">Naučíte se také, jak volat Graph API a získat informace o aktuálně přihlášeném uživateli a o tom, jak aplikaci nasadit do Azure.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-110">You will also learn how to call the Graph API to get information about the currently signed-in user and how to deploy the application to Azure.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="b3ed7-111">Předpoklady</span><span class="sxs-lookup"><span data-stu-id="b3ed7-111">Prerequisites</span></span>

1. <span data-ttu-id="b3ed7-112">[Visual Studio Express 2013 pro web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) nebo [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-112">[Visual Studio Express 2013 for Web](https://my.visualstudio.com/Downloads?q=visual%20studio%202013#d-2013-express) or [Visual Studio 2013](https://my.visualstudio.com/Downloads?q=visual%20studio%202013).</span></span>
2. <span data-ttu-id="b3ed7-113">Je třeba zadat [Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) – Update 3 nebo vyšší.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-113">[Visual Studio 2013 Update 4](https://www.microsoft.com/download/details.aspx?id=44921) - Update 3 or higher is required.</span></span>
3. <span data-ttu-id="b3ed7-114">Účet Azure.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-114">An Azure account.</span></span> <span data-ttu-id="b3ed7-115">Pokud ještě nemáte účet, [klikněte sem](https://azure.microsoft.com/pricing/free-trial/) pro bezplatnou zkušební verzi.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-115">[Click here](https://azure.microsoft.com/pricing/free-trial/) for a free trial if you do not already have an account.</span></span>

## <a name="add-a-global-administrator-to-your-active-directory"></a><span data-ttu-id="b3ed7-116">Přidání globálního správce do Active Directory</span><span class="sxs-lookup"><span data-stu-id="b3ed7-116">Add a Global Administrator to your Active Directory</span></span>

1. <span data-ttu-id="b3ed7-117">Přihlaste se k [Azure portál pro správu](https://manage.windowsazure.com/).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-117">Sign in to the [Azure Management Portal](https://manage.windowsazure.com/).</span></span>
2. <span data-ttu-id="b3ed7-118">Všechny účty Azure obsahují **výchozí adresář** – klikněte na něj a potom klikněte na kartu **Uživatelé** v horní části stránky (viz obrázek níže).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-118">All Azure accounts contain a **Default Directory** -- click on it, then click the **Users** tab at the top of the page (see image below).</span></span>
3. <span data-ttu-id="b3ed7-119">Klikněte na Přidat uživatele.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-119">Click Add User.</span></span>
    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image1.png)
4. <span data-ttu-id="b3ed7-120">Vytvořte nového uživatele s rolí **globálního správce** .</span><span class="sxs-lookup"><span data-stu-id="b3ed7-120">Create a new user with the **Global Administrator** role.</span></span> <span data-ttu-id="b3ed7-121">V horní nabídce klikněte na **Uživatelé** a potom na panelu příkazů klikněte na tlačítko **Přidat uživatele** .</span><span class="sxs-lookup"><span data-stu-id="b3ed7-121">Click **Users** from the top menu, and then click the **Add User** button on the command bar.</span></span>
5. <span data-ttu-id="b3ed7-122">V dialogovém okně **Přidat uživatele** zadejte jméno nového uživatele a klikněte na šipku vpravo.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-122">In the **Add User** dialog, enter a name for the new user and then click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image2.png)
6. <span data-ttu-id="b3ed7-123">Zadejte uživatelské jméno a nastavte roli na **globální správce**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-123">Enter the user name and set the role to **Global Administrator**.</span></span> <span data-ttu-id="b3ed7-124">Globální správci vyžadují alternativní e-mailovou adresu pro účely obnovení hesla.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-124">Global administrators require an alternate email address for password recovery purposes.</span></span> <span data-ttu-id="b3ed7-125">Až budete hotovi, klikněte na šipku doprava.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-125">After you're finished, click the right arrow.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image3.png)
7. <span data-ttu-id="b3ed7-126">Na další stránce dialogového okna klikněte na **vytvořit**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-126">On the next page of the dialog, click **Create**.</span></span> <span data-ttu-id="b3ed7-127">Pro nového uživatele se vytvoří dočasné heslo, které se zobrazí v dialogovém okně.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-127">A temporary password will be created for the new user and displayed in the dialog.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image4.png)

   <span data-ttu-id="b3ed7-128">Uložte heslo. po prvním přihlášení budete muset změnit heslo.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-128">Save the password, you will be required to change the password after the first log in.</span></span> <span data-ttu-id="b3ed7-129">Následující obrázek ukazuje nový účet správce.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-129">The following image shows the new admin account.</span></span> <span data-ttu-id="b3ed7-130">K přihlášení do aplikace je nutné použít Azure Active Directory, nikoli účet Microsoft na této stránce.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-130">You must use the Azure Active Directory to log into your app, not the Microsoft account also shown on this page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image5.png)

## <a name="create-an-aspnet-application"></a><span data-ttu-id="b3ed7-131">Vytvoření aplikace v ASP.NET</span><span class="sxs-lookup"><span data-stu-id="b3ed7-131">Create an ASP.NET Application</span></span>

<span data-ttu-id="b3ed7-132">Následující kroky používají [Visual Studio Express 2013 pro web](https://www.microsoft.com/download/details.aspx?id=40747)a vyžadují [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-132">The following steps use [Visual Studio Express 2013 for Web](https://www.microsoft.com/download/details.aspx?id=40747), and requires [Visual Studio 2013 Update 3](https://www.microsoft.com/download/details.aspx?id=43721).</span></span>

1. <span data-ttu-id="b3ed7-133">V aplikaci Visual Studio klikněte na **soubor** a pak na **Nový projekt**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-133">In Visual Studio, click **File** and then **New Project**.</span></span> <span data-ttu-id="b3ed7-134">V dialogovém okně **Nový projekt** vyberte v nabídce vlevo C# možnost vizuální webový projekt a klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-134">On the **New Project** dialog, select the Visual C# Web project from the left menu and click **OK**.</span></span> <span data-ttu-id="b3ed7-135">Pokud nechcete, aby aplikace byla pro aplikaci k disApplication Insights, můžete také zrušit kontrolu **přidání do projektu** .</span><span class="sxs-lookup"><span data-stu-id="b3ed7-135">You may also want to uncheck the **Add Application Insights to Project** if you don't want the functionality for your application.</span></span>
2. <span data-ttu-id="b3ed7-136">V dialogovém okně **Nový projekt ASP.NET** vyberte **MVC**a pak klikněte na **změnit ověřování**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-136">In the **New ASP.NET Project** dialog, select **MVC**, and then click **Change Authentication**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image6.png)
3. <span data-ttu-id="b3ed7-137">V dialogu **změnit ověřování** vyberte **účty organizace**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-137">On the **Change Authentication** dialog, select **Organizational Accounts**.</span></span> <span data-ttu-id="b3ed7-138">Tyto možnosti se dají použít k automatické registraci aplikace v Azure AD a také k automatické konfiguraci vaší aplikace pro integraci se službou Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-138">These options can be used to automatically register your application with Azure AD as well as automatically configure your application to integrate with Azure AD.</span></span> <span data-ttu-id="b3ed7-139">K registraci a konfiguraci aplikace nemusíte používat dialogové okno **změnit ověřování** , ale to je mnohem jednodušší.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-139">You don't have to use the **Change Authentication** dialog to register and configure your application, but it makes it much easier.</span></span> <span data-ttu-id="b3ed7-140">Pokud používáte Visual Studio 2012, můžete přesto aplikaci zaregistrovat do Azure Portál pro správu a aktualizovat její konfiguraci pro integraci se službou Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-140">If you are using Visual Studio 2012 for example, you can still manually register the application in the Azure Management Portal and update its configuration to integrate with Azure AD.</span></span>
   <span data-ttu-id="b3ed7-141">V rozevíracích nabídkách vyberte **cloudová** a **jednotné přihlašování a pak čtěte data adresáře**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-141">In the drop-down menus, select **Cloud - Single Organization** and **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="b3ed7-142">Zadejte doménu pro adresář služby Azure AD (například na obrázcích níže) *aricka0yahoo.onmicrosoft.com*a pak klikněte na **OK**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-142">Enter the domain for your Azure AD directory, for example (in the images below) *aricka0yahoo.onmicrosoft.com*, and then click **OK**.</span></span> <span data-ttu-id="b3ed7-143">Název domény můžete získat z karty domény pro výchozí adresář na webu Azure Portal (viz další obrázek níže).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-143">You can get the domain name from the Domains tab for the Default Directory on the azure portal (see the next image down).</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image7.png)

   <span data-ttu-id="b3ed7-144">Následující obrázek ukazuje název domény z Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-144">The following image shows the domain name from the Azure portal.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image8.png)

    > [!NOTE]
    > <span data-ttu-id="b3ed7-145">Volitelně můžete nakonfigurovat identifikátor URI ID aplikace, který se zaregistruje ve službě Azure AD, kliknutím na **Další možnosti**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-145">You can optionally configure the Application ID URI that will be registered in Azure AD by clicking **More Options**.</span></span> <span data-ttu-id="b3ed7-146">Identifikátor URI ID aplikace je jedinečný identifikátor pro aplikaci, která je zaregistrovaná v Azure AD a používaná aplikací k identifikaci sebe sama při komunikaci se službou Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-146">The App ID URI is the unique identifier for an application, which is registered in Azure AD and used by the application to identify itself when communicating with Azure AD.</span></span> <span data-ttu-id="b3ed7-147">Další informace o identifikátoru URI ID aplikace a dalších vlastnostech registrovaných aplikací najdete v [tomto tématu](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-147">For more information about the App ID URI and other properties of registered applications, see [this topic](https://msdn.microsoft.com/library/azure/dn499820.aspx#BKMK_Registering).</span></span> <span data-ttu-id="b3ed7-148">Kliknutím na zaškrtávací políčko pod polem identifikátor URI ID aplikace můžete také přepsat existující registraci v Azure AD, která používá stejný identifikátor URI ID aplikace.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-148">By clicking the checkbox below the App ID URI field, you can also choose to overwrite an existing registration in Azure AD that uses the same App ID URI.</span></span>
4. <span data-ttu-id="b3ed7-149">Po kliknutí na tlačítko **OK**se zobrazí dialogové okno pro přihlášení a bude nutné se přihlásit pomocí účtu globálního správce (nikoli účet Microsoft přidruženého k vašemu předplatnému).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-149">After clicking **OK**, a sign-in dialog will appear, and you'll need to sign in using a Global Administrator account (not the Microsoft account associated with your subscription).</span></span> <span data-ttu-id="b3ed7-150">Pokud jste dříve vytvořili nový účet správce, budete muset změnit heslo a znovu se přihlásit pomocí nového hesla.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-150">If you created a new Administrator account earlier, you'll be required to change the password and then sign in again using the new password.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image9.png)
5. <span data-ttu-id="b3ed7-151">Po úspěšném ověření se v dialogovém okně **Nový projekt ASP.NET** zobrazí volba pro ověřování (**organizace** ) a adresář, do kterého se nová aplikace zaregistruje (*aricka0yahoo.onmicrosoft.com* na obrázku níže).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-151">After you've successfully authenticated, the **New ASP.NET Project** dialog will show your authentication choice (**Organizational** ) and the directory where the new application will be registered (*aricka0yahoo.onmicrosoft.com* in the image below).</span></span> <span data-ttu-id="b3ed7-152">Pod těmito informacemi vyberte zaškrtávací políčko s označením **hostitel v cloudu**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-152">Below this information, select the checkbox labeled **Host in the cloud**.</span></span> <span data-ttu-id="b3ed7-153">Pokud je toto políčko zaškrtnuté, projekt se zřídí jako webová aplikace Azure a bude povolený pro snadné publikování později.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-153">If this checkbox is selected, the project will be provisioned as an Azure web app and will be enabled for easy publishing later.</span></span> <span data-ttu-id="b3ed7-154">Klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-154">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image10.png)
6. <span data-ttu-id="b3ed7-155">Zobrazí se dialogové okno **Konfigurovat web Azure** s použitím automaticky generovaného názvu a oblasti webu.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-155">The **Configure Azure Website** dialog will appear, using an auto-generated site name and region.</span></span> <span data-ttu-id="b3ed7-156">Všimněte si také, že účet, ke kterému jste právě přihlášení, v dialogovém okně.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-156">Also note the account you're currently signed into in the dialog.</span></span> <span data-ttu-id="b3ed7-157">Chcete se ujistit, že tento účet je ten, ke kterému je vaše předplatné Azure připojené, obvykle účet Microsoft.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-157">You want to make sure that this account is the one that your Azure subscription is attached to, typically a Microsoft account.</span></span>

    > [!NOTE]
    > <span data-ttu-id="b3ed7-158">Tento projekt vyžaduje databázi.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-158">This project requires a database.</span></span> <span data-ttu-id="b3ed7-159">Musíte vybrat jednu ze stávajících databází nebo vytvořit novou.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-159">You need to select one of your existing databases, or create a new one.</span></span> <span data-ttu-id="b3ed7-160">Databáze je povinná, protože projekt už používá místní databázový soubor k uložení malého množství konfiguračních dat ověřování.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-160">A database is required because the project already uses a local database file to store a small amount of authentication configuration data.</span></span> <span data-ttu-id="b3ed7-161">Když nasadíte aplikaci na web Azure, tato databáze se do nasazení nebalí, takže musíte vybrat takovou přístupnou v cloudu.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-161">When you deploy the application to an Azure Website, this database isn't packaged with the deployment, so you need to choose one that's accessible in the cloud.</span></span> <span data-ttu-id="b3ed7-162">Klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-162">Click **OK**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image11.png)
7. <span data-ttu-id="b3ed7-163">Projekt se vytvoří a možnosti ověřování a možnosti webové aplikace se automaticky nakonfigurují s projektem.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-163">The project will be created, and your authentication options and web app options will be automatically configured with the project.</span></span> <span data-ttu-id="b3ed7-164">Po dokončení tohoto procesu spusťte projekt místně stisknutím **^ F5**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-164">Once this process has completed, run the project locally by pressing **^F5**.</span></span> <span data-ttu-id="b3ed7-165">Budete se muset přihlásit pomocí účtu organizace.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-165">You will be required to sign in using your organizational account.</span></span> <span data-ttu-id="b3ed7-166">Zadejte uživatelské jméno a heslo pro účet, který jste vytvořili dříve, a klikněte na tlačítko **Přihlásit**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-166">Provide the username and password for the account you created earlier and click **Sign in**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image12.png)
8. <span data-ttu-id="b3ed7-167">Po úspěšném přihlášení se na webu ASP.NET zobrazí, že jste ověřili zobrazením uživatelského jména v pravém horním rohu stránky.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-167">After successful sign in, the ASP.NET site will show that you've authenticated by displaying the username in the top right corner of the page.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image13.png)

   <span data-ttu-id="b3ed7-168">Pokud se zobrazí chyba: hodnota nemůže být null nebo prázdná.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-168">If you get the error: Value cannot be null or empty.</span></span> <span data-ttu-id="b3ed7-169">Název parametru: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="b3ed7-169">Parameter name: linkText ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image14.png)</span></span>

   <span data-ttu-id="b3ed7-170">Viz část [ladění](#dbg) na konci tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-170">see the [debug](#dbg) section at the end of the tutorial.</span></span>

## <a name="basics-of-the-graph-api"></a><span data-ttu-id="b3ed7-171">Základy Graph API</span><span class="sxs-lookup"><span data-stu-id="b3ed7-171">Basics of the Graph API</span></span>

<span data-ttu-id="b3ed7-172">[Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) je programové rozhraní používané k provádění CRUD a dalších operací s objekty v adresáři služby Azure AD.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-172">[The Graph API](https://msdn.microsoft.com/library/azure/hh974476.aspx) is the programmatic interface used to perform CRUD and other operations on objects in your Azure AD directory.</span></span> <span data-ttu-id="b3ed7-173">Pokud vyberete možnost účtu organizace pro ověřování při vytváření nového projektu v Visual Studio 2013, bude aplikace již nakonfigurována pro volání Graph API.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-173">If you select an Organizational Account option for authentication when creating a new project in Visual Studio 2013, your application will already be configured to call the Graph API.</span></span> <span data-ttu-id="b3ed7-174">V této části se stručně ukáže, jak Graph API funguje.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-174">This section briefly shows you how the Graph API works.</span></span>

1. <span data-ttu-id="b3ed7-175">V běžící aplikaci klikněte na jméno přihlášeného uživatele v pravém horním rohu stránky.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-175">In your running application, click on the name of the signed-in user at the top right of the page.</span></span> <span data-ttu-id="b3ed7-176">Tím přejdete na stránku profil uživatele, což je akce na domovském řadiči.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-176">This will take you to the User Profile page, which is an action on the Home Controller.</span></span> <span data-ttu-id="b3ed7-177">Všimněte si, že tabulka obsahuje uživatelské informace o účtu správce, který jste vytvořili dříve.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-177">You'll notice that the table contains user information about the administrator account you created earlier.</span></span> <span data-ttu-id="b3ed7-178">Tyto informace jsou uloženy ve vašem adresáři a je volána Graph API, aby byly tyto informace načteny při načtení stránky.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-178">This information is stored in your directory, and the Graph API is called to retrieve this information when the page loads.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image15.png)
2. <span data-ttu-id="b3ed7-179">Vraťte se do sady Visual Studio a rozbalte složku **řadiče** a otevřete soubor **HomeController.cs** .</span><span class="sxs-lookup"><span data-stu-id="b3ed7-179">Go back to Visual Studio and expand the **Controllers** folder and then open the **HomeController.cs** file.</span></span> <span data-ttu-id="b3ed7-180">Zobrazí se akce **USERPROFILE ()** , která obsahuje kód pro načtení tokenu, a volání Graph API.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-180">You'll see a **UserProfile()** action that contains code to retrieve a token and then call the Graph API.</span></span> <span data-ttu-id="b3ed7-181">Tento kód je duplikován níže:</span><span class="sxs-lookup"><span data-stu-id="b3ed7-181">This code is duplicated below:</span></span>

    [!code-csharp[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample1.cs?highlight=22)]

    <span data-ttu-id="b3ed7-182">Chcete-li volat Graph API, je nejprve nutné načíst token.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-182">To call the Graph API, you first need to retrieve a token.</span></span> <span data-ttu-id="b3ed7-183">Po načtení tokenu musí být jeho řetězcová hodnota připojena do autorizační hlavičky pro všechny následné požadavky na Graph API.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-183">When the token is retrieved, its string value must be appended in the Authorization header for all subsequent requests to the Graph API.</span></span> <span data-ttu-id="b3ed7-184">Většina výše uvedeného kódu zpracovává podrobnosti ověřování ve službě Azure AD, aby získal token, pomocí tokenu k volání Graph API a pak transformuje odpověď, aby mohla být prezentována v zobrazení.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-184">Most of the code above handles the details of authenticating to Azure AD to get a token, using the token to make a call to the Graph API, and then transforming the response so that it can be presented in the View.</span></span>

    <span data-ttu-id="b3ed7-185">Nejrelevantnější část pro diskuzi je následující zvýrazněný řádek: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-185">The most relevant portion for discussion is the following highlighted line: `UserProfile profile = JsonConvert.DeserializeObject<UserProfile>(responseString);`.</span></span> <span data-ttu-id="b3ed7-186">Tento řádek představuje jméno uživatele, které bylo deserializováno z odpovědi JSON a je prezentováno v zobrazení.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-186">This line represents the name of the user, which has been deserialized from the JSON response and is presented in the View.</span></span>

    <span data-ttu-id="b3ed7-187">Graph API můžete volat pomocí HttpClient a zpracovávat nezpracovaná data sami, ale jednodušším způsobem je použití [klientské knihovny grafů, která je k dispozici prostřednictvím NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-187">You can call the Graph API using HttpClient and handle the raw data yourself, but an easier way is to use the [Graph Client Library which is available via NuGet](http://www.nuget.org/packages/Microsoft.Azure.ActiveDirectory.GraphClient/).</span></span> <span data-ttu-id="b3ed7-188">Klientská knihovna zpracovává nezpracované požadavky HTTP a transformaci vrácených dat za vás a výrazně usnadňuje práci s Graph API v prostředí .NET.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-188">The Client Library handles the raw HTTP requests and the transformation of the returned data for you, and makes it much easier to work with the Graph API in a .NET environment.</span></span> <span data-ttu-id="b3ed7-189">Podívejte se na související ukázky Graph API kódu na [GitHubu.](https://github.com/AzureADSamples)</span><span class="sxs-lookup"><span data-stu-id="b3ed7-189">See the related Graph API code samples on [GitHub.](https://github.com/AzureADSamples)</span></span>

## <a name="deploy-the-application-to-azure"></a><span data-ttu-id="b3ed7-190">Nasazení aplikace do Azure</span><span class="sxs-lookup"><span data-stu-id="b3ed7-190">Deploy the Application to Azure</span></span>

<span data-ttu-id="b3ed7-191">Následující postup vám ukáže, jak nasadit aplikaci do Azure.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-191">The following steps will show you how to deploy the application to Azure.</span></span> <span data-ttu-id="b3ed7-192">V předchozích krocích jste připojili nový projekt pomocí webové aplikace v Azure, takže je připravený k publikování v několika krocích.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-192">In the earlier steps, you connected your new project with a web app on Azure, so it's ready to be published in just a few steps.</span></span>

1. <span data-ttu-id="b3ed7-193">V aplikaci Visual Studio klikněte pravým tlačítkem na projekt a vyberte **publikovat**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-193">In Visual Studio, right-click on the project and select **Publish**.</span></span> <span data-ttu-id="b3ed7-194">Dialog **Publikovat web** se zobrazí se všemi nastaveními, která jsou už nakonfigurovaná.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-194">The **Publish Web** dialog will appear with each setting already configured.</span></span> <span data-ttu-id="b3ed7-195">Kliknutím na tlačítko **Další** přejdete na stránku **Nastavení** .</span><span class="sxs-lookup"><span data-stu-id="b3ed7-195">Click on the **Next** button to go to the **Settings** page.</span></span> <span data-ttu-id="b3ed7-196">Může se zobrazit výzva k ověření. Ujistěte se, že se ověřujete pomocí účtu předplatného Azure (obvykle účet Microsoft), nikoli účtu organizace, který jste vytvořili dříve.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-196">You may be prompted to authenticate; make sure you authenticate using your Azure subscription account (typically a Microsoft account) and not the organizational account you created earlier.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image16.png)
2. <span data-ttu-id="b3ed7-197">Zaškrtněte možnost **Povolit ověřování organizace** .</span><span class="sxs-lookup"><span data-stu-id="b3ed7-197">Check the **Enable Organizational Authentication** option.</span></span> <span data-ttu-id="b3ed7-198">Do pole **doména** zadejte doménu pro svůj adresář.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-198">In the **Domain** field, enter the domain for your directory.</span></span> <span data-ttu-id="b3ed7-199">V rozevíracím seznamu **úroveň přístupu** vyberte **jednotné přihlašování, číst data adresáře**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-199">From the **Access Level** drop-down, select **Single Sign On, Read directory data**.</span></span> <span data-ttu-id="b3ed7-200">Všimněte si, že předchozí databáze, kterou jste použili, je již vyplněna v části **databáze** .</span><span class="sxs-lookup"><span data-stu-id="b3ed7-200">You'll notice that the previous database you used is already populated in the **Databases** section.</span></span> <span data-ttu-id="b3ed7-201">Klikněte na **Publikovat**.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-201">Click **Publish**.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image17.png)
3. <span data-ttu-id="b3ed7-202">Visual Studio začne nasazovat web a zobrazí se nové okno prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-202">Visual Studio will begin deploying your website, and then a new browser window will appear.</span></span> <span data-ttu-id="b3ed7-203">Může se zobrazit výzva k opětovnému ověření adresáře.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-203">You may be prompted to authenticate to your directory once again.</span></span> <span data-ttu-id="b3ed7-204">Po ověření budete přesměrováni na nově publikovaný web v Azure.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-204">Once you've authenticated, you'll be redirected to your newly published website on Azure.</span></span>

    ![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image18.png)

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="b3ed7-205">Ladění aplikace</span><span class="sxs-lookup"><span data-stu-id="b3ed7-205">Debugging the app</span></span>

<span data-ttu-id="b3ed7-206">Pokud se zobrazí následující chyba: hodnota nemůže být null nebo prázdná.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-206">If you get the following error: Value cannot be null or empty.</span></span> <span data-ttu-id="b3ed7-207">Název parametru: linkText</span><span class="sxs-lookup"><span data-stu-id="b3ed7-207">Parameter name: linkText</span></span>

![](developing-aspnet-apps-with-windows-azure-active-directory/_static/image19.png)

<span data-ttu-id="b3ed7-208">Nahraďte kód v souboru *Views\Shared\\_LoginPartial. cshtml* následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="b3ed7-208">Replace the code in the *Views\Shared\\_LoginPartial.cshtml* file with the following:</span></span>

[!code-cshtml[Main](developing-aspnet-apps-with-windows-azure-active-directory/samples/sample2.cshtml?highlight=1-8,15-16)]

<span data-ttu-id="b3ed7-209">Pokud se přihlášený uživatel po spuštění aplikace zobrazí jako "null uživatel", odhlaste se a znovu se přihlaste pomocí účtu služby Active Directory, který jste vytvořili dříve.</span><span class="sxs-lookup"><span data-stu-id="b3ed7-209">After running the app, if the logged in user shows "Null User", sign out, and sign back in with the Active Directory account you created earlier.</span></span>

<span data-ttu-id="b3ed7-210">Skvělým kurzem, který je potřeba provést, je Rick Rainey [podrobně: Azure websites a organizace ověřování pomocí Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span><span class="sxs-lookup"><span data-stu-id="b3ed7-210">An excellent tutorial to follow is Rick Rainey's [Deep Dive: Azure Websites and Organizational Authentication using Azure AD](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/).</span></span>

## <a name="more-information"></a><span data-ttu-id="b3ed7-211">Další informace</span><span class="sxs-lookup"><span data-stu-id="b3ed7-211">More Information</span></span>

- [<span data-ttu-id="b3ed7-212">Hluboká podrobně: Azure websites a ověřování organizace pomocí Azure AD</span><span class="sxs-lookup"><span data-stu-id="b3ed7-212">Deep Dive: Azure Websites and Organizational Authentication using Azure AD</span></span>](http://rickrainey.com/2014/08/19/deep-dive-azure-websites-and-organizational-authentication-using-azure-ad/)
- [<span data-ttu-id="b3ed7-213">Přehled služby Azure AD Graph API</span><span class="sxs-lookup"><span data-stu-id="b3ed7-213">Azure AD Graph API Overview</span></span>](https://msdn.microsoft.com/library/azure/hh974476.aspx)
- [<span data-ttu-id="b3ed7-214">Scénáře ověřování ve službě Azure AD</span><span class="sxs-lookup"><span data-stu-id="b3ed7-214">Authentication Scenarios in Azure AD</span></span>](https://msdn.microsoft.com/library/azure/dn499820.aspx)
- [<span data-ttu-id="b3ed7-215">Ukázky kódu Azure AD na GitHubu</span><span class="sxs-lookup"><span data-stu-id="b3ed7-215">Azure AD Code Samples on GitHub</span></span>](https://github.com/AzureADSamples)
