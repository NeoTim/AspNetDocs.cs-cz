---
uid: identity/overview/getting-started/aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider
title: 'ASP.NET Identity: použití úložiště MySQL s poskytovatelem EntityFramework MySQL (C#)-ASP.NET 4. x'
author: maumar
description: V tomto kurzu se dozvíte, jak nahradit výchozí mechanismus úložiště dat pro ASP.NET Identity pomocí EntityFramework (poskytovatele klienta SQL) s provid MySQL...
ms.author: riande
ms.date: 12/10/2013
ms.assetid: 15253312-a92c-43ba-908e-b5dacd3d08b8
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider
msc.type: authoredcontent
ms.openlocfilehash: e89ed139657c5ce9ddcc56879946c62038919483
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78584005"
---
# <a name="aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider-c"></a><span data-ttu-id="c4e47-103">ASP.NET Identity: Použití úložiště MySQL zprostředkovatele EntityFramework MySQL (C#)</span><span class="sxs-lookup"><span data-stu-id="c4e47-103">ASP.NET Identity: Using MySQL Storage with an EntityFramework MySQL Provider (C#)</span></span>

<span data-ttu-id="c4e47-104">od [Maurycy Markowski](https://github.com/maumar), [Raquel Soares de Almeida](https://github.com/raquelsa), [Robert blog](https://github.com/rmcmurray)</span><span class="sxs-lookup"><span data-stu-id="c4e47-104">by [Maurycy Markowski](https://github.com/maumar), [Raquel Soares De Almeida](https://github.com/raquelsa), [Robert McMurray](https://github.com/rmcmurray)</span></span>

> <span data-ttu-id="c4e47-105">V tomto kurzu se dozvíte, jak nahradit výchozí mechanismus úložiště dat pro [**ASP.NET identity**](introduction-to-aspnet-identity.md) pomocí EntityFramework (poskytovatele klienta SQL) s poskytovatelem MySQL.</span><span class="sxs-lookup"><span data-stu-id="c4e47-105">This tutorial shows you how to replace the default data storage mechanism for [**ASP.NET Identity**](introduction-to-aspnet-identity.md) with EntityFramework (SQL client provider) with a MySQL provider.</span></span>

<span data-ttu-id="c4e47-106">V tomto kurzu se pokryje následující témata:</span><span class="sxs-lookup"><span data-stu-id="c4e47-106">The following topics will be covered in this tutorial:</span></span>

- <span data-ttu-id="c4e47-107">Vytvoření databáze MySQL v Azure</span><span class="sxs-lookup"><span data-stu-id="c4e47-107">Creating a MySQL database on Azure</span></span>
- <span data-ttu-id="c4e47-108">Vytvoření aplikace MVC pomocí šablony Visual Studio 2013 MVC</span><span class="sxs-lookup"><span data-stu-id="c4e47-108">Creating an MVC application using Visual Studio 2013 MVC template</span></span>
- <span data-ttu-id="c4e47-109">Konfigurace EntityFramework pro práci s poskytovatelem databáze MySQL</span><span class="sxs-lookup"><span data-stu-id="c4e47-109">Configuring EntityFramework to work with a MySQL database provider</span></span>
- <span data-ttu-id="c4e47-110">Spuštění aplikace za účelem ověření výsledků</span><span class="sxs-lookup"><span data-stu-id="c4e47-110">Running the application to verify the results</span></span>

<span data-ttu-id="c4e47-111">Na konci tohoto kurzu budete mít aplikaci MVC s úložištěm ASP.NET Identity, které používá databázi MySQL hostovanou v Azure.</span><span class="sxs-lookup"><span data-stu-id="c4e47-111">At the end of this tutorial, you will have an MVC application with the ASP.NET Identity store that is using a MySQL database that is hosted in Azure.</span></span>

## <a name="creating-a-mysql-database-instance-on-azure"></a><span data-ttu-id="c4e47-112">Vytvoření instance databáze MySQL v Azure</span><span class="sxs-lookup"><span data-stu-id="c4e47-112">Creating a MySQL database instance on Azure</span></span>

1. <span data-ttu-id="c4e47-113">Přihlaste se k [webu Azure Portal](https://go.microsoft.com/fwlink/?linkid=529715&amp;clcid=0x409).</span><span class="sxs-lookup"><span data-stu-id="c4e47-113">Log in to the [Azure Portal](https://go.microsoft.com/fwlink/?linkid=529715&amp;clcid=0x409).</span></span>
2. <span data-ttu-id="c4e47-114">V dolní části stránky klikněte na **Nový** a vyberte **Uložit**:</span><span class="sxs-lookup"><span data-stu-id="c4e47-114">Click **NEW** at the bottom of the page, and then select **STORE**:</span></span>

    [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.png)
3. <span data-ttu-id="c4e47-115">V průvodci pro **Výběr a přidání** vyberte **ClearDB databáze MySQL**a potom klikněte na šipku **Další** v dolní části snímku:</span><span class="sxs-lookup"><span data-stu-id="c4e47-115">In the **Choose and Add-on** wizard, select **ClearDB MySQL Database**, and then click the **Next** arrow at the bottom of the frame:</span></span>

   <span data-ttu-id="c4e47-116">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-116">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-117">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-117">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.png)</span></span>
4. <span data-ttu-id="c4e47-118">Nechejte výchozí **bezplatný** plán, změňte **název** na **IdentityMySQLDatabase**, vyberte oblast, která je nejblíže, a potom klikněte na šipku **Další** v dolní části rámečku:</span><span class="sxs-lookup"><span data-stu-id="c4e47-118">Keep the default **Free** plan, change the **NAME** to **IdentityMySQLDatabase**, select the region that is nearest to you, and then click the **Next** arrow at the bottom of the frame:</span></span>

   <span data-ttu-id="c4e47-119">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-119">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-120">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-120">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.png)</span></span>
5. <span data-ttu-id="c4e47-121">Kliknutím na značku **nákupu** dokončete vytvoření databáze.</span><span class="sxs-lookup"><span data-stu-id="c4e47-121">Click the **PURCHASE** checkmark to complete the database creation.</span></span>

   <span data-ttu-id="c4e47-122">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-122">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-123">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-123">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.png)</span></span>
6. <span data-ttu-id="c4e47-124">Po vytvoření databáze ji můžete spravovat na kartě **Doplňky** na portálu pro správu.</span><span class="sxs-lookup"><span data-stu-id="c4e47-124">After your database has been created, you can manage it from the **ADD-ONS** tab in the management portal.</span></span> <span data-ttu-id="c4e47-125">Chcete-li načíst informace o připojení pro vaši databázi, klikněte v dolní části stránky na možnost **informace o připojení** :</span><span class="sxs-lookup"><span data-stu-id="c4e47-125">To retrieve the connection information for your database, click **CONNECTION INFO** at the bottom of the page:</span></span>

   <span data-ttu-id="c4e47-126">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-126">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-127">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image10.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-127">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image10.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image9.png)</span></span>
7. <span data-ttu-id="c4e47-128">Zkopírujte připojovací řetězec kliknutím na tlačítko Kopírovat v poli **CONNECTIONSTRING** a uložte ho. Tyto informace použijete později v tomto kurzu pro aplikaci MVC:</span><span class="sxs-lookup"><span data-stu-id="c4e47-128">Copy the connection string by clicking on the copy button by the **CONNECTIONSTRING** field and save it; you will use this information later in this tutorial for your MVC application:</span></span>

   <span data-ttu-id="c4e47-129">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-129">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-130">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image12.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-130">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image12.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image11.png)</span></span>

## <a name="creating-an-mvc-application-project"></a><span data-ttu-id="c4e47-131">Vytvoření projektu aplikace MVC</span><span class="sxs-lookup"><span data-stu-id="c4e47-131">Creating an MVC application project</span></span>

<span data-ttu-id="c4e47-132">K dokončení kroků v této části kurzu budete muset nejdřív nainstalovat [Visual Studio Express 2013 pro web](https://go.microsoft.com/fwlink/?LinkId=299058) nebo [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="c4e47-132">To complete the steps in this section of the tutorial, you will first need to install [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="c4e47-133">Po instalaci sady Visual Studio použijte následující postup k vytvoření nového projektu aplikace MVC:</span><span class="sxs-lookup"><span data-stu-id="c4e47-133">Once Visual Studio has been installed, use the following steps to create a new MVC application project:</span></span>

1. <span data-ttu-id="c4e47-134">Otevřete Visual Studio 2103.</span><span class="sxs-lookup"><span data-stu-id="c4e47-134">Open Visual Studio 2103.</span></span>
2. <span data-ttu-id="c4e47-135">Na **úvodní** stránce klikněte na **Nový projekt** , nebo můžete kliknout na nabídku **soubor** a potom na **Nový projekt**:</span><span class="sxs-lookup"><span data-stu-id="c4e47-135">Click **New Project** from the **Start** page, or you can click the **File** menu and then **New Project**:</span></span>

   <span data-ttu-id="c4e47-136">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-136">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-137">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="c4e47-137">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image2.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image1.jpg)</span></span>
3. <span data-ttu-id="c4e47-138">Po zobrazení dialogového okna **Nový projekt** rozbalte v seznamu šablon **položku C# vizuál** , potom klikněte na možnost **Web**a vyberte možnost **Webová aplikace ASP.NET**.</span><span class="sxs-lookup"><span data-stu-id="c4e47-138">When the **New Project** dialog box is displayed, expand **Visual C#** in the list of templates, then click **Web**, and select **ASP.NET Web Application**.</span></span> <span data-ttu-id="c4e47-139">Pojmenujte projekt **IdentityMySQLDemo** a pak klikněte na **OK**:</span><span class="sxs-lookup"><span data-stu-id="c4e47-139">Name your project **IdentityMySQLDemo** and then click **OK**:</span></span>

   <span data-ttu-id="c4e47-140">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-140">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-141">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image14.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-141">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image14.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image13.png)</span></span>
4. <span data-ttu-id="c4e47-142">V dialogovém okně **Nový projekt ASP.NET** vyberte **MVC** templatewith výchozí možnosti; Tím se jako metoda ověřování nakonfigurují **jednotlivé uživatelské účty** .</span><span class="sxs-lookup"><span data-stu-id="c4e47-142">In the **New ASP.NET Project** dialog, select the **MVC** templatewith the default options; this will configure **Individual User Accounts** as the authentication method.</span></span> <span data-ttu-id="c4e47-143">Klikněte na **OK**:</span><span class="sxs-lookup"><span data-stu-id="c4e47-143">Click **OK**:</span></span>

   <span data-ttu-id="c4e47-144">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-144">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-145">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image16.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-145">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image16.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image15.png)</span></span>

## <a name="configure-entityframework-to-work-with-a-mysql-database"></a><span data-ttu-id="c4e47-146">Konfigurace EntityFramework pro práci s databází MySQL</span><span class="sxs-lookup"><span data-stu-id="c4e47-146">Configure EntityFramework to work with a MySQL database</span></span>

### <a name="update-the-entity-framework-assembly-for-your-project"></a><span data-ttu-id="c4e47-147">Aktualizace Entity Frameworkho sestavení pro váš projekt</span><span class="sxs-lookup"><span data-stu-id="c4e47-147">Update the Entity Framework assembly for your project</span></span>

<span data-ttu-id="c4e47-148">Aplikace MVC, která byla vytvořena pomocí šablony Visual Studio 2013 obsahuje odkaz na balíček [6.0.0 EntityFramework](http://www.nuget.org/packages/EntityFramework) , ale v tomto sestavení byly k dispozici aktualizace, od verze, která obsahuje významná vylepšení výkonu.</span><span class="sxs-lookup"><span data-stu-id="c4e47-148">The MVC application that was created from the Visual Studio 2013 template contains a reference to the [EntityFramework 6.0.0](http://www.nuget.org/packages/EntityFramework) package, but there have been updates to that assembly since its release which contain significant performance improvements.</span></span> <span data-ttu-id="c4e47-149">Chcete-li ve své aplikaci použít nejnovější aktualizace, použijte následující postup.</span><span class="sxs-lookup"><span data-stu-id="c4e47-149">In order to use these latest updates in your application, use the following steps.</span></span>

1. <span data-ttu-id="c4e47-150">Otevřete projekt MVC v aplikaci Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c4e47-150">Open your MVC project in Visual Studio.</span></span>
2. <span data-ttu-id="c4e47-151">Klikněte na **nástroje**, potom klikněte na **Správce balíčků NuGet**a pak klikněte na **Konzola správce balíčků**:</span><span class="sxs-lookup"><span data-stu-id="c4e47-151">Click **Tools**, then click **NuGet Package Manager**, and then click **Package Manager Console**:</span></span>

   <span data-ttu-id="c4e47-152">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-152">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-153">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image18.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-153">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image18.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image17.png)</span></span>
3. <span data-ttu-id="c4e47-154">**Konzola správce balíčků** se zobrazí v dolní části sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c4e47-154">The **Package Manager Console** will appear in the bottom section of Visual Studio.</span></span> <span data-ttu-id="c4e47-155">Zadejte &quot;**Update-Package EntityFramework**&quot; a stiskněte klávesu ENTER:</span><span class="sxs-lookup"><span data-stu-id="c4e47-155">Type &quot;**Update-Package EntityFramework**&quot; and press Enter:</span></span>

   <span data-ttu-id="c4e47-156">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-156">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-157">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image20.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-157">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image20.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image19.png)</span></span>

### <a name="install-the-mysql-provider-for-entityframework"></a><span data-ttu-id="c4e47-158">Instalace poskytovatele MySQL pro EntityFramework</span><span class="sxs-lookup"><span data-stu-id="c4e47-158">Install the MySQL provider for EntityFramework</span></span>

<span data-ttu-id="c4e47-159">Aby se EntityFramework připojení k databázi MySQL, je nutné nainstalovat poskytovatele MySQL.</span><span class="sxs-lookup"><span data-stu-id="c4e47-159">In order for EntityFramework to connect to MySQL database, you need to install a MySQL provider.</span></span> <span data-ttu-id="c4e47-160">Provedete to tak, že otevřete **konzolu Správce balíčků** a napíšete &quot;**Install-Package MySQL. data. Entity-pre**&quot;a potom stisknete klávesu ENTER.</span><span class="sxs-lookup"><span data-stu-id="c4e47-160">To do so, open the **Package Manager Console** and type &quot;**Install-Package MySql.Data.Entity -Pre**&quot;, and then press Enter.</span></span>

> [!NOTE]
> <span data-ttu-id="c4e47-161">Toto je předběžná verze sestavení, která by mohla obsahovat chyby.</span><span class="sxs-lookup"><span data-stu-id="c4e47-161">This is a pre-release version of the assembly, and as such it may contain bugs.</span></span> <span data-ttu-id="c4e47-162">V produkčním prostředí byste neměli používat předběžnou verzi zprostředkovatele.</span><span class="sxs-lookup"><span data-stu-id="c4e47-162">You should not use a pre-release version of the provider in production.</span></span>

<span data-ttu-id="c4e47-163">[Kliknutím na následující obrázek ho rozbalte.]</span><span class="sxs-lookup"><span data-stu-id="c4e47-163">[Click the following image to expand it.]</span></span>

[![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image22.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image21.png)

### <a name="making-project-configuration-changes-to-the-webconfig-file-for-your-application"></a><span data-ttu-id="c4e47-164">Provádění změn konfigurace projektu v souboru Web. config pro vaši aplikaci</span><span class="sxs-lookup"><span data-stu-id="c4e47-164">Making project configuration changes to the Web.config file for your application</span></span>

<span data-ttu-id="c4e47-165">V této části nakonfigurujete Entity Framework pro použití poskytovatele MySQL, který jste právě nainstalovali, zaregistrujete továrnu poskytovatele MySQL a přidáte do Azure připojovací řetězec.</span><span class="sxs-lookup"><span data-stu-id="c4e47-165">In this section you will configure the Entity Framework to use the MySQL provider that you just installed, register the MySQL provider factory, and add your connection string from Azure.</span></span>

> [!NOTE]
> <span data-ttu-id="c4e47-166">Následující příklady obsahují specifickou verzi sestavení pro MySql. data. dll.</span><span class="sxs-lookup"><span data-stu-id="c4e47-166">The following examples contain a specific assembly version for MySql.Data.dll.</span></span> <span data-ttu-id="c4e47-167">Pokud se verze sestavení změní, budete muset upravit příslušné konfigurační nastavení se správnou verzí.</span><span class="sxs-lookup"><span data-stu-id="c4e47-167">If the assembly version changes, you will need to modify the appropriate configuration settings with the correct version.</span></span>

1. <span data-ttu-id="c4e47-168">Otevřete soubor Web. config pro váš projekt v Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="c4e47-168">Open the Web.config file for your project in Visual Studio 2013.</span></span>
2. <span data-ttu-id="c4e47-169">Vyhledejte následující nastavení konfigurace, které definuje výchozího zprostředkovatele databáze a továrnu pro Entity Framework:</span><span class="sxs-lookup"><span data-stu-id="c4e47-169">Locate the following configuration settings, which define the default database provider and factory for the Entity Framework:</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample1.xml)]
3. <span data-ttu-id="c4e47-170">Tato nastavení konfigurace nahraďte následujícím nastavením, které nakonfiguruje Entity Framework pro použití poskytovatele MySQL:</span><span class="sxs-lookup"><span data-stu-id="c4e47-170">Replace those configuration settings with the following, which will configure the Entity Framework to use the MySQL provider:</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample2.xml)]
4. <span data-ttu-id="c4e47-171">Vyhledejte část &lt;connectionStrings&gt; a nahraďte ji následujícím kódem, který bude definovat připojovací řetězec pro databázi MySQL hostovanou v Azure (Všimněte si, že hodnota providerName se také změnila z původní):</span><span class="sxs-lookup"><span data-stu-id="c4e47-171">Locate the &lt;connectionStrings&gt; section and replace it with the following code, which will define the connection string for your MySQL database that is hosted on Azure (note that providerName value has also been changed from the original):</span></span>

    [!code-xml[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample3.xml?highlight=3-4)]

### <a name="adding-custom-migrationhistory-context"></a><span data-ttu-id="c4e47-172">Přidání vlastního kontextu MigrationHistory</span><span class="sxs-lookup"><span data-stu-id="c4e47-172">Adding custom MigrationHistory context</span></span>

<span data-ttu-id="c4e47-173">Entity Framework Code First používá tabulku **MigrationHistory** k udržení přehledu o změnách modelu a k zajištění konzistence mezi schématem databáze a koncepčním schématem.</span><span class="sxs-lookup"><span data-stu-id="c4e47-173">Entity Framework Code First uses a **MigrationHistory** table to keep track of model changes and to ensure the consistency between the database schema and conceptual schema.</span></span> <span data-ttu-id="c4e47-174">Tato tabulka ale ve výchozím nastavení pro MySQL nefunguje, protože primární klíč je moc velký.</span><span class="sxs-lookup"><span data-stu-id="c4e47-174">However, this table does not work for MySQL by default because the primary key is too large.</span></span> <span data-ttu-id="c4e47-175">Chcete-li tuto situaci napravit, bude nutné zmenšit velikost klíče pro tuto tabulku.</span><span class="sxs-lookup"><span data-stu-id="c4e47-175">To remedy this situation, you will need to shrink the key size for that table.</span></span> <span data-ttu-id="c4e47-176">Chcete-li tak učinit, proveďte následující kroky:</span><span class="sxs-lookup"><span data-stu-id="c4e47-176">To do so, use the following steps:</span></span>

1. <span data-ttu-id="c4e47-177">Informace o schématu pro tuto tabulku jsou zachyceny v **HistoryContext**, který lze upravit jako jakékoli jiné **DbContext**.</span><span class="sxs-lookup"><span data-stu-id="c4e47-177">The schema information for this table is captured in a **HistoryContext**, which can be modified as any other **DbContext**.</span></span> <span data-ttu-id="c4e47-178">Chcete-li to provést, přidejte do projektu nový soubor třídy s názvem **MySqlHistoryContext.cs** a nahraďte jeho obsah následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="c4e47-178">To do so, add a new class file named **MySqlHistoryContext.cs** to the project, and replace its contents with the following code:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample4.cs)]
2. <span data-ttu-id="c4e47-179">Dále bude nutné nakonfigurovat Entity Framework pro použití upraveného **HistoryContext**namísto výchozího.</span><span class="sxs-lookup"><span data-stu-id="c4e47-179">Next you will need to configure Entity Framework to use the modified **HistoryContext**, rather than default one.</span></span> <span data-ttu-id="c4e47-180">To lze provést pomocí funkcí konfigurace na základě kódu.</span><span class="sxs-lookup"><span data-stu-id="c4e47-180">This can be done by leveraging code-based configuration features.</span></span> <span data-ttu-id="c4e47-181">Provedete to tak, že do svého projektu přidáte nový soubor třídy s názvem **MySqlConfiguration.cs** a nahradíte jeho obsah:</span><span class="sxs-lookup"><span data-stu-id="c4e47-181">To do so, add new class file named **MySqlConfiguration.cs** to your project and replace its contents with:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample5.cs)]

### <a name="creating-a-custom-entityframework-initializer-for-applicationdbcontext"></a><span data-ttu-id="c4e47-182">Vytvoření vlastního inicializátoru EntityFramework pro ApplicationDbContext</span><span class="sxs-lookup"><span data-stu-id="c4e47-182">Creating a custom EntityFramework initializer for ApplicationDbContext</span></span>

<span data-ttu-id="c4e47-183">Poskytovatel MySQL, který je vybraný v tomto kurzu, v současné době nepodporuje Entity Framework migrace, takže budete muset použít inicializátory modelu, aby se mohli připojit k databázi.</span><span class="sxs-lookup"><span data-stu-id="c4e47-183">The MySQL provider that is featured in this tutorial does not currently support Entity Framework migrations, so you will need to use model initializers in order to connect to the database.</span></span> <span data-ttu-id="c4e47-184">Vzhledem k tomu, že tento kurz používá instanci MySQL v Azure, budete muset vytvořit vlastní inicializátor Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="c4e47-184">Because this tutorial is using a MySQL instance on Azure, you will need to create a custom Entity Framework initializer.</span></span>

> [!NOTE]
> <span data-ttu-id="c4e47-185">Tento krok není nutný, pokud se připojujete k instanci SQL Server v Azure nebo používáte databázi, která je hostovaná místně.</span><span class="sxs-lookup"><span data-stu-id="c4e47-185">This step is not required if you are connecting to a SQL Server instance on Azure or if you are using a database that is hosted on premises.</span></span>

<span data-ttu-id="c4e47-186">Chcete-li vytvořit vlastní inicializátor Entity Framework pro MySQL, použijte následující postup:</span><span class="sxs-lookup"><span data-stu-id="c4e47-186">To create a custom Entity Framework initializer for MySQL, use the following steps:</span></span>

1. <span data-ttu-id="c4e47-187">Přidejte do projektu nový soubor třídy s názvem **MySqlInitializer.cs** a nahraďte jeho obsah následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="c4e47-187">Add a new class file named **MySqlInitializer.cs** to the project, and replace it's contents with the following code:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample6.cs?highlight=23)]
2. <span data-ttu-id="c4e47-188">Otevřete soubor **IdentityModels.cs** pro váš projekt, který je umístěn v adresáři **modelů** , a nahraďte jeho obsah následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="c4e47-188">Open the **IdentityModels.cs** file for your project, which is located in the **Models** directory, and replace it's contents with the following:</span></span>

    [!code-csharp[Main](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/samples/sample7.cs)]

## <a name="running-the-application-and-verifying-the-database"></a><span data-ttu-id="c4e47-189">Spuštění aplikace a ověření databáze</span><span class="sxs-lookup"><span data-stu-id="c4e47-189">Running the application and verifying the database</span></span>

<span data-ttu-id="c4e47-190">Po dokončení kroků v předchozích částech byste měli otestovat databázi.</span><span class="sxs-lookup"><span data-stu-id="c4e47-190">Once you have completed the steps in the preceding sections, you should test your database.</span></span> <span data-ttu-id="c4e47-191">Chcete-li tak učinit, proveďte následující kroky:</span><span class="sxs-lookup"><span data-stu-id="c4e47-191">To do so, use the following steps:</span></span>

1. <span data-ttu-id="c4e47-192">Stisknutím **kombinace kláves CTRL + F5** Sestavte a spusťte webovou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="c4e47-192">Press **Ctrl + F5** to build and run the web application.</span></span>
2. <span data-ttu-id="c4e47-193">Klikněte na kartu **registr** v horní části stránky:</span><span class="sxs-lookup"><span data-stu-id="c4e47-193">Click the **Register** tab on the top of the page:</span></span>

   <span data-ttu-id="c4e47-194">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-194">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-195">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.jpg)</span><span class="sxs-lookup"><span data-stu-id="c4e47-195">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image4.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image3.jpg)</span></span>
3. <span data-ttu-id="c4e47-196">Zadejte nové uživatelské jméno a heslo a potom klikněte na **zaregistrovat**:</span><span class="sxs-lookup"><span data-stu-id="c4e47-196">Enter a new user name and password, and then click **Register**:</span></span>

   <span data-ttu-id="c4e47-197">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-197">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-198">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image24.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-198">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image24.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image23.png)</span></span>
4. <span data-ttu-id="c4e47-199">V tomto okamžiku se ASP.NET Identity tabulky vytvoří v databázi MySQL a uživatel je zaregistrován a přihlášen do aplikace:</span><span class="sxs-lookup"><span data-stu-id="c4e47-199">At this point the ASP.NET Identity tables are created on the MySQL Database, and the user is registered and logged into the application:</span></span>

   <span data-ttu-id="c4e47-200">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-200">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-201">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.jpg)</span><span class="sxs-lookup"><span data-stu-id="c4e47-201">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image6.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image5.jpg)</span></span>

### <a name="installing-mysql-workbench-tool-to-verify-the-data"></a><span data-ttu-id="c4e47-202">Probíhá instalace nástroje MySQL Workbench pro ověření dat</span><span class="sxs-lookup"><span data-stu-id="c4e47-202">Installing MySQL Workbench tool to verify the data</span></span>

1. <span data-ttu-id="c4e47-203">Instalace nástroje **MySQL Workbench** ze stránky pro [Stažení souborů MySQL](http://dev.mysql.com/downloads/windows/installer/)</span><span class="sxs-lookup"><span data-stu-id="c4e47-203">Install the **MySQL Workbench** tool from the [MySQL downloads page](http://dev.mysql.com/downloads/windows/installer/)</span></span>
2. <span data-ttu-id="c4e47-204">V Průvodci instalací: karta **Výběr funkce** vyberte **MySQL Workbench** v části **aplikace** .</span><span class="sxs-lookup"><span data-stu-id="c4e47-204">In the installation wizard: **Feature Selection** tab, select **MySQL Workbench** under **applications** section.</span></span>
3. <span data-ttu-id="c4e47-205">Spusťte aplikaci a přidejte nové připojení pomocí dat připojovacího řetězce z databáze Azure MySQL, kterou jste vytvořili v BEGGING tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="c4e47-205">Launch the app and add a new connection using the connection string data from the Azure MySQL database you created at the begging of this tutorial.</span></span>
4. <span data-ttu-id="c4e47-206">Po navázání připojení zkontrolujte **ASP.NET identity** tabulky vytvořené v **IdentityMySQLDatabase.**</span><span class="sxs-lookup"><span data-stu-id="c4e47-206">After establishing the connection, inspect the **ASP.NET Identity** tables created on the **IdentityMySQLDatabase.**</span></span>
5. <span data-ttu-id="c4e47-207">Uvidíte, že jsou vytvořeny všechny ASP.NET Identity požadované tabulky, jak je znázorněno na následujícím obrázku:</span><span class="sxs-lookup"><span data-stu-id="c4e47-207">You will see that all ASP.NET Identity required tables are created as shown in the image below:</span></span>

   <span data-ttu-id="c4e47-208">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-208">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-209">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="c4e47-209">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image8.jpg)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image7.jpg)</span></span>
6. <span data-ttu-id="c4e47-210">Zkontrolujte, jestli je v tabulce **aspnetusers** třeba vyhledat položky při registraci nových uživatelů.</span><span class="sxs-lookup"><span data-stu-id="c4e47-210">Inspect the **aspnetusers** table for instance to check for the entries as you register new users.</span></span>

   <span data-ttu-id="c4e47-211">[Kliknutím na následující obrázek ho rozbalte.</span><span class="sxs-lookup"><span data-stu-id="c4e47-211">[Click the following image to expand it.</span></span> <span data-ttu-id="c4e47-212">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image26.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c4e47-212">] [![](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image26.png)](aspnet-identity-using-mysql-storage-with-an-entityframework-mysql-provider/_static/image25.png)</span></span>
