---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: Přidání ASP.NET Identity do prázdného nebo existujícího projektu webových formulářů – ASP.NET 4. x
author: raquelsa
description: V tomto kurzu se dozvíte, jak přidat ASP.NET Identity (systém členství pro ASP.NET) do aplikace ASP.NET. Při vytváření nových webových formulářů nebo MVC...
ms.author: riande
ms.date: 01/22/2019
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.custom: seoapril2019
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 8e82951d57f0b8052ee3f6530a7470be7d030206
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78584124"
---
# <a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="f8d93-104">Přidání ASP.NET Identity do prázdného nebo stávajícího projektu webových formulářů</span><span class="sxs-lookup"><span data-stu-id="f8d93-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>

> <span data-ttu-id="f8d93-105">V tomto kurzu se dozvíte, jak přidat [ASP.NET identity](introduction-to-aspnet-identity.md) (nový systém členství pro ASP.NET) do aplikace ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f8d93-105">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="f8d93-106">Když vytvoříte nové webové formuláře nebo projekt MVC v aplikaci Visual Studio 2017 RTM s jednotlivými účty, bude Visual Studio instalovat všechny požadované balíčky a přidat všechny potřebné třídy za vás.</span><span class="sxs-lookup"><span data-stu-id="f8d93-106">When you create a new Web Forms or MVC project in Visual Studio 2017 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="f8d93-107">V tomto kurzu se zobrazí postup přidání podpory ASP.NET Identity do vašeho existujícího projektu webových formulářů nebo nového prázdného projektu.</span><span class="sxs-lookup"><span data-stu-id="f8d93-107">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="f8d93-108">Vytvořím osnovu všechny balíčky NuGet, které potřebujete nainstalovat, a třídy, které potřebujete přidat.</span><span class="sxs-lookup"><span data-stu-id="f8d93-108">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="f8d93-109">Přecházím vzorovým webovým formulářem při registraci nových uživatelů a při vypínání všech hlavních rozhraní API vstupních bodů pro správu uživatelů a ověřování.</span><span class="sxs-lookup"><span data-stu-id="f8d93-109">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="f8d93-110">Tato ukázka bude používat výchozí implementaci ASP.NET Identity SQL Data Storage, která je založená na Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="f8d93-110">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="f8d93-111">V tomto kurzu použijeme LocalDB pro SQL Database.</span><span class="sxs-lookup"><span data-stu-id="f8d93-111">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 

## <a name="get-started-with-aspnet-identity"></a><span data-ttu-id="f8d93-112">Začínáme s ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="f8d93-112">Get started with ASP.NET Identity</span></span>

1. <span data-ttu-id="f8d93-113">Začněte instalací a spuštěním sady [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="f8d93-113">Start by installing and running [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/).</span></span>
2. <span data-ttu-id="f8d93-114">Na úvodní stránce vyberte **Nový projekt** , nebo můžete použít nabídku a vybrat **soubor**a pak **Nový projekt**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-114">Select **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="f8d93-115">V levém podokně rozbalte **vizuál C#** , pak vyberte **Web**a pak **ASP.NET webová aplikace (.NET Framework)** .</span><span class="sxs-lookup"><span data-stu-id="f8d93-115">In the left pane, expand **Visual C#**, then select **Web**, then **ASP.NET Web Application (.Net Framework)**.</span></span> <span data-ttu-id="f8d93-116">Pojmenujte projekt "WebFormsIdentity" a vyberte **OK**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-116">Name your project "WebFormsIdentity" and select **OK**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image17.png)
4. <span data-ttu-id="f8d93-117">V dialogovém okně **Nový projekt ASP.NET** vyberte **prázdnou** šablonu.</span><span class="sxs-lookup"><span data-stu-id="f8d93-117">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
   <span data-ttu-id="f8d93-118">Všimněte si, že tlačítko **změnit ověřování** je zakázané a v této šabloně není dostupná žádná podpora ověřování.</span><span class="sxs-lookup"><span data-stu-id="f8d93-118">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="f8d93-119">Webové formuláře, šablony MVC a webové rozhraní API umožňují vybrat přístup pro ověřování.</span><span class="sxs-lookup"><span data-stu-id="f8d93-119">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span>

## <a name="add-identity-packages-to-your-app"></a><span data-ttu-id="f8d93-120">Přidání balíčků identit do aplikace</span><span class="sxs-lookup"><span data-stu-id="f8d93-120">Add Identity packages to your app</span></span>

<span data-ttu-id="f8d93-121">V Průzkumník řešení klikněte pravým tlačítkem myši na projekt a vyberte možnost **Spravovat balíčky NuGet**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-121">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="f8d93-122">Vyhledejte a nainstalujte balíček **Microsoft. ASPNET. identity. EntityFramework** .</span><span class="sxs-lookup"><span data-stu-id="f8d93-122">Search for and install the **Microsoft.AspNet.Identity.EntityFramework** package.</span></span> 
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image15.png)
  
<span data-ttu-id="f8d93-123">Všimněte si, že tento balíček nainstaluje balíčky závislostí: **EntityFramework** a **Microsoft ASP.NET identity Core**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-123">Note that this package will install the dependency packages: **EntityFramework** and **Microsoft ASP.NET Identity Core**.</span></span>

## <a name="add-a-web-form-to-register-users"></a><span data-ttu-id="f8d93-124">Přidání webového formuláře pro registraci uživatelů</span><span class="sxs-lookup"><span data-stu-id="f8d93-124">Add a web form to register users</span></span>

1. <span data-ttu-id="f8d93-125">V **Průzkumník řešení**klikněte pravým tlačítkem myši na projekt a vyberte **Přidat**a pak **webový formulář**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-125">In **Solution Explorer**, right-click your project and select **Add**, and then **Web Form**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="f8d93-126">V dialogovém okně **Zadejte název pro položku** pojmenujte nový **registr**webového formuláře a pak vyberte **OK** .</span><span class="sxs-lookup"><span data-stu-id="f8d93-126">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then select **OK**</span></span>
3. <span data-ttu-id="f8d93-127">Nahraďte značku v generovaném souboru *Register. aspx* následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="f8d93-127">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="f8d93-128">Změny kódu jsou zvýrazněny.</span><span class="sxs-lookup"><span data-stu-id="f8d93-128">The code changes are highlighted.</span></span> 

    [!code-html[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="f8d93-129">Toto je pouze zjednodušená verze souboru *Register. aspx* , která je vytvořena při vytváření nového projektu webových formulářů ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f8d93-129">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="f8d93-130">Výše uvedený kód přidá pole formuláře a tlačítko pro registraci nového uživatele.</span><span class="sxs-lookup"><span data-stu-id="f8d93-130">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="f8d93-131">Otevřete soubor *Register.aspx.cs* a nahraďte obsah souboru následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="f8d93-131">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="f8d93-132">Výše uvedený kód je zjednodušená verze souboru *Register.aspx.cs* , která je vytvořena při vytváření nového projektu webových formulářů ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f8d93-132">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="f8d93-133">Třída *IdentityUser* je výchozí EntityFramework implementací rozhraní *IUser* .</span><span class="sxs-lookup"><span data-stu-id="f8d93-133">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="f8d93-134">Rozhraní *IUser* je minimální rozhraní pro uživatele v ASP.NET identity Core.</span><span class="sxs-lookup"><span data-stu-id="f8d93-134">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="f8d93-135">Třída *UserStore* je výchozí implementací EntityFramework úložiště uživatele.</span><span class="sxs-lookup"><span data-stu-id="f8d93-135">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="f8d93-136">Tato třída implementuje minimální rozhraní ASP.NET Identity Core: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* a *IUserRoleStore*.</span><span class="sxs-lookup"><span data-stu-id="f8d93-136">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="f8d93-137">Třída *UserManager* zpřístupňuje rozhraní API související s uživatelem, které automaticky uloží změny do *UserStore*.</span><span class="sxs-lookup"><span data-stu-id="f8d93-137">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="f8d93-138">Třída *IdentityResult* představuje výsledek operace identity.</span><span class="sxs-lookup"><span data-stu-id="f8d93-138">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="f8d93-139">V **Průzkumník řešení**klikněte pravým tlačítkem myši na projekt a vyberte **Přidat**, **přidejte složku ASP.NET** a pak **\_data aplikace**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-139">In **Solution Explorer**, right-click your project and select **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="f8d93-140">Otevřete soubor *Web. config* a přidejte položku připojovacího řetězce pro databázi, kterou použijeme k uložení informací o uživateli.</span><span class="sxs-lookup"><span data-stu-id="f8d93-140">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="f8d93-141">Databáze bude vytvořena za běhu EntityFramework pro entity identity.</span><span class="sxs-lookup"><span data-stu-id="f8d93-141">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="f8d93-142">Připojovací řetězec je podobný jako ten, který jste vytvořili při vytváření nového projektu webových formulářů.</span><span class="sxs-lookup"><span data-stu-id="f8d93-142">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="f8d93-143">Zvýrazněný kód ukazuje značky, které byste měli přidat:</span><span class="sxs-lookup"><span data-stu-id="f8d93-143">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="f8d93-144">V případě sady Visual Studio 2015 nebo vyšší nahraďte `(localdb)\v11.0` `(localdb)\MSSQLLocalDB` ve svém připojovacím řetězci.</span><span class="sxs-lookup"><span data-stu-id="f8d93-144">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="f8d93-145">V projektu klikněte pravým tlačítkem na soubor *Register. aspx* a vyberte **nastavit jako úvodní stránku**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-145">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="f8d93-146">Stisknutím kombinace kláves CTRL + F5 Sestavte a spusťte webovou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="f8d93-146">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="f8d93-147">Zadejte nové uživatelské jméno a heslo a pak vyberte **zaregistrovat**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-147">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="f8d93-148">ASP.NET Identity podporuje ověřování a v této ukázce můžete ověřit výchozí chování pro validátory uživatelů a hesel, které pocházejí z balíčku identity Core.</span><span class="sxs-lookup"><span data-stu-id="f8d93-148">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="f8d93-149">Výchozí validátor pro uživatele (`UserValidator`) má vlastnost `AllowOnlyAlphanumericUserNames`, která má výchozí hodnotu nastavenou na `true`.</span><span class="sxs-lookup"><span data-stu-id="f8d93-149">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="f8d93-150">Výchozí ověřovací modul pro heslo (`MinimumLengthValidator`) zajišťuje, že heslo má alespoň 6 znaků.</span><span class="sxs-lookup"><span data-stu-id="f8d93-150">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="f8d93-151">Tyto validátory jsou vlastnosti na `UserManager`, které mohou být přepsány, pokud chcete mít vlastní ověření,</span><span class="sxs-lookup"><span data-stu-id="f8d93-151">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verify-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="f8d93-152">Ověření databáze identity LocalDb a tabulek generovaných Entity Framework</span><span class="sxs-lookup"><span data-stu-id="f8d93-152">Verify the LocalDb Identity database and tables generated by Entity Framework</span></span>

1. <span data-ttu-id="f8d93-153">V nabídce **zobrazení** vyberte **Průzkumník serveru**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-153">In the **View** menu, select **Server Explorer**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="f8d93-154">Rozbalte položku **DefaultConnection (WebFormsIdentity)** , rozbalte položku **tabulky**, klikněte pravým tlačítkem myši na položku **AspNetUsers** a vyberte možnost **Zobrazit data tabulky**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-154">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right-click **AspNetUsers** and then select **Show Table Data**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configure-the-application-for-owin-authentication"></a><span data-ttu-id="f8d93-155">Konfigurace aplikace pro ověřování OWIN</span><span class="sxs-lookup"><span data-stu-id="f8d93-155">Configure the application for OWIN authentication</span></span>

<span data-ttu-id="f8d93-156">V tuto chvíli jsme přidali jenom podporu pro vytváření uživatelů.</span><span class="sxs-lookup"><span data-stu-id="f8d93-156">At this point we have only added support for creating users.</span></span> <span data-ttu-id="f8d93-157">Teď vám ukážeme, jak můžeme přidat ověřování pro přihlášení uživatele.</span><span class="sxs-lookup"><span data-stu-id="f8d93-157">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="f8d93-158">ASP.NET Identity používá middleware ověřování Microsoft OWIN pro ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="f8d93-158">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="f8d93-159">Ověřování souborem cookie OWIN je soubor cookie a mechanismus ověřování založený na deklaracích, který může být použit jakýmkoli rozhraním hostovaným v [Owin](https://msdn.microsoft.com/magazine/dn451439.aspx) nebo IIS.</span><span class="sxs-lookup"><span data-stu-id="f8d93-159">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="f8d93-160">V tomto modelu je možné použít stejné ověřovací balíčky v rámci několika platforem, včetně ASP.NET MVC a webových formulářů.</span><span class="sxs-lookup"><span data-stu-id="f8d93-160">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="f8d93-161">Další informace o Katana projektu a o tom, jak spustit middleware v hostiteli nezávislá, najdete v tématu [Začínáme s projektem Katana](https://msdn.microsoft.com/magazine/dn451439.aspx).</span><span class="sxs-lookup"><span data-stu-id="f8d93-161">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="install-authentication-packages-to-your-application"></a><span data-ttu-id="f8d93-162">Instalace ověřovacích balíčků do vaší aplikace</span><span class="sxs-lookup"><span data-stu-id="f8d93-162">Install authentication packages to your application</span></span>

1. <span data-ttu-id="f8d93-163">V Průzkumník řešení klikněte pravým tlačítkem myši na projekt a vyberte možnost **Spravovat balíčky NuGet**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-163">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="f8d93-164">Vyhledejte a nainstalujte balíček ***Microsoft. ASPNET. identity. Owin*** .</span><span class="sxs-lookup"><span data-stu-id="f8d93-164">Search for and install the ***Microsoft.AspNet.Identity.Owin*** package.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image16.png)

2. <span data-ttu-id="f8d93-165">Vyhledejte a nainstalujte balíček ***Microsoft. Owin. Host. SystemWeb*** .</span><span class="sxs-lookup"><span data-stu-id="f8d93-165">Search for and install the ***Microsoft.Owin.Host.SystemWeb*** package.</span></span>

    > [!NOTE]
    > <span data-ttu-id="f8d93-166">Balíček **Microsoft. ASPNET. identity. Owin** obsahuje sadu rozšiřujících tříd OWIN pro správu a konfiguraci middlewaru pro ověřování Owin, které budou využívat ASP.NET identity základní balíčky.</span><span class="sxs-lookup"><span data-stu-id="f8d93-166">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>
    > <span data-ttu-id="f8d93-167">Balíček **Microsoft. Owin. Host. SystemWeb** obsahuje server Owin, který umožňuje, aby se aplikace založené na Owin spouštěly ve službě IIS pomocí kanálu žádosti ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f8d93-167">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="f8d93-168">Další informace najdete [v tématu Owin middleware v integrovaném kanálu služby IIS](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span><span class="sxs-lookup"><span data-stu-id="f8d93-168">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="add-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="f8d93-169">Přidat třídy konfigurace pro spuštění OWIN a ověřování</span><span class="sxs-lookup"><span data-stu-id="f8d93-169">Add OWIN startup and authentication configuration classes</span></span>

1. <span data-ttu-id="f8d93-170">V **Průzkumník řešení**klikněte pravým tlačítkem na projekt, vyberte **Přidat**a pak **přidejte novou položku**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-170">In **Solution Explorer**, right-click your project, select **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="f8d93-171">Do textového pole Hledat zadejte "*Owin*".</span><span class="sxs-lookup"><span data-stu-id="f8d93-171">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="f8d93-172">Pojmenujte třídu "*Startup*" a vyberte **Přidat**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-172">Name the class "*Startup*" and select **Add**.</span></span> 
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="f8d93-173">V souboru Startup.cs přidejte zvýrazněný kód, který je zobrazen níže, a nakonfigurujte ověřování souborů cookie OWIN.</span><span class="sxs-lookup"><span data-stu-id="f8d93-173">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="f8d93-174">Tato třída obsahuje atribut `OwinStartup` pro zadání spouštěcí třídy OWIN.</span><span class="sxs-lookup"><span data-stu-id="f8d93-174">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="f8d93-175">Každá aplikace OWIN má spouštěcí třídu, kde zadáte komponenty pro kanál aplikace.</span><span class="sxs-lookup"><span data-stu-id="f8d93-175">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="f8d93-176">Další informace o tomto modelu naleznete v tématu [Owin Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) .</span><span class="sxs-lookup"><span data-stu-id="f8d93-176">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="add-web-forms-for-registering-and-signing-in-users"></a><span data-ttu-id="f8d93-177">Přidat webové formuláře pro registraci a přihlašování uživatelů</span><span class="sxs-lookup"><span data-stu-id="f8d93-177">Add web forms for registering and signing in users</span></span>

1. <span data-ttu-id="f8d93-178">Otevřete soubor *Register.aspx.cs* a přidejte následující kód, který se přihlásí uživateli, když se registrace podaří.</span><span class="sxs-lookup"><span data-stu-id="f8d93-178">Open the *Register.aspx.cs* file and add the following code which signs in the user when registration succeeds.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="f8d93-179">Vzhledem k tomu, že ASP.NET Identity a ověřování souborů cookie OWIN jsou systémy založené na deklaracích, rozhraní vyžaduje, aby vývojář aplikace vygeneroval pro uživatele [hodnota ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) .</span><span class="sxs-lookup"><span data-stu-id="f8d93-179">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="f8d93-180">Hodnota ClaimsIdentity obsahuje informace o všech deklaracích pro uživatele, například o tom, k jakým rolím uživatel patří.</span><span class="sxs-lookup"><span data-stu-id="f8d93-180">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="f8d93-181">V této fázi můžete také přidat další deklarace identity pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="f8d93-181">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="f8d93-182">Uživatele se můžete přihlásit pomocí Správce AuthenticationManager z OWIN a voláním `SignIn` a předáním v hodnota ClaimsIdentity, jak je uvedeno výše.</span><span class="sxs-lookup"><span data-stu-id="f8d93-182">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="f8d93-183">Tento kód se přihlásí uživateli a vygeneruje také soubor cookie.</span><span class="sxs-lookup"><span data-stu-id="f8d93-183">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="f8d93-184">Toto volání je analogické jako [FormAuthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) , které používá modul [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="f8d93-184">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="f8d93-185">V **Průzkumník řešení**klikněte pravým tlačítkem myši na projekt, vyberte možnost **Přidat**a potom **webový formulář**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-185">In **Solution Explorer**, right-click your project, select **Add**, and then **Web Form**.</span></span> <span data-ttu-id="f8d93-186">Pojmenujte **přihlašovací**jméno webového formuláře.</span><span class="sxs-lookup"><span data-stu-id="f8d93-186">Name the web form **Login**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="f8d93-187">Obsah souboru *Login. aspx* nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="f8d93-187">Replace the contents of the *Login.aspx* file with the following code:</span></span>

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="f8d93-188">Obsah souboru *Login.aspx.cs* nahraďte následujícím:</span><span class="sxs-lookup"><span data-stu-id="f8d93-188">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="f8d93-189">`Page_Load` nyní kontroluje stav aktuálního uživatele a provede akci na základě jeho stavu `Context.User.Identity.IsAuthenticated`.</span><span class="sxs-lookup"><span data-stu-id="f8d93-189">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>
    >   <span data-ttu-id="f8d93-190">**Zobrazit přihlášené uživatelské jméno** : rozhraní Microsoft ASP.NET identity Framework přidalo rozšiřující metody do [System. Security. Principal. IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) , které vám umožní získat `UserName` a `UserId` pro přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="f8d93-190">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="f8d93-191">Tyto metody rozšíření jsou definovány v sestavení `Microsoft.AspNet.Identity.Core`.</span><span class="sxs-lookup"><span data-stu-id="f8d93-191">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="f8d93-192">Tyto metody rozšíření jsou náhradou pro [HttpContext.User.identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span><span class="sxs-lookup"><span data-stu-id="f8d93-192">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="f8d93-193">Metoda přihlašování: metoda `This` nahrazuje předchozí metodu `CreateUser_Click` v této ukázce a uživatel se po úspěšném vytvoření uživatele přihlásí.</span><span class="sxs-lookup"><span data-stu-id="f8d93-193">SignIn method: `This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >   <span data-ttu-id="f8d93-194">Rozhraní Microsoft OWIN Framework přidalo do `System.Web.HttpContext` rozšiřující metody, které vám umožní získat odkaz na `IOwinContext`.</span><span class="sxs-lookup"><span data-stu-id="f8d93-194">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="f8d93-195">Tyto metody rozšíření jsou definovány v `Microsoft.Owin.Host.SystemWeb` sestavení.</span><span class="sxs-lookup"><span data-stu-id="f8d93-195">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="f8d93-196">Třída `OwinContext` zpřístupňuje vlastnost `IAuthenticationManager`, která představuje funkce middlewaru ověřování, která je k dispozici v aktuální žádosti.</span><span class="sxs-lookup"><span data-stu-id="f8d93-196">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span> <span data-ttu-id="f8d93-197">Uživatele se můžete přihlásit pomocí `AuthenticationManager` z OWIN a voláním `SignIn` a předáním do `ClaimsIdentity`, jak je uvedeno výše.</span><span class="sxs-lookup"><span data-stu-id="f8d93-197">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn` and passing in the `ClaimsIdentity` as shown above.</span></span> <span data-ttu-id="f8d93-198">Vzhledem k tomu, že ověřování souborů cookie ASP.NET Identity a OWIN jsou systémy založené na deklaracích, rozhraní vyžaduje, aby aplikace vygenerovala `ClaimsIdentity` pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="f8d93-198">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span> <span data-ttu-id="f8d93-199">`ClaimsIdentity` obsahuje informace o všech deklaracích pro uživatele, například o tom, k jakým rolím uživatel patří.</span><span class="sxs-lookup"><span data-stu-id="f8d93-199">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="f8d93-200">V této fázi můžete také přidat další deklarace identity pro uživatele, tento kód se přihlásí uživateli a vygeneruje také soubor cookie.</span><span class="sxs-lookup"><span data-stu-id="f8d93-200">You can also add more claims for the user at this stage This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="f8d93-201">Toto volání je analogické jako [FormAuthentication. SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) , které používá modul [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="f8d93-201">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="f8d93-202">`SignOut` metoda: Získá odkaz na `AuthenticationManager` z OWIN a zavolá `SignOut`.</span><span class="sxs-lookup"><span data-stu-id="f8d93-202">`SignOut` method: Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="f8d93-203">To je obdobou metodě [FormsAuthentication. Signing](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) , kterou používá modul [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) .</span><span class="sxs-lookup"><span data-stu-id="f8d93-203">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="f8d93-204">Stisknutím **kombinace kláves CTRL + F5** Sestavte a spusťte webovou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="f8d93-204">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="f8d93-205">Zadejte nové uživatelské jméno a heslo a pak vyberte **zaregistrovat**.</span><span class="sxs-lookup"><span data-stu-id="f8d93-205">Enter a new user name and password and then select **Register**.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
   <span data-ttu-id="f8d93-206">Poznámka: v tomto okamžiku se vytvoří a přihlásí nový uživatel.</span><span class="sxs-lookup"><span data-stu-id="f8d93-206">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="f8d93-207">Vyberte tlačítko **Odhlásit** se.</span><span class="sxs-lookup"><span data-stu-id="f8d93-207">Select the **Log out** button.</span></span> <span data-ttu-id="f8d93-208">Budete přesměrováni do formuláře přihlášení.</span><span class="sxs-lookup"><span data-stu-id="f8d93-208">You are redirected to the Log in form.</span></span>
7. <span data-ttu-id="f8d93-209">Zadejte neplatné uživatelské jméno nebo heslo a klikněte na tlačítko **Přihlásit** se.</span><span class="sxs-lookup"><span data-stu-id="f8d93-209">Enter an invalid user name or password and select the **Log in** button.</span></span> 
   <span data-ttu-id="f8d93-210">Metoda `UserManager.Find` vrátí hodnotu null a zobrazí se chybová zpráva: " *neplatné uživatelské jméno nebo heslo* ".</span><span class="sxs-lookup"><span data-stu-id="f8d93-210">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
