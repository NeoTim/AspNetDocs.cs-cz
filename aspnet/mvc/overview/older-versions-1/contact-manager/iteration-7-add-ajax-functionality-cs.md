---
uid: mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
title: 'Iterace #7 – Přidat funkci Ajax (C#) | Dokumenty společnosti Microsoft'
author: rick-anderson
description: V sedmé iteraci zlepšujeme odezvu a výkon naší aplikace přidáním podpory pro Ajax.
ms.author: riande
ms.date: 02/20/2009
ms.assetid: f1b0809e-8909-444e-b6bb-a5cd1dea3f72
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-cs
msc.type: authoredcontent
ms.openlocfilehash: 12d7348382bc55af049567922bd6963970a9421b
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/17/2020
ms.locfileid: "81542310"
---
# <a name="iteration-7--add-ajax-functionality-c"></a><span data-ttu-id="b3bdb-103">Iterace č. 7– přidání funkcí Ajax (C#)</span><span class="sxs-lookup"><span data-stu-id="b3bdb-103">Iteration #7 – Add Ajax functionality (C#)</span></span>

<span data-ttu-id="b3bdb-104">podle [společnosti Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="b3bdb-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="b3bdb-105">Stáhnout kód</span><span class="sxs-lookup"><span data-stu-id="b3bdb-105">Download Code</span></span>](iteration-7-add-ajax-functionality-cs/_static/contactmanager_7_cs1.zip)

> <span data-ttu-id="b3bdb-106">V sedmé iteraci zlepšujeme odezvu a výkon naší aplikace přidáním podpory pro Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-106">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="b3bdb-107">Vytvoření aplikace pro správu kontaktů ASP.NET MVC (C#)</span><span class="sxs-lookup"><span data-stu-id="b3bdb-107">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="b3bdb-108">V této sérii kurzů vytvoříme celou aplikaci pro správu kontaktů od začátku do konce.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-108">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="b3bdb-109">Aplikace Contact Manager umožňuje ukládat kontaktní informace - jména, telefonní čísla a e-mailové adresy - pro seznam osob.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-109">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="b3bdb-110">Vytvoříme aplikaci přes více iterací.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-110">We build the application over multiple iterations.</span></span> <span data-ttu-id="b3bdb-111">S každou iterací postupně vylepšujeme aplikaci.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-111">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="b3bdb-112">Cílem tohoto přístupu více iterace je umožnit pochopit důvod pro každou změnu.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-112">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="b3bdb-113">Iterace #1 - Vytvořte aplikaci.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-113">Iteration #1 - Create the application.</span></span> <span data-ttu-id="b3bdb-114">V první iteraci vytvoříme Správce kontaktů nejjednodušším možným způsobem.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-114">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="b3bdb-115">Přidáváme podporu pro základní databázové operace: Vytvořit, Číst, Aktualizovat a odstranit (CRUD).</span><span class="sxs-lookup"><span data-stu-id="b3bdb-115">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="b3bdb-116">Iterace #2 - Make aplikace vypadat hezky.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-116">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="b3bdb-117">V této iteraci vylepšujeme vzhled aplikace úpravou výchozí ASP.NET stránku předlohy zobrazení MVC a kaskádovou šablonu stylů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-117">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="b3bdb-118">#3 iterace – přidejte ověření formuláře.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-118">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="b3bdb-119">Ve třetí iteraci přidáme ověření základního formuláře.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-119">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="b3bdb-120">Bráníme uživatelům v odesílání formuláře bez vyplnění požadovaných polí formuláře.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-120">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="b3bdb-121">Ověřujeme také e-mailové adresy a telefonní čísla.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-121">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="b3bdb-122">Iterace #4 - Proveďte aplikaci volně spojená.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-122">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="b3bdb-123">V této čtvrté iteraci využíváme několik vzorů návrhu softwaru, abychom usnadnili údržbu a úpravu aplikace Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-123">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="b3bdb-124">Například refaktorujeme naši aplikaci tak, aby používala vzor úložiště a vzor vkládání závislostí.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-124">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="b3bdb-125">Iterace #5 - vytvořit testy částí.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-125">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="b3bdb-126">V páté iteraci usnadňujeme údržbu a úpravy naší aplikace přidáním testů částí.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-126">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="b3bdb-127">Zesměšňujeme naše třídy datových modelů a vytváříme testy částí pro naše řadiče a logiku ověřování.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-127">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="b3bdb-128">Iterace #6 – použijte vývoj řízený testem.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-128">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="b3bdb-129">V této šesté iteraci přidáme nové funkce do naší aplikace zápisem testů částí první a psaní kódu proti testování částí.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-129">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="b3bdb-130">V této iteraci přidáme skupiny kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-130">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="b3bdb-131">Iterace #7 - Přidat funkci Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-131">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="b3bdb-132">V sedmé iteraci zlepšujeme odezvu a výkon naší aplikace přidáním podpory pro Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-132">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="b3bdb-133">Tato iterace</span><span class="sxs-lookup"><span data-stu-id="b3bdb-133">This Iteration</span></span>

<span data-ttu-id="b3bdb-134">V této iteraci aplikace Contact Manager refaktorujeme naši aplikaci, abychom využili Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-134">In this iteration of the Contact Manager application, we refactor our application to make use of Ajax.</span></span> <span data-ttu-id="b3bdb-135">Využitím Ajaxu, děláme naše aplikace citlivější.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-135">By taking advantage of Ajax, we make our application more responsive.</span></span> <span data-ttu-id="b3bdb-136">Můžeme se vyhnout vykreslování celé stránky, když potřebujeme aktualizovat pouze určitou oblast na stránce.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-136">We can avoid rendering an entire page when we need to update only a certain region in a page.</span></span>

<span data-ttu-id="b3bdb-137">Refaktorujeme zobrazení indexu tak, abychom nemuseli znovu zobrazovat celou stránku, kdykoli někdo vybere novou skupinu kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-137">We'll refactor our Index view so that we don t need to redisplay the entire page whenever someone selects a new contact group.</span></span> <span data-ttu-id="b3bdb-138">Místo toho, když někdo klikne na skupinu kontaktů, aktualizujeme seznam kontaktů a zbytek stránky necháme na pokoji.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-138">Instead, when someone clicks a contact group, we'll just update the list of contacts and leave the rest of the page alone.</span></span>

<span data-ttu-id="b3bdb-139">Změníme také způsob, jakým náš odkaz na odstranění funguje.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-139">We'll also change the way our delete link works.</span></span> <span data-ttu-id="b3bdb-140">Místo zobrazení samostatné potvrzovací stránky zobrazíme potvrzovací dialog JavaScriptu.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-140">Instead of displaying a separate confirmation page, we'll display a JavaScript confirmation dialog.</span></span> <span data-ttu-id="b3bdb-141">Pokud potvrdíte, že chcete odstranit kontakt, operace HTTP DELETE se provádí proti serveru odstranit záznam kontaktu z databáze.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-141">If you confirm that you want to delete a contact, an HTTP DELETE operation is performed against the server to delete the contact record from the database.</span></span>

<span data-ttu-id="b3bdb-142">Kromě toho budeme využívat jQuery přidat animační efekty do našeho zobrazení indexu.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-142">Furthermore, we will take advantage of jQuery to add animation effects to our Index view.</span></span> <span data-ttu-id="b3bdb-143">Při načítání nového seznamu kontaktů ze serveru zobrazíme animaci.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-143">We'll display an animation when the new list of contacts is being fetched from the server.</span></span>

<span data-ttu-id="b3bdb-144">Nakonec budeme využívat ASP.NET podporu rámce AJAX pro správu historie prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-144">Finally, we'll take advantage of the ASP.NET AJAX framework support for managing browser history.</span></span> <span data-ttu-id="b3bdb-145">Body historie vytvoříme vždy, když provedeme volání Ajaxu k aktualizaci seznamu kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-145">We'll create history points whenever we perform an Ajax call to update the contact list.</span></span> <span data-ttu-id="b3bdb-146">Tímto způsobem budou fungovat tlačítka prohlížeče vzad a vpřed.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-146">That way, the browser backward and forward buttons will work.</span></span>

## <a name="why-use-ajax"></a><span data-ttu-id="b3bdb-147">Proč použít Ajax?</span><span class="sxs-lookup"><span data-stu-id="b3bdb-147">Why use Ajax?</span></span>

<span data-ttu-id="b3bdb-148">Použití Ajax má mnoho výhod.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-148">Using Ajax has many benefits.</span></span> <span data-ttu-id="b3bdb-149">Za prvé, přidání funkce Ajax do aplikace má za následek lepší uživatelské zkušenosti.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-149">First, adding Ajax functionality to an application results in a better user experience.</span></span> <span data-ttu-id="b3bdb-150">V normální webové aplikaci musí být celá stránka zaúčtována zpět na server pokaždé, když uživatel provede akci.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-150">In a normal web application, the entire page must be posted back to the server each and every time a user performs an action.</span></span> <span data-ttu-id="b3bdb-151">Kdykoli provedete akci, prohlížeč uzamkne a uživatel musí počkat, dokud se načte a znovu zobrazí celá stránka.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-151">Whenever you perform an action, the browser locks and the user must wait until the entire page is fetched and redisplayed.</span></span>

<span data-ttu-id="b3bdb-152">To by bylo nepřijatelné zkušenosti v případě desktopové aplikace.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-152">This would be an unacceptable experience in the case of a desktop application.</span></span> <span data-ttu-id="b3bdb-153">Ale tradičně jsme žili s touto špatnou uživatelskou zkušeností v případě webové aplikace, protože jsme nevěděli, že bychom mohli udělat něco lepšího.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-153">But, traditionally, we lived with this bad user experience in the case of a web application because we did not know that we could do any better.</span></span> <span data-ttu-id="b3bdb-154">Mysleli jsme, že je to omezení webových aplikací, když ve skutečnosti to bylo jen omezení naší představivosti.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-154">We thought it was a limitation of web applications when, in actuality, it was just a limitation of our imaginations.</span></span>

<span data-ttu-id="b3bdb-155">V aplikaci Ajax, nemusíte přinést uživatelské zkušenosti zastavit jen aktualizovat stránku.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-155">In an Ajax application, you don t need to bring the user experience to a halt just to update a page.</span></span> <span data-ttu-id="b3bdb-156">Místo toho můžete provést asynchronní požadavek na pozadí aktualizovat stránku.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-156">Instead, you can perform an asynchronous request in the background to update the page.</span></span> <span data-ttu-id="b3bdb-157">Nenutíte uživatele čekat, zatímco část stránky se aktualizuje.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-157">You don t force the user to wait while part of the page gets updated.</span></span>

<span data-ttu-id="b3bdb-158">Využitím Ajax, můžete také zlepšit výkon vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-158">By taking advantage of Ajax, you also can improve the performance of your application.</span></span> <span data-ttu-id="b3bdb-159">Zvažte, jak aplikace Contact Manager funguje právě teď bez funkce Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-159">Consider how the Contact Manager application works right now without Ajax functionality.</span></span> <span data-ttu-id="b3bdb-160">Po kliknutí na skupinu kontaktů musí být znovu zobrazeno celé zobrazení rejstříku.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-160">When you click a contact group, the entire Index view must be redisplayed.</span></span> <span data-ttu-id="b3bdb-161">Seznam kontaktů a seznam skupin kontaktů musí být načten z databázového serveru.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-161">The list of contacts and list of contact groups must be retrieved from the database server.</span></span> <span data-ttu-id="b3bdb-162">Všechna tato data musí být předána přes drát z webového serveru do webového prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-162">All of this data must be passed across the wire from web server to web browser.</span></span>

<span data-ttu-id="b3bdb-163">Poté, co přidáme funkce Ajax do naší aplikace, se však můžeme vyhnout opětovnému zobrazení celé stránky, když uživatel klikne na skupinu kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-163">After we add Ajax functionality to our application, however, we can avoid redisplaying the entire page when a user clicks a contact group.</span></span> <span data-ttu-id="b3bdb-164">Už nepotřebujeme, abychom z databáze brali kontaktní skupiny.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-164">We no longer need to grab the contact groups from the database.</span></span> <span data-ttu-id="b3bdb-165">Také nemusíme tlačit celý index pohled přes drát.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-165">We also don t need to push the entire Index view across the wire.</span></span> <span data-ttu-id="b3bdb-166">Využitím Ajaxu snižujeme množství práce, kterou musí náš databázový server vykonávat, a snižujeme množství síťového provozu vyžadovaného naší aplikací.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-166">By taking advantage of Ajax, we reduce the amount of work that our database server must perform and we reduce the amount of network traffic required by our application.</span></span>

## <a name="don-t-be-afraid-of-ajax"></a><span data-ttu-id="b3bdb-167">Nebojte se Ajaxu</span><span class="sxs-lookup"><span data-stu-id="b3bdb-167">Don t be Afraid of Ajax</span></span>

<span data-ttu-id="b3bdb-168">Někteří vývojáři se vyhýbají používání Ajaxu, protože se obávají o prohlížeče nižší úrovně.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-168">Some developers avoid using Ajax because they worry about downlevel browsers.</span></span> <span data-ttu-id="b3bdb-169">Chtějí se ujistit, že jejich webové aplikace budou i nadále fungovat při přístupu prohlížeče, který nepodporuje JavaScript.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-169">They want to make sure that their web applications will still work when accessed by a browser that does not support JavaScript.</span></span> <span data-ttu-id="b3bdb-170">Vzhledem k tomu, Ajax závisí na JavaScriptu, někteří vývojáři se vyhýbají použití Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-170">Because Ajax depends on JavaScript, some developers avoid using Ajax.</span></span>

<span data-ttu-id="b3bdb-171">Nicméně, pokud jste opatrní, jak implementovat Ajax pak můžete vytvářet aplikace, které pracují s oběma vyšší úrovni a nižší úrovni prohlížečů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-171">However, if you are careful about how you implement Ajax then you can build applications that work with both uplevel and downlevel browsers.</span></span> <span data-ttu-id="b3bdb-172">Naše aplikace Contact Manager bude pracovat s prohlížeči, které podporují JavaScript a prohlížeče, které nemají.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-172">Our Contact Manager application will work with browsers that support JavaScript and browsers that do not.</span></span>

<span data-ttu-id="b3bdb-173">Pokud používáte aplikaci Contact Manager s prohlížečem, který podporuje JavaScript, pak budete mít lepší uživatelské prostředí.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-173">If you use the Contact Manager application with a browser that supports JavaScript then you will have a better user experience.</span></span> <span data-ttu-id="b3bdb-174">Pokud například klepnete na skupinu kontaktů, bude aktualizována pouze oblast stránky, která zobrazuje kontakty.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-174">For example, when you click a contact group, only the region of the page that displays contacts will be updated.</span></span>

<span data-ttu-id="b3bdb-175">Pokud na druhou stranu používáte aplikaci Contact Manager s prohlížečem, který nepodporuje JavaScript (nebo který má vypnutý JavaScript), pak budete mít o něco méně žádoucí uživatelské zkušenosti.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-175">If, on the other hand, you use the Contact Manager application with a browser that does not support JavaScript (or that has JavaScript disabled) then you will have a slightly less desirable user experience.</span></span> <span data-ttu-id="b3bdb-176">Pokud například klepnete na skupinu kontaktů, musí být celé zobrazení rejstříku zaúčtováno zpět do prohlížeče, aby se zobrazil odpovídající seznam kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-176">For example, when you click a contact group, the entire Index view must be posted back to the browser in order to display the matching list of contacts.</span></span>

## <a name="adding-the-required-javascript-files"></a><span data-ttu-id="b3bdb-177">Přidání požadovaných souborů JavaScriptu</span><span class="sxs-lookup"><span data-stu-id="b3bdb-177">Adding the Required JavaScript Files</span></span>

<span data-ttu-id="b3bdb-178">Budeme muset použít tři soubory JavaScript přidat Ajax funkce do naší aplikace.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-178">We'll need to use three JavaScript files to add Ajax functionality to our application.</span></span> <span data-ttu-id="b3bdb-179">Všechny tři tyto soubory jsou zahrnuty do složky Skripty nové aplikace ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-179">All three of these files are included in the Scripts folder of a new ASP.NET MVC application.</span></span>

<span data-ttu-id="b3bdb-180">Pokud máte v plánu použít Ajax ve více stránkách ve vaší aplikaci, pak má smysl zahrnout požadované soubory JavaScript u vaší aplikace s zobrazení stránky předlohy.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-180">If you plan to use Ajax in multiple pages in your application then it makes sense to include the required JavaScript files in your application s view master page.</span></span> <span data-ttu-id="b3bdb-181">Tímto způsobem budou soubory JavaScriptu automaticky zahrnuty do všech stránek ve vaší aplikaci.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-181">That way, the JavaScript files will be included in all of the pages in your application automatically.</span></span>

<span data-ttu-id="b3bdb-182">Přidejte následující javascript, &lt;&gt; který obsahuje, do značky hlavy stránky předlohy zobrazení:</span><span class="sxs-lookup"><span data-stu-id="b3bdb-182">Add the following JavaScript includes inside the &lt;head&gt; tag of your view master page:</span></span>

[!code-html[Main](iteration-7-add-ajax-functionality-cs/samples/sample1.html)]

## <a name="refactoring-the-index-view-to-use-ajax"></a><span data-ttu-id="b3bdb-183">Refaktoring zobrazení indexu používat Ajax</span><span class="sxs-lookup"><span data-stu-id="b3bdb-183">Refactoring the Index View to use Ajax</span></span>

<span data-ttu-id="b3bdb-184">Umožňuje začít úpravou zobrazení rejstříku tak, aby kliknutí na skupinu kontaktů pouze aktualizuje oblast zobrazení, které zobrazuje kontakty.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-184">Let s start by modifying our Index view so that clicking a contact group only updates the region of the view that displays contacts.</span></span> <span data-ttu-id="b3bdb-185">Červené pole na obrázku 1 obsahuje oblast, kterou chceme aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-185">The red box in Figure 1 contains the region that we want to update.</span></span>

<span data-ttu-id="b3bdb-186">[![Aktualizace pouze kontaktů](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b3bdb-186">[![Updating only contacts](iteration-7-add-ajax-functionality-cs/_static/image1.jpg)](iteration-7-add-ajax-functionality-cs/_static/image1.png)</span></span>

<span data-ttu-id="b3bdb-187">**Obrázek 01**: Aktualizace pouze[kontaktů(Kliknutím zobrazíte obrázek v plné velikosti)](iteration-7-add-ajax-functionality-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="b3bdb-187">**Figure 01**: Updating only contacts([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image2.png))</span></span>

<span data-ttu-id="b3bdb-188">Prvním krokem je oddělit část zobrazení, které chceme aktualizovat asynchronně do samostatné částečné (zobrazit uživatelský ovládací prvek).</span><span class="sxs-lookup"><span data-stu-id="b3bdb-188">The first step is to separate the part of the view that we want to update asynchronously into a separate partial (view user control).</span></span> <span data-ttu-id="b3bdb-189">Část zobrazení Rejstřík, která zobrazuje tabulku kontaktů, byla přesunuta do části Částečné v seznamu 1.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-189">The section of the Index view that displays the table of contacts has been moved into the partial in Listing 1.</span></span>

<span data-ttu-id="b3bdb-190">**Výpis 1 - Zobrazení\Kontakt\ContactList.ascx**</span><span class="sxs-lookup"><span data-stu-id="b3bdb-190">**Listing 1 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample2.aspx)]

<span data-ttu-id="b3bdb-191">Všimněte si, že částečné v Listing 1 má jiný model než zobrazení indexu.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-191">Notice that the partial in Listing 1 has a different model than the Index view.</span></span> <span data-ttu-id="b3bdb-192">Atribut *Inherits* ve &lt;směrnici %@ Page %&gt; určuje, že částečné&lt;dědí z třídy ViewUserControl Group.&gt;</span><span class="sxs-lookup"><span data-stu-id="b3bdb-192">The *Inherits* attribute in the &lt;%@ Page %&gt; directive specifies that the partial inherits from the ViewUserControl&lt;Group&gt; class.</span></span>

<span data-ttu-id="b3bdb-193">Aktualizované zobrazení indexu je obsaženo v seznamu 2.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-193">The updated Index view is contained in Listing 2.</span></span>

<span data-ttu-id="b3bdb-194">**Výpis 2 - Zobrazení\Kontakt\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="b3bdb-194">**Listing 2 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample3.aspx)]

<span data-ttu-id="b3bdb-195">Existují dvě věci, které byste si měli všimnout aktualizovaného zobrazení v seznamu 2.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-195">There are two things that you should notice about the updated view in Listing 2.</span></span> <span data-ttu-id="b3bdb-196">Nejprve všimněte si, že veškerý obsah přesunutdo částečné je nahrazen volání Html.RenderPartial().</span><span class="sxs-lookup"><span data-stu-id="b3bdb-196">First, notice that all of the content moved into the partial is replaced with a call to Html.RenderPartial().</span></span> <span data-ttu-id="b3bdb-197">Metoda Html.RenderPartial() je volána při prvním požadavku na zobrazení indexu za účelem zobrazení počáteční sady kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-197">The Html.RenderPartial() method is called when the Index view is first requested in order to display the initial set of contacts.</span></span>

<span data-ttu-id="b3bdb-198">Za druhé, všimněte si, že Html.ActionLink() slouží k zobrazení skupiny kontaktů byl nahrazen Ajax.ActionLink().</span><span class="sxs-lookup"><span data-stu-id="b3bdb-198">Second, notice that the Html.ActionLink() used to display contact groups has been replaced with an Ajax.ActionLink().</span></span> <span data-ttu-id="b3bdb-199">Ajax.ActionLink() se nazývá s následujícími parametry:</span><span class="sxs-lookup"><span data-stu-id="b3bdb-199">The Ajax.ActionLink() is called with the following parameters:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample4.aspx)]

<span data-ttu-id="b3bdb-200">První parametr představuje text, který se má zobrazit pro propojení, druhý parametr představuje hodnoty trasy a třetí parametr představuje možnosti Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-200">The first parameter represents the text to display for the link, the second parameter represents the route values, and the third parameter represents the Ajax options.</span></span> <span data-ttu-id="b3bdb-201">V tomto případě použijeme UpdateTargetId Ajax možnost &lt;přejděte na značku HTML div,&gt; které chceme aktualizovat po dokončení požadavku Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-201">In this case, we use the UpdateTargetId Ajax option to point to the HTML &lt;div&gt; tag that we want to update after the Ajax request completes.</span></span> <span data-ttu-id="b3bdb-202">Chceme aktualizovat &lt;značku&gt; div s novým seznamem kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-202">We want to update the &lt;div&gt; tag with the new list of contacts.</span></span>

<span data-ttu-id="b3bdb-203">Aktualizovaná metoda Index() řadiče kontaktu je obsažena v výpisu 3.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-203">The updated Index() method of the Contact controller is contained in Listing 3.</span></span>

<span data-ttu-id="b3bdb-204">**Výpis 3 - Řadiče\ContactController.cs (Metoda indexu)**</span><span class="sxs-lookup"><span data-stu-id="b3bdb-204">**Listing 3 - Controllers\ContactController.cs (Index method)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample5.cs)]

<span data-ttu-id="b3bdb-205">Aktualizovaná akce Index() podmíněně vrátí jednu ze dvou věcí.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-205">The updated Index() action conditionally returns one of two things.</span></span> <span data-ttu-id="b3bdb-206">Pokud index() akce je vyvolána požadavek Ajax pak řadič vrátí částečné.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-206">If the Index() action is invoked by an Ajax request then the controller returns a partial.</span></span> <span data-ttu-id="b3bdb-207">V opačném případě vrátí akce Index() celé zobrazení.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-207">Otherwise, the Index() action returns an entire view.</span></span>

<span data-ttu-id="b3bdb-208">Všimněte si, že akce Index() není nutné vrátit tolik dat při vyvolání požadavek Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-208">Notice that the Index() action does not need to return as much data when invoked by an Ajax request.</span></span> <span data-ttu-id="b3bdb-209">V kontextu normálního požadavku vrátí akce Index seznam všech skupin kontaktů a vybrané skupiny kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-209">In the context of a normal request, the Index action returns a list of all of the contact groups and the selected contact group.</span></span> <span data-ttu-id="b3bdb-210">V kontextu požadavku Ajax akce Index() vrátí pouze vybranou skupinu.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-210">In the context of an Ajax request, the Index() action returns only the selected group.</span></span> <span data-ttu-id="b3bdb-211">Ajax znamená méně práce na databázovém serveru.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-211">Ajax means less work on your database server.</span></span>

<span data-ttu-id="b3bdb-212">Naše upravené zobrazení indexu funguje v případě prohlížečů vyšší i nižší úrovně.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-212">Our modified Index view works in the case of both uplevel and downlevel browsers.</span></span> <span data-ttu-id="b3bdb-213">Pokud klepnete na skupinu kontaktů a prohlížeč podporuje JavaScript, aktualizuje se pouze oblast zobrazení, která obsahuje seznam kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-213">If you click a contact group, and your browser supports JavaScript, then only the region of the view that contains the list of contacts is updated.</span></span> <span data-ttu-id="b3bdb-214">Pokud na druhou stranu váš prohlížeč nepodporuje JavaScript, bude aktualizováno celé zobrazení.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-214">If, on the other hand, your browser does not support JavaScript, then the entire view is updated.</span></span>

<span data-ttu-id="b3bdb-215">Naše aktualizované zobrazení indexu má jeden problém.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-215">Our updated Index view has one problem.</span></span> <span data-ttu-id="b3bdb-216">Když kliknete na skupinu kontaktů, vybraná skupina se nezvýrazní.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-216">When you click a contact group, the selected group is not highlighted.</span></span> <span data-ttu-id="b3bdb-217">Vzhledem k tomu, že seznam skupin se zobrazí mimo oblast, která je aktualizována během požadavku Ajax, správná skupina není zvýrazněna.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-217">Because the list of groups is displayed outside of the region that is updated during an Ajax request, the right group does not get highlighted.</span></span> <span data-ttu-id="b3bdb-218">Tento problém vyřešíme v další části.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-218">We'll fix this issue in the next section.</span></span>

## <a name="adding-jquery-animation-effects"></a><span data-ttu-id="b3bdb-219">Přidání animačních efektů jQuery</span><span class="sxs-lookup"><span data-stu-id="b3bdb-219">Adding jQuery Animation Effects</span></span>

<span data-ttu-id="b3bdb-220">Za normálních okolností, když klepnete na odkaz na webové stránce, můžete pomocí indikátoru průběhu prohlížeče zjistit, zda prohlížeč aktivně načítá aktualizovaný obsah.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-220">Normally, when you click a link in a web page, you can use the browser progress bar to detect whether or not the browser is actively fetching the updated content.</span></span> <span data-ttu-id="b3bdb-221">Při provádění požadavku Ajax, na druhé straně indikátor průběhu prohlížeče nezobrazuje žádný pokrok.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-221">When performing an Ajax request, on the other hand, the browser progress bar does not show any progress.</span></span> <span data-ttu-id="b3bdb-222">To může uživatele znervóznit.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-222">This can make users nervous.</span></span> <span data-ttu-id="b3bdb-223">Jak víte, zda prohlížeč zamrzl?</span><span class="sxs-lookup"><span data-stu-id="b3bdb-223">How do you know whether the browser has frozen?</span></span>

<span data-ttu-id="b3bdb-224">Existuje několik způsobů, které můžete uživateli označit, že práce se provádí při provádění požadavku Ajax.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-224">There are several ways that you can indicate to a user that work is being performed while performing an Ajax request.</span></span> <span data-ttu-id="b3bdb-225">Jedním z přístupů je zobrazení jednoduché animace.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-225">One approach is to display a simple animation.</span></span> <span data-ttu-id="b3bdb-226">Můžete například zeslabit oblast, když začne a zmizí požadavek Ajax v oblasti po dokončení požadavku.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-226">For example, you can fade out a region when an Ajax request begins and fade in the region when the request completes.</span></span>

<span data-ttu-id="b3bdb-227">Budeme používat knihovnu jQuery, která je součástí microsoft ASP.NET MVC framework, k vytvoření animačních efektů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-227">We'll use the jQuery library which is included with the Microsoft ASP.NET MVC framework, to create the animation effects.</span></span> <span data-ttu-id="b3bdb-228">Aktualizované zobrazení indexu je obsaženo v seznamu 4.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-228">The updated Index view is contained in Listing 4.</span></span>

<span data-ttu-id="b3bdb-229">**Výpis 4 - Zobrazení\Kontakt\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="b3bdb-229">**Listing 4 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample6.aspx)]

<span data-ttu-id="b3bdb-230">Všimněte si, že aktualizované zobrazení indexu obsahuje tři nové funkce jazyka JavaScript.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-230">Notice that the updated Index view contains three new JavaScript functions.</span></span> <span data-ttu-id="b3bdb-231">První dvě funkce používají jQuery k zeslabování a zeslábnutí v seznamu kontaktů, když kliknete na novou skupinu kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-231">The first two functions use jQuery to fade out and fade in the list of contacts when you click a new contact group.</span></span> <span data-ttu-id="b3bdb-232">Třetí funkce zobrazí chybovou zprávu, když výsledkem požadavku Ajax dojde k chybě (například časový mat v síti).</span><span class="sxs-lookup"><span data-stu-id="b3bdb-232">The third function displays an error message when an Ajax request results in an error (for example, network timeout).</span></span>

<span data-ttu-id="b3bdb-233">První funkce se také stará o zvýraznění vybrané skupiny.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-233">The first function also takes care of highlighting the selected group.</span></span> <span data-ttu-id="b3bdb-234">Class = vybraný atribut je přidán do nadřazeného prvku (elementU LI) prvku, na který jste klepnuli.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-234">A class= selected attribute is added to the parent element (the LI element) of the element clicked.</span></span> <span data-ttu-id="b3bdb-235">Opět platí, že jQuery usnadňuje výběr správného prvku a přidat třídu CSS.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-235">Again, jQuery makes it easy to select the right element and add the CSS class.</span></span>

<span data-ttu-id="b3bdb-236">Tyto skripty jsou vázány na odkazy skupiny pomocí Ajax.ActionLink() AjaxOptions parametr.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-236">These scripts are tied to the group links with the help of the Ajax.ActionLink() AjaxOptions parameter.</span></span> <span data-ttu-id="b3bdb-237">Aktualizované Ajax.ActionLink() volání metody vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="b3bdb-237">The updated Ajax.ActionLink() method call looks like this:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample7.aspx)]

## <a name="adding-browser-history-support"></a><span data-ttu-id="b3bdb-238">Přidání podpory historie prohlížeče</span><span class="sxs-lookup"><span data-stu-id="b3bdb-238">Adding Browser History Support</span></span>

<span data-ttu-id="b3bdb-239">Za normálních okolností, když kliknete na odkaz aktualizovat stránku, historie prohlížeče se aktualizuje.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-239">Normally, when you click a link to update a page, your browser history is updated.</span></span> <span data-ttu-id="b3bdb-240">Tímto způsobem můžete kliknout na tlačítko Zpět v prohlížeči a přesunout se zpět v čase do předchozího stavu stránky.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-240">That way, you can click the browser Back button to move back in time to the previous state of the page.</span></span> <span data-ttu-id="b3bdb-241">Pokud například kliknete na skupinu kontaktů Přátelé a potom kliknete na skupinu obchodních kontaktů, můžete klepnutím na tlačítko Zpět v prohlížeči přejít zpět do stavu stránky, když byla vybrána skupina kontaktů Přátelé.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-241">For example, if you click the Friends contact group and then click the Business contact group, you can click the browser Back button to navigate back to the state of the page when the Friends contact group was selected.</span></span>

<span data-ttu-id="b3bdb-242">Bohužel provedení požadavku Ajax neaktualizuje historii prohlížeče automaticky.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-242">Unfortunately, performing an Ajax request does not update browser history automatically.</span></span> <span data-ttu-id="b3bdb-243">Pokud kliknete na skupinu kontaktů a seznam odpovídajících kontaktů se načte s požadavkem Ajax, historie prohlížeče se neaktualizuje.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-243">If you click a contact group, and the list of matching contacts is retrieved with an Ajax request, then the browser history is not updated.</span></span> <span data-ttu-id="b3bdb-244">Tlačítko Zpět v prohlížeči nelze použít k přechodu zpět do skupiny kontaktů po výběru nové skupiny kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-244">You cannot use the browser Back button to navigate back to a contact group after selecting a new contact group.</span></span>

<span data-ttu-id="b3bdb-245">Pokud chcete, aby uživatelé mohli používat tlačítko Zpět v prohlížeči po provedení požadavků Ajax, musíte provést trochu více práce.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-245">If you want users to be able to use the browser Back button after performing Ajax requests then you need to perform a little more work.</span></span> <span data-ttu-id="b3bdb-246">Musíte využít funkce správy historie prohlížeče integrované v ASP.NET AJAX Framework.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-246">You need to take advantage of the browser history management functionality built in the ASP.NET AJAX Framework.</span></span>

<span data-ttu-id="b3bdb-247">ASP.NET historii prohlížeče AJAX, musíte udělat tři věci:</span><span class="sxs-lookup"><span data-stu-id="b3bdb-247">ASP.NET AJAX browser history, you need to do three things:</span></span>

1. <span data-ttu-id="b3bdb-248">Povolte historii prohlížeče nastavením vlastnosti enableBrowserHistory na hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-248">Enable Browser History by setting the enableBrowserHistory property to true.</span></span>
2. <span data-ttu-id="b3bdb-249">Uložit body historie při změně stavu zobrazení voláním metody addHistoryPoint().</span><span class="sxs-lookup"><span data-stu-id="b3bdb-249">Save history points when the state of a view changes by calling the addHistoryPoint() method.</span></span>
3. <span data-ttu-id="b3bdb-250">Rekonstruujte stav zobrazení při vyvolání události navigate.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-250">Reconstruct the state of the view when the navigate event is raised.</span></span>

<span data-ttu-id="b3bdb-251">Aktualizované zobrazení indexu je obsaženo v seznamu 5.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-251">The updated Index view is contained in Listing 5.</span></span>

<span data-ttu-id="b3bdb-252">**Výpis 5 - Zobrazení\Kontakt\Index.aspx**</span><span class="sxs-lookup"><span data-stu-id="b3bdb-252">**Listing 5 - Views\Contact\Index.aspx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample8.aspx)]

<span data-ttu-id="b3bdb-253">V výpisu 5 je ve funkci pageInit() povolena historie prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-253">In Listing 5, Browser History is enabled in the pageInit() function.</span></span> <span data-ttu-id="b3bdb-254">PageInit() Funkce se také používá k nastavení obslužné rutiny události pro navigate události.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-254">The pageInit() function is also used to set up the event handler for the navigate event.</span></span> <span data-ttu-id="b3bdb-255">Přejít událost je aktivována vždy, když prohlížeč vpřed nebo zpět tlačítko způsobí změnu stavu stránky.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-255">The navigate event is raised whenever the browser Forward or Back button causes the state of the page to change.</span></span>

<span data-ttu-id="b3bdb-256">Metoda beginContactList() je volána po klepnutí na skupinu kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-256">The beginContactList() method is called when you click a contact group.</span></span> <span data-ttu-id="b3bdb-257">Tato metoda vytvoří nový bod historie voláním metody addHistoryPoint().</span><span class="sxs-lookup"><span data-stu-id="b3bdb-257">This method creates a new history point by calling the addHistoryPoint() method.</span></span> <span data-ttu-id="b3bdb-258">Id kliknuté skupiny kontaktů je přidáno do historie.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-258">The id of the contact group clicked is added to history.</span></span>

<span data-ttu-id="b3bdb-259">ID skupiny je načteno z atributu expando na odkazu skupiny kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-259">The group id is retrieved from an expando attribute on the contact group link.</span></span> <span data-ttu-id="b3bdb-260">Odkaz je vykreslen s následujícím voláním Ajax.ActionLink().</span><span class="sxs-lookup"><span data-stu-id="b3bdb-260">The link is rendered with the following call to Ajax.ActionLink().</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample9.aspx)]

<span data-ttu-id="b3bdb-261">Poslední parametr předaný Ajax.ActionLink() přidá expando atribut s názvem groupid k odkazu (malá písmena pro kompatibilitu XHTML).</span><span class="sxs-lookup"><span data-stu-id="b3bdb-261">The last parameter passed to the Ajax.ActionLink() adds an expando attribute named groupid to the link (lowercase for XHTML compatibility).</span></span>

<span data-ttu-id="b3bdb-262">Když uživatel stiskne tlačítko Zpět nebo Vpřed v prohlížeči, je vyvolána událost navigate a volá se metoda navigate().</span><span class="sxs-lookup"><span data-stu-id="b3bdb-262">When a user hits the browser Back or Forward button, the navigate event is raised and the navigate() method is called.</span></span> <span data-ttu-id="b3bdb-263">Tato metoda aktualizuje kontakty zobrazené na stránce tak, aby odpovídaly stavu stránky, která odpovídá bodu historie prohlížeče předané metodě navigace.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-263">This method updates the contacts displayed in the page to match the state of the page that corresponds to the browser history point passed to the navigate method.</span></span>

## <a name="performing-ajax-deletes"></a><span data-ttu-id="b3bdb-264">Provedení Ajax odstraní</span><span class="sxs-lookup"><span data-stu-id="b3bdb-264">Performing Ajax Deletes</span></span>

<span data-ttu-id="b3bdb-265">V současné době, aby bylo možné odstranit kontakt, musíte kliknout na odkaz Odstranit a poté kliknout na tlačítko Odstranit zobrazené na stránce potvrzení odstranění (viz obrázek 2).</span><span class="sxs-lookup"><span data-stu-id="b3bdb-265">Currently, in order to delete a contact, you need to click on the Delete link and then click the Delete button displayed in the delete confirmation page (see Figure 2).</span></span> <span data-ttu-id="b3bdb-266">To vypadá jako mnoho žádostí o stránku udělat něco jednoduchého, jako je odstranění záznamu databáze.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-266">This seems like a lot of page requests to do something simple like deleting a database record.</span></span>

<span data-ttu-id="b3bdb-267">[![Stránka potvrzení odstranění](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b3bdb-267">[![The delete confirmation page](iteration-7-add-ajax-functionality-cs/_static/image2.jpg)](iteration-7-add-ajax-functionality-cs/_static/image3.png)</span></span>

<span data-ttu-id="b3bdb-268">**Obrázek 02**: Stránka potvrzení odstranění[(Kliknutím zobrazíte obrázek v plné velikosti)](iteration-7-add-ajax-functionality-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="b3bdb-268">**Figure 02**: The delete confirmation page([Click to view full-size image](iteration-7-add-ajax-functionality-cs/_static/image4.png))</span></span>

<span data-ttu-id="b3bdb-269">Je lákavé přeskočit stránku potvrzení odstranění a odstranit kontakt přímo ze zobrazení rejstříku.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-269">It is tempting to skip the delete confirmation page and delete a contact directly from the Index view.</span></span> <span data-ttu-id="b3bdb-270">Měli byste se tomuto pokušení vyhnout, protože tento přístup otevírá vaši aplikaci do bezpečnostních děr.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-270">You should avoid this temptation because taking this approach opens your application to security holes.</span></span> <span data-ttu-id="b3bdb-271">Obecně nechcete provádět operaci HTTP GET při vyvolání akce, která upravuje stav webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-271">In general, you don t want to perform an HTTP GET operation when invoking an action that modifies the state of your web application.</span></span> <span data-ttu-id="b3bdb-272">Při provádění odstranění chcete provést operaci HTTP POST nebo ještě lépe operaci HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-272">When performing a delete, you want to perform an HTTP POST, or better yet, an HTTP DELETE operation.</span></span>

<span data-ttu-id="b3bdb-273">Odkaz Odstranit je obsažen v částečném seznamu contactlist.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-273">The Delete link is contained in the ContactList partial.</span></span> <span data-ttu-id="b3bdb-274">Aktualizovaná verze částečnécontactlist je obsažena v výpisu 6.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-274">An updated version of the ContactList partial is contained in Listing 6.</span></span>

<span data-ttu-id="b3bdb-275">**Výpis 6 - Zobrazení\Kontakt\ContactList.ascx**</span><span class="sxs-lookup"><span data-stu-id="b3bdb-275">**Listing 6 - Views\Contact\ContactList.ascx**</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample10.aspx)]

<span data-ttu-id="b3bdb-276">Odkaz Delete je vykreslen s následujícím voláním metody Ajax.ImageActionLink():</span><span class="sxs-lookup"><span data-stu-id="b3bdb-276">The Delete link is rendered with the following call to the Ajax.ImageActionLink() method:</span></span>

[!code-aspx[Main](iteration-7-add-ajax-functionality-cs/samples/sample11.aspx)]

> [!NOTE] 
> 
> <span data-ttu-id="b3bdb-277">Ajax.ImageActionLink() není standardní součástí rozhraní ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-277">The Ajax.ImageActionLink() is not a standard part of the ASP.NET MVC framework.</span></span> <span data-ttu-id="b3bdb-278">Ajax.ImageActionLink() je vlastní pomocné metody zahrnuté v projektu Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-278">The Ajax.ImageActionLink() is a custom helper methods included in the Contact Manager project.</span></span>

<span data-ttu-id="b3bdb-279">Parametr AjaxOptions má dvě vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-279">The AjaxOptions parameter has two properties.</span></span> <span data-ttu-id="b3bdb-280">Nejprve se k zobrazení dialogového okna pro potvrzení vyskakovacího javascriptu použije vlastnost Confirm.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-280">First, the Confirm property is used to display a popup JavaScript confirmation dialog.</span></span> <span data-ttu-id="b3bdb-281">Za druhé, HttpMethod vlastnost se používá k provedení operace HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-281">Second, the HttpMethod property is used to perform an HTTP DELETE operation.</span></span>

<span data-ttu-id="b3bdb-282">Výpis 7 obsahuje novou akci AjaxDelete(), která byla přidána do kontroleru kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-282">Listing 7 contains a new AjaxDelete() action that has been added to the Contact controller.</span></span>

<span data-ttu-id="b3bdb-283">**Výpis 7 - Controllers\ContactController.cs (AjaxDelete)**</span><span class="sxs-lookup"><span data-stu-id="b3bdb-283">**Listing 7 - Controllers\ContactController.cs (AjaxDelete)**</span></span>

[!code-csharp[Main](iteration-7-add-ajax-functionality-cs/samples/sample12.cs)]

<span data-ttu-id="b3bdb-284">Akce AjaxDelete() je dekorována atributem AcceptVerbs.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-284">The AjaxDelete() action is decorated with an AcceptVerbs attribute.</span></span> <span data-ttu-id="b3bdb-285">Tento atribut zabrání vyvolání akce s výjimkou jakékoli jiné operace HTTP než operace HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-285">This attribute prevents the action from being invoked except by any HTTP operation other than an HTTP DELETE operation.</span></span> <span data-ttu-id="b3bdb-286">Zejména nelze vyvolat tuto akci s HTTP GET.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-286">In particular, you cannot invoke this action with an HTTP GET.</span></span>

<span data-ttu-id="b3bdb-287">Po odstranění záznamu databáze je třeba zobrazit aktualizovaný seznam kontaktů, který odstraněný záznam neobsahuje.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-287">After you delete database record, you need to display the updated list of contacts that does not contain the deleted record.</span></span> <span data-ttu-id="b3bdb-288">Metoda AjaxDelete() vrátí částečné contactlist a aktualizovaný seznam kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-288">The AjaxDelete() method returns the ContactList partial and the updated list of contacts.</span></span>

## <a name="summary"></a><span data-ttu-id="b3bdb-289">Souhrn</span><span class="sxs-lookup"><span data-stu-id="b3bdb-289">Summary</span></span>

<span data-ttu-id="b3bdb-290">V této iteraci jsme přidali funkce Ajax do naší aplikace Contact Manager.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-290">In this iteration, we added Ajax functionality to our Contact Manager application.</span></span> <span data-ttu-id="b3bdb-291">Použili jsme Ajax ke zlepšení odezvy a výkonu naší aplikace.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-291">We used Ajax to improve the responsiveness and performance of our application.</span></span>

<span data-ttu-id="b3bdb-292">Nejprve jsme refaktorovali zobrazení rejstříku tak, aby kliknutí na skupinu kontaktů neaktualizovalo celé zobrazení.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-292">First, we refactored the Index view so that clicking a contact group does not update the entire view.</span></span> <span data-ttu-id="b3bdb-293">Místo toho kliknutím na skupinu kontaktů aktualizujete pouze seznam kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-293">Instead, clicking a contact group only updates the list of contacts.</span></span>

<span data-ttu-id="b3bdb-294">Dále jsme použili jQuery animační efekty vyblednout a slábnout v seznamu kontaktů.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-294">Next, we used jQuery animation effects to fade out and fade in the list of contacts.</span></span> <span data-ttu-id="b3bdb-295">Přidání animace do aplikace Ajax lze poskytnout uživatelům aplikace s ekvivalentem indikátoru průběhu prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-295">Adding animation to an Ajax application can be used to provide users of the application with the equivalent of a browser progress bar.</span></span>

<span data-ttu-id="b3bdb-296">Do naší aplikace Ajax jsme také přidali podporu historie prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-296">We also added browser history support to our Ajax application.</span></span> <span data-ttu-id="b3bdb-297">Povolili jsme uživatelům kliknout na tlačítka Zpět a Vpřed prohlížeče a změnit tak stav zobrazení rejstříku.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-297">We enabled users to click the browser Back and Forward buttons to change the state of the Index view.</span></span>

<span data-ttu-id="b3bdb-298">Nakonec jsme vytvořili odkaz na odstranění, který podporuje operace HTTP DELETE.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-298">Finally, we created a delete link that supports HTTP DELETE operations.</span></span> <span data-ttu-id="b3bdb-299">Provedením Ajax odstraní, umožňujeme uživatelům odstranit záznamy databáze bez nutnosti uživatel požadovat další odstranění potvrzení stránky.</span><span class="sxs-lookup"><span data-stu-id="b3bdb-299">By performing Ajax deletes, we enable users to delete database records without requiring the user to request an additional delete confirmation page.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b3bdb-300">[Předchozí](iteration-6-use-test-driven-development-cs.md)
> [další](iteration-1-create-the-application-vb.md)</span><span class="sxs-lookup"><span data-stu-id="b3bdb-300">[Previous](iteration-6-use-test-driven-development-cs.md)
[Next](iteration-1-create-the-application-vb.md)</span></span>
