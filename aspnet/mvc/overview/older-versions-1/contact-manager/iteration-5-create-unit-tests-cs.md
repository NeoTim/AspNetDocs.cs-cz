---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
title: 'Iterace #5 – vytvoření testů jednotek (C#) | Dokumentace Microsoftu'
author: microsoft
description: V páté iteraci jsme snadněji naší aplikace spravovat a upravovat tak, že přidáte testy jednotek. Jsme napodobení našich tříd datových modelů a vytváření testů jednotek pro o...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: 28ad8f80-b8a5-444e-b478-8b15a846060c
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-cs
msc.type: authoredcontent
ms.openlocfilehash: 32e81cce34a0e0b1f6b01934334e1b66dce89651
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/06/2019
ms.locfileid: "65123921"
---
# <a name="iteration-5--create-unit-tests-c"></a><span data-ttu-id="c9804-104">Iterace #5 – vytvoření testů jednotek (C#)</span><span class="sxs-lookup"><span data-stu-id="c9804-104">Iteration #5 – Create unit tests (C#)</span></span>

<span data-ttu-id="c9804-105">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="c9804-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="c9804-106">Stáhnout kód</span><span class="sxs-lookup"><span data-stu-id="c9804-106">Download Code</span></span>](iteration-5-create-unit-tests-cs/_static/contactmanager_5_cs1.zip)

> <span data-ttu-id="c9804-107">V páté iteraci jsme snadněji naší aplikace spravovat a upravovat tak, že přidáte testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="c9804-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="c9804-108">Jsme napodobení našich tříd datových modelů a vytváření testů jednotek pro naše řadiče a logiku ověřování.</span><span class="sxs-lookup"><span data-stu-id="c9804-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-c"></a><span data-ttu-id="c9804-109">Vytvoření aplikace ASP.NET MVC pro správu kontaktů (C#)</span><span class="sxs-lookup"><span data-stu-id="c9804-109">Building a Contact Management ASP.NET MVC Application (C#)</span></span>

<span data-ttu-id="c9804-110">V této sérii kurzů jsme integrovali celou aplikaci kontakt správy od začátku na dokončení.</span><span class="sxs-lookup"><span data-stu-id="c9804-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="c9804-111">Obraťte se na správce aplikace umožňuje ukládat kontaktní údaje - jména, telefonní čísla a e-mailové adresy – seznam lidí.</span><span class="sxs-lookup"><span data-stu-id="c9804-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="c9804-112">Vytváříme aplikaci přes více iterací.</span><span class="sxs-lookup"><span data-stu-id="c9804-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="c9804-113">S každou iterací zvyšujeme postupně aplikace.</span><span class="sxs-lookup"><span data-stu-id="c9804-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="c9804-114">Cílem tohoto přístupu s více iterace je vám pomohl pochopit důvod pro každou změnu.</span><span class="sxs-lookup"><span data-stu-id="c9804-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="c9804-115">Iterace #1 – Vytvoření aplikace.</span><span class="sxs-lookup"><span data-stu-id="c9804-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="c9804-116">V první iteraci vytvoříme Správce kontaktů v Nejjednodušším způsobem, jak je to možné.</span><span class="sxs-lookup"><span data-stu-id="c9804-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="c9804-117">Přidáváme podporu pro základní databázových operací: Vytvoření, čtení, aktualizace a odstranění (CRUD).</span><span class="sxs-lookup"><span data-stu-id="c9804-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="c9804-118">Ujistěte se, iterace #2 – vylepšení vzhledu aplikace.</span><span class="sxs-lookup"><span data-stu-id="c9804-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="c9804-119">V této iterace můžeme zlepšit vzhled aplikace tak, že změna výchozích hlavní stránka zobrazení ASP.NET MVC a stylů CSS.</span><span class="sxs-lookup"><span data-stu-id="c9804-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="c9804-120">Iterace #3 – Přidání ověřovacího formuláře.</span><span class="sxs-lookup"><span data-stu-id="c9804-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="c9804-121">Ve třetí iterace přidáme ověření základní formulář.</span><span class="sxs-lookup"><span data-stu-id="c9804-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="c9804-122">Můžeme zabránit neoprávněným osobám v odeslání formuláře bez dokončení vyžadovaná pole formuláře.</span><span class="sxs-lookup"><span data-stu-id="c9804-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="c9804-123">Také ověření e-mailových adres a telefonních čísel.</span><span class="sxs-lookup"><span data-stu-id="c9804-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="c9804-124">Iterace #4 – vytvoření volně spárované aplikace.</span><span class="sxs-lookup"><span data-stu-id="c9804-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="c9804-125">V této iterace čtvrtý můžeme využít několik způsobů návrhu v softwaru k bylo snazší spravovat a upravovat aplikace Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="c9804-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="c9804-126">Například Refaktorovat jsme naši aplikaci pomocí vzoru úložiště a vzor vkládání závislostí.</span><span class="sxs-lookup"><span data-stu-id="c9804-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="c9804-127">Iterace #5 – vytvoření testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="c9804-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="c9804-128">V páté iteraci jsme snadněji naší aplikace spravovat a upravovat tak, že přidáte testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="c9804-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="c9804-129">Jsme napodobení našich tříd datových modelů a vytváření testů jednotek pro naše řadiče a logiku ověřování.</span><span class="sxs-lookup"><span data-stu-id="c9804-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="c9804-130">Iterace #6 – použití vývoje řízeného testováním.</span><span class="sxs-lookup"><span data-stu-id="c9804-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="c9804-131">V této iterace šestého přidáme nové funkce do naší aplikace tak, že nejprve zápis testů jednotek a psaní kódu pro testování částí.</span><span class="sxs-lookup"><span data-stu-id="c9804-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="c9804-132">V této iterace můžeme přidat skupiny kontaktů.</span><span class="sxs-lookup"><span data-stu-id="c9804-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="c9804-133">Iterace #7 – přidání funkcí Ajax.</span><span class="sxs-lookup"><span data-stu-id="c9804-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="c9804-134">V sedmé iteraci můžeme zlepšit rychlost reakce a výkon naší aplikace tak, že přidáte podporu pro Ajax.</span><span class="sxs-lookup"><span data-stu-id="c9804-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="c9804-135">Tuto iteraci</span><span class="sxs-lookup"><span data-stu-id="c9804-135">This Iteration</span></span>

<span data-ttu-id="c9804-136">V předchozí iteraci aplikace Správce kontaktů jsme rozdělili do více volně spárované aplikace.</span><span class="sxs-lookup"><span data-stu-id="c9804-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="c9804-137">Jsme oddělené aplikaci do různých kontroler, služby a vrstvy úložiště.</span><span class="sxs-lookup"><span data-stu-id="c9804-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="c9804-138">Každá vrstva komunikuje s vrstvy pod ní prostřednictvím rozhraní.</span><span class="sxs-lookup"><span data-stu-id="c9804-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="c9804-139">Jsme rozdělili aplikace, aby aplikace lépe spravovat a upravovat.</span><span class="sxs-lookup"><span data-stu-id="c9804-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="c9804-140">Například pokud bychom někdy potřebovali novou technologii přístup data, můžeme jednoduše změnit vrstvu úložiště bez zásahu do kontroleru nebo vrstva služby.</span><span class="sxs-lookup"><span data-stu-id="c9804-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="c9804-141">Tím, že správce kontaktů volně propojené a jsme uložit provedené aplikace odolnější vůči změnit.</span><span class="sxs-lookup"><span data-stu-id="c9804-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="c9804-142">Ale co se stane, když je potřeba přidat nové funkce do aplikace Správce kontaktů?</span><span class="sxs-lookup"><span data-stu-id="c9804-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="c9804-143">Nebo co se stane, když jsme opravy chyby?</span><span class="sxs-lookup"><span data-stu-id="c9804-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="c9804-144">Líto, že odcházíte, ale také ověřené pravdy psaní kódu, který je v každé touch vytvoříte riziko zavlečení nových chyb kódu.</span><span class="sxs-lookup"><span data-stu-id="c9804-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="c9804-145">Například jeden den v pořádku, Správce může vás požádat o novou funkci přidat do Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="c9804-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="c9804-146">Můžete přidat podporu pro skupiny kontaktu chce.</span><span class="sxs-lookup"><span data-stu-id="c9804-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="c9804-147">Jana chce, abyste uživatelům uspořádat si kontakty do skupiny, například přátel, firmy a tak dále.</span><span class="sxs-lookup"><span data-stu-id="c9804-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="c9804-148">Aby bylo možné implementovat tuto novou funkci, budete muset změnit všechny tři vrstvy aplikace Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="c9804-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="c9804-149">Bude potřeba přidat nové funkce do řadiče, vrstva služby a úložiště.</span><span class="sxs-lookup"><span data-stu-id="c9804-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="c9804-150">Jakmile začnete upravovat kód, riskujete dopadem na dřívější kód funkce, které fungovalo.</span><span class="sxs-lookup"><span data-stu-id="c9804-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="c9804-151">Refaktoring naší aplikace do samostatných vrstev, jako jsme to udělali v předchozí iteraci byla dobrá věc.</span><span class="sxs-lookup"><span data-stu-id="c9804-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="c9804-152">To byl dobrá věc, protože umožňuje nám zvýšit celý vrstvy provádět změny bez zásahu do zbývajících částí aplikace.</span><span class="sxs-lookup"><span data-stu-id="c9804-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="c9804-153">Ale pokud chcete lépe spravovat a upravovat kód v rámci vrstvy, musíte vytvořit testy jednotek pro kód.</span><span class="sxs-lookup"><span data-stu-id="c9804-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="c9804-154">Použijete jednotka testu jednotlivých částí kódu.</span><span class="sxs-lookup"><span data-stu-id="c9804-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="c9804-155">Tyto jednotky kódu jsou menší než vrstvy celé aplikace.</span><span class="sxs-lookup"><span data-stu-id="c9804-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="c9804-156">Testování částí se obvykle používají k ověření, jestli konkrétní metody v kódu se chová způsobem, který očekáváte.</span><span class="sxs-lookup"><span data-stu-id="c9804-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="c9804-157">Například by vytvoření testování částí pro metodu CreateContact() vystavené ContactManagerService třídy.</span><span class="sxs-lookup"><span data-stu-id="c9804-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="c9804-158">Testy jednotek pro pracovní aplikace, která je jenom jako bezpečnostní.</span><span class="sxs-lookup"><span data-stu-id="c9804-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="c9804-159">Pokaždé, když upravíte kódu v aplikaci, můžete spustit sady testů jednotek ke kontrole, jestli úpravy přeruší stávající funkce.</span><span class="sxs-lookup"><span data-stu-id="c9804-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="c9804-160">Testy jednotek byl kód bezpečně upravovat.</span><span class="sxs-lookup"><span data-stu-id="c9804-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="c9804-161">Testy jednotek Ujistěte se, veškerý kód ve vaší aplikaci odolnější vůči změnit.</span><span class="sxs-lookup"><span data-stu-id="c9804-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="c9804-162">V této iterace přidáme k naší aplikace Správce kontaktů testování částí.</span><span class="sxs-lookup"><span data-stu-id="c9804-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="c9804-163">Tímto způsobem, při příští iteraci, můžeme přidat skupiny kontaktu pro naši aplikaci bez starostí o zásadní stávajících funkcí.</span><span class="sxs-lookup"><span data-stu-id="c9804-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c9804-164">Existují různé architektury, včetně MbUnit, NUnit a xUnit.net testování částí.</span><span class="sxs-lookup"><span data-stu-id="c9804-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="c9804-165">V tomto kurzu používáme jednotkových testů součástí sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="c9804-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="c9804-166">Však stejně snadno můžete jedno z těchto alternativních rozhraní.</span><span class="sxs-lookup"><span data-stu-id="c9804-166">However, you could just as easily use one of these alternative frameworks.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="c9804-167">Co získá testování</span><span class="sxs-lookup"><span data-stu-id="c9804-167">What Gets Tested</span></span>

<span data-ttu-id="c9804-168">V ideálním všech kódů by být pokryté komponentami testování částí.</span><span class="sxs-lookup"><span data-stu-id="c9804-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="c9804-169">V ideálním budete mít dokonalý bezpečnostní.</span><span class="sxs-lookup"><span data-stu-id="c9804-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="c9804-170">By moci upravit libovolném řádku kódu v aplikaci a vědět, okamžitě, spuštěním testování částí, zda tato změna se podařilo přerušit stávajících funkcí.</span><span class="sxs-lookup"><span data-stu-id="c9804-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="c9804-171">Můžeme ale nejsou t za provozu v ideálním.</span><span class="sxs-lookup"><span data-stu-id="c9804-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="c9804-172">V praxi, při psaní testů jednotek můžete soustředit na psaní testů pro vaši obchodní logiku (například logiku ověřování).</span><span class="sxs-lookup"><span data-stu-id="c9804-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="c9804-173">Konkrétně můžete *nejsou* vytvořte jednotkové testy pro vaše data přístup logiku nebo logice zobrazení.</span><span class="sxs-lookup"><span data-stu-id="c9804-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="c9804-174">Aby byly užitečné, musí spustit testy jednotek velmi rychle.</span><span class="sxs-lookup"><span data-stu-id="c9804-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="c9804-175">Snadno můžete shromažďujete stovkách (nebo dokonce tisících) testů jednotek pro aplikace.</span><span class="sxs-lookup"><span data-stu-id="c9804-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="c9804-176">Pokud trvat dlouhou dobu pro spuštění testů jednotek budete vyhnout, jejich spuštění.</span><span class="sxs-lookup"><span data-stu-id="c9804-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="c9804-177">Jinými slovy jsou zbytečné pro každodenní kódování, účely dlouhodobě spuštěných testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="c9804-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="c9804-178">Z tohoto důvodu se obvykle nenapíšete testů jednotek pro kód, který komunikuje s databází.</span><span class="sxs-lookup"><span data-stu-id="c9804-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="c9804-179">Provozování testů jednotek pro živé databáze může být pomalý.</span><span class="sxs-lookup"><span data-stu-id="c9804-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="c9804-180">Místo toho napodobení databáze a napsat kód, který komunikuje s mock databáze (podíváme na to napodobování databázi níže).</span><span class="sxs-lookup"><span data-stu-id="c9804-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="c9804-181">Ze stejného důvodu obvykle nenapíšete testů jednotek pro zobrazení.</span><span class="sxs-lookup"><span data-stu-id="c9804-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="c9804-182">Aby bylo možné testovat zobrazení, musíte aktivovat webový server.</span><span class="sxs-lookup"><span data-stu-id="c9804-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="c9804-183">Vzhledem k tomu vybudujete webový server je poměrně pomalý proces, vytváření testů jednotek pro zobrazení se nedoporučuje.</span><span class="sxs-lookup"><span data-stu-id="c9804-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="c9804-184">Pokud zobrazení obsahuje složitější logiku byste zvážit, přesun logiku do metody Helper.</span><span class="sxs-lookup"><span data-stu-id="c9804-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="c9804-185">Můžete psát testy jednotek pro pomocné metody, které jsou spuštěny bez rozbíhání webový server.</span><span class="sxs-lookup"><span data-stu-id="c9804-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c9804-186">Při psaní testů pro logikou přístupu k datům nebo zobrazení logiky není vhodné při psaní testů jednotek, tyto testy může být velmi důležité, při vytváření funkční nebo integraci testů.</span><span class="sxs-lookup"><span data-stu-id="c9804-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c9804-187">ASP.NET MVC je webové formuláře zobrazovací modul.</span><span class="sxs-lookup"><span data-stu-id="c9804-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="c9804-188">Webové formuláře zobrazovací modul je závislé na webovém serveru, nemusí být ostatní moduly zobrazení.</span><span class="sxs-lookup"><span data-stu-id="c9804-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>

## <a name="using-a-mock-object-framework"></a><span data-ttu-id="c9804-189">Pomocí Mock objektu Framework</span><span class="sxs-lookup"><span data-stu-id="c9804-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="c9804-190">Při vytváření testů jednotek, musíte téměř vždy využít architekturu napodobení objektu.</span><span class="sxs-lookup"><span data-stu-id="c9804-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="c9804-191">Napodobení objektu rozhraní umožňuje vytvářet mocks a zástupných procedur pro třídy ve vaší aplikaci.</span><span class="sxs-lookup"><span data-stu-id="c9804-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="c9804-192">Například můžete použít rozhraní napodobení objekt ke generování verzi mock třídy úložiště.</span><span class="sxs-lookup"><span data-stu-id="c9804-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="c9804-193">Tímto způsobem třídu mock úložiště můžete použít namísto třídy skutečné úložiště v rámci testování součástí.</span><span class="sxs-lookup"><span data-stu-id="c9804-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="c9804-194">Pomocí mock úložiště umožňuje vyhnout se provádění kódu databáze při provádění testu jednotek.</span><span class="sxs-lookup"><span data-stu-id="c9804-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="c9804-195">Visual Studio nezahrnuje framework napodobení objektu.</span><span class="sxs-lookup"><span data-stu-id="c9804-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="c9804-196">Existují však několik komerční s otevřeným zdrojovým kódem napodobení objekt k dispozici pro rozhraní .NET framework:</span><span class="sxs-lookup"><span data-stu-id="c9804-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="c9804-197">Moq - toto rozhraní je k dispozici v rámci licence BSD open source.</span><span class="sxs-lookup"><span data-stu-id="c9804-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="c9804-198">Můžete si stáhnout Moq z [ https://code.google.com/p/moq/ ](https://code.google.com/p/moq/).</span><span class="sxs-lookup"><span data-stu-id="c9804-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="c9804-199">Rhino Mocks – toto rozhraní je k dispozici v rámci licence BSD open source.</span><span class="sxs-lookup"><span data-stu-id="c9804-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="c9804-200">Můžete si stáhnout Rhino Mocks z [ http://ayende.com/projects/rhino-mocks.aspx ](http://ayende.com/projects/rhino-mocks.aspx).</span><span class="sxs-lookup"><span data-stu-id="c9804-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="c9804-201">Typemock Odpojovač – to je komerční rozhraní.</span><span class="sxs-lookup"><span data-stu-id="c9804-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="c9804-202">Můžete stáhnout zkušební verzi z [ http://www.typemock.com/ ](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="c9804-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="c9804-203">V tomto kurzu jsem se rozhodla používat Moq.</span><span class="sxs-lookup"><span data-stu-id="c9804-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="c9804-204">Však stejně snadno můžete Rhino Mocks nebo Typemock Odpojovač vytvořit model objektů aplikace Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="c9804-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="c9804-205">Před použitím Moq, budete muset provést následující kroky:</span><span class="sxs-lookup"><span data-stu-id="c9804-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="c9804-206">.</span><span class="sxs-lookup"><span data-stu-id="c9804-206">.</span></span>
2. <span data-ttu-id="c9804-207">Předtím, než můžete rozbalit soubor ke stažení, ujistěte se, že pravým tlačítkem myši na soubor a klikněte na tlačítko s popiskem **Odblokovat** (viz obrázek 1).</span><span class="sxs-lookup"><span data-stu-id="c9804-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="c9804-208">Rozbalte stažený soubor.</span><span class="sxs-lookup"><span data-stu-id="c9804-208">Unzip the download.</span></span>
4. <span data-ttu-id="c9804-209">Přidat odkaz na sestavení Moq tak, že kliknete pravým tlačítkem na složku odkazy v projektu ContactManager.Tests a vyberete **přidat odkaz**.</span><span class="sxs-lookup"><span data-stu-id="c9804-209">Add a reference to the Moq assembly by right-clicking the References folder in the ContactManager.Tests project and selecting **Add Reference**.</span></span> <span data-ttu-id="c9804-210">Na kartě Procházet přejděte do složky, kde odblokujte Moq a vyberte Moq.dll sestavení.</span><span class="sxs-lookup"><span data-stu-id="c9804-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="c9804-211">Klikněte na tlačítko **OK** tlačítko.</span><span class="sxs-lookup"><span data-stu-id="c9804-211">Click the **OK** button.</span></span>
5. <span data-ttu-id="c9804-212">Po dokončení těchto kroků složky odkazů by měl vypadat jako na obrázku 2.</span><span class="sxs-lookup"><span data-stu-id="c9804-212">After you complete these steps, your References folder should look like Figure 2.</span></span>

<span data-ttu-id="c9804-213">[![Odblokování Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c9804-213">[![Unblocking Moq](iteration-5-create-unit-tests-cs/_static/image1.jpg)](iteration-5-create-unit-tests-cs/_static/image1.png)</span></span>

<span data-ttu-id="c9804-214">**Obrázek 01**: Odblokování Moq ([kliknutím ji zobrazíte obrázek v plné velikosti](iteration-5-create-unit-tests-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="c9804-214">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image2.png))</span></span>

<span data-ttu-id="c9804-215">[![Po přidání Moq odkazy](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="c9804-215">[![References after adding Moq](iteration-5-create-unit-tests-cs/_static/image2.jpg)](iteration-5-create-unit-tests-cs/_static/image3.png)</span></span>

<span data-ttu-id="c9804-216">**Obrázek 02**: Po přidání Moq odkazy ([kliknutím ji zobrazíte obrázek v plné velikosti](iteration-5-create-unit-tests-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="c9804-216">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image4.png))</span></span>

## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="c9804-217">Vytváření testů jednotek pro vrstvu služby</span><span class="sxs-lookup"><span data-stu-id="c9804-217">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="c9804-218">Umožní s začněte vytvořením sady testů jednotek pro vrstvu služby s aplikací naše Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="c9804-218">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="c9804-219">Použijeme tyto testy k ověření naší logiku ověřování.</span><span class="sxs-lookup"><span data-stu-id="c9804-219">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="c9804-220">Vytvořte novou složku s názvem modely v projektu ContactManager.Tests.</span><span class="sxs-lookup"><span data-stu-id="c9804-220">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="c9804-221">V dalším kroku klikněte pravým tlačítkem na složku modely a vyberte **přidat, nový Test**.</span><span class="sxs-lookup"><span data-stu-id="c9804-221">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="c9804-222">**Přidat nový Test** se zobrazí dialogové okno je znázorněno na obrázku 3.</span><span class="sxs-lookup"><span data-stu-id="c9804-222">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="c9804-223">Vyberte **testování částí** šablony a pojmenujte nový test ContactManagerServiceTest.cs.</span><span class="sxs-lookup"><span data-stu-id="c9804-223">Select the **Unit Test** template and name your new test ContactManagerServiceTest.cs.</span></span> <span data-ttu-id="c9804-224">Klikněte na tlačítko **OK** tlačítko Přidat nový test do projektu Test.</span><span class="sxs-lookup"><span data-stu-id="c9804-224">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c9804-225">Obecně byste měli strukturu složky pro testovací projekt tak, aby odpovídaly struktuře složky vašeho projektu ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="c9804-225">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="c9804-226">Například umístit kontroleru testů ve složce řadiče testů modelu ve složce modely a tak dále.</span><span class="sxs-lookup"><span data-stu-id="c9804-226">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>

<span data-ttu-id="c9804-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c9804-227">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-cs/_static/image3.jpg)](iteration-5-create-unit-tests-cs/_static/image5.png)</span></span>

<span data-ttu-id="c9804-228">**Obrázek 03**: Models\ContactManagerServiceTest.cs ([kliknutím ji zobrazíte obrázek v plné velikosti](iteration-5-create-unit-tests-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c9804-228">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image6.png))</span></span>

<span data-ttu-id="c9804-229">Na začátku chceme otestovat CreateContact() metoda použitá v třídě ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="c9804-229">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="c9804-230">Vytvoříme následujících pět testů:</span><span class="sxs-lookup"><span data-stu-id="c9804-230">We'll create the following five tests:</span></span>

- <span data-ttu-id="c9804-231">CreateContact() - testů tohoto CreateContact() vrátí hodnotu true, pokud platný kontakt je předán do metody.</span><span class="sxs-lookup"><span data-stu-id="c9804-231">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="c9804-232">CreateContactRequiredFirstName() - testy, chybová zpráva se přidá do stavu modelu při kontaktu s chybějící křestní jméno se předá metodě CreateContact().</span><span class="sxs-lookup"><span data-stu-id="c9804-232">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="c9804-233">CreateContactRequiredLastName() - testy, chybová zpráva se přidá do stavu modelu při kontaktu s chybějící příjmení se předá metodě CreateContact().</span><span class="sxs-lookup"><span data-stu-id="c9804-233">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="c9804-234">CreateContactInvalidPhone() - testy, chybová zpráva se přidá do stavu modelu při kontaktu s neplatným telefonním číslem se předá metodě CreateContact().</span><span class="sxs-lookup"><span data-stu-id="c9804-234">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="c9804-235">CreateContactInvalidEmail() - testy, chybová zpráva se přidá do stavu modelu při kontaktu s neplatnou e-mailovou adresu se předá metodě CreateContact()...</span><span class="sxs-lookup"><span data-stu-id="c9804-235">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="c9804-236">První test ověří, že platný kontakt nevygeneruje chybu ověřování.</span><span class="sxs-lookup"><span data-stu-id="c9804-236">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="c9804-237">Zbývající testy zkontrolujte všech ověřovacích pravidel.</span><span class="sxs-lookup"><span data-stu-id="c9804-237">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="c9804-238">Kód pro tyto testy je obsažen v informacích 1.</span><span class="sxs-lookup"><span data-stu-id="c9804-238">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="c9804-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span><span class="sxs-lookup"><span data-stu-id="c9804-239">**Listing 1 - Models\ContactManagerServiceTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample1.cs)]

<span data-ttu-id="c9804-240">Protože používáme třídy kontakt v informacích 1, potřebujeme přidat odkaz na rozhraní Entity Framework společnosti Microsoft do našich testovacího projektu.</span><span class="sxs-lookup"><span data-stu-id="c9804-240">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="c9804-241">Přidáte odkaz na sestavení System.Data.Entity.</span><span class="sxs-lookup"><span data-stu-id="c9804-241">Add a reference to the System.Data.Entity assembly.</span></span>

<span data-ttu-id="c9804-242">Výpis 1 obsahuje metodu s názvem Initialize(), který je upraven pomocí atributu [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="c9804-242">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="c9804-243">Tato metoda je volána automaticky před spuštěním každého testu jednotek (5krát je volána bezprostředně před každou testování částí).</span><span class="sxs-lookup"><span data-stu-id="c9804-243">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="c9804-244">Metodu Initialize() vytvoří mock úložiště s následující řádek kódu:</span><span class="sxs-lookup"><span data-stu-id="c9804-244">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample2.cs)]

<span data-ttu-id="c9804-245">Tento řádek kódu používá ke generování mock úložiště z rozhraní IContactManagerRepository Moq framework.</span><span class="sxs-lookup"><span data-stu-id="c9804-245">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="c9804-246">Mock úložiště se používá namísto skutečné EntityContactManagerRepository pro zabránění přístupu k databázi, když se spustí každý Jednotkový test.</span><span class="sxs-lookup"><span data-stu-id="c9804-246">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="c9804-247">Mock úložiště implementuje metodu rozhraní IContactManagerRepository, ale t don metody skutečně provádět.</span><span class="sxs-lookup"><span data-stu-id="c9804-247">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="c9804-248">Pokud používáte rozhraní framework Moq, je rozdíl mezi \_mockRepository a \_mockRepository.Object.</span><span class="sxs-lookup"><span data-stu-id="c9804-248">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="c9804-249">Nejprve odkazuje model&lt;IContactManagerRepository&gt; třídu, která obsahuje metody pro určení, jak se bude chovat mock úložiště.</span><span class="sxs-lookup"><span data-stu-id="c9804-249">The former refers to the Mock&lt;IContactManagerRepository&gt; class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="c9804-250">Druhá možnost odkazuje na skutečné mock úložiště, který implementuje rozhraní IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="c9804-250">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>

<span data-ttu-id="c9804-251">Při vytváření instance třídy ContactManagerService mock úložiště slouží v metodu Initialize().</span><span class="sxs-lookup"><span data-stu-id="c9804-251">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="c9804-252">Všechny jednotlivé jednotkových testů používat tuto instanci třídy ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="c9804-252">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="c9804-253">Výpis 1 obsahuje pět metod, které odpovídají jednotlivým testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="c9804-253">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="c9804-254">Každá z těchto metod je upravený pomocí atributu [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="c9804-254">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="c9804-255">Při spuštění testů jednotek, se nazývá jakoukoli metodu, která má tento atribut.</span><span class="sxs-lookup"><span data-stu-id="c9804-255">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="c9804-256">Jinými slovy jakoukoli metodu, která je upravena pomocí atributu [TestMethod] je testování částí.</span><span class="sxs-lookup"><span data-stu-id="c9804-256">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="c9804-257">První test částí s názvem CreateContact(), ověří, že CreateContact() volání vrátí hodnotu true při vytvoření platné instance třídy kontakt je předán metodě.</span><span class="sxs-lookup"><span data-stu-id="c9804-257">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="c9804-258">Test vytvoří instanci třídy kontakt, volá metodu CreateContact() a ověřuje, že CreateContact() vrátí hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="c9804-258">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="c9804-259">Zbývající testy ověřte, že při volání metody CreateContact() neplatný kontakt pak metoda vrátí hodnotu false a chybových zpráv ověření očekávané se přidá do stavu modelu.</span><span class="sxs-lookup"><span data-stu-id="c9804-259">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="c9804-260">Například CreateContactRequiredFirstName() test vytvoří instanci třídy kontaktu s prázdným řetězcem pro jeho vlastnost FirstName.</span><span class="sxs-lookup"><span data-stu-id="c9804-260">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="c9804-261">V dalším kroku je volána metoda CreateContact() neplatný kontakt.</span><span class="sxs-lookup"><span data-stu-id="c9804-261">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="c9804-262">Nakonec test ověří, že CreateContact() vrátí hodnotu false a že ze stavů modelu obsahuje chybovou zprávu ověření očekávané "jméno je povinné."</span><span class="sxs-lookup"><span data-stu-id="c9804-262">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="c9804-263">Můžete spustit testy jednotek v informacích 1 tak, že vyberete možnost nabídky **testovací běh, všechny testy v řešení (CTRL + R, A)**.</span><span class="sxs-lookup"><span data-stu-id="c9804-263">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="c9804-264">Výsledky testů se zobrazí v okně Výsledky testu (viz obrázek 4).</span><span class="sxs-lookup"><span data-stu-id="c9804-264">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>

<span data-ttu-id="c9804-265">[![Výsledky testu](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c9804-265">[![Test Results](iteration-5-create-unit-tests-cs/_static/image4.jpg)](iteration-5-create-unit-tests-cs/_static/image7.png)</span></span>

<span data-ttu-id="c9804-266">**Obrázek 04**: Výsledky testů ([kliknutím ji zobrazíte obrázek v plné velikosti](iteration-5-create-unit-tests-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="c9804-266">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-cs/_static/image8.png))</span></span>

## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="c9804-267">Vytváření testů jednotek pro Kontrolery</span><span class="sxs-lookup"><span data-stu-id="c9804-267">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="c9804-268">Aplikace ASP.NETMVC řízení toku interakci s uživatelem.</span><span class="sxs-lookup"><span data-stu-id="c9804-268">ASP.NETMVC application control the flow of user interaction.</span></span> <span data-ttu-id="c9804-269">Při testování kontroleru, budete chtít otestovat, jestli kontroler vrací pravé akce výsledek a zobrazit data.</span><span class="sxs-lookup"><span data-stu-id="c9804-269">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="c9804-270">Můžete také otestovat, jestli řadič komunikuje s tříd modelu způsobem očekávání.</span><span class="sxs-lookup"><span data-stu-id="c9804-270">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="c9804-271">Například výpis 2 obsahuje dva testy jednotek pro kontroler kontakt Create() metoda.</span><span class="sxs-lookup"><span data-stu-id="c9804-271">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="c9804-272">První test částí ověřuje, že když platný kontakt se předá metodě Create(), pak metoda Create() přesměruje na akce indexu.</span><span class="sxs-lookup"><span data-stu-id="c9804-272">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="c9804-273">Jinými slovy při předání platný kontakt, Create() metoda by měla vrátit RedirectToRouteResult, představující akce indexu.</span><span class="sxs-lookup"><span data-stu-id="c9804-273">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="c9804-274">Budeme zadávat t chcete testovací vrstva služby ContactManager při testujeme vrstvě kontroleru.</span><span class="sxs-lookup"><span data-stu-id="c9804-274">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="c9804-275">Proto jsme napodobení vrstvě služby s následujícím kódem v metodě inicializace:</span><span class="sxs-lookup"><span data-stu-id="c9804-275">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample3.cs)]

<span data-ttu-id="c9804-276">V testu jednotek CreateValidContact() jsme napodobení chování volání vrstva služby CreateContact() metodu s následující řádek kódu:</span><span class="sxs-lookup"><span data-stu-id="c9804-276">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample4.cs)]

<span data-ttu-id="c9804-277">Tento řádek kódu způsobí, že vrací hodnotu true, když je zavolána metoda CreateContact() mock ContactManager služba.</span><span class="sxs-lookup"><span data-stu-id="c9804-277">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="c9804-278">Podle napodobování vrstva služby, abychom mohli otestovat chování kontroleru aniž by bylo nutné provést všechny kódu ve vrstvě služeb.</span><span class="sxs-lookup"><span data-stu-id="c9804-278">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="c9804-279">Druhý test jednotek ověřuje, že akce Create() vrátí zobrazení pro vytváření při neplatný kontakt je předán metodě.</span><span class="sxs-lookup"><span data-stu-id="c9804-279">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="c9804-280">Jsme způsobit vrstva služby CreateContact() metoda vrátí hodnotu false s následující řádek kódu:</span><span class="sxs-lookup"><span data-stu-id="c9804-280">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample5.cs)]

<span data-ttu-id="c9804-281">Pokud Metoda Create() chová jako Očekáváme, že pak měla by vrátit zobrazení pro vytváření při vrstva služby vrátí hodnotu false.</span><span class="sxs-lookup"><span data-stu-id="c9804-281">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="c9804-282">Tímto způsobem kontroleru můžete zobrazit chybové zprávy ověření v zobrazení pro vytváření a uživatel tak možnost opravit tuto neplatné vlastnosti kontaktu.</span><span class="sxs-lookup"><span data-stu-id="c9804-282">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>

<span data-ttu-id="c9804-283">Pokud máte v plánu testů jednotek pro vaše řadiče sestavení budete muset vrátit explicitní zobrazit názvy z akce kontroleru.</span><span class="sxs-lookup"><span data-stu-id="c9804-283">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="c9804-284">Například nesmí vracet zobrazení takto:</span><span class="sxs-lookup"><span data-stu-id="c9804-284">For example, do not return a view like this:</span></span>

<span data-ttu-id="c9804-285">Vrátí View();</span><span class="sxs-lookup"><span data-stu-id="c9804-285">return View();</span></span>

<span data-ttu-id="c9804-286">Místo toho vrátí zobrazení takto:</span><span class="sxs-lookup"><span data-stu-id="c9804-286">Instead, return the view like this:</span></span>

<span data-ttu-id="c9804-287">Vrátí View("Create");</span><span class="sxs-lookup"><span data-stu-id="c9804-287">return View("Create");</span></span>

<span data-ttu-id="c9804-288">Pokud si nejste explicitní při vrácení zobrazení ViewResult.ViewName vlastnost vrací prázdný řetězec.</span><span class="sxs-lookup"><span data-stu-id="c9804-288">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>

<span data-ttu-id="c9804-289">**Výpis 2 - Controllers\ContactControllerTest.cs**</span><span class="sxs-lookup"><span data-stu-id="c9804-289">**Listing 2 - Controllers\ContactControllerTest.cs**</span></span>

[!code-csharp[Main](iteration-5-create-unit-tests-cs/samples/sample6.cs)]

## <a name="summary"></a><span data-ttu-id="c9804-290">Souhrn</span><span class="sxs-lookup"><span data-stu-id="c9804-290">Summary</span></span>

<span data-ttu-id="c9804-291">V této iterace jsme vytvořili testů jednotek pro naši aplikaci Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="c9804-291">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="c9804-292">V každém okamžiku k ověření, že naše aplikace stále chová způsobem, který Očekáváme, že můžeme spustit tyto testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="c9804-292">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="c9804-293">Testování částí fungovat jako bezpečnostní pro naši aplikaci, která umožňuje nám bezpečně upravovat naši aplikaci v budoucnosti.</span><span class="sxs-lookup"><span data-stu-id="c9804-293">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="c9804-294">Vytvořili jsme dvě sady testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="c9804-294">We created two sets of unit tests.</span></span> <span data-ttu-id="c9804-295">Nejprve jsme otestovali naše logiku ověřování pomocí testů jednotek pro naše vrstvu služby.</span><span class="sxs-lookup"><span data-stu-id="c9804-295">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="c9804-296">Dále jsme testovali naše logiky řízení toku ve vytváření testů jednotek pro naše vrstvu kontroleru.</span><span class="sxs-lookup"><span data-stu-id="c9804-296">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="c9804-297">Při testování vrstva naše služby, jsme izolována testech pro naše služby vrstvu z našich vrstvy úložiště napodobování naše vrstvy úložiště.</span><span class="sxs-lookup"><span data-stu-id="c9804-297">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="c9804-298">Při testování vrstvě kontroleru, jsme izolována testech pro naše řadič vrstvu napodobování vrstva služby.</span><span class="sxs-lookup"><span data-stu-id="c9804-298">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="c9804-299">V další iteraci upravíme Správce kontaktů aplikaci tak, aby podporoval skupiny kontaktu.</span><span class="sxs-lookup"><span data-stu-id="c9804-299">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="c9804-300">Tato nová funkce přidáme k naší aplikaci pomocí procesu návrhu softwaru s názvem vývoj řízený testováním.</span><span class="sxs-lookup"><span data-stu-id="c9804-300">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c9804-301">[Předchozí](iteration-4-make-the-application-loosely-coupled-cs.md)
> [další](iteration-6-use-test-driven-development-cs.md)</span><span class="sxs-lookup"><span data-stu-id="c9804-301">[Previous](iteration-4-make-the-application-loosely-coupled-cs.md)
[Next](iteration-6-use-test-driven-development-cs.md)</span></span>
