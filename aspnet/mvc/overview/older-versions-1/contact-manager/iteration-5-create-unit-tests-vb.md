---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
title: 'Iterace #5 – vytvoření testů jednotek (VB) | Microsoft Docs'
author: microsoft
description: V páté iteraci aplikace usnadňuje údržbu a úpravy přidáním jednotkových testů. Napodobme si naše třídy datového modelu a vytvoříme testy jednotek pro o...
ms.author: riande
ms.date: 02/20/2009
ms.assetid: c6e5c036-2265-4fa7-a9eb-47f197bdc262
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
msc.type: authoredcontent
ms.openlocfilehash: 4ce1c6224a7e9203ff62f136f4f3a43e4561a904
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78544294"
---
# <a name="iteration-5--create-unit-tests-vb"></a><span data-ttu-id="4c71b-104">Iterace #5 – vytvoření testů jednotek (VB)</span><span class="sxs-lookup"><span data-stu-id="4c71b-104">Iteration #5 – Create unit tests (VB)</span></span>

<span data-ttu-id="4c71b-105">od [Microsoftu](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="4c71b-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="4c71b-106">Stáhnout kód</span><span class="sxs-lookup"><span data-stu-id="4c71b-106">Download Code</span></span>](iteration-5-create-unit-tests-vb/_static/contactmanager_5_vb1.zip)

> <span data-ttu-id="4c71b-107">V páté iteraci aplikace usnadňuje údržbu a úpravy přidáním jednotkových testů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="4c71b-108">Pro naše řadiče a logiku ověřování jsme nastavili třídy datového modelu a testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a><span data-ttu-id="4c71b-109">Sestavování aplikace MVC pro správu kontaktů ASP.NET (VB)</span><span class="sxs-lookup"><span data-stu-id="4c71b-109">Building a Contact Management ASP.NET MVC Application (VB)</span></span>

<span data-ttu-id="4c71b-110">V této sérii kurzů sestavíme celou aplikaci pro správu kontaktů od začátku do konce.</span><span class="sxs-lookup"><span data-stu-id="4c71b-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="4c71b-111">Aplikace Správce kontaktů umožňuje ukládat kontaktní údaje – jména, telefonní čísla a e-mailové adresy – seznam lidí.</span><span class="sxs-lookup"><span data-stu-id="4c71b-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="4c71b-112">Aplikaci sestavíme přes několik iterací.</span><span class="sxs-lookup"><span data-stu-id="4c71b-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="4c71b-113">U každé iterace doporučujeme aplikaci postupně vylepšit.</span><span class="sxs-lookup"><span data-stu-id="4c71b-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="4c71b-114">Cílem tohoto vícenásobného přístupu k iteraci je umožnit pochopení příčiny každé změny.</span><span class="sxs-lookup"><span data-stu-id="4c71b-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="4c71b-115">Iterace #1 – Vytvoření aplikace</span><span class="sxs-lookup"><span data-stu-id="4c71b-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="4c71b-116">V první iteraci vytvoříme nejjednodušším způsobem správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="4c71b-117">Přidáváme podporu základních databázových operací: vytváření, čtení, aktualizace a odstraňování (CRUD).</span><span class="sxs-lookup"><span data-stu-id="4c71b-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="4c71b-118">Iterace #2 – nastaví vzhled aplikace jako příjemné.</span><span class="sxs-lookup"><span data-stu-id="4c71b-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="4c71b-119">V této iteraci Vylepšete vzhled aplikace úpravou výchozí stránky předlohy zobrazení ASP.NET MVC a šablony kaskádových stylů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="4c71b-120">Iterace #3 – Přidání ověření formuláře.</span><span class="sxs-lookup"><span data-stu-id="4c71b-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="4c71b-121">Třetí iterace přidá základní ověřování formuláře.</span><span class="sxs-lookup"><span data-stu-id="4c71b-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="4c71b-122">Uživatelům bráníme v odesílání formuláře bez nutnosti vyplnit požadovaná pole formuláře.</span><span class="sxs-lookup"><span data-stu-id="4c71b-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="4c71b-123">Ověřujeme taky e-mailové adresy a telefonní čísla.</span><span class="sxs-lookup"><span data-stu-id="4c71b-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="4c71b-124">Iterace #4 – zajistěte, aby byla aplikace volně spojená.</span><span class="sxs-lookup"><span data-stu-id="4c71b-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="4c71b-125">V této čtvrté iteraci využijeme několik vzorů návrhu softwaru, které usnadňují údržbu a úpravy aplikace Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-125">In this fourth iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="4c71b-126">Například refaktorujte naši aplikaci, aby používala vzor úložiště a vzor vkládání závislostí.</span><span class="sxs-lookup"><span data-stu-id="4c71b-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="4c71b-127">Iterace #5 – vytvoření testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="4c71b-128">V páté iteraci aplikace usnadňuje údržbu a úpravy přidáním jednotkových testů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="4c71b-129">Pro naše řadiče a logiku ověřování jsme nastavili třídy datového modelu a testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="4c71b-130">Iterace #6 – použití vývoje řízeného testem.</span><span class="sxs-lookup"><span data-stu-id="4c71b-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="4c71b-131">V této šesté iteraci přidáme do naší aplikace nové funkce, a to tak, že nejprve zapíšeme testy jednotek a napíšeme kód na testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="4c71b-132">V této iteraci přidáváme skupiny kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="4c71b-133">Iterace #7 – přidání funkce AJAX</span><span class="sxs-lookup"><span data-stu-id="4c71b-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="4c71b-134">V sedmé iteraci vylepšit rychlost reakce a výkon naší aplikace přidáním podpory pro AJAX.</span><span class="sxs-lookup"><span data-stu-id="4c71b-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>

## <a name="this-iteration"></a><span data-ttu-id="4c71b-135">Tato iterace</span><span class="sxs-lookup"><span data-stu-id="4c71b-135">This Iteration</span></span>

<span data-ttu-id="4c71b-136">V předchozí iteraci aplikace Správce kontaktů jsme aplikaci znovu rozdělili tak, aby byla uvolněna.</span><span class="sxs-lookup"><span data-stu-id="4c71b-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="4c71b-137">Aplikaci jsme oddělili na samostatné vrstvy řadiče, služby a úložiště.</span><span class="sxs-lookup"><span data-stu-id="4c71b-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="4c71b-138">Každá vrstva komunikuje s vrstvou pod ní přes rozhraní.</span><span class="sxs-lookup"><span data-stu-id="4c71b-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="4c71b-139">Aplikaci jsme refaktoringem zajistili snazší údržbu a úpravy aplikace.</span><span class="sxs-lookup"><span data-stu-id="4c71b-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="4c71b-140">Například pokud potřebujeme používat novou technologii pro přístup k datům, můžeme jednoduše změnit vrstvu úložiště, aniž byste se museli dotýkat řadiče nebo vrstvy služeb.</span><span class="sxs-lookup"><span data-stu-id="4c71b-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="4c71b-141">Tím, že se správce kontaktů volně spojí, udělali jsme aplikaci, která je pružná a mění.</span><span class="sxs-lookup"><span data-stu-id="4c71b-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="4c71b-142">Ale co se stane, když musíme do aplikace Správce kontaktů přidat novou funkci?</span><span class="sxs-lookup"><span data-stu-id="4c71b-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="4c71b-143">Nebo co se stane, když opravujeme chybu?</span><span class="sxs-lookup"><span data-stu-id="4c71b-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="4c71b-144">JSD, ale dobře prověřená, pravdivost psaní kódu je to, že při každém dotykovém kódu vytvoříte riziko pro zavlečení nových chyb.</span><span class="sxs-lookup"><span data-stu-id="4c71b-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="4c71b-145">Například jeden jemný den, váš nadřízený může požádat o přidání nové funkce do Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="4c71b-146">Chce přidat podporu pro skupiny kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="4c71b-147">Chce uživatelům povolit uspořádání kontaktů do skupin, jako jsou přátele, firmy a tak dále.</span><span class="sxs-lookup"><span data-stu-id="4c71b-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="4c71b-148">Aby bylo možné tuto novou funkci implementovat, je nutné upravit všechny tři vrstvy aplikace Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="4c71b-149">Budete muset přidat nové funkce do řadičů, do vrstvy služeb a do úložiště.</span><span class="sxs-lookup"><span data-stu-id="4c71b-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="4c71b-150">Jakmile začnete upravovat kód, riskujete, že jste přestali fungovat dříve.</span><span class="sxs-lookup"><span data-stu-id="4c71b-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="4c71b-151">Použití refaktoringu naší aplikace do samostatných vrstev, stejně jako v předchozí iteraci, bylo dobré.</span><span class="sxs-lookup"><span data-stu-id="4c71b-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="4c71b-152">To je dobré, protože nám umožňuje provádět změny celých vrstev bez toho, aby se dotkli zbytku aplikace.</span><span class="sxs-lookup"><span data-stu-id="4c71b-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="4c71b-153">Nicméně pokud chcete, aby byl kód v rámci vrstvy snazší udržovat a upravovat, je nutné pro kód vytvořit testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="4c71b-154">Testování částí lze použít k otestování jednotlivé jednotky kódu.</span><span class="sxs-lookup"><span data-stu-id="4c71b-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="4c71b-155">Tyto jednotky kódu jsou menší než celé vrstvy aplikace.</span><span class="sxs-lookup"><span data-stu-id="4c71b-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="4c71b-156">Obvykle používáte test jednotek k ověření, zda se konkrétní metoda v kódu chová způsobem, jaký očekáváte.</span><span class="sxs-lookup"><span data-stu-id="4c71b-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="4c71b-157">Například byste vytvořili test jednotky pro metodu CreateContact () zveřejněnou třídou ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="4c71b-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="4c71b-158">Testování částí aplikace funguje stejně jako síť pro bezpečnost.</span><span class="sxs-lookup"><span data-stu-id="4c71b-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="4c71b-159">Kdykoli upravíte kód v aplikaci, můžete spustit sadu testů jednotek a ověřit, zda změna přeruší existující funkce.</span><span class="sxs-lookup"><span data-stu-id="4c71b-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="4c71b-160">Testování částí usnadňuje úpravy kódu.</span><span class="sxs-lookup"><span data-stu-id="4c71b-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="4c71b-161">Testování částí usnadňuje změnu celého kódu v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="4c71b-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="4c71b-162">V této iteraci přidáme testování částí do naší aplikace Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="4c71b-163">Tímto způsobem můžeme do naší aplikace přidat skupiny kontaktů, aniž byste se museli starat o přerušení stávajících funkcí.</span><span class="sxs-lookup"><span data-stu-id="4c71b-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="4c71b-164">Existuje řada platforem testování částí, včetně NUnit, xUnit.net a MbUnit.</span><span class="sxs-lookup"><span data-stu-id="4c71b-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="4c71b-165">V tomto kurzu používáme rozhraní testování částí, které je součástí sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="4c71b-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="4c71b-166">Můžete ale jednoduše použít jednu z těchto alternativních rozhraní.</span><span class="sxs-lookup"><span data-stu-id="4c71b-166">However, you could just as easily use one of these alternative frameworks.</span></span>

## <a name="what-gets-tested"></a><span data-ttu-id="4c71b-167">Co se testuje</span><span class="sxs-lookup"><span data-stu-id="4c71b-167">What Gets Tested</span></span>

<span data-ttu-id="4c71b-168">V ideálním světě by veškerý kód byl pokryt testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="4c71b-169">V ideálním světě byste měli dokonalý bezpečnostní síť.</span><span class="sxs-lookup"><span data-stu-id="4c71b-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="4c71b-170">V aplikaci byste mohli změnit libovolný řádek kódu a okamžitě se dozvědět, že se spustí testy jednotek, ať už změna podařilo přerušit stávající funkce.</span><span class="sxs-lookup"><span data-stu-id="4c71b-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="4c71b-171">Ale nepůjde živě na dokonalém světě.</span><span class="sxs-lookup"><span data-stu-id="4c71b-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="4c71b-172">V praxi se při psaní testů jednotek soustředíte na zápis testů pro obchodní logiku (například logika ověřování).</span><span class="sxs-lookup"><span data-stu-id="4c71b-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="4c71b-173">Konkrétně *nepíšete* testy jednotek pro logiku přístupu k datům nebo logiku zobrazení.</span><span class="sxs-lookup"><span data-stu-id="4c71b-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="4c71b-174">Aby bylo možné provádět testy jednotek, je nutné provést velmi rychle.</span><span class="sxs-lookup"><span data-stu-id="4c71b-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="4c71b-175">Snadno můžete shromáždit stovky (nebo dokonce tisíce) testů jednotek pro aplikaci.</span><span class="sxs-lookup"><span data-stu-id="4c71b-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="4c71b-176">Pokud spuštění testů jednotek trvá dlouhou dobu, pak se vyhnete jejich spouštění.</span><span class="sxs-lookup"><span data-stu-id="4c71b-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="4c71b-177">Jinými slovy, dlouhodobě běžící testy jednotek jsou k disměrnému pro každodenní účely kódování.</span><span class="sxs-lookup"><span data-stu-id="4c71b-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="4c71b-178">Z tohoto důvodu obvykle nepíšete testy jednotek pro kód, který komunikuje s databází.</span><span class="sxs-lookup"><span data-stu-id="4c71b-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="4c71b-179">Spouštění stovek jednotek testů proti živé databázi by bylo příliš pomalé.</span><span class="sxs-lookup"><span data-stu-id="4c71b-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="4c71b-180">Místo toho můžete napodobovat databázi a napsat kód, který komunikuje s databází typu (projednáváme si napodobení databáze níže).</span><span class="sxs-lookup"><span data-stu-id="4c71b-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="4c71b-181">Z podobného důvodu obvykle nepíšete testy jednotek pro zobrazení.</span><span class="sxs-lookup"><span data-stu-id="4c71b-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="4c71b-182">Aby bylo možné otestovat zobrazení, je nutné vystavit webový server.</span><span class="sxs-lookup"><span data-stu-id="4c71b-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="4c71b-183">Vzhledem k tomu, že při odstřeďování webového serveru je poměrně pomalý proces, vytváření testů jednotek pro zobrazení se nedoporučuje.</span><span class="sxs-lookup"><span data-stu-id="4c71b-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="4c71b-184">Pokud vaše zobrazení obsahuje složitou logiku, měli byste zvážit přesunutí logiky do pomocných metod.</span><span class="sxs-lookup"><span data-stu-id="4c71b-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="4c71b-185">Můžete napsat testy jednotek u pomocných metod, které se spouštějí bez otáčející se webového serveru.</span><span class="sxs-lookup"><span data-stu-id="4c71b-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="4c71b-186">Zatímco zápis testů logiky přístupu k datům nebo logiky zobrazení není dobrý nápad při psaní testů jednotek, tyto testy mohou být velmi užitečné při sestavování funkčních nebo integračních testů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="4c71b-187">ASP.NET MVC je modul zobrazení webových formulářů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="4c71b-188">I když je modul zobrazení webových formulářů závislý na webovém serveru, jiné moduly zobrazení nemusí být.</span><span class="sxs-lookup"><span data-stu-id="4c71b-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>

## <a name="using-a-mock-object-framework"></a><span data-ttu-id="4c71b-189">Použití rozhraní makety objektu</span><span class="sxs-lookup"><span data-stu-id="4c71b-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="4c71b-190">Při sestavování testů jednotek, téměř vždy potřebujete využívat výhod rozhraní pro maketu objektů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="4c71b-191">Rozhraní typu Object Framework umožňuje vytvořit pro třídy v aplikaci modely a zástupné procedury.</span><span class="sxs-lookup"><span data-stu-id="4c71b-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="4c71b-192">Například můžete použít objektové rozhraní objektu pro vytváření vzorové verze vaší třídy úložiště.</span><span class="sxs-lookup"><span data-stu-id="4c71b-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="4c71b-193">Tímto způsobem můžete použít třídu úložiště s přípravou namísto reálné třídy úložiště ve vašich testech jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="4c71b-194">Použití modelového úložiště vám umožní vyhnout se spouštění kódu databáze při provádění testu jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="4c71b-195">Sady Visual Studio neobsahují architekturu objektových modelů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="4c71b-196">Pro rozhraní .NET Framework je však k dispozici několik komerčních a open source modelů objektů:</span><span class="sxs-lookup"><span data-stu-id="4c71b-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="4c71b-197">MOQ – tato architektura je k dispozici v rámci licence Open Source BSD.</span><span class="sxs-lookup"><span data-stu-id="4c71b-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="4c71b-198">MOQ si můžete stáhnout z [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span><span class="sxs-lookup"><span data-stu-id="4c71b-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="4c71b-199">Rhinoy – tato architektura je k dispozici v rámci licence Open Source BSD.</span><span class="sxs-lookup"><span data-stu-id="4c71b-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="4c71b-200">Z [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx)můžete stáhnout přípravou z Rhino.</span><span class="sxs-lookup"><span data-stu-id="4c71b-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="4c71b-201">Typemock izolujte – jedná se o komerční rozhraní.</span><span class="sxs-lookup"><span data-stu-id="4c71b-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="4c71b-202">Zkušební verzi si můžete stáhnout z [http://www.typemock.com/](http://www.typemock.com/).</span><span class="sxs-lookup"><span data-stu-id="4c71b-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="4c71b-203">V tomto kurzu jsem se rozhodl používat MOQ.</span><span class="sxs-lookup"><span data-stu-id="4c71b-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="4c71b-204">Mohli byste ale jednoduše použít Rhino nebo Typemock, a vytvořit tak pro aplikaci Správce kontaktů objekty.</span><span class="sxs-lookup"><span data-stu-id="4c71b-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="4c71b-205">Než budete moct používat MOQ, musíte provést následující kroky:</span><span class="sxs-lookup"><span data-stu-id="4c71b-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="4c71b-206">.</span><span class="sxs-lookup"><span data-stu-id="4c71b-206">.</span></span>
2. <span data-ttu-id="4c71b-207">Před rozbalením stahování se ujistěte, že kliknete pravým tlačítkem na soubor a kliknete na tlačítko s popiskem **odblokování** (viz obrázek 1).</span><span class="sxs-lookup"><span data-stu-id="4c71b-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="4c71b-208">Rozbalte soubor ke stažení.</span><span class="sxs-lookup"><span data-stu-id="4c71b-208">Unzip the download.</span></span>
4. <span data-ttu-id="4c71b-209">Přidejte odkaz na sestavení MOQ do projektu testů výběrem možnosti nabídky **projekt, přidat odkaz** a otevřete dialogové okno **Přidat odkaz** .</span><span class="sxs-lookup"><span data-stu-id="4c71b-209">Add a reference to the Moq assembly to your Test project by selecting the menu option **Project, Add Reference** to open the **Add Reference** dialog.</span></span> <span data-ttu-id="4c71b-210">Na kartě Procházet přejděte do složky, kde jste MOQ, a vyberte sestavení MOQ. dll.</span><span class="sxs-lookup"><span data-stu-id="4c71b-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="4c71b-211">Klikněte na tlačítko **OK** (viz obrázek 2).</span><span class="sxs-lookup"><span data-stu-id="4c71b-211">Click the **OK** button (see Figure 2).</span></span>

<span data-ttu-id="4c71b-212">[![odblokování MOQ](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="4c71b-212">[![Unblocking Moq](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span></span>

<span data-ttu-id="4c71b-213">**Obrázek 01**: odblokování MOQ ([kliknutím zobrazíte obrázek v plné velikosti](iteration-5-create-unit-tests-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="4c71b-213">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image2.png))</span></span>

<span data-ttu-id="4c71b-214">[![odkazů po přidání MOQ](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="4c71b-214">[![References after adding Moq](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span></span>

<span data-ttu-id="4c71b-215">**Obrázek 02**: odkazy po přidání MOQ ([kliknutím zobrazíte obrázek v plné velikosti](iteration-5-create-unit-tests-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="4c71b-215">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image4.png))</span></span>

## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="4c71b-216">Vytváření testů jednotek pro vrstvu služby</span><span class="sxs-lookup"><span data-stu-id="4c71b-216">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="4c71b-217">Nechte začít vytvořením sady testů jednotek pro naši aplikační vrstvu správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-217">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="4c71b-218">Tyto testy použijeme k ověření naší ověřovací logiky.</span><span class="sxs-lookup"><span data-stu-id="4c71b-218">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="4c71b-219">Vytvořte novou složku s názvem modely v projektu ContactManager. Tests.</span><span class="sxs-lookup"><span data-stu-id="4c71b-219">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="4c71b-220">Potom klikněte pravým tlačítkem na složku modely a vyberte **Přidat, nový test**.</span><span class="sxs-lookup"><span data-stu-id="4c71b-220">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="4c71b-221">Zobrazí se dialogové okno **Přidat nový test** zobrazené na obrázku 3.</span><span class="sxs-lookup"><span data-stu-id="4c71b-221">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="4c71b-222">Vyberte šablonu **testu jednotek** a pojmenujte nový test ContactManagerServiceTest. vb.</span><span class="sxs-lookup"><span data-stu-id="4c71b-222">Select the **Unit Test** template and name your new test ContactManagerServiceTest.vb.</span></span> <span data-ttu-id="4c71b-223">Kliknutím na tlačítko **OK** přidejte nový test do projektu testů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-223">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="4c71b-224">Obecně platí, že chcete, aby struktura složky testovacího projektu odpovídala struktuře složek projektu ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="4c71b-224">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="4c71b-225">Například můžete umístit testy řadiče do složky Controllers, modelovat testy ve složce modelů a tak dále.</span><span class="sxs-lookup"><span data-stu-id="4c71b-225">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>

<span data-ttu-id="4c71b-226">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="4c71b-226">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span></span>

<span data-ttu-id="4c71b-227">**Obrázek 03**: Models\ContactManagerServiceTest.cs ([kliknutím zobrazíte obrázek v plné velikosti](iteration-5-create-unit-tests-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="4c71b-227">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image6.png))</span></span>

<span data-ttu-id="4c71b-228">Zpočátku chceme otestovat metodu CreateContact () zveřejněnou třídou ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="4c71b-228">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="4c71b-229">Vytvoříme následující pět testů:</span><span class="sxs-lookup"><span data-stu-id="4c71b-229">We'll create the following five tests:</span></span>

- <span data-ttu-id="4c71b-230">CreateContact () – testy, které CreateContact () vrátí hodnotu true, pokud je do metody předán platný kontakt.</span><span class="sxs-lookup"><span data-stu-id="4c71b-230">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="4c71b-231">CreateContactRequiredFirstName () – testuje, zda je chybová zpráva přidána do stavu modelu, pokud je předán kontakt s chybějícím křestním jménem do metody CreateContact ().</span><span class="sxs-lookup"><span data-stu-id="4c71b-231">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="4c71b-232">CreateContactRequiredLastName () – testuje, zda je chybová zpráva přidána do stavu modelu, pokud je předán kontakt s chybějícím posledním názvem metodě CreateContact ().</span><span class="sxs-lookup"><span data-stu-id="4c71b-232">CreateContactRequiredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="4c71b-233">CreateContactInvalidPhone () – testuje, zda je do stavu modelu přidána chybová zpráva, když je do metody CreateContact () předán kontakt s neplatným telefonním číslem.</span><span class="sxs-lookup"><span data-stu-id="4c71b-233">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="4c71b-234">CreateContactInvalidEmail () – testuje, zda je do stavu modelu přidána chybová zpráva, když je do metody CreateContact () předán kontakt s neplatnou e-mailovou adresou..</span><span class="sxs-lookup"><span data-stu-id="4c71b-234">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="4c71b-235">První test ověří, zda platný kontakt negeneruje chybu ověřování.</span><span class="sxs-lookup"><span data-stu-id="4c71b-235">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="4c71b-236">Zbývající testy kontrolují každé z ověřovacích pravidel.</span><span class="sxs-lookup"><span data-stu-id="4c71b-236">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="4c71b-237">Kód pro tyto testy je obsažen v seznamu 1.</span><span class="sxs-lookup"><span data-stu-id="4c71b-237">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="4c71b-238">**Výpis 1 – Models\ContactManagerServiceTest.vb**</span><span class="sxs-lookup"><span data-stu-id="4c71b-238">**Listing 1 - Models\ContactManagerServiceTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample1.vb)]

<span data-ttu-id="4c71b-239">Protože používáme třídu Contact v seznamu 1, musíme do našeho testovacího projektu přidat odkaz na Microsoft Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="4c71b-239">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="4c71b-240">Přidejte odkaz na sestavení System. data. entity.</span><span class="sxs-lookup"><span data-stu-id="4c71b-240">Add a reference to the System.Data.Entity assembly.</span></span>

<span data-ttu-id="4c71b-241">Výpis 1 obsahuje metodu s názvem Initialize (), která je upravena pomocí atributu [TestInitialize].</span><span class="sxs-lookup"><span data-stu-id="4c71b-241">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="4c71b-242">Tato metoda je volána automaticky před každým spuštěním testu jednotek (je označována jako 5 časů přímo před každou jednotkou testů).</span><span class="sxs-lookup"><span data-stu-id="4c71b-242">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="4c71b-243">Metoda Initialize () vytvoří maketu úložiště s následujícím řádkem kódu:</span><span class="sxs-lookup"><span data-stu-id="4c71b-243">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample2.vb)]

<span data-ttu-id="4c71b-244">Tento řádek kódu používá MOQ Framework pro generování napodobné úložiště z rozhraní IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="4c71b-244">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="4c71b-245">Místo skutečného EntityContactManagerRepository se použije Maketové úložiště, aby se předešlo přístupu k databázi při každém spuštění testu jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-245">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="4c71b-246">Maketa úložiště implementuje metody rozhraní IContactManagerRepository, ale metody nedělají vůbec žádnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="4c71b-246">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="4c71b-247">Při použití rozhraní MOQ Framework existuje rozdíl mezi \_mockRepository a \_mockRepository. Object.</span><span class="sxs-lookup"><span data-stu-id="4c71b-247">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="4c71b-248">Předchozí odkazuje na třídu IContactManagerRepository, která obsahuje metody pro určení způsobu, jakým se bude napodobné úložiště chovat.</span><span class="sxs-lookup"><span data-stu-id="4c71b-248">The former refers to the Mock(Of IContactManagerRepository) class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="4c71b-249">Druhý odkazuje na vlastní maketu úložiště, které implementuje rozhraní IContactManagerRepository.</span><span class="sxs-lookup"><span data-stu-id="4c71b-249">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>

<span data-ttu-id="4c71b-250">V metodě Initialize () se používá Maketové úložiště při vytváření instance třídy ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="4c71b-250">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="4c71b-251">Všechny testy jednotlivých jednotek používají tuto instanci třídy ContactManagerService.</span><span class="sxs-lookup"><span data-stu-id="4c71b-251">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="4c71b-252">Výpis 1 obsahuje pět metod, které odpovídají jednotlivým jednotkovým testům.</span><span class="sxs-lookup"><span data-stu-id="4c71b-252">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="4c71b-253">Každá z těchto metod je upravena s použitím atributu [TestMethod].</span><span class="sxs-lookup"><span data-stu-id="4c71b-253">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="4c71b-254">Při spuštění testů jednotek je volána jakákoli metoda, která má tento atribut.</span><span class="sxs-lookup"><span data-stu-id="4c71b-254">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="4c71b-255">Jinými slovy jakákoli metoda, která je upravena s atributem [TestMethod] je test jednotky.</span><span class="sxs-lookup"><span data-stu-id="4c71b-255">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="4c71b-256">První test jednotky s názvem CreateContact () ověří, že volání CreateContact () vrátí hodnotu true, pokud je do metody předána platná instance třídy Contact.</span><span class="sxs-lookup"><span data-stu-id="4c71b-256">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="4c71b-257">Test vytvoří instanci třídy Contact, zavolá metodu CreateContact () a ověří, zda CreateContact () vrátí hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="4c71b-257">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="4c71b-258">Zbývající testy ověří, že když je metoda CreateContact () volána s neplatným kontaktem, vrátí metoda hodnotu false a do stavu modelu se přidá očekávaná chybová zpráva ověřování.</span><span class="sxs-lookup"><span data-stu-id="4c71b-258">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="4c71b-259">Například test CreateContactRequiredFirstName () vytvoří instanci třídy Contact s prázdným řetězcem pro jeho vlastnost FirstName.</span><span class="sxs-lookup"><span data-stu-id="4c71b-259">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="4c71b-260">Dále je volána metoda CreateContact () s neplatným kontaktem.</span><span class="sxs-lookup"><span data-stu-id="4c71b-260">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="4c71b-261">Nakonec test ověří, že CreateContact () vrátí hodnotu false a stav modelu obsahuje očekávanou chybovou zprávu ověření "křestní jméno je povinné."</span><span class="sxs-lookup"><span data-stu-id="4c71b-261">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="4c71b-262">Můžete spustit testy jednotek v seznamu 1 výběrem možnosti nabídka **test, spustit, všechny testy v řešení (CTRL + R, a)** .</span><span class="sxs-lookup"><span data-stu-id="4c71b-262">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="4c71b-263">Výsledky testů se zobrazí v okně Výsledky testů (viz obrázek 4).</span><span class="sxs-lookup"><span data-stu-id="4c71b-263">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>

<span data-ttu-id="4c71b-264">[![Výsledky testů](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="4c71b-264">[![Test Results](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span></span>

<span data-ttu-id="4c71b-265">**Obrázek 04**: výsledky testů ([kliknutím zobrazíte obrázek v plné velikosti](iteration-5-create-unit-tests-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="4c71b-265">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image8.png))</span></span>

## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="4c71b-266">Vytváření testů jednotek pro řadiče</span><span class="sxs-lookup"><span data-stu-id="4c71b-266">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="4c71b-267">ASP.NET aplikace MVC řídí tok interakce s uživatelem.</span><span class="sxs-lookup"><span data-stu-id="4c71b-267">ASP.NET MVC application control the flow of user interaction.</span></span> <span data-ttu-id="4c71b-268">Při testování kontroleru budete chtít otestovat, zda kontroler vrátí výsledek správné akce a zobrazí data.</span><span class="sxs-lookup"><span data-stu-id="4c71b-268">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="4c71b-269">Také může být vhodné otestovat, zda řadič komunikuje s třídami modelů podle očekávání.</span><span class="sxs-lookup"><span data-stu-id="4c71b-269">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="4c71b-270">Například výpis 2 obsahuje dvě testy jednotek metody Create () Správce kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-270">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="4c71b-271">První test jednotky ověřuje, že pokud je do metody Create () předán platný kontakt, přesměruje metoda Create () na akci indexu.</span><span class="sxs-lookup"><span data-stu-id="4c71b-271">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="4c71b-272">Jinými slovy, pokud byl předán platný kontakt, metoda Create () by měla vrátit RedirectToRouteResult, který představuje akci indexu.</span><span class="sxs-lookup"><span data-stu-id="4c71b-272">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="4c71b-273">Při testování vrstvy kontroleru nechceme testovat vrstvu služby ContactManager.</span><span class="sxs-lookup"><span data-stu-id="4c71b-273">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="4c71b-274">Proto se vrstva služby napodobá následujícímu kódu v metodě Initialize:</span><span class="sxs-lookup"><span data-stu-id="4c71b-274">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample3.vb)]

<span data-ttu-id="4c71b-275">V testu jednotky CreateValidContact () jsme nazkoušeli chování volání metody Service Layer CreateContact () s následujícím řádkem kódu:</span><span class="sxs-lookup"><span data-stu-id="4c71b-275">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample4.vb)]

<span data-ttu-id="4c71b-276">Tento řádek kódu způsobí, že ContactManagerová služba vrátí hodnotu true při volání metody CreateContact ().</span><span class="sxs-lookup"><span data-stu-id="4c71b-276">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="4c71b-277">Po napodobování vrstvy služby můžeme otestovat chování našeho kontroleru, aniž byste museli spouštět žádný kód ve vrstvě služeb.</span><span class="sxs-lookup"><span data-stu-id="4c71b-277">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="4c71b-278">Druhý test jednotek ověří, že akce Create () vrátí zobrazení vytvořit, když je metodě předán neplatný kontakt.</span><span class="sxs-lookup"><span data-stu-id="4c71b-278">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="4c71b-279">Způsob, jakým metodu Service Layer CreateContact () vrací hodnotu false, je následující řádek kódu:</span><span class="sxs-lookup"><span data-stu-id="4c71b-279">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample5.vb)]

<span data-ttu-id="4c71b-280">Pokud se metoda Create () chová podle očekávání, měla by vrátit zobrazení vytvořit, když vrstva služby vrátí hodnotu false.</span><span class="sxs-lookup"><span data-stu-id="4c71b-280">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="4c71b-281">Tímto způsobem může kontroler zobrazit chybové zprávy ověřování v zobrazení vytvořit a uživatel má možnost opravit neplatné vlastnosti kontaktu.</span><span class="sxs-lookup"><span data-stu-id="4c71b-281">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>

<span data-ttu-id="4c71b-282">Pokud plánujete sestavit testy jednotek pro řadiče, budete muset vrátit explicitní názvy zobrazení z akcí kontroleru.</span><span class="sxs-lookup"><span data-stu-id="4c71b-282">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="4c71b-283">Nevracet například zobrazení jako:</span><span class="sxs-lookup"><span data-stu-id="4c71b-283">For example, do not return a view like this:</span></span>

<span data-ttu-id="4c71b-284">Vrátit zobrazení ()</span><span class="sxs-lookup"><span data-stu-id="4c71b-284">Return View()</span></span>

<span data-ttu-id="4c71b-285">Místo toho vraťte zobrazení následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="4c71b-285">Instead, return the view like this:</span></span>

<span data-ttu-id="4c71b-286">Návratové zobrazení ("vytvořit")</span><span class="sxs-lookup"><span data-stu-id="4c71b-286">Return View("Create")</span></span>

<span data-ttu-id="4c71b-287">Pokud nejste explicitní při vracení zobrazení, vlastnost ViewResult. ViewName vrátí prázdný řetězec.</span><span class="sxs-lookup"><span data-stu-id="4c71b-287">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>

<span data-ttu-id="4c71b-288">**Výpis 2 – Controllers\ContactControllerTest.vb**</span><span class="sxs-lookup"><span data-stu-id="4c71b-288">**Listing 2 - Controllers\ContactControllerTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample6.vb)]

## <a name="summary"></a><span data-ttu-id="4c71b-289">Souhrn</span><span class="sxs-lookup"><span data-stu-id="4c71b-289">Summary</span></span>

<span data-ttu-id="4c71b-290">V této iteraci jsme pro naši aplikaci Správce kontaktů vytvořili testy jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-290">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="4c71b-291">Tyto jednotkové testy můžeme kdykoli spustit, abyste ověřili, že se aplikace pořád chová způsobem, který očekáváme.</span><span class="sxs-lookup"><span data-stu-id="4c71b-291">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="4c71b-292">Testování částí působí jako bezpečnostní síť pro naši aplikaci, která nám umožňuje bezpečně upravit naši aplikaci v budoucnu.</span><span class="sxs-lookup"><span data-stu-id="4c71b-292">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="4c71b-293">Vytvořili jsme dvě sady testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="4c71b-293">We created two sets of unit tests.</span></span> <span data-ttu-id="4c71b-294">Nejdřív jsme otestovali naši logiku ověřování vytvořením testů jednotek pro naši vrstvu služeb.</span><span class="sxs-lookup"><span data-stu-id="4c71b-294">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="4c71b-295">Dále jsme otestovali naši logiku řízení toku vytvořením testů jednotek pro naši řídicí vrstvu.</span><span class="sxs-lookup"><span data-stu-id="4c71b-295">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="4c71b-296">Při testování naší vrstvy služby jsme z naší vrstvy úložiště zavedli naše testy pro naši vrstvu služby, a to tak, že nasadíme naši vrstvu úložiště.</span><span class="sxs-lookup"><span data-stu-id="4c71b-296">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="4c71b-297">Při testování vrstvy kontroleru jsme izolované testy pro vrstvu řadiče, a to vytvořením vrstvy služby.</span><span class="sxs-lookup"><span data-stu-id="4c71b-297">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="4c71b-298">V další iteraci upravíte aplikaci Správce kontaktů tak, aby podporovala skupiny kontaktů.</span><span class="sxs-lookup"><span data-stu-id="4c71b-298">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="4c71b-299">Tuto novou funkci přidáme do naší aplikace pomocí procesu návrhu softwaru označovaného jako vývoj řízený testováním.</span><span class="sxs-lookup"><span data-stu-id="4c71b-299">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="4c71b-300">[Předchozí](iteration-4-make-the-application-loosely-coupled-vb.md)
> [Další](iteration-6-use-test-driven-development-vb.md)</span><span class="sxs-lookup"><span data-stu-id="4c71b-300">[Previous](iteration-4-make-the-application-loosely-coupled-vb.md)
[Next](iteration-6-use-test-driven-development-vb.md)</span></span>
