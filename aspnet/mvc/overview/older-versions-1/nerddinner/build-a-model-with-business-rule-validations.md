---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Vytvoření modelu s platnými obchodními pravidly | Microsoft Docs
author: microsoft
description: V kroku 3 se dozvíte, jak vytvořit model, který můžeme použít k dotazování a aktualizaci databáze pro naši aplikaci NerdDinner.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 6ebf1b71c089229ba9139ff7dc788b8978724046
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78541662"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="d93be-103">Vytvoření modelu s ověřením obchodních pravidel</span><span class="sxs-lookup"><span data-stu-id="d93be-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="d93be-104">od [Microsoftu](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="d93be-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="d93be-105">Stáhnout PDF</span><span class="sxs-lookup"><span data-stu-id="d93be-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="d93be-106">Toto je krok 3 bezplatného [kurzu aplikace "NerdDinner"](introducing-the-nerddinner-tutorial.md) , který vás provede procesem vytvoření malé, ale dokončené webové aplikace pomocí ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="d93be-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="d93be-107">V kroku 3 se dozvíte, jak vytvořit model, který můžeme použít k dotazování a aktualizaci databáze pro naši aplikaci NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="d93be-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="d93be-108">Pokud používáte ASP.NET MVC 3, doporučujeme vám postupovat podle [Začínáme s kurzy pro](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) [hudební úložiště](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) MVC 3 nebo MVC.</span><span class="sxs-lookup"><span data-stu-id="d93be-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="d93be-109">NerdDinner krok 3: sestavování modelu</span><span class="sxs-lookup"><span data-stu-id="d93be-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="d93be-110">V rámci architektury zobrazení modelu pojem "model" odkazuje na objekty, které představují data aplikace, a na odpovídající logiku domény, která s ním integruje ověřování a obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="d93be-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="d93be-111">Model je v mnoha ohledech na "srdce" aplikace založené na MVC a jak uvidíme později v podstatě jejich chování.</span><span class="sxs-lookup"><span data-stu-id="d93be-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="d93be-112">Rozhraní ASP.NET MVC podporuje používání jakékoli technologie pro přístup k datům a vývojáři si můžou vybrat z nejrůznějších různých možností dat .NET k implementaci svých modelů, včetně: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen pro, antisonic, WilsonORM nebo jenom nezpracovaných objektů ADO. NET datačtecís nebo DataSets.</span><span class="sxs-lookup"><span data-stu-id="d93be-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="d93be-113">Pro naši aplikaci NerdDinner budeme používat LINQ to SQL k vytvoření jednoduchého modelu, který přesně odpovídá návrhu naší databáze, a přidá několik vlastních ověřovacích logik a obchodních pravidel.</span><span class="sxs-lookup"><span data-stu-id="d93be-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="d93be-114">Pak budeme implementovat třídu úložiště, která pomůže abstrakci při implementaci trvalosti dat ze zbytku aplikace, a umožňuje nám ji snadno otestovat.</span><span class="sxs-lookup"><span data-stu-id="d93be-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="d93be-115">Technologie LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="d93be-115">LINQ to SQL</span></span>

<span data-ttu-id="d93be-116">LINQ to SQL je ORM (objekt relačního mapovače), který je dodáván jako součást .NET 3,5.</span><span class="sxs-lookup"><span data-stu-id="d93be-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="d93be-117">LINQ to SQL poskytuje snadný způsob, jak mapovat tabulky databáze na třídy .NET, ke kterým můžeme zakódovat.</span><span class="sxs-lookup"><span data-stu-id="d93be-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="d93be-118">Pro naši aplikaci NerdDinner ji použijeme k namapování tabulek večeře a RSVP v naší databázi na třídy večeře a RSVP.</span><span class="sxs-lookup"><span data-stu-id="d93be-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="d93be-119">Sloupce večeře a tabulek protokolu RSVP budou odpovídat vlastnostem na třídách večeře a RSVP.</span><span class="sxs-lookup"><span data-stu-id="d93be-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="d93be-120">Každý z nich a objekt protokolu RSVP bude představovat samostatný řádek v rámci v tabulkách večeře nebo RSVP v databázi.</span><span class="sxs-lookup"><span data-stu-id="d93be-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="d93be-121">LINQ to SQL nám umožňuje vyhnout se nutnosti ruční konstrukce příkazů SQL pro načtení a aktualizaci dat o večeři a protokolu RSVP s daty databáze.</span><span class="sxs-lookup"><span data-stu-id="d93be-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="d93be-122">Místo toho definujeme třídy večeře a RSVP, jejich mapování na databázi a jejich vztahy mezi nimi.</span><span class="sxs-lookup"><span data-stu-id="d93be-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="d93be-123">LINQ to SQL se pak postará o vygenerování vhodné logiky spuštění SQL, která se použije za běhu při interakci a používání.</span><span class="sxs-lookup"><span data-stu-id="d93be-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="d93be-124">Podporu jazyka LINQ v jazyce VB můžeme použít v rámci C# jazyka VB a k zápisu dotazů, které načítají z databáze večeři a objekty RSVP.</span><span class="sxs-lookup"><span data-stu-id="d93be-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="d93be-125">Tím se minimalizuje množství datových kódů, které potřebujeme napsat, a umožníme nám sestavovat skutečně čisté aplikace.</span><span class="sxs-lookup"><span data-stu-id="d93be-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="d93be-126">Přidání tříd LINQ to SQL do našeho projektu</span><span class="sxs-lookup"><span data-stu-id="d93be-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="d93be-127">Začneme tak, že kliknete pravým tlačítkem na složku modely v našem projektu a vyberete příkaz nabídky **přidat&gt;novou položku** :</span><span class="sxs-lookup"><span data-stu-id="d93be-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="d93be-128">Tím se zobrazí dialogové okno Přidat novou položku.</span><span class="sxs-lookup"><span data-stu-id="d93be-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="d93be-129">Vyfiltrujeme podle kategorie "data" a v ní vyberete šablonu "LINQ to SQL třídy":</span><span class="sxs-lookup"><span data-stu-id="d93be-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="d93be-130">Pojmenujte položku "NerdDinner" a klikněte na tlačítko Přidat.</span><span class="sxs-lookup"><span data-stu-id="d93be-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="d93be-131">Visual Studio přidá do našeho adresáře \Models soubor NerdDinner. dbml a pak otevře návrháře relačních objektů LINQ to SQL:</span><span class="sxs-lookup"><span data-stu-id="d93be-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="d93be-132">Vytváření tříd datového modelu pomocí LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="d93be-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="d93be-133">LINQ to SQL nám umožňuje rychle vytvořit třídy datového modelu z existujícího schématu databáze.</span><span class="sxs-lookup"><span data-stu-id="d93be-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="d93be-134">Provedete to tak, že otevřete databázi NerdDinner v Průzkumník serveru a vyberete tabulky, pro které chcete modelovat:</span><span class="sxs-lookup"><span data-stu-id="d93be-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="d93be-135">Pak můžeme tabulky přetáhnout na plochu návrháře LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="d93be-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="d93be-136">Když to provedeme, LINQ to SQL automaticky vytvoří třídy večeře a RSVP pomocí schématu tabulek (s vlastnostmi třídy, které se mapují na sloupce databázové tabulky):</span><span class="sxs-lookup"><span data-stu-id="d93be-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="d93be-137">Ve výchozím nastavení LINQ to SQL Návrhář při vytváření tříd založených na schématu databáze automaticky názvy tabulek a sloupců "pluralizes".</span><span class="sxs-lookup"><span data-stu-id="d93be-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="d93be-138">Příklad: tabulka "večeře" v našem příkladu výše má za následek třídu "večeře".</span><span class="sxs-lookup"><span data-stu-id="d93be-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="d93be-139">Tato třída pojmenovává, že naše modely jsou konzistentní s konvencemi názvů .NET a obvykle zjistíte, že je to vhodné pro návrháře, což je pohodlné (obzvláště při přidávání spousty tabulek).</span><span class="sxs-lookup"><span data-stu-id="d93be-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="d93be-140">Pokud se vám nelíbí název třídy nebo vlastnosti, kterou Návrhář generuje, ale můžete ho vždycky přepsat a změnit na libovolný název, který chcete.</span><span class="sxs-lookup"><span data-stu-id="d93be-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="d93be-141">To můžete provést úpravou názvu entity/vlastnosti v rámci návrháře nebo úpravou prostřednictvím mřížky vlastností.</span><span class="sxs-lookup"><span data-stu-id="d93be-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="d93be-142">Ve výchozím nastavení Návrhář LINQ to SQL také kontroluje vztahy primárních klíčů a cizích klíčů v tabulkách a na základě nich automaticky vytvoří výchozí přidružení vztahů mezi různými třídami modelů, které vytvoří.</span><span class="sxs-lookup"><span data-stu-id="d93be-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="d93be-143">Když jsme například přetáhli tabulky večeře a RSVP do návrháře LINQ to SQL a přidružení vztahů 1:1 mezi tyto dvě byla odvozená od faktu, že tabulka s protokolem RSVP obsahovala cizí klíč v tabulce večeře (Toto je označeno šipkou v Návrhář):</span><span class="sxs-lookup"><span data-stu-id="d93be-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="d93be-144">Výše uvedené přidružení způsobí, LINQ to SQL přidat do třídy RSVP vlastnost "večeře", kterou můžou vývojáři použít pro přístup k večeři přidruženému k dané službě RSVP.</span><span class="sxs-lookup"><span data-stu-id="d93be-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="d93be-145">Také způsobí, že třída večeře bude mít vlastnost kolekce "RSVPs", která umožňuje vývojářům načíst a aktualizovat objekty protokolu RSVP spojené s určitou večeři.</span><span class="sxs-lookup"><span data-stu-id="d93be-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="d93be-146">Níže můžete vidět příklad technologie IntelliSense v sadě Visual Studio, když vytvoříme nový objekt protokolu RSVP a přidáte ho do kolekce RSVPs pro večeři.</span><span class="sxs-lookup"><span data-stu-id="d93be-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="d93be-147">Všimněte si, jak LINQ to SQL do objektu večeře automaticky přidat kolekci "RSVPs":</span><span class="sxs-lookup"><span data-stu-id="d93be-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="d93be-148">Přidáním objektu RSVP do kolekce RSVP pro večeři oznamujeme LINQ to SQL k přidružení vztahu cizího klíče mezi večeři a řádkem RSVP v naší databázi:</span><span class="sxs-lookup"><span data-stu-id="d93be-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="d93be-149">Pokud si nejste spokojeni s tím, jak má Návrhář modelovat nebo pojmenovat přidružení tabulky, můžete ho přepsat.</span><span class="sxs-lookup"><span data-stu-id="d93be-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="d93be-150">Stačí kliknout na šipku přidružení v návrháři a přistupovat k jejím vlastnostem přes mřížku vlastností a přejmenovat, odstranit nebo upravit.</span><span class="sxs-lookup"><span data-stu-id="d93be-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="d93be-151">U naší aplikace NerdDinner se ale u tříd datového modelu, které vytváříme, dobře hodí výchozí pravidla přidružení, ale můžeme použít jenom výchozí chování.</span><span class="sxs-lookup"><span data-stu-id="d93be-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="d93be-152">NerdDinnerDataContext Class</span><span class="sxs-lookup"><span data-stu-id="d93be-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="d93be-153">Visual Studio automaticky vytvoří třídy .NET, které reprezentují modely a databázové vztahy definované pomocí návrháře LINQ to SQL.</span><span class="sxs-lookup"><span data-stu-id="d93be-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="d93be-154">Třída LINQ to SQL DataContext je vygenerována také pro každý soubor návrháře LINQ to SQL přidaný do řešení.</span><span class="sxs-lookup"><span data-stu-id="d93be-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="d93be-155">Vzhledem k tomu, že jsme jmenovali naši LINQ to SQL položku třídy "NerdDinner", vytvoří se třída DataContext s názvem "NerdDinnerDataContext".</span><span class="sxs-lookup"><span data-stu-id="d93be-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="d93be-156">Tato třída NerdDinnerDataContext je primárním způsobem, jak budeme pracovat s databází.</span><span class="sxs-lookup"><span data-stu-id="d93be-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="d93be-157">Naše třída NerdDinnerDataContext zpřístupňuje dvě vlastnosti – "večeře" a "RSVP", které reprezentují dvě tabulky, které v databázi modelují.</span><span class="sxs-lookup"><span data-stu-id="d93be-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="d93be-158">Můžeme použít C# k zápisu dotazů LINQ na tyto vlastnosti pro dotazování a načtení objektů večeře a RSVP z databáze.</span><span class="sxs-lookup"><span data-stu-id="d93be-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="d93be-159">Následující kód ukazuje, jak vytvořit instanci objektu NerdDinnerDataContext a provést dotaz LINQ na něj a získat tak sekvenci večeře, ke kterým dochází v budoucnosti.</span><span class="sxs-lookup"><span data-stu-id="d93be-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="d93be-160">Visual Studio poskytuje úplnou technologii IntelliSense při psaní dotazu LINQ a objekty, které jsou z něj vráceny, jsou silné a také podporují technologii IntelliSense:</span><span class="sxs-lookup"><span data-stu-id="d93be-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="d93be-161">Kromě toho, že nám umožníme dotazovat se na objekty večeře a RSVP, NerdDinnerDataContext také automaticky sleduje veškeré změny, které následně provedeme na večeři a v objektech RSVP, které prostřednictvím něj získáváme.</span><span class="sxs-lookup"><span data-stu-id="d93be-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="d93be-162">Pomocí této funkce můžeme snadno uložit změny zpět do databáze, aniž byste museli psát explicitní kód aktualizace SQL.</span><span class="sxs-lookup"><span data-stu-id="d93be-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="d93be-163">Například kód níže ukazuje, jak použít dotaz LINQ k načtení jednoho objektu večeře z databáze, aktualizaci dvou vlastností večeře a následné změny uložit zpět do databáze:</span><span class="sxs-lookup"><span data-stu-id="d93be-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="d93be-164">Objekt NerdDinnerDataContext v kódu výše automaticky sleduje změny vlastností provedené u objektu večeře, který z něho načetli.</span><span class="sxs-lookup"><span data-stu-id="d93be-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="d93be-165">Když se říká metoda "SubmitChanges ()", spustí se odpovídající příkaz SQL "UPDATE" do databáze, aby se aktualizované hodnoty zachovaly zpátky.</span><span class="sxs-lookup"><span data-stu-id="d93be-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="d93be-166">Vytvoření třídy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="d93be-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="d93be-167">Pro malé aplikace je někdy dobré pracovat s řadiči přímo proti třídě LINQ to SQL DataContext a vkládat dotazy LINQ v rámci řadičů.</span><span class="sxs-lookup"><span data-stu-id="d93be-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="d93be-168">Jelikož se aplikace dostanou větší, ale tento přístup je nenáročný na údržbu a testování.</span><span class="sxs-lookup"><span data-stu-id="d93be-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="d93be-169">Může také vést k tomu, že máme duplikovat stejné dotazy LINQ na více místech.</span><span class="sxs-lookup"><span data-stu-id="d93be-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="d93be-170">Jedním z přístupů, které umožňují snazší údržbu a testování aplikací, je použití vzoru "úložiště".</span><span class="sxs-lookup"><span data-stu-id="d93be-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="d93be-171">Třída úložiště pomáhá zapouzdření logiky dotazování a trvalosti dat a abstrakce informace o implementaci trvalosti dat z aplikace.</span><span class="sxs-lookup"><span data-stu-id="d93be-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="d93be-172">Kromě toho, že použití čističe kódu aplikace, může pomocí vzoru úložiště snadněji měnit implementace úložiště dat v budoucnu a může pomoci při testování částí aplikace bez nutnosti skutečné databáze.</span><span class="sxs-lookup"><span data-stu-id="d93be-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="d93be-173">Pro naši aplikaci NerdDinner definujeme třídu DinnerRepository s níže uvedeným podpisem:</span><span class="sxs-lookup"><span data-stu-id="d93be-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="d93be-174">*Poznámka: později v této kapitole budeme z této třídy extrahovat rozhraní IDinnerRepository a na našem řadiči povolit vkládání závislostí. Začněte tím, že začnete pracovat jednoduchým způsobem a přímo pracujete přímo s třídou DinnerRepository.*</span><span class="sxs-lookup"><span data-stu-id="d93be-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="d93be-175">Pokud chcete tuto třídu implementovat, klikněte pravým tlačítkem na naši složku modely a vyberte příkaz nabídky **Přidat novou položku&gt;** .</span><span class="sxs-lookup"><span data-stu-id="d93be-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="d93be-176">V dialogovém okně Přidat novou položku vyberete šablonu Class (třída) a pojmenujte soubor "DinnerRepository.cs":</span><span class="sxs-lookup"><span data-stu-id="d93be-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="d93be-177">Pak můžeme implementovat naši třídu DinnerRepository pomocí následujícího kódu:</span><span class="sxs-lookup"><span data-stu-id="d93be-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="d93be-178">Načítání, aktualizace, vkládání a odstraňování pomocí třídy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="d93be-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="d93be-179">Teď, když jsme vytvořili naši třídu DinnerRepository, Podívejme se na několik příkladů kódu, které předvádějí běžné úlohy, které s ní můžeme dělat:</span><span class="sxs-lookup"><span data-stu-id="d93be-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="d93be-180">Příklady dotazování</span><span class="sxs-lookup"><span data-stu-id="d93be-180">Querying Examples</span></span>

<span data-ttu-id="d93be-181">Následující kód načte jednu večeři pomocí hodnoty DinnerID:</span><span class="sxs-lookup"><span data-stu-id="d93be-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="d93be-182">Následující kód načte všechny nadcházející večeře a cykly přes ně:</span><span class="sxs-lookup"><span data-stu-id="d93be-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="d93be-183">Příklady vložení a aktualizace</span><span class="sxs-lookup"><span data-stu-id="d93be-183">Insert and Update Examples</span></span>

<span data-ttu-id="d93be-184">Následující kód ukazuje přidání dvou nových večeři.</span><span class="sxs-lookup"><span data-stu-id="d93be-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="d93be-185">Přidání/úpravy do úložiště nejsou potvrzeny do databáze, dokud není pro ni volána metoda Save ().</span><span class="sxs-lookup"><span data-stu-id="d93be-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="d93be-186">LINQ to SQL automaticky zalomí všechny změny v transakční transakci – takže buď dojde k žádným změnám, nebo žádná z nich, když naše úložiště uloží:</span><span class="sxs-lookup"><span data-stu-id="d93be-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="d93be-187">Následující kód načte existující objekt večeře a upraví na něm dvě vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="d93be-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="d93be-188">Změny jsou potvrzeny zpět do databáze při volání metody Save () v našem úložišti:</span><span class="sxs-lookup"><span data-stu-id="d93be-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="d93be-189">Následující kód načte večeři a pak k němu přidá odpověď.</span><span class="sxs-lookup"><span data-stu-id="d93be-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="d93be-190">K tomu slouží pomocí kolekce RSVPs na objektu večeře, kterou LINQ to SQL vytvořili pro nás (protože mezi nimi existuje vztah primárního klíče/cizího klíče mezi dvěma v databázi).</span><span class="sxs-lookup"><span data-stu-id="d93be-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="d93be-191">Tato změna se uloží zpátky do databáze jako nový řádek tabulky protokolu RSVP, když se v úložišti zavolá metoda Save ():</span><span class="sxs-lookup"><span data-stu-id="d93be-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="d93be-192">Odstranit příklad</span><span class="sxs-lookup"><span data-stu-id="d93be-192">Delete Example</span></span>

<span data-ttu-id="d93be-193">Následující kód načte existující objekt večeře a pak ho označí jako odstraněný.</span><span class="sxs-lookup"><span data-stu-id="d93be-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="d93be-194">Když se v úložišti zavolá metoda Save (), potvrdí se odstranění zpátky do databáze:</span><span class="sxs-lookup"><span data-stu-id="d93be-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="d93be-195">Integrace logiky ověřování a obchodních pravidel s třídami modelu</span><span class="sxs-lookup"><span data-stu-id="d93be-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="d93be-196">Integrací logiky ověřování a obchodních pravidel je klíčová součást jakékoli aplikace, která pracuje s daty.</span><span class="sxs-lookup"><span data-stu-id="d93be-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="d93be-197">Ověřování schématu</span><span class="sxs-lookup"><span data-stu-id="d93be-197">Schema Validation</span></span>

<span data-ttu-id="d93be-198">Pokud jsou třídy modelu definovány pomocí návrháře LINQ to SQL, datové typy vlastností v třídách datového modelu odpovídají datovým typům tabulky databáze.</span><span class="sxs-lookup"><span data-stu-id="d93be-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="d93be-199">Příklad: Pokud sloupec "EventDate" v tabulce večeře je "DateTime", třída datového modelu vytvořená LINQ to SQL bude typu "DateTime" (což je vestavěný datový typ rozhraní .NET).</span><span class="sxs-lookup"><span data-stu-id="d93be-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="d93be-200">To znamená, že při pokusu o přiřazení celého čísla nebo logické hodnoty z kódu dojde k chybám kompilace a při pokusu o implicitní převod neplatného typu řetězce za běhu se automaticky vyvolá chyba.</span><span class="sxs-lookup"><span data-stu-id="d93be-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="d93be-201">LINQ to SQL také automaticky zpracuje uvozovací hodnoty SQL za vás při použití řetězců – což pomáhá chránit před útoky prostřednictvím injektáže SQL při jejich použití.</span><span class="sxs-lookup"><span data-stu-id="d93be-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="d93be-202">Ověřování a logika obchodních pravidel</span><span class="sxs-lookup"><span data-stu-id="d93be-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="d93be-203">Ověřování schématu je užitečné v prvním kroku, ale je málo dostatečné.</span><span class="sxs-lookup"><span data-stu-id="d93be-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="d93be-204">Většina scénářů reálného světa vyžaduje možnost zadat bohatou logiku ověřování, která může zahrnovat více vlastností, spouštět kód a často má na vědomí stav modelu (například: je vytvořen/Updated/Deleted nebo v rámci stavu specifického pro doménu, jako je "archivovaný").</span><span class="sxs-lookup"><span data-stu-id="d93be-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="d93be-205">Existuje celá řada různých vzorů a platforem, které lze použít k definování a použití ověřovacích pravidel pro třídy modelů a k dispozici je několik platforem rozhraní .NET, které je možné použít k tomu, aby s ní mohli pomáhat.</span><span class="sxs-lookup"><span data-stu-id="d93be-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="d93be-206">V aplikacích ASP.NET MVC můžete použít poměrně mnoho z nich.</span><span class="sxs-lookup"><span data-stu-id="d93be-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="d93be-207">Pro účely naší aplikace NerdDinner použijeme model poměrně jednoduchého a přímého přesměrování, kde vystavíme vlastnost IsValid a metodu GetRuleViolations () pro náš objekt modelu večeře.</span><span class="sxs-lookup"><span data-stu-id="d93be-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="d93be-208">Vlastnost IsValid vrátí hodnotu true nebo false v závislosti na tom, zda jsou všechna platná ověřování a obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="d93be-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="d93be-209">Metoda GetRuleViolations () vrátí seznam chyb pravidel.</span><span class="sxs-lookup"><span data-stu-id="d93be-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="d93be-210">Pro náš model večeře implementujeme IsValid a GetRuleViolations () přidáním "částečné třídy" do našeho projektu.</span><span class="sxs-lookup"><span data-stu-id="d93be-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="d93be-211">Částečné třídy lze použít k přidání metod/vlastností/událostí do tříd udržovaných návrhářem VS (jako je například třída večeře vygenerovaná návrhářem LINQ to SQL) a zabránění tomu, aby se nástroj mohl vyhnout v používání našeho kódu.</span><span class="sxs-lookup"><span data-stu-id="d93be-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="d93be-212">Do našeho projektu můžeme přidat novou částečnou třídu tak, že kliknete pravým tlačítkem na složku \Models a pak vyberete příkaz nabídky Přidat novou položku.</span><span class="sxs-lookup"><span data-stu-id="d93be-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="d93be-213">Pak můžeme zvolit šablonu Class v dialogovém okně Přidat novou položku a pojmenovat ji Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="d93be-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="d93be-214">Kliknutím na tlačítko Přidat se do projektu přidá soubor Dinner.cs a otevře se v rámci integrovaného vývojového prostředí (IDE).</span><span class="sxs-lookup"><span data-stu-id="d93be-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="d93be-215">Pak můžeme implementovat základní rozhraní pro vynucování pravidel a ověření pomocí následujícího kódu:</span><span class="sxs-lookup"><span data-stu-id="d93be-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="d93be-216">Pár poznámek o výše uvedeném kódu:</span><span class="sxs-lookup"><span data-stu-id="d93be-216">A few notes about the above code:</span></span>

- <span data-ttu-id="d93be-217">Třída večeře je uvozená klíčovým slovem "Partial" – to znamená, že kód obsažený v něm bude kombinován s třídou generovanou/udržovanou návrhářem LINQ to SQL a zkompilován do jedné třídy.</span><span class="sxs-lookup"><span data-stu-id="d93be-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="d93be-218">Třída RuleViolation je pomocná třída, kterou přidáme do projektu, který nám umožní poskytnout další podrobnosti o porušení pravidla.</span><span class="sxs-lookup"><span data-stu-id="d93be-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="d93be-219">Metoda večeře. GetRuleViolations () způsobí vyhodnocení našich ověřovacích a obchodních pravidel (budeme je za chvíli implementovat).</span><span class="sxs-lookup"><span data-stu-id="d93be-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="d93be-220">Pak vrátí sekvenci RuleViolation objektů, které poskytují další podrobnosti o chybách pravidel.</span><span class="sxs-lookup"><span data-stu-id="d93be-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="d93be-221">Vlastnost večeře. IsValid poskytuje pohodlnou pomocnou vlastnost, která označuje, zda objekt večeře obsahuje všechny aktivní RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="d93be-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="d93be-222">Může být aktivně kontrolován vývojářem s využitím objektu večeře v čase (a nevyvolá výjimku).</span><span class="sxs-lookup"><span data-stu-id="d93be-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="d93be-223">Částečnou metodou večeře. OnValidate () je připojení, které LINQ to SQL poskytuje, aby bylo možné upozornit na trvalou upozorňování objektu večeře v rámci databáze.</span><span class="sxs-lookup"><span data-stu-id="d93be-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="d93be-224">Naše implementace OnValidate () výše zajišťuje, že večeře nemá žádné RuleViolations předtím, než se uloží.</span><span class="sxs-lookup"><span data-stu-id="d93be-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="d93be-225">Pokud je v neplatném stavu, vyvolá výjimku, která způsobí, že LINQ to SQL přeruší transakci.</span><span class="sxs-lookup"><span data-stu-id="d93be-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="d93be-226">Tento přístup poskytuje jednoduchou architekturu, kterou můžeme do portálu integrovat ověřování a obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="d93be-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="d93be-227">Nyní přidáme níže uvedená pravidla do naší metody GetRuleViolations ():</span><span class="sxs-lookup"><span data-stu-id="d93be-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="d93be-228">C# K vrácení posloupnosti všech RuleViolations používáme funkci yield return.</span><span class="sxs-lookup"><span data-stu-id="d93be-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="d93be-229">Prvních šest kontrol pravidel výše vynutilo, že vlastnosti řetězce na naší večeři nemůžou být null ani prázdné.</span><span class="sxs-lookup"><span data-stu-id="d93be-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="d93be-230">Poslední pravidlo je trochu zajímavější a volá pomocnou metodu PhoneValidator. IsValidNumber (), kterou můžeme do projektu přidat a ověřit tak, že formát čísla ContactPhone odpovídá zemi večeře.</span><span class="sxs-lookup"><span data-stu-id="d93be-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="d93be-231">Můžeme použít. Podpora regulárních výrazů netto pro implementaci této podpory ověřování pro telefon.</span><span class="sxs-lookup"><span data-stu-id="d93be-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="d93be-232">Níže je uvedená Jednoduchá implementace PhoneValidator, kterou můžeme přidat do našeho projektu, který nám umožňuje přidat kontroly vzorů regulárního výrazu specifické pro danou zemi:</span><span class="sxs-lookup"><span data-stu-id="d93be-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="d93be-233">Zpracování ověřování a porušení obchodní logiky</span><span class="sxs-lookup"><span data-stu-id="d93be-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="d93be-234">Teď, když jsme přidali výše uvedený kód pro ověření a obchodní pravidlo, pokaždé, když se pokusíme vytvořit nebo aktualizovat večeři, naše pravidla logiky ověřování se vyhodnotí a vynutila.</span><span class="sxs-lookup"><span data-stu-id="d93be-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="d93be-235">Vývojáři mohou napsat kód podobný níže, aby proaktivně určil, zda je objekt večeře platný, a načíst seznam všech porušení v něm, aniž by vyvolali výjimky:</span><span class="sxs-lookup"><span data-stu-id="d93be-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="d93be-236">Pokud se pokusíme Uložit večeři v neplatném stavu, vyvolá se výjimka při volání metody Save () na DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="d93be-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="d93be-237">Důvodem je, že LINQ to SQL automaticky volá částečnou metodu večeře. OnValidate () předtím, než uloží změny v večeři, a přidáme kód do večeři. OnValidate (), který vyvolá výjimku, pokud v večeři existují porušení pravidel.</span><span class="sxs-lookup"><span data-stu-id="d93be-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="d93be-238">Tuto výjimku můžeme zachytit a znovu aktivně načíst seznam porušení, která se mají opravit:</span><span class="sxs-lookup"><span data-stu-id="d93be-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="d93be-239">Vzhledem k tomu, že naše ověřování a obchodní pravidla jsou implementována v rámci naší vrstvy modelu a ne v rámci vrstvy uživatelského rozhraní, budou použita a použita ve všech scénářích v rámci naší aplikace.</span><span class="sxs-lookup"><span data-stu-id="d93be-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="d93be-240">Později můžeme změnit nebo přidat obchodní pravidla a všechny kódy, které se budou pracovat s našimi objekty večeře, je respektují.</span><span class="sxs-lookup"><span data-stu-id="d93be-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="d93be-241">Flexibilita při změně obchodních pravidel na jednom místě, bez toho, aby byly tyto změny probíhají v celé aplikaci a v logice uživatelského rozhraní, je znaménkem dobře zapsané aplikace a výhodou, kterou architektura MVC pomáhá povzbudit.</span><span class="sxs-lookup"><span data-stu-id="d93be-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="d93be-242">Další krok</span><span class="sxs-lookup"><span data-stu-id="d93be-242">Next Step</span></span>

<span data-ttu-id="d93be-243">Nyní jsme získali model, který můžeme použít k dotazování i k aktualizaci naší databáze.</span><span class="sxs-lookup"><span data-stu-id="d93be-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="d93be-244">Teď přidáme do projektu některé řadiče a zobrazení, které můžeme použít k sestavení prostředí uživatelského rozhraní HTML.</span><span class="sxs-lookup"><span data-stu-id="d93be-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d93be-245">[Předchozí](create-a-database.md)
> [Další](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="d93be-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
