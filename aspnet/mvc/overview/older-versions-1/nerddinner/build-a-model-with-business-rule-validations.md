---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Sestavení modelu s ověřením obchodních pravidel | Dokumentace Microsoftu
author: microsoft
description: Krok 3 ukazuje, jak vytvořit model, že jsme pomocí obou dotazů a aktualizace databáze pro naši aplikaci NerdDinner.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 078614c6e7ba18ac09bbd5e23b90b08c97aee658
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/17/2019
ms.locfileid: "59387292"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="a2d4b-103">Vytvoření modelu s ověřením obchodních pravidel</span><span class="sxs-lookup"><span data-stu-id="a2d4b-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="a2d4b-104">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="a2d4b-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="a2d4b-105">Stáhnout PDF</span><span class="sxs-lookup"><span data-stu-id="a2d4b-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="a2d4b-106">Toto je kroku 3 tohoto bezplatného [kurz vývoje aplikace "NerdDinner"](introducing-the-nerddinner-tutorial.md) , který procházení procházení po tom, jak sestavit malý, ale bylo možné provést, webové aplikace pomocí ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="a2d4b-107">Krok 3 ukazuje, jak vytvořit model, že jsme pomocí obou dotazů a aktualizace databáze pro naši aplikaci NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="a2d4b-108">Pokud používáte ASP.NET MVC 3, doporučujeme je provést [získávání začít s MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) nebo [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) kurzy.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="a2d4b-109">NerdDinner krok 3: Sestavení modelu</span><span class="sxs-lookup"><span data-stu-id="a2d4b-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="a2d4b-110">V rozhraní framework model-view-controller termín "model" odkazuje na objekty, jež reprezentují data z aplikace, stejně jako odpovídající logiku domény, která se integruje obchodních pravidel ověřování a s ním.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="a2d4b-111">Model se ve spoustě ohledů "Srdce" aplikace využívající architekturu MVC a jak uvidíme dále zásadním způsobem řídí chování ho.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="a2d4b-112">Architektura ASP.NET MVC podporuje používání technologií pro přístup k libovolné data a vývojáři můžete vybrat z celé řady možností bohaté .NET dat k implementaci jejich modelů, včetně: Technologie LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, nebo jenom nezpracovaná čtečky dat ADO.NET nebo datové sady.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="a2d4b-113">Pro naši aplikaci NerdDinner budeme používat technologie LINQ to SQL vytvořit jednoduchý model, který odpovídá poměrně blízko našich návrhu databáze a přidá některé vlastní ověřovací logiky a obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="a2d4b-114">Jsme pak implementuje třídu úložiště, která pomáhá okamžitě abstraktní implementace trvalosti dat od zbývající části aplikace a umožňuje nám to snadno jednotky testování.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="a2d4b-115">Technologie LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="a2d4b-115">LINQ to SQL</span></span>

<span data-ttu-id="a2d4b-116">Technologie LINQ to SQL je ORM (relační mapování objektů), která je dodávána jako součást rozhraní .NET 3.5.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="a2d4b-117">Technologie LINQ to SQL poskytuje snadný způsob, jak mapovat na třídy rozhraní .NET, kterou jsme můžete psát kód s využitím databázových tabulek.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="a2d4b-118">Naše aplikace NerdDinner použijeme ji k mapování tabulek večeří a reakce v rámci naší databázi do třídy Dinner a reakce.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="a2d4b-119">Sloupce tabulky večeří a reakce bude odpovídat vlastnosti třídy Dinner a reakce.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="a2d4b-120">Každý objekt Dinner a RSVP bude reprezentovat samostatných řádků v rámci večeří nebo RSVP tabulek v databázi.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="a2d4b-121">Technologie LINQ to SQL umožňuje vyhnout se tak nutnosti ručně vytvořit příkazy SQL se načítají a aktualizují Dinner a RSVP objekty pomocí dat z databáze.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="a2d4b-122">Místo toho budeme definovat třídy Dinner a reakce, jak jsou mapovány do/z databáze a vztahy mezi nimi.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="a2d4b-123">Technologie LINQ to SQL se potom vezme péče o generování odpovídající logiky provádění SQL pro použití za běhu při budeme pracovat a jejich použití.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="a2d4b-124">Podpora jazyka LINQ v jazyce Visual Basic a C# jsme můžete použít k zápisu výrazové dotazů, které načítají Dinner a RSVP objekty z databáze.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="a2d4b-125">Tím se minimalizují množství dat kódu musíme napsat, a umožňuje vytvářet hezky čistý aplikace.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="a2d4b-126">Přidání třídy LINQ to SQL na našem projektu</span><span class="sxs-lookup"><span data-stu-id="a2d4b-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="a2d4b-127">Použijeme začněte tím, že pravým tlačítkem na složku "Modely" v našem projektu a vyberte **Add -&gt;nová položka** příkazu nabídky:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="a2d4b-128">Tím se otevře dialogové okno "Přidat novou položku".</span><span class="sxs-lookup"><span data-stu-id="a2d4b-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="a2d4b-129">Vytvoříme filtrovat podle kategorie "Data" a vyberte šablonu "LINQ na třídy SQL" v rámci něj:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="a2d4b-130">Jsme bude název položky "NerdDinner" a klikněte na tlačítko "Přidat".</span><span class="sxs-lookup"><span data-stu-id="a2d4b-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="a2d4b-131">Visual Studio přidejte NerdDinner.dbml soubor v adresáři naše \Models a potom otevřete LINQ to SQL Návrhář relací objektů:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="a2d4b-132">Vytváření datových tříd modelu pomocí LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="a2d4b-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="a2d4b-133">Technologie LINQ to SQL umožňuje nám to rychle vytvoření tříd datových modelů z existující schéma databáze.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="a2d4b-134">Úkol to nám budete NerdDinner databázi otevřít v Průzkumníku serveru a vyberte tabulky, chceme pro modelování v ní:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="a2d4b-135">Jsme pak můžete přetáhnout tabulky do LINQ na plochu návrháře SQL.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="a2d4b-136">Při provádění této LINQ to SQL se automaticky vytvoří Dinner a RSVP třídy pomocí schématu tabulky (pomocí vlastnosti třídy, které jsou mapovány na sloupce tabulky databáze):</span><span class="sxs-lookup"><span data-stu-id="a2d4b-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="a2d4b-137">Ve výchozím nastavení LINQ to SQL Návrháře automaticky "do množného" názvy tabulek a sloupců při vytváření třídy na základě schématu databáze.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="a2d4b-138">Příklad: ve třídě "Dinner" výsledkem je tabulka "Večeří" v našem příkladu výše.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="a2d4b-139">Tato třída pojmenování jednodušeji naše modely konzistentní s zásady vytváření názvů .NET a obvykle najít tento s návrháře oprava to tak pohodlné (zejména při přidávání velké tabulky).</span><span class="sxs-lookup"><span data-stu-id="a2d4b-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="a2d4b-140">Pokud se vám název třída nebo vlastnost, která generuje návrháře, i když můžete kdykoli přepsat nebo ho změnit na libovolný název, který chcete.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="a2d4b-141">Můžete provést buď tak, že upravíte entity nebo vlastnosti název v řádku v Návrháři nebo úpravou prostřednictvím mřížku vlastností.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="a2d4b-142">Ve výchozím nastavení LINQ to SQL designer také kontroluje primární klíč/cizího klíče tabulky a na jejich základě automaticky vytvoří výchozí "vztah přidružení" mezi třídami jiný model, který vytvoří.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="a2d4b-143">Například, když jsme přetáhli večeří a RSVP tabulky do technologie LINQ to SQL Návrhář vztah jeden mnoho přidružení mezi těmito dvěma byl vyvozen založeno na skutečnosti, že v tabulce RSVP měl cizího klíče tabulky večeří (to je indikován na šipku v Návrhář):</span><span class="sxs-lookup"><span data-stu-id="a2d4b-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="a2d4b-144">Výše uvedené přidružení způsobí LINQ pro SQL za účelem přidání silného typu vlastnosti "Dinner" RSVP třídu, která mohou vývojáři pro přístup k večeři spojené s danou reakce.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="a2d4b-145">Způsobí také mají "RSVPs" kolekce vlastnost, která vývojářům umožňuje načtení a aktualizaci RSVP objekty přidružené k určité Dinner třídy večeři.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="a2d4b-146">Po vytvoření nového objektu RSVP a přidat do kolekce večeři RSVPs níže můžete vidět příklad technologie intellisense v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="a2d4b-147">Všimněte si, jak technologie LINQ to SQL automaticky přidá "RSVPs" kolekce na objekt Dinner:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="a2d4b-148">Přidáním objektu reakce večeři RSVPs kolekce jsme informace o tom, LINQ to SQL pro přidružení cizího klíče relace mezi RSVP řádků v databázi a společnosti Dinner:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="a2d4b-149">Pokud vám nevyhovují, jak má Návrhář modelovat nebo s názvem tabulky přidružení, lze jej přepsat.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="a2d4b-150">Stačí klikněte na šipku přidružení v návrháři a získat přístup k vlastnostem pomocí mřížky vlastností, které chcete přejmenovat, odstranit nebo upravit ho.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="a2d4b-151">Pro naši aplikaci NerdDinner však výchozí pravidla pro přidružení fungují dobře u tříd datových modelů, které vytváříme a můžeme jednoduše použít výchozí chování.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="a2d4b-152">NerdDinnerDataContext Class</span><span class="sxs-lookup"><span data-stu-id="a2d4b-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="a2d4b-153">Visual Studio automaticky vytvoří třídy rozhraní .NET, které představují modely a databáze vztahy definované pomocí LINQ to SQL návrháře.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="a2d4b-154">LINQ na třídy SQL DataContext se také vygeneruje pro každou LINQ na soubor návrháře SQL přidat k řešení.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="a2d4b-155">Protože jsme pojmenovali naše technologie LINQ to SQL tříd – položka "NerdDinner", třídy DataContext vytvořili nazývá "NerdDinnerDataContext".</span><span class="sxs-lookup"><span data-stu-id="a2d4b-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="a2d4b-156">Tato třída NerdDinnerDataContext je primární způsob, jakým jsme bude komunikovat s databází.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="a2d4b-157">Naše třída NerdDinnerDataContext zveřejňuje dvě vlastnosti - "Večeří" a "RSVPs" – které představují dvě tabulky, které jsme modelován v rámci databáze.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="a2d4b-158">Můžeme použít C# pro zápis dotazů LINQ s těmito vlastnostmi na dotazování a načtení Dinner a RSVP objekty z databáze.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="a2d4b-159">Následující kód ukazuje, jak vytvořit instanci objektu NerdDinnerDataContext a provádění dotazu LINQ na jeho získání posloupnost večeří, ke kterým dochází v budoucnu.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="a2d4b-160">Visual Studio obsahuje plnou podporou technologie intellisense při psaní dotazu LINQ a objektů vrácených z něj jsou silného typu a také podporu technologie intellisense:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="a2d4b-161">Mimo možnosti nám se dotázat na večeři a RSVP objekty, NerdDinnerDataContext také automaticky sleduje všechny změny, které následně provedeme Dinner a RSVP objekty, které se nám načíst přes něj.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="a2d4b-162">Můžeme použít tuto funkci a snadno uložte změny zpět do databáze - bez nutnosti psát jakýkoli kód explicitní aktualizace SQL.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="a2d4b-163">Například následující kód ukazuje, jak pomocí dotazu LINQ získal jeden objekt Dinner z databáze, aktualizace dvou vlastností Dinner a potom uložte změny zpět do databáze:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="a2d4b-164">Objekt NerdDinnerDataContext v kódu nad automaticky sleduje vlastnosti změny provedené v Dinner objekt, který jsme získali z něj.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="a2d4b-165">Když budeme volat metodu "SubmitChanges()", provede odpovídající "" aktualizace příkazu SQL na databázi k uchování aktualizovanými hodnotami.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="a2d4b-166">Vytvoření třídy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="a2d4b-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="a2d4b-167">U malých aplikací, je někdy můžete mít řadiče pracovat přímo s LINQ na třídy SQL DataContext a dotazů LINQ v rámci Kontrolery pro vložení.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="a2d4b-168">Při získávání aplikací větší, ale tento přístup se stane náročné na údržbu a testování.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="a2d4b-169">Může také vést k nám duplikace stejného dotazů LINQ na více místech.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="a2d4b-170">Jedním z přístupů, které můžete zpřístupnit aplikace usnadňuje údržbu a testování, je použití vzoru "úložiště".</span><span class="sxs-lookup"><span data-stu-id="a2d4b-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="a2d4b-171">Třídy úložiště umožňuje zapouzdřit podrobnosti implementace trvalost dat z aplikace dotazování dat a logiku trvalosti a přehledů okamžitě.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="a2d4b-172">Kromě toho kód aplikace, čištění, pomocí vzoru úložiště můžete bylo snazší v budoucnu změnit implementace úložiště dat a může být snazší usnadnění testování aplikace bez nutnosti skutečná databáze.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="a2d4b-173">Pro naši aplikaci NerdDinner budeme definovat třídu DinnerRepository s pod podpis:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="a2d4b-174">*Poznámka: Dále v této kapitole vytvoříme extrahovat rozhraní IDinnerRepository z této třídy a povolit injektáž závislostí s ním na naše řadiče. Než začneme ale budeme začít jednoduchými věcmi a právě pracovat přímo s třídou DinnerRepository.*</span><span class="sxs-lookup"><span data-stu-id="a2d4b-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="a2d4b-175">K implementaci této třídy vytvoříme klikněte pravým tlačítkem na složku naše "Modely" a zvolte **Add -&gt;nová položka** příkazu nabídky.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="a2d4b-176">V dialogovém okně "Přidat novou položku" budete výběru šablony "Třída" a "DinnerRepository.cs" Zadejte název souboru:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="a2d4b-177">Pak můžeme implementovat naše DinnerRepository třídy pomocí níže uvedeného kódu:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="a2d4b-178">Načítání, aktualizaci, vkládání a odstranění horizontálních oddílů pomocí třídy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="a2d4b-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="a2d4b-179">Teď, když jsme vytvořili naši DinnerRepository třídy, Podívejme se na několik příkladů kódu, které ukazují běžné úkoly, které jsme s ním může dělat:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="a2d4b-180">Dotazování příklady</span><span class="sxs-lookup"><span data-stu-id="a2d4b-180">Querying Examples</span></span>

<span data-ttu-id="a2d4b-181">Následující kód načte jeden Dinner pomocí DinnerID hodnoty:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>


[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="a2d4b-182">Následující kód načte všechny nadcházející večeří a smyček nad nich:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="a2d4b-183">INSERT a Update příklady</span><span class="sxs-lookup"><span data-stu-id="a2d4b-183">Insert and Update Examples</span></span>

<span data-ttu-id="a2d4b-184">Následující kód ukazuje přidání dvou nových večeří.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="a2d4b-185">Přidání/změny do úložiště nejsou potvrdily v databázi, dokud v něm je volána metoda "Save()".</span><span class="sxs-lookup"><span data-stu-id="a2d4b-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="a2d4b-186">Technologie LINQ to SQL zalomen všechny změny v databázové transakci – tak, aby všechny změny stát nebo žádná z nich dělat, když se uloží naše úložiště:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="a2d4b-187">Následující kód načte existující objekt Dinner a dvě vlastnosti v něm upraví.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="a2d4b-188">Při volání metody "Save()" v našem úložišti se změny potvrdí zpět do databáze:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="a2d4b-189">Následující kód načte dinner a pak do ní přidá odpověď.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="a2d4b-190">Dělá to pomocí kolekce RSVPs Dinner objektu, který technologie LINQ to SQL vytváří (protože vztahu primární key/cizího klíče mezi těmito dvěma v databázi).</span><span class="sxs-lookup"><span data-stu-id="a2d4b-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="a2d4b-191">Tato změna je trvalá zpět do databáze jako nový řádek tabulky RSVP při volání metody "Save()" úložiště:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="a2d4b-192">Odstranit příklad</span><span class="sxs-lookup"><span data-stu-id="a2d4b-192">Delete Example</span></span>

<span data-ttu-id="a2d4b-193">Následující kód načte existující objekt Dinner a pak označí ho odstraníme.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="a2d4b-194">Při volání metody "Save()" v daném úložišti potvrdí odstranění zpět do databáze:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="a2d4b-195">Integrace ověřování a obchodní logiku pravidla s tříd modelu</span><span class="sxs-lookup"><span data-stu-id="a2d4b-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="a2d4b-196">Integrace ověřování a obchodní pravidlo, že logika je klíčovou součástí každou aplikaci, která pracuje s daty.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="a2d4b-197">Ověřování schématu</span><span class="sxs-lookup"><span data-stu-id="a2d4b-197">Schema Validation</span></span>

<span data-ttu-id="a2d4b-198">Když tříd modelu jsou definovány pomocí LINQ to SQL návrháře, datových typů vlastností v tříd datových modelů odpovídají datové typy databázové tabulky.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="a2d4b-199">Příklad: Pokud je ve sloupci "EventDate" v tabulce večeří "datetime", třída modelu dat vytvořené pomocí LINQ to SQL budou typu "Datum a čas" (což je integrované datový typ .NET).</span><span class="sxs-lookup"><span data-stu-id="a2d4b-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="a2d4b-200">To znamená, že se zobrazí chyby při kompilaci, když se pokusíte přiřadit celé číslo nebo logickou hodnotu k ní z kódu, a to vyvolá chybu automaticky při pokusu o pro implicitní převod typu není platný řetězec k němu za běhu.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="a2d4b-201">Technologie LINQ to SQL budou také automaticky zpracovává útěku hodnoty SQL za vás při používání řetězců – které pomáhá chránit před útoky prostřednictvím injektáže SQL při používání.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="a2d4b-202">Ověřování a obchodní logiku pravidla</span><span class="sxs-lookup"><span data-stu-id="a2d4b-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="a2d4b-203">Ověřování schématu je užitečné jako první krok, ale stačí jen zřídka.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="a2d4b-204">Většina scénářů reálného světa vyžaduje schopnost určit bohatší logiku ověřování, který span více vlastností, provádění kódu a sledování stavu modelu mají často (například: je to vytváří/aktualizovat/odstraněný, nebo v rámci stavu specifického pro doménu například "archivované").</span><span class="sxs-lookup"><span data-stu-id="a2d4b-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="a2d4b-205">Existuje široká škála různých vzorů a architektur, které slouží k definování a použití pravidel ověřování do tříd modelu a několik .NET na základě rozhraní produktům, které můžete použít pro usnadnění.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="a2d4b-206">Můžete použít prakticky libovolný z nich v rámci aplikace ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="a2d4b-207">Pro účely naší aplikace NerdDinner použijeme vzor relativně jednoduché a přímočaré kde zveřejňujeme IsValid vlastnost a metodu GetRuleViolations() na náš objekt modelu večeři.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="a2d4b-208">Vlastnost IsValid vrátí hodnotu PRAVDA nebo NEPRAVDA v závislosti na tom, jestli jsou všechny platné ověření a obchodních pravidel.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="a2d4b-209">Metoda GetRuleViolations() zobrazí seznam všech chyb pro pravidlo.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="a2d4b-210">IsValid a GetRuleViolations() budete implementaci pro náš model Dinner přidáním "částečné třídy" do projektu.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="a2d4b-211">Částečné třídy lze použít k přidání metody/vlastnosti/události na třídy udržuje Návrhář VS (např. třídy Dinner generované LINQ to SQL Návrháře) a vyhnout se nástroj z messing pomocí našeho kódu.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="a2d4b-212">Můžeme přidat nové částečné třídy do našich projektu kliknutím pravým tlačítkem na složku \Models a zvolte příkaz "Přidat novou položku".</span><span class="sxs-lookup"><span data-stu-id="a2d4b-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="a2d4b-213">Potom jsme můžete zvolit šablonu "Třída" v dialogovém okně "Přidat novou položku" a pojmenujte ho Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="a2d4b-214">Kliknutím na tlačítko "Přidat" Přidat Dinner.cs soubor do projektu a otevřete ho v rámci rozhraní IDE.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="a2d4b-215">Potom jsme můžete implementovat s použitím rozhraní framework základní pravidla a ověření vynucení níže uvedeného kódu:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="a2d4b-216">Několik poznámek o kódu uvedeného výše:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-216">A few notes about the above code:</span></span>

- <span data-ttu-id="a2d4b-217">Třídy Dinner začíná "částečné" klíčové slovo – což znamená, že kód obsažený v něm budou kombinovat s třídou generována zachovány technologií LINQ to SQL návrháře a zkompilovány do jednu třídu.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="a2d4b-218">Třída RuleViolation je pomocná třída, kterou přidáme do projektu, který nám umožňuje poskytovat podrobnosti o porušení pravidla.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="a2d4b-219">Metoda Dinner.GetRuleViolations() způsobí, že naše ověření a obchodních pravidel, který se má vyhodnotit (jsme budete implementovat je za chvíli).</span><span class="sxs-lookup"><span data-stu-id="a2d4b-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="a2d4b-220">Poté vrátí zpět posloupnost RuleViolation objekty, které poskytují další podrobnosti o případných chybách pravidlo.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="a2d4b-221">Vlastnost Dinner.IsValid poskytuje pohodlné pomocné vlastnost, která označuje, zda má objekt Dinner žádné aktivní RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="a2d4b-222">To lze proaktivně zkontrolovat vývojáři, kteří pomocí objektu Dinner kdykoli (a nevyvolá výjimku).</span><span class="sxs-lookup"><span data-stu-id="a2d4b-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="a2d4b-223">Částečná metoda Dinner.OnValidate() je hák, která poskytuje technologii LINQ to SQL, která umožňuje být upozornění vždy, když objekt Dinner je nastavit jako trvalý, v databázi.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="a2d4b-224">Naše implementace OnValidate() výše zajistí, že večeře nemá žádné RuleViolations před uložením.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="a2d4b-225">Pokud je v neplatném stavu, vyvolá výjimku, která způsobí, že LINQ to SQL přerušení transakce.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="a2d4b-226">Tento přístup poskytuje jednoduché rozhraní, které budeme integrovat ověření a obchodních pravidel do.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="a2d4b-227">Teď přidáme následující pravidla, která metodě GetRuleViolations():</span><span class="sxs-lookup"><span data-stu-id="a2d4b-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="a2d4b-228">Funkce "yield return" jazyka C# se používá k vrácení sekvence všechny RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="a2d4b-229">První šest pravidla kontroly nad jednoduše vynutit, že vlastnosti řetězce na náš web Dinner nemůže být null ani prázdný.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="a2d4b-230">Poslední pravidlo je o něco zajímavější a volání PhoneValidator.IsValidNumber() Pomocná metoda, že můžeme přidat na náš projekt a ověřte, zda ContactPhone číslo formátu shody společnosti Dinner vaší země.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="a2d4b-231">Můžeme použít. Podpora NET pro regulární výraz k implementaci této telefonické ověření.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="a2d4b-232">Níže je jednoduchý PhoneValidator implementace, která můžeme přidat do projektu, která umožňuje přidat specifické pro zemi kontroly vzor regulárního výrazu:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="a2d4b-233">Ověření zpracování a obchodní logiky porušení</span><span class="sxs-lookup"><span data-stu-id="a2d4b-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="a2d4b-234">Teď, přidali jsme ve výše uvedeném ověřování a obchodní pravidlo kódu, pokaždé, když se pokusíme vytvořit nebo aktualizovat večeři, bude náš ověřovací logiky pravidla vyhodnotí a vynucovat.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="a2d4b-235">Vývojářům psát kód jako níže proaktivně určit, jestli je platný objekt Dinner a načíst seznam všechna narušení v něm bez vyvolání výjimky:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="a2d4b-236">Pokud jsme pokus o uložení večeře v neplatném stavu, bude vyvolána výjimka, když jsme volání metody Save() na DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="a2d4b-237">K tomu dojde, vzhledem k tomu před uložením změn webu Dinner a jsme přidali kód do Dinner.OnValidate() vyvolat výjimku, pokud je porušení pravidel v společnosti Dinner technologie LINQ to SQL automaticky volá naše Dinner.OnValidate() částečnou metodu.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="a2d4b-238">Můžeme tuto výjimku zachytit a reaktivně načítat seznam porušení opravit:</span><span class="sxs-lookup"><span data-stu-id="a2d4b-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="a2d4b-239">Vzhledem k tomu, že naše ověření a obchodních pravidel jsou implementovány v rámci naší modelu vrstvy a není ve vrstvě uživatelského rozhraní, budou se použít a použít v rámci všech scénářů v rámci naší aplikace.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="a2d4b-240">Můžete později změnit nebo přidat obchodní pravidla a mít veškerý kód, že funguje s objekty naše společnost Dinner případném dalším sdílení dodržovat je.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="a2d4b-241">S flexibilitu při změně obchodních pravidel na jednom místě, bez nutnosti tyto změny ripple v celé aplikaci a logika uživatelského rozhraní, je znak kvalitní aplikace a výhody, které rozhraní MVC pomáhá podporovat.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="a2d4b-242">Dalším krokem</span><span class="sxs-lookup"><span data-stu-id="a2d4b-242">Next Step</span></span>

<span data-ttu-id="a2d4b-243">Teď máme modelu, který můžeme použít jak dotazování a aktualizace databáze.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="a2d4b-244">Teď přidáme několik kontrolerů a zobrazení pro projekt, který můžeme použít k vytvoření uživatelského rozhraní HTML prostředí kolem něj.</span><span class="sxs-lookup"><span data-stu-id="a2d4b-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a2d4b-245">[Předchozí](create-a-database.md)
> [další](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="a2d4b-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
