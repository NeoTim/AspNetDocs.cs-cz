---
uid: mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
title: Vytvoření modelu s ověřením obchodních pravidel | Dokumenty společnosti Microsoft
author: rick-anderson
description: Krok 3 ukazuje, jak vytvořit model, který můžeme použít k dotazu a aktualizaci databáze pro naši aplikaci NerdDinner.
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 0bc191b2-4311-479a-a83a-7f1b1c32e6fe
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/build-a-model-with-business-rule-validations
msc.type: authoredcontent
ms.openlocfilehash: 1a316e9051cf56cd4f1546336b334ace991c05b3
ms.sourcegitcommit: 022f79dbc1350e0c6ffaa1e7e7c6e850cdabf9af
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/17/2020
ms.locfileid: "81541634"
---
# <a name="build-a-model-with-business-rule-validations"></a><span data-ttu-id="44a5c-103">Vytvoření modelu s ověřením obchodních pravidel</span><span class="sxs-lookup"><span data-stu-id="44a5c-103">Build a Model with Business Rule Validations</span></span>

<span data-ttu-id="44a5c-104">podle [společnosti Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="44a5c-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="44a5c-105">Stáhnout PDF</span><span class="sxs-lookup"><span data-stu-id="44a5c-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="44a5c-106">Toto je krok 3 zdarma ["NerdDinner" aplikační kurz,](introducing-the-nerddinner-tutorial.md) který prochází, jak vytvořit malé, ale kompletní, webové aplikace pomocí ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="44a5c-106">This is step 3 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="44a5c-107">Krok 3 ukazuje, jak vytvořit model, který můžeme použít k dotazu a aktualizaci databáze pro naši aplikaci NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="44a5c-107">Step 3 shows how to create a model that we can use to both query and update the database for our NerdDinner application.</span></span>
> 
> <span data-ttu-id="44a5c-108">Pokud používáte ASP.NET MVC 3, doporučujeme postupovat podle kurzů [Začínáme s MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) nebo [MVC Music Store.](../../older-versions/mvc-music-store/mvc-music-store-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="44a5c-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-3-building-the-model"></a><span data-ttu-id="44a5c-109">NerdDinner Krok 3: Stavební model</span><span class="sxs-lookup"><span data-stu-id="44a5c-109">NerdDinner Step 3: Building the Model</span></span>

<span data-ttu-id="44a5c-110">V rámci model-view-controller termín "model" odkazuje na objekty, které představují data aplikace, stejně jako odpovídající logiku domény, která integruje ověření a obchodní pravidla s ním.</span><span class="sxs-lookup"><span data-stu-id="44a5c-110">In a model-view-controller framework the term "model" refers to the objects that represent the data of the application, as well as the corresponding domain logic that integrates validation and business rules with it.</span></span> <span data-ttu-id="44a5c-111">Model je v mnoha ohledech "srdce" aplikace založené na MVC, a jak uvidíme později zásadně řídí chování to.</span><span class="sxs-lookup"><span data-stu-id="44a5c-111">The model is in many ways the "heart" of an MVC-based application, and as we'll see later fundamentally drives the behavior of it.</span></span>

<span data-ttu-id="44a5c-112">Rozhraní ASP.NET MVC podporuje použití jakékoli technologie přístupu k datům a vývojáři si mohou vybrat z různých bohatých možností dat .NET implementovat své modely, včetně: LINQ entity, LINQ na SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM nebo jen raw ADO.NET DataReaders nebo DataSets.</span><span class="sxs-lookup"><span data-stu-id="44a5c-112">The ASP.NET MVC framework supports using any data access technology, and developers can choose from a variety of rich .NET data options to implement their models including: LINQ to Entities, LINQ to SQL, NHibernate, LLBLGen Pro, SubSonic, WilsonORM, or just raw ADO.NET DataReaders or DataSets.</span></span>

<span data-ttu-id="44a5c-113">Pro naši aplikaci NerdDinner budeme používat LINQ na SQL vytvořit jednoduchý model, který odpovídá poměrně úzce naše databáze design a přidává některé vlastní ověřování logiky a obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="44a5c-113">For our NerdDinner application we are going to use LINQ to SQL to create a simple model that corresponds fairly closely to our database design, and adds some custom validation logic and business rules.</span></span> <span data-ttu-id="44a5c-114">Poté implementujeme třídu úložiště, která pomáhá abstrahovat implementaci trvalosti dat od zbytku aplikace a umožňuje nám snadno ji testovat.</span><span class="sxs-lookup"><span data-stu-id="44a5c-114">We will then implement a repository class that helps abstract away the data persistence implementation from the rest of the application, and enables us to easily unit test it.</span></span>

### <a name="linq-to-sql"></a><span data-ttu-id="44a5c-115">Technologie LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="44a5c-115">LINQ to SQL</span></span>

<span data-ttu-id="44a5c-116">LINQ to SQL je ORM (objekt relační mapovač), který je dodáván jako součást .NET 3.5.</span><span class="sxs-lookup"><span data-stu-id="44a5c-116">LINQ to SQL is an ORM (object relational mapper) that ships as part of .NET 3.5.</span></span>

<span data-ttu-id="44a5c-117">LINQ to SQL poskytuje snadný způsob mapování databázových tabulek na třídy .NET, proti které můžeme kódovat.</span><span class="sxs-lookup"><span data-stu-id="44a5c-117">LINQ to SQL provides an easy way to map database tables to .NET classes we can code against.</span></span> <span data-ttu-id="44a5c-118">Pro naši aplikaci NerdDinner ji použijeme k mapování tabulek Dinners a RSVP v rámci naší databáze na třídy Dinner a RSVP.</span><span class="sxs-lookup"><span data-stu-id="44a5c-118">For our NerdDinner application we'll use it to map the Dinners and RSVP tables within our database to Dinner and RSVP classes.</span></span> <span data-ttu-id="44a5c-119">Sloupce tabulky Večeře a RSVP bude odpovídat vlastnosti na večeři a RSVP třídy.</span><span class="sxs-lookup"><span data-stu-id="44a5c-119">The columns of the Dinners and RSVP tables will correspond to properties on the Dinner and RSVP classes.</span></span> <span data-ttu-id="44a5c-120">Každý Dinner a RSVP objekt bude představovat samostatný řádek v rámci večeří nebo RSVP tabulky v databázi.</span><span class="sxs-lookup"><span data-stu-id="44a5c-120">Each Dinner and RSVP object will represent a separate row within the Dinners or RSVP tables in the database.</span></span>

<span data-ttu-id="44a5c-121">LINQ to SQL nám umožňuje vyhnout se nutnosti ručně vytvářet příkazy SQL k načtení a aktualizaci objektů Dinner a RSVP s daty databáze.</span><span class="sxs-lookup"><span data-stu-id="44a5c-121">LINQ to SQL allows us to avoid having to manually construct SQL statements to retrieve and update Dinner and RSVP objects with database data.</span></span> <span data-ttu-id="44a5c-122">Místo toho budeme definovat večeři a RSVP třídy, jak se mapovat do/z databáze a vztahy mezi nimi.</span><span class="sxs-lookup"><span data-stu-id="44a5c-122">Instead, we'll define the Dinner and RSVP classes, how they map to/from the database, and the relationships between them.</span></span> <span data-ttu-id="44a5c-123">LINQ na SQL se pak postará o generování příslušné logiky spuštění SQL pro použití za běhu při interakci a jejich použití.</span><span class="sxs-lookup"><span data-stu-id="44a5c-123">LINQ to SQL will then takes care of generating the appropriate SQL execution logic to use at runtime when we interact and use them.</span></span>

<span data-ttu-id="44a5c-124">Můžeme použít podporu jazyka LINQ v rámci VB a C# k zápisu expresivní dotazy, které načítají Dinner a RSVP objekty z databáze.</span><span class="sxs-lookup"><span data-stu-id="44a5c-124">We can use the LINQ language support within VB and C# to write expressive queries that retrieve Dinner and RSVP objects from the database.</span></span> <span data-ttu-id="44a5c-125">Tím se minimalizuje množství datového kódu, který potřebujeme napsat, a umožňuje nám vytvářet opravdu čisté aplikace.</span><span class="sxs-lookup"><span data-stu-id="44a5c-125">This minimizes the amount of data code we need to write, and allows us to build really clean applications.</span></span>

### <a name="adding-linq-to-sql-classes-to-our-project"></a><span data-ttu-id="44a5c-126">Přidání LINQ do tříd SQL do našeho projektu</span><span class="sxs-lookup"><span data-stu-id="44a5c-126">Adding LINQ to SQL Classes to our project</span></span>

<span data-ttu-id="44a5c-127">Začneme kliknutím pravým tlačítkem myši na složku "Modely" v rámci našeho projektu a vybereme příkaz Nabídky **Přidat&gt;novou položku:**</span><span class="sxs-lookup"><span data-stu-id="44a5c-127">We'll begin by right-clicking on the "Models" folder within our project, and select the **Add-&gt;New Item** menu command:</span></span>

![](build-a-model-with-business-rule-validations/_static/image1.png)

<span data-ttu-id="44a5c-128">Tím se zobrazí dialogové okno Přidat novou položku.</span><span class="sxs-lookup"><span data-stu-id="44a5c-128">This will bring up the "Add New Item" dialog.</span></span> <span data-ttu-id="44a5c-129">Budeme filtrovat podle kategorie "Data" a vyberte šablonu "LINQ to SQL Classes" v ní:</span><span class="sxs-lookup"><span data-stu-id="44a5c-129">We'll filter by the "Data" category and select the "LINQ to SQL Classes" template within it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image2.png)

<span data-ttu-id="44a5c-130">Pojmenujeme položku "NerdDinner" a klikneme na tlačítko "Přidat".</span><span class="sxs-lookup"><span data-stu-id="44a5c-130">We'll name the item "NerdDinner" and click the "Add" button.</span></span> <span data-ttu-id="44a5c-131">Visual Studio přidá soubor NerdDinner.dbml pod naším adresářem \Models a potom otevře návrhář relační objektu LINQ na SQL:</span><span class="sxs-lookup"><span data-stu-id="44a5c-131">Visual Studio will add a NerdDinner.dbml file under our \Models directory, and then open the LINQ to SQL object relational designer:</span></span>

![](build-a-model-with-business-rule-validations/_static/image3.png)

### <a name="creating-data-model-classes-with-linq-to-sql"></a><span data-ttu-id="44a5c-132">Vytváření tříd datového modelu pomocí LINQ na SQL</span><span class="sxs-lookup"><span data-stu-id="44a5c-132">Creating Data Model Classes with LINQ to SQL</span></span>

<span data-ttu-id="44a5c-133">LINQ to SQL nám umožňuje rychle vytvářet třídy datového modelu z existujícího schématu databáze.</span><span class="sxs-lookup"><span data-stu-id="44a5c-133">LINQ to SQL enables us to quickly create data model classes from existing database schema.</span></span> <span data-ttu-id="44a5c-134">Pokud to chcete provést, otevřeme databázi NerdDinner v Průzkumníkovi serveru a vybereme tabulky, které v ní chceme modelovat:</span><span class="sxs-lookup"><span data-stu-id="44a5c-134">To-do this we'll open the NerdDinner database in the Server Explorer, and select the Tables we want to model in it:</span></span>

![](build-a-model-with-business-rule-validations/_static/image4.png)

<span data-ttu-id="44a5c-135">Potom můžeme přetáhnout tabulky na povrch ulinq návrháře SQL.</span><span class="sxs-lookup"><span data-stu-id="44a5c-135">We can then drag the tables onto the LINQ to SQL designer surface.</span></span> <span data-ttu-id="44a5c-136">Když to uděláme LINQ to SQL automaticky vytvoří večeři a RSVP třídy pomocí schématu tabulek (s vlastnostmi třídy, které mapují na sloupce tabulky databáze):</span><span class="sxs-lookup"><span data-stu-id="44a5c-136">When we do this LINQ to SQL will automatically create Dinner and RSVP classes using the schema of the tables (with class properties that map to the database table columns):</span></span>

![](build-a-model-with-business-rule-validations/_static/image5.png)

<span data-ttu-id="44a5c-137">Ve výchozím nastavení linq na SQL návrháře automaticky "pluralizes" názvy tabulek a sloupců při vytváření tříd na základě schématu databáze.</span><span class="sxs-lookup"><span data-stu-id="44a5c-137">By default the LINQ to SQL designer automatically "pluralizes" table and column names when it creates classes based on a database schema.</span></span> <span data-ttu-id="44a5c-138">Například: tabulka "Večeře" v našem příkladu výše vyústila ve třídě "Dinner".</span><span class="sxs-lookup"><span data-stu-id="44a5c-138">For example: the "Dinners" table in our example above resulted in a "Dinner" class.</span></span> <span data-ttu-id="44a5c-139">Tato třída pojmenování pomáhá, aby naše modely konzistentní s .NET konvence pojmenování a obvykle zjistíte, že s návrhářem opravit to pohodlné (zejména při přidávání velké množství tabulek).</span><span class="sxs-lookup"><span data-stu-id="44a5c-139">This class naming helps make our models consistent with .NET naming conventions, and I usually find that having the designer fix this up convenient (especially when adding lots of tables).</span></span> <span data-ttu-id="44a5c-140">Pokud se vám nelíbí název třídy nebo vlastnosti, které návrhář generuje, můžete jej vždy přepsat a změnit na libovolný název, který chcete.</span><span class="sxs-lookup"><span data-stu-id="44a5c-140">If you don't like the name of a class or property that the designer generates, though, you can always override it and change it to any name you want.</span></span> <span data-ttu-id="44a5c-141">Můžete to provést buď úpravou názvu entity nebo vlastnosti v rámci návrháře nebo úpravou prostřednictvím mřížky vlastností.</span><span class="sxs-lookup"><span data-stu-id="44a5c-141">You can do this either by editing the entity/property name in-line within the designer or by modifying it via the property grid.</span></span>

<span data-ttu-id="44a5c-142">Ve výchozím nastavení linq na SQL návrháře také kontroluje primární klíč nebo cizí klíč vztahy tabulek a na základě nich automaticky vytvoří výchozí "přidružení vztahů" mezi různými třídami modelu, které vytvoří.</span><span class="sxs-lookup"><span data-stu-id="44a5c-142">By default the LINQ to SQL designer also inspects the primary key/foreign key relationships of the tables, and based on them automatically creates default "relationship associations" between the different model classes it creates.</span></span> <span data-ttu-id="44a5c-143">Například když jsme přetáhli tabulky Dinners a RSVP do návrháře LINQ na SQL, přidružení vztahů 1:N mezi nimi bylo odvozeno na základě skutečnosti, že tabulka RSVP měla cizí klíč k tabulce Večeře (to je označeno šipkou v návrháři):</span><span class="sxs-lookup"><span data-stu-id="44a5c-143">For example, when we dragged the Dinners and RSVP tables onto the LINQ to SQL designer a one-to-many relationship association between the two was inferred based on the fact that the RSVP table had a foreign-key to the Dinners table (this is indicated by the arrow in the designer):</span></span>

![](build-a-model-with-business-rule-validations/_static/image6.png)

<span data-ttu-id="44a5c-144">Výše uvedené přidružení způsobí LINQ sql přidat silně zadaný "Dinner" vlastnost třídy RSVP, které vývojáři mohou použít pro přístup k večeři spojené s daným RSVP.</span><span class="sxs-lookup"><span data-stu-id="44a5c-144">The above association will cause LINQ to SQL to add a strongly typed "Dinner" property to the RSVP class that developers can use to access the Dinner associated with a given RSVP.</span></span> <span data-ttu-id="44a5c-145">To také způsobí, že Dinner třídy mít "RSVPs" vlastnost kolekce, která umožňuje vývojářům načíst a aktualizovat RSVP objekty spojené s konkrétní Dinner.</span><span class="sxs-lookup"><span data-stu-id="44a5c-145">It will also cause the Dinner class to have a "RSVPs" collection property that enables developers to retrieve and update RSVP objects associated with a particular Dinner.</span></span>

<span data-ttu-id="44a5c-146">Níže můžete vidět příklad intellisense v rámci sady Visual Studio, když vytvoříme nový objekt RSVP a přidáme ho do kolekce rsvps večeři.</span><span class="sxs-lookup"><span data-stu-id="44a5c-146">Below you can see an example of intellisense within Visual Studio when we create a new RSVP object and add it to a Dinner's RSVPs collection.</span></span> <span data-ttu-id="44a5c-147">Všimněte si, jak LINQ sql automaticky přidána kolekce "RSVPs" na Dinner objektu:</span><span class="sxs-lookup"><span data-stu-id="44a5c-147">Notice how LINQ to SQL automatically added a "RSVPs" collection on the Dinner object:</span></span>

![](build-a-model-with-business-rule-validations/_static/image7.png)

<span data-ttu-id="44a5c-148">Přidáním rsvp objektu večeři rsvps kolekce říkáme LINQ sql přidružit vztah cizího klíče mezi večeři a rsvp řádek v naší databázi:</span><span class="sxs-lookup"><span data-stu-id="44a5c-148">By adding the RSVP object to the Dinner's RSVPs collection we are telling LINQ to SQL to associate a foreign-key relationship between the Dinner and the RSVP row in our database:</span></span>

![](build-a-model-with-business-rule-validations/_static/image8.png)

<span data-ttu-id="44a5c-149">Pokud se vám nelíbí, jak návrhář modeloval nebo pojmenoval přidružení tabulky, můžete ho přepsat.</span><span class="sxs-lookup"><span data-stu-id="44a5c-149">If you don't like how the designer has modeled or named a table association, you can override it.</span></span> <span data-ttu-id="44a5c-150">Stačí kliknout na asociační šipku v rámci návrháře a získat přístup k jeho vlastnostem prostřednictvím mřížky vlastností, abyste ji přejmenovali, odstranili nebo upravili.</span><span class="sxs-lookup"><span data-stu-id="44a5c-150">Just click on the association arrow within the designer and access its properties via the property grid to rename, delete or modify it.</span></span> <span data-ttu-id="44a5c-151">Pro naši aplikaci NerdDinner však výchozí pravidla přidružení fungují dobře pro třídy datového modelu, které vytváříme, a můžeme použít výchozí chování.</span><span class="sxs-lookup"><span data-stu-id="44a5c-151">For our NerdDinner application, though, the default association rules work well for the data model classes we are building and we can just use the default behavior.</span></span>

### <a name="nerddinnerdatacontext-class"></a><span data-ttu-id="44a5c-152">Třída NerdDinnerDataContext</span><span class="sxs-lookup"><span data-stu-id="44a5c-152">NerdDinnerDataContext Class</span></span>

<span data-ttu-id="44a5c-153">Visual Studio automaticky vytvoří třídy .NET, které představují modely a relace databáze definované pomocí návrháře LINQ na SQL.</span><span class="sxs-lookup"><span data-stu-id="44a5c-153">Visual Studio will automatically create .NET classes that represent the models and database relationships defined using the LINQ to SQL designer.</span></span> <span data-ttu-id="44a5c-154">Třída LINQ to SQL DataContext je také generována pro každý soubor návrháře LINQ do SQL přidané do řešení.</span><span class="sxs-lookup"><span data-stu-id="44a5c-154">A LINQ to SQL DataContext class is also generated for each LINQ to SQL designer file added to the solution.</span></span> <span data-ttu-id="44a5c-155">Protože jsme pojmenovali naši položku třídy LINQ na SQL "NerdDinner", vytvořená třída DataContext se bude nazývat "NerdDinnerDataContext".</span><span class="sxs-lookup"><span data-stu-id="44a5c-155">Because we named our LINQ to SQL class item "NerdDinner", the DataContext class created will be called "NerdDinnerDataContext".</span></span> <span data-ttu-id="44a5c-156">Tato třída NerdDinnerDataContext je primární způsob, jak budeme pracovat s databází.</span><span class="sxs-lookup"><span data-stu-id="44a5c-156">This NerdDinnerDataContext class is the primary way we will interact with the database.</span></span>

<span data-ttu-id="44a5c-157">Naše Třída NerdDinnerDataContext zveřejňuje dvě vlastnosti - "Večeře" a "RSVPs" - které představují dvě tabulky, které jsme modelovali v rámci databáze.</span><span class="sxs-lookup"><span data-stu-id="44a5c-157">Our NerdDinnerDataContext class exposes two properties - "Dinners" and "RSVPs" - that represent the two tables we modeled within the database.</span></span> <span data-ttu-id="44a5c-158">Můžeme použít C# k zápisu linq dotazy proti tyto vlastnosti dotaz a načíst Večeři a RSVP objekty z databáze.</span><span class="sxs-lookup"><span data-stu-id="44a5c-158">We can use C# to write LINQ queries against those properties to query and retrieve Dinner and RSVP objects from the database.</span></span>

<span data-ttu-id="44a5c-159">Následující kód ukazuje, jak vytvořit konkretizovat Objekt NerdDinnerDataContext a provést dotaz LINQ proti němu získat posloupnost Dinners, ke kterým dojde v budoucnu.</span><span class="sxs-lookup"><span data-stu-id="44a5c-159">The following code demonstrates how to instantiate a NerdDinnerDataContext object and perform a LINQ query against it to obtain a sequence of Dinners that occur in the future.</span></span> <span data-ttu-id="44a5c-160">Visual Studio poskytuje plnou intellisense při psaní dotazu LINQ a objekty vrácené z něj jsou silně typované a také podporují intellisense:</span><span class="sxs-lookup"><span data-stu-id="44a5c-160">Visual Studio provides full intellisense when writing the LINQ query, and the objects returned from it are strongly-typed and also support intellisense:</span></span>

![](build-a-model-with-business-rule-validations/_static/image9.png)

<span data-ttu-id="44a5c-161">Kromě toho, že nám umožňuje dotaz na dinner a RSVP objekty, NerdDinnerDataContext také automaticky sleduje všechny změny, které následně provedeme na večeři a RSVP objekty načteme přes něj.</span><span class="sxs-lookup"><span data-stu-id="44a5c-161">In addition to allowing us to query for Dinner and RSVP objects, a NerdDinnerDataContext also automatically tracks any changes we subsequently make to the Dinner and RSVP objects we retrieve through it.</span></span> <span data-ttu-id="44a5c-162">Tuto funkci můžeme použít ke snadnému uložení změn zpět do databáze - aniž bychom museli psát jakýkoli explicitní kód aktualizace SQL.</span><span class="sxs-lookup"><span data-stu-id="44a5c-162">We can use this functionality to easily save the changes back to the database - without having to write any explicit SQL update code.</span></span>

<span data-ttu-id="44a5c-163">Například níže uvedený kód ukazuje, jak pomocí dotazu LINQ načíst jeden objekt Dinner z databáze, aktualizovat dvě vlastnosti Dinner a potom uložit změny zpět do databáze:</span><span class="sxs-lookup"><span data-stu-id="44a5c-163">For example, the code below demonstrates how to use a LINQ query to retrieve a single Dinner object from the database, update two of the Dinner properties, and then save the changes back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample1.cs)]

<span data-ttu-id="44a5c-164">Objekt NerdDinnerDataContext ve výše uvedeném kódu automaticky sledoval změny vlastností provedené v objektu Dinner, který jsme z něj načetli.</span><span class="sxs-lookup"><span data-stu-id="44a5c-164">The NerdDinnerDataContext object in the code above automatically tracked the property changes made to the Dinner object we retrieved from it.</span></span> <span data-ttu-id="44a5c-165">Když jsme volali "SubmitChanges()" metoda, provede příslušný příkaz SQL "UPDATE" do databáze zachovat aktualizované hodnoty zpět.</span><span class="sxs-lookup"><span data-stu-id="44a5c-165">When we called the "SubmitChanges()" method, it will execute an appropriate SQL "UPDATE" statement to the database to persist the updated values back.</span></span>

### <a name="creating-a-dinnerrepository-class"></a><span data-ttu-id="44a5c-166">Vytvoření třídy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="44a5c-166">Creating a DinnerRepository Class</span></span>

<span data-ttu-id="44a5c-167">Pro malé aplikace je někdy v pořádku mít řadiče pracovat přímo proti LINQ na SQL DataContext třídy a vložit LINQ dotazy v rámci řadiče.</span><span class="sxs-lookup"><span data-stu-id="44a5c-167">For small applications it is sometimes fine to have Controllers work directly against a LINQ to SQL DataContext class, and embed LINQ queries within the Controllers.</span></span> <span data-ttu-id="44a5c-168">Jako aplikace získat větší, i když tento přístup se stává těžkopádné udržovat a testovat.</span><span class="sxs-lookup"><span data-stu-id="44a5c-168">As applications get larger, though, this approach becomes cumbersome to maintain and test.</span></span> <span data-ttu-id="44a5c-169">To může také vést k nám duplikovat stejné linq dotazy na více místech.</span><span class="sxs-lookup"><span data-stu-id="44a5c-169">It can also lead to us duplicating the same LINQ queries in multiple places.</span></span>

<span data-ttu-id="44a5c-170">Jeden přístup, který může usnadnit údržbu a testování aplikací, je použití vzoru "úložiště".</span><span class="sxs-lookup"><span data-stu-id="44a5c-170">One approach that can make applications easier to maintain and test is to use a "repository" pattern.</span></span> <span data-ttu-id="44a5c-171">Třída úložiště pomáhá zapouzdřit logiku dotazování a trvalosti dat a abstrahovat podrobnosti implementace trvalosti dat z aplikace.</span><span class="sxs-lookup"><span data-stu-id="44a5c-171">A repository class helps encapsulate data querying and persistence logic, and abstracts away the implementation details of the data persistence from the application.</span></span> <span data-ttu-id="44a5c-172">Kromě čištění kódu aplikace může použití vzoru úložiště usnadnit změnu implementace úložiště dat v budoucnu a může pomoci usnadnit testování částí aplikace bez nutnosti skutečné databáze.</span><span class="sxs-lookup"><span data-stu-id="44a5c-172">In addition to making application code cleaner, using a repository pattern can make it easier to change data storage implementations in the future, and it can help facilitate unit testing an application without requiring a real database.</span></span>

<span data-ttu-id="44a5c-173">Pro naši aplikaci NerdDinner definujeme třídu DinnerRepository s níže uvedeným podpisem:</span><span class="sxs-lookup"><span data-stu-id="44a5c-173">For our NerdDinner application we'll define a DinnerRepository class with the below signature:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample2.cs)]

<span data-ttu-id="44a5c-174">*Poznámka: Dále v této kapitole budeme extrahovat rozhraní IDinnerRepository z této třídy a povolit vkládání závislostí s ním na našich řadičů. Za prvé, i když začneme jednoduché a jen pracovat přímo s DinnerRepository třídy.*</span><span class="sxs-lookup"><span data-stu-id="44a5c-174">*Note: Later in this chapter we'll extract an IDinnerRepository interface from this class and enable dependency injection with it on our Controllers. To begin with, though, we are going to start simple and just work directly with the DinnerRepository class.*</span></span>

<span data-ttu-id="44a5c-175">Chcete-li implementovat tuto třídu, klikneme pravým tlačítkem myši na složku "Modely" a zvolíme příkaz nabídky **Přidat&gt;novou položku.**</span><span class="sxs-lookup"><span data-stu-id="44a5c-175">To implement this class we'll right-click on our "Models" folder and choose the **Add-&gt;New Item** menu command.</span></span> <span data-ttu-id="44a5c-176">V dialogovém okně "Přidat novou položku" vybereme šablonu "Třída" a pojmenujeme soubor "DinnerRepository.cs":</span><span class="sxs-lookup"><span data-stu-id="44a5c-176">Within the "Add New Item" dialog we'll select the "Class" template and name the file "DinnerRepository.cs":</span></span>

![](build-a-model-with-business-rule-validations/_static/image10.png)

<span data-ttu-id="44a5c-177">Můžeme pak implementovat naše DinnerRepository třídy pomocí kódu níže:</span><span class="sxs-lookup"><span data-stu-id="44a5c-177">We can then implement our DinnerRepository class using the code below:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample3.cs)]

### <a name="retrieving-updating-inserting-and-deleting-using-the-dinnerrepository-class"></a><span data-ttu-id="44a5c-178">Načítání, aktualizace, vkládání a odstranění pomocí třídy DinnerRepository</span><span class="sxs-lookup"><span data-stu-id="44a5c-178">Retrieving, Updating, Inserting and Deleting using the DinnerRepository class</span></span>

<span data-ttu-id="44a5c-179">Teď, když jsme vytvořili naši třídu DinnerRepository, podívejme se na několik příkladů kódu, které ukazují běžné úkoly, které s ním můžeme dělat:</span><span class="sxs-lookup"><span data-stu-id="44a5c-179">Now that we've created our DinnerRepository class, let's look at a few code examples that demonstrate common tasks we can do with it:</span></span>

#### <a name="querying-examples"></a><span data-ttu-id="44a5c-180">Dotazování příklady</span><span class="sxs-lookup"><span data-stu-id="44a5c-180">Querying Examples</span></span>

<span data-ttu-id="44a5c-181">Níže uvedený kód načte jednu večeři pomocí DinnerID hodnotu:</span><span class="sxs-lookup"><span data-stu-id="44a5c-181">The code below retrieves a single Dinner using the DinnerID value:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample4.cs)]

<span data-ttu-id="44a5c-182">Níže uvedený kód načte všechny nadcházející večeře a smyčky nad nimi:</span><span class="sxs-lookup"><span data-stu-id="44a5c-182">The code below retrieves all upcoming dinners and loops over them:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample5.cs)]

#### <a name="insert-and-update-examples"></a><span data-ttu-id="44a5c-183">Příklady vložení a aktualizace</span><span class="sxs-lookup"><span data-stu-id="44a5c-183">Insert and Update Examples</span></span>

<span data-ttu-id="44a5c-184">Níže uvedený kód ukazuje přidání dvou nových večeří.</span><span class="sxs-lookup"><span data-stu-id="44a5c-184">The code below demonstrates adding two new dinners.</span></span> <span data-ttu-id="44a5c-185">Dodatky/úpravy úložiště nejsou potvrzeny do databáze, dokud "Save()" metoda je volána na něj.</span><span class="sxs-lookup"><span data-stu-id="44a5c-185">Additions/modifications to the repository aren't committed to the database until the "Save()" method is called on it.</span></span> <span data-ttu-id="44a5c-186">LINQ to SQL automaticky zalomí všechny změny v databázové transakci – takže buď dojde ke všem změnám, nebo k žádné z nich nedojde, když naše úložiště uloží:</span><span class="sxs-lookup"><span data-stu-id="44a5c-186">LINQ to SQL automatically wraps all changes in a database transaction – so either all changes happen or none of them do when our repository saves:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample6.cs)]

<span data-ttu-id="44a5c-187">Níže uvedený kód načte existující Dinner objektu a upraví dvě vlastnosti na něm.</span><span class="sxs-lookup"><span data-stu-id="44a5c-187">The code below retrieves an existing Dinner object, and modifies two properties on it.</span></span> <span data-ttu-id="44a5c-188">Změny jsou potvrzeny zpět do databáze při "Save()" metoda je volána na našem úložišti:</span><span class="sxs-lookup"><span data-stu-id="44a5c-188">The changes are committed back to the database when the "Save()" method is called on our repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample7.cs)]

<span data-ttu-id="44a5c-189">Níže uvedený kód načte večeři a přidá k němu odpověď.</span><span class="sxs-lookup"><span data-stu-id="44a5c-189">The code below retrieves a dinner and then adds an RSVP to it.</span></span> <span data-ttu-id="44a5c-190">Je to pomocí rsvps kolekce na Dinner objektu, který LINQ na SQL vytvořil pro nás (protože je vztah primárního klíče/cizího klíče mezi těmito dvěma v databázi).</span><span class="sxs-lookup"><span data-stu-id="44a5c-190">It does this using the RSVPs collection on the Dinner object that LINQ to SQL created for us (because there is a primary-key/foreign-key relationship between the two in the database).</span></span> <span data-ttu-id="44a5c-191">Tato změna je zachována zpět do databáze jako nový řádek tabulky RSVP při volání metody "Save()" v úložišti:</span><span class="sxs-lookup"><span data-stu-id="44a5c-191">This change is persisted back to the database as a new RSVP table row when the "Save()" method is called on the repository:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample8.cs)]

#### <a name="delete-example"></a><span data-ttu-id="44a5c-192">Odstranit příklad</span><span class="sxs-lookup"><span data-stu-id="44a5c-192">Delete Example</span></span>

<span data-ttu-id="44a5c-193">Níže uvedený kód načte existující Dinner objektu a označí jej odstranit.</span><span class="sxs-lookup"><span data-stu-id="44a5c-193">The code below retrieves an existing Dinner object, and then marks it to be deleted.</span></span> <span data-ttu-id="44a5c-194">Když "Save()" metoda je volána v úložišti bude potvrdit delete zpět do databáze:</span><span class="sxs-lookup"><span data-stu-id="44a5c-194">When the "Save()" method is called on the repository it will commit the delete back to the database:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample9.cs)]

### <a name="integrating-validation-and-business-rule-logic-with-model-classes"></a><span data-ttu-id="44a5c-195">Integrace logiky ověřování a obchodních pravidel s třídami modelu</span><span class="sxs-lookup"><span data-stu-id="44a5c-195">Integrating Validation and Business Rule Logic with Model Classes</span></span>

<span data-ttu-id="44a5c-196">Integrace logiky ověřování a obchodních pravidel je klíčovou součástí každé aplikace, která pracuje s daty.</span><span class="sxs-lookup"><span data-stu-id="44a5c-196">Integrating validation and business rule logic is a key part of any application that works with data.</span></span>

#### <a name="schema-validation"></a><span data-ttu-id="44a5c-197">Ověření schématu</span><span class="sxs-lookup"><span data-stu-id="44a5c-197">Schema Validation</span></span>

<span data-ttu-id="44a5c-198">Když jsou definovány třídy modelu pomocí návrháře LINQ na SQL, datové typy vlastností ve třídách datového modelu odpovídají datovým typům databázové tabulky.</span><span class="sxs-lookup"><span data-stu-id="44a5c-198">When model classes are defined using the LINQ to SQL designer, the datatypes of the properties in the data model classes correspond to the datatypes of the database table.</span></span> <span data-ttu-id="44a5c-199">Například: Pokud je sloupec "EventDate" v tabulce Dinners "datetime", třída datového modelu vytvořená linq na SQL bude typu "DateTime" (což je vestavěný datový typ .NET).</span><span class="sxs-lookup"><span data-stu-id="44a5c-199">For example: if the "EventDate" column in the Dinners table is a "datetime", the data model class created by LINQ to SQL will be of type "DateTime" (which is a built-in .NET datatype).</span></span> <span data-ttu-id="44a5c-200">To znamená, že se zobrazí chyby kompilace, pokud se pokusíte přiřadit celé číslo nebo logickou hodnotu k němu z kódu a automaticky vyvolá chybu, pokud se pokusíte implicitně převést neplatný typ řetězce na něj za běhu.</span><span class="sxs-lookup"><span data-stu-id="44a5c-200">This means you will get compile errors if you attempt to assign an integer or boolean to it from code, and it will raise an error automatically if you attempt to implicitly convert a non-valid string type to it at runtime.</span></span>

<span data-ttu-id="44a5c-201">LINQ na SQL bude také automaticky zpracovává úniku hodnoty SQL pro vás při použití řetězců - což pomáhá chránit před útoky injektáže SQL při jeho použití.</span><span class="sxs-lookup"><span data-stu-id="44a5c-201">LINQ to SQL will also automatically handles escaping SQL values for you when using strings - which helps protect you against SQL injection attacks when using it.</span></span>

#### <a name="validation-and-business-rule-logic"></a><span data-ttu-id="44a5c-202">Logika ověření a obchodních pravidel</span><span class="sxs-lookup"><span data-stu-id="44a5c-202">Validation and Business Rule Logic</span></span>

<span data-ttu-id="44a5c-203">Ověření schématu je užitečné jako první krok, ale je zřídka dostačující.</span><span class="sxs-lookup"><span data-stu-id="44a5c-203">Schema validation is useful as a first step, but is rarely sufficient.</span></span> <span data-ttu-id="44a5c-204">Většina scénářů reálného světa vyžaduje možnost zadat bohatší ověřovací logiku, která může span více vlastností, spustit kód a často mít povědomí o stavu modelu (například: je to vytváří /aktualizován/odstraněn, nebo v rámci stavu specificképro doménu, jako je "archivován").</span><span class="sxs-lookup"><span data-stu-id="44a5c-204">Most real-world scenarios require the ability to specify richer validation logic that can span multiple properties, execute code, and often have awareness of a model's state (for example: is it being created /updated/deleted, or within a domain-specific state like "archived").</span></span> <span data-ttu-id="44a5c-205">Existuje celá řada různých vzorů a rámců, které lze použít k definování a použití ověřovacích pravidel pro třídy modelu a existuje několik rozhraní založených na rozhraní .NET, které lze použít k tomu, aby vám pomohly.</span><span class="sxs-lookup"><span data-stu-id="44a5c-205">There are a variety of different patterns and frameworks that can be used to define and apply validation rules to model classes, and there are several .NET based frameworks out there that can be used to help with this.</span></span> <span data-ttu-id="44a5c-206">Můžete použít skoro některý z nich v rámci ASP.NET aplikací MVC.</span><span class="sxs-lookup"><span data-stu-id="44a5c-206">You can use pretty much any of them within ASP.NET MVC applications.</span></span>

<span data-ttu-id="44a5c-207">Pro účely naší aplikace NerdDinner použijeme relativně jednoduchý a přímočarý vzor, kde zveřejňujeme isvalid vlastnost a GetRuleViolations() metoda na naše Dinner model objektu.</span><span class="sxs-lookup"><span data-stu-id="44a5c-207">For the purposes of our NerdDinner application, we'll use a relatively simple and straight-forward pattern where we expose an IsValid property and a GetRuleViolations() method on our Dinner model object.</span></span> <span data-ttu-id="44a5c-208">IsValid Vlastnost vrátí true nebo false v závislosti na tom, zda jsou platná ověřovací a obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="44a5c-208">The IsValid property will return true or false depending on whether the validation and business rules are all valid.</span></span> <span data-ttu-id="44a5c-209">Metoda GetRuleViolations() vrátí seznam všech chyb pravidel.</span><span class="sxs-lookup"><span data-stu-id="44a5c-209">The GetRuleViolations() method will return a list of any rule errors.</span></span>

<span data-ttu-id="44a5c-210">Budeme implementovat IsValid a GetRuleViolations() pro náš model Večeři přidáním "částečné třídy" do našeho projektu.</span><span class="sxs-lookup"><span data-stu-id="44a5c-210">We'll implement IsValid and GetRuleViolations() for our Dinner model by adding a "partial class" to our project.</span></span> <span data-ttu-id="44a5c-211">Částečné třídy lze přidat metody/vlastnosti/události do tříd udržovaných návrhářem VS (jako dinner třídy generované LINQ do SQL designer) a pomoci vyhnout se nástroj probírat s naším kódem.</span><span class="sxs-lookup"><span data-stu-id="44a5c-211">Partial classes can be used to add methods/properties/events to classes maintained by a VS designer (like the Dinner class generated by the LINQ to SQL designer) and help avoid the tool from messing with our code.</span></span> <span data-ttu-id="44a5c-212">Do našeho projektu můžeme přidat novou částečnou třídu kliknutím pravým tlačítkem myši na složku \Models a poté vybrat příkaz nabídky "Přidat novou položku".</span><span class="sxs-lookup"><span data-stu-id="44a5c-212">We can add a new partial class to our project by right-clicking on the \Models folder, and then select the "Add New Item" menu command.</span></span> <span data-ttu-id="44a5c-213">Poté můžeme zvolit šablonu "Třída" v dialogovém okně "Přidat novou položku" a pojmenovat ji Dinner.cs.</span><span class="sxs-lookup"><span data-stu-id="44a5c-213">We can then choose the "Class" template within the "Add New Item" dialog and name it Dinner.cs.</span></span>

![](build-a-model-with-business-rule-validations/_static/image11.png)

<span data-ttu-id="44a5c-214">Kliknutím na tlačítko "Přidat" přidáte do našeho projektu soubor Dinner.cs a otevřete jej v rámci ide.</span><span class="sxs-lookup"><span data-stu-id="44a5c-214">Clicking the "Add" button will add a Dinner.cs file to our project and open it within the IDE.</span></span> <span data-ttu-id="44a5c-215">Potom můžeme implementovat základní rámec pro vynucení pravidla/ověření pomocí níže uvedeného kódu:</span><span class="sxs-lookup"><span data-stu-id="44a5c-215">We can then implement a basic rule/validation enforcement framework using the below code:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample10.cs)]

<span data-ttu-id="44a5c-216">Několik poznámek k výše uvedenému kódu:</span><span class="sxs-lookup"><span data-stu-id="44a5c-216">A few notes about the above code:</span></span>

- <span data-ttu-id="44a5c-217">Dinner Třída je předchází "částečné" klíčové slovo – což znamená, že kód obsažený v něm bude kombinovat s třídou generované nebo spravované LINQ do SQL návrháře a kompilovány do jedné třídy.</span><span class="sxs-lookup"><span data-stu-id="44a5c-217">The Dinner class is prefaced with a "partial" keyword – which means the code contained within it will be combined with the class generated/maintained by the LINQ to SQL designer and compiled into a single class.</span></span>
- <span data-ttu-id="44a5c-218">Třída RuleViolation je pomocná třída, kterou přidáme do projektu, který nám umožňuje poskytnout další podrobnosti o porušení pravidel.</span><span class="sxs-lookup"><span data-stu-id="44a5c-218">The RuleViolation class is a helper class we'll add to the project that allows us to provide more details about a rule violation.</span></span>
- <span data-ttu-id="44a5c-219">Dinner.GetRuleViolations() metoda způsobí, že naše ověření a obchodní pravidla, která mají být vyhodnocena (budeme implementovat v nejbližší době).</span><span class="sxs-lookup"><span data-stu-id="44a5c-219">The Dinner.GetRuleViolations() method causes our validation and business rules to be evaluated (we'll implement them shortly).</span></span> <span data-ttu-id="44a5c-220">Potom vrátí zpět posloupnost RuleViolation objekty, které poskytují další podrobnosti o všechny chyby pravidla.</span><span class="sxs-lookup"><span data-stu-id="44a5c-220">It then returns back a sequence of RuleViolation objects that provide more details about any rule errors.</span></span>
- <span data-ttu-id="44a5c-221">Vlastnost Dinner.IsValid poskytuje pohodlné pomocné vlastnost, která označuje, zda Dinner objekt má všechny aktivní RuleViolations.</span><span class="sxs-lookup"><span data-stu-id="44a5c-221">The Dinner.IsValid property provides a convenient helper property that indicates whether the Dinner object has any active RuleViolations.</span></span> <span data-ttu-id="44a5c-222">Může být proaktivně kontrolována vývojářpomocí Dinner objektu kdykoliv (a nevyvolá výjimku).</span><span class="sxs-lookup"><span data-stu-id="44a5c-222">It can be proactively checked by a developer using the Dinner object at anytime (and does not raise an exception).</span></span>
- <span data-ttu-id="44a5c-223">Dinner.OnValidate() částečná metoda je zavěšení, které poskytuje LINQ na SQL, který nám umožňuje být upozorněni kdykoli Dinner objekt uchovává v databázi.</span><span class="sxs-lookup"><span data-stu-id="44a5c-223">The Dinner.OnValidate() partial method is a hook that LINQ to SQL provides that allows us to be notified anytime the Dinner object is about to be persisted within the database.</span></span> <span data-ttu-id="44a5c-224">Naše OnValidate() implementace výše zajišťuje, že večeři nemá žádné RuleViolations před uložením.</span><span class="sxs-lookup"><span data-stu-id="44a5c-224">Our OnValidate() implementation above ensures that the Dinner has no RuleViolations before it is saved.</span></span> <span data-ttu-id="44a5c-225">Pokud je v neplatném stavu vyvolá výjimku, která způsobí LINQ sql přerušit transakci.</span><span class="sxs-lookup"><span data-stu-id="44a5c-225">If it is in an invalid state it raises an exception, which will cause LINQ to SQL to abort the transaction.</span></span>

<span data-ttu-id="44a5c-226">Tento přístup poskytuje jednoduchý rámec, do kterého můžeme integrovat ověřovací a obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="44a5c-226">This approach provides a simple framework that we can integrate validation and business rules into.</span></span> <span data-ttu-id="44a5c-227">Pro tuto chvíli přidáme níže uvedená pravidla do naší metody GetRuleViolations() :</span><span class="sxs-lookup"><span data-stu-id="44a5c-227">For now let's add the below rules to our GetRuleViolations() method:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample11.cs)]

<span data-ttu-id="44a5c-228">Používáme funkci "yield return" jazyka C# k vrácení posloupnosti všech porušení pravidel.</span><span class="sxs-lookup"><span data-stu-id="44a5c-228">We are using the "yield return" feature of C# to return a sequence of any RuleViolations.</span></span> <span data-ttu-id="44a5c-229">Prvních šest kontrol pravidel výše jednoduše vynutit, že vlastnosti řetězce na naší večeři nemůže být null nebo prázdné.</span><span class="sxs-lookup"><span data-stu-id="44a5c-229">The first six rule checks above simply enforce that string properties on our Dinner cannot be null or empty.</span></span> <span data-ttu-id="44a5c-230">Poslední pravidlo je trochu zajímavější, a volá PhoneValidator.IsValidNumber() pomocná metoda, kterou můžeme přidat do našeho projektu ověřit, že formát čísla ContactPhone odpovídá večeři země.</span><span class="sxs-lookup"><span data-stu-id="44a5c-230">The last rule is a little more interesting, and calls a PhoneValidator.IsValidNumber() helper method that we can add to our project to verify that the ContactPhone number format matches the Dinner's country.</span></span>

<span data-ttu-id="44a5c-231">Můžeme použít . NET podporuje regulární výraz pro implementaci podpory tohoto telefonického ověření.</span><span class="sxs-lookup"><span data-stu-id="44a5c-231">We can use .NET's regular expression support to implement this phone validation support.</span></span> <span data-ttu-id="44a5c-232">Níže je jednoduchá implementace PhoneValidator, kterou můžeme přidat do našeho projektu, který nám umožňuje přidat kontroly vzoru Regex specifické pro zemi:</span><span class="sxs-lookup"><span data-stu-id="44a5c-232">Below is a simple PhoneValidator implementation that we can add to our project that enables us to add country-specific Regex pattern checks:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample12.cs)]

#### <a name="handling-validation-and-business-logic-violations"></a><span data-ttu-id="44a5c-233">Zpracování ověření a porušení obchodní logiky</span><span class="sxs-lookup"><span data-stu-id="44a5c-233">Handling Validation and Business Logic Violations</span></span>

<span data-ttu-id="44a5c-234">Teď, když jsme přidali výše uvedený kód ověření a obchodnípravidla, kdykoli se pokusíme vytvořit nebo aktualizovat večeři, naše pravidla logiky ověření budou vyhodnocena a vynucena.</span><span class="sxs-lookup"><span data-stu-id="44a5c-234">Now that we've added the above validation and business rule code, any time we try to create or update a Dinner, our validation logic rules will be evaluated and enforced.</span></span>

<span data-ttu-id="44a5c-235">Vývojáři mohou psát kód jako níže proaktivně určit, pokud Dinner objekt je platný a načíst seznam všech porušení v něm bez vyvolání jakékoli výjimky:</span><span class="sxs-lookup"><span data-stu-id="44a5c-235">Developers can write code like below to proactively determine if a Dinner object is valid, and retrieve a list of all violations in it without raising any exceptions:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample13.cs)]

<span data-ttu-id="44a5c-236">Pokud se pokusíme uložit Dinner v neplatném stavu, bude vyvolána výjimka při volání Save() metoda na DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="44a5c-236">If we attempt to save a Dinner in an invalid state, an exception will be raised when we call the Save() method on the DinnerRepository.</span></span> <span data-ttu-id="44a5c-237">K tomu dochází, protože LINQ sql automaticky volá naše Dinner.OnValidate() částečná metoda před uložením Dinner změny a jsme přidali kód Dinner.OnValidate() vyvolat výjimku, pokud existují porušení pravidel v Dinner.</span><span class="sxs-lookup"><span data-stu-id="44a5c-237">This occurs because LINQ to SQL automatically calls our Dinner.OnValidate() partial method before it saves the Dinner's changes, and we added code to Dinner.OnValidate() to raise an exception if any rule violations exist in the Dinner.</span></span> <span data-ttu-id="44a5c-238">Můžeme zachytit tuto výjimku a reaktivně načíst seznam porušení opravit:</span><span class="sxs-lookup"><span data-stu-id="44a5c-238">We can catch this exception and reactively retrieve a list of the violations to fix:</span></span>

[!code-csharp[Main](build-a-model-with-business-rule-validations/samples/sample14.cs)]

<span data-ttu-id="44a5c-239">Vzhledem k tomu, že naše ověřovací a obchodní pravidla jsou implementována v rámci vrstvy modelu a ne v rámci vrstvy ui, budou použity a použity ve všech scénářích v rámci naší aplikace.</span><span class="sxs-lookup"><span data-stu-id="44a5c-239">Because our validation and business rules are implemented within our model layer, and not within the UI layer, they will be applied and used across all scenarios within our application.</span></span> <span data-ttu-id="44a5c-240">Můžeme později změnit nebo přidat obchodní pravidla a mít veškerý kód, který pracuje s našimi objekty Večeři ctít je.</span><span class="sxs-lookup"><span data-stu-id="44a5c-240">We can later change or add business rules and have all code that works with our Dinner objects honor them.</span></span>

<span data-ttu-id="44a5c-241">S flexibilitou změnit obchodní pravidla na jednom místě, aniž by tyto změny zvlnění v celé aplikaci a logiky rozhraní, je známkou dobře napsané aplikace a výhoda, která rozhraní MVC pomáhá podporovat.</span><span class="sxs-lookup"><span data-stu-id="44a5c-241">Having the flexibility to change business rules in one place, without having these changes ripple throughout the application and UI logic, is a sign of a well-written application, and a benefit that an MVC framework helps encourage.</span></span>

### <a name="next-step"></a><span data-ttu-id="44a5c-242">Další krok</span><span class="sxs-lookup"><span data-stu-id="44a5c-242">Next Step</span></span>

<span data-ttu-id="44a5c-243">Nyní máme model, který můžeme použít k dotazování a aktualizaci naší databáze.</span><span class="sxs-lookup"><span data-stu-id="44a5c-243">We've now got a model that we can use to both query and update our database.</span></span>

<span data-ttu-id="44a5c-244">Nyní přidáme do projektu některé řadiče a zobrazení, které můžeme použít k vytvoření prostředí uživatelského prostředí HTML kolem něj.</span><span class="sxs-lookup"><span data-stu-id="44a5c-244">Let's now add some controllers and views to the project that we can use to build an HTML UI experience around it.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="44a5c-245">[Předchozí](create-a-database.md)
> [další](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span><span class="sxs-lookup"><span data-stu-id="44a5c-245">[Previous](create-a-database.md)
[Next](use-controllers-and-views-to-implement-a-listingdetails-ui.md)</span></span>
