---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Zabezpečení aplikací pomocí ověřování a autorizace | Microsoft Docs
author: microsoft
description: Krok 9 ukazuje, jak přidat ověřování a autorizaci k zabezpečení naší aplikace NerdDinner, aby se uživatelé museli zaregistrovat a přihlásit k lokalitě, která se má vytvořit...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 8d509c5f15bb4d5014e53b8dc2a736454238e72c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78600980"
---
# <a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="15cfe-103">Zabezpečení aplikací ověřováním a autorizací</span><span class="sxs-lookup"><span data-stu-id="15cfe-103">Secure Applications Using Authentication and Authorization</span></span>

<span data-ttu-id="15cfe-104">od [Microsoftu](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="15cfe-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="15cfe-105">Stáhnout PDF</span><span class="sxs-lookup"><span data-stu-id="15cfe-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="15cfe-106">Toto je krok 9 bezplatného [kurzu aplikace "NerdDinner"](introducing-the-nerddinner-tutorial.md) , který vás provede procesem vytvoření malé, ale dokončené webové aplikace pomocí ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="15cfe-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="15cfe-107">V kroku 9 se dozvíte, jak přidat ověřování a autorizaci k zabezpečení naší aplikace NerdDinner, aby se uživatelé museli zaregistrovat a přihlašovat k webu a vytvořit novou večeři a aby ho později mohl upravovat jenom uživatel, který hostuje večeři.</span><span class="sxs-lookup"><span data-stu-id="15cfe-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="15cfe-108">Pokud používáte ASP.NET MVC 3, doporučujeme vám postupovat podle [Začínáme s kurzy pro](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) [hudební úložiště](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) MVC 3 nebo MVC.</span><span class="sxs-lookup"><span data-stu-id="15cfe-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>

## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="15cfe-109">NerdDinner krok 9: ověřování a autorizace</span><span class="sxs-lookup"><span data-stu-id="15cfe-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="15cfe-110">Teď naše aplikace NerdDinner uděluje komukoli návštěvě webu možnost vytvářet a upravovat podrobnosti o večeři.</span><span class="sxs-lookup"><span data-stu-id="15cfe-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="15cfe-111">Pojďme to změnit, aby se uživatelé museli zaregistrovat a přihlásit k webu a vytvořit novou večeři a přidat omezení tak, aby ho mohli později upravovat jenom uživatel, který hostuje večeři.</span><span class="sxs-lookup"><span data-stu-id="15cfe-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="15cfe-112">Pokud to chcete povolit, použijeme k zabezpečení naší aplikace ověřování a autorizaci.</span><span class="sxs-lookup"><span data-stu-id="15cfe-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="15cfe-113">Principy ověřování a autorizace</span><span class="sxs-lookup"><span data-stu-id="15cfe-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="15cfe-114">*Ověřování* je proces identifikace a ověření identity klienta, který přistupuje k aplikaci.</span><span class="sxs-lookup"><span data-stu-id="15cfe-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="15cfe-115">Přesněji řečeno, jedná se o identifikaci "kdo", který je koncovým uživatelem při návštěvě webu.</span><span class="sxs-lookup"><span data-stu-id="15cfe-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="15cfe-116">ASP.NET podporuje více způsobů ověřování uživatelů prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="15cfe-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="15cfe-117">Pro internetové webové aplikace se nejčastěji používaný přístup pro ověřování nazývá "ověřování pomocí formulářů".</span><span class="sxs-lookup"><span data-stu-id="15cfe-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="15cfe-118">Ověřování pomocí formulářů umožňuje vývojářům vytvořit formulář pro přihlášení ve formátu HTML v rámci své aplikace a ověřit uživatelské jméno a heslo, které koncoví uživatelé odesílají do databáze nebo jiného úložiště přihlašovacích údajů k heslu.</span><span class="sxs-lookup"><span data-stu-id="15cfe-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="15cfe-119">Pokud je kombinace uživatelského jména a hesla správná, může vývojář požádat ASP.NET o vydání šifrovaného souboru cookie protokolu HTTP, aby identifikoval uživatele v rámci budoucích požadavků.</span><span class="sxs-lookup"><span data-stu-id="15cfe-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="15cfe-120">Pomocí ověřování pomocí formulářů v naší aplikaci NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="15cfe-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="15cfe-121">*Autorizace* je proces určení, jestli ověřený uživatel má oprávnění pro přístup k určité adrese URL nebo prostředku nebo k provedení nějaké akce.</span><span class="sxs-lookup"><span data-stu-id="15cfe-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="15cfe-122">V rámci naší aplikace NerdDinner si například přejete, aby k adrese URL */Dinners/Create* mohli získat přístup pouze uživatelé, kteří jsou přihlášeni, a vytvořit novou večeři.</span><span class="sxs-lookup"><span data-stu-id="15cfe-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="15cfe-123">Také budete chtít přidat logiku autorizace tak, aby ji mohl upravovat jenom uživatel, který je hostitelem večeře – a odepřít přístup pro úpravy všem ostatním uživatelům.</span><span class="sxs-lookup"><span data-stu-id="15cfe-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="15cfe-124">Ověřování formulářů a AccountController</span><span class="sxs-lookup"><span data-stu-id="15cfe-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="15cfe-125">Výchozí šablona projektu sady Visual Studio pro ASP.NET MVC automaticky povoluje ověřování prostřednictvím formulářů při vytváření nových aplikací ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="15cfe-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="15cfe-126">Také automaticky přidá předem vestavěnou implementaci přihlašovací stránky účtu do projektu – což usnadňuje integraci zabezpečení v rámci lokality.</span><span class="sxs-lookup"><span data-stu-id="15cfe-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="15cfe-127">Výchozí lokalita. Hlavní stránka předlohy zobrazí odkaz Přihlásit se v pravém horním rohu webu, když uživatel přistupující k němu není ověřený:</span><span class="sxs-lookup"><span data-stu-id="15cfe-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="15cfe-128">Kliknutím na odkaz přihlásit převezme uživatel adresu URL */account/LogOn* :</span><span class="sxs-lookup"><span data-stu-id="15cfe-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="15cfe-129">Návštěvníkům, kteří se nezaregistrovali, můžete tak učinit kliknutím na odkaz zaregistrovat, který převezme adresu URL */account/Register* a umožní jim zadat podrobnosti účtu:</span><span class="sxs-lookup"><span data-stu-id="15cfe-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="15cfe-130">Kliknutím na tlačítko zaregistrovat vytvoříte nového uživatele v rámci systému členství v ASP.NET a ověříte uživatele na webu pomocí ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="15cfe-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="15cfe-131">Když je uživatel přihlášený, lokalita. Master změní pravou stranu stránky na výstup "Vítejte [UserName]!".</span><span class="sxs-lookup"><span data-stu-id="15cfe-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="15cfe-132">zpráva a vykreslí odkaz odhlásit se místo jednoho přihlášení.</span><span class="sxs-lookup"><span data-stu-id="15cfe-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="15cfe-133">Kliknutím na odkaz odhlásit se odhlásí uživatel:</span><span class="sxs-lookup"><span data-stu-id="15cfe-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="15cfe-134">Výše uvedené funkce přihlášení, odhlášení a registrace jsou implementovány v rámci třídy AccountController, která byla přidána do našeho projektu při vytváření projektu v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="15cfe-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="15cfe-135">Uživatelské rozhraní pro AccountController je implementováno pomocí šablon zobrazení v adresáři \Views\Account:</span><span class="sxs-lookup"><span data-stu-id="15cfe-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="15cfe-136">Třída AccountController používá systém ověřování pomocí formulářů ASP.NET k vydávání šifrovaných souborů cookie ověřování a rozhraní API pro členství v ASP.NET pro ukládání a ověřování uživatelských jmen a hesel.</span><span class="sxs-lookup"><span data-stu-id="15cfe-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="15cfe-137">Rozhraní API pro členství v ASP.NET je rozšiřitelné a povoluje použití úložiště přihlašovacích údajů k heslům.</span><span class="sxs-lookup"><span data-stu-id="15cfe-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="15cfe-138">ASP.NET se dodává s integrovanými implementacemi zprostředkovatele členství, které ukládají uživatelské jméno a hesla v rámci databáze SQL nebo v rámci služby Active Directory.</span><span class="sxs-lookup"><span data-stu-id="15cfe-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="15cfe-139">Můžeme nakonfigurovat, který poskytovatel členství má naše aplikace NerdDinner použít, otevřením souboru Web. config v kořenovém adresáři projektu a vyhledáním oddílu &lt;&gt; členství v něm.</span><span class="sxs-lookup"><span data-stu-id="15cfe-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="15cfe-140">Výchozí soubor Web. config, který byl přidán při vytvoření projektu, zaregistruje poskytovatele členství SQL a nakonfiguruje ho pro použití připojovacího řetězce s názvem ApplicationServices k určení umístění databáze.</span><span class="sxs-lookup"><span data-stu-id="15cfe-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="15cfe-141">Výchozí připojovací řetězec "ApplicationServices" (který je uveden v části &lt;connectionStrings&gt; souboru Web. config) je nakonfigurován tak, aby používal SQL Express.</span><span class="sxs-lookup"><span data-stu-id="15cfe-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="15cfe-142">Odkazuje na databázi SQL Express s názvem ASPNETDB. MDF v adresáři App\_data aplikace</span><span class="sxs-lookup"><span data-stu-id="15cfe-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="15cfe-143">Pokud tato databáze neexistuje při prvním použití rozhraní API členství v rámci aplikace, ASP.NET automaticky vytvoří databázi a zřídí příslušné schéma databáze členství v této aplikaci:</span><span class="sxs-lookup"><span data-stu-id="15cfe-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="15cfe-144">Pokud místo používání SQL Express chceme použít úplnou instanci SQL Server (nebo se připojit ke vzdálené databázi), stačí, když je potřeba aktualizovat připojovací řetězec "ApplicationServices" v souboru Web. config a ujistit se, že příslušné schéma členství bylo přidáno do databáze, na které odkazuje.</span><span class="sxs-lookup"><span data-stu-id="15cfe-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="15cfe-145">Můžete spustit nástroj "ASPNET\_regsql. exe" v adresáři \Windows\Microsoft.NET\Framework\v2.0.50727\ a přidat tak příslušné schéma pro členství a další ASP.NET aplikační služby do databáze.</span><span class="sxs-lookup"><span data-stu-id="15cfe-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="15cfe-146">Autorizace adresy URL/Dinners/Create pomocí filtru [autorizovat]</span><span class="sxs-lookup"><span data-stu-id="15cfe-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="15cfe-147">Nemuseli jsme psát žádný kód, který umožní implementaci zabezpečeného ověřování a správy účtů pro aplikaci NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="15cfe-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="15cfe-148">Uživatelé mohou registrovat nové účty pomocí naší aplikace a přihlašovat nebo odhlásit Web.</span><span class="sxs-lookup"><span data-stu-id="15cfe-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="15cfe-149">Nyní můžeme do aplikace přidat logiku autorizace a použít stav ověřování a uživatelské jméno návštěvníků k řízení toho, co můžou a v rámci lokality dělat.</span><span class="sxs-lookup"><span data-stu-id="15cfe-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="15cfe-150">Pojďme začít přidáním logiky autorizace do metod akce "vytvořit" naší třídy DinnersController.</span><span class="sxs-lookup"><span data-stu-id="15cfe-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="15cfe-151">Konkrétně budeme vyžadovat, aby uživatelé, kteří přistupují k adrese URL */Dinners/Create* , museli být přihlášeni.</span><span class="sxs-lookup"><span data-stu-id="15cfe-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="15cfe-152">Pokud nejsou přihlášeni, přesměrujte je na přihlašovací stránku, aby se mohli přihlásit.</span><span class="sxs-lookup"><span data-stu-id="15cfe-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="15cfe-153">Implementace této logiky je poměrně jednoduchá.</span><span class="sxs-lookup"><span data-stu-id="15cfe-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="15cfe-154">Vše, co je potřeba udělat, je přidat atribut filtru [autorizovat] k našim způsobům akce vytvoření, jako je například:</span><span class="sxs-lookup"><span data-stu-id="15cfe-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="15cfe-155">ASP.NET MVC podporuje možnost vytvořit "filtry akcí", které lze použít k implementaci opakované použitelné logiky, která se dá deklarativně použít na metody akcí.</span><span class="sxs-lookup"><span data-stu-id="15cfe-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="15cfe-156">Filtr [autorizovat] je jedním z vestavěných filtrů akcí, které poskytuje ASP.NET MVC, a umožňuje vývojářům deklarativní použití autorizačních pravidel na metody akcí a tříd kontroleru.</span><span class="sxs-lookup"><span data-stu-id="15cfe-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="15cfe-157">Při použití bez parametrů (například výše) filtr [autorizační] vynutil, aby uživatel provádějící požadavek na akci metody byl přihlášen – a automaticky přesměruje prohlížeč na adresu URL pro přihlášení, pokud nejsou.</span><span class="sxs-lookup"><span data-stu-id="15cfe-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="15cfe-158">Při tomto přesměrování je původní požadovaná adresa URL předána jako argument typu QueryString (například:/Account/LogOn? ReturnUrl =% 2fDinners% 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="15cfe-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="15cfe-159">AccountController pak přesměruje uživatele zpět na původně požadovanou adresu URL po přihlášení.</span><span class="sxs-lookup"><span data-stu-id="15cfe-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="15cfe-160">Filtr [autorizovat] volitelně podporuje možnost zadat vlastnost "uživatelé" nebo "role", která se dá použít k vyžadování, aby byl uživatel přihlášený, a v rámci seznamu povolených uživatelů nebo členem povolené role zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="15cfe-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="15cfe-161">Například kód níže umožňuje přístup k adrese URL/Dinners/Create pouze dvěma konkrétním uživatelům "scottgu" a "billg":</span><span class="sxs-lookup"><span data-stu-id="15cfe-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="15cfe-162">Vkládání specifických uživatelských jmen do kódu je v podstatě neudržovatelnější i když.</span><span class="sxs-lookup"><span data-stu-id="15cfe-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="15cfe-163">Lepším řešením je definovat "role vyšší úrovně", které kód kontroluje, a pak mapovat uživatele do role pomocí databáze nebo systému služby Active Directory (Povolit externí uložení vlastního seznamu mapování uživatelů z kódu).</span><span class="sxs-lookup"><span data-stu-id="15cfe-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="15cfe-164">ASP.NET zahrnuje integrované rozhraní API pro správu rolí i integrovanou sadu poskytovatelů rolí (včetně těch, které jsou pro SQL a Active Directory), které můžou pomáhat s tímto mapováním uživatelů nebo rolí.</span><span class="sxs-lookup"><span data-stu-id="15cfe-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="15cfe-165">Kód můžeme potom aktualizovat tak, aby uživatelům v rámci určité role správce povolil přístup k adrese URL/Dinners/Create:</span><span class="sxs-lookup"><span data-stu-id="15cfe-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="15cfe-166">Použití vlastnosti User.Identity.Name při vytváření večeři</span><span class="sxs-lookup"><span data-stu-id="15cfe-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="15cfe-167">Uživatelské jméno aktuálně přihlášeného uživatele žádosti můžeme načíst pomocí vlastnosti User.Identity.Name vystavené u základní třídy Controller.</span><span class="sxs-lookup"><span data-stu-id="15cfe-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="15cfe-168">Dříve, když jsme implementovali verzi HTTP-POST metody akce Create (), měli jsme pevně zakódované vlastnost HostedBy pro večeři na statický řetězec.</span><span class="sxs-lookup"><span data-stu-id="15cfe-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="15cfe-169">Tento kód teď můžeme aktualizovat, aby místo toho používal vlastnost User.Identity.Name, a také automaticky přidat protokol RSVP pro hostitele, který vytváří večeři:</span><span class="sxs-lookup"><span data-stu-id="15cfe-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="15cfe-170">Vzhledem k tomu, že jsme přidali atribut [autorizovat] do metody Create (), ASP.NET MVC zajistí, že se metoda Action spustí jenom v případě, že se uživateli, který navštíví adresu URL/Dinners/Create, přihlásí na webu.</span><span class="sxs-lookup"><span data-stu-id="15cfe-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="15cfe-171">V takovém případě hodnota vlastnosti User.Identity.Name bude vždy obsahovat platné uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="15cfe-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="15cfe-172">Použití vlastnosti User.Identity.Name při úpravě večeři</span><span class="sxs-lookup"><span data-stu-id="15cfe-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="15cfe-173">Teď přidáme část autorizační logiky, která omezí uživatele tak, aby mohli upravovat jenom vlastnosti večeře, které sami sami hostují.</span><span class="sxs-lookup"><span data-stu-id="15cfe-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="15cfe-174">Abychom vám to usnadnili, Přidali jsme do objektu večeře (v rámci předchozí třídy Dinner.cs, kterou jsme vytvořili dříve) pomocnou metodu "IsHostedBy (uživatelské jméno)".</span><span class="sxs-lookup"><span data-stu-id="15cfe-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="15cfe-175">Tato pomocná metoda vrátí hodnotu true nebo false v závislosti na tom, zda zadané uživatelské jméno odpovídá vlastnosti večeře HostedBy, a zapouzdřuje logiku nutnou k provedení porovnávání řetězců nerozlišujících velká a malá písmena:</span><span class="sxs-lookup"><span data-stu-id="15cfe-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="15cfe-176">Pak přidáte atribut [autorizovat] do metod akce Edit () v rámci naší třídy DinnersController.</span><span class="sxs-lookup"><span data-stu-id="15cfe-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="15cfe-177">Tím se zajistí, že se uživatelé musí přihlásili, aby si vyžádali adresu URL */Dinners/Edit/[ID]* .</span><span class="sxs-lookup"><span data-stu-id="15cfe-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="15cfe-178">Pak můžeme do našich metod úprav, které používají pomocnou metodu večeře. IsHostedBy (Username), přidat kód, který ověří, jestli přihlášený uživatel odpovídá hostiteli večeře.</span><span class="sxs-lookup"><span data-stu-id="15cfe-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="15cfe-179">Pokud uživatel není hostitel, zobrazí se zobrazení "InvalidOwner" a žádost se ukončí.</span><span class="sxs-lookup"><span data-stu-id="15cfe-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="15cfe-180">Kód, který se má udělat, vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="15cfe-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="15cfe-181">Potom můžete kliknout pravým tlačítkem na adresář \Views\Dinners a pomocí příkazu nabídky pro zobrazení pro přidání&gt;vytvořit nové zobrazení "InvalidOwner".</span><span class="sxs-lookup"><span data-stu-id="15cfe-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="15cfe-182">Naplníme ji následující chybovou zprávou:</span><span class="sxs-lookup"><span data-stu-id="15cfe-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="15cfe-183">A teď když se uživatel pokusí upravit večeři, že nevlastní, zobrazí se chybová zpráva:</span><span class="sxs-lookup"><span data-stu-id="15cfe-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="15cfe-184">Stejný postup můžete opakovat pro metody akce DELETE () v rámci našeho kontroleru, abyste mohli uzamknout oprávnění k odstranění večeři i k tomu, že ho může odstranit jenom hostitel večeře.</span><span class="sxs-lookup"><span data-stu-id="15cfe-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="15cfe-185">Zobrazení nebo skrytí odkazů pro úpravy a odstranění</span><span class="sxs-lookup"><span data-stu-id="15cfe-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="15cfe-186">Odkazujeme na metodu akce upravit a odstranit naší třídy DinnersController z naší adresy URL s podrobnostmi:</span><span class="sxs-lookup"><span data-stu-id="15cfe-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="15cfe-187">V současné době zobrazujeme odkazy na akce upravit a odstranit bez ohledu na to, jestli je návštěvníkem této hostiny adresa URL s podrobnostmi.</span><span class="sxs-lookup"><span data-stu-id="15cfe-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="15cfe-188">Pojďme to změnit, aby se odkazy zobrazovaly jenom v případě, že je uživatel, který je návštěvníkem, vlastníkem večeře.</span><span class="sxs-lookup"><span data-stu-id="15cfe-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="15cfe-189">Metoda Action () v rámci našeho DinnersController načte objekt večeře a pak ho předává jako objekt modelu do naší šablony zobrazení:</span><span class="sxs-lookup"><span data-stu-id="15cfe-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="15cfe-190">Naši šablonu zobrazení můžeme aktualizovat tak, aby podmíněně zobrazovala nebo skryla odkazy pro úpravy a odstranění pomocí pomocné metody večeře. IsHostedBy (), jak je uvedeno níže:</span><span class="sxs-lookup"><span data-stu-id="15cfe-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="15cfe-191">Další kroky</span><span class="sxs-lookup"><span data-stu-id="15cfe-191">Next Steps</span></span>

<span data-ttu-id="15cfe-192">Teď se podíváme na to, jak můžeme ověřeným uživatelům povolit protokol RSVP pro večeři pomocí AJAX.</span><span class="sxs-lookup"><span data-stu-id="15cfe-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="15cfe-193">[Předchozí](implement-efficient-data-paging.md)
> [Další](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="15cfe-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
