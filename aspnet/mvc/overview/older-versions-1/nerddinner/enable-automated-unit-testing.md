---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Povolení automatického testování jednotek | Dokumentace Microsoftu
author: microsoft
description: Krok 12 ukazuje, jak vyvíjet sadu automatizované testy jednotky, která ověřte naše NerdDinner funkce a které nám umožní provedou změny...
ms.author: riande
ms.date: 07/27/2010
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: b0c9cd7ab36a8414e0d7d50a68b05bb09a5f24f1
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/09/2019
ms.locfileid: "59387903"
---
# <a name="enable-automated-unit-testing"></a><span data-ttu-id="f30fe-103">Povolení automatického testování jednotek</span><span class="sxs-lookup"><span data-stu-id="f30fe-103">Enable Automated Unit Testing</span></span>

<span data-ttu-id="f30fe-104">by [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="f30fe-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="f30fe-105">Stáhnout PDF</span><span class="sxs-lookup"><span data-stu-id="f30fe-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="f30fe-106">Toto je kroku 12 bezplatného [kurz vývoje aplikace "NerdDinner"](introducing-the-nerddinner-tutorial.md) , který procházení procházení po tom, jak sestavit malý, ale bylo možné provést, webové aplikace pomocí ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="f30fe-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="f30fe-107">Krok 12 ukazuje, jak vyvíjet sadu automatizované testy jednotky, která ověřit naše funkce NerdDinner a dávají nám provedou změny a vylepšení pro aplikaci v budoucnosti.</span><span class="sxs-lookup"><span data-stu-id="f30fe-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="f30fe-108">Pokud používáte ASP.NET MVC 3, doporučujeme je provést [získávání začít s MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) nebo [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) kurzy.</span><span class="sxs-lookup"><span data-stu-id="f30fe-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="f30fe-109">NerdDinner krok 12: Testování částí</span><span class="sxs-lookup"><span data-stu-id="f30fe-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="f30fe-110">Pojďme vyvíjet sadu automatizované testy jednotky, která ověřit naše funkce NerdDinner a dávají nám provedou změny a vylepšení pro aplikaci v budoucnosti.</span><span class="sxs-lookup"><span data-stu-id="f30fe-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="f30fe-111">Proč pro testování částí?</span><span class="sxs-lookup"><span data-stu-id="f30fe-111">Why Unit Test?</span></span>

<span data-ttu-id="f30fe-112">Na disku do práce jeden ráno máte i s náhlými pracovat bez velkých příprav dávku inspirace o aplikaci, kterou právě pracujete.</span><span class="sxs-lookup"><span data-stu-id="f30fe-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="f30fe-113">Je dobré si uvědomit, že dojde ke změně, které můžete implementovat, které se aplikace výrazně lepší.</span><span class="sxs-lookup"><span data-stu-id="f30fe-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="f30fe-114">Může být refaktoring, který vyčistí kód, přidává nové funkce nebo opravuje chybu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="f30fe-115">Na otázku, kterou jste confronts až přijedete počítače je – "Jak bezpečné je ho tak, aby toto vylepšení?"</span><span class="sxs-lookup"><span data-stu-id="f30fe-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="f30fe-116">Co když provádění změny má vedlejší účinky nebo přeruší něco?</span><span class="sxs-lookup"><span data-stu-id="f30fe-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="f30fe-117">Tato změna může být jednoduchý a trvat jenom pár minut a implementaci, ale co když trvá hodiny můžete ručně vyzkoušet všechny scénáře aplikací?</span><span class="sxs-lookup"><span data-stu-id="f30fe-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="f30fe-118">Co když zapomenete pro scénář a nefunkční aplikace přejde do produkčního prostředí?</span><span class="sxs-lookup"><span data-stu-id="f30fe-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="f30fe-119">Toto vylepšení ve skutečnosti vyplácet všechny je vidět?</span><span class="sxs-lookup"><span data-stu-id="f30fe-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="f30fe-120">Automatizované testy jednotky můžete zadat bezpečnostní, která umožňuje průběžně vylepšovat vaše aplikace a vyhnout se bát kód, který právě pracujete.</span><span class="sxs-lookup"><span data-stu-id="f30fe-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="f30fe-121">Provádí se s automatizované testy, které rychle ověřte, že funkce vám umožní kódování s jistotou – a umožněte k vylepšování vám nemusí jinak mají popisovač příjemné.</span><span class="sxs-lookup"><span data-stu-id="f30fe-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="f30fe-122">Kromě toho pomáhají vytvářet řešení, které jsou snadněji spravovatelné a mají delší životnost – které vede k mnohem větší návratnost investic.</span><span class="sxs-lookup"><span data-stu-id="f30fe-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="f30fe-123">Architektura ASP.NET MVC umožňuje snadné a přirozené do aplikace funkce testování částí.</span><span class="sxs-lookup"><span data-stu-id="f30fe-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="f30fe-124">Umožňuje také otestovat řízené vývoj (TDD) pracovního postupu, který umožňuje včasného testování založené na vývoj.</span><span class="sxs-lookup"><span data-stu-id="f30fe-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="f30fe-125">NerdDinner.Tests projektu</span><span class="sxs-lookup"><span data-stu-id="f30fe-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="f30fe-126">Když naše aplikace NerdDinner jsme vytvořili na začátku tohoto kurzu, se zobrazí výzva se dialogové okno s dotazem, jestli jsme chtěli vytvořit projekt testování částí se vyhýbáte projekt aplikace:</span><span class="sxs-lookup"><span data-stu-id="f30fe-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="f30fe-127">Společnost Microsoft uchovávat "Ano, vytvořit projekt testování částí" vybraný přepínač –, což vedlo "NerdDinner.Tests" projektu se přidávají do našich řešení:</span><span class="sxs-lookup"><span data-stu-id="f30fe-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="f30fe-128">NerdDinner.Tests projekt odkazuje na sestavení projektu aplikace NerdDinner a umožňuje nám to snadno přidat automatizovaných testů, který ověřit funkčnost aplikace.</span><span class="sxs-lookup"><span data-stu-id="f30fe-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="f30fe-129">Vytváření testů jednotek pro naše třída modelu Dinner</span><span class="sxs-lookup"><span data-stu-id="f30fe-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="f30fe-130">Přidejme do našich NerdDinner.Tests projektu, zkontrolujte, Dinner třídy, které jsme vytvořili, když jsme vytvořili naši modelu vrstvy některé testy.</span><span class="sxs-lookup"><span data-stu-id="f30fe-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="f30fe-131">Začneme tím, že vytvoříte novou složku v rámci naší testovací projekt s názvem "Modely" kde jsme budete umístit testech týkající se modelu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="f30fe-132">Vytvoříme klikněte pravým tlačítkem myši na složku a zvolte **Add -&gt;nový Test** příkazu nabídky.</span><span class="sxs-lookup"><span data-stu-id="f30fe-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="f30fe-133">Tím se otevře dialogové okno "Přidat nový Test".</span><span class="sxs-lookup"><span data-stu-id="f30fe-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="f30fe-134">My jsme vybrali k vytvoření testování částí"" a pojmenujte ho "DinnerTest.cs":</span><span class="sxs-lookup"><span data-stu-id="f30fe-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="f30fe-135">Když kliknete na tlačítko "ok" Visual Studio přidejte (a otevřete) DinnerTest.cs soubor do projektu:</span><span class="sxs-lookup"><span data-stu-id="f30fe-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="f30fe-136">Výchozí šablonu testů jednotek sady Visual Studio má spoustu kotle talíře kódu v rámci, které se mi najít trochu komplikované.</span><span class="sxs-lookup"><span data-stu-id="f30fe-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="f30fe-137">Pojďme vyčistěte ho tak, aby obsahovala pouze kód uvedený níže:</span><span class="sxs-lookup"><span data-stu-id="f30fe-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="f30fe-138">Atribut [TestClass] ve třídě DinnerTest výše ji identifikuje jako třída, která bude obsahovat testy, stejně jako volitelný testovací inicializace a jejich vyřazování z provozu kódu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="f30fe-139">Přidáním veřejné metody, které mají atributu [TestMethod] na nich jsme můžete definovat testy v rámci něj.</span><span class="sxs-lookup"><span data-stu-id="f30fe-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="f30fe-140">V následující tabulce jsou první dva testy, které přidáme, které vykonávají naší třídy Dinner.</span><span class="sxs-lookup"><span data-stu-id="f30fe-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="f30fe-141">První test ověří, naše společnost Dinner je neplatný, pokud se vytvoří nová společnost Dinner bez všechny vlastnosti nastavena správně.</span><span class="sxs-lookup"><span data-stu-id="f30fe-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="f30fe-142">Druhý test ověří, jestli je naše společnost Dinner platné při večeři má všechny vlastnosti nastavené platnými hodnotami:</span><span class="sxs-lookup"><span data-stu-id="f30fe-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="f30fe-143">Můžete si všimnout výše, naše názvy testů jsou velmi explicitní (a částečně podrobné).</span><span class="sxs-lookup"><span data-stu-id="f30fe-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="f30fe-144">Protože jsme může skončit vytváření stovek nebo tisíců malé testů, a chceme, aby byl snadno a rychle tak určit záměr a chování každého z nich (zejména při Těšíme se v seznamu chyb v nástroji test runner) to provádíme.</span><span class="sxs-lookup"><span data-stu-id="f30fe-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="f30fe-145">Názvy testů by měl být pojmenován po funkčnost, kterou testují.</span><span class="sxs-lookup"><span data-stu-id="f30fe-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="f30fe-146">Výše se používá "podstatné jméno\_by měl\_příkaz" vzor pro pojmenování.</span><span class="sxs-lookup"><span data-stu-id="f30fe-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="f30fe-147">Jsme vložili struktury testy pomocí "AAA" testování vzor – což je zkratka pro "Uspořádat, Act, kontrolní výraz":</span><span class="sxs-lookup"><span data-stu-id="f30fe-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="f30fe-148">Uspořádání: Nastavení jednotky testování</span><span class="sxs-lookup"><span data-stu-id="f30fe-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="f30fe-149">Akce: Vykonává jednotky v rámci testu a zaznamenat výsledky</span><span class="sxs-lookup"><span data-stu-id="f30fe-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="f30fe-150">Vyhodnocení: Ověřte, chování</span><span class="sxs-lookup"><span data-stu-id="f30fe-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="f30fe-151">Při psaní testů, které chceme, abyste se vyhnuli nutnosti jednotlivé testy provést příliš mnoho.</span><span class="sxs-lookup"><span data-stu-id="f30fe-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="f30fe-152">Místo toho každý test by měl ověřit jenom jeden koncept (což způsobí, že je mnohem snadnější identifikovat příčiny selhání).</span><span class="sxs-lookup"><span data-stu-id="f30fe-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="f30fe-153">Dobrým vodítkem je vyzkoušet a mít jenom jeden výraz příkazu pro každý test.</span><span class="sxs-lookup"><span data-stu-id="f30fe-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="f30fe-154">Pokud máte více než jeden kontrolní výraz příkazu v testovací metodě, ujistěte se, že se všechny používají k testování stejný koncept.</span><span class="sxs-lookup"><span data-stu-id="f30fe-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="f30fe-155">Pokud máte pochybnosti, ujistěte se, jiného testu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="f30fe-156">Spouštění testů</span><span class="sxs-lookup"><span data-stu-id="f30fe-156">Running Tests</span></span>

<span data-ttu-id="f30fe-157">Visual Studio 2008 Professional (a vyšší edice) zahrnuje integrované testu, který slouží ke spuštění testování částí v aplikaci Visual Studio projektů v rámci rozhraní IDE.</span><span class="sxs-lookup"><span data-stu-id="f30fe-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="f30fe-158">Můžeme vybrat **Test -&gt;Run -&gt;všechny testy v řešení** nabídky příkazu (nebo type Ctrl R, A) ke spuštění všech našich testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="f30fe-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="f30fe-159">Také jsme umístěte naše kurzor v rámci konkrétní testovací třídě nebo testovací metody a použít **Test -&gt;Run -&gt;testy v rámci aktuálního kontextu** příkaz nabídky (nebo type Ctrl R, T) spustit podmnožinu testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="f30fe-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="f30fe-160">Pojďme umístění naše kurzoru v rámci třídy DinnerTest a typ "Ctrl R, T" na dva spouštět testy, které jsme definovali.</span><span class="sxs-lookup"><span data-stu-id="f30fe-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="f30fe-161">Při provádění to "Výsledky testu" okna se zobrazí v rámci sady Visual Studio a uvidíme výsledky našich testovacích běhů uvedené v rámci něj:</span><span class="sxs-lookup"><span data-stu-id="f30fe-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

*<span data-ttu-id="f30fe-162">Poznámka: Ve výchozím nastavení nezobrazuje v okně Výsledky testu VS sloupec název třídy.</span><span class="sxs-lookup"><span data-stu-id="f30fe-162">Note: The VS test results window does not show the Class Name column by default.</span></span> <span data-ttu-id="f30fe-163">To můžete přidat kliknutím pravým tlačítkem v okně Výsledky testu a pomocí příkazu nabídky Přidat nebo odebrat sloupce.</span><span class="sxs-lookup"><span data-stu-id="f30fe-163">You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.</span></span>*

<span data-ttu-id="f30fe-164">Naše dva testy trvaly jenom zlomek sekundy ke spuštění – a jako vy můžete viz oba předán.</span><span class="sxs-lookup"><span data-stu-id="f30fe-164">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="f30fe-165">Teď můžeme přejít a rozšířit tak, že vytvoříte další testy, které ověřte ověření příslušné pravidlo, jakož i pokrývají dvě metody helper - IsUserHost() a IsUserRegistered() –, který jsme přidali do třídy Dinner.</span><span class="sxs-lookup"><span data-stu-id="f30fe-165">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegistered() – that we added to the Dinner class.</span></span> <span data-ttu-id="f30fe-166">Tyto testy s místem pro třídy Dinner filtrovacího řetězce se mnohem jednodušší a bezpečnější přidat nová obchodní pravidla a ověření k němu v budoucnu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-166">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="f30fe-167">Můžeme přidat naše nové logice pravidla Dinner a během několika sekund ověřte, že ji ještě fungovat některé naše předchozí funkce logic.</span><span class="sxs-lookup"><span data-stu-id="f30fe-167">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="f30fe-168">Všimněte si, jak pomocí testu popisný název usnadňuje rychle pochopit, co je ověření každého testu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-168">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="f30fe-169">Můžu jenom doporučit pomocí **nástroje -&gt;možnosti** příkaz nabídky, otevřete na testovací nástroje -&gt;konfigurační obrazovce pro spuštění testu a kontrola, zda "dvakrát kliknout výsledky testů jednotek neúspěšné nebo počet neprůkazných: Zobrazí zaškrtávací políčko bodu selhání při testu rozhraní".</span><span class="sxs-lookup"><span data-stu-id="f30fe-169">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="f30fe-170">To vám umožní klikněte dvakrát na chybu v okně Výsledky testu a okamžitý přechod na selhání kontrolní výraz.</span><span class="sxs-lookup"><span data-stu-id="f30fe-170">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="f30fe-171">Vytváření testů jednotek DinnersController</span><span class="sxs-lookup"><span data-stu-id="f30fe-171">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="f30fe-172">Nyní vytvoříme některé testy jednotek, které ověřují naše DinnersController funkce.</span><span class="sxs-lookup"><span data-stu-id="f30fe-172">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="f30fe-173">Začneme kliknutím pravým tlačítkem na složku "Řadiče" v rámci naší testovacího projektu a klikněte na tlačítko **Add -&gt;nový Test** příkazu nabídky.</span><span class="sxs-lookup"><span data-stu-id="f30fe-173">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="f30fe-174">Vytvoříme "Testování částí" a pojmenujte ho "DinnersControllerTest.cs".</span><span class="sxs-lookup"><span data-stu-id="f30fe-174">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="f30fe-175">Vytvoříme dvě testovací metody, které ověřují Details() metody akce na DinnersController.</span><span class="sxs-lookup"><span data-stu-id="f30fe-175">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="f30fe-176">První ověří, že zobrazení se vrátí, pokud se požaduje existující Dinner.</span><span class="sxs-lookup"><span data-stu-id="f30fe-176">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="f30fe-177">Druhý se ověří, že "Serveru" zobrazení se vrátí, pokud se požaduje neexistující Dinner:</span><span class="sxs-lookup"><span data-stu-id="f30fe-177">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="f30fe-178">Výše uvedený kód se zkompiluje čištění.</span><span class="sxs-lookup"><span data-stu-id="f30fe-178">The above code compiles clean.</span></span> <span data-ttu-id="f30fe-179">Když spustíme testy, ale oba selhání:</span><span class="sxs-lookup"><span data-stu-id="f30fe-179">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="f30fe-180">Když se podíváte na chybové zprávy, uvidíme, že byl důvod testy se nezdařilo, protože naše třída DinnersRepository se nemohl připojit k databázi.</span><span class="sxs-lookup"><span data-stu-id="f30fe-180">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="f30fe-181">Naše aplikace NerdDinner používá připojovací řetězec do místního souboru systému SQL Server Express, která se nachází v části \App\_datový adresář projektu aplikace NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="f30fe-181">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="f30fe-182">Protože naše NerdDinner.Tests projekt zkompiluje a spustí v jiném adresáři poté projekt aplikace, relativní cestu umístění naše připojovací řetězec je nesprávný.</span><span class="sxs-lookup"><span data-stu-id="f30fe-182">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="f30fe-183">Jsme *může* opravit tak, že zkopírujete soubor databáze SQL Express na naše testovací projekt a potom k němu přidejte odpovídajícím testovacím řetězcových připojení v souboru App.config naše testovacího projektu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-183">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="f30fe-184">To byste získali výše uvedenými testy se odblokuje a spuštěný.</span><span class="sxs-lookup"><span data-stu-id="f30fe-184">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="f30fe-185">Testování částí kódu pomocí skutečná databáze, ale přináší určité problémy.</span><span class="sxs-lookup"><span data-stu-id="f30fe-185">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="f30fe-186">Konkrétně:</span><span class="sxs-lookup"><span data-stu-id="f30fe-186">Specifically:</span></span>

- <span data-ttu-id="f30fe-187">Může výrazně zpomalit spuštění testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="f30fe-187">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="f30fe-188">Tím déle trvá spuštění testů, tím méně pravděpodobné, že jsou v jejich spuštění často.</span><span class="sxs-lookup"><span data-stu-id="f30fe-188">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="f30fe-189">V ideálním případě byste měli být schopni spustit v sekundách – a bylo možné něco, co uděláte jako přirozeně jako kompilaci projektu testů jednotek.</span><span class="sxs-lookup"><span data-stu-id="f30fe-189">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="f30fe-190">To komplikuje instalačním a úklidovém logiky v rámci testů.</span><span class="sxs-lookup"><span data-stu-id="f30fe-190">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="f30fe-191">Chcete, aby každý Jednotkový test chcete být izolované a nezávisle na ostatních (se žádné vedlejší účinky nebo závislostmi).</span><span class="sxs-lookup"><span data-stu-id="f30fe-191">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="f30fe-192">Při práci na skutečné databázi máte dávejte stavu a resetujte si ho mezi testy.</span><span class="sxs-lookup"><span data-stu-id="f30fe-192">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="f30fe-193">Podívejme se na návrhový vzor, který se nazývá "injektáž závislostí", který vám pomůže tyto problémy obejít a vyhněte se nutnosti skutečná databáze pomocí našich testů.</span><span class="sxs-lookup"><span data-stu-id="f30fe-193">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="f30fe-194">Injektáž závislostí</span><span class="sxs-lookup"><span data-stu-id="f30fe-194">Dependency Injection</span></span>

<span data-ttu-id="f30fe-195">Právě teď DinnersController je úzce "s velkou provázaností" DinnerRepository třídy.</span><span class="sxs-lookup"><span data-stu-id="f30fe-195">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="f30fe-196">"Párování" odkazuje na situaci, kde třída explicitně závisí na jiné třídy fungování:</span><span class="sxs-lookup"><span data-stu-id="f30fe-196">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="f30fe-197">Protože třída DinnerRepository vyžaduje přístup k databázi, vysoce provázané závislost DinnersController třída nemá na DinnerRepository končí by nám umožnily databáze mohl DinnersController metody akce má být testována.</span><span class="sxs-lookup"><span data-stu-id="f30fe-197">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="f30fe-198">Tento problém jsme můžete získat pomocí vzoru návrhu volá "injektáž závislostí" – což je přístup, ve kterém se závislosti (stejně jako třídy úložiště, které poskytují přístup k datům) vytvoří už nebude implicitně v rámci třídy, které je používají.</span><span class="sxs-lookup"><span data-stu-id="f30fe-198">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="f30fe-199">Místo toho závislosti můžete explicitně předán do třídy, která je používá pomocí argumentů konstruktoru.</span><span class="sxs-lookup"><span data-stu-id="f30fe-199">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="f30fe-200">Pokud tyto závislosti jsou definovány pomocí rozhraní, máme pak flexibilitu a zajistěte tak předání implementace "falešnou" závislostí pro scénáře testování částí.</span><span class="sxs-lookup"><span data-stu-id="f30fe-200">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="f30fe-201">To umožňuje vytvořit implementace závislosti daného testu, které skutečně nevyžadují přístup k databázi.</span><span class="sxs-lookup"><span data-stu-id="f30fe-201">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="f30fe-202">Tento údaj zobrazíte v akci, můžeme implementovat injektáž závislostí s naší DinnersController.</span><span class="sxs-lookup"><span data-stu-id="f30fe-202">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="f30fe-203">Extrahování rozhraní IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="f30fe-203">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="f30fe-204">Naše prvním krokem bude vytvoření nového IDinnerRepository rozhraní, který zapouzdřuje kontrakt úložiště, které se načítají a aktualizují večeří vyžadují naše řadiče.</span><span class="sxs-lookup"><span data-stu-id="f30fe-204">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="f30fe-205">Jsme tento kontrakt rozhraní definovat ručně tak, že pravým tlačítkem na složku \Models a potom kliknete **Add -&gt;nová položka** příkaz nabídky a vytváří se nové rozhraní s názvem IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="f30fe-205">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="f30fe-206">Také jsme můžete použít automaticky refaktoring nástroje integrovaná do sady Visual Studio Professional (a vyšší edice) k extrahování a vytvoření rozhraní pro nás z naší stávající DinnerRepository třídy.</span><span class="sxs-lookup"><span data-stu-id="f30fe-206">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="f30fe-207">Extrahovat toto rozhraní pomocí VS, jednoduše umístěte kurzor do textového editoru ve třídě DinnerRepository klikněte pravým tlačítkem myši a zvolte **Refaktorujte -&gt;extrahování rozhraní** příkazu nabídky:</span><span class="sxs-lookup"><span data-stu-id="f30fe-207">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="f30fe-208">To spustí dialogové okno "Extrahování rozhraní" a nám výzvu k zadání názvu rozhraní pro vytváření.</span><span class="sxs-lookup"><span data-stu-id="f30fe-208">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="f30fe-209">Bude ve výchozím nastavení IDinnerRepository a automaticky vybrat všechny veřejné metody na stávající třídě DinnerRepository přidat do rozhraní:</span><span class="sxs-lookup"><span data-stu-id="f30fe-209">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="f30fe-210">Když kliknete na tlačítko "ok", Visual Studio přidá nové rozhraní IDinnerRepository do naší aplikace:</span><span class="sxs-lookup"><span data-stu-id="f30fe-210">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="f30fe-211">A naše existující třídu DinnerRepository aktualizuje tak, že implementuje rozhraní:</span><span class="sxs-lookup"><span data-stu-id="f30fe-211">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="f30fe-212">Aktualizuje se DinnersController pro podporu vkládání konstruktor</span><span class="sxs-lookup"><span data-stu-id="f30fe-212">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="f30fe-213">Nyní aktualizujeme třídu DinnersController nové rozhraní.</span><span class="sxs-lookup"><span data-stu-id="f30fe-213">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="f30fe-214">Aktuálně DinnersController je pevně zakódováno, tak, aby jeho "dinnerRepository" pole je vždy DinnerRepository třídy:</span><span class="sxs-lookup"><span data-stu-id="f30fe-214">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="f30fe-215">Tak, aby pole "dinnerRepository" typu IDinnerRepository místo DinnerRepository ho Změníme.</span><span class="sxs-lookup"><span data-stu-id="f30fe-215">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="f30fe-216">Potom přidáme dvě veřejné konstruktory DinnersController.</span><span class="sxs-lookup"><span data-stu-id="f30fe-216">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="f30fe-217">Jeden z konstruktorů umožňuje IDinnerRepository mají být předány jako argument.</span><span class="sxs-lookup"><span data-stu-id="f30fe-217">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="f30fe-218">Druhé je výchozí konstruktor, který využívá naše stávající implementaci DinnerRepository:</span><span class="sxs-lookup"><span data-stu-id="f30fe-218">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="f30fe-219">Vzhledem k tomu, že technologie ASP.NET MVC ve výchozím nastavení vytvoří třídu kontroleru pomocí výchozí konstruktory, naše DinnersController za běhu bude nadále používat třídu DinnerRepository přístup k datům.</span><span class="sxs-lookup"><span data-stu-id="f30fe-219">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="f30fe-220">Naše testy jednotek, ale jsme teď můžete aktualizovat a zajistěte tak předání na "falešnou" dinner implementace úložiště pomocí parametru konstruktoru.</span><span class="sxs-lookup"><span data-stu-id="f30fe-220">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="f30fe-221">Toto úložiště "falešnou" dinner nebude vyžadovat přístup ke skutečné databázi a místo toho použije v paměti ukázková data.</span><span class="sxs-lookup"><span data-stu-id="f30fe-221">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="f30fe-222">Vytvoření třídy FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="f30fe-222">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="f30fe-223">Pojďme vytvořit třídu FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="f30fe-223">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="f30fe-224">Vytvoříme nejprve vytvořit adresář "Fakes" v rámci naší NerdDinner.Tests projektu a potom k němu přidejte novou třídu FakeDinnerRepository (klikněte pravým tlačítkem na složku a zvolte **Add -&gt;novou třídu**):</span><span class="sxs-lookup"><span data-stu-id="f30fe-224">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="f30fe-225">Aktualizujeme kód tak, aby FakeDinnerRepository třída implementuje rozhraní IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="f30fe-225">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="f30fe-226">Pak můžeme klepněte na něj pravým tlačítkem myši a zvolte příkaz "Implementovat rozhraní IDinnerRepository" kontextové nabídky:</span><span class="sxs-lookup"><span data-stu-id="f30fe-226">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="f30fe-227">To způsobí, že Visual Studio automaticky přidat všechny členy rozhraní IDinnerRepository do našich FakeDinnerRepository třídy s výchozí implementace "zástupných procedur":</span><span class="sxs-lookup"><span data-stu-id="f30fe-227">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="f30fe-228">Společnost Microsoft může aktualizovat také FakeDinnerRepository implementace pro práci z přehledu v paměti&lt;Dinner&gt; kolekce do něho předaný jako argument konstruktoru:</span><span class="sxs-lookup"><span data-stu-id="f30fe-228">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="f30fe-229">Teď máme falešné IDinnerRepository implementace, která nevyžaduje databázi a místo toho můžete pracovat vypnout v paměti seznam objektů Dinner.</span><span class="sxs-lookup"><span data-stu-id="f30fe-229">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="f30fe-230">FakeDinnerRepository pomocí testů jednotek</span><span class="sxs-lookup"><span data-stu-id="f30fe-230">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="f30fe-231">Vraťme se k DinnersController jednotkové testy, které se dříve nezdařila, protože databáze nebyla dostupná.</span><span class="sxs-lookup"><span data-stu-id="f30fe-231">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="f30fe-232">Abychom mohli aktualizovat testovací metody používat FakeDinnerRepository vyplní ukázkovými daty večeře v paměti do DinnersController pomocí níže uvedeného kódu:</span><span class="sxs-lookup"><span data-stu-id="f30fe-232">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="f30fe-233">A teď jsme spuštění těchto testů, oba předejte:</span><span class="sxs-lookup"><span data-stu-id="f30fe-233">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="f30fe-234">Nejlepší na tom budou trvat jenom zlomek sekundy ke spuštění a nevyžadují žádnou logiku složité instalační/čistící.</span><span class="sxs-lookup"><span data-stu-id="f30fe-234">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="f30fe-235">Můžeme teď testování částí, všechny naše DinnersController akce kód metody (včetně výpis, stránkování, podrobností, vytvářet, aktualizovat a odstraňovat) bez přichystanou pro připojení ke skutečné databázi.</span><span class="sxs-lookup"><span data-stu-id="f30fe-235">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| **<span data-ttu-id="f30fe-236">Téma na straně: Rozhraní injektáž závislostí</span><span class="sxs-lookup"><span data-stu-id="f30fe-236">Side Topic: Dependency Injection Frameworks</span></span>** |
| --- |
| <span data-ttu-id="f30fe-237">Provádí vkládání závislostí ruční (podobně jako jsme výše) funguje správně, ale budou obtížnější spravovat jako Počet závislostí a zvyšuje komponenty v aplikaci.</span><span class="sxs-lookup"><span data-stu-id="f30fe-237">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="f30fe-238">Několik architektur injektáž závislostí existovat pro .NET, která poskytuje ještě větší flexibilita díky správy závislostí.</span><span class="sxs-lookup"><span data-stu-id="f30fe-238">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="f30fe-239">Tyto architektury, také někdy označuje jako "inverzi z" (Inversion) – kontejnery ovládacích prvků, poskytují mechanismy, které umožňují další úroveň podporu konfigurace pro zadávání a předávání objektů za běhu (nejčastěji pomocí konstruktoru injektáž závislostí ).</span><span class="sxs-lookup"><span data-stu-id="f30fe-239">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="f30fe-240">Některé další oblíbené injektáž závislostí OSS / include IOC rozhraní v rozhraní .NET: AutoFac Ninject, Spring.NET, StructureMap a Windsor.</span><span class="sxs-lookup"><span data-stu-id="f30fe-240">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="f30fe-241">ASP.NET MVC poskytuje rozhraní API, který vývojářům umožňuje účastnit rozlišení a vytváření instancí kontrolerů a který umožňuje injektáž závislostí pro rozšíření / rozhraní IoC čistě integraci v rámci tohoto procesu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-241">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="f30fe-242">Pomocí rozhraní DI/IOC by také nám umožňují odebrání naše DinnersController – které by úplně odebrat párování mezi ním a DinnerRepository výchozí konstruktor.</span><span class="sxs-lookup"><span data-stu-id="f30fe-242">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepository.</span></span> <span data-ttu-id="f30fe-243">Nebudeme používat injektáž závislostí / framework IOC s naší aplikace NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="f30fe-243">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="f30fe-244">Ale to je něco, co jsme zvažte v budoucnosti Pokud zvětšoval NerdDinner základ kódu a možnosti.</span><span class="sxs-lookup"><span data-stu-id="f30fe-244">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="f30fe-245">Vytváření testů jednotek akce úpravy</span><span class="sxs-lookup"><span data-stu-id="f30fe-245">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="f30fe-246">Nyní vytvoříme některé testy jednotek, které ověřují funkce DinnersController pro úpravy.</span><span class="sxs-lookup"><span data-stu-id="f30fe-246">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="f30fe-247">Začneme testovací verze HTTP GET naše akce úpravy:</span><span class="sxs-lookup"><span data-stu-id="f30fe-247">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="f30fe-248">Test, který ověřuje, že zobrazení se opírá o DinnerFormViewModel objekt je vykreslen zpět, když je požadováno platné dinner vytvoříme:</span><span class="sxs-lookup"><span data-stu-id="f30fe-248">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="f30fe-249">Když spustíme testu, ale jsme zjistíte, že se to nezdaří, protože výjimka nulového odkazu je vyvolána, když metoda úprav přistupuje k vlastnosti User.Identity.Name provádět kontrolu Dinner.IsHostedBy().</span><span class="sxs-lookup"><span data-stu-id="f30fe-249">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="f30fe-250">Objekt uživatele na základní třídu Kontroleru zapouzdřuje informace o přihlášeného uživatele a je vyplněn ASP.NET MVC, když vytváří kontroleru za běhu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-250">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="f30fe-251">Protože se testují DinnersController mimo prostředí webového serveru, uživatele objekt není nastavený (tedy odkazem s hodnotou null výjimka).</span><span class="sxs-lookup"><span data-stu-id="f30fe-251">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="f30fe-252">Napodobování vlastnost User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="f30fe-252">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="f30fe-253">Napodobování architektury provést testování usnadnit tím, že nám dynamicky se vytvářejí falešné verze závislé objekty, které podporují testech.</span><span class="sxs-lookup"><span data-stu-id="f30fe-253">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="f30fe-254">Například můžete použít napodobování framework v testovacím akce Upravit dynamicky se vytvářejí objekt uživatele, naše DinnersController můžete použít k vyhledání simulovaný uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="f30fe-254">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="f30fe-255">Tím se vyhnete odkaz s hodnotou null z je vyvolána, když jsme naše testu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-255">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="f30fe-256">Existuje mnoho .NET napodobování architektur, které lze použít s ASP.NET MVC (zobrazí se seznam je tady: [ http://www.mockframeworks.com/ ](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="f30fe-256">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="f30fe-257">Testování aplikace NerdDinner použijeme open source napodobování rámec se nazývá "Moq", který si můžete stáhnout zdarma z [ http://www.mockframeworks.com/moq ](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="f30fe-257">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="f30fe-258">Po stažení, přidáme v našem NerdDinner.Tests projektu odkaz na sestavení Moq.dll:</span><span class="sxs-lookup"><span data-stu-id="f30fe-258">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="f30fe-259">Potom přidáme Pomocná metoda "CreateDinnersControllerAs(username)" pro naše testovací třídy, který přebírá uživatelské jméno jako parametr a které pak "mocks" User.Identity.Name vlastnost u DinnersController instance:</span><span class="sxs-lookup"><span data-stu-id="f30fe-259">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="f30fe-260">Moq výše se používá k vytvoření objektu model, který napodobenin objekt parametrem ControllerContext (což je technologie ASP.NET MVC předá do třídy Kontroleru ke zveřejnění objekty modulu runtime jako uživatel, požadavku a odpovědi a relace).</span><span class="sxs-lookup"><span data-stu-id="f30fe-260">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="f30fe-261">Metoda "SetupGet" voláme na model k označení, že vlastnost HttpContext.User.Identity.Name parametrem ControllerContext by měla vrátit řetězec uživatelské jméno, které jsme předaný metodě pomocné rutiny.</span><span class="sxs-lookup"><span data-stu-id="f30fe-261">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="f30fe-262">Společnost Microsoft může napodobení libovolný počet parametrem ControllerContext vlastnosti a metody.</span><span class="sxs-lookup"><span data-stu-id="f30fe-262">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="f30fe-263">Pro ilustraci, to jsme taky přidali SetupGet() volání pro vlastnost Request.IsAuthenticated (což není skutečně potřeba pro testy níže – ale což omezuje ukazují, jak můžete napodobení vlastnosti požadavku).</span><span class="sxs-lookup"><span data-stu-id="f30fe-263">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="f30fe-264">Když jsme se vším hotovi jsme přiřadit instanci cvičné parametrem ControllerContext DinnersController naše Pomocná metoda vrátí.</span><span class="sxs-lookup"><span data-stu-id="f30fe-264">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="f30fe-265">Můžeme se teď dá zapisovat jednotkové testy používající tuto metodu helper otestovat úpravy scénáře zahrnující různých uživatelů:</span><span class="sxs-lookup"><span data-stu-id="f30fe-265">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="f30fe-266">A teď, když spustíme testy se předají:</span><span class="sxs-lookup"><span data-stu-id="f30fe-266">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="f30fe-267">Scénáře testování UpdateModel()</span><span class="sxs-lookup"><span data-stu-id="f30fe-267">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="f30fe-268">Vytvořili jsme testy, které se týkají verze HTTP GET akce úpravy.</span><span class="sxs-lookup"><span data-stu-id="f30fe-268">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="f30fe-269">Nyní vytvoříme některé testy, které ověřují verze HTTP POST akci Upravit:</span><span class="sxs-lookup"><span data-stu-id="f30fe-269">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="f30fe-270">Zajímavé nové testovací scénář pro nás pro podporu s touto metodou akce je jeho použití UpdateModel() pomocnou metodu v základní třídě Controller.</span><span class="sxs-lookup"><span data-stu-id="f30fe-270">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="f30fe-271">Tato pomocná metoda se používá k vytvoření vazby odeslaného formuláře naše společnost Dinner instanci objektu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-271">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="f30fe-272">Níže jsou dva testy, které ukazuje, jak můžeme zadat formuláře, pošle hodnoty UpdateModel() pomocné metody pro použití.</span><span class="sxs-lookup"><span data-stu-id="f30fe-272">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="f30fe-273">Jsme budete k tomu vytváří se a naplňuje objekt FormCollection a pak ji přiřaďte vlastnost "Položka ValueProvider" v řadiči.</span><span class="sxs-lookup"><span data-stu-id="f30fe-273">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="f30fe-274">První test ověří, že při úspěšném uložení prohlížeč přesměrován na podrobnosti o akci.</span><span class="sxs-lookup"><span data-stu-id="f30fe-274">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="f30fe-275">Druhý test ověří, že když se pošle neplatný vstup akce znovu zobrazí zobrazení pro úpravy znovu s chybovou zprávou.</span><span class="sxs-lookup"><span data-stu-id="f30fe-275">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>


[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="f30fe-276">Testování Wrap-Up</span><span class="sxs-lookup"><span data-stu-id="f30fe-276">Testing Wrap-Up</span></span>

<span data-ttu-id="f30fe-277">Věnovali jsme základní koncepty zapojené do třídy kontroleru testování jednotek.</span><span class="sxs-lookup"><span data-stu-id="f30fe-277">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="f30fe-278">Můžeme použít tyto postupy můžete snadno vytvořit stovky jednoduchých testů, které ověří chování naši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="f30fe-278">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="f30fe-279">Protože naše kontroléru a testovacích modelu nevyžadují skutečná databáze, jsou extrémně rychlé a snadné spuštění.</span><span class="sxs-lookup"><span data-stu-id="f30fe-279">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="f30fe-280">Budeme moct spustit stovky automatizované testy během několika sekund a okamžitě získat zpětnou vazbu o tom, zda změny, které jsme udělali se podařilo přerušit něco.</span><span class="sxs-lookup"><span data-stu-id="f30fe-280">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="f30fe-281">To vám pomůže nám poskytnout jistotu potřebnou pro průběžně vylepšovat, refaktorace a upřesňovat naši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="f30fe-281">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="f30fe-282">Jsme probrali testování jako poslední téma v této kapitole – ale ne vzhledem k tomu testování se něco by měl provádět na konci procesu vývoje!</span><span class="sxs-lookup"><span data-stu-id="f30fe-282">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="f30fe-283">Naopak měli byste psát automatizované testy co nejdříve do vašeho vývojového procesu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-283">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="f30fe-284">To uděláte tak umožňuje načíst okamžitou zpětnou vazbu při vývoji, pomáhá vytvoříte promyšlené uvažovat o scénáře použití vaší aplikace a provede vás k návrhu vaší aplikace pomocí čisté vrstvení a párování v úvahu.</span><span class="sxs-lookup"><span data-stu-id="f30fe-284">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="f30fe-285">Novější kapitolu v knize se o testu řízeného vývoje (TDD) a jak ji používat s architekturou ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="f30fe-285">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="f30fe-286">TDD je iterativní způsobem kódování, kde první psát testy, které se bude splňovat vaše výsledný kód.</span><span class="sxs-lookup"><span data-stu-id="f30fe-286">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="f30fe-287">S TDD začnete tak, že vytvoříte test, který ověří funkčnost, kterou se chystáte implementace jednotlivých funkcí.</span><span class="sxs-lookup"><span data-stu-id="f30fe-287">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="f30fe-288">Zápis jednotka testu nejprve pomáhá zajistit jasně porozumět funkci a jak by mělo fungovat.</span><span class="sxs-lookup"><span data-stu-id="f30fe-288">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="f30fe-289">Pouze poté, co se zapíše testu (a si ověříte, že rutina selže) se pak implementovat funkci skutečný test ověří.</span><span class="sxs-lookup"><span data-stu-id="f30fe-289">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="f30fe-290">Vzhledem k tomu, že jste již stráveného času přemýšlení o případ použití, z jak funkci má práce, budete mít lepší přehled požadavků a nejlepší způsob pro jejich implementaci.</span><span class="sxs-lookup"><span data-stu-id="f30fe-290">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="f30fe-291">Jakmile budete hotovi s prováděním můžete znovu spustit test – a získat okamžitou zpětnou vazbu na tom, jestli funkce funguje správně.</span><span class="sxs-lookup"><span data-stu-id="f30fe-291">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="f30fe-292">Probereme TDD informace najdete v kapitole 10.</span><span class="sxs-lookup"><span data-stu-id="f30fe-292">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="f30fe-293">Dalším krokem</span><span class="sxs-lookup"><span data-stu-id="f30fe-293">Next Step</span></span>

<span data-ttu-id="f30fe-294">Některé konečné zalamování řádků do komentáře.</span><span class="sxs-lookup"><span data-stu-id="f30fe-294">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f30fe-295">[Předchozí](use-ajax-to-implement-mapping-scenarios.md)
> [další](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="f30fe-295">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
