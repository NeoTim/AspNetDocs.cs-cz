---
uid: mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
title: Použití asynchronních metod v ASP.NET MVC 4 | Microsoft Docs
author: Rick-Anderson
description: V tomto kurzu se naučíte základy vytváření asynchronní webové aplikace ASP.NET MVC pomocí Visual Studio Express 2012 pro web, což je zdarma...
ms.author: riande
ms.date: 06/06/2012
ms.assetid: a56572ba-81c3-47af-826d-941e9c4775ec
msc.legacyurl: /mvc/overview/performance/using-asynchronous-methods-in-aspnet-mvc-4
msc.type: authoredcontent
ms.openlocfilehash: 15692b18fc112c4c6cce4d50a243a0e8d5fb52a4
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78538519"
---
# <a name="using-asynchronous-methods-in-aspnet-mvc-4"></a><span data-ttu-id="76463-103">Použití asynchronních metod v architektuře ASP.NET MVC 4</span><span class="sxs-lookup"><span data-stu-id="76463-103">Using Asynchronous Methods in ASP.NET MVC 4</span></span>

<span data-ttu-id="76463-104">od [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="76463-104">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="76463-105">V tomto kurzu se naučíte základy vytváření asynchronní webové aplikace ASP.NET MVC pomocí [Visual Studio Express 2012 pro web](https://www.microsoft.com/visualstudio/11), což je bezplatná verze Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="76463-105">This tutorial will teach you the basics of building an asynchronous ASP.NET MVC Web application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="76463-106">Můžete také použít [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="76463-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span>
> 
> <span data-ttu-id="76463-107">Pro tento kurz na GitHubu je k dispozici kompletní ukázka [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span><span class="sxs-lookup"><span data-stu-id="76463-107">A complete sample is provided for this tutorial on github [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/)</span></span>

<span data-ttu-id="76463-108">Třída [kontroleru](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) ASP.NET MVC 4 v kombinaci [.NET 4,5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) umožňuje psát asynchronní metody akcí, které vracejí objekt typu [Task&lt;ActionResult&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span><span class="sxs-lookup"><span data-stu-id="76463-108">The ASP.NET MVC 4 [Controller](https://msdn.microsoft.com/library/system.web.mvc.controller(VS.108).aspx) class in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to write asynchronous action methods that return an object of type [Task&lt;ActionResult&gt;](https://msdn.microsoft.com/library/dd321424(VS.110).aspx).</span></span> <span data-ttu-id="76463-109">.NET Framework 4 představila asynchronní programovací koncept, který je označován jako [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) a ASP.NET MVC [4.](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx)</span><span class="sxs-lookup"><span data-stu-id="76463-109">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET MVC 4 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="76463-110">Úkoly jsou reprezentovány typem **úkolu** a souvisejícími typy v oboru názvů [System. Threading. Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) .</span><span class="sxs-lookup"><span data-stu-id="76463-110">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="76463-111">.NET Framework 4,5 sestaví k této asynchronní podpoře s klíčovým slovem [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , která umožňují pracovat s objekty [úlohy](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) mnohem méně složitější než předchozí asynchronní přístupy.</span><span class="sxs-lookup"><span data-stu-id="76463-111">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="76463-112">Klíčové slovo [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) je syntaktická zkratka pro značící, že část kódu by měla asynchronně čekat na nějakou jinou část kódu.</span><span class="sxs-lookup"><span data-stu-id="76463-112">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="76463-113">Klíčové slovo [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) představuje pomocný parametr, který můžete použít k označení metod jako asynchronních metod založených na úlohách.</span><span class="sxs-lookup"><span data-stu-id="76463-113">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="76463-114">Kombinace **operátoru await**, **Async**a objektu **Task** usnadňuje psaní asynchronního kódu v rozhraní .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="76463-114">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="76463-115">Nový model pro asynchronní metody se nazývá *asynchronní vzor založený na úlohách* (**klepněte**).</span><span class="sxs-lookup"><span data-stu-id="76463-115">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="76463-116">V tomto kurzu se předpokládá, že máte zkušenosti s asynchronním programováním pomocí klíčových slov [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) a oboru názvů [úkolu](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) .</span><span class="sxs-lookup"><span data-stu-id="76463-116">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="76463-117">Další informace o klíčovém slově [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) a oboru názvů [úkolů](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) naleznete v následujících odkazech.</span><span class="sxs-lookup"><span data-stu-id="76463-117">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="76463-118">Dokument White Paper: asynchronii v .NET</span><span class="sxs-lookup"><span data-stu-id="76463-118">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="76463-119">Nejčastější dotazy k Async/await</span><span class="sxs-lookup"><span data-stu-id="76463-119">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="76463-120">Asynchronní programování v aplikaci Visual Studio</span><span class="sxs-lookup"><span data-stu-id="76463-120">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a><span data-ttu-id="76463-121">Způsob zpracování požadavků fondem vláken</span><span class="sxs-lookup"><span data-stu-id="76463-121">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="76463-122">Na webovém serveru .NET Framework udržuje fond vláken, která se používají k obsluhování požadavků ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="76463-122">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="76463-123">Když požadavek dorazí, vlákno z fondu se odešle do zpracování tohoto požadavku.</span><span class="sxs-lookup"><span data-stu-id="76463-123">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="76463-124">Pokud je požadavek zpracováván synchronně, vlákno, který zpracovává požadavek, je při zpracování žádosti zaneprázdněno a vlákno nemůže obsluhovat jiný požadavek.</span><span class="sxs-lookup"><span data-stu-id="76463-124">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="76463-125">Nemusí se jednat o problém, protože fond vláken je možné dostatečně velký, aby se vešel do mnoha zaneprázdněných vláken.</span><span class="sxs-lookup"><span data-stu-id="76463-125">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="76463-126">Počet vláken ve fondu vláken je ale omezený (výchozí maximum pro .NET 4,5 je 5 000).</span><span class="sxs-lookup"><span data-stu-id="76463-126">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="76463-127">Ve velkých aplikacích s vysokou souběžnou délkou dlouhotrvajících požadavků můžou být všechna dostupná vlákna zaneprázdněná.</span><span class="sxs-lookup"><span data-stu-id="76463-127">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="76463-128">Tato podmínka se označuje jako vyčerpání vlákna.</span><span class="sxs-lookup"><span data-stu-id="76463-128">This condition is known as thread starvation.</span></span> <span data-ttu-id="76463-129">Po dosažení tohoto stavu vyřadí webové servery požadavky.</span><span class="sxs-lookup"><span data-stu-id="76463-129">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="76463-130">Pokud se fronta požadavků zaplní, webový server odmítne žádosti se stavem HTTP 503 (Server je příliš zaneprázdněný).</span><span class="sxs-lookup"><span data-stu-id="76463-130">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="76463-131">Fond vláken CLR má omezení pro vkládání nových vláken.</span><span class="sxs-lookup"><span data-stu-id="76463-131">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="76463-132">Pokud je souběžnost souběžnosti (to znamená, že váš web může náhle obdržet velký počet požadavků) a že všechna dostupná vlákna požadavků jsou zaneprázdněna z důvodu back-endu s vysokou latencí, může vaše aplikace velmi špatně reagovat.</span><span class="sxs-lookup"><span data-stu-id="76463-132">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="76463-133">Každé nové vlákno přidané do fondu vláken má navíc režii (například 1 MB paměti zásobníku).</span><span class="sxs-lookup"><span data-stu-id="76463-133">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="76463-134">Webová aplikace, která používá synchronní metody pro obsluhu vysoké latence, kdy se fond vláken zvětšuje na standard .NET 4,5, ve výchozím nastavení maximum je 5 000 vláken, což by využilo přibližně 5 GB paměti, než je aplikace schopná, aby služba používala stejné požadavky. asynchronní metody a jenom 50 vláken.</span><span class="sxs-lookup"><span data-stu-id="76463-134">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="76463-135">Při asynchronní práci nepoužíváte vždy vlákno.</span><span class="sxs-lookup"><span data-stu-id="76463-135">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="76463-136">Například při provádění asynchronní žádosti webové služby nebude ASP.NET používat žádná vlákna mezi voláním **asynchronní** metody a **await**.</span><span class="sxs-lookup"><span data-stu-id="76463-136">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="76463-137">Použití fondu vláken ke zpracování žádostí s vysokou latencí může způsobit velké nároky na paměť a špatné využití hardwaru serveru.</span><span class="sxs-lookup"><span data-stu-id="76463-137">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="76463-138">Zpracování asynchronních požadavků</span><span class="sxs-lookup"><span data-stu-id="76463-138">Processing Asynchronous Requests</span></span>

<span data-ttu-id="76463-139">Ve webové aplikaci, která vidí velký počet souběžných požadavků při spuštění nebo má zátěžové zatížení (kde se souběžně roste souběžně), provádí volání webové služby asynchronní odezvu aplikace.</span><span class="sxs-lookup"><span data-stu-id="76463-139">In a web app that sees a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous increases the responsiveness of the app.</span></span> <span data-ttu-id="76463-140">Asynchronní požadavek trvá zpracování jako synchronní požadavek stejným časem.</span><span class="sxs-lookup"><span data-stu-id="76463-140">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="76463-141">Pokud požadavek provede volání webové služby, které vyžaduje dokončení dvou sekund, požadavek trvá dvě sekundy, ať už se provádí synchronně nebo asynchronně.</span><span class="sxs-lookup"><span data-stu-id="76463-141">If a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it's performed synchronously or asynchronously.</span></span> <span data-ttu-id="76463-142">Během asynchronního volání ale vlákno neblokuje reakci na jiné požadavky, zatímco čeká na dokončení první žádosti.</span><span class="sxs-lookup"><span data-stu-id="76463-142">However during an asynchronous call, a thread isn't blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="76463-143">Asynchronní požadavky proto zabraňují zařazování požadavků a nárůstu fondu vláken, pokud existuje celá řada souběžných požadavků, které spouštějí dlouhotrvající operace.</span><span class="sxs-lookup"><span data-stu-id="76463-143">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a><span data-ttu-id="76463-144">Výběr metod synchronní nebo asynchronní akce</span><span class="sxs-lookup"><span data-stu-id="76463-144">Choosing Synchronous or Asynchronous Action Methods</span></span>

<span data-ttu-id="76463-145">V této části jsou uvedeny pokyny pro použití synchronních nebo asynchronních metod akcí.</span><span class="sxs-lookup"><span data-stu-id="76463-145">This section lists guidelines for when to use synchronous or asynchronous action methods.</span></span> <span data-ttu-id="76463-146">Jsou to jenom pokyny. Prověřte každou aplikaci jednotlivě a určete, zda asynchronní metody pomůžou s výkonem.</span><span class="sxs-lookup"><span data-stu-id="76463-146">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="76463-147">Obecně platí, že použijte synchronní metody pro následující podmínky:</span><span class="sxs-lookup"><span data-stu-id="76463-147">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="76463-148">Operace jsou jednoduché nebo krátkodobé.</span><span class="sxs-lookup"><span data-stu-id="76463-148">The operations are simple or short-running.</span></span>
- <span data-ttu-id="76463-149">Jednoduchost je důležitější než efektivita.</span><span class="sxs-lookup"><span data-stu-id="76463-149">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="76463-150">Operace jsou primárně operace CPU místo operací, které zahrnují velký výkon disku nebo síťové režie.</span><span class="sxs-lookup"><span data-stu-id="76463-150">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="76463-151">Použití asynchronních metod akcí na operacích vázaných na procesor poskytuje žádné výhody a má za následek větší režii.</span><span class="sxs-lookup"><span data-stu-id="76463-151">Using asynchronous action methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

<span data-ttu-id="76463-152">Obecně použijte asynchronní metody pro následující podmínky:</span><span class="sxs-lookup"><span data-stu-id="76463-152">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="76463-153">Voláte služby, které mohou být spotřebovány prostřednictvím asynchronních metod, a používáte rozhraní .NET 4,5 nebo vyšší.</span><span class="sxs-lookup"><span data-stu-id="76463-153">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="76463-154">Operace jsou vázané na síť nebo vstupně-výstupní operace, nikoli vázané na procesor.</span><span class="sxs-lookup"><span data-stu-id="76463-154">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="76463-155">Paralelismus je důležitější než jednoduchost kódu.</span><span class="sxs-lookup"><span data-stu-id="76463-155">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="76463-156">Chcete poskytnout mechanismus, který umožňuje uživatelům zrušit dlouho běžící požadavek.</span><span class="sxs-lookup"><span data-stu-id="76463-156">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="76463-157">Pokud výhoda přepínání vláken převáží náklady na přepínač kontextu.</span><span class="sxs-lookup"><span data-stu-id="76463-157">When the benefit of switching threads outweighs the cost of the context switch.</span></span> <span data-ttu-id="76463-158">Obecně byste měli provést asynchronní metodu, pokud synchronní metoda čeká na vlákno žádosti ASP.NET, zatímco neprovádí žádnou práci.</span><span class="sxs-lookup"><span data-stu-id="76463-158">In general, you should make a method asynchronous if the synchronous method waits on the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="76463-159">Provedením asynchronního volání není vlákno žádosti ASP.NET zastaveno, protože čeká na dokončení žádosti webové služby.</span><span class="sxs-lookup"><span data-stu-id="76463-159">By making the call asynchronous, the ASP.NET request thread is not stalled doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="76463-160">Testování ukazuje, že blokující operace jsou kritické pro výkon lokality a že služba IIS může obsluhovat více požadavků pomocí asynchronních metod pro tato blokující volání.</span><span class="sxs-lookup"><span data-stu-id="76463-160">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

<span data-ttu-id="76463-161">Ukázka ke stažení ukazuje, jak efektivně používat asynchronní metody akcí.</span><span class="sxs-lookup"><span data-stu-id="76463-161">The downloadable sample shows how to use asynchronous action methods effectively.</span></span> <span data-ttu-id="76463-162">Uvedená ukázka byla navržena tak, aby poskytovala jednoduchou ukázku asynchronního programování v ASP.NET MVC 4 pomocí .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="76463-162">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET MVC 4 using .NET 4.5.</span></span> <span data-ttu-id="76463-163">Vzorek není určen jako referenční architektura pro asynchronní programování v ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="76463-163">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET MVC.</span></span> <span data-ttu-id="76463-164">Vzorový program volá metody [ASP.NET webového rozhraní API](../../../web-api/index.md) , které zavolají [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) pro simulaci dlouhotrvajících volání webové služby.</span><span class="sxs-lookup"><span data-stu-id="76463-164">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="76463-165">Většina produkčních aplikací nebude zobrazovat takové zjevné výhody použití asynchronních metod akcí.</span><span class="sxs-lookup"><span data-stu-id="76463-165">Most production applications will not show such obvious benefits to using asynchronous action methods.</span></span>   
  
<span data-ttu-id="76463-166">Několik aplikací vyžaduje, aby všechny metody akcí byly asynchronní.</span><span class="sxs-lookup"><span data-stu-id="76463-166">Few applications require all action methods to be asynchronous.</span></span> <span data-ttu-id="76463-167">Často převod několika synchronních metod akcí na asynchronní metody poskytuje nejlepší zvýšení efektivity pro požadovanou práci.</span><span class="sxs-lookup"><span data-stu-id="76463-167">Often, converting a few synchronous action methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a><span data-ttu-id="76463-168">Ukázková aplikace</span><span class="sxs-lookup"><span data-stu-id="76463-168">The Sample Application</span></span>

<span data-ttu-id="76463-169">Ukázkovou aplikaci si můžete stáhnout z [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) na webu [GitHub](https://github.com/) .</span><span class="sxs-lookup"><span data-stu-id="76463-169">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="76463-170">Úložiště se skládá ze tří projektů:</span><span class="sxs-lookup"><span data-stu-id="76463-170">The repository consists of three projects:</span></span>

- <span data-ttu-id="76463-171">*Mvc4Async*: projekt ASP.NET MVC 4 obsahující kód použitý v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="76463-171">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in this tutorial.</span></span> <span data-ttu-id="76463-172">Provádí volání rozhraní Web API ke službě **WebAPIpgw** .</span><span class="sxs-lookup"><span data-stu-id="76463-172">It makes Web API calls to the **WebAPIpgw** service.</span></span>
- <span data-ttu-id="76463-173">*WebAPIpgw*: projekt webového rozhraní API ASP.NET MVC 4, který implementuje řadiče `Products, Gizmos and Widgets`.</span><span class="sxs-lookup"><span data-stu-id="76463-173">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="76463-174">Poskytuje data pro projekt *WebAppAsync* a projekt *Mvc4Async* .</span><span class="sxs-lookup"><span data-stu-id="76463-174">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="76463-175">*WebAppAsync*: projekt webových formulářů ASP.NET použitý v jiném kurzu.</span><span class="sxs-lookup"><span data-stu-id="76463-175">*WebAppAsync*: The ASP.NET Web Forms project used in another tutorial.</span></span>

## <a id="GizmosSynch"></a><span data-ttu-id="76463-176">Metoda synchronní akce Gizma</span><span class="sxs-lookup"><span data-stu-id="76463-176">The Gizmos Synchronous Action Method</span></span>

 <span data-ttu-id="76463-177">Následující kód ukazuje metodu `Gizmos` synchronní akci, která se používá k zobrazení seznamu gizma.</span><span class="sxs-lookup"><span data-stu-id="76463-177">The following code shows the `Gizmos` synchronous action method that is used to display a list of gizmos.</span></span> <span data-ttu-id="76463-178">(Pro tento článek je Gizmo fiktivní mechanické zařízení.)</span><span class="sxs-lookup"><span data-stu-id="76463-178">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample1.cs)]

<span data-ttu-id="76463-179">Následující kód ukazuje metodu `GetGizmos` služby Gizmo.</span><span class="sxs-lookup"><span data-stu-id="76463-179">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample2.cs)]

<span data-ttu-id="76463-180">Metoda `GizmoService GetGizmos` předává identifikátor URI službě HTTP webového rozhraní API ASP.NET, která vrací seznam dat gizma.</span><span class="sxs-lookup"><span data-stu-id="76463-180">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="76463-181">Projekt *WebAPIpgw* obsahuje implementaci `gizmos, widget` webového rozhraní API a `product`ch řadičů.</span><span class="sxs-lookup"><span data-stu-id="76463-181">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="76463-182">Na následujícím obrázku je znázorněno zobrazení gizma z ukázkového projektu.</span><span class="sxs-lookup"><span data-stu-id="76463-182">The following image shows the gizmos view from the sample project.</span></span>

![Gizma](using-asynchronous-methods-in-aspnet-mvc-4/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a><span data-ttu-id="76463-184">Vytvoření asynchronní metody akce Gizma</span><span class="sxs-lookup"><span data-stu-id="76463-184">Creating an Asynchronous Gizmos Action Method</span></span>

<span data-ttu-id="76463-185">Ukázka používá nová klíčová slova [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) a [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (k dispozici v rozhraních .NET 4,5 a Visual Studio 2012), aby kompilátor mohl být zodpovědný za údržbu složitých transformací potřebných pro asynchronní programování.</span><span class="sxs-lookup"><span data-stu-id="76463-185">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="76463-186">Kompilátor umožňuje psát kód pomocí C#konstrukce asynchronního toku řízení a kompilátor automaticky aplikuje transformace potřebné k použití zpětných volání, aby nedocházelo k blokování vláken.</span><span class="sxs-lookup"><span data-stu-id="76463-186">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="76463-187">Následující kód ukazuje `Gizmos` synchronní metodu a `GizmosAsync` asynchronní metodu.</span><span class="sxs-lookup"><span data-stu-id="76463-187">The following code shows the `Gizmos` synchronous method and the `GizmosAsync` asynchronous method.</span></span> <span data-ttu-id="76463-188">Pokud prohlížeč podporuje [prvek `<mark>` HTML 5](http://www.w3.org/wiki/HTML/Elements/mark), uvidíte změny v `GizmosAsync` žlutým zvýrazněním.</span><span class="sxs-lookup"><span data-stu-id="76463-188">If your browser supports the [HTML 5 `<mark>` element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample3.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample4.cs?highlight=1,3,5)]

 <span data-ttu-id="76463-189">Následující změny byly aplikovány, aby bylo možné `GizmosAsync` být asynchronní.</span><span class="sxs-lookup"><span data-stu-id="76463-189">The following changes were applied to allow the `GizmosAsync` to be asynchronous.</span></span>

- <span data-ttu-id="76463-190">Metoda je označena pomocí klíčového slova [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , které dává kompilátoru pokyn ke generování zpětných volání pro části těla a k automatickému vytvoření `Task<ActionResult>`, který je vrácen.</span><span class="sxs-lookup"><span data-stu-id="76463-190">The method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task<ActionResult>` that is returned.</span></span>
- <span data-ttu-id="76463-191">k názvu metody se připojila &quot;Async&quot;.</span><span class="sxs-lookup"><span data-stu-id="76463-191">&quot;Async&quot; was appended to the method name.</span></span> <span data-ttu-id="76463-192">Připojení "Async" není vyžadováno, ale je to konvence při psaní asynchronních metod.</span><span class="sxs-lookup"><span data-stu-id="76463-192">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="76463-193">Návratový typ se změnil z `ActionResult` na `Task<ActionResult>`.</span><span class="sxs-lookup"><span data-stu-id="76463-193">The return type was changed from `ActionResult` to `Task<ActionResult>`.</span></span> <span data-ttu-id="76463-194">Návratový typ `Task<ActionResult>` představuje průběžnou práci a poskytuje volajícím metody s popisovačem, přes který má počkat na dokončení asynchronní operace.</span><span class="sxs-lookup"><span data-stu-id="76463-194">The return type of `Task<ActionResult>` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span> <span data-ttu-id="76463-195">V tomto případě je volající webové služby.</span><span class="sxs-lookup"><span data-stu-id="76463-195">In this case, the caller is the web service.</span></span> <span data-ttu-id="76463-196">`Task<ActionResult>` představuje probíhající práci s výsledkem `ActionResult.`</span><span class="sxs-lookup"><span data-stu-id="76463-196">`Task<ActionResult>` represents ongoing work with a result of `ActionResult.`</span></span>
- <span data-ttu-id="76463-197">Klíčové slovo [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) bylo použito pro volání webové služby.</span><span class="sxs-lookup"><span data-stu-id="76463-197">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="76463-198">Bylo voláno rozhraní API asynchronní webové služby (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="76463-198">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="76463-199">V těle metody `GetGizmosAsync` jiné asynchronní metody je volána `GetGizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="76463-199">Inside of the `GetGizmosAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="76463-200">`GetGizmosAsync` okamžitě vrátí `Task<List<Gizmo>>`, která se nakonec dokončí, když budou data k dispozici.</span><span class="sxs-lookup"><span data-stu-id="76463-200">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="76463-201">Vzhledem k tomu, že nechcete nic dalšího dělat, dokud nebudete mít Gizmo data, kód očekává úlohu (pomocí klíčového slova **await** ).</span><span class="sxs-lookup"><span data-stu-id="76463-201">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="76463-202">Klíčové slovo **await** lze použít pouze v metodách popsaných pomocí klíčového slova **Async** .</span><span class="sxs-lookup"><span data-stu-id="76463-202">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="76463-203">Klíčové slovo **await** neblokuje vlákno, dokud není úloha dokončena.</span><span class="sxs-lookup"><span data-stu-id="76463-203">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="76463-204">Zaregistruje zbytek metody jako zpětné volání na úkolu a okamžitě se vrátí.</span><span class="sxs-lookup"><span data-stu-id="76463-204">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="76463-205">Když se nakonec očekávaný úkol dokončí, vyvolá toto zpětné volání, takže bude pokračovat v provádění metody přímo tam, kde byla vypnuta.</span><span class="sxs-lookup"><span data-stu-id="76463-205">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="76463-206">Další informace o použití klíčových slov [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) a oboru názvů [úkolů](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) naleznete v tématu [asynchronní odkazy](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="76463-206">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="76463-207">Následující kód ukazuje metody `GetGizmos` a `GetGizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="76463-207">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample5.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample6.cs?highlight=1,4-8)]

 <span data-ttu-id="76463-208">Asynchronní změny jsou podobné těm, které jste udělali výše v **GizmosAsync** .</span><span class="sxs-lookup"><span data-stu-id="76463-208">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="76463-209">Podpis metody byl opatřen poznámkami pomocí klíčového slova [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , návratový typ byl změněn na `Task<List<Gizmo>>`a k názvu metody byl přidán *Async* .</span><span class="sxs-lookup"><span data-stu-id="76463-209">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="76463-210">Namísto třídy [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) se používá asynchronní třída [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="76463-210">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="76463-211">Klíčové slovo [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) bylo použito pro asynchronní metody [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="76463-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) asynchronous methods.</span></span>

<span data-ttu-id="76463-212">Na následujícím obrázku vidíte zobrazení asynchronního Gizmo.</span><span class="sxs-lookup"><span data-stu-id="76463-212">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-mvc-4/_static/image2.png)

<span data-ttu-id="76463-214">Prezentace prohlížečů gizma dat je shodná se zobrazením vytvořeným synchronním voláním.</span><span class="sxs-lookup"><span data-stu-id="76463-214">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="76463-215">Jediným rozdílem je, že asynchronní verze může být větší výkon při velkém zatížení.</span><span class="sxs-lookup"><span data-stu-id="76463-215">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a id="Parallel"></a><span data-ttu-id="76463-216">Paralelní provádění více operací</span><span class="sxs-lookup"><span data-stu-id="76463-216">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="76463-217">Metody asynchronní akce mají významnou výhodu oproti synchronním metodám, pokud akce musí provádět několik nezávislých operací.</span><span class="sxs-lookup"><span data-stu-id="76463-217">Asynchronous action methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="76463-218">V zadané ukázce se synchronní metoda `PWG`(pro Products, widgets a Gizma) zobrazí výsledky tří volání webové služby, které získá seznam produktů, widgetů a gizma.</span><span class="sxs-lookup"><span data-stu-id="76463-218">In the sample provided, the synchronous method `PWG`(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="76463-219">Projekt [webového rozhraní API ASP.NET](../../../web-api/index.md) , který poskytuje tyto služby, používá [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) k simulaci latence nebo pomalých síťových volání.</span><span class="sxs-lookup"><span data-stu-id="76463-219">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="76463-220">Pokud je zpoždění nastavené na 500 milisekund, asynchronní metoda `PWGasync` trvá několik málo než 500 milisekund, zatímco synchronní `PWG`á verze přebírá více než 1 500 milisekund.</span><span class="sxs-lookup"><span data-stu-id="76463-220">When the delay is set to 500 milliseconds, the asynchronous `PWGasync` method takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="76463-221">Metoda synchronního `PWG` je uvedena v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="76463-221">The synchronous `PWG` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample7.cs)]

<span data-ttu-id="76463-222">Metoda asynchronního `PWGasync` je uvedena v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="76463-222">The asynchronous `PWGasync` method is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample8.cs?highlight=1,3,12)]

<span data-ttu-id="76463-223">Následující obrázek znázorňuje zobrazení vrácené z metody **PWGasync** .</span><span class="sxs-lookup"><span data-stu-id="76463-223">The following image shows the view returned from the **PWGasync** method.</span></span>

![pwgAsync](using-asynchronous-methods-in-aspnet-mvc-4/_static/image3.png)

## <a id="CancelToken"></a><span data-ttu-id="76463-225">Použití tokenu zrušení</span><span class="sxs-lookup"><span data-stu-id="76463-225">Using a Cancellation Token</span></span>

<span data-ttu-id="76463-226">Asynchronní metody akcí vracející `Task<ActionResult>`jsou zrušitelné, to znamená, že přebírají parametr [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) , pokud je jeden k dispozici s atributem [hodnota vlastnosti AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) .</span><span class="sxs-lookup"><span data-stu-id="76463-226">Asynchronous action methods returning `Task<ActionResult>`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the [AsyncTimeout](https://msdn.microsoft.com/library/system.web.mvc.asynctimeoutattribute(VS.108).aspx) attribute.</span></span> <span data-ttu-id="76463-227">Následující kód ukazuje metodu `GizmosCancelAsync` s časovým limitem 150 milisekund.</span><span class="sxs-lookup"><span data-stu-id="76463-227">The following code shows the `GizmosCancelAsync` method with a timeout of 150 milliseconds.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample9.cs?highlight=1-3,5,10)]

<span data-ttu-id="76463-228">Následující kód ukazuje přetížení GetGizmosAsync, které přijímá parametr [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="76463-228">The following code shows the GetGizmosAsync overload, which takes a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-mvc-4/samples/sample10.cs)]

<span data-ttu-id="76463-229">V ukázkové aplikaci, která je k dispozici, vyberte odkaz *demo tokenu zrušení* , který volá metodu `GizmosCancelAsync` a demonstruje zrušení asynchronního volání.</span><span class="sxs-lookup"><span data-stu-id="76463-229">In the sample application provided, selecting the *Cancellation Token Demo* link calls the `GizmosCancelAsync` method and demonstrates the cancellation of the asynchronous call.</span></span>

## <a id="ServerConfig"></a><span data-ttu-id="76463-230">Konfigurace serveru pro volání webové služby vysoké souběžnosti nebo vysoké latence</span><span class="sxs-lookup"><span data-stu-id="76463-230">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="76463-231">Aby bylo možné využít výhody asynchronní webové aplikace, může být nutné provést některé změny výchozí konfigurace serveru.</span><span class="sxs-lookup"><span data-stu-id="76463-231">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="76463-232">Při konfiguraci a zátěži testování asynchronní webové aplikace mějte na paměti následující skutečnosti.</span><span class="sxs-lookup"><span data-stu-id="76463-232">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="76463-233">Windows 7, Windows Vista a všechny klientské operační systémy Windows mají maximálně 10 souběžných požadavků.</span><span class="sxs-lookup"><span data-stu-id="76463-233">Windows 7, Windows Vista and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="76463-234">Budete potřebovat serverový operační systém Windows, abyste viděli výhody asynchronních metod při vysokém zatížení.</span><span class="sxs-lookup"><span data-stu-id="76463-234">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="76463-235">Registrace .NET 4,5 se službou IIS z příkazového řádku se zvýšenými oprávněními:</span><span class="sxs-lookup"><span data-stu-id="76463-235">Register .NET 4.5 with IIS from an elevated command prompt:</span></span>  
  <span data-ttu-id="76463-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis – i</span><span class="sxs-lookup"><span data-stu-id="76463-236">%windir%\Microsoft.NET\Framework64\v4.0.30319\aspnet\_regiis -i</span></span>  
  <span data-ttu-id="76463-237">Viz [registrační nástroj služby IIS pro ASP.NET (Aspnet\_regiis. exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx) .</span><span class="sxs-lookup"><span data-stu-id="76463-237">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="76463-238">Možná budete muset zvýšit limit fronty [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) z výchozí hodnoty 1 000 na 5 000.</span><span class="sxs-lookup"><span data-stu-id="76463-238">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="76463-239">Pokud je nastavení příliš nízké, může se stát, že žádosti o odmítnutí [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) se zobrazí ve stavu HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="76463-239">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="76463-240">Změna limitu fronty HTTP. sys:</span><span class="sxs-lookup"><span data-stu-id="76463-240">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="76463-241">Otevřete Správce služby IIS a přejděte do podokna fondy aplikací.</span><span class="sxs-lookup"><span data-stu-id="76463-241">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="76463-242">Klikněte pravým tlačítkem na cílový fond aplikací a vyberte **Upřesnit nastavení**.</span><span class="sxs-lookup"><span data-stu-id="76463-242">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="76463-243">![pokročilé](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="76463-243">![advanced](using-asynchronous-methods-in-aspnet-mvc-4/_static/image4.png)</span></span>
    - <span data-ttu-id="76463-244">V dialogovém okně **Upřesnit nastavení** změňte *délku fronty* z 1 000 na 5 000.</span><span class="sxs-lookup"><span data-stu-id="76463-244">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="76463-245">Délka fronty ![](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="76463-245">![Queue length](using-asynchronous-methods-in-aspnet-mvc-4/_static/image5.png)</span></span>  
  
  <span data-ttu-id="76463-246">Všimněte si, že na obrázcích výše je rozhraní .NET Framework uvedeno jako v 4.0, i když fond aplikací používá rozhraní .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="76463-246">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="76463-247">Pro pochopení této nesrovnalosti si přečtěte následující informace:</span><span class="sxs-lookup"><span data-stu-id="76463-247">To understand this discrepancy, see the following:</span></span>

    - [<span data-ttu-id="76463-248">Verze rozhraní .NET a cílení na více verzí – .NET 4,5 je místní upgrade na rozhraní .NET 4,0</span><span class="sxs-lookup"><span data-stu-id="76463-248">.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0</span></span>](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
    - [<span data-ttu-id="76463-249">Jak nastavit aplikaci IIS nebo službu AppPool na použití ASP.NET 3,5 místo 2,0</span><span class="sxs-lookup"><span data-stu-id="76463-249">How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0</span></span>](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
    - <span data-ttu-id="76463-250">[.NET Framework verze a závislosti](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="76463-250">[.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span></span>
- <span data-ttu-id="76463-251">Pokud vaše aplikace používá webové služby nebo System.NET ke komunikaci s back-endu přes protokol HTTP, může být nutné zvýšit [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span><span class="sxs-lookup"><span data-stu-id="76463-251">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="76463-252">U aplikací ASP.NET to je omezené funkcí Automatická konfigurace na 12 časů počtu procesorů.</span><span class="sxs-lookup"><span data-stu-id="76463-252">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="76463-253">To znamená, že u čtyřjádrových procesů můžete mít maximálně 12 \* 4 = 48 souběžných připojení k koncovému bodu IP adres.</span><span class="sxs-lookup"><span data-stu-id="76463-253">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="76463-254">Vzhledem k tomu, že se jedná o přizpůsobitelné [automatické konfigurace](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), nejjednodušší způsob, jak zvýšit `maxconnection` v aplikaci ASP.NET, je nastavit [System .NET. Třída ServicePointManager. DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programově v metodě `Application_Start` v souboru *Global. asax* .</span><span class="sxs-lookup"><span data-stu-id="76463-254">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="76463-255">Příklad najdete v ukázkovém souboru ke stažení.</span><span class="sxs-lookup"><span data-stu-id="76463-255">See the sample download for an example.</span></span>
- <span data-ttu-id="76463-256">V rozhraní .NET 4,5 by měla být výchozí hodnota 5000 pro [maxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) .</span><span class="sxs-lookup"><span data-stu-id="76463-256">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>
