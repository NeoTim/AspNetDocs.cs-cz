---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
title: 'Kurz: použití migrace EF v aplikaci ASP.NET MVC a nasazení do Azure'
author: tdykstra
description: V tomto kurzu povolíte Code First migrace a nasadíte aplikaci do cloudu v Azure.
ms.author: riande
ms.date: 01/16/2019
ms.topic: tutorial
ms.assetid: d4dfc435-bda6-4621-9762-9ba270f8de4e
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 989dd0f0e18b338be057b9c5657586eff996d8ea
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78616079"
---
# <a name="tutorial-use-ef-migrations-in-an-aspnet-mvc-app-and-deploy-to-azure"></a><span data-ttu-id="915fb-103">Kurz: použití migrace EF v aplikaci ASP.NET MVC a nasazení do Azure</span><span class="sxs-lookup"><span data-stu-id="915fb-103">Tutorial: Use EF Migrations in an ASP.NET MVC app and deploy to Azure</span></span>

<span data-ttu-id="915fb-104">Proto byla webová aplikace Contoso University Sample spuštěná místně v IIS Express ve vývojovém počítači.</span><span class="sxs-lookup"><span data-stu-id="915fb-104">So far the Contoso University sample web application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="915fb-105">Chcete-li zajistit, aby byla skutečná aplikace k dispozici ostatním uživatelům pro použití přes Internet, je nutné ji nasadit na poskytovatele hostování webů.</span><span class="sxs-lookup"><span data-stu-id="915fb-105">To make a real application available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="915fb-106">V tomto kurzu povolíte Code First migrace a nasadíte aplikaci do cloudu v Azure:</span><span class="sxs-lookup"><span data-stu-id="915fb-106">In this tutorial, you enable Code First migrations and deploy the application to the cloud in Azure:</span></span>

- <span data-ttu-id="915fb-107">Povolte Migrace Code First.</span><span class="sxs-lookup"><span data-stu-id="915fb-107">Enable Code First Migrations.</span></span> <span data-ttu-id="915fb-108">Funkce migrace umožňuje změnit datový model a nasadit změny v produkčním prostředí aktualizací schématu databáze bez nutnosti vyřadit a znovu vytvořit databázi.</span><span class="sxs-lookup"><span data-stu-id="915fb-108">The Migrations feature enables you to change the data model and deploy your changes to production by updating the database schema without having to drop and re-create the database.</span></span>
- <span data-ttu-id="915fb-109">Nasaďte do Azure.</span><span class="sxs-lookup"><span data-stu-id="915fb-109">Deploy to Azure.</span></span> <span data-ttu-id="915fb-110">Tento krok je nepovinný. můžete pokračovat ve zbývajících kurzech, aniž byste museli projekt nasadit.</span><span class="sxs-lookup"><span data-stu-id="915fb-110">This step is optional; you can continue with the remaining tutorials without having deployed the project.</span></span>

<span data-ttu-id="915fb-111">Pro nasazení doporučujeme použít proces průběžné integrace se správou zdrojových kódů, ale v tomto kurzu se tato témata nevztahují.</span><span class="sxs-lookup"><span data-stu-id="915fb-111">We recommend that you use a continuous integration process with source control for deployment, but this tutorial does not cover those topics.</span></span> <span data-ttu-id="915fb-112">Další informace najdete v kapitolách [správy zdrojového kódu](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) a [průběžné integrace](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) [vytváření skutečných cloudových aplikací s Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span><span class="sxs-lookup"><span data-stu-id="915fb-112">For more information, see the [source control](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) and [continuous integration](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) chapters of [Building Real-World Cloud Apps with Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction).</span></span>

<span data-ttu-id="915fb-113">V tomto kurzu se naučíte:</span><span class="sxs-lookup"><span data-stu-id="915fb-113">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="915fb-114">Povolit Code First migrace</span><span class="sxs-lookup"><span data-stu-id="915fb-114">Enable Code First migrations</span></span>
> * <span data-ttu-id="915fb-115">Nasazení aplikace v Azure (volitelné)</span><span class="sxs-lookup"><span data-stu-id="915fb-115">Deploy the app in Azure (optional)</span></span>

## <a name="prerequisites"></a><span data-ttu-id="915fb-116">Předpoklady</span><span class="sxs-lookup"><span data-stu-id="915fb-116">Prerequisites</span></span>

- [<span data-ttu-id="915fb-117">Odolnost připojení a zachycení příkazů</span><span class="sxs-lookup"><span data-stu-id="915fb-117">Connection Resiliency and Command Interception</span></span>](connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application.md)

## <a name="enable-code-first-migrations"></a><span data-ttu-id="915fb-118">Povolit Code First migrace</span><span class="sxs-lookup"><span data-stu-id="915fb-118">Enable Code First migrations</span></span>

<span data-ttu-id="915fb-119">Při vývoji nové aplikace se datový model často mění a pokaždé, když se model změní, se nesynchronizuje s databází.</span><span class="sxs-lookup"><span data-stu-id="915fb-119">When you develop a new application, your data model changes frequently, and each time the model changes, it gets out of sync with the database.</span></span> <span data-ttu-id="915fb-120">Nakonfigurovali jste Entity Framework pro automatické vyřazení a opětovné vytvoření databáze pokaždé, když změníte datový model.</span><span class="sxs-lookup"><span data-stu-id="915fb-120">You have configured the Entity Framework to automatically drop and re-create the database each time you change the data model.</span></span> <span data-ttu-id="915fb-121">Když přidáváte, odebíráte nebo měníte třídy entit nebo změníte třídu `DbContext`, při příštím spuštění aplikace automaticky odstraní vaši stávající databázi, vytvoří nový, který odpovídá modelu, a vyhodnotí jeho semena s testovacími daty.</span><span class="sxs-lookup"><span data-stu-id="915fb-121">When you add, remove, or change entity classes or change your `DbContext` class, the next time you run the application it automatically deletes your existing database, creates a new one that matches the model, and seeds it with test data.</span></span>

<span data-ttu-id="915fb-122">Tato metoda uchování databáze v synchronizaci s datovým modelem funguje dobře, dokud aplikaci nenainstalujete do produkčního prostředí.</span><span class="sxs-lookup"><span data-stu-id="915fb-122">This method of keeping the database in sync with the data model works well until you deploy the application to production.</span></span> <span data-ttu-id="915fb-123">Když je aplikace spuštěná v produkčním prostředí, obvykle ukládá data, která chcete zachovat, a nechcete přijít o všechny pokaždé, když uděláte změnu, jako je přidání nového sloupce.</span><span class="sxs-lookup"><span data-stu-id="915fb-123">When the application is running in production, it is usually storing data that you want to keep, and you don't want to lose everything each time you make a change such as adding a new column.</span></span> <span data-ttu-id="915fb-124">Funkce [migrace Code First](https://msdn.microsoft.com/data/jj591621) tento problém vyřeší tím, že povolí Code First aktualizaci schématu databáze místo vyřazení a opětovného vytváření databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-124">The [Code First Migrations](https://msdn.microsoft.com/data/jj591621) feature solves this problem by enabling Code First to update the database schema instead of dropping and re-creating the database.</span></span> <span data-ttu-id="915fb-125">V tomto kurzu nasadíte aplikaci a připravíte ji na to, abyste povolili migrace.</span><span class="sxs-lookup"><span data-stu-id="915fb-125">In this tutorial, you'll deploy the application, and to prepare for that you'll enable Migrations.</span></span>

1. <span data-ttu-id="915fb-126">Zakažte inicializátor, který jste nastavili dříve, zadáním komentáře nebo odstraněním elementu `contexts`, který jste přidali do souboru Web. config aplikace.</span><span class="sxs-lookup"><span data-stu-id="915fb-126">Disable the initializer that you set up earlier by commenting out or deleting the `contexts` element that you added to the application Web.config file.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.xml?highlight=2,6)]
2. <span data-ttu-id="915fb-127">V souboru *Web. config* aplikace změňte také název databáze v připojovacím řetězci na ContosoUniversity2.</span><span class="sxs-lookup"><span data-stu-id="915fb-127">Also in the application *Web.config* file, change the name of the database in the connection string to ContosoUniversity2.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.xml?highlight=2)]

    <span data-ttu-id="915fb-128">Tato změna nastaví projekt tak, aby první migrace vytvořila novou databázi.</span><span class="sxs-lookup"><span data-stu-id="915fb-128">This change sets up the project so that the first migration creates a new database.</span></span> <span data-ttu-id="915fb-129">To se nevyžaduje, ale uvidíte později, proč je to dobré.</span><span class="sxs-lookup"><span data-stu-id="915fb-129">This isn't required but you'll see later why it's a good idea.</span></span>
3. <span data-ttu-id="915fb-130">V nabídce **nástroje** vyberte **správce balíčků NuGet** > **konzolu Správce balíčků**.</span><span class="sxs-lookup"><span data-stu-id="915fb-130">From the **Tools** menu, select **NuGet Package Manager** > **Package Manager Console**.</span></span>

1. <span data-ttu-id="915fb-131">Na příkazovém řádku `PM>` zadejte následující příkazy:</span><span class="sxs-lookup"><span data-stu-id="915fb-131">At the `PM>` prompt enter the following commands:</span></span>

    ```text
    enable-migrations
    add-migration InitialCreate
    ```

    <span data-ttu-id="915fb-132">Příkaz `enable-migrations` vytvoří složku *migrace* v projektu ContosoUniversity a vloží do této složky soubor *Configuration.cs* , který můžete upravit a nakonfigurovat migrace.</span><span class="sxs-lookup"><span data-stu-id="915fb-132">The `enable-migrations` command creates a *Migrations* folder in the ContosoUniversity project, and it puts in that folder a *Configuration.cs* file that you can edit to configure Migrations.</span></span>

    <span data-ttu-id="915fb-133">(Pokud jste nenalezli krok výše, který vás přesměruje na změnu názvu databáze, migrace nalezne stávající databázi a automaticky provede `add-migration` příkaz.</span><span class="sxs-lookup"><span data-stu-id="915fb-133">(If you missed the step above that directs you to change the database name, Migrations will find the existing database and automatically do the `add-migration` command.</span></span> <span data-ttu-id="915fb-134">To je v pořádku, jenom to znamená, že před nasazením databáze nespustíte test migrace kódu.</span><span class="sxs-lookup"><span data-stu-id="915fb-134">That's okay, it just means you won't run a test of the migrations code before you deploy the database.</span></span> <span data-ttu-id="915fb-135">Později, když spustíte `update-database` příkaz, nic se nestane, protože databáze již existuje.)</span><span class="sxs-lookup"><span data-stu-id="915fb-135">Later when you run the `update-database` command nothing will happen because the database already exists.)</span></span>

    <span data-ttu-id="915fb-136">Otevřete soubor *ContosoUniversity\Migrations\Configuration.cs* .</span><span class="sxs-lookup"><span data-stu-id="915fb-136">Open the *ContosoUniversity\Migrations\Configuration.cs* file.</span></span> <span data-ttu-id="915fb-137">Podobně jako Třída inicializátoru, kterou jste viděli dříve, třída `Configuration` zahrnuje metodu `Seed`.</span><span class="sxs-lookup"><span data-stu-id="915fb-137">Like the initializer class that you saw earlier, the `Configuration` class includes a `Seed` method.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs)]

    <span data-ttu-id="915fb-138">Účelem metody [počáteční](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) hodnoty je umožnit vložení nebo aktualizaci dat testu po Code First vytvoření nebo aktualizace databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-138">The purpose of the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is to enable you to insert or update test data after Code First creates or updates the database.</span></span> <span data-ttu-id="915fb-139">Metoda je volána při vytvoření databáze a pokaždé, když je schéma databáze aktualizováno po změně datového modelu.</span><span class="sxs-lookup"><span data-stu-id="915fb-139">The method is called when the database is created and every time the database schema is updated after a data model change.</span></span>

### <a name="set-up-the-seed-method"></a><span data-ttu-id="915fb-140">Nastavení metody osazení</span><span class="sxs-lookup"><span data-stu-id="915fb-140">Set up the Seed method</span></span>

<span data-ttu-id="915fb-141">Když vyřadíte a znovu vytvoříte databázi pro každou změnu datového modelu, použijete metodu `Seed` třídy inicializátoru k vložení testovacích dat, protože po změně modelu databáze dojde k odstranění a všechna testovací data budou ztracena.</span><span class="sxs-lookup"><span data-stu-id="915fb-141">When you drop and re-create the database for every data model change, you use the initializer class's `Seed` method to insert test data, because after every model change the database is dropped and all the test data is lost.</span></span> <span data-ttu-id="915fb-142">Při Migrace Code First se testovací data uchovávají po změnách databáze, takže včetně testovacích dat v metodě [osazení](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) obvykle není nutné.</span><span class="sxs-lookup"><span data-stu-id="915fb-142">With Code First Migrations, test data is retained after database changes, so including test data in the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is typically not necessary.</span></span> <span data-ttu-id="915fb-143">Ve skutečnosti nechcete, aby metoda `Seed` vkládání testovacích dat, pokud budete používat migrace k nasazení databáze do produkčního prostředí, protože metoda `Seed` se spustí v produkčním prostředí.</span><span class="sxs-lookup"><span data-stu-id="915fb-143">In fact, you don't want the `Seed` method to insert test data if you'll be using Migrations to deploy the database to production, because the `Seed` method will run in production.</span></span> <span data-ttu-id="915fb-144">V takovém případě chcete, aby metoda `Seed` vložila do databáze pouze data, která potřebujete v produkčním prostředí.</span><span class="sxs-lookup"><span data-stu-id="915fb-144">In that case, you want the `Seed` method to insert into the database only the data that you need in production.</span></span> <span data-ttu-id="915fb-145">Například můžete chtít, aby databáze zahrnovala vlastní názvy oddělení v tabulce `Department`, když se aplikace zpřístupní v produkčním prostředí.</span><span class="sxs-lookup"><span data-stu-id="915fb-145">For example, you might want the database to include actual department names in the `Department` table when the application becomes available in production.</span></span>

<span data-ttu-id="915fb-146">Pro účely tohoto kurzu budete pro nasazení používat migrace, ale vaše `Seed` metoda bude přesto vkládat testovací data, aby bylo snazší zjistit, jak funguje funkce aplikace, aniž by bylo nutné ručně vkládat spoustu dat.</span><span class="sxs-lookup"><span data-stu-id="915fb-146">For this tutorial, you'll be using Migrations for deployment, but your `Seed` method will insert test data anyway in order to make it easier to see how application functionality works without having to manually insert a lot of data.</span></span>

1. <span data-ttu-id="915fb-147">Nahraďte obsah souboru *Configuration.cs* následujícím kódem, který načte testovací data do nové databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-147">Replace the contents of the *Configuration.cs* file with the following code, which loads test data into the new database.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

    <span data-ttu-id="915fb-148">Metoda [počáteční](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) hodnoty přebírá objekt kontextu databáze jako vstupní parametr a kód v metodě používá tento objekt k přidání nových entit do databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-148">The [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method takes the database context object as an input parameter, and the code in the method uses that object to add new entities to the database.</span></span> <span data-ttu-id="915fb-149">Pro každý typ entity kód vytvoří kolekci nových entit, přidá je do příslušné vlastnosti [negenerickými](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) a poté uloží změny do databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-149">For each entity type, the code creates a collection of new entities, adds them to the appropriate [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) property, and then saves the changes to the database.</span></span> <span data-ttu-id="915fb-150">Není nutné volat metodu [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) za každou skupinu entit, jak je zde provedeno, ale to vám pomůže najít zdroj problému, pokud dojde k výjimce, když kód zapisuje do databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-150">It isn't necessary to call the [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) method after each group of entities, as is done here, but doing that helps you locate the source of a problem if an exception occurs while the code is writing to the database.</span></span>

    <span data-ttu-id="915fb-151">Některé příkazy, které vkládají data, používají metodu [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) k provedení operace "Upsert".</span><span class="sxs-lookup"><span data-stu-id="915fb-151">Some of the statements that insert data use the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method to perform an "upsert" operation.</span></span> <span data-ttu-id="915fb-152">Vzhledem k tomu, že se metoda `Seed` spouští při každém spuštění příkazu `update-database` (obvykle po každé migraci), nemůžete jenom vkládat data, protože řádky, které se pokoušíte přidat, už po první migraci vytvářející databázi budou.</span><span class="sxs-lookup"><span data-stu-id="915fb-152">Because the `Seed` method runs every time you execute the `update-database` command, typically after each migration, you can't just insert data, because the rows you are trying to add will already be there after the first migration that creates the database.</span></span> <span data-ttu-id="915fb-153">Operace "Upsert" zabraňuje chybám, které by byly provedeny při pokusu o vložení řádku, který již existuje, ale ***přepíše*** všechny změny dat, které jste mohli provést při testování aplikace.</span><span class="sxs-lookup"><span data-stu-id="915fb-153">The "upsert" operation prevents errors that would happen if you try to insert a row that already exists, but it ***overrides*** any changes to data that you may have made while testing the application.</span></span> <span data-ttu-id="915fb-154">S testovacími daty v některých tabulkách možná nebudete chtít, aby došlo k tomu, že v některých případech změníte data při testování, které chcete po aktualizaci databáze zůstat.</span><span class="sxs-lookup"><span data-stu-id="915fb-154">With test data in some tables you might not want that to happen: in some cases when you change data while testing you want your changes to remain after database updates.</span></span> <span data-ttu-id="915fb-155">V takovém případě chcete provést operaci podmíněného vložení: vložte řádek pouze v případě, že ještě neexistuje.</span><span class="sxs-lookup"><span data-stu-id="915fb-155">In that case you want to do a conditional insert operation: insert a row only if it doesn't already exist.</span></span> <span data-ttu-id="915fb-156">Metoda počáteční hodnoty používá obě přístupy.</span><span class="sxs-lookup"><span data-stu-id="915fb-156">The Seed method uses both approaches.</span></span>

    <span data-ttu-id="915fb-157">První parametr předaný metodě [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) určuje vlastnost, která má být použita pro kontrolu, zda řádek již existuje.</span><span class="sxs-lookup"><span data-stu-id="915fb-157">The first parameter passed to the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method specifies the property to use to check if a row already exists.</span></span> <span data-ttu-id="915fb-158">Pro data testovacího studenta, která poskytujete, se dá pro tento účel použít vlastnost `LastName`, protože každé příjmení v seznamu je jedinečné:</span><span class="sxs-lookup"><span data-stu-id="915fb-158">For the test student data that you are providing, the `LastName` property can be used for this purpose since each last name in the list is unique:</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs)]

    <span data-ttu-id="915fb-159">Tento kód předpokládá, že poslední názvy jsou jedinečné.</span><span class="sxs-lookup"><span data-stu-id="915fb-159">This code assumes that last names are unique.</span></span> <span data-ttu-id="915fb-160">Pokud ručně přidáte studenta s duplicitním posledním názvem, při příštím provedení migrace se zobrazí následující výjimka:</span><span class="sxs-lookup"><span data-stu-id="915fb-160">If you manually add a student with a duplicate last name, you'll get the following exception the next time you perform a migration:</span></span>

    <span data-ttu-id="915fb-161">**Sekvence obsahuje více než jeden element.**</span><span class="sxs-lookup"><span data-stu-id="915fb-161">**Sequence contains more than one element**</span></span>

    <span data-ttu-id="915fb-162">Informace o tom, jak zpracovat redundantní data, jako jsou například dva studenti s názvem "Alexander Carson", naleznete v tématu [osazení a ladění Entity Framework (EF) databáze](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) na blogu Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="915fb-162">For information about how to handle redundant data such as two students named "Alexander Carson", see [Seeding and Debugging Entity Framework (EF) DBs](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) on Rick Anderson's blog.</span></span> <span data-ttu-id="915fb-163">Další informace o metodě `AddOrUpdate` naleznete v tématu podrobnější informace [k metodě EF 4,3 AddOrUpdate](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) na blogu Julie Lerman.</span><span class="sxs-lookup"><span data-stu-id="915fb-163">For more information about the `AddOrUpdate` method, see [Take care with EF 4.3 AddOrUpdate Method](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) on Julie Lerman's blog.</span></span>

    <span data-ttu-id="915fb-164">Kód, který vytvoří `Enrollment` entity, předpokládá, že máte v entitě kolekce `students` `ID` hodnotu, i když jste tuto vlastnost nenastavili v kódu, který vytváří kolekci.</span><span class="sxs-lookup"><span data-stu-id="915fb-164">The code that creates `Enrollment` entities assumes you have the `ID` value in the entities in the `students` collection, although you didn't set that property in the code that creates the collection.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs?highlight=2)]

    <span data-ttu-id="915fb-165">Vlastnost `ID` lze použít, protože `ID` hodnota je nastavena při volání `SaveChanges` pro kolekci `students`.</span><span class="sxs-lookup"><span data-stu-id="915fb-165">You can use the `ID` property here because the `ID` value is set when you call `SaveChanges` for the `students` collection.</span></span> <span data-ttu-id="915fb-166">EF automaticky získá hodnotu primárního klíče, když vloží entitu do databáze a aktualizuje vlastnost `ID` entity v paměti.</span><span class="sxs-lookup"><span data-stu-id="915fb-166">EF automatically gets the primary key value when it inserts an entity into the database, and it updates the `ID` property of the entity in memory.</span></span>

    <span data-ttu-id="915fb-167">Kód, který přidá každou entitu `Enrollment` do sady entit `Enrollments`, nepoužívá metodu `AddOrUpdate`.</span><span class="sxs-lookup"><span data-stu-id="915fb-167">The code that adds each `Enrollment` entity to the `Enrollments` entity set doesn't use the `AddOrUpdate` method.</span></span> <span data-ttu-id="915fb-168">Kontroluje, zda entita již existuje, a vloží entitu, pokud neexistuje.</span><span class="sxs-lookup"><span data-stu-id="915fb-168">It checks if an entity already exists and inserts the entity if it doesn't exist.</span></span> <span data-ttu-id="915fb-169">Tento přístup zachovává změny ve třídě registrace pomocí uživatelského rozhraní aplikace.</span><span class="sxs-lookup"><span data-stu-id="915fb-169">This approach will preserve changes you make to an enrollment grade by using the application UI.</span></span> <span data-ttu-id="915fb-170">Kód projde každým členem [seznamu](https://msdn.microsoft.com/library/6sh2ey19.aspx) `Enrollment`a v případě, že se registrace v databázi nenajde, přidá do databáze registraci.</span><span class="sxs-lookup"><span data-stu-id="915fb-170">The code loops through each member of the `Enrollment`[List](https://msdn.microsoft.com/library/6sh2ey19.aspx) and if the enrollment is not found in the database, it adds the enrollment to the database.</span></span> <span data-ttu-id="915fb-171">Při první aktualizaci databáze bude databáze prázdná, takže se přidá každá registrace.</span><span class="sxs-lookup"><span data-stu-id="915fb-171">The first time you update the database, the database will be empty, so it will add each enrollment.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]

2. <span data-ttu-id="915fb-172">Sestavte projekt.</span><span class="sxs-lookup"><span data-stu-id="915fb-172">Build the project.</span></span>

### <a name="execute-the-first-migration"></a><span data-ttu-id="915fb-173">Provedení první migrace</span><span class="sxs-lookup"><span data-stu-id="915fb-173">Execute the first migration</span></span>

<span data-ttu-id="915fb-174">Když jste provedli příkaz `add-migration`, migrace vygenerovala kód, který vytvořil databázi zcela od začátku.</span><span class="sxs-lookup"><span data-stu-id="915fb-174">When you executed the `add-migration` command, Migrations generated the code that would create the database from scratch.</span></span> <span data-ttu-id="915fb-175">Tento kód je také ve složce *migraces* v souboru s názvem *&lt;časové razítko&gt;\_InitialCreate.cs*.</span><span class="sxs-lookup"><span data-stu-id="915fb-175">This code is also in the *Migrations* folder, in the file named *&lt;timestamp&gt;\_InitialCreate.cs*.</span></span> <span data-ttu-id="915fb-176">Metoda `Up` třídy `InitialCreate` vytvoří tabulky databáze, které odpovídají sadám entit datového modelu, a metoda `Down` je odstraní.</span><span class="sxs-lookup"><span data-stu-id="915fb-176">The `Up` method of the `InitialCreate` class creates the database tables that correspond to the data model entity sets, and the `Down` method deletes them.</span></span>

[!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="915fb-177">Migrace zavolá metodu `Up` pro implementaci změn datového modelu pro migraci.</span><span class="sxs-lookup"><span data-stu-id="915fb-177">Migrations calls the `Up` method to implement the data model changes for a migration.</span></span> <span data-ttu-id="915fb-178">Když zadáte příkaz pro vrácení aktualizace, migrace zavolá metodu `Down`.</span><span class="sxs-lookup"><span data-stu-id="915fb-178">When you enter a command to roll back the update, Migrations calls the `Down` method.</span></span>

<span data-ttu-id="915fb-179">Toto je počáteční migrace, která byla vytvořena při zadání příkazu `add-migration InitialCreate`.</span><span class="sxs-lookup"><span data-stu-id="915fb-179">This is the initial migration that was created when you entered the `add-migration InitialCreate` command.</span></span> <span data-ttu-id="915fb-180">Parametr (`InitialCreate` v příkladu) se používá pro název souboru a může být libovolný, co potřebujete; obvykle si zvolíte slovo nebo frázi, která shrnuje, co se v migraci provádí.</span><span class="sxs-lookup"><span data-stu-id="915fb-180">The parameter (`InitialCreate` in the example) is used for the file name and can be whatever you want; you typically choose a word or phrase that summarizes what is being done in the migration.</span></span> <span data-ttu-id="915fb-181">Můžete třeba pojmenovat pozdější migraci &quot;AddDepartmentTable&quot;.</span><span class="sxs-lookup"><span data-stu-id="915fb-181">For example, you might name a later migration &quot;AddDepartmentTable&quot;.</span></span>

<span data-ttu-id="915fb-182">Pokud jste vytvořili počáteční migraci i v případě, že databáze již existuje, je vytvořen kód pro vytvoření databáze, ale nemusí být spuštěn, protože databáze již odpovídá datovému modelu.</span><span class="sxs-lookup"><span data-stu-id="915fb-182">If you created the initial migration when the database already exists, the database creation code is generated but it doesn't have to run because the database already matches the data model.</span></span> <span data-ttu-id="915fb-183">Když nasadíte aplikaci do jiného prostředí, kde databáze ještě neexistuje, tento kód se spustí, aby se vytvořila vaše databáze, takže je dobré ho nejdřív otestovat.</span><span class="sxs-lookup"><span data-stu-id="915fb-183">When you deploy the app to another environment where the database doesn't exist yet, this code will run to create your database, so it's a good idea to test it first.</span></span> <span data-ttu-id="915fb-184">To je důvod, proč jste změnili název databáze v připojovacím řetězci dříve&mdash;tak, aby migrace mohla vytvořit nové od začátku.</span><span class="sxs-lookup"><span data-stu-id="915fb-184">That's why you changed the name of the database in the connection string earlier&mdash;so that migrations can create a new one from scratch.</span></span>

1. <span data-ttu-id="915fb-185">V okně **konzoly Správce balíčků** zadejte následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="915fb-185">In the **Package Manager Console** window, enter the following command:</span></span>

    `update-database`

    <span data-ttu-id="915fb-186">Příkaz `update-database` spustí metodu `Up` k vytvoření databáze a poté spustí metodu `Seed` k naplnění databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-186">The `update-database` command runs the `Up` method to create the database and then it runs the `Seed` method to populate the database.</span></span> <span data-ttu-id="915fb-187">Po nasazení aplikace se stejný proces spustí automaticky v produkčním prostředí, jak je uvedeno v následující části.</span><span class="sxs-lookup"><span data-stu-id="915fb-187">The same process will run automatically in production after you deploy the application, as you'll see in the following section.</span></span>
2. <span data-ttu-id="915fb-188">Pomocí **Průzkumník serveru** můžete zkontrolovat databázi jako v prvním kurzu a spustit aplikaci, abyste ověřili, že všechno pořád funguje stejně jako dřív.</span><span class="sxs-lookup"><span data-stu-id="915fb-188">Use **Server Explorer** to inspect the database as you did in the first tutorial, and run the application to verify that everything still works the same as before.</span></span>

## <a name="deploy-to-azure"></a><span data-ttu-id="915fb-189">Nasazení do Azure</span><span class="sxs-lookup"><span data-stu-id="915fb-189">Deploy to Azure</span></span>

<span data-ttu-id="915fb-190">Proto byla aplikace spuštěna místně v IIS Express ve vývojovém počítači.</span><span class="sxs-lookup"><span data-stu-id="915fb-190">So far the application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="915fb-191">Aby ho mohli používat i ostatní uživatelé přes Internet, musíte ho nasadit do poskytovatele hostování webů.</span><span class="sxs-lookup"><span data-stu-id="915fb-191">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="915fb-192">V této části kurzu ho nasadíte do Azure.</span><span class="sxs-lookup"><span data-stu-id="915fb-192">In this section of the tutorial, you'll deploy it to Azure.</span></span> <span data-ttu-id="915fb-193">Tato část je volitelná. Můžete to přeskočit a pokračovat v následujícím kurzu nebo můžete upravit pokyny v této části pro jiného poskytovatele hostingu podle vašeho výběru.</span><span class="sxs-lookup"><span data-stu-id="915fb-193">This section is optional; you can skip this and continue with the following tutorial, or you can adapt the instructions in this section for a different hosting provider of your choice.</span></span>

### <a name="use-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="915fb-194">Nasazení databáze pomocí Code First migrace</span><span class="sxs-lookup"><span data-stu-id="915fb-194">Use Code First migrations to deploy the database</span></span>

<span data-ttu-id="915fb-195">K nasazení databáze budete používat Migrace Code First.</span><span class="sxs-lookup"><span data-stu-id="915fb-195">To deploy the database, you'll use Code First Migrations.</span></span> <span data-ttu-id="915fb-196">Když vytvoříte profil publikování, který použijete ke konfiguraci nastavení pro nasazení ze sady Visual Studio, vyberete zaškrtávací políčko s názvem **aktualizace databáze**.</span><span class="sxs-lookup"><span data-stu-id="915fb-196">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box labeled **Update Database**.</span></span> <span data-ttu-id="915fb-197">Toto nastavení způsobí, že proces nasazení automaticky konfiguruje soubor *Web. config* aplikace na cílovém serveru tak, aby Code First používal třídu inicializátoru `MigrateDatabaseToLatestVersion`.</span><span class="sxs-lookup"><span data-stu-id="915fb-197">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="915fb-198">Visual Studio během procesu nasazování neprovádí žádnou práci s databází, zatímco kopíruje projekt na cílový server.</span><span class="sxs-lookup"><span data-stu-id="915fb-198">Visual Studio doesn't do anything with the database during the deployment process while it is copying your project to the destination server.</span></span> <span data-ttu-id="915fb-199">Když spustíte nasazenou aplikaci a přistupuje k databázi poprvé po nasazení, Code First zkontroluje, jestli databáze odpovídá datovému modelu.</span><span class="sxs-lookup"><span data-stu-id="915fb-199">When you run the deployed application and it accesses the database for the first time after deployment, Code First checks if the database matches the data model.</span></span> <span data-ttu-id="915fb-200">Pokud dojde k neshodě, Code First automaticky vytvoří databázi (Pokud ještě neexistuje) nebo aktualizuje schéma databáze na nejnovější verzi (Pokud databáze existuje, ale neodpovídá modelu).</span><span class="sxs-lookup"><span data-stu-id="915fb-200">If there's a mismatch, Code First automatically creates the database (if it doesn't exist yet) or updates the database schema to the latest version (if a database exists but doesn't match the model).</span></span> <span data-ttu-id="915fb-201">Pokud aplikace implementuje migrace `Seed` metody, metoda se spustí po vytvoření databáze nebo aktualizaci schématu.</span><span class="sxs-lookup"><span data-stu-id="915fb-201">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="915fb-202">Vaše migrace `Seed` metodu vloží testovací data.</span><span class="sxs-lookup"><span data-stu-id="915fb-202">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="915fb-203">Pokud jste nasadili do provozního prostředí, bude nutné změnit metodu `Seed` tak, aby do ní vložila pouze data, která chcete vložit do provozní databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-203">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="915fb-204">Například v aktuálním datovém modelu možná budete chtít mít reálné kurzy, ale fiktivní studenty ve vývojové databázi.</span><span class="sxs-lookup"><span data-stu-id="915fb-204">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="915fb-205">Můžete napsat metodu `Seed` pro načtení ve vývoji a pak před nasazením do produkčního prostředí odkomentovat fiktivní studenty.</span><span class="sxs-lookup"><span data-stu-id="915fb-205">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="915fb-206">Nebo můžete napsat metodu `Seed` pro načtení pouze kurzů a zadat fiktivní studenty do testovací databáze ručně pomocí uživatelského rozhraní aplikace.</span><span class="sxs-lookup"><span data-stu-id="915fb-206">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-an-azure-account"></a><span data-ttu-id="915fb-207">Získat účet Azure</span><span class="sxs-lookup"><span data-stu-id="915fb-207">Get an Azure account</span></span>

<span data-ttu-id="915fb-208">Budete potřebovat účet Azure.</span><span class="sxs-lookup"><span data-stu-id="915fb-208">You'll need an Azure account.</span></span> <span data-ttu-id="915fb-209">Pokud ho ještě nemáte, ale máte předplatné sady Visual Studio, můžete si [aktivovat výhody předplatného](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
).</span><span class="sxs-lookup"><span data-stu-id="915fb-209">If you don't already have one, but you do have a Visual Studio subscription, you can [activate your subscription benefits](https://azure.microsoft.com/pricing/member-offers/credit-for-visual-studio-subscribers/
).</span></span> <span data-ttu-id="915fb-210">V opačném případě můžete během několika minut vytvořit bezplatný zkušební účet.</span><span class="sxs-lookup"><span data-stu-id="915fb-210">Otherwise, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="915fb-211">Podrobnosti najdete v tématu [Bezplatná zkušební verze Azure](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="915fb-211">For details, see [Azure Free Trial](https://azure.microsoft.com/free/).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-azure"></a><span data-ttu-id="915fb-212">Vytvoření webu a databáze SQL v Azure</span><span class="sxs-lookup"><span data-stu-id="915fb-212">Create a web site and a SQL database in Azure</span></span>

<span data-ttu-id="915fb-213">Vaše webová aplikace v Azure se spustí ve sdíleném hostitelském prostředí, což znamená, že se spustí na virtuálních počítačích, které jsou sdílené s jinými klienty Azure.</span><span class="sxs-lookup"><span data-stu-id="915fb-213">Your web app in Azure will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Azure clients.</span></span> <span data-ttu-id="915fb-214">Sdílené hostitelské prostředí představuje nízký nákladový způsob, jak začít v cloudu.</span><span class="sxs-lookup"><span data-stu-id="915fb-214">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="915fb-215">Později, pokud se webový provoz zvýší, aplikace může škálovat tak, aby splňovala nutnost spuštění na vyhrazených virtuálních počítačích.</span><span class="sxs-lookup"><span data-stu-id="915fb-215">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="915fb-216">Pokud chcete získat další informace o možnostech cen pro Azure App Service, přečtěte si [App Service ceny](https://azure.microsoft.com/pricing/details/app-service/).</span><span class="sxs-lookup"><span data-stu-id="915fb-216">To learn more about Pricing Options for Azure App Service, read [App Service pricing](https://azure.microsoft.com/pricing/details/app-service/).</span></span>

<span data-ttu-id="915fb-217">Databázi nasadíte do služby Azure SQL Database.</span><span class="sxs-lookup"><span data-stu-id="915fb-217">You'll deploy the database to Azure SQL database.</span></span> <span data-ttu-id="915fb-218">SQL Database je cloudová služba relačních databází, která je založená na technologii SQL Server.</span><span class="sxs-lookup"><span data-stu-id="915fb-218">SQL database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="915fb-219">Nástroje a aplikace, které pracují s SQL Server, fungují také s SQL Database.</span><span class="sxs-lookup"><span data-stu-id="915fb-219">Tools and applications that work with SQL Server also work with SQL database.</span></span>

1. <span data-ttu-id="915fb-220">V [portál pro správu Azure](https://portal.azure.com)zvolte na levé straně možnost **vytvořit prostředek** a potom v podokně **nové** *(nebo v*okně) zvolte **Zobrazit vše** . zobrazí se všechny dostupné prostředky.</span><span class="sxs-lookup"><span data-stu-id="915fb-220">In the [Azure Management Portal](https://portal.azure.com), choose **Create a resource** in the left tab and then choose **See all** on the **New** pane (or *blade*) to see all available resources.</span></span> <span data-ttu-id="915fb-221">V části **Web** okna **vše** vyberte **Web App + SQL** .</span><span class="sxs-lookup"><span data-stu-id="915fb-221">Choose **Web App + SQL** in the **Web** section of the **Everything** blade.</span></span> <span data-ttu-id="915fb-222">Nakonec klikněte na tlačítko **vytvořit**.</span><span class="sxs-lookup"><span data-stu-id="915fb-222">Finally, choose **Create**.</span></span>

    ![Vytvořit prostředek na webu Azure Portal](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/create-azure-resource.png)

   <span data-ttu-id="915fb-224">Otevře se formulář pro vytvoření nové **nové webové aplikace a prostředku SQL** .</span><span class="sxs-lookup"><span data-stu-id="915fb-224">The form to create a new **New Web App + SQL** resource opens.</span></span>

2. <span data-ttu-id="915fb-225">Do pole **název aplikace** zadejte řetězec, který chcete použít jako jedinečnou adresu URL pro vaši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="915fb-225">Enter a string in the **App name** box to use as the unique URL for your application.</span></span> <span data-ttu-id="915fb-226">Úplná adresa URL se skládá z toho, co tady zadáte, a navíc k výchozí doméně Azure App Services (. azurewebsites.net).</span><span class="sxs-lookup"><span data-stu-id="915fb-226">The complete URL will consist of what you enter here plus the default domain of Azure App Services (.azurewebsites.net).</span></span> <span data-ttu-id="915fb-227">Pokud už je **název aplikace** zabraný, Průvodce vás upozorní na červenou zprávu s *názvem aplikace není k dispozici* .</span><span class="sxs-lookup"><span data-stu-id="915fb-227">If the **App name** is already taken, the Wizard notifies you with a red *The app name is not available* message.</span></span> <span data-ttu-id="915fb-228">Pokud je **název aplikace** k dispozici, zobrazí se zelená značka zaškrtnutí.</span><span class="sxs-lookup"><span data-stu-id="915fb-228">If the **App name** is available, you see a green checkmark.</span></span>

3. <span data-ttu-id="915fb-229">V poli **předplatné** vyberte předplatné Azure, ve kterém chcete **App Service** umístit.</span><span class="sxs-lookup"><span data-stu-id="915fb-229">In the **Subscription** box, choose the Azure Subscription in which you want the **App Service** to reside.</span></span>

4. <span data-ttu-id="915fb-230">V textovém poli **Skupina prostředků** vyberte skupinu prostředků nebo vytvořte novou.</span><span class="sxs-lookup"><span data-stu-id="915fb-230">In the **Resource Group** text box, choose a Resource Group or create a new one.</span></span> <span data-ttu-id="915fb-231">Toto nastavení určuje, které datové centrum bude web běžet v.</span><span class="sxs-lookup"><span data-stu-id="915fb-231">This setting specifies which data center your web site will run in.</span></span> <span data-ttu-id="915fb-232">Další informace o skupinách prostředků najdete v tématu [skupiny prostředků](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span><span class="sxs-lookup"><span data-stu-id="915fb-232">For more information about Resource Groups, see [Resource groups](/azure/azure-resource-manager/resource-group-overview#resource-groups).</span></span>

5. <span data-ttu-id="915fb-233">Kliknutím na **App Service** *oddíl App Service* **vytvořte nový** **App Service plán** (může to být stejný název jako App Service), **umístění**a **cenová úroveň** (bezplatná možnost).</span><span class="sxs-lookup"><span data-stu-id="915fb-233">Create a new **App Service Plan** by clicking the *App Service section*, **Create New**, and fill in **App Service plan** (can be same name as App Service), **Location**, and **Pricing tier** (there is a free option).</span></span>

6. <span data-ttu-id="915fb-234">Klikněte na **SQL Database**a pak zvolte **vytvořit novou databázi** nebo vyberte existující databázi.</span><span class="sxs-lookup"><span data-stu-id="915fb-234">Click **SQL Database**, and then choose **Create a new database** or select an existing database.</span></span>

7. <span data-ttu-id="915fb-235">Do pole **název** zadejte název vaší databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-235">In the **Name** box, enter a name for your database.</span></span>
8. <span data-ttu-id="915fb-236">Klikněte na pole **cílový server** a pak vyberte **vytvořit nový server**.</span><span class="sxs-lookup"><span data-stu-id="915fb-236">Click the **Target Server** box, and then select **Create a new server**.</span></span> <span data-ttu-id="915fb-237">Případně, pokud jste dříve vytvořili server, můžete tento server vybrat ze seznamu dostupných serverů.</span><span class="sxs-lookup"><span data-stu-id="915fb-237">Alternatively, if you previously created a server, you can select that server from list of available servers.</span></span>
9. <span data-ttu-id="915fb-238">Vyberte možnost **cenová úroveň** , vyberte možnost *Free*.</span><span class="sxs-lookup"><span data-stu-id="915fb-238">Choose **Pricing tier** section, choose *Free*.</span></span> <span data-ttu-id="915fb-239">Pokud potřebujete další prostředky, je možné databázi kdykoli škálovat.</span><span class="sxs-lookup"><span data-stu-id="915fb-239">If additional resources are needed, the database can be scaled up at any time.</span></span> <span data-ttu-id="915fb-240">Další informace o cenách Azure SQL najdete v tématu [Azure SQL Database ceny](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span><span class="sxs-lookup"><span data-stu-id="915fb-240">To learn more on Azure SQL Pricing, see [Azure SQL Database pricing](https://azure.microsoft.com/pricing/details/sql-database/managed/).</span></span>
10. <span data-ttu-id="915fb-241">Podle potřeby upravte [kolaci](/sql/relational-databases/collations/collation-and-unicode-support) .</span><span class="sxs-lookup"><span data-stu-id="915fb-241">Modify [collation](/sql/relational-databases/collations/collation-and-unicode-support) as needed.</span></span>
11. <span data-ttu-id="915fb-242">Zadejte **uživatelské jméno správce SQL** a **heslo správce SQL**.</span><span class="sxs-lookup"><span data-stu-id="915fb-242">Enter an administrator **SQL Admin Username** and **SQL Admin Password**.</span></span>

    - <span data-ttu-id="915fb-243">Pokud jste vybrali **nový SQL Database Server**, definujte nové jméno a heslo, které použijete později při přístupu k databázi.</span><span class="sxs-lookup"><span data-stu-id="915fb-243">If you selected **New SQL Database server**, define a new name and password that you'll use later when you access the database.</span></span>
    - <span data-ttu-id="915fb-244">Pokud jste vybrali Server, který jste vytvořili dříve, zadejte přihlašovací údaje pro tento server.</span><span class="sxs-lookup"><span data-stu-id="915fb-244">If you selected a server that you created previously, enter credentials for that server.</span></span>

12. <span data-ttu-id="915fb-245">Kolekce telemetrie se dá povolit pro App Service pomocí Application Insights.</span><span class="sxs-lookup"><span data-stu-id="915fb-245">Telemetry collection can be enabled for App Service using Application Insights.</span></span> <span data-ttu-id="915fb-246">S malou konfigurací Application Insights shromažďuje cenné informace o událostech, výjimkách, závislostech, žádostech a trasování.</span><span class="sxs-lookup"><span data-stu-id="915fb-246">With little configuration, Application Insights collects valuable event, exception, dependency, request, and trace information.</span></span> <span data-ttu-id="915fb-247">Další informace o Application Insights najdete v tématu [Azure monitor](https://azure.microsoft.com/services/monitor/).</span><span class="sxs-lookup"><span data-stu-id="915fb-247">To learn more about Application Insights, see [Azure Monitor](https://azure.microsoft.com/services/monitor/).</span></span>
13. <span data-ttu-id="915fb-248">Kliknutím na **vytvořit** v dolní části označíte, že jste hotovi.</span><span class="sxs-lookup"><span data-stu-id="915fb-248">Click **Create** at the bottom to indicate that you're finished.</span></span>

    <span data-ttu-id="915fb-249">Portál pro správu se vrátí na stránku řídicího panelu a v oblasti **oznámení** v horní části stránky se zobrazí, že se web vytváří.</span><span class="sxs-lookup"><span data-stu-id="915fb-249">The Management Portal returns to the Dashboard page, and the **Notifications** area at the top of the page shows that the site is being created.</span></span> <span data-ttu-id="915fb-250">Po delší dobu (obvykle méně než minutu) se zobrazí oznámení o úspěšném nasazení.</span><span class="sxs-lookup"><span data-stu-id="915fb-250">After a while (typically less than a minute), there's a notification that the Deployment succeeded.</span></span> <span data-ttu-id="915fb-251">V navigačním panelu vlevo se nový App Service zobrazí v části **App Services** a v části **databáze SQL** se zobrazí nová databáze SQL.</span><span class="sxs-lookup"><span data-stu-id="915fb-251">In the navigation bar at the left, the new App Service appears in the **App Services** section and the new SQL database appears in the **SQL databases** section.</span></span>

### <a name="deploy-the-app-to-azure"></a><span data-ttu-id="915fb-252">Nasadit aplikaci do Azure</span><span class="sxs-lookup"><span data-stu-id="915fb-252">Deploy the app to Azure</span></span>

1. <span data-ttu-id="915fb-253">V aplikaci Visual Studio klikněte pravým tlačítkem na projekt v **Průzkumník řešení** a v místní nabídce vyberte **publikovat** .</span><span class="sxs-lookup"><span data-stu-id="915fb-253">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>

2. <span data-ttu-id="915fb-254">Na stránce **Vyberte cíl publikování** zvolte **App Service** a pak **Vyberte existující**a pak zvolte **publikovat**.</span><span class="sxs-lookup"><span data-stu-id="915fb-254">On the **Pick a publish target** page, choose **App Service** and then **Select Existing**, and then choose **Publish**.</span></span>

    ![Výběr cílové stránky pro publikování](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/publish-select-existing-azure-app-service.png)

3. <span data-ttu-id="915fb-256">Pokud jste ještě nepřidali předplatné Azure v aplikaci Visual Studio, proveďte kroky na obrazovce.</span><span class="sxs-lookup"><span data-stu-id="915fb-256">If you haven't previously added your Azure subscription in Visual Studio, perform the steps on the screen.</span></span> <span data-ttu-id="915fb-257">Tyto kroky umožňují aplikaci Visual Studio připojit se k předplatnému Azure, takže seznam **App Services** bude obsahovat váš web.</span><span class="sxs-lookup"><span data-stu-id="915fb-257">These steps enable Visual Studio to connect to your Azure subscription so that the list of **App Services** will include your web site.</span></span>

4. <span data-ttu-id="915fb-258">Na stránce **App Service** vyberte **předplatné** , do kterého jste přidali App Service.</span><span class="sxs-lookup"><span data-stu-id="915fb-258">On the **App Service** page, select the **Subscription** you added the App Service to.</span></span> <span data-ttu-id="915fb-259">V části **zobrazení**vyberte **Skupina prostředků**.</span><span class="sxs-lookup"><span data-stu-id="915fb-259">Under **View**, select **Resource Group**.</span></span> <span data-ttu-id="915fb-260">Rozbalte skupinu prostředků, do které jste přidali App Service, a pak vyberte App Service.</span><span class="sxs-lookup"><span data-stu-id="915fb-260">Expand the resource group you added the App Service to, and then select the App Service.</span></span> <span data-ttu-id="915fb-261">Pro publikování aplikace klikněte na **tlačítko OK** .</span><span class="sxs-lookup"><span data-stu-id="915fb-261">Choose **OK** to publish the app.</span></span>

5. <span data-ttu-id="915fb-262">Okno **výstup** zobrazuje, jaké akce nasazení byly provedeny, a oznamuje úspěšné dokončení nasazení.</span><span class="sxs-lookup"><span data-stu-id="915fb-262">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>

6. <span data-ttu-id="915fb-263">Po úspěšném nasazení se výchozí prohlížeč automaticky otevře na adrese URL nasazeného webu.</span><span class="sxs-lookup"><span data-stu-id="915fb-263">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>

    ![Students_index_page_with_paging](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/cloud-app-browser.png)

    <span data-ttu-id="915fb-265">Vaše aplikace je teď spuštěná v cloudu.</span><span class="sxs-lookup"><span data-stu-id="915fb-265">Your app is now running in the cloud.</span></span>

<span data-ttu-id="915fb-266">V tuto chvíli se databáze *SchoolContext* vytvořila ve službě Azure SQL Database, protože jste vybrali **Execute migrace Code First (spouští se při spuštění aplikace)** .</span><span class="sxs-lookup"><span data-stu-id="915fb-266">At this point, the *SchoolContext* database has been created in the Azure SQL database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="915fb-267">Soubor *Web. config* na nasazeném webu byl změněn tak, aby byl inicializátor [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) spuštěn při prvním načtení nebo zápisu dat do databáze (ke kterému došlo po výběru karty **Students** ):</span><span class="sxs-lookup"><span data-stu-id="915fb-267">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer runs the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![Soubor Web. config – výňatek](https://asp.net/media/4367421/mig.png)

<span data-ttu-id="915fb-269">Proces nasazení také vytvořil nový připojovací řetězec *(SchoolContext\_DatabasePublish*), který migrace Code First použít k aktualizaci schématu databáze a k osazení databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-269">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Připojovací řetězec v souboru Web. config](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)

<span data-ttu-id="915fb-271">Nasazenou verzi souboru Web. config můžete najít na svém vlastním počítači v *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. K nasazenému souboru *Web. config* se můžete dostat pomocí FTP.</span><span class="sxs-lookup"><span data-stu-id="915fb-271">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="915fb-272">Pokyny najdete v tématu [nasazení webu ASP.NET pomocí sady Visual Studio: nasazení aktualizace kódu](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span><span class="sxs-lookup"><span data-stu-id="915fb-272">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span></span> <span data-ttu-id="915fb-273">Postupujte podle pokynů, které začínají na používání nástroje FTP, potřebujete tři věci: adresa URL serveru FTP, uživatelské jméno a heslo. "</span><span class="sxs-lookup"><span data-stu-id="915fb-273">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="915fb-274">Webová aplikace neimplementuje zabezpečení, takže kdokoli, kdo najde adresu URL, může data změnit.</span><span class="sxs-lookup"><span data-stu-id="915fb-274">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="915fb-275">Pokyny k zabezpečení webu najdete v tématu [nasazení zabezpečené aplikace ASP.NET MVC pomocí členství, protokolu OAuth a SQL Database do Azure](/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="915fb-275">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL database to Azure](/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="915fb-276">Dalším lidem můžete zabránit v používání webu zastavením služby pomocí Portál pro správu Azure nebo **Průzkumník serveru** v aplikaci Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="915fb-276">You can prevent other people from using the site by stopping the service using the Azure Management Portal or **Server Explorer** in Visual Studio.</span></span>

![Zastavit položku nabídky služby App Service](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/server-explorer-stop-app-service.png)

## <a name="advanced-migrations-scenarios"></a><span data-ttu-id="915fb-278">Scénáře pokročilých migrací</span><span class="sxs-lookup"><span data-stu-id="915fb-278">Advanced migrations scenarios</span></span>

<span data-ttu-id="915fb-279">Pokud nasadíte databázi tak, že automaticky spustíte migrace, jak je znázorněno v tomto kurzu, a nasazujete na web, který běží na více serverech, můžete získat více serverů, které se pokoušejí spustit migrace současně.</span><span class="sxs-lookup"><span data-stu-id="915fb-279">If you deploy a database by running migrations automatically as shown in this tutorial, and you are deploying to a web site that runs on multiple servers, you could get multiple servers trying to run migrations at the same time.</span></span> <span data-ttu-id="915fb-280">Migrace jsou atomické, takže pokud se dva servery pokusí spustit stejnou migraci, bude jedna z nich úspěšná a druhá selže (za předpokladu, že operace nejde udělat dvakrát).</span><span class="sxs-lookup"><span data-stu-id="915fb-280">Migrations are atomic, so if two servers try to run the same migration, one will succeed and the other will fail (assuming the operations can't be done twice).</span></span> <span data-ttu-id="915fb-281">V takovém případě, pokud se chcete těmto problémům vyhnout, můžete volat migrace ručně a nastavit vlastní kód tak, aby se stalo pouze jednou.</span><span class="sxs-lookup"><span data-stu-id="915fb-281">In that scenario if you want to avoid those issues, you can call migrations manually and set up your own code so that it only happens once.</span></span> <span data-ttu-id="915fb-282">Další informace najdete v tématu [spuštění a skriptování migrace z kódu](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) na blogu Rowan Miller a [migrace. exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (pro provádění migrací z příkazového řádku).</span><span class="sxs-lookup"><span data-stu-id="915fb-282">For more information, see [Running and Scripting Migrations from Code](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) on Rowan Miller's blog and [Migrate.exe](/ef/ef6/modeling/code-first/migrations/migrate-exe) (for executing migrations from the command line).</span></span>

<span data-ttu-id="915fb-283">Informace o dalších scénářích migrace najdete v tématu [migrace datových řad pro záznam dění](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx)v/v.</span><span class="sxs-lookup"><span data-stu-id="915fb-283">For information about other migrations scenarios, see [Migrations Screencast Series](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span></span>

## <a name="update-specific-migration"></a><span data-ttu-id="915fb-284">Aktualizovat konkrétní migraci</span><span class="sxs-lookup"><span data-stu-id="915fb-284">Update specific migration</span></span>

`update-database -target MigrationName`

<span data-ttu-id="915fb-285">Příkaz `update-database -target MigrationName` spustí cílenou migraci.</span><span class="sxs-lookup"><span data-stu-id="915fb-285">The `update-database -target MigrationName` command runs the targeted migration.</span></span>

## <a name="ignore-migration-changes-to-database"></a><span data-ttu-id="915fb-286">Ignorovat změny migrace v databázi</span><span class="sxs-lookup"><span data-stu-id="915fb-286">Ignore migration changes to database</span></span>

`Add-migration MigrationName -ignoreChanges`

<span data-ttu-id="915fb-287">`ignoreChanges` vytvoří prázdnou migraci s aktuálním modelem jako snímkem.</span><span class="sxs-lookup"><span data-stu-id="915fb-287">`ignoreChanges` creates an empty migration with the current model as a snapshot.</span></span>

## <a name="code-first-initializers"></a><span data-ttu-id="915fb-288">Inicializátory Code First</span><span class="sxs-lookup"><span data-stu-id="915fb-288">Code First initializers</span></span>

<span data-ttu-id="915fb-289">V části nasazení jste viděli, že se používá inicializátor [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) .</span><span class="sxs-lookup"><span data-stu-id="915fb-289">In the deployment section, you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="915fb-290">Code First také poskytuje další inicializátory, včetně [metodu createdatabaseifnotexists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (výchozí), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (který jste použili dříve) a [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span><span class="sxs-lookup"><span data-stu-id="915fb-290">Code First also provides other initializers, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (which you used earlier) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="915fb-291">Inicializátor `DropCreateAlways` může být užitečný pro nastavení podmínek pro testování částí.</span><span class="sxs-lookup"><span data-stu-id="915fb-291">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="915fb-292">Můžete také napsat vlastní Inicializátory a můžete zavolat inicializátor explicitně, pokud nechcete čekat, dokud aplikace nenačte nebo zapíše do databáze.</span><span class="sxs-lookup"><span data-stu-id="915fb-292">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span>

<span data-ttu-id="915fb-293">Další informace o inicializátorech naleznete v tématu [Principy inicializátorů databáze v Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) a v kapitole 6 příručky [programovacího Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman a Rowan Miller.</span><span class="sxs-lookup"><span data-stu-id="915fb-293">For more information about initializers, see [Understanding Database Initializers in Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) and chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="get-the-code"></a><span data-ttu-id="915fb-294">Získání kódu</span><span class="sxs-lookup"><span data-stu-id="915fb-294">Get the code</span></span>

[<span data-ttu-id="915fb-295">Stáhnout dokončený projekt</span><span class="sxs-lookup"><span data-stu-id="915fb-295">Download the Completed Project</span></span>](https://webpifeed.blob.core.windows.net/webpifeed/Partners/ASP.NET%20MVC%20Application%20Using%20Entity%20Framework%20Code%20First.zip)

## <a name="additional-resources"></a><span data-ttu-id="915fb-296">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="915fb-296">Additional resources</span></span>

<span data-ttu-id="915fb-297">Odkazy na další prostředky Entity Framework najdete v [prostředcích, které jsou doporučeny pro přístup k datům ASP.NET](xref:whitepapers/aspnet-data-access-content-map).</span><span class="sxs-lookup"><span data-stu-id="915fb-297">Links to other Entity Framework resources can be found in [ASP.NET Data Access - Recommended Resources](xref:whitepapers/aspnet-data-access-content-map).</span></span>

## <a name="next-steps"></a><span data-ttu-id="915fb-298">Další kroky</span><span class="sxs-lookup"><span data-stu-id="915fb-298">Next steps</span></span>

<span data-ttu-id="915fb-299">V tomto kurzu se naučíte:</span><span class="sxs-lookup"><span data-stu-id="915fb-299">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="915fb-300">Povolené migrace Code First</span><span class="sxs-lookup"><span data-stu-id="915fb-300">Enabled Code First migrations</span></span>
> * <span data-ttu-id="915fb-301">Nasazení aplikace v Azure (volitelné)</span><span class="sxs-lookup"><span data-stu-id="915fb-301">Deployed the app in Azure (optional)</span></span>

<span data-ttu-id="915fb-302">V dalším článku se dozvíte, jak vytvořit složitější datový model pro aplikaci ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="915fb-302">Advance to the next article to learn how to create a more complex data model for an ASP.NET MVC Application.</span></span>
> [!div class="nextstepaction"]
> [<span data-ttu-id="915fb-303">Vytvoření komplexnějšího datového modelu</span><span class="sxs-lookup"><span data-stu-id="915fb-303">Create a more complex data model</span></span>](creating-a-more-complex-data-model-for-an-asp-net-mvc-application.md)
