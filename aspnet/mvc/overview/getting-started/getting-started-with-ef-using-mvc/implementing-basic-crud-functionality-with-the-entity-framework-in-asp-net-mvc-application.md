---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application
title: 'Kurz: implementace funkce CRUD pomocí Entity Framework v ASP.NET MVC | Microsoft Docs'
description: Přečtěte si a přizpůsobte kód pro vytváření, čtení, aktualizaci, odstranění (CRUD), který automaticky vytvoří generování uživatelského rozhraní MVC v řadičích a zobrazeních.
author: tdykstra
ms.author: riande
ms.date: 01/22/2019
ms.topic: tutorial
ms.assetid: a2f70ba4-83d1-4002-9255-24732726c4f2
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 9ed388543dd54d209ff2a0b92df4f7659962582c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78583158"
---
# <a name="tutorial-implement-crud-functionality-with-the-entity-framework-in-aspnet-mvc"></a><span data-ttu-id="85c63-103">Kurz: implementace funkce CRUD pomocí Entity Framework v ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="85c63-103">Tutorial: Implement CRUD Functionality with the Entity Framework in ASP.NET MVC</span></span>

<span data-ttu-id="85c63-104">V [předchozím kurzu](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md)jste vytvořili aplikaci MVC, která ukládá a zobrazuje data pomocí Entity Framework (EF) 6 a SQL Server LocalDB.</span><span class="sxs-lookup"><span data-stu-id="85c63-104">In the [previous tutorial](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md), you created an MVC application that stores and displays data using the Entity Framework (EF) 6 and SQL Server LocalDB.</span></span> <span data-ttu-id="85c63-105">V tomto kurzu prohlížíte a přizpůsobíte kód pro vytváření, čtení, aktualizaci, odstranění (CRUD), který pro vás automaticky vytvoří generování uživatelského rozhraní MVC v řadičích a zobrazeních.</span><span class="sxs-lookup"><span data-stu-id="85c63-105">In this tutorial, you review and customize the create, read, update, delete (CRUD) code that the MVC scaffolding automatically creates for you in controllers and views.</span></span>

> [!NOTE]
> <span data-ttu-id="85c63-106">Je běžný postup implementace vzoru úložiště, aby bylo možné vytvořit vrstvu abstrakce mezi řadičem a vrstvou přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="85c63-106">It's a common practice to implement the repository pattern in order to create an abstraction layer between your controller and the data access layer.</span></span> <span data-ttu-id="85c63-107">Aby byly tyto kurzy jednoduché a zaměřené na výuku, jak použít vlastní EF 6, nepoužívají úložiště.</span><span class="sxs-lookup"><span data-stu-id="85c63-107">To keep these tutorials simple and focused on teaching how to use EF 6 itself, they don't use repositories.</span></span> <span data-ttu-id="85c63-108">Informace o tom, jak implementovat úložiště, najdete v tématu [Mapa obsahu ASP.NET Data Access](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="85c63-108">For info about how to implement repositories, see the [ASP.NET Data Access Content Map](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

<span data-ttu-id="85c63-109">Tady jsou příklady webových stránek, které vytvoříte:</span><span class="sxs-lookup"><span data-stu-id="85c63-109">Here are examples of the web pages you create:</span></span>

![Snímek obrazovky se stránkou s podrobnostmi studenta.](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/_static/image1.png)

![Snímek obrazovky se stránkou pro vytvoření studenta](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/_static/image2.png)

![Snímek obrazovky se stránkou pro odstranění studenta](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/_static/image3.png)

<span data-ttu-id="85c63-113">V tomto kurzu se naučíte:</span><span class="sxs-lookup"><span data-stu-id="85c63-113">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="85c63-114">Vytvořit stránku podrobností</span><span class="sxs-lookup"><span data-stu-id="85c63-114">Create a Details page</span></span>
> * <span data-ttu-id="85c63-115">Aktualizace stránky pro vytvoření</span><span class="sxs-lookup"><span data-stu-id="85c63-115">Update the Create page</span></span>
> * <span data-ttu-id="85c63-116">Aktualizace metody HttpPost Edit</span><span class="sxs-lookup"><span data-stu-id="85c63-116">Update the HttpPost Edit method</span></span>
> * <span data-ttu-id="85c63-117">Aktualizovat stránku Delete</span><span class="sxs-lookup"><span data-stu-id="85c63-117">Update the Delete page</span></span>
> * <span data-ttu-id="85c63-118">Zavřít databázová připojení</span><span class="sxs-lookup"><span data-stu-id="85c63-118">Close database connections</span></span>
> * <span data-ttu-id="85c63-119">Zpracování transakcí</span><span class="sxs-lookup"><span data-stu-id="85c63-119">Handle transactions</span></span>

## <a name="prerequisites"></a><span data-ttu-id="85c63-120">Předpoklady</span><span class="sxs-lookup"><span data-stu-id="85c63-120">Prerequisites</span></span>

* [<span data-ttu-id="85c63-121">Vytvoření datového modelu Entity Framework</span><span class="sxs-lookup"><span data-stu-id="85c63-121">Create the Entity Framework Data Model</span></span>](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md)

## <a name="create-a-details-page"></a><span data-ttu-id="85c63-122">Vytvořit stránku podrobností</span><span class="sxs-lookup"><span data-stu-id="85c63-122">Create a Details page</span></span>

<span data-ttu-id="85c63-123">Vygenerovaný kód pro studenty `Index` stránku opustil vlastnost `Enrollments`, protože tato vlastnost obsahuje kolekci.</span><span class="sxs-lookup"><span data-stu-id="85c63-123">The scaffolded code for the Students `Index` page left out the `Enrollments` property, because that property holds a collection.</span></span> <span data-ttu-id="85c63-124">Na stránce `Details` zobrazíte obsah kolekce v tabulce HTML.</span><span class="sxs-lookup"><span data-stu-id="85c63-124">In the `Details` page, you'll display the contents of the collection in an HTML table.</span></span>

<span data-ttu-id="85c63-125">V *Controllers\StudentController.cs*metoda Action pro zobrazení `Details` používá metodu [find](https://msdn.microsoft.com/library/gg696418(v=VS.103).aspx) k načtení jedné `Student` entity.</span><span class="sxs-lookup"><span data-stu-id="85c63-125">In *Controllers\StudentController.cs*, the action method for the `Details` view uses the [Find](https://msdn.microsoft.com/library/gg696418(v=VS.103).aspx) method to retrieve a single `Student` entity.</span></span>

[!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample1.cs)]

<span data-ttu-id="85c63-126">Hodnota klíče je předána metodě jako parametr `id` a přichází z *dat směrování* v hypertextovém odkazu **Podrobnosti** na stránce indexu.</span><span class="sxs-lookup"><span data-stu-id="85c63-126">The key value is passed to the method as the `id` parameter and comes from *route data* in the **Details** hyperlink on the Index page.</span></span>

### <a name="tip-route-data"></a><span data-ttu-id="85c63-127">Tip: **směrování dat**</span><span class="sxs-lookup"><span data-stu-id="85c63-127">Tip: **Route data**</span></span>

<span data-ttu-id="85c63-128">Data směrování jsou data, která modelový pořadač nalezl v segmentu URL zadaném ve směrovací tabulce.</span><span class="sxs-lookup"><span data-stu-id="85c63-128">Route data is data that the model binder found in a URL segment specified in the routing table.</span></span> <span data-ttu-id="85c63-129">Výchozí trasa například určuje `controller`, `action`a `id` segmenty:</span><span class="sxs-lookup"><span data-stu-id="85c63-129">For example, the default route specifies `controller`, `action`, and `id` segments:</span></span>

[!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample2.cs?highlight=3)]

<span data-ttu-id="85c63-130">V následující adrese URL se výchozí mapy tras `Instructor` jako `controller``Index` jako `action` a 1 jako `id`. Jedná se o hodnoty dat tras.</span><span class="sxs-lookup"><span data-stu-id="85c63-130">In the following URL, the default route maps `Instructor` as the `controller`, `Index` as the `action` and 1 as the `id`; these are route data values.</span></span>

`http://localhost:1230/Instructor/Index/1?courseID=2021`

<span data-ttu-id="85c63-131">`?courseID=2021` je hodnota řetězce dotazu.</span><span class="sxs-lookup"><span data-stu-id="85c63-131">`?courseID=2021` is a query string value.</span></span> <span data-ttu-id="85c63-132">Pořadač modelů bude fungovat i v případě, že předáte `id` jako hodnotu řetězce dotazu:</span><span class="sxs-lookup"><span data-stu-id="85c63-132">The model binder will also work if you pass the `id` as a query string value:</span></span>

`http://localhost:1230/Instructor/Index?id=1&CourseID=2021`

<span data-ttu-id="85c63-133">Adresy URL jsou vytvořeny `ActionLink` příkazy v zobrazení Razor.</span><span class="sxs-lookup"><span data-stu-id="85c63-133">The URLs are created by `ActionLink` statements in the Razor view.</span></span> <span data-ttu-id="85c63-134">V následujícím kódu se parametr `id` shoduje s výchozí trasou, takže `id` přidána do dat trasy.</span><span class="sxs-lookup"><span data-stu-id="85c63-134">In the following code, the `id` parameter matches the default route, so `id` is added to the route data.</span></span>

[!code-cshtml[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample3.cshtml)]

<span data-ttu-id="85c63-135">V následujícím kódu `courseID` neodpovídá parametru ve výchozí trase, takže se přidá jako řetězec dotazu.</span><span class="sxs-lookup"><span data-stu-id="85c63-135">In the following code, `courseID` doesn't match a parameter in the default route, so it's added as a query string.</span></span>

[!code-cshtml[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample4.cshtml)]

### <a name="to-create-the-details-page"></a><span data-ttu-id="85c63-136">Vytvoření stránky podrobností</span><span class="sxs-lookup"><span data-stu-id="85c63-136">To create the Details page</span></span>

1. <span data-ttu-id="85c63-137">Otevřete *Views\Student\Details.cshtml*.</span><span class="sxs-lookup"><span data-stu-id="85c63-137">Open *Views\Student\Details.cshtml*.</span></span>

   <span data-ttu-id="85c63-138">Každé pole se zobrazí pomocí pomocné rutiny `DisplayFor`, jak je znázorněno v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="85c63-138">Each field is displayed using a `DisplayFor` helper, as shown in the following example:</span></span>

    [!code-cshtml[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample5.cshtml)]

2. <span data-ttu-id="85c63-139">Po `EnrollmentDate` pole a bezprostředně před uzavírací značku `</dl>` přidejte zvýrazněný kód pro zobrazení seznamu registrací, jak je znázorněno v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="85c63-139">After the `EnrollmentDate` field and immediately before the closing `</dl>` tag, add the highlighted code to display a list of enrollments, as shown in the following example:</span></span>

    [!code-cshtml[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample6.cshtml?highlight=8-29)]

    <span data-ttu-id="85c63-140">Pokud je odsazení kódu po vložení kódu nesprávné, stiskněte **ctrl**+**k**, **stisknutím klávesy CTRL+** **D** ho naformátujte.</span><span class="sxs-lookup"><span data-stu-id="85c63-140">If code indentation is wrong after you paste the code, press **Ctrl**+**K**, **Ctrl**+**D** to format it.</span></span>

    <span data-ttu-id="85c63-141">Tento kód projde entitami v navigační vlastnosti `Enrollments`.</span><span class="sxs-lookup"><span data-stu-id="85c63-141">This code loops through the entities in the `Enrollments` navigation property.</span></span> <span data-ttu-id="85c63-142">Pro každou entitu `Enrollment` ve vlastnosti se zobrazí titul kurzu a stupeň.</span><span class="sxs-lookup"><span data-stu-id="85c63-142">For each `Enrollment` entity in the property, it displays the course title and the grade.</span></span> <span data-ttu-id="85c63-143">Titul kurzu se načte z `Course` entity, která je uložená v `Course` navigační vlastnosti entity `Enrollments`.</span><span class="sxs-lookup"><span data-stu-id="85c63-143">The course title is retrieved from the `Course` entity that's stored in the `Course` navigation property of the `Enrollments` entity.</span></span> <span data-ttu-id="85c63-144">Všechna tato data jsou načtena z databáze automaticky v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="85c63-144">All of this data is retrieved from the database automatically when it's needed.</span></span> <span data-ttu-id="85c63-145">Jinými slovy, používáte opožděné načítání zde.</span><span class="sxs-lookup"><span data-stu-id="85c63-145">In other words, you are using lazy loading here.</span></span> <span data-ttu-id="85c63-146">Neurčili jste *Eager načítání* pro vlastnost navigace `Courses`, takže se registrace nenačítala ve stejném dotazu, který se dodanými studenty.</span><span class="sxs-lookup"><span data-stu-id="85c63-146">You did not specify *eager loading* for the `Courses` navigation property, so the enrollments were not retrieved in the same query that got the students.</span></span> <span data-ttu-id="85c63-147">Místo toho se při prvním pokusu o přístup k vlastnosti navigace `Enrollments` do databáze pošle nový dotaz, aby se data načetla.</span><span class="sxs-lookup"><span data-stu-id="85c63-147">Instead, the first time you try to access the `Enrollments` navigation property, a new query is sent to the database to retrieve the data.</span></span> <span data-ttu-id="85c63-148">Další informace o opožděném načítání a Eager načítání najdete v kurzu pro [čtení souvisejících dat](reading-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md) dále v této sérii.</span><span class="sxs-lookup"><span data-stu-id="85c63-148">You can read more about lazy loading and eager loading in the [Reading Related Data](reading-related-data-with-the-entity-framework-in-an-asp-net-mvc-application.md) tutorial later in this series.</span></span>

3. <span data-ttu-id="85c63-149">Otevřete stránku podrobností spuštěním programu (**Ctrl**+**F5**), výběrem karty **Students** a kliknutím na odkaz **Podrobnosti** pro Alexander Carson.</span><span class="sxs-lookup"><span data-stu-id="85c63-149">Open the Details page by starting the program (**Ctrl**+**F5**), selecting the **Students** tab, and then clicking the **Details** link for Alexander Carson.</span></span> <span data-ttu-id="85c63-150">(Pokud po otevření souboru *Details. cshtml* stisknete klávesu **CTRL**+**F5** , zobrazí se chyba HTTP 400.</span><span class="sxs-lookup"><span data-stu-id="85c63-150">(If you press **Ctrl**+**F5** while the *Details.cshtml* file is open, you get an HTTP 400 error.</span></span> <span data-ttu-id="85c63-151">Je to proto, že se Visual Studio pokusí spustit stránku podrobností, ale nedostalo se na odkaz, který určuje, kdo má zobrazit.</span><span class="sxs-lookup"><span data-stu-id="85c63-151">This is because Visual Studio tries to run the Details page, but it wasn't reached from a link that specifies the student to display.</span></span> <span data-ttu-id="85c63-152">Pokud k tomu dojde, z adresy URL odeberte "student/Details" a zkuste to znovu, nebo zavřete prohlížeč, klikněte pravým tlačítkem na projekt a pak klikněte na **zobrazit** > **zobrazení v prohlížeči**.)</span><span class="sxs-lookup"><span data-stu-id="85c63-152">If that happens, remove "Student/Details" from the URL and try again, or, close the browser, right-click the project, and click **View** > **View in Browser**.)</span></span>

    <span data-ttu-id="85c63-153">Zobrazí se seznam kurzů a stupňů pro vybraného studenta.</span><span class="sxs-lookup"><span data-stu-id="85c63-153">You see the list of courses and grades for the selected student.</span></span>

4. <span data-ttu-id="85c63-154">Zavřete prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="85c63-154">Close the browser.</span></span>

## <a name="update-the-create-page"></a><span data-ttu-id="85c63-155">Aktualizace stránky pro vytvoření</span><span class="sxs-lookup"><span data-stu-id="85c63-155">Update the Create page</span></span>

1. <span data-ttu-id="85c63-156">V *Controllers\StudentController.cs*nahraďte metodu <xref:System.Web.Mvc.HttpPostAttribute> `Create` akci následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="85c63-156">In *Controllers\StudentController.cs*, replace the <xref:System.Web.Mvc.HttpPostAttribute> `Create` action method with the following code.</span></span> <span data-ttu-id="85c63-157">Tento kód přidá blok `try-catch` a odebere `ID` z atributu <xref:System.Web.Mvc.BindAttribute> pro vygenerované metody:</span><span class="sxs-lookup"><span data-stu-id="85c63-157">This code adds a `try-catch` block and removes `ID` from the <xref:System.Web.Mvc.BindAttribute> attribute for the scaffolded method:</span></span>

    [!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample7.cs?highlight=3,5-6,13-18)]

    <span data-ttu-id="85c63-158">Tento kód přidá entitu `Student` vytvořenou pomocí pořadače modelu ASP.NET MVC do sady entit `Students` a následně uloží změny do databáze.</span><span class="sxs-lookup"><span data-stu-id="85c63-158">This code adds the `Student` entity created by the ASP.NET MVC model binder to the `Students` entity set and then saves the changes to the database.</span></span> <span data-ttu-id="85c63-159">*Pořadač modelů* odkazuje na funkci ASP.NET MVC, která usnadňuje práci s daty odesílanými formulářem. pořadač modelů převede hodnoty odeslaných formulářů na typy CLR a předá je metodě Action v parametrech.</span><span class="sxs-lookup"><span data-stu-id="85c63-159">*Model binder* refers to the ASP.NET MVC functionality that makes it easier for you to work with data submitted by a form; a model binder converts posted form values to CLR types and passes them to the action method in parameters.</span></span> <span data-ttu-id="85c63-160">V takovém případě pořadač modelů vytvoří instanci entity `Student` pro použití hodnot vlastností z kolekce `Form`.</span><span class="sxs-lookup"><span data-stu-id="85c63-160">In this case, the model binder instantiates a `Student` entity for you using property values from the `Form` collection.</span></span>

    <span data-ttu-id="85c63-161">Odebrali jste `ID` z atributu BIND, protože `ID` je hodnota primárního klíče, kterou SQL Server nastaví automaticky při vložení řádku.</span><span class="sxs-lookup"><span data-stu-id="85c63-161">You removed `ID` from the Bind attribute because `ID` is the primary key value which SQL Server will set automatically when the row is inserted.</span></span> <span data-ttu-id="85c63-162">Vstup od uživatele nenastavuje hodnotu `ID`.</span><span class="sxs-lookup"><span data-stu-id="85c63-162">Input from the user does not set the `ID` value.</span></span>

    <a id="overpost"></a>

    ### <a name="security-warning---the-validateantiforgerytoken-attribute-helps-prevent-cross-site-request-forgery-attacks-it-requires-a-corresponding-htmlantiforgerytoken-statement-in-the-view-which-youll-see-later"></a><span data-ttu-id="85c63-163">Upozornění zabezpečení – atribut `ValidateAntiForgeryToken` pomáhá zabránit útokům proti [padělání požadavků mezi weby](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md) .</span><span class="sxs-lookup"><span data-stu-id="85c63-163">Security warning - The `ValidateAntiForgeryToken` attribute helps prevent [cross-site request forgery](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md) attacks.</span></span> <span data-ttu-id="85c63-164">V zobrazení vyžaduje odpovídající příkaz `Html.AntiForgeryToken()`, který se zobrazí později.</span><span class="sxs-lookup"><span data-stu-id="85c63-164">It requires a corresponding `Html.AntiForgeryToken()` statement in the view, which you'll see later.</span></span>

    <span data-ttu-id="85c63-165">Atribut `Bind` je jedním ze způsobů, jak chránit před *převzetím* služeb při selhání ve scénářích vytváření.</span><span class="sxs-lookup"><span data-stu-id="85c63-165">The `Bind` attribute is one way to protect against *over-posting* in create scenarios.</span></span> <span data-ttu-id="85c63-166">Předpokládejme například, že entita `Student` zahrnuje vlastnost `Secret`, kterou nechcete, aby tato webová stránka nastavila.</span><span class="sxs-lookup"><span data-stu-id="85c63-166">For example, suppose the `Student` entity includes a `Secret` property that you don't want this web page to set.</span></span>

    [!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample8.cs?highlight=7)]

    <span data-ttu-id="85c63-167">I když na webové stránce nemáte pole `Secret`, hacker by mohl k odeslání `Secret` hodnoty formuláře použít nějaký nástroj, jako je [Fiddler](http://fiddler2.com/home)nebo napsat nějaký JavaScript.</span><span class="sxs-lookup"><span data-stu-id="85c63-167">Even if you don't have a `Secret` field on the web page, a hacker could use a tool such as [fiddler](http://fiddler2.com/home), or write some JavaScript, to post a `Secret` form value.</span></span> <span data-ttu-id="85c63-168">Bez atributu <xref:System.Web.Mvc.BindAttribute> omezující pole, která model Binder používá při vytváření instance `Student`<em>,</em> vytvoří pořadač modelu tuto hodnotu `Secret` formuláře a použije ji k vytvoření instance entity `Student`.</span><span class="sxs-lookup"><span data-stu-id="85c63-168">Without the <xref:System.Web.Mvc.BindAttribute> attribute limiting the fields that the model binder uses when it creates a `Student` instance<em>,</em> the model binder would pick up that `Secret` form value and use it to create the `Student` entity instance.</span></span> <span data-ttu-id="85c63-169">Pak se v databázi aktualizuje počítačový podvodník zadaný pro pole `Secret` formuláře.</span><span class="sxs-lookup"><span data-stu-id="85c63-169">Then whatever value the hacker specified for the `Secret` form field would be updated in your database.</span></span> <span data-ttu-id="85c63-170">Následující obrázek ukazuje nástroj Fiddler, který přidá pole `Secret` (s hodnotou "Repost") do publikovaných hodnot formuláře.</span><span class="sxs-lookup"><span data-stu-id="85c63-170">The following image shows the fiddler tool adding the `Secret` field (with the value "OverPost") to the posted form values.</span></span>

    ![](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/_static/image5.png)

    <span data-ttu-id="85c63-171">Hodnota "" přeúčtování "by se pak úspěšně přidala do vlastnosti `Secret` vloženého řádku, i když jste tak ještě neučinili, že webová stránka bude moct tuto vlastnost nastavit.</span><span class="sxs-lookup"><span data-stu-id="85c63-171">The value "OverPost" would then be successfully added to the `Secret` property of the inserted row, although you never intended that the web page be able to set that property.</span></span>

    <span data-ttu-id="85c63-172">Je nejvhodnější použít parametr `Include` s atributem `Bind` na seznam *povolených* polí.</span><span class="sxs-lookup"><span data-stu-id="85c63-172">It's best to use the `Include` parameter with the `Bind` attribute to *whitelist* fields.</span></span> <span data-ttu-id="85c63-173">Je také možné použít parametr `Exclude` pro *zakázaná* pole, která chcete vyloučit.</span><span class="sxs-lookup"><span data-stu-id="85c63-173">It's also possible to use the `Exclude` parameter to *blacklist* fields you want to exclude.</span></span> <span data-ttu-id="85c63-174">Důvodem `Include` je bezpečnější je to, že když přidáte novou vlastnost k entitě, nové pole se automaticky nechrání pomocí seznamu `Exclude`.</span><span class="sxs-lookup"><span data-stu-id="85c63-174">The reason `Include` is more secure is that when you add a new property to the entity, the new field is not automatically protected by an `Exclude` list.</span></span>

    <span data-ttu-id="85c63-175">Je možné zabránit tomu, aby v úpravách scénářů byla přepsána nejprve z databáze a následným voláním `TryUpdateModel`a předáním seznamu explicitně povolených vlastností.</span><span class="sxs-lookup"><span data-stu-id="85c63-175">You can prevent overposting in edit scenarios is by reading the entity from the database first and then calling `TryUpdateModel`, passing in an explicit allowed properties list.</span></span> <span data-ttu-id="85c63-176">To je metoda použitá v těchto kurzech.</span><span class="sxs-lookup"><span data-stu-id="85c63-176">That is the method used in these tutorials.</span></span>

    <span data-ttu-id="85c63-177">Alternativní způsob, jak zabránit předávání, které upřednostňuje mnoho vývojářů, je použít modely zobrazení spíše než třídy entit s vazbou modelu.</span><span class="sxs-lookup"><span data-stu-id="85c63-177">An alternative way to prevent overposting that is preferred by many developers is to use view models rather than entity classes with model binding.</span></span> <span data-ttu-id="85c63-178">Do modelu zobrazení zahrňte pouze vlastnosti, které chcete aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="85c63-178">Include only the properties you want to update in the view model.</span></span> <span data-ttu-id="85c63-179">Po dokončení pořadače modelu MVC zkopírujte vlastnosti zobrazení modelu do instance entity, volitelně pomocí nástroje, jako je například [automapper](http://automapper.org/).</span><span class="sxs-lookup"><span data-stu-id="85c63-179">Once the MVC model binder has finished, copy the view model properties to the entity instance, optionally using a tool such as [AutoMapper](http://automapper.org/).</span></span> <span data-ttu-id="85c63-180">Použijte DB. Zadáním v instanci entity nastavte její stav na nezměněno a pak nastavte vlastnost ("PropertyName"). U každé vlastnosti entity, která je obsažena v modelu zobrazení, se změní na true.</span><span class="sxs-lookup"><span data-stu-id="85c63-180">Use db.Entry on the entity instance to set its state to Unchanged, and then set Property("PropertyName").IsModified to true on each entity property that is included in the view model.</span></span> <span data-ttu-id="85c63-181">Tato metoda funguje ve scénářích úpravy a vytváření.</span><span class="sxs-lookup"><span data-stu-id="85c63-181">This method works in both edit and create scenarios.</span></span>

    <span data-ttu-id="85c63-182">Kromě atributu `Bind` je `try-catch` blok jedinou změnou, kterou jste provedli v kódu generování.</span><span class="sxs-lookup"><span data-stu-id="85c63-182">Other than the `Bind` attribute, the `try-catch` block is the only change you've made to the scaffolded code.</span></span> <span data-ttu-id="85c63-183">Pokud je při ukládání změn zachycena výjimka odvozená od <xref:System.Data.DataException>, zobrazí se obecná chybová zpráva.</span><span class="sxs-lookup"><span data-stu-id="85c63-183">If an exception that derives from <xref:System.Data.DataException> is caught while the changes are being saved, a generic error message is displayed.</span></span> <span data-ttu-id="85c63-184">výjimky <xref:System.Data.DataException> jsou někdy způsobeny něčím externím pro aplikaci, nikoli při programování, takže se uživateli doporučuje akci opakovat.</span><span class="sxs-lookup"><span data-stu-id="85c63-184"><xref:System.Data.DataException> exceptions are sometimes caused by something external to the application rather than a programming error, so the user is advised to try again.</span></span> <span data-ttu-id="85c63-185">I když v této ukázce není implementované, aplikace produkční kvality by tuto výjimku zaznamenala.</span><span class="sxs-lookup"><span data-stu-id="85c63-185">Although not implemented in this sample, a production quality application would log the exception.</span></span> <span data-ttu-id="85c63-186">Další informace najdete v části **Log for Insight** v tématu [monitorování a telemetrie (vytváření skutečných cloudových aplikací s Azure)](../../../../aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry.md#log).</span><span class="sxs-lookup"><span data-stu-id="85c63-186">For more information, see the **Log for insight** section in [Monitoring and Telemetry (Building Real-World Cloud Apps with Azure)](../../../../aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/monitoring-and-telemetry.md#log).</span></span>

    <span data-ttu-id="85c63-187">Kód v *Views\Student\Create.cshtml* je podobný tomu, co jste viděli v *Details. cshtml*, s tím rozdílem, že `EditorFor` a `ValidationMessageFor` pomocníka se používají pro každé pole místo `DisplayFor`.</span><span class="sxs-lookup"><span data-stu-id="85c63-187">The code in *Views\Student\Create.cshtml* is similar to what you saw in *Details.cshtml*, except that `EditorFor` and `ValidationMessageFor` helpers are used for each field instead of `DisplayFor`.</span></span> <span data-ttu-id="85c63-188">Zde je příslušný kód:</span><span class="sxs-lookup"><span data-stu-id="85c63-188">Here is the relevant code:</span></span>

    [!code-cshtml[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample9.cshtml)]

    <span data-ttu-id="85c63-189">Příkaz *Create. cshtml* zahrnuje také `@Html.AntiForgeryToken()`, který spolupracuje s atributem `ValidateAntiForgeryToken` v kontroleru, aby se zabránilo útokům na [falšování mezi weby](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md) .</span><span class="sxs-lookup"><span data-stu-id="85c63-189">*Create.cshtml* also includes `@Html.AntiForgeryToken()`, which works with the `ValidateAntiForgeryToken` attribute in the controller to help prevent [cross-site request forgery](../../security/xsrfcsrf-prevention-in-aspnet-mvc-and-web-pages.md) attacks.</span></span>

    <span data-ttu-id="85c63-190">V *Create. cshtml*nejsou vyžadovány žádné změny.</span><span class="sxs-lookup"><span data-stu-id="85c63-190">No changes are required in *Create.cshtml*.</span></span>

2. <span data-ttu-id="85c63-191">Spusťte tuto stránku spuštěním programu, výběrem karty **Students** a kliknutím na **vytvořit novou**.</span><span class="sxs-lookup"><span data-stu-id="85c63-191">Run the page by starting the program, selecting the **Students** tab, and then clicking **Create New**.</span></span>

3. <span data-ttu-id="85c63-192">Zadejte názvy a neplatné datum a kliknutím na **vytvořit** se zobrazí chybová zpráva.</span><span class="sxs-lookup"><span data-stu-id="85c63-192">Enter names and an invalid date and click **Create** to see the error message.</span></span>

    <span data-ttu-id="85c63-193">Toto je ověřování na straně serveru, které se ve výchozím nastavení zobrazí.</span><span class="sxs-lookup"><span data-stu-id="85c63-193">This is server-side validation that you get by default.</span></span> <span data-ttu-id="85c63-194">V pozdějším kurzu uvidíte, jak přidat atributy, které generují kód pro ověřování na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="85c63-194">In a later tutorial, you'll see how to add attributes that generate code for client-side validation.</span></span> <span data-ttu-id="85c63-195">Následující zvýrazněný kód ukazuje kontrolu ověřování modelu v metodě **Create** .</span><span class="sxs-lookup"><span data-stu-id="85c63-195">The following highlighted code shows the model validation check in the **Create** method.</span></span>

    [!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample10.cs?highlight=1)]

4. <span data-ttu-id="85c63-196">Změňte datum na platnou hodnotu a kliknutím na tlačítko **vytvořit** zobrazíte nového studenta na stránce **Rejstřík** .</span><span class="sxs-lookup"><span data-stu-id="85c63-196">Change the date to a valid value and click **Create** to see the new student appear in the **Index** page.</span></span>

5. <span data-ttu-id="85c63-197">Zavřete prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="85c63-197">Close the browser.</span></span>

## <a name="update-httppost-edit-method"></a><span data-ttu-id="85c63-198">Update HttpPost Edit – metoda</span><span class="sxs-lookup"><span data-stu-id="85c63-198">Update HttpPost Edit method</span></span>

1. <span data-ttu-id="85c63-199">Metodu <xref:System.Web.Mvc.HttpPostAttribute> `Edit` akci nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="85c63-199">Replace the <xref:System.Web.Mvc.HttpPostAttribute> `Edit` action method with the following code:</span></span>

   [!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample11.cs)]

   > [!NOTE]
   > <span data-ttu-id="85c63-200">V `HttpGet Edit` *Controllers\StudentController.cs*metoda (ta bez atributu `HttpPost`) používá metodu `Find` k načtení vybrané entity `Student`, jak jste viděli v metodě `Details`.</span><span class="sxs-lookup"><span data-stu-id="85c63-200">In *Controllers\StudentController.cs*, the `HttpGet Edit` method (the one without the `HttpPost` attribute) uses the `Find` method to retrieve the selected `Student` entity, as you saw in the `Details` method.</span></span> <span data-ttu-id="85c63-201">Tuto metodu nemusíte měnit.</span><span class="sxs-lookup"><span data-stu-id="85c63-201">You don't need to change this method.</span></span>

   <span data-ttu-id="85c63-202">Tyto změny implementují osvědčené postupy zabezpečení, které zabrání [přestavování](#overpost), generování atributu `Bind` a přidání entity vytvořené pomocí pořadače modelu do sady entit s upraveným příznakem.</span><span class="sxs-lookup"><span data-stu-id="85c63-202">These changes implement a security best practice to prevent [overposting](#overpost), The scaffolder generated a `Bind` attribute and added the entity created by the model binder to the entity set with a Modified flag.</span></span> <span data-ttu-id="85c63-203">Tento kód již není doporučen, protože atribut `Bind` vymaže všechna dříve existující data v polích, která nejsou uvedena v parametru `Include`.</span><span class="sxs-lookup"><span data-stu-id="85c63-203">That code is no longer recommended because the `Bind` attribute clears out any pre-existing data in fields not listed in the `Include` parameter.</span></span> <span data-ttu-id="85c63-204">V budoucnu se generátor kontroleru MVC aktualizuje, aby negeneroval atributy `Bind` pro metody úprav.</span><span class="sxs-lookup"><span data-stu-id="85c63-204">In the future, the MVC controller scaffolder will be updated so that it doesn't generate `Bind` attributes for Edit methods.</span></span>

   <span data-ttu-id="85c63-205">Nový kód přečte existující entitu a volá <xref:System.Web.Mvc.Controller.TryUpdateModel%2A> pro aktualizaci polí ze vstupu uživatele v publikovaných datech formuláře.</span><span class="sxs-lookup"><span data-stu-id="85c63-205">The new code reads the existing entity and calls <xref:System.Web.Mvc.Controller.TryUpdateModel%2A> to update fields from user input in the posted form data.</span></span> <span data-ttu-id="85c63-206">Automatické sledování změn Entity Framework v entitě nastaví příznak [EntityState. Modified](<xref:System.Data.EntityState.Modified>) .</span><span class="sxs-lookup"><span data-stu-id="85c63-206">The Entity Framework's automatic change tracking sets the [EntityState.Modified](<xref:System.Data.EntityState.Modified>) flag on the entity.</span></span> <span data-ttu-id="85c63-207">Když je volána metoda [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) , příznak <xref:System.Data.EntityState.Modified> způsobí, že Entity Framework vytvoří příkazy SQL pro aktualizaci řádku databáze.</span><span class="sxs-lookup"><span data-stu-id="85c63-207">When the [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) method is called, the <xref:System.Data.EntityState.Modified> flag causes the Entity Framework to create SQL statements to update the database row.</span></span> <span data-ttu-id="85c63-208">[Konflikty souběžnosti](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) jsou ignorovány a všechny sloupce řádku databáze jsou aktualizovány, včetně těch, které uživatel nezměnil.</span><span class="sxs-lookup"><span data-stu-id="85c63-208">[Concurrency conflicts](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md) are ignored, and all columns of the database row are updated, including those that the user didn't change.</span></span> <span data-ttu-id="85c63-209">(V dalším kurzu se dozvíte, jak zvládnout konflikty souběžnosti a pokud chcete v databázi aktualizovat pouze jednotlivá pole, můžete nastavit entitu na [EntityState. Unchanged](<xref:System.Data.EntityState.Unchanged>) a nastavte jednotlivá pole na [EntityState. Modified](<xref:System.Data.EntityState.Modified>).)</span><span class="sxs-lookup"><span data-stu-id="85c63-209">(A later tutorial shows how to handle concurrency conflicts, and if you only want individual fields to be updated in the database, you can set the entity to [EntityState.Unchanged](<xref:System.Data.EntityState.Unchanged>) and set individual fields to [EntityState.Modified](<xref:System.Data.EntityState.Modified>).)</span></span>

   <span data-ttu-id="85c63-210">Chcete-li zabránit předávání, pole, která chcete aktualizovat pomocí stránky pro úpravy, jsou na seznamu povolená v parametrech `TryUpdateModel`.</span><span class="sxs-lookup"><span data-stu-id="85c63-210">To prevent overposting, the fields that you want to be updateable by the Edit page are whitelisted in the `TryUpdateModel` parameters.</span></span> <span data-ttu-id="85c63-211">V současné době nejsou k dispozici žádná doplňková pole, která chráníte, ale seznam polí, ke kterým má pořadač modelů navazovat vazby, zajišťuje, že pokud přidáte pole do datového modelu v budoucnosti, budou automaticky chráněny, dokud je nepřidáte sem.</span><span class="sxs-lookup"><span data-stu-id="85c63-211">Currently there are no extra fields that you're protecting, but listing the fields that you want the model binder to bind ensures that if you add fields to the data model in the future, they're automatically protected until you explicitly add them here.</span></span>

   <span data-ttu-id="85c63-212">V důsledku těchto změn je signatura metody HttpPost Edit shodná s metodou Edit HttpGet; Proto jste přejmenovali metodu EditPost.</span><span class="sxs-lookup"><span data-stu-id="85c63-212">As a result of these changes, the method signature of the HttpPost Edit method is the same as the HttpGet edit method; therefore you've renamed the method EditPost.</span></span>

   > [!TIP]
   >
   > <span data-ttu-id="85c63-213">**Stavy entit a metody Attach a SaveChanges**</span><span class="sxs-lookup"><span data-stu-id="85c63-213">**Entity States and the Attach and SaveChanges Methods**</span></span>
   >
   > <span data-ttu-id="85c63-214">Kontext databáze uchovává informace o tom, zda jsou entity v paměti synchronizovány s odpovídajícími řádky v databázi, a tyto informace určují, co se stane při volání metody `SaveChanges`.</span><span class="sxs-lookup"><span data-stu-id="85c63-214">The database context keeps track of whether entities in memory are in sync with their corresponding rows in the database, and this information determines what happens when you call the `SaveChanges` method.</span></span> <span data-ttu-id="85c63-215">Když například předáte novou entitu metodě [Add](https://msdn.microsoft.com/library/system.data.entity.dbset.add(v=vs.103).aspx) , stav této entity je nastaven na `Added`.</span><span class="sxs-lookup"><span data-stu-id="85c63-215">For example, when you pass a new entity to the [Add](https://msdn.microsoft.com/library/system.data.entity.dbset.add(v=vs.103).aspx) method, that entity's state is set to `Added`.</span></span> <span data-ttu-id="85c63-216">Poté při volání metody [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) vyvolá kontext databáze příkaz SQL `INSERT`.</span><span class="sxs-lookup"><span data-stu-id="85c63-216">Then when you call the [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) method, the database context issues a SQL `INSERT` command.</span></span>
   >
   > <span data-ttu-id="85c63-217">Entita může být v jednom z následujících [stavů](xref:System.Data.EntityState):</span><span class="sxs-lookup"><span data-stu-id="85c63-217">An entity may be in one of the following [states](xref:System.Data.EntityState):</span></span>
   >
   > - <span data-ttu-id="85c63-218">`Added`.</span><span class="sxs-lookup"><span data-stu-id="85c63-218">`Added`.</span></span> <span data-ttu-id="85c63-219">Entita zatím v databázi neexistuje.</span><span class="sxs-lookup"><span data-stu-id="85c63-219">The entity does not yet exist in the database.</span></span> <span data-ttu-id="85c63-220">Metoda `SaveChanges` musí vystavovat příkaz `INSERT`.</span><span class="sxs-lookup"><span data-stu-id="85c63-220">The `SaveChanges` method must issue an `INSERT` statement.</span></span>
   > - <span data-ttu-id="85c63-221">`Unchanged`.</span><span class="sxs-lookup"><span data-stu-id="85c63-221">`Unchanged`.</span></span> <span data-ttu-id="85c63-222">Pomocí metody `SaveChanges` není nic nutné s touto entitou dělat.</span><span class="sxs-lookup"><span data-stu-id="85c63-222">Nothing needs to be done with this entity by the `SaveChanges` method.</span></span> <span data-ttu-id="85c63-223">Při čtení entity z databáze se entita spouští s tímto stavem.</span><span class="sxs-lookup"><span data-stu-id="85c63-223">When you read an entity from the database, the entity starts out with this status.</span></span>
   > - <span data-ttu-id="85c63-224">`Modified`.</span><span class="sxs-lookup"><span data-stu-id="85c63-224">`Modified`.</span></span> <span data-ttu-id="85c63-225">Některé nebo všechny hodnoty vlastností entity byly změněny.</span><span class="sxs-lookup"><span data-stu-id="85c63-225">Some or all of the entity's property values have been modified.</span></span> <span data-ttu-id="85c63-226">Metoda `SaveChanges` musí vystavovat příkaz `UPDATE`.</span><span class="sxs-lookup"><span data-stu-id="85c63-226">The `SaveChanges` method must issue an `UPDATE` statement.</span></span>
   > - <span data-ttu-id="85c63-227">`Deleted`.</span><span class="sxs-lookup"><span data-stu-id="85c63-227">`Deleted`.</span></span> <span data-ttu-id="85c63-228">Entita byla označena pro odstranění.</span><span class="sxs-lookup"><span data-stu-id="85c63-228">The entity has been marked for deletion.</span></span> <span data-ttu-id="85c63-229">Metoda `SaveChanges` musí vystavovat příkaz `DELETE`.</span><span class="sxs-lookup"><span data-stu-id="85c63-229">The `SaveChanges` method must issue a `DELETE` statement.</span></span>
   > - <span data-ttu-id="85c63-230">`Detached`.</span><span class="sxs-lookup"><span data-stu-id="85c63-230">`Detached`.</span></span> <span data-ttu-id="85c63-231">Entita není sledována kontextem databáze.</span><span class="sxs-lookup"><span data-stu-id="85c63-231">The entity isn't being tracked by the database context.</span></span>
   >
   > <span data-ttu-id="85c63-232">V aplikaci klasické pracovní plochy se obvykle automaticky nastaví změny stavu.</span><span class="sxs-lookup"><span data-stu-id="85c63-232">In a desktop application, state changes are typically set automatically.</span></span> <span data-ttu-id="85c63-233">V typu aplikace na ploše si přečtete entitu a provedete změny jejích hodnot vlastností.</span><span class="sxs-lookup"><span data-stu-id="85c63-233">In a desktop type of application, you read an entity and make changes to some of its property values.</span></span> <span data-ttu-id="85c63-234">Tím dojde k automatické změně stavu entity na `Modified`.</span><span class="sxs-lookup"><span data-stu-id="85c63-234">This causes its entity state to automatically be changed to `Modified`.</span></span> <span data-ttu-id="85c63-235">Poté při volání `SaveChanges`Entity Framework vygeneruje příkaz jazyka SQL `UPDATE`, který aktualizuje pouze skutečné vlastnosti, které jste změnili.</span><span class="sxs-lookup"><span data-stu-id="85c63-235">Then when you call `SaveChanges`, the Entity Framework generates a SQL `UPDATE` statement that updates only the actual properties that you changed.</span></span>
   >
   > <span data-ttu-id="85c63-236">Odpojená povaha webových aplikací nepovoluje tuto souvislou sekvenci.</span><span class="sxs-lookup"><span data-stu-id="85c63-236">The disconnected nature of web apps doesn't allow for this continuous sequence.</span></span> <span data-ttu-id="85c63-237">[DbContext](https://msdn.microsoft.com/library/system.data.entity.dbcontext(v=VS.103).aspx) , který čte entitu, je uvolněna po vykreslení stránky.</span><span class="sxs-lookup"><span data-stu-id="85c63-237">The [DbContext](https://msdn.microsoft.com/library/system.data.entity.dbcontext(v=VS.103).aspx) that reads an entity is disposed after a page is rendered.</span></span> <span data-ttu-id="85c63-238">Když je volána metoda `HttpPost` `Edit` akce, je vytvořena nová žádost a máte novou instanci [DbContext](https://msdn.microsoft.com/library/system.data.entity.dbcontext(v=VS.103).aspx), takže je nutné ručně nastavit stav entity na `Modified.` pak při volání `SaveChanges`Entity Framework aktualizuje všechny sloupce řádku databáze, protože kontext nemá žádný způsob, jak zjistit, které vlastnosti jste změnili.</span><span class="sxs-lookup"><span data-stu-id="85c63-238">When the `HttpPost` `Edit` action method is called, a new request is made and you have a new instance of the [DbContext](https://msdn.microsoft.com/library/system.data.entity.dbcontext(v=VS.103).aspx), so you have to manually set the entity state to `Modified.` Then when you call `SaveChanges`, the Entity Framework updates all columns of the database row, because the context has no way to know which properties you changed.</span></span>
   >
   > <span data-ttu-id="85c63-239">Pokud chcete, aby příkaz SQL `Update` aktualizoval pouze pole, která uživatel skutečně změnil, můžete původní hodnoty Uložit nějakým způsobem (například skrytá pole), aby byly k dispozici při volání metody `Edit` `HttpPost`.</span><span class="sxs-lookup"><span data-stu-id="85c63-239">If you want the SQL `Update` statement to update only the fields that the user actually changed, you can save the original values in some way (such as hidden fields) so that they are available when the `HttpPost` `Edit` method is called.</span></span> <span data-ttu-id="85c63-240">Pak můžete vytvořit entitu `Student` s použitím původních hodnot, zavolat metodu `Attach` s touto původní verzí entity, aktualizovat hodnoty entity na nové hodnoty a potom volat `SaveChanges.` pro další informace, viz [stavy entit a metody SaveChanges](/ef/ef6/saving/change-tracking/entity-state) a [místní data](/ef/ef6/querying/local-data).</span><span class="sxs-lookup"><span data-stu-id="85c63-240">Then you can create a `Student` entity using the original values, call the `Attach` method with that original version of the entity, update the entity's values to the new values, and then call `SaveChanges.` For more information, see [Entity states and SaveChanges](/ef/ef6/saving/change-tracking/entity-state) and [Local Data](/ef/ef6/querying/local-data).</span></span>

   <span data-ttu-id="85c63-241">Kód HTML a Razor v *Views\Student\Edit.cshtml* je podobný tomu, co jste viděli v souboru *Create. cshtml*a nejsou vyžadovány žádné změny.</span><span class="sxs-lookup"><span data-stu-id="85c63-241">The HTML and Razor code in *Views\Student\Edit.cshtml* is similar to what you saw in *Create.cshtml*, and no changes are required.</span></span>

2. <span data-ttu-id="85c63-242">Spusťte tuto stránku spuštěním programu, výběrem karty **Students** a kliknutím na hypertextový odkaz pro **Úpravy** .</span><span class="sxs-lookup"><span data-stu-id="85c63-242">Run the page by starting the program, selecting the **Students** tab, and then clicking an **Edit** hyperlink.</span></span>

3. <span data-ttu-id="85c63-243">Změňte některá data a klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="85c63-243">Change some of the data and click **Save**.</span></span> <span data-ttu-id="85c63-244">Změněná data se zobrazí na stránce index.</span><span class="sxs-lookup"><span data-stu-id="85c63-244">You see the changed data in the Index page.</span></span>

4. <span data-ttu-id="85c63-245">Zavřete prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="85c63-245">Close the browser.</span></span>

## <a name="update-the-delete-page"></a><span data-ttu-id="85c63-246">Aktualizovat stránku Delete</span><span class="sxs-lookup"><span data-stu-id="85c63-246">Update the Delete page</span></span>

<span data-ttu-id="85c63-247">V *Controllers\StudentController.cs*kód šablony pro metodu <xref:System.Web.Mvc.HttpGetAttribute> `Delete` používá metodu `Find` k načtení vybrané entity `Student`, jak jste viděli v `Details` a `Edit` metod.</span><span class="sxs-lookup"><span data-stu-id="85c63-247">In *Controllers\StudentController.cs*, the template code for the <xref:System.Web.Mvc.HttpGetAttribute> `Delete` method uses the `Find` method to retrieve the selected `Student` entity, as you saw in the `Details` and `Edit` methods.</span></span> <span data-ttu-id="85c63-248">K implementaci vlastní chybové zprávy, když volání `SaveChanges` dojde k chybě, přidáte k této metodě a příslušnému zobrazení některé funkce.</span><span class="sxs-lookup"><span data-stu-id="85c63-248">However, to implement a custom error message when the call to `SaveChanges` fails, you'll add some functionality to this method and its corresponding view.</span></span>

<span data-ttu-id="85c63-249">Jak jste viděli pro operace aktualizace a vytváření, vyžadují operace odstranění dvě metody akcí.</span><span class="sxs-lookup"><span data-stu-id="85c63-249">As you saw for update and create operations, delete operations require two action methods.</span></span> <span data-ttu-id="85c63-250">Metoda, která je volána jako odpověď na požadavek GET, zobrazí zobrazení, které uživateli umožňuje schválit nebo zrušit operaci odstranění.</span><span class="sxs-lookup"><span data-stu-id="85c63-250">The method that is called in response to a GET request displays a view that gives the user a chance to approve or cancel the delete operation.</span></span> <span data-ttu-id="85c63-251">Pokud ho uživatel schválí, vytvoří se požadavek POST.</span><span class="sxs-lookup"><span data-stu-id="85c63-251">If the user approves it, a POST request is created.</span></span> <span data-ttu-id="85c63-252">Pokud k tomu dojde, je volána metoda `HttpPost` `Delete` a pak tato metoda skutečně provede operaci DELETE.</span><span class="sxs-lookup"><span data-stu-id="85c63-252">When that happens, the `HttpPost` `Delete` method is called and then that method actually performs the delete operation.</span></span>

<span data-ttu-id="85c63-253">Do metody `Delete` <xref:System.Web.Mvc.HttpPostAttribute> přidáte blok `try-catch`, který bude zpracovávat chyby, ke kterým může dojít při aktualizaci databáze.</span><span class="sxs-lookup"><span data-stu-id="85c63-253">You'll add a `try-catch` block to the <xref:System.Web.Mvc.HttpPostAttribute> `Delete` method to handle any errors that might occur when the database is updated.</span></span> <span data-ttu-id="85c63-254">Pokud dojde k chybě, metoda <xref:System.Web.Mvc.HttpPostAttribute> `Delete` volá metodu <xref:System.Web.Mvc.HttpGetAttribute> `Delete` a předá jí parametr, který indikuje, že došlo k chybě.</span><span class="sxs-lookup"><span data-stu-id="85c63-254">If an error occurs, the <xref:System.Web.Mvc.HttpPostAttribute> `Delete` method calls the <xref:System.Web.Mvc.HttpGetAttribute> `Delete` method, passing it a parameter that indicates that an error has occurred.</span></span> <span data-ttu-id="85c63-255">Metoda <xref:System.Web.Mvc.HttpGetAttribute> `Delete` pak znovu zobrazí potvrzovací stránku spolu s chybovou zprávou, takže uživatel může příležitost zrušit nebo zkusit znovu.</span><span class="sxs-lookup"><span data-stu-id="85c63-255">The <xref:System.Web.Mvc.HttpGetAttribute> `Delete` method then redisplays the confirmation page along with the error message, giving the user an opportunity to cancel or try again.</span></span>

1. <span data-ttu-id="85c63-256">Nahraďte metodu <xref:System.Web.Mvc.HttpGetAttribute> `Delete` akci následujícím kódem, který spravuje zasílání zpráv o chybách:</span><span class="sxs-lookup"><span data-stu-id="85c63-256">Replace the <xref:System.Web.Mvc.HttpGetAttribute> `Delete` action method with the following code, which manages error reporting:</span></span>

    [!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample12.cs?highlight=1,7-10)]

    <span data-ttu-id="85c63-257">Tento kód akceptuje [volitelný parametr](https://msdn.microsoft.com/library/dd264739.aspx) , který označuje, zda byla metoda volána po neúspěšném uložení změn.</span><span class="sxs-lookup"><span data-stu-id="85c63-257">This code accepts an [optional parameter](https://msdn.microsoft.com/library/dd264739.aspx) that indicates whether the method was called after a failure to save changes.</span></span> <span data-ttu-id="85c63-258">Tento parametr je `false`, pokud je metoda `Delete` `HttpGet` volána bez předchozí chyby.</span><span class="sxs-lookup"><span data-stu-id="85c63-258">This parameter is `false` when the `HttpGet` `Delete` method is called without a previous failure.</span></span> <span data-ttu-id="85c63-259">Pokud je volána metodou `HttpPost` `Delete` v reakci na chybu aktualizace databáze, je parametr `true` a do zobrazení se předává chybová zpráva.</span><span class="sxs-lookup"><span data-stu-id="85c63-259">When it is called by the `HttpPost` `Delete` method in response to a database update error, the parameter is `true` and an error message is passed to the view.</span></span>

2. <span data-ttu-id="85c63-260">Nahraďte metodu <xref:System.Web.Mvc.HttpPostAttribute> `Delete` Action (s názvem `DeleteConfirmed`) následujícím kódem, který provede skutečnou operaci odstranění a zachytí všechny chyby aktualizace databáze.</span><span class="sxs-lookup"><span data-stu-id="85c63-260">Replace the <xref:System.Web.Mvc.HttpPostAttribute> `Delete` action method (named `DeleteConfirmed`) with the following code, which performs the actual delete operation and catches any database update errors.</span></span>

    [!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample13.cs)]

    <span data-ttu-id="85c63-261">Tento kód načte vybranou entitu a pak zavolá metodu [Remove](https://msdn.microsoft.com/library/system.data.entity.dbset.remove(v=vs.103).aspx) pro nastavení stavu entity na `Deleted`.</span><span class="sxs-lookup"><span data-stu-id="85c63-261">This code retrieves the selected entity, then calls the [Remove](https://msdn.microsoft.com/library/system.data.entity.dbset.remove(v=vs.103).aspx) method to set the entity's status to `Deleted`.</span></span> <span data-ttu-id="85c63-262">Při volání `SaveChanges` se vygeneruje příkaz SQL `DELETE`.</span><span class="sxs-lookup"><span data-stu-id="85c63-262">When `SaveChanges` is called, a SQL `DELETE` command is generated.</span></span> <span data-ttu-id="85c63-263">Změnili jste také název metody akce z `DeleteConfirmed` na `Delete`.</span><span class="sxs-lookup"><span data-stu-id="85c63-263">You have also changed the action method name from `DeleteConfirmed` to `Delete`.</span></span> <span data-ttu-id="85c63-264">Generovaný kód s názvem `HttpPost` `Delete` metody `DeleteConfirmed` pro udělení jedinečného podpisu `HttpPost` metodě.</span><span class="sxs-lookup"><span data-stu-id="85c63-264">The scaffolded code named the `HttpPost` `Delete` method `DeleteConfirmed` to give the `HttpPost` method a unique signature.</span></span> <span data-ttu-id="85c63-265">(CLR vyžaduje, aby byly přetížené metody pro různé parametry metody.) Teď, když jsou podpisy jedinečné, můžete s úmluvou MVC pracovat a používat stejný název pro `HttpPost` a `HttpGet` odstranit metody.</span><span class="sxs-lookup"><span data-stu-id="85c63-265">(The CLR requires overloaded methods to have different method parameters.) Now that the signatures are unique, you can stick with the MVC convention and use the same name for the `HttpPost` and `HttpGet` delete methods.</span></span>

    <span data-ttu-id="85c63-266">Pokud zlepšení výkonu v aplikaci s vysokým objemem je prioritou, můžete se vyhnout zbytečným dotazům SQL k načtení řádku nahrazením řádků kódu, které volají `Find` a `Remove` metody s následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="85c63-266">If improving performance in a high-volume application is a priority, you could avoid an unnecessary SQL query to retrieve the row by replacing the lines of code that call the `Find` and `Remove` methods with the following code:</span></span>

    [!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample14.cs)]

    <span data-ttu-id="85c63-267">Tento kód vytvoří instanci entity `Student` pouze pomocí hodnoty primárního klíče a poté nastaví stav entity na hodnotu `Deleted`.</span><span class="sxs-lookup"><span data-stu-id="85c63-267">This code instantiates a `Student` entity using only the primary key value and then sets the entity state to `Deleted`.</span></span> <span data-ttu-id="85c63-268">To je vše, co Entity Framework potřebuje, aby se entita odstranila.</span><span class="sxs-lookup"><span data-stu-id="85c63-268">That's all that the Entity Framework needs in order to delete the entity.</span></span>

    <span data-ttu-id="85c63-269">Jak je uvedeno, metoda `HttpGet` `Delete` data neodstraňují.</span><span class="sxs-lookup"><span data-stu-id="85c63-269">As noted, the `HttpGet` `Delete` method doesn't delete the data.</span></span> <span data-ttu-id="85c63-270">Provádění operace odstranění v reakci na požadavek GET (nebo pro tuto skutečnost, provádění operací úprav, operace vytvoření nebo jakékoli jiné operace, která mění data) vytvoří bezpečnostní riziko.</span><span class="sxs-lookup"><span data-stu-id="85c63-270">Performing a delete operation in response to a GET request (or for that matter, performing any edit operation, create operation, or any other operation that changes data) creates a security risk.</span></span> <span data-ttu-id="85c63-271">Další informace najdete v tématu [ASP.NET #46 Tip – nepoužívejte odstranění odkazů, protože vytvářejí bezpečnostní otvory](http://stephenwalther.com/blog/archive/2009/01/21/asp.net-mvc-tip-46-ndash-donrsquot-use-delete-links-because.aspx) na blogu Stephen Walther.</span><span class="sxs-lookup"><span data-stu-id="85c63-271">For more information, see [ASP.NET MVC Tip #46 — Don't use Delete Links because they create Security Holes](http://stephenwalther.com/blog/archive/2009/01/21/asp.net-mvc-tip-46-ndash-donrsquot-use-delete-links-because.aspx) on Stephen Walther's blog.</span></span>

3. <span data-ttu-id="85c63-272">V *Views\Student\Delete.cshtml*přidejte chybovou zprávu mezi nadpisem `h2` a záhlavím `h3`, jak je znázorněno v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="85c63-272">In *Views\Student\Delete.cshtml*, add an error message between the `h2` heading and the `h3` heading, as shown in the following example:</span></span>

    [!code-cshtml[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample15.cshtml?highlight=2)]

4. <span data-ttu-id="85c63-273">Spusťte tuto stránku spuštěním programu, výběrem karty **Students** a kliknutím na **Odstranit** hypertextový odkaz.</span><span class="sxs-lookup"><span data-stu-id="85c63-273">Run the page by starting the program, selecting the **Students** tab, and then clicking a **Delete** hyperlink.</span></span>

5. <span data-ttu-id="85c63-274">Na stránce vyberte možnost **Odstranit** . **opravdu chcete tuto zprávu odstranit?**</span><span class="sxs-lookup"><span data-stu-id="85c63-274">Choose **Delete** on the page that says **Are you sure you want to delete this?**.</span></span>

    <span data-ttu-id="85c63-275">Stránka index se zobrazí bez odstraněného studenta.</span><span class="sxs-lookup"><span data-stu-id="85c63-275">The Index page displays without the deleted student.</span></span> <span data-ttu-id="85c63-276">(Příklad kódu pro zpracování chyb v akci v [kurzu souběžnosti](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md)najdete v tématu.)</span><span class="sxs-lookup"><span data-stu-id="85c63-276">(You'll see an example of the error handling code in action in the [concurrency tutorial](handling-concurrency-with-the-entity-framework-in-an-asp-net-mvc-application.md).)</span></span>

## <a name="close-database-connections"></a><span data-ttu-id="85c63-277">Zavřít databázová připojení</span><span class="sxs-lookup"><span data-stu-id="85c63-277">Close database connections</span></span>

<span data-ttu-id="85c63-278">Chcete-li zavřít databázová připojení a uvolnit prostředky, které jsou k dispozici co nejdříve, vyřazení instance kontextu, jakmile s ní budete hotovi.</span><span class="sxs-lookup"><span data-stu-id="85c63-278">To close database connections and free up the resources they hold as soon as possible, dispose the context instance when you are done with it.</span></span> <span data-ttu-id="85c63-279">To je důvod, proč generovaný kód poskytuje metodu [Dispose](https://msdn.microsoft.com/library/system.idisposable.dispose(v=vs.110).aspx) na konci `StudentController` třídy v *StudentController.cs*, jak je znázorněno v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="85c63-279">That is why the scaffolded code provides a [Dispose](https://msdn.microsoft.com/library/system.idisposable.dispose(v=vs.110).aspx) method at the end of the `StudentController` class in *StudentController.cs*, as shown in the following example:</span></span>

[!code-csharp[Main](implementing-basic-crud-functionality-with-the-entity-framework-in-asp-net-mvc-application/samples/sample16.cs)]

<span data-ttu-id="85c63-280">Základní `Controller` třída již implementuje rozhraní `IDisposable`, takže tento kód jednoduše přidá přepsání do metody `Dispose(bool)` k explicitnímu uvolnění instance kontextu.</span><span class="sxs-lookup"><span data-stu-id="85c63-280">The base `Controller` class already implements the `IDisposable` interface, so this code simply adds an override to the `Dispose(bool)` method to explicitly dispose the context instance.</span></span>

## <a name="handle-transactions"></a><span data-ttu-id="85c63-281">Zpracování transakcí</span><span class="sxs-lookup"><span data-stu-id="85c63-281">Handle transactions</span></span>

<span data-ttu-id="85c63-282">Ve výchozím nastavení Entity Framework implicitně implementuje transakce.</span><span class="sxs-lookup"><span data-stu-id="85c63-282">By default the Entity Framework implicitly implements transactions.</span></span> <span data-ttu-id="85c63-283">Ve scénářích, kdy provedete změny více řádků nebo tabulek a potom zavoláte `SaveChanges`, Entity Framework automaticky zajistí, že všechny změny byly úspěšné nebo všechny selžou.</span><span class="sxs-lookup"><span data-stu-id="85c63-283">In scenarios where you make changes to multiple rows or tables and then call `SaveChanges`, the Entity Framework automatically makes sure that either all of your changes succeed or all fail.</span></span> <span data-ttu-id="85c63-284">Pokud se nějaké změny provedly a pak dojde k chybě, změny se automaticky vrátí zpět.</span><span class="sxs-lookup"><span data-stu-id="85c63-284">If some changes are done first and then an error happens, those changes are automatically rolled back.</span></span> <span data-ttu-id="85c63-285">V případech, kdy potřebujete větší kontrolu&mdash;například, pokud chcete zahrnout operace provedené mimo Entity Framework v transakci&mdash;naleznete v tématu [práce s transakcemi](/ef/ef6/saving/transactions).</span><span class="sxs-lookup"><span data-stu-id="85c63-285">For scenarios where you need more control&mdash;for example, if you want to include operations done outside of Entity Framework in a transaction&mdash;see [Working with Transactions](/ef/ef6/saving/transactions).</span></span>

## <a name="get-the-code"></a><span data-ttu-id="85c63-286">Získání kódu</span><span class="sxs-lookup"><span data-stu-id="85c63-286">Get the code</span></span>

[<span data-ttu-id="85c63-287">Stáhnout dokončený projekt</span><span class="sxs-lookup"><span data-stu-id="85c63-287">Download Completed Project</span></span>](https://webpifeed.blob.core.windows.net/webpifeed/Partners/ASP.NET%20MVC%20Application%20Using%20Entity%20Framework%20Code%20First.zip)

## <a name="additional-resources"></a><span data-ttu-id="85c63-288">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="85c63-288">Additional resources</span></span>

<span data-ttu-id="85c63-289">Nyní máte úplnou sadu stránek, které provádějí jednoduché operace CRUD `Student` entit.</span><span class="sxs-lookup"><span data-stu-id="85c63-289">You now have a complete set of pages that perform simple CRUD operations for `Student` entities.</span></span> <span data-ttu-id="85c63-290">Pomocí pomocníků MVC můžete vygenerovat prvky uživatelského rozhraní pro datová pole.</span><span class="sxs-lookup"><span data-stu-id="85c63-290">You used MVC helpers to generate UI elements for data fields.</span></span> <span data-ttu-id="85c63-291">Další informace o pomocníkech MVC najdete v tématu [vykreslování formuláře pomocí pomocníků HTML](/previous-versions/aspnet/dd410596(v=vs.98)) (článek je pro MVC 3, ale je stále relevantní pro MVC 5).</span><span class="sxs-lookup"><span data-stu-id="85c63-291">For more info about MVC helpers, see [Rendering a Form Using HTML Helpers](/previous-versions/aspnet/dd410596(v=vs.98)) (the article is for MVC 3 but is still relevant for MVC 5).</span></span>

<span data-ttu-id="85c63-292">Odkazy na další prostředky EF 6 najdete v [prostředcích, které jsou doporučeny pro přístup k datům ASP.NET](../../../../whitepapers/aspnet-data-access-content-map.md).</span><span class="sxs-lookup"><span data-stu-id="85c63-292">Links to other EF 6 resources can be found in [ASP.NET Data Access - Recommended Resources](../../../../whitepapers/aspnet-data-access-content-map.md).</span></span>

## <a name="next-steps"></a><span data-ttu-id="85c63-293">Další kroky</span><span class="sxs-lookup"><span data-stu-id="85c63-293">Next steps</span></span>

<span data-ttu-id="85c63-294">V tomto kurzu se naučíte:</span><span class="sxs-lookup"><span data-stu-id="85c63-294">In this tutorial, you:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="85c63-295">Stránka s podrobnostmi se vytvořila.</span><span class="sxs-lookup"><span data-stu-id="85c63-295">Created a Details page</span></span>
> * <span data-ttu-id="85c63-296">Aktualizace stránky pro vytvoření</span><span class="sxs-lookup"><span data-stu-id="85c63-296">Updated the Create page</span></span>
> * <span data-ttu-id="85c63-297">Aktualizovala se metoda HttpPost Edit.</span><span class="sxs-lookup"><span data-stu-id="85c63-297">Updated the HttpPost Edit method</span></span>
> * <span data-ttu-id="85c63-298">Aktualizace stránky odstranění</span><span class="sxs-lookup"><span data-stu-id="85c63-298">Updated the Delete page</span></span>
> * <span data-ttu-id="85c63-299">Uzavřená databázová připojení</span><span class="sxs-lookup"><span data-stu-id="85c63-299">Closed database connections</span></span>
> * <span data-ttu-id="85c63-300">Zpracované transakce</span><span class="sxs-lookup"><span data-stu-id="85c63-300">Handled transactions</span></span>

<span data-ttu-id="85c63-301">Přejděte k dalšímu článku a Naučte se, jak do projektu přidat řazení, filtrování a stránkování.</span><span class="sxs-lookup"><span data-stu-id="85c63-301">Advance to the next article to learn how to add sorting, filtering, and paging to the project.</span></span>
> [!div class="nextstepaction"]
> [<span data-ttu-id="85c63-302">Řazení, filtrování a stránkování</span><span class="sxs-lookup"><span data-stu-id="85c63-302">Sorting, Filtering, and Paging</span></span>](sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md)
