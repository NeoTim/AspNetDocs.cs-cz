---
uid: mvc/overview/security/preventing-open-redirection-attacks
title: Zabránění útokům na otevřenéC#přesměrování () | Microsoft Docs
author: jongalloway
description: V tomto kurzu se dozvíte, jak můžete zabránit útokům na otevřené přesměrování v aplikacích ASP.NET MVC. Tento kurz se zabývá provedenými změnami...
ms.author: riande
ms.date: 02/27/2014
ms.assetid: 69fb02e0-f5b7-4c35-878c-fa87164fc785
msc.legacyurl: /mvc/overview/security/preventing-open-redirection-attacks
msc.type: authoredcontent
ms.openlocfilehash: cfa635d4fd14d031993c5b452325cbe334f82dc2
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78538169"
---
# <a name="preventing-open-redirection-attacks-c"></a><span data-ttu-id="c57fc-104">Prevence útoků založených na otevřeném přesměrování (C#)</span><span class="sxs-lookup"><span data-stu-id="c57fc-104">Preventing Open Redirection Attacks (C#)</span></span>

<span data-ttu-id="c57fc-105">o [Jan Galloway](https://github.com/jongalloway)</span><span class="sxs-lookup"><span data-stu-id="c57fc-105">by [Jon Galloway](https://github.com/jongalloway)</span></span>

> <span data-ttu-id="c57fc-106">V tomto kurzu se dozvíte, jak můžete zabránit útokům na otevřené přesměrování v aplikacích ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="c57fc-106">This tutorial explains how you can prevent open redirection attacks in your ASP.NET MVC applications.</span></span> <span data-ttu-id="c57fc-107">Tento kurz popisuje změny provedené v AccountController v ASP.NET MVC 3 a ukazuje, jak můžete tyto změny použít ve stávajících aplikacích ASP.NET MVC 1,0 a 2.</span><span class="sxs-lookup"><span data-stu-id="c57fc-107">This tutorial discusses the changes that have been made in the AccountController in ASP.NET MVC 3 and demonstrates how you can apply these changes in your existing ASP.NET MVC 1.0 and 2 applications.</span></span>

## <a name="what-is-an-open-redirection-attack"></a><span data-ttu-id="c57fc-108">Co je otevřený útok na přesměrování?</span><span class="sxs-lookup"><span data-stu-id="c57fc-108">What is an Open Redirection Attack?</span></span>

<span data-ttu-id="c57fc-109">Každá webová aplikace, která přesměrovává na adresu URL zadanou prostřednictvím žádosti, jako je například dotaz nebo data formuláře, může být úmyslně poškozena a přesměruje uživatele na externí, škodlivou adresu URL.</span><span class="sxs-lookup"><span data-stu-id="c57fc-109">Any web application that redirects to a URL that is specified via the request such as the querystring or form data can potentially be tampered with to redirect users to an external, malicious URL.</span></span> <span data-ttu-id="c57fc-110">Tato manipulace se nazývá útok typu otevřené přesměrování.</span><span class="sxs-lookup"><span data-stu-id="c57fc-110">This tampering is called an open redirection attack.</span></span>

<span data-ttu-id="c57fc-111">Vždy, když vaše logika aplikace přesměrovává na zadanou adresu URL, je nutné ověřit, že adresa URL pro přesměrování nebyla úmyslně poškozena.</span><span class="sxs-lookup"><span data-stu-id="c57fc-111">Whenever your application logic redirects to a specified URL, you must verify that the redirection URL hasn't been tampered with.</span></span> <span data-ttu-id="c57fc-112">Přihlášení, které se používá ve výchozím AccountController pro ASP.NET MVC 1,0 a ASP.NET MVC 2, je zranitelné kvůli útokům na otevřené přesměrování.</span><span class="sxs-lookup"><span data-stu-id="c57fc-112">The login used in the default AccountController for both ASP.NET MVC 1.0 and ASP.NET MVC 2 is vulnerable to open redirection attacks.</span></span> <span data-ttu-id="c57fc-113">Naštěstí je snadné aktualizovat existující aplikace, aby používaly opravy z ASP.NET MVC 3 Preview.</span><span class="sxs-lookup"><span data-stu-id="c57fc-113">Fortunately, it is easy to update your existing applications to use the corrections from the ASP.NET MVC 3 Preview.</span></span>

<span data-ttu-id="c57fc-114">Abychom porozuměli ohrožení zabezpečení, Podívejme se na to, jak přesměrování přihlášení funguje ve výchozím projektu webové aplikace ASP.NET MVC 2.</span><span class="sxs-lookup"><span data-stu-id="c57fc-114">To understand the vulnerability, let's look at how the login redirection works in a default ASP.NET MVC 2 Web Application project.</span></span> <span data-ttu-id="c57fc-115">V této aplikaci se pokusit o návštěvu akce kontroleru, která má atribut [autorizační], přesměruje neautorizované uživatele na zobrazení/Account/LogOn.</span><span class="sxs-lookup"><span data-stu-id="c57fc-115">In this application, attempting to visit a controller action that has the [Authorize] attribute will redirect unauthorized users to the /Account/LogOn view.</span></span> <span data-ttu-id="c57fc-116">Toto přesměrování na/Account/LogOn bude obsahovat parametr returnUrl QueryString, aby se uživatel mohl vrátit na původně požadovanou adresu URL po úspěšném přihlášení.</span><span class="sxs-lookup"><span data-stu-id="c57fc-116">This redirect to /Account/LogOn will include a returnUrl querystring parameter so that the user can be returned to the originally requested URL after they have successfully logged in.</span></span>

<span data-ttu-id="c57fc-117">Na následujícím snímku obrazovky vidíte, že při pokusu o přístup k zobrazení/Account/ChangePassword, když není přihlášen, se v důsledku přesměrování na/Account/LogOn? ReturnUrl =% 2fAccount% 2fChangePassword% 2f.</span><span class="sxs-lookup"><span data-stu-id="c57fc-117">In the screenshot below, we can see that an attempt to access the /Account/ChangePassword view when not logged in results in a redirect to /Account/LogOn?ReturnUrl=%2fAccount%2fChangePassword%2f.</span></span>

[![](preventing-open-redirection-attacks/_static/image2.png)](preventing-open-redirection-attacks/_static/image1.png)

<span data-ttu-id="c57fc-118">**Obrázek 01**: přihlašovací stránka s otevřeným přesměrováním</span><span class="sxs-lookup"><span data-stu-id="c57fc-118">**Figure 01**: Login page with an open redirection</span></span>

<span data-ttu-id="c57fc-119">Vzhledem k tomu, že parametr ReturnUrl QueryString není ověřený, útočník ho může upravit a vložit do parametru adresu URL, aby mohl spustit útok typu otevřené přesměrování.</span><span class="sxs-lookup"><span data-stu-id="c57fc-119">Since the ReturnUrl querystring parameter is not validated, an attacker can modify it to inject any URL address into the parameter to conduct an open redirection attack.</span></span> <span data-ttu-id="c57fc-120">Abychom to ukázali, můžeme parametr ReturnUrl změnit na [http://bing.com](http://bing.com), takže výsledná přihlašovací adresa URL bude/Account/LogOn? ReturnUrl =<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="c57fc-120">To demonstrate this, we can modify the ReturnUrl parameter to [http://bing.com](http://bing.com), so the resulting login URL will be /Account/LogOn?ReturnUrl=<http://www.bing.com/>.</span></span> <span data-ttu-id="c57fc-121">Po úspěšném přihlášení k lokalitě budeme přesměrováni na [http://bing.com](http://bing.com).</span><span class="sxs-lookup"><span data-stu-id="c57fc-121">Upon successfully logging in to the site, we are redirected to [http://bing.com](http://bing.com).</span></span> <span data-ttu-id="c57fc-122">Vzhledem k tomu, že toto přesměrování není ověřeno, může místo toho odkazovat na škodlivý web, který se pokusí uživatele přimět.</span><span class="sxs-lookup"><span data-stu-id="c57fc-122">Since this redirection is not validated, it could instead point to a malicious site that attempts to trick the user.</span></span>

### <a name="a-more-complex-open-redirection-attack"></a><span data-ttu-id="c57fc-123">Složitější útok na otevřené přesměrování</span><span class="sxs-lookup"><span data-stu-id="c57fc-123">A more complex Open Redirection Attack</span></span>

<span data-ttu-id="c57fc-124">Útoky na otevřené přesměrování jsou obzvláště nebezpečné, protože útočník ví, že se snažíme přihlásit ke konkrétnímu webu, což nám způsobuje hrozbu [útoku phishing](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span><span class="sxs-lookup"><span data-stu-id="c57fc-124">Open redirection attacks are especially dangerous because an attacker knows that we're trying to log into a specific website, which makes us vulnerable to a [phishing attack](https://www.microsoft.com/protect/fraud/phishing/symptoms.aspx).</span></span> <span data-ttu-id="c57fc-125">Útočník by například mohl odeslat škodlivé e-maily uživatelům webu při pokusu o zaznamenání hesla.</span><span class="sxs-lookup"><span data-stu-id="c57fc-125">For example, an attacker could send malicious emails to website users in an attempt to capture their passwords.</span></span> <span data-ttu-id="c57fc-126">Pojďme se podívat, jak to bude fungovat na webu NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="c57fc-126">Let's look at how this would work on the NerdDinner site.</span></span> <span data-ttu-id="c57fc-127">(Upozorňujeme, že Live NerdDinner web byl aktualizován tak, aby chránil proti útokům s otevřeným přesměrováním.)</span><span class="sxs-lookup"><span data-stu-id="c57fc-127">(Note that the live NerdDinner site has been updated to protect against open redirection attacks.)</span></span>

<span data-ttu-id="c57fc-128">Nejdřív útočník pošle odkaz na přihlašovací stránku na NerdDinner, která obsahuje přesměrování na jejich falešný stránku:</span><span class="sxs-lookup"><span data-stu-id="c57fc-128">First, an attacker sends us a link to the login page on NerdDinner that includes a redirect to their forged page:</span></span>

[http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn](http://nerddinner.com/Account/LogOn?returnUrl=http://nerddiner.com/Account/LogOn)

<span data-ttu-id="c57fc-129">Všimněte si, že návratová adresa URL odkazuje na nerddiner.com, ve kterém chybí "n" ze slova večeře.</span><span class="sxs-lookup"><span data-stu-id="c57fc-129">Note that the return URL points to nerddiner.com, which is missing an "n" from the word dinner.</span></span> <span data-ttu-id="c57fc-130">V tomto příkladu je to doména, kterou útočník ovládá.</span><span class="sxs-lookup"><span data-stu-id="c57fc-130">In this example, this is a domain that the attacker controls.</span></span> <span data-ttu-id="c57fc-131">Po přístupu k výše uvedenému odkazu se dostanete na legitimní přihlašovací stránku NerdDinner.com.</span><span class="sxs-lookup"><span data-stu-id="c57fc-131">When we access the above link, we're taken to the legitimate NerdDinner.com login page.</span></span>

[![](preventing-open-redirection-attacks/_static/image4.png)](preventing-open-redirection-attacks/_static/image3.png)

<span data-ttu-id="c57fc-132">**Obrázek 02**: přihlašovací stránka NerdDinner s otevřeným přesměrováním</span><span class="sxs-lookup"><span data-stu-id="c57fc-132">**Figure 02**: NerdDinner login page with an open redirection</span></span>

<span data-ttu-id="c57fc-133">Když se správně přihlásíme, akce přihlášení ASP.NET MVC AccountController přesměruje na adresu URL zadanou v parametru returnUrl QueryString.</span><span class="sxs-lookup"><span data-stu-id="c57fc-133">When we correctly log in, the ASP.NET MVC AccountController's LogOn action redirects us to the URL specified in the returnUrl querystring parameter.</span></span> <span data-ttu-id="c57fc-134">V tomto případě je to adresa URL, kterou útočník zadal, což je [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span><span class="sxs-lookup"><span data-stu-id="c57fc-134">In this case, it's the URL that the attacker has entered, which is [http://nerddiner.com/Account/LogOn](http://nerddiner.com/Account/LogOn).</span></span> <span data-ttu-id="c57fc-135">Pokud se nejedná o extrémně sledované, je velmi pravděpodobný, ale nemůžeme si to všimnout, zejména proto, že útočník má pozor, abyste se ujistili, že jeho neoprávněná stránka vypadá přesně stejně jako stránka legitimního přihlášení.</span><span class="sxs-lookup"><span data-stu-id="c57fc-135">Unless we're extremely watchful, it's very likely we won't notice this, especially because the attacker has been careful to make sure that their forged page looks exactly like the legitimate login page.</span></span> <span data-ttu-id="c57fc-136">Tato přihlašovací stránka obsahuje chybovou zprávu s požadavkem na opětovné přihlášení.</span><span class="sxs-lookup"><span data-stu-id="c57fc-136">This login page includes an error message requesting that we login again.</span></span> <span data-ttu-id="c57fc-137">Clumsy nás, musíme nezadat heslo.</span><span class="sxs-lookup"><span data-stu-id="c57fc-137">Clumsy us, we must have mistyped our password.</span></span>

[![](preventing-open-redirection-attacks/_static/image6.png)](preventing-open-redirection-attacks/_static/image5.png)

<span data-ttu-id="c57fc-138">**Obrázek 03**: obrazovka přihlašovacího jména k Padělánému NerdDinner</span><span class="sxs-lookup"><span data-stu-id="c57fc-138">**Figure 03**: Forged NerdDinner Login screen</span></span>

<span data-ttu-id="c57fc-139">Když znovu zadáte naše uživatelské jméno a heslo, přihlašovací stránka uloží tyto informace a pošle nám k legitimnímu webu NerdDinner.com.</span><span class="sxs-lookup"><span data-stu-id="c57fc-139">When we retype our user name and password, the forged login page saves the information and sends us back to the legitimate NerdDinner.com site.</span></span> <span data-ttu-id="c57fc-140">V tuto chvíli web NerdDinner.com již ověřil vaše jméno, takže přihlašovací stránka může přesměrovat přímo na tuto stránku.</span><span class="sxs-lookup"><span data-stu-id="c57fc-140">At this point, the NerdDinner.com site has already authenticated us, so the forged login page can redirect directly to that page.</span></span> <span data-ttu-id="c57fc-141">Konečným výsledkem je, že útočník má naše uživatelské jméno a heslo, ale nejsme si vědomi, že k nim jsme dostali.</span><span class="sxs-lookup"><span data-stu-id="c57fc-141">The end result is that the attacker has our user name and password, and we are unaware that we've provided it to them.</span></span>

## <a name="looking-at-the-vulnerable-code-in-the-accountcontroller-logon-action"></a><span data-ttu-id="c57fc-142">Podívejte se na ohrožený kód v akci přihlášení k AccountController</span><span class="sxs-lookup"><span data-stu-id="c57fc-142">Looking at the vulnerable code in the AccountController LogOn Action</span></span>

<span data-ttu-id="c57fc-143">Kód pro akci přihlášení v aplikaci ASP.NET MVC 2 je uveden níže.</span><span class="sxs-lookup"><span data-stu-id="c57fc-143">The code for the LogOn action in an ASP.NET MVC 2 application is shown below.</span></span> <span data-ttu-id="c57fc-144">Všimněte si, že po úspěšném přihlášení kontroler vrátí přesměrování na returnUrl.</span><span class="sxs-lookup"><span data-stu-id="c57fc-144">Note that upon a successful login, the controller returns a redirect to the returnUrl.</span></span> <span data-ttu-id="c57fc-145">Můžete vidět, že se neprovádí žádné ověřování proti parametru returnUrl.</span><span class="sxs-lookup"><span data-stu-id="c57fc-145">You can see that no validation is being performed against the returnUrl parameter.</span></span>

<span data-ttu-id="c57fc-146">**Výpis 1 – akce přihlášení k ASP.NET MVC 2 v `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="c57fc-146">**Listing 1 – ASP.NET MVC 2 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample1.cs)]

<span data-ttu-id="c57fc-147">Teď se podíváme na změny akce přihlášení ASP.NET MVC 3.</span><span class="sxs-lookup"><span data-stu-id="c57fc-147">Now let's look at the changes to the ASP.NET MVC 3 LogOn action.</span></span> <span data-ttu-id="c57fc-148">Tento kód byl změněn tak, aby ověřil parametr returnUrl voláním nové metody v pomocné třídě System. Web. Mvc. URL s názvem `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="c57fc-148">This code has been changed to validate the returnUrl parameter by calling a new method in the System.Web.Mvc.Url helper class named `IsLocalUrl()`.</span></span>

<span data-ttu-id="c57fc-149">**Výpis 2 – akce přihlášení ASP.NET MVC 3 v `AccountController.cs`**</span><span class="sxs-lookup"><span data-stu-id="c57fc-149">**Listing 2 – ASP.NET MVC 3 LogOn action in `AccountController.cs`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample2.cs)]

<span data-ttu-id="c57fc-150">Tato změna se změnila tak, aby se ověřil parametr návratové adresy URL voláním nové metody v pomocné třídě System. Web. Mvc. URL, `IsLocalUrl()`.</span><span class="sxs-lookup"><span data-stu-id="c57fc-150">This has been changed to validate the return URL parameter by calling a new method in the System.Web.Mvc.Url helper class, `IsLocalUrl()`.</span></span>

## <a name="protecting-your-aspnet-mvc-10-and-mvc-2-applications"></a><span data-ttu-id="c57fc-151">Ochrana aplikací ASP.NET MVC 1,0 a MVC 2</span><span class="sxs-lookup"><span data-stu-id="c57fc-151">Protecting Your ASP.NET MVC 1.0 and MVC 2 Applications</span></span>

<span data-ttu-id="c57fc-152">Můžete využít změny ASP.NET MVC 3 v našich stávajících aplikacích ASP.NET MVC 1,0 a 2 tak, že přidáte pomocnou metodu IsLocalUrl () a aktualizujete akci přihlášení a ověříte parametr returnUrl.</span><span class="sxs-lookup"><span data-stu-id="c57fc-152">We can take advantage of the ASP.NET MVC 3 changes in our existing ASP.NET MVC 1.0 and 2 applications by adding the IsLocalUrl() helper method and updating the LogOn action to validate the returnUrl parameter.</span></span>

<span data-ttu-id="c57fc-153">Metoda UrlHelper IsLocalUrl () ve skutečnosti stačí pouze volat do metody v System. Web. webpages, protože toto ověřování je také používáno aplikacemi ASP.NET Web Pages.</span><span class="sxs-lookup"><span data-stu-id="c57fc-153">The UrlHelper IsLocalUrl() method actually just calling into a method in System.Web.WebPages, as this validation is also used by ASP.NET Web Pages applications.</span></span>

<span data-ttu-id="c57fc-154">**Výpis 3 – metoda IsLocalUrl () z ASP.NET MVC 3 UrlHelper `class`**</span><span class="sxs-lookup"><span data-stu-id="c57fc-154">**Listing 3 – The IsLocalUrl() method from the ASP.NET MVC 3 UrlHelper `class`**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample3.cs)]

<span data-ttu-id="c57fc-155">Metoda IsUrlLocalToHost obsahuje skutečnou logiku ověřování, jak je uvedeno v seznamu 4.</span><span class="sxs-lookup"><span data-stu-id="c57fc-155">The IsUrlLocalToHost method contains the actual validation logic, as shown in Listing 4.</span></span>

<span data-ttu-id="c57fc-156">**Výpis 4 – IsUrlLocalToHost () metody z třídy System. Web. webpages RequestExtensions**</span><span class="sxs-lookup"><span data-stu-id="c57fc-156">**Listing 4 – IsUrlLocalToHost() method from the System.Web.WebPages RequestExtensions class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample4.cs)]

<span data-ttu-id="c57fc-157">V naší aplikaci ASP.NET MVC 1,0 nebo 2 přidáme do AccountController metodu IsLocalUrl (), ale doporučujeme ji přidat do samostatné pomocné třídy, pokud je to možné.</span><span class="sxs-lookup"><span data-stu-id="c57fc-157">In our ASP.NET MVC 1.0 or 2 application, we'll add a IsLocalUrl() method to the AccountController, but you're encouraged to add it to a separate helper class if possible.</span></span> <span data-ttu-id="c57fc-158">Provedeme dvě malé změny ve verzi ASP.NET MVC 3 IsLocalUrl () tak, aby fungovaly v rámci AccountController.</span><span class="sxs-lookup"><span data-stu-id="c57fc-158">We will make two small changes to the ASP.NET MVC 3 version of IsLocalUrl() so that it will work inside the AccountController.</span></span> <span data-ttu-id="c57fc-159">Nejprve ho z veřejné metody změní na soukromou metodu, protože veřejné metody v řadičích jsou přístupné jako akce kontroleru.</span><span class="sxs-lookup"><span data-stu-id="c57fc-159">First, we'll change it from a public method to a private method, since public methods in controllers can be accessed as controller actions.</span></span> <span data-ttu-id="c57fc-160">Za druhé změníme hovor, který zkontroluje hostitele adresy URL s hostitelem aplikace.</span><span class="sxs-lookup"><span data-stu-id="c57fc-160">Second, we'll modify the call that checks the URL host against the application host.</span></span> <span data-ttu-id="c57fc-161">Toto volání dělá použití místního pole Třída requestContext ve třídě UrlHelper.</span><span class="sxs-lookup"><span data-stu-id="c57fc-161">That call makes use of a local RequestContext field in the UrlHelper class.</span></span> <span data-ttu-id="c57fc-162">Místo použití tohoto. Třída requestContext. HttpContext. Request. URL. Host, použijeme to. Request. URL. Host.</span><span class="sxs-lookup"><span data-stu-id="c57fc-162">Instead of using this.RequestContext.HttpContext.Request.Url.Host, we will use this.Request.Url.Host.</span></span> <span data-ttu-id="c57fc-163">Následující kód ukazuje upravenou metodu IsLocalUrl () pro použití s třídou Controller v aplikacích ASP.NET MVC 1,0 a 2.</span><span class="sxs-lookup"><span data-stu-id="c57fc-163">The following code shows the modified IsLocalUrl() method for use with a controller class in ASP.NET MVC 1.0 and 2 applications.</span></span>

<span data-ttu-id="c57fc-164">**Výpis 5 – IsLocalUrl () metody, která je upravena pro použití s třídou kontroleru MVC**</span><span class="sxs-lookup"><span data-stu-id="c57fc-164">**Listing 5 – IsLocalUrl() method, which is modified for use with an MVC Controller class**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample5.cs)]

<span data-ttu-id="c57fc-165">Teď, když je na místě metoda IsLocalUrl (), můžeme ji zavolat z naší akce přihlášení k ověření parametru returnUrl, jak je znázorněno v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="c57fc-165">Now that the IsLocalUrl() method is in place, we can call it from our LogOn action to validate the returnUrl parameter, as shown in the following code.</span></span>

<span data-ttu-id="c57fc-166">**Výpis 6 – aktualizovaná metoda přihlašování, která ověřuje parametr returnUrl**</span><span class="sxs-lookup"><span data-stu-id="c57fc-166">**Listing 6 – Updated LogOn method which validates the returnUrl parameter**</span></span>

[!code-csharp[Main](preventing-open-redirection-attacks/samples/sample6.cs)]

<span data-ttu-id="c57fc-167">Nyní můžeme otestovat útok na otevřené přesměrování tím, že se pokusíte přihlásit pomocí externí návratové adresy URL.</span><span class="sxs-lookup"><span data-stu-id="c57fc-167">Now we can test an open redirection attack by attempting to log in using an external return URL.</span></span> <span data-ttu-id="c57fc-168">Pojďme použít/Account/LogOn? ReturnUrl = znovu<http://www.bing.com/>.</span><span class="sxs-lookup"><span data-stu-id="c57fc-168">Let's use /Account/LogOn?ReturnUrl=<http://www.bing.com/> again.</span></span>

[![](preventing-open-redirection-attacks/_static/image8.png)](preventing-open-redirection-attacks/_static/image7.png)

<span data-ttu-id="c57fc-169">**Obrázek 04**: testování aktualizované akce přihlášení</span><span class="sxs-lookup"><span data-stu-id="c57fc-169">**Figure 04**: Testing the updated LogOn Action</span></span>

<span data-ttu-id="c57fc-170">Po úspěšném přihlášení se přesměruje na akci řadiče pro Home/index, nikoli na externí adresu URL.</span><span class="sxs-lookup"><span data-stu-id="c57fc-170">After successfully logging in, we are redirected to the Home/Index Controller action rather than the external URL.</span></span>

[![](preventing-open-redirection-attacks/_static/image10.png)](preventing-open-redirection-attacks/_static/image9.png)

<span data-ttu-id="c57fc-171">**Obrázek 05**: útok otevřeného přesměrování byl nepřipraven</span><span class="sxs-lookup"><span data-stu-id="c57fc-171">**Figure 05**: Open Redirection attack defeated</span></span>

## <a name="summary"></a><span data-ttu-id="c57fc-172">Souhrn</span><span class="sxs-lookup"><span data-stu-id="c57fc-172">Summary</span></span>

<span data-ttu-id="c57fc-173">V případě, že jsou adresy URL přesměrování předány jako parametry v adrese URL aplikace, může dojít k útokům na otevřené přesměrování.</span><span class="sxs-lookup"><span data-stu-id="c57fc-173">Open redirection attacks can occur when redirection URLs are passed as parameters in the URL for an application.</span></span> <span data-ttu-id="c57fc-174">Šablona ASP.NET MVC 3 obsahuje kód pro ochranu před útoky na otevřené přesměrování.</span><span class="sxs-lookup"><span data-stu-id="c57fc-174">The ASP.NET MVC 3 template includes code to protect against open redirection attacks.</span></span> <span data-ttu-id="c57fc-175">Tento kód můžete přidat s určitou úpravou pro ASP.NET MVC 1,0 a 2 aplikace.</span><span class="sxs-lookup"><span data-stu-id="c57fc-175">You can add this code with some modification to ASP.NET MVC 1.0 and 2 applications.</span></span> <span data-ttu-id="c57fc-176">Pokud chcete chránit před útoky typu Open, pokud se přihlašujete do aplikací ASP.NET 1,0 a 2, přidejte metodu IsLocalUrl () a v akci přihlášení ověřte parametr returnUrl.</span><span class="sxs-lookup"><span data-stu-id="c57fc-176">To protect against open redirection attacks when logging into ASP.NET 1.0 and 2 applications, add a IsLocalUrl() method and validate the returnUrl parameter in the LogOn action.</span></span>
