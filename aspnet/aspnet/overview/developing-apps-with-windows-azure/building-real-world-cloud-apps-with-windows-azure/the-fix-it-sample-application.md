---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
title: 'Dodatek: Ukázková aplikace Fix It (vytváření cloudových aplikací v reálném světě s Azure) | Dokumenty společnosti Microsoft'
author: MikeWasson
description: Cloudová kniha Building Real World S Azure vychází z prezentace vyvinuté Scottem Guthriem. Vysvětluje to 13 vzorů a postupů, které může...
ms.author: riande
ms.date: 06/12/2014
ms.assetid: 1bc333c5-f096-4ea7-b170-779accc21c1a
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/the-fix-it-sample-application
msc.type: authoredcontent
ms.openlocfilehash: 896196bdb6a6b0d12a6c798ead510e37dd38a9fc
ms.sourcegitcommit: ce28244209db8615bc9bdd576a2e2c88174d318d
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/06/2020
ms.locfileid: "80675990"
---
# <a name="appendix-the-fix-it-sample-application-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="f24f2-104">Dodatek: Ukázková aplikace Fix It (vytváření cloudových aplikací v reálném světě s Azure)</span><span class="sxs-lookup"><span data-stu-id="f24f2-104">Appendix: The Fix It Sample Application (Building Real-World Cloud Apps with Azure)</span></span>

<span data-ttu-id="f24f2-105">od [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://twitter.com/RickAndMSFT), Tom [Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="f24f2-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://twitter.com/RickAndMSFT), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="f24f2-106">Stáhněte si projekt Fix It</span><span class="sxs-lookup"><span data-stu-id="f24f2-106">Download The Fix It Project</span></span>](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)

> <span data-ttu-id="f24f2-107">**Cloudová kniha Building Real World S Azure** vychází z prezentace vyvinuté Scottem Guthriem.</span><span class="sxs-lookup"><span data-stu-id="f24f2-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="f24f2-108">Vysvětluje 13 vzorů a postupů, které vám mohou pomoci úspěšně vyvíjet webové aplikace pro cloud.</span><span class="sxs-lookup"><span data-stu-id="f24f2-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="f24f2-109">Informace o e-knize najdete [v první kapitole](introduction.md).</span><span class="sxs-lookup"><span data-stu-id="f24f2-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>

<span data-ttu-id="f24f2-110">Tento dodatek k elektronické knize Building Real World Cloud Apps s azure e-book obsahuje následující části, které poskytují další informace o ukázkové aplikaci Fix It, kterou si můžete stáhnout:</span><span class="sxs-lookup"><span data-stu-id="f24f2-110">This appendix to the Building Real World Cloud Apps with Azure e-book contains the following sections that provide additional information about the Fix It sample application that you can download:</span></span>

- [<span data-ttu-id="f24f2-111">Známé problémy</span><span class="sxs-lookup"><span data-stu-id="f24f2-111">Known issues</span></span>](#knownissues)
- [<span data-ttu-id="f24f2-112">Osvědčené postupy</span><span class="sxs-lookup"><span data-stu-id="f24f2-112">Best practices</span></span>](#bestpractices)
- [<span data-ttu-id="f24f2-113">Jak spustit aplikaci z Visual Studia v místním počítači</span><span class="sxs-lookup"><span data-stu-id="f24f2-113">How to run the app from Visual Studio on your local computer</span></span>](#run-in-vs)
- [<span data-ttu-id="f24f2-114">Jak nasadit základní aplikaci do webových aplikací Služby aplikací Azure App Service pomocí skriptů Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="f24f2-114">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>](#deploybase)
- [<span data-ttu-id="f24f2-115">Poradce při potížích se skripty prostředí Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="f24f2-115">Troubleshooting the Windows PowerShell scripts</span></span>](#troubleshooting)
- [<span data-ttu-id="f24f2-116">Jak nasadit aplikaci se zpracováním fronty do webových aplikací Služby App Service Azure a cloudové služby Azure</span><span class="sxs-lookup"><span data-stu-id="f24f2-116">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>](#deployqueues)

<a id="knownissues"></a>
## <a name="known-issues"></a><span data-ttu-id="f24f2-117">Známé problémy</span><span class="sxs-lookup"><span data-stu-id="f24f2-117">Known issues</span></span>

<span data-ttu-id="f24f2-118">Aplikace Fix It byla původně vyvinuta s cílem co nejjednodušeji ilustrovat některé vzory prezentované v této e-knize.</span><span class="sxs-lookup"><span data-stu-id="f24f2-118">The Fix It app was originally developed in order to illustrate as simply as possible some of the patterns presented in this e-book.</span></span> <span data-ttu-id="f24f2-119">Nicméně, protože e-kniha je o budování reálných aplikací, podrobili jsme kód Fix It procesu kontroly a testování podobnému tomu, co bychom udělali pro uvolněný software.</span><span class="sxs-lookup"><span data-stu-id="f24f2-119">However, since the e-book is about building real-world apps, we subjected the Fix It code to a review and testing process similar to what we'd do for released software.</span></span> <span data-ttu-id="f24f2-120">Našli jsme řadu problémů, a stejně jako u všech reálných aplikací, některé z nich jsme opravili a některé z nich jsme odložili na pozdější verzi.</span><span class="sxs-lookup"><span data-stu-id="f24f2-120">We found a number of issues, and as with any real-world application, some of them we fixed and some of them we deferred to a later release.</span></span>

<span data-ttu-id="f24f2-121">Následující seznam obsahuje problémy, které by měly být řešeny v produkční aplikaci, ale z toho či onoho důvodu jsme se rozhodli neřešit v počáteční verzi ukázkové aplikace Fix It.</span><span class="sxs-lookup"><span data-stu-id="f24f2-121">The following list includes issues that should be addressed in a production application, but for one reason or another we decided not to address in the initial release of the Fix It sample application.</span></span>

### <a name="security"></a><span data-ttu-id="f24f2-122">Zabezpečení</span><span class="sxs-lookup"><span data-stu-id="f24f2-122">Security</span></span>

- <span data-ttu-id="f24f2-123">Ujistěte se, že nemůžete přiřadit úkol neexistujícímu vlastníkovi.</span><span class="sxs-lookup"><span data-stu-id="f24f2-123">Ensure that you can't assign a task to a non-existent owner.</span></span>
- <span data-ttu-id="f24f2-124">Ujistěte se, že můžete zobrazit a upravit pouze úkoly, které jste vytvořili nebo které jsou vám přiřazeny.</span><span class="sxs-lookup"><span data-stu-id="f24f2-124">Ensure that you can only view and modify tasks that you created or are assigned to you.</span></span>
- <span data-ttu-id="f24f2-125">Pro přihlašovací stránky a ověřovací soubory cookie použijte protokol HTTPS.</span><span class="sxs-lookup"><span data-stu-id="f24f2-125">Use HTTPS for sign-in pages and authentication cookies.</span></span>
- <span data-ttu-id="f24f2-126">Zadejte časový limit pro ověřovací soubory cookie.</span><span class="sxs-lookup"><span data-stu-id="f24f2-126">Specify a time limit for authentication cookies.</span></span>

### <a name="input-validation"></a><span data-ttu-id="f24f2-127">Ověření vstupu</span><span class="sxs-lookup"><span data-stu-id="f24f2-127">Input validation</span></span>

<span data-ttu-id="f24f2-128">Obecně platí, že produkční aplikace by provést více ověření vstupu než fix it aplikace.</span><span class="sxs-lookup"><span data-stu-id="f24f2-128">In general, a production app would do more input validation than the Fix It app.</span></span> <span data-ttu-id="f24f2-129">Například velikost obrázku / velikost souboru obrázku povolená pro nahrávání by měla být omezena.</span><span class="sxs-lookup"><span data-stu-id="f24f2-129">For example, the image size / image file size allowed for upload should be limited.</span></span>

### <a name="administrator-functionality"></a><span data-ttu-id="f24f2-130">Funkce správce</span><span class="sxs-lookup"><span data-stu-id="f24f2-130">Administrator functionality</span></span>

<span data-ttu-id="f24f2-131">Správce by měl mít možnost změnit vlastnictví existujících úkolů.</span><span class="sxs-lookup"><span data-stu-id="f24f2-131">An administrator should be able to change ownership on existing tasks.</span></span> <span data-ttu-id="f24f2-132">Tvůrce úkolu může například opustit společnost a ponechat nikomu oprávnění k údržbě úkolu, pokud není povolen přístup správce.</span><span class="sxs-lookup"><span data-stu-id="f24f2-132">For example, the creator of a task might leave the company, leaving no one with authority to maintain the task unless administrative access is enabled.</span></span>

### <a name="queue-message-processing"></a><span data-ttu-id="f24f2-133">Zpracování zpráv fronty</span><span class="sxs-lookup"><span data-stu-id="f24f2-133">Queue message processing</span></span>

<span data-ttu-id="f24f2-134">Zpracování zpráv fronty v aplikaci Fix It bylo navrženo tak, aby bylo jednoduché, aby ilustrovalo pracovní vzor zaměřený na frontu s minimálním množstvím kódu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-134">Queue message processing in the Fix It app was designed to be simple in order to illustrate the queue-centric work pattern with a minimum amount of code.</span></span> <span data-ttu-id="f24f2-135">Tento jednoduchý kód by nebyl adekvátní pro skutečnou produkční aplikaci.</span><span class="sxs-lookup"><span data-stu-id="f24f2-135">This simple code would not be adequate for an actual production application.</span></span>

- <span data-ttu-id="f24f2-136">Kód nezaručuje, že každá zpráva fronty bude zpracována maximálně jednou.</span><span class="sxs-lookup"><span data-stu-id="f24f2-136">The code does not guarantee that each queue message will be processed at most once.</span></span> <span data-ttu-id="f24f2-137">Když se zobrazí zpráva z fronty, je časový čas, během kterého je zpráva neviditelná pro ostatní posluchače fronty.</span><span class="sxs-lookup"><span data-stu-id="f24f2-137">When you get a message from the queue, there is a timeout period, during which the message is invisible to other queue listeners.</span></span> <span data-ttu-id="f24f2-138">Pokud vyprší časový limit před odstraněním zprávy, zpráva se znovu zobrazí.</span><span class="sxs-lookup"><span data-stu-id="f24f2-138">If the timeout expires before the message is deleted, the message becomes visible again.</span></span> <span data-ttu-id="f24f2-139">Proto pokud instance role pracovního procesu stráví dlouhou dobu zpracování zprávy, je teoreticky možné, aby se stejná zpráva zpracovala dvakrát, což má za následek duplicitní úlohu v databázi.</span><span class="sxs-lookup"><span data-stu-id="f24f2-139">Therefore, if a worker role instance spends a long time processing a message, it is theoretically possible for the same message to get processed twice, resulting in a duplicate task in the database.</span></span> <span data-ttu-id="f24f2-140">Další informace o tomto problému najdete [v tématu použití front úložiště Azure](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span><span class="sxs-lookup"><span data-stu-id="f24f2-140">For more information about this issue, see [Using Azure Storage Queues](https://msdn.microsoft.com/library/ff803365.aspx#sec7).</span></span>
- <span data-ttu-id="f24f2-141">Logika dotazování fronty může být nákladově efektivnější, a to dávkou načítání zpráv.</span><span class="sxs-lookup"><span data-stu-id="f24f2-141">The queue polling logic could be more cost-effective, by batching message retrieval.</span></span> <span data-ttu-id="f24f2-142">Pokaždé, když zavoláte [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), je transakční náklady.</span><span class="sxs-lookup"><span data-stu-id="f24f2-142">Every time you call [CloudQueue.GetMessageAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessageasync.aspx), there is a transaction cost.</span></span> <span data-ttu-id="f24f2-143">Místo toho můžete volat [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (všimněte si množného čísla 's'), který získá více zpráv v jedné transakci.</span><span class="sxs-lookup"><span data-stu-id="f24f2-143">Instead, you can call [CloudQueue.GetMessagesAsync](https://msdn.microsoft.com/library/microsoft.windowsazure.storage.queue.cloudqueue.getmessagesasync.aspx) (note the plural 's'), which gets multiple messages in a single transaction.</span></span> <span data-ttu-id="f24f2-144">Transakční náklady na fronty úložiště Azure jsou velmi nízké, takže dopad na náklady není ve většině scénářů podstatný.</span><span class="sxs-lookup"><span data-stu-id="f24f2-144">The transaction costs for Azure Storage Queues are very low, so the impact on costs is not substantial in most scenarios.</span></span>
- <span data-ttu-id="f24f2-145">Těsná smyčka ve frontě kódu zpracování zpráv způsobí spřažení procesoru, který nevyužívá vícejádrové virtuální počítače efektivně.</span><span class="sxs-lookup"><span data-stu-id="f24f2-145">The tight loop in the queue message-processing code causes CPU affinity, which does not utilize multi-core VMs efficiently.</span></span> <span data-ttu-id="f24f2-146">Lepší návrh by použít paralelismus úlohy spustit několik asynchronních úloh paralelně.</span><span class="sxs-lookup"><span data-stu-id="f24f2-146">A better design would use task parallelism to run several async tasks in parallel.</span></span>
- <span data-ttu-id="f24f2-147">Zpracování zpráv fronty má pouze základní zpracování výjimek.</span><span class="sxs-lookup"><span data-stu-id="f24f2-147">Queue message-processing has only rudimentary exception handling.</span></span> <span data-ttu-id="f24f2-148">Například kód nezpracovává [poškozená zprávy](https://msdn.microsoft.com/library/ms789028.aspx).</span><span class="sxs-lookup"><span data-stu-id="f24f2-148">For example, the code doesn't handle [poison messages](https://msdn.microsoft.com/library/ms789028.aspx).</span></span> <span data-ttu-id="f24f2-149">(Pokud zpracování zprávy způsobí výjimku, budete muset protokolovat chybu a odstranit zprávu, nebo role pracovního procesu se pokusí zpracovat znovu a smyčka bude pokračovat po neomezenou dobu.)</span><span class="sxs-lookup"><span data-stu-id="f24f2-149">(When message processing causes an exception, you have to log the error and delete the message, or the worker role will try to process it again, and the loop will continue indefinitely.)</span></span>

### <a name="sql-queries-are-unbounded"></a><span data-ttu-id="f24f2-150">Dotazy SQL jsou neohraničené.</span><span class="sxs-lookup"><span data-stu-id="f24f2-150">SQL queries are unbounded</span></span>

<span data-ttu-id="f24f2-151">Aktuální fix It kód umístí žádné omezení na kolik řádků dotazy pro index stránky může vrátit.</span><span class="sxs-lookup"><span data-stu-id="f24f2-151">Current Fix It code places no limit on how many rows the queries for Index pages might return.</span></span> <span data-ttu-id="f24f2-152">Pokud je do databáze zadán velký objem úkolů, může velikost přijatých výsledných seznamů způsobit problémy s výkonem.</span><span class="sxs-lookup"><span data-stu-id="f24f2-152">If a large volume of tasks is entered into the database, the size of the resulting lists received could cause performance issues.</span></span> <span data-ttu-id="f24f2-153">Řešením je implementovat stránkování.</span><span class="sxs-lookup"><span data-stu-id="f24f2-153">The solution is to implement paging.</span></span> <span data-ttu-id="f24f2-154">Příklad najdete v tématu [Řazení, filtrování a stránkování pomocí entity frameworku v ASP.NET aplikace MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="f24f2-154">For an example, see [Sorting, Filtering, and Paging with the Entity Framework in an ASP.NET MVC Application](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/sorting-filtering-and-paging-with-the-entity-framework-in-an-asp-net-mvc-application.md).</span></span>

### <a name="view-models-recommended"></a><span data-ttu-id="f24f2-155">Zobrazit doporučené modely</span><span class="sxs-lookup"><span data-stu-id="f24f2-155">View models recommended</span></span>

<span data-ttu-id="f24f2-156">Aplikace Fix It používá třídu entity FixItTask k předání informací mezi řadičem a zobrazením.</span><span class="sxs-lookup"><span data-stu-id="f24f2-156">The Fix It app uses the FixItTask entity class to pass information between the controller and the view.</span></span> <span data-ttu-id="f24f2-157">Osvědčeným postupem je použití modelů zobrazení.</span><span class="sxs-lookup"><span data-stu-id="f24f2-157">A best practice is to use view models.</span></span> <span data-ttu-id="f24f2-158">Model domény (např. třída entity FixItTask) je navržen podle toho, co je potřeba pro trvalost dat, zatímco model zobrazení může být navržen pro prezentaci dat.</span><span class="sxs-lookup"><span data-stu-id="f24f2-158">The domain model (e.g., the FixItTask entity class) is designed around what is needed for data persistence, while a view model can be designed for data presentation.</span></span> <span data-ttu-id="f24f2-159">Další informace naleznete [v tématu 12 ASP.NET MVC Best Practices](https://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span><span class="sxs-lookup"><span data-stu-id="f24f2-159">For more information, see [12 ASP.NET MVC Best Practices](https://codeclimber.net.nz/archive/2009/10/27/12-asp.net-mvc-best-practices.aspx).</span></span>

### <a name="secure-image-blob-recommended"></a><span data-ttu-id="f24f2-160">Doporučujeme zabezpečený objekt blob obrázku</span><span class="sxs-lookup"><span data-stu-id="f24f2-160">Secure image blob recommended</span></span>

<span data-ttu-id="f24f2-161">Aplikace Fix It ukládá nahrané obrázky jako veřejné, což znamená, že každý, kdo najde adresu URL, má přístup k obrázkům.</span><span class="sxs-lookup"><span data-stu-id="f24f2-161">The Fix It app stores uploaded images as public, meaning that anyone who finds the URL can access the images.</span></span> <span data-ttu-id="f24f2-162">Obrázky by mohly být zabezpečeny místo veřejné.</span><span class="sxs-lookup"><span data-stu-id="f24f2-162">The images could be secured instead of public.</span></span>

### <a name="no-powershell-automation-scripts-for-queues"></a><span data-ttu-id="f24f2-163">Žádné skripty automatizace prostředí PowerShell pro fronty</span><span class="sxs-lookup"><span data-stu-id="f24f2-163">No PowerShell automation scripts for queues</span></span>

<span data-ttu-id="f24f2-164">Ukázkové skripty automatizace Prostředí PowerShell byly napsány jenom pro základní verzi fix it, která běží výhradně ve webových aplikacích Služby Azure App Service.</span><span class="sxs-lookup"><span data-stu-id="f24f2-164">Sample PowerShell automation scripts were written only for the base version of Fix It that runs entirely in Azure App Service Web Apps.</span></span> <span data-ttu-id="f24f2-165">Nezadali jsme skripty pro nastavení a nasazení do webové aplikace a prostředí cloudové služby, které jsou nutné pro zpracování fronty.</span><span class="sxs-lookup"><span data-stu-id="f24f2-165">We haven't provided scripts for setting up and deploying to the web app plus Cloud Service environment required for queue processing.</span></span>

### <a name="special-handling-for-html-codes-in-user-input"></a><span data-ttu-id="f24f2-166">Speciální zpracování kódů HTML v uživatelském vstupu</span><span class="sxs-lookup"><span data-stu-id="f24f2-166">Special handling for HTML codes in user input</span></span>

<span data-ttu-id="f24f2-167">ASP.NET automaticky zabraňuje mnoha způsobům, jakými se uživatelé se zlými úmysly mohou pokoušet o útoky skriptování mezi weby zadáním skriptu do textových polí pro vstup uživatele.</span><span class="sxs-lookup"><span data-stu-id="f24f2-167">ASP.NET automatically prevents many ways in which malicious users might attempt cross-site scripting attacks by entering script in user input text boxes.</span></span> <span data-ttu-id="f24f2-168">A pomocník MVC `DisplayFor` slouží k zobrazení názvy úkolů a poznámky automaticky HTML-kóduje hodnoty, které odešle do prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="f24f2-168">And the MVC `DisplayFor` helper used to display task titles and notes automatically HTML-encodes values that it sends to the browser.</span></span> <span data-ttu-id="f24f2-169">Ale v produkční aplikaci možná budete chtít přijmout další opatření.</span><span class="sxs-lookup"><span data-stu-id="f24f2-169">But in a production app you might want to take additional measures.</span></span> <span data-ttu-id="f24f2-170">Další informace naleznete [v tématu Request Validation in ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span><span class="sxs-lookup"><span data-stu-id="f24f2-170">For more information, see [Request Validation in ASP.NET](https://msdn.microsoft.com/library/hh882339.aspx).</span></span>

<a id="bestpractices"></a>
## <a name="best-practices"></a><span data-ttu-id="f24f2-171">Osvědčené postupy</span><span class="sxs-lookup"><span data-stu-id="f24f2-171">Best practices</span></span>

<span data-ttu-id="f24f2-172">Následují některé problémy, které byly opraveny po zjištění v kontrole kódu a testování původní verze aplikace Fix It.</span><span class="sxs-lookup"><span data-stu-id="f24f2-172">Following are some issues that were fixed after being discovered in code review and testing of the original version of the Fix It app.</span></span> <span data-ttu-id="f24f2-173">Některé byly způsobeny tím, že původní kodér si nebyl vědom konkrétního osvědčeného postupu, některé jednoduše proto, že kód byl napsán rychle a nebyl určen pro uvolněný software.</span><span class="sxs-lookup"><span data-stu-id="f24f2-173">Some were caused by the original coder not being aware of a particular best practice, some simply because the code was written quickly and wasn't intended for released software.</span></span> <span data-ttu-id="f24f2-174">Uvádíme zde problémy v případě, že je něco, co jsme se naučili z této recenze a testování, které by mohly být užitečné pro ostatní, kteří také vyvíjejí webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="f24f2-174">We're listing the issues here in case there's something we learned from this review and testing that might be helpful to others who are also developing web apps.</span></span>

### <a name="dispose-the-database-repository"></a><span data-ttu-id="f24f2-175">Likvidace úložiště databáze</span><span class="sxs-lookup"><span data-stu-id="f24f2-175">Dispose the database repository</span></span>

<span data-ttu-id="f24f2-176">Třída `FixItTaskRepository` musí dispose entity `DbContext` framework instance.</span><span class="sxs-lookup"><span data-stu-id="f24f2-176">The `FixItTaskRepository` class must dispose the Entity Framework `DbContext` instance.</span></span> <span data-ttu-id="f24f2-177">Udělali jsme to `IDisposable` implementací ve `FixItTaskRepository` třídě:</span><span class="sxs-lookup"><span data-stu-id="f24f2-177">We did this by implementing `IDisposable` in the `FixItTaskRepository` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample1.cs)]

<span data-ttu-id="f24f2-178">Všimněte si, že AutoFac automaticky vykáže `FixItTaskRepository` instanci, takže ji nemusíme explicitně vyřadit.</span><span class="sxs-lookup"><span data-stu-id="f24f2-178">Note that AutoFac will automatically dispose the `FixItTaskRepository` instance, so we don't need to explicitly dispose it.</span></span>

<span data-ttu-id="f24f2-179">Další možností je `DbContext` odebrat `FixItTaskRepository`členovou proměnnou `DbContext` z a místo toho vytvořit `using` místní proměnnou v rámci každé metody úložiště uvnitř příkazu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-179">Another option is to remove the `DbContext` member variable from `FixItTaskRepository`, and instead create a local `DbContext` variable within each repository method, inside a `using` statement.</span></span> <span data-ttu-id="f24f2-180">Příklad:</span><span class="sxs-lookup"><span data-stu-id="f24f2-180">For example:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample2.cs)]

### <a name="register-singletons-as-such-with-di"></a><span data-ttu-id="f24f2-181">Registrovat singletons jako takové s DI</span><span class="sxs-lookup"><span data-stu-id="f24f2-181">Register singletons as such with DI</span></span>

<span data-ttu-id="f24f2-182">Vzhledem k tomu, `PhotoService` `Logger` že je potřeba pouze jedna instance třídy a třídy, tyto třídy by měly být [registrovány jako jednotlivé instance pro vkládání závislostí](https://code.google.com/p/autofac/wiki/InstanceScope) v *DependenciesConfig.cs*:</span><span class="sxs-lookup"><span data-stu-id="f24f2-182">Since only one instance of the `PhotoService` class and `Logger` class is needed, these classes should be [registered as single instances for dependency injection](https://code.google.com/p/autofac/wiki/InstanceScope) in *DependenciesConfig.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample3.cs?highlight=1,3)]

### <a name="security-dont-show-error-details-to-users"></a><span data-ttu-id="f24f2-183">Zabezpečení: Nezobrazovat uživatelům podrobnosti o chybě</span><span class="sxs-lookup"><span data-stu-id="f24f2-183">Security: Don't show error details to users</span></span>

<span data-ttu-id="f24f2-184">Původní aplikace Fix It neměla obecnou chybovou stránku a nechala všechny výjimky vybřednout do ui, takže některé výjimky, jako jsou chyby připojení k databázi, by mohly vést k zobrazení úplného trasování zásobníku do prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="f24f2-184">The original Fix It app didn't have a generic error page and just let all exceptions bubble up to the UI, so some exceptions such as database connection errors could result in a full stack trace being displayed to the browser.</span></span> <span data-ttu-id="f24f2-185">Podrobné informace o chybách mohou někdy usnadnit útoky uživatelů se zlými úmysly.</span><span class="sxs-lookup"><span data-stu-id="f24f2-185">Detailed error information can sometimes facilitate attacks by malicious users.</span></span> <span data-ttu-id="f24f2-186">Řešením je protokolovat podrobnosti o výjimce a zobrazit uživateli chybovou stránku, která neobsahuje podrobnosti o chybě.</span><span class="sxs-lookup"><span data-stu-id="f24f2-186">The solution is to log the exception details and display an error page to the user that doesn't include error details.</span></span> <span data-ttu-id="f24f2-187">Aplikace Fix It se již přihlašovala a `<customErrors mode=On>` aby bylo možné zobrazit chybovou stránku, přidali jsme ji do souboru Web.config.</span><span class="sxs-lookup"><span data-stu-id="f24f2-187">The Fix It app was already logging, and in order to display an error page, we added `<customErrors mode=On>` in the Web.config file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample4.xml?highlight=2)]

<span data-ttu-id="f24f2-188">Ve výchozím nastavení je *zobrazení\Shared\Error.cshtml* zobrazena u chyb.</span><span class="sxs-lookup"><span data-stu-id="f24f2-188">By default this causes *Views\Shared\Error.cshtml* to be displayed for errors.</span></span> <span data-ttu-id="f24f2-189">Můžete přizpůsobit *Error.cshtml* nebo vytvořit vlastní zobrazení `defaultRedirect` chybové stránky a přidat atribut.</span><span class="sxs-lookup"><span data-stu-id="f24f2-189">You can customize *Error.cshtml* or create your own error page view and add a `defaultRedirect` attribute.</span></span> <span data-ttu-id="f24f2-190">Můžete také zadat různé chybové stránky pro konkrétní chyby.</span><span class="sxs-lookup"><span data-stu-id="f24f2-190">You can also specify different error pages for specific errors.</span></span>

### <a name="security-only-allow-a-task-to-be-edited-by-its-creator"></a><span data-ttu-id="f24f2-191">Zabezpečení: povolit pouze úkol, který má být editován jeho tvůrce</span><span class="sxs-lookup"><span data-stu-id="f24f2-191">Security: only allow a task to be edited by its creator</span></span>

<span data-ttu-id="f24f2-192">Stránka Index řídicího panelu zobrazuje pouze úkoly vytvořené přihlášeným uživatelem, ale uživatel se zlými úmysly může vytvořit adresu URL s ID pro úlohu jiného uživatele.</span><span class="sxs-lookup"><span data-stu-id="f24f2-192">The Dashboard Index page only shows tasks created by the logged-on user, but a malicious user could create a URL with an ID to another user's task.</span></span> <span data-ttu-id="f24f2-193">Přidali jsme kód v *DashboardController.cs* vrátit 404 v tomto případě:</span><span class="sxs-lookup"><span data-stu-id="f24f2-193">We added code in *DashboardController.cs* to return a 404 in that case:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample5.cs?highlight=9-14,24-29)]

### <a name="dont-swallow-exceptions"></a><span data-ttu-id="f24f2-194">Nepolykejte výjimky</span><span class="sxs-lookup"><span data-stu-id="f24f2-194">Don't swallow exceptions</span></span>

<span data-ttu-id="f24f2-195">Původní fix It aplikace právě vrátil nulu po protokolování výjimku, která vyplývá z dotazu SQL:</span><span class="sxs-lookup"><span data-stu-id="f24f2-195">The original Fix It app just returned null after logging an exception that resulted from a SQL query:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample6.cs?highlight=4)]

<span data-ttu-id="f24f2-196">To by to vypadat na uživatele, jako by dotaz proběhl úspěšně, ale prostě nevrátil žádné řádky.</span><span class="sxs-lookup"><span data-stu-id="f24f2-196">This would make it look to the user as if the query succeeded but just didn't return any rows.</span></span> <span data-ttu-id="f24f2-197">Řešení je znovu vyvolat výjimku po zachycení a protokolování:</span><span class="sxs-lookup"><span data-stu-id="f24f2-197">Solution is to re-throw the exception after catching and logging:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample7.cs)]

### <a name="catch-all-exceptions-in-worker-roles"></a><span data-ttu-id="f24f2-198">Zachytit všechny výjimky v rolích pracovního procesu</span><span class="sxs-lookup"><span data-stu-id="f24f2-198">Catch all exceptions in worker roles</span></span>

<span data-ttu-id="f24f2-199">Všechny neošetřené výjimky v roli pracovního procesu způsobí, že virtuální ho disponizuje, takže chcete zabalit vše, co děláte v bloku try-catch a zpracovat všechny výjimky.</span><span class="sxs-lookup"><span data-stu-id="f24f2-199">Any unhandled exceptions in a worker role will cause the VM to be recycled, so you want to wrap everything you do in a try-catch block and handle all exceptions.</span></span>

### <a name="specify-length-for-string-properties-in-entity-classes"></a><span data-ttu-id="f24f2-200">Určit délku pro vlastnosti řetězce ve třídách entit</span><span class="sxs-lookup"><span data-stu-id="f24f2-200">Specify length for string properties in entity classes</span></span>

<span data-ttu-id="f24f2-201">Aby bylo možné zobrazit jednoduchý kód, původní verze fix it aplikace nespecifikoval délky pro pole FixItTask entity a v důsledku toho byly definovány jako varchar(max) v databázi.</span><span class="sxs-lookup"><span data-stu-id="f24f2-201">In order to display simple code, the original version of the Fix It app didn't specify lengths for the fields of the FixItTask entity, and as a result they were defined as varchar(max) in the database.</span></span> <span data-ttu-id="f24f2-202">V důsledku toho by uI přijmout téměř jakékoli množství vstupů.</span><span class="sxs-lookup"><span data-stu-id="f24f2-202">As a result, the UI would accept almost any amount of input.</span></span> <span data-ttu-id="f24f2-203">Určení délek nastaví omezení, která platí pro vstup uživatele na webové stránce i velikost sloupce v databázi:</span><span class="sxs-lookup"><span data-stu-id="f24f2-203">Specifying lengths sets limits that apply both to user input in the web page and column size in the database:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample8.cs?highlight=4,7,10,12,14)]

### <a name="mark-private-members-as-readonly-when-they-arent-expected-to-change"></a><span data-ttu-id="f24f2-204">Označit soukromé členy jako jen pro čtení, pokud se neočekává jejich změna</span><span class="sxs-lookup"><span data-stu-id="f24f2-204">Mark private members as readonly when they aren't expected to change</span></span>

<span data-ttu-id="f24f2-205">Například ve `DashboardController` třídě `FixItTaskRepository` instance je vytvořena a neočekává se, že se změní, takže jsme ji [definovali](https://msdn.microsoft.com/library/acdd6hb7.aspx)jako jen pro čtení .</span><span class="sxs-lookup"><span data-stu-id="f24f2-205">For example, in the `DashboardController` class an instance of `FixItTaskRepository` is created and isn't expected to change, so we defined it as [readonly](https://msdn.microsoft.com/library/acdd6hb7.aspx).</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample9.cs?highlight=3)]

### <a name="use-listany-instead-of-listcount-gt-0"></a><span data-ttu-id="f24f2-206">Použijte seznam. Any() místo seznamu. Počet() &gt; 0</span><span class="sxs-lookup"><span data-stu-id="f24f2-206">Use list.Any() instead of list.Count() &gt; 0</span></span>

<span data-ttu-id="f24f2-207">Pokud vás zajímá jen to, zda jedna nebo více položek v seznamu odpovídá zadaným kritériím, použijte metodu [Any,](https://msdn.microsoft.com/library/bb534972.aspx) protože se vrátí, jakmile je nalezena položka odpovídající kritériím, zatímco `Count` metoda musí vždy iterovat každou položku.</span><span class="sxs-lookup"><span data-stu-id="f24f2-207">If you all you care about is whether one or more items in a list fit the specified criteria, use the [Any](https://msdn.microsoft.com/library/bb534972.aspx) method, because it returns as soon as an item fitting the criteria is found, whereas the `Count` method always has to iterate through every item.</span></span> <span data-ttu-id="f24f2-208">Soubor *Dashboard Index.cshtml* měl původně tento kód:</span><span class="sxs-lookup"><span data-stu-id="f24f2-208">The Dashboard *Index.cshtml* file originally had this code:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample10.cshtml)]

<span data-ttu-id="f24f2-209">Změnili jsme to na toto:</span><span class="sxs-lookup"><span data-stu-id="f24f2-209">We changed it to this:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample11.cshtml?highlight=1)]

### <a name="generate-urls-in-mvc-views-using-mvc-helpers"></a><span data-ttu-id="f24f2-210">Generování adres URL v zobrazeních MVC pomocí pomocníků MVC</span><span class="sxs-lookup"><span data-stu-id="f24f2-210">Generate URLs in MVC views using MVC helpers</span></span>

<span data-ttu-id="f24f2-211">U tlačítka **Vytvořit fix it** na domovské stránce aplikace Fix It pevně zakódovala kotevní prvek:</span><span class="sxs-lookup"><span data-stu-id="f24f2-211">For the **Create a Fix It** button on the home page, the Fix It app hard coded an anchor element:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample12.cshtml)]

<span data-ttu-id="f24f2-212">Pro zobrazení / akce odkazy, jako je tento, je lepší použít [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) HTML pomocník, například:</span><span class="sxs-lookup"><span data-stu-id="f24f2-212">For View/Action links like this it's better to use the [Url.Action](https://msdn.microsoft.com/library/system.web.mvc.urlhelper.action.aspx) HTML helper, for example:</span></span>

[!code-cshtml[Main](the-fix-it-sample-application/samples/sample13.cshtml)]

### <a name="use-taskdelay-instead-of-threadsleep-in-worker-role"></a><span data-ttu-id="f24f2-213">Použít Task.Delay místo Thread.Sleep v roli pracovního procesu</span><span class="sxs-lookup"><span data-stu-id="f24f2-213">Use Task.Delay instead of Thread.Sleep in worker role</span></span>

<span data-ttu-id="f24f2-214">Šablona nového `Thread.Sleep` projektu vloží do ukázkového kódu pro roli pracovního procesu, ale příčinou spánku vlákna může způsobit, že fond vláken vytvoří další nepotřebná vlákna.</span><span class="sxs-lookup"><span data-stu-id="f24f2-214">The new-project template puts `Thread.Sleep` in the sample code for a worker role, but causing the thread to sleep can cause the thread pool to spawn additional unnecessary threads.</span></span> <span data-ttu-id="f24f2-215">Můžete se tomu vyhnout pomocí [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) místo.</span><span class="sxs-lookup"><span data-stu-id="f24f2-215">You can avoid that by using [Task.Delay](https://msdn.microsoft.com/library/hh139096.aspx) instead.</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample14.cs?highlight=11)]

### <a name="avoid-async-void"></a><span data-ttu-id="f24f2-216">Vyhněte se asynchronní neplatné</span><span class="sxs-lookup"><span data-stu-id="f24f2-216">Avoid async void</span></span>

<span data-ttu-id="f24f2-217">Pokud asynchronní metoda není nutné vrátit hodnotu, `Task` vrátí `void`typ spíše než .</span><span class="sxs-lookup"><span data-stu-id="f24f2-217">If an async method doesn't need to return a value, return a `Task` type rather than `void`.</span></span>

<span data-ttu-id="f24f2-218">Tento příklad je `FixItQueueManager` z třídy:</span><span class="sxs-lookup"><span data-stu-id="f24f2-218">This example is from the `FixItQueueManager` class:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample15.cs)]

<span data-ttu-id="f24f2-219">Měli byste `async void` použít pouze pro obslužné rutiny událostí nejvyšší úrovně.</span><span class="sxs-lookup"><span data-stu-id="f24f2-219">You should use `async void` only for top-level event handlers.</span></span> <span data-ttu-id="f24f2-220">Pokud definujete metodu jako `async void`, volající nemůže **čekat** na metodu nebo zachytit žádné výjimky metoda vyvolá.</span><span class="sxs-lookup"><span data-stu-id="f24f2-220">If you define a method as `async void`, the caller cannot **await** the method or catch any exceptions the method throws.</span></span> <span data-ttu-id="f24f2-221">Další informace naleznete [v tématu Best Practices in Asynchronous Programming](https://msdn.microsoft.com/magazine/jj991977.aspx).</span><span class="sxs-lookup"><span data-stu-id="f24f2-221">For more information, see [Best Practices in Asynchronous Programming](https://msdn.microsoft.com/magazine/jj991977.aspx).</span></span>

### <a name="use-a-cancellation-token-to-break-from-worker-role-loop"></a><span data-ttu-id="f24f2-222">Použití tokenu zrušení k přerušení smyčky role pracovní ho diody</span><span class="sxs-lookup"><span data-stu-id="f24f2-222">Use a cancellation token to break from worker role loop</span></span>

<span data-ttu-id="f24f2-223">Metoda **Run** v roli pracovního procesu obvykle obsahuje nekonečnou smyčku.</span><span class="sxs-lookup"><span data-stu-id="f24f2-223">Typically, the **Run** method on a worker role contains an infinite loop.</span></span> <span data-ttu-id="f24f2-224">Když je role pracovního procesu zastavení, je volána metoda [RoleEntryPoint.OnStop.](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx)</span><span class="sxs-lookup"><span data-stu-id="f24f2-224">When the worker role is stopping, the [RoleEntryPoint.OnStop](https://msdn.microsoft.com/library/windowsazure/microsoft.windowsazure.serviceruntime.roleentrypoint.onstop.aspx) method is called.</span></span> <span data-ttu-id="f24f2-225">Tuto metodu byste měli použít ke zrušení práce, která se provádí uvnitř **Run** metody a řádně ukončit.</span><span class="sxs-lookup"><span data-stu-id="f24f2-225">You should use this method to cancel the work that is being done inside the **Run** method and exit gracefully.</span></span> <span data-ttu-id="f24f2-226">V opačném případě může být proces ukončen uprostřed operace.</span><span class="sxs-lookup"><span data-stu-id="f24f2-226">Otherwise, the process might be terminated in the middle of an operation.</span></span>

### <a name="opt-out-of-automatic-mime-sniffing-procedure"></a><span data-ttu-id="f24f2-227">Odhlásit se z automatického postupu čichání MIME</span><span class="sxs-lookup"><span data-stu-id="f24f2-227">Opt out of Automatic MIME Sniffing Procedure</span></span>

<span data-ttu-id="f24f2-228">V některých případech aplikace Internet Explorer hlásí jiný typ MIME, než jaký je určen webovým serverem.</span><span class="sxs-lookup"><span data-stu-id="f24f2-228">In some cases, Internet Explorer reports a MIME type different than the type specified by the web server.</span></span> <span data-ttu-id="f24f2-229">Pokud například aplikace Internet Explorer najde obsah HTML v souboru dodaném s hlavičkou content-type: text/plain v záhlaví odpovědi HTTP, aplikace Internet Explorer rozhodne, že obsah by měl být vykreslen jako HTML.</span><span class="sxs-lookup"><span data-stu-id="f24f2-229">For instance, if Internet Explorer finds HTML content in a file delivered with the HTTP response header Content-Type: text/plain, Internet Explorer determines that the content should be rendered as HTML.</span></span> <span data-ttu-id="f24f2-230">Bohužel, tento "MIME-sniffing" může také vést k bezpečnostním problémům pro servery hostující nedůvěryhodný obsah.</span><span class="sxs-lookup"><span data-stu-id="f24f2-230">Unfortunately, this "MIME-sniffing" can also lead to security problems for servers hosting untrusted content.</span></span> <span data-ttu-id="f24f2-231">V boji proti tomuto problému, Internet Explorer 8 provedla řadu změn mime-typ určení kódu a umožňuje vývojářům aplikací [odhlásit mime-sniffing](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span><span class="sxs-lookup"><span data-stu-id="f24f2-231">To combat this problem, Internet Explorer 8 has made a number of changes to MIME-type determination code and allows application developers to [opt out of MIME-sniffing](https://blogs.msdn.com/b/ie/archive/2008/07/02/ie8-security-part-v-comprehensive-protection.aspx).</span></span> <span data-ttu-id="f24f2-232">Do souboru *Web.config* byl přidán následující kód.</span><span class="sxs-lookup"><span data-stu-id="f24f2-232">The following code was added to the *Web.config* file.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample16.xml?highlight=2-7)]

### <a name="enable-bundling-and-minification"></a><span data-ttu-id="f24f2-233">Povolit sdružování a minifikaci</span><span class="sxs-lookup"><span data-stu-id="f24f2-233">Enable bundling and minification</span></span>

<span data-ttu-id="f24f2-234">Když Visual Studio vytvoří nový webový projekt, není ve výchozím nastavení povoleno sdružování a minifikace souborů JavaScriptu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-234">When Visual Studio creates a new web project, bundling and minification of JavaScript files is not enabled by default.</span></span> <span data-ttu-id="f24f2-235">Přidali jsme řádek kódu v BundleConfig.cs:</span><span class="sxs-lookup"><span data-stu-id="f24f2-235">We added a line of code in BundleConfig.cs:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample17.cs?highlight=9)]

### <a name="set-an-expiration-time-out-for-authentication-cookies"></a><span data-ttu-id="f24f2-236">Nastavení časového času vypršení platnosti ověřovacích souborů cookie</span><span class="sxs-lookup"><span data-stu-id="f24f2-236">Set an expiration time-out for authentication cookies</span></span>

<span data-ttu-id="f24f2-237">Ve výchozím nastavení vyprší platnost ověřovacích souborů cookie za dva týdny.</span><span class="sxs-lookup"><span data-stu-id="f24f2-237">By default, authentication cookies expire in two weeks.</span></span> <span data-ttu-id="f24f2-238">Kratší doba je bezpečnější.</span><span class="sxs-lookup"><span data-stu-id="f24f2-238">A shorter time is more secure.</span></span> <span data-ttu-id="f24f2-239">Toto nastavení můžete změnit v *StartupAuth.cs*:</span><span class="sxs-lookup"><span data-stu-id="f24f2-239">You can change this setting in *StartupAuth.cs*:</span></span>

[!code-csharp[Main](the-fix-it-sample-application/samples/sample18.cs?highlight=4-5)]

<a id="run-in-vs"></a>
## <a name="how-to-run-the-app-from-visual-studio-on-your-local-computer"></a><span data-ttu-id="f24f2-240">Jak spustit aplikaci z Visual Studia v místním počítači</span><span class="sxs-lookup"><span data-stu-id="f24f2-240">How to run the app from Visual Studio on your local computer</span></span>

<span data-ttu-id="f24f2-241">Aplikaci Fix It lze spustit dvěma způsoby:</span><span class="sxs-lookup"><span data-stu-id="f24f2-241">There are two ways to run the Fix It app:</span></span>

- <span data-ttu-id="f24f2-242">Spusťte základní aplikaci, která zapisuje nové úlohy přímo do databáze SQL.</span><span class="sxs-lookup"><span data-stu-id="f24f2-242">Run the base application that writes new tasks directly to the SQL database.</span></span>
- <span data-ttu-id="f24f2-243">Spusťte aplikaci pomocí fronty a back-endové služby k vytvoření úloh.</span><span class="sxs-lookup"><span data-stu-id="f24f2-243">Run the application using a queue plus a backend service to create tasks.</span></span> <span data-ttu-id="f24f2-244">Vzor fronty je popsán v kapitole [Vzor práce zaměřené na frontu](queue-centric-work-pattern.md).</span><span class="sxs-lookup"><span data-stu-id="f24f2-244">The queue pattern is described in the chapter [Queue-Centric Work Pattern](queue-centric-work-pattern.md).</span></span>

<a id="runbase"></a>
### <a name="run-the-base-application"></a><span data-ttu-id="f24f2-245">Spuštění základní aplikace</span><span class="sxs-lookup"><span data-stu-id="f24f2-245">Run the base application</span></span>

1. <span data-ttu-id="f24f2-246">Nainstalujte [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span><span class="sxs-lookup"><span data-stu-id="f24f2-246">Install [Visual Studio 2017](https://visualstudio.microsoft.com/downloads/?utm_medium=microsoft&utm_source=docs.microsoft.com&utm_campaign=button+cta&utm_content=download+vs2017).</span></span>
2. <span data-ttu-id="f24f2-247">Nainstalujte [sadu Azure SDK pro rozhraní .NET pro Visual Studio](https://azure.microsoft.com/downloads/).</span><span class="sxs-lookup"><span data-stu-id="f24f2-247">Install the [Azure SDK for .NET for Visual Studio](https://azure.microsoft.com/downloads/).</span></span>
3. <span data-ttu-id="f24f2-248">Stáhněte soubor ZIP z [Galerie kódů MSDN](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span><span class="sxs-lookup"><span data-stu-id="f24f2-248">Download the .zip file from the [MSDN Code Gallery](https://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4).</span></span>
4. <span data-ttu-id="f24f2-249">V Průzkumníkovi souborů klikněte pravým tlačítkem myši na soubor ZIP a potom klikněte na Vlastnosti a potom v okně Vlastnosti klikněte na Odblokovat.</span><span class="sxs-lookup"><span data-stu-id="f24f2-249">In File Explorer, right-click the .zip file and click Properties, then in the Properties window click Unblock.</span></span>
5. <span data-ttu-id="f24f2-250">Rozbalte soubor.</span><span class="sxs-lookup"><span data-stu-id="f24f2-250">Unzip the file.</span></span>
6. <span data-ttu-id="f24f2-251">Poklepáním na soubor .sln spusťte visual studio.</span><span class="sxs-lookup"><span data-stu-id="f24f2-251">Double-click the .sln file to launch Visual Studio.</span></span>
7. <span data-ttu-id="f24f2-252">V nabídce **Nástroje** klepněte na položku **NuGet Package Manager**a potom na **konzolu Správce balíčků**.</span><span class="sxs-lookup"><span data-stu-id="f24f2-252">From the **Tools** menu, click **NuGet Package Manager**, then **Package Manager Console**.</span></span>
8. <span data-ttu-id="f24f2-253">V konzole Správce balíčků (PMC) klikněte na Obnovit.</span><span class="sxs-lookup"><span data-stu-id="f24f2-253">In the Package Manager Console (PMC), click Restore.</span></span>
9. <span data-ttu-id="f24f2-254">Ukončete visual studio.</span><span class="sxs-lookup"><span data-stu-id="f24f2-254">Exit Visual Studio.</span></span>
10. <span data-ttu-id="f24f2-255">Spusťte [emulátor úložiště Azure](/azure/storage/common/storage-use-emulator).</span><span class="sxs-lookup"><span data-stu-id="f24f2-255">Start the [Azure storage emulator](/azure/storage/common/storage-use-emulator).</span></span>
11. <span data-ttu-id="f24f2-256">Restartujte visual studio a otevřete soubor řešení, který jste zavřeli v předchozím kroku.</span><span class="sxs-lookup"><span data-stu-id="f24f2-256">Restart Visual Studio, opening the solution file you closed in the previous step.</span></span>
12. <span data-ttu-id="f24f2-257">Ujistěte se, že projekt FixIt je nastaven jako projekt po spuštění a potom stisknutím kombinace kláves CTRL+F5 projekt spusťte.</span><span class="sxs-lookup"><span data-stu-id="f24f2-257">Make sure the FixIt project is set as the startup project, and then press CTRL+F5 to run the project.</span></span>

<a id="queueslocal"></a>
### <a name="run-the-application-with-queue-processing"></a><span data-ttu-id="f24f2-258">Spuštění aplikace se zpracováním fronty</span><span class="sxs-lookup"><span data-stu-id="f24f2-258">Run the application with queue processing</span></span>

1. <span data-ttu-id="f24f2-259">Postupujte podle pokynů pro [Spuštění základní aplikace](#runbase)a zavřete prohlížeč a zavřete Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="f24f2-259">Follow the directions for [Run the base application](#runbase), and then close the browser and close Visual Studio.</span></span>
2. <span data-ttu-id="f24f2-260">Spusťte Visual Studio s oprávněními správce.</span><span class="sxs-lookup"><span data-stu-id="f24f2-260">Start Visual Studio with administrator privileges.</span></span> <span data-ttu-id="f24f2-261">(Budete používat výpočetní emulátor Azure a to vyžaduje oprávnění správce.)</span><span class="sxs-lookup"><span data-stu-id="f24f2-261">(You'll be using the Azure compute emulator, and that requires administrator privileges.)</span></span>
3. <span data-ttu-id="f24f2-262">V souboru *Web.config* aplikace v projektu *MyFixIt* (webový `appSettings/UseQueues` projekt) změňte hodnotu na hodnotu "true":</span><span class="sxs-lookup"><span data-stu-id="f24f2-262">In the application *Web.config* file in the *MyFixIt* project (the web project), change the value of `appSettings/UseQueues` to "true":</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample19.cmd?highlight=3)]
4. <span data-ttu-id="f24f2-263">Pokud [emulátor úložiště Azure](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) není pořád spuštěný, spusťte ho znovu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-263">If the [Azure storage emulator](https://msdn.microsoft.com/library/windowsazure/hh403989.aspx) isn't still running, start it again.</span></span>
5. <span data-ttu-id="f24f2-264">Spusťte webový projekt FixIt a projekt MyFixItCloudService současně.</span><span class="sxs-lookup"><span data-stu-id="f24f2-264">Run the FixIt web project and the MyFixItCloudService project simultaneously.</span></span>

    <span data-ttu-id="f24f2-265">Použití sady Visual Studio:</span><span class="sxs-lookup"><span data-stu-id="f24f2-265">Using Visual Studio:</span></span>

   1. <span data-ttu-id="f24f2-266">Stisknutím **klávesy F5** spusťte projekt FixIt.</span><span class="sxs-lookup"><span data-stu-id="f24f2-266">Press **F5** to run the FixIt project.</span></span>
   2. <span data-ttu-id="f24f2-267">V **Průzkumníku řešení**klepněte pravým tlačítkem myši na projekt MyFixItCloudService a potom klepněte na příkaz **Ladění** > **spustit novou instanci**.</span><span class="sxs-lookup"><span data-stu-id="f24f2-267">In **Solution Explorer**, right-click the MyFixItCloudService project, and then click **Debug** > **Start New Instance**.</span></span>

    <span data-ttu-id="f24f2-268">Použití aplikace Visual Studio 2013 Express pro web:</span><span class="sxs-lookup"><span data-stu-id="f24f2-268">Using Visual Studio 2013 Express for Web:</span></span>

   3. <span data-ttu-id="f24f2-269">V Průzkumníku řešení klepněte pravým tlačítkem myši na řešení FixIt a vyberte **příkaz Vlastnosti**.</span><span class="sxs-lookup"><span data-stu-id="f24f2-269">In Solution Explorer, right-click the FixIt solution and select **Properties**.</span></span>
   4. <span data-ttu-id="f24f2-270">Vyberte **více projektů po spuštění**.</span><span class="sxs-lookup"><span data-stu-id="f24f2-270">Select **Multiple Startup Projects**.</span></span>
   5. <span data-ttu-id="f24f2-271">V rozevíracím seznamu **Akce** v části MyFixIt a MyFixItCloudService vyberte **Spustit**.</span><span class="sxs-lookup"><span data-stu-id="f24f2-271">In the **Action** dropdown list under MyFixIt and MyFixItCloudService, select **Start**.</span></span>
   6. <span data-ttu-id="f24f2-272">Klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="f24f2-272">Click **OK**.</span></span>
   7. <span data-ttu-id="f24f2-273">Stiskněte klávesu **F5** a oba projekty se spustí.</span><span class="sxs-lookup"><span data-stu-id="f24f2-273">Press **F5** to run both projects.</span></span>

      <span data-ttu-id="f24f2-274">Když spustíte projekt MyFixItCloudService, Visual Studio spustí azure compute emulátor.</span><span class="sxs-lookup"><span data-stu-id="f24f2-274">When you run the MyFixItCloudService project, Visual Studio starts the Azure compute emulator.</span></span> <span data-ttu-id="f24f2-275">V závislosti na konfiguraci brány firewall může být nutné povolit emulátor prostřednictvím brány firewall.</span><span class="sxs-lookup"><span data-stu-id="f24f2-275">Depending on your firewall configuration, you might need to allow the emulator through the firewall.</span></span>

<a id="deploybase"></a>
## <a name="how-to-deploy-the-base-app-to-azure-app-service-web-apps-by-using-the-windows-powershell-scripts"></a><span data-ttu-id="f24f2-276">Jak nasadit základní aplikaci do webových aplikací Služby aplikací Azure App Service pomocí skriptů Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="f24f2-276">How to deploy the base app to Azure App Service Web Apps by using the Windows PowerShell scripts</span></span>

<span data-ttu-id="f24f2-277">Pro ilustraci [automatizovat vše](automate-everything.md) vzor, fix It aplikace je dodáván se skripty, které nastavují prostředí v Azure a nasadit projekt do nového prostředí.</span><span class="sxs-lookup"><span data-stu-id="f24f2-277">To illustrate the [Automate Everything](automate-everything.md) pattern, the Fix It app is supplied with scripts that set up an environment in Azure and deploy the project to the new environment.</span></span> <span data-ttu-id="f24f2-278">Následující pokyny vysvětlují, jak používat skripty.</span><span class="sxs-lookup"><span data-stu-id="f24f2-278">The following instructions explain how to use the scripts.</span></span>

<span data-ttu-id="f24f2-279">Pokud chcete spustit v Azure bez použití front a provedené změny spustit místně s frontami, ujistěte se, že jste nastavili UseQueues appSetting hodnotu zpět na false před pokračováním s následujícími pokyny.</span><span class="sxs-lookup"><span data-stu-id="f24f2-279">If you want to run in Azure without using queues, and you made the changes to run locally with queues, make sure you set the UseQueues appSetting value back to false before proceeding with the following instructions.</span></span>

<span data-ttu-id="f24f2-280">Tyto pokyny předpokládají, že jste už stáhli a spusťte řešení Fix It místně a že máte účet Azure nebo máte předplatné Azure, které máte oprávnění ke správě.</span><span class="sxs-lookup"><span data-stu-id="f24f2-280">These instructions assume you have already downloaded and run the Fix It solution locally, and that you have an Azure account or have an Azure subscription that you are authorized to manage.</span></span>

1. <span data-ttu-id="f24f2-281">Nainstalujte konzolu **Azure PowerShell.**</span><span class="sxs-lookup"><span data-stu-id="f24f2-281">Install the **Azure PowerShell** console.</span></span> <span data-ttu-id="f24f2-282">Pokyny najdete v tématu [Jak nainstalovat a nakonfigurovat Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span><span class="sxs-lookup"><span data-stu-id="f24f2-282">For instructions, see [How to install and configure Azure PowerShell](https://docs.microsoft.com/powershell/azure/overview?view=azurermps-4.3.1).</span></span>

    <span data-ttu-id="f24f2-283">Tato přizpůsobená konzola je nakonfigurovaná pro práci s vaším předplatným Azure.</span><span class="sxs-lookup"><span data-stu-id="f24f2-283">This customized console is configured to work with your Azure subscription.</span></span> <span data-ttu-id="f24f2-284">Modul Azure se nainstaluje do adresáře *Program Files* a automaticky se importuje při každém použití konzoly Azure PowerShell.</span><span class="sxs-lookup"><span data-stu-id="f24f2-284">The Azure module is installed in the *Program Files* directory and is automatically imported on every use of the Azure PowerShell console.</span></span>

    <span data-ttu-id="f24f2-285">Pokud dáváte přednost práci v jiném hostitelském programu, jako je například Windows PowerShell ISE, nezapomeňte použít rutinu [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) k importu modulu Azure nebo pomocí příkazu v modulu Azure k aktivaci automatického importu modulu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-285">If you prefer to work in a different host program, such as Windows PowerShell ISE, be sure to use the [Import-Module](https://go.microsoft.com/fwlink/?LinkID=141553) cmdlet to import the Azure module or use a command in the Azure module to trigger automatic importing of the module.</span></span>
2. <span data-ttu-id="f24f2-286">Spusťte Azure PowerShell s možností **Spustit jako správce.**</span><span class="sxs-lookup"><span data-stu-id="f24f2-286">Start Azure PowerShell with the **Run as administrator** option.</span></span>
3. <span data-ttu-id="f24f2-287">Spusťte rutinu [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) a nastavte zásadu `RemoteSigned`spuštění prostředí Azure PowerShell na .</span><span class="sxs-lookup"><span data-stu-id="f24f2-287">Run the [Set-ExecutionPolicy](https://go.microsoft.com/fwlink/p/?linkid=293941) cmdlet to set the Azure PowerShell execution policy to `RemoteSigned`.</span></span> <span data-ttu-id="f24f2-288">Chcete-li změnu zásad dokončit, zadejte **y** (pro ano).</span><span class="sxs-lookup"><span data-stu-id="f24f2-288">Enter **Y** (for Yes) to complete the policy change.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample20.cmd)]

    <span data-ttu-id="f24f2-289">Toto nastavení umožňuje spouštět místní skripty, které nejsou digitálně podepsané.</span><span class="sxs-lookup"><span data-stu-id="f24f2-289">This setting enables you to run local scripts that aren't digitally signed.</span></span> <span data-ttu-id="f24f2-290">(Můžete také nastavit zásady `Unrestricted`spuštění na , což by eliminovalo potřebu odblokovat krok později, ale to se nedoporučuje z bezpečnostních důvodů.)</span><span class="sxs-lookup"><span data-stu-id="f24f2-290">(You can also set the execution policy to `Unrestricted`, which would eliminate the need for the unblock step later, but this is not recommended for security reasons.)</span></span>
4. <span data-ttu-id="f24f2-291">Spusťte rutinu `Add-AzureAccount` a nastavte PowerShell s přihlašovacími údaji pro váš účet.</span><span class="sxs-lookup"><span data-stu-id="f24f2-291">Run the `Add-AzureAccount` cmdlet to set up PowerShell with credentials for your account.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample21.cmd)]

    <span data-ttu-id="f24f2-292">Platnost těchto pověření vyprší po určité době a je `Add-AzureAccount` třeba rutinu znovu spustit.</span><span class="sxs-lookup"><span data-stu-id="f24f2-292">These credentials expire after a period of time and you have to re-run the `Add-AzureAccount` cmdlet.</span></span> <span data-ttu-id="f24f2-293">Jak se tato e-kniha píše, časový limit před vypršením platnosti přihlašovacích údajů je 12 hodin.</span><span class="sxs-lookup"><span data-stu-id="f24f2-293">As this e-book is being written, the time limit before credentials expire is 12 hours.</span></span>
5. <span data-ttu-id="f24f2-294">Pokud máte více předplatných, použijte rutinu Select-AzureSubscription k určení předplatného, ve kterém chcete vytvořit testovací prostředí.</span><span class="sxs-lookup"><span data-stu-id="f24f2-294">If you have multiple subscriptions, use the Select-AzureSubscription cmdlet to specify the subscription you want to create the test environment in.</span></span>
6. <span data-ttu-id="f24f2-295">Importujte certifikát správy pro stejné předplatné `Get-AzurePublishSettingsFile` `Import-AzurePublishSettingsFile` Azure pomocí rutin a rutin.</span><span class="sxs-lookup"><span data-stu-id="f24f2-295">Import a management certificate for the same Azure subscription by using the `Get-AzurePublishSettingsFile` and `Import-AzurePublishSettingsFile` cmdlets.</span></span> <span data-ttu-id="f24f2-296">První z těchto rutin stáhne soubor certifikátu a ve druhém zadáte umístění tohoto souboru, aby se importoval.</span><span class="sxs-lookup"><span data-stu-id="f24f2-296">The first of these cmdlets downloads a certificate file, and in the second one you specify the location of that file in order to import it.</span></span> > [!IMPORTANT]
   > <span data-ttu-id="f24f2-297">Uchovávejte stažený soubor na bezpečném místě nebo ho po dokončení ho odstraňte, protože obsahuje certifikát, který lze použít ke správě služeb Azure.</span><span class="sxs-lookup"><span data-stu-id="f24f2-297">Keep the downloaded file in a safe location or delete it when you're done with it, because it contains a certificate that can be used to manage your Azure services.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample22.cmd)]

    <span data-ttu-id="f24f2-298">Certifikát se používá pro volání rozhraní REST API, které detekuje ip adresu vývojového počítače za účelem nastavení pravidla brány firewall na serveru SQL Database.</span><span class="sxs-lookup"><span data-stu-id="f24f2-298">The certificate is used for a REST API call that detects the development machine's IP address in order to set a firewall rule on the SQL Database server.</span></span>
7. <span data-ttu-id="f24f2-299">Spusťte rutinu [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) (aliasy jsou `cd`, `chdir`a ) a `sl`přejděte do adresáře, který obsahuje skripty.</span><span class="sxs-lookup"><span data-stu-id="f24f2-299">Run the [Set-Location](https://go.microsoft.com/fwlink/p/?linkid=293912) cmdlet (aliases are `cd`, `chdir`, and `sl`) to navigate to the directory that contains the scripts.</span></span> <span data-ttu-id="f24f2-300">(Jsou umístěny ve složce *Automatizace* ve složce řešení Fix It.) Pokud některý z názvů adresářů obsahuje mezery, vložte cestu do uvozovek.</span><span class="sxs-lookup"><span data-stu-id="f24f2-300">(They're located in the *Automation* folder in the Fix It solution folder.) Put the path in quotes if any of the directory names contain spaces.</span></span> <span data-ttu-id="f24f2-301">Chcete-li například `c:\Sample Apps\FixIt\Automation` přejít do adresáře, můžete zadat následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="f24f2-301">For example, to navigate to the `c:\Sample Apps\FixIt\Automation` directory you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample23.cmd)]
8. <span data-ttu-id="f24f2-302">Chcete-li povolit spuštění těchto skriptů prostředím Windows PowerShell, použijte rutinu [Odblokovat soubor.](https://go.microsoft.com/fwlink/p/?linkid=294021)</span><span class="sxs-lookup"><span data-stu-id="f24f2-302">To allow Windows PowerShell to run these scripts, use the [Unblock-File](https://go.microsoft.com/fwlink/p/?linkid=294021) cmdlet.</span></span> <span data-ttu-id="f24f2-303">(Skripty jsou blokovány, protože byly staženy z Internetu.)</span><span class="sxs-lookup"><span data-stu-id="f24f2-303">(The scripts are blocked because they were downloaded from the Internet.)</span></span>

    > [!WARNING]
    > <span data-ttu-id="f24f2-304">Zabezpečení - `Unblock-File` Před spuštěním libovolného skriptu nebo spustitelného souboru otevřete soubor v programu Poznámkový blok, zkontrolujte příkazy a ověřte, zda neobsahují žádný škodlivý kód.</span><span class="sxs-lookup"><span data-stu-id="f24f2-304">Security - Before running `Unblock-File` on any script or executable file, open the file in Notepad, examine the commands, and verify that they do not contain any malicious code.</span></span>

    <span data-ttu-id="f24f2-305">Například následující příkaz spustí `Unblock-File` rutinu na všech skriptech v aktuálním adresáři.</span><span class="sxs-lookup"><span data-stu-id="f24f2-305">For example, the following command runs the `Unblock-File` cmdlet on all scripts in the current directory.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample24.cmd)]
9. <span data-ttu-id="f24f2-306">Chcete-li vytvořit webovou aplikaci pro základní (bez zpracování front) Opravit aplikaci, spusťte skript pro vytváření prostředí.</span><span class="sxs-lookup"><span data-stu-id="f24f2-306">To create the web app for the base (no queues processing) Fix It app, run the environment creation script.</span></span>

    <span data-ttu-id="f24f2-307">Požadovaný `Name` parametr určuje název databáze a používá se také pro účet úložiště, který skript vytvoří.</span><span class="sxs-lookup"><span data-stu-id="f24f2-307">The required `Name` parameter specifies the name of the database and is also used for the storage account that the script creates.</span></span> <span data-ttu-id="f24f2-308">Název musí být globálně jedinečný v rámci domény azurewebsites.net.</span><span class="sxs-lookup"><span data-stu-id="f24f2-308">The name must be globally unique within the azurewebsites.net domain.</span></span> <span data-ttu-id="f24f2-309">Pokud zadáte název, který není jedinečný, jako fixit nebo test (nebo dokonce `New-AzureWebsite` jako v příkladu fixitdemo), rutina selže s vnitřní chybou, která hlásí konflikt.</span><span class="sxs-lookup"><span data-stu-id="f24f2-309">If you specify a name that is not unique, like Fixit or Test (or even as in the example, fixitdemo), the `New-AzureWebsite` cmdlet fails with an Internal Error that reports a conflict.</span></span> <span data-ttu-id="f24f2-310">Skript převede název na všechna malá písmena, aby vyhověl požadavkům na název webových aplikací, účtů úložiště a databází.</span><span class="sxs-lookup"><span data-stu-id="f24f2-310">The script converts the name to all lower-case to comply with name requirements for web apps, storage accounts, and databases.</span></span>

    <span data-ttu-id="f24f2-311">Požadovaný `SqlDatabasePassword` parametr určuje heslo pro účet správce, který bude vytvořen pro databázi SQL.</span><span class="sxs-lookup"><span data-stu-id="f24f2-311">The required `SqlDatabasePassword` parameter specifies the password for the admin account that will be created for SQL Database.</span></span> <span data-ttu-id="f24f2-312">Do hesla nezahrnejte speciální&amp; &lt; &gt; znaky XML (;).</span><span class="sxs-lookup"><span data-stu-id="f24f2-312">Don't include special XML characters in the password (&amp; &lt; &gt; ;).</span></span> <span data-ttu-id="f24f2-313">Toto je omezení způsobu, jakým byly skripty napsány, nikoli omezení Azure.</span><span class="sxs-lookup"><span data-stu-id="f24f2-313">This is a limitation of the way the scripts were written, not a limitation of Azure.</span></span>

    <span data-ttu-id="f24f2-314">Chcete-li například vytvořit webovou aplikaci s názvem "fixitdemo" a použít heslo správce serveru SQL Server "Passw0rd1", můžete zadat následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="f24f2-314">For example, if you want to create a web app named "fixitdemo" and use a SQL Server administrator password of "Passw0rd1", you could enter the following command:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample25.cmd)]

    <span data-ttu-id="f24f2-315">Název musí být jedinečný v doméně azurewebsites.net a heslo musí splňovat požadavky databáze SQL pro složitost hesla.</span><span class="sxs-lookup"><span data-stu-id="f24f2-315">The name must be unique in the azurewebsites.net domain, and the password must meet SQL Database requirements for password complexity.</span></span> <span data-ttu-id="f24f2-316">(Příklad Passw0rd1 splňuje požadavky.)</span><span class="sxs-lookup"><span data-stu-id="f24f2-316">(The example Passw0rd1 does meet the requirements.)</span></span>

    <span data-ttu-id="f24f2-317">Všimněte si, že příkaz začíná ". \".</span><span class="sxs-lookup"><span data-stu-id="f24f2-317">Note that the command begins with ".\".</span></span> <span data-ttu-id="f24f2-318">Chcete-li zabránit škodlivému spuštění skriptů, prostředí Windows PowerShell vyžaduje, abyste při spuštění skriptu poskytli plně kvalifikovanou cestu k souboru skriptu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-318">To help prevent malicious execution of scripts, Windows PowerShell requires that you provide the fully qualified path to the script file when you run a script.</span></span> <span data-ttu-id="f24f2-319">Tečku můžete použít k označení aktuálního\"adresáře (". ) nebo poskytnout plně kvalifikovanou cestu, jako jsou:</span><span class="sxs-lookup"><span data-stu-id="f24f2-319">You can use a dot to indicate the current directory (".\") or provide the fully qualified path, such as:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample26.cmd)]

    <span data-ttu-id="f24f2-320">Další informace o skriptu `Get-Help` získáte pomocí rutiny.</span><span class="sxs-lookup"><span data-stu-id="f24f2-320">For more information about the script, use the `Get-Help` cmdlet.</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample27.cmd)]

    <span data-ttu-id="f24f2-321">Pomocí rutiny `Detailed` `Full`, `Parameters`, `Examples` a parametry rutiny Get-Help můžete filtrovat vrácenou nápovědu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-321">You can use the `Detailed`, `Full`, `Parameters`, and `Examples` parameters of the Get-Help cmdlet to filter the help that is returned.</span></span>

    <span data-ttu-id="f24f2-322">Pokud skript selže nebo generuje chyby, jako je například "New-AzureWebsite : Call Set-AzureSubscription a Select-AzureSubscription první", možná jste nedokončili konfiguraci Azure PowerShellu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-322">If the script fails or generates errors, such as "New-AzureWebsite : Call Set-AzureSubscription and Select-AzureSubscription first," you might not have completed the configuration of Azure PowerShell.</span></span>

    <span data-ttu-id="f24f2-323">Po dokončení skriptu můžete pomocí portálu pro správu Azure zobrazit prostředky, které byly vytvořeny, jak je znázorněno v kapitole [Automatizovat vše.](automate-everything.md)</span><span class="sxs-lookup"><span data-stu-id="f24f2-323">After the script finishes, you can use the Azure Management Portal to see the resources that were created, as shown in the [Automate Everything](automate-everything.md) chapter.</span></span>
10. <span data-ttu-id="f24f2-324">Chcete-li nasadit projekt FixIt do nového prostředí Azure, použijte skript *AzureWebsite.ps1.*</span><span class="sxs-lookup"><span data-stu-id="f24f2-324">To deploy the FixIt project to the new Azure environment, use the *AzureWebsite.ps1* script.</span></span> <span data-ttu-id="f24f2-325">Příklad:</span><span class="sxs-lookup"><span data-stu-id="f24f2-325">For example:</span></span>

    [!code-console[Main](the-fix-it-sample-application/samples/sample28.cmd)]

    <span data-ttu-id="f24f2-326">Po dokončení nasazení se otevře prohlížeč s fix It spuštěným v Azure.</span><span class="sxs-lookup"><span data-stu-id="f24f2-326">When deployment is done, the browser opens with Fix It running in Azure.</span></span>

<a id="troubleshooting"></a>
## <a name="troubleshooting-the-windows-powershell-scripts"></a><span data-ttu-id="f24f2-327">Poradce při potížích se skripty prostředí Windows PowerShell</span><span class="sxs-lookup"><span data-stu-id="f24f2-327">Troubleshooting the Windows PowerShell scripts</span></span>

<span data-ttu-id="f24f2-328">Nejčastější chyby při spuštění těchto skriptů souvisejí s oprávněními.</span><span class="sxs-lookup"><span data-stu-id="f24f2-328">The most common errors encountered when running these scripts are related to permissions.</span></span> <span data-ttu-id="f24f2-329">Ujistěte `Add-AzureAccount` se, že a `Import-AzurePublishSettingsFile` byly úspěšné a že jste je použili pro stejné předplatné Azure.</span><span class="sxs-lookup"><span data-stu-id="f24f2-329">Make sure that `Add-AzureAccount` and `Import-AzurePublishSettingsFile` were successful and that you used them for the same Azure subscription.</span></span> <span data-ttu-id="f24f2-330">I `Add-AzureAccount` kdyby byl úspěšný, možná budete muset spustit znovu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-330">Even if `Add-AzureAccount` was successful you might have to run it again.</span></span> <span data-ttu-id="f24f2-331">Platnost oprávnění `Add-AzureAccount` přidaná za 12 hodin vyprší.</span><span class="sxs-lookup"><span data-stu-id="f24f2-331">The permissions added by `Add-AzureAccount` expire in 12 hours.</span></span>

### <a name="object-reference-not-set-to-an-instance-of-an-object"></a><span data-ttu-id="f24f2-332">Odkaz na objekt není nastaven na instanci objektu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-332">Object reference not set to an instance of an object.</span></span>

<span data-ttu-id="f24f2-333">Pokud skript vrátí chyby, například "Odkaz na objekt není nastaven na instanci objektu", což znamená, že prostředí `Add-AzureAccount` Windows PowerShell nemůže najít objekt ke zpracování (jedná se o výjimku s nulovým odkazem), spusťte rutinu a zkuste skript znovu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-333">If the script returns errors, such as "Object reference not set to an instance of an object," which means that Windows PowerShell can't find an object to process (this is a null reference exception), run the `Add-AzureAccount` cmdlet and try the script again.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample29.cmd)]

### <a name="internalerror-the-server-encountered-an-internal-error"></a><span data-ttu-id="f24f2-334">InternalError: Na serveru došlo k vnitřní chybě.</span><span class="sxs-lookup"><span data-stu-id="f24f2-334">InternalError: The server encountered an internal error.</span></span>

<span data-ttu-id="f24f2-335">Rutina `New-AzureWebsite` vrátí vnitřní chybu, pokud název není jedinečný v azurewebsites.net doméně.</span><span class="sxs-lookup"><span data-stu-id="f24f2-335">The `New-AzureWebsite` cmdlet returns an internal error when the name is not unique in the azurewebsites.net domain.</span></span> <span data-ttu-id="f24f2-336">Chcete-li chybu vyřešit, použijte pro název jinou hodnotu, která je v parametru Name *new-AzureWebsiteEnv.ps1*.</span><span class="sxs-lookup"><span data-stu-id="f24f2-336">To resolve the error, use a different value for the name, which is in the Name parameter of *New-AzureWebsiteEnv.ps1*.</span></span>

[!code-console[Main](the-fix-it-sample-application/samples/sample30.cmd)]

### <a name="restarting-the-script"></a><span data-ttu-id="f24f2-337">Restartování skriptu</span><span class="sxs-lookup"><span data-stu-id="f24f2-337">Restarting the script</span></span>

<span data-ttu-id="f24f2-338">Pokud potřebujete restartovat skript *New-AzureWebsiteEnv.ps1,* protože se nezdařilo před tiskem zprávy "Skript je dokončen", můžete odstranit prostředky, které skript vytvořený před jeho zastavením.</span><span class="sxs-lookup"><span data-stu-id="f24f2-338">If you need to restart the *New-AzureWebsiteEnv.ps1* script because it failed before it printed the "Script is complete" message, you might want to delete resources that the script created before it stopped.</span></span> <span data-ttu-id="f24f2-339">Pokud například skript již vytvořil webovou aplikaci ContosoFixItDemo a skript znovu spustíte se stejným názvem, skript se nezdaří, protože název je používán.</span><span class="sxs-lookup"><span data-stu-id="f24f2-339">For example, if the script already created the ContosoFixItDemo web app and you run the script again with the same name, the script will fail because the name is in use.</span></span>

<span data-ttu-id="f24f2-340">Chcete-li zjistit, které prostředky skript vytvořený před jeho zastavením, použijte následující rutiny:</span><span class="sxs-lookup"><span data-stu-id="f24f2-340">To determine which resources the script created before it stopped, use the following cmdlets:</span></span>

- `Get-AzureWebsite`
- `Get-AzureSqlDatabaseServer`
- <span data-ttu-id="f24f2-341">`Get-AzureSqlDatabase`: Chcete-li spustit tuto rutinu, `Get-AzureSqlDatabase`přepojit název databázového serveru na :`Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span><span class="sxs-lookup"><span data-stu-id="f24f2-341">`Get-AzureSqlDatabase`: To run this cmdlet, pipe the database server name to `Get-AzureSqlDatabase`:   `Get-AzureSqlDatabaseServer | Get-AzureSqlDatabase.`</span></span>

<span data-ttu-id="f24f2-342">Chcete-li tyto prostředky odstranit, použijte následující příkazy.</span><span class="sxs-lookup"><span data-stu-id="f24f2-342">To delete these resources, use the following commands.</span></span> <span data-ttu-id="f24f2-343">Všimněte si, že pokud odstraníte databázový server, automaticky odstraníte databáze přidružené k serveru.</span><span class="sxs-lookup"><span data-stu-id="f24f2-343">Note that if you delete the database server, you automatically delete the databases associated with the server.</span></span>

- `Get-AzureWebsite -Name <WebsiteName> | Remove-AzureWebsite`
- `Get-AzureSqlDatabase -Name <DatabaseName> -ServerName <DatabaseServerName> | Remove-SqlAzureDatabase`
- `Get-AzureSqlDatabaseServer | Remove-AzureSqlDatabaseServer`

<a id="deployqueues"></a>
## <a name="how-to-deploy-the-app-with-queue-processing-to-azure-app-service-web-apps-and-an-azure-cloud-service"></a><span data-ttu-id="f24f2-344">Jak nasadit aplikaci se zpracováním fronty do webových aplikací Služby App Service Azure a cloudové služby Azure</span><span class="sxs-lookup"><span data-stu-id="f24f2-344">How to deploy the app with queue processing to Azure App Service Web Apps and an Azure Cloud Service</span></span>

<span data-ttu-id="f24f2-345">Chcete-li povolit fronty, proveďte v souboru MyFixIt\Web.config následující změny.</span><span class="sxs-lookup"><span data-stu-id="f24f2-345">To enable queues, make the following change in the MyFixIt\Web.config file.</span></span> <span data-ttu-id="f24f2-346">V `appSettings`části změňte `UseQueues` hodnotu na hodnotu "true":</span><span class="sxs-lookup"><span data-stu-id="f24f2-346">Under `appSettings`, change the value of `UseQueues` to "true":</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample31.xml)]

<span data-ttu-id="f24f2-347">Pak nasadíte aplikaci MVC do webové aplikace ve službě Azure App Service, jak je popsáno [výše](#deploybase).</span><span class="sxs-lookup"><span data-stu-id="f24f2-347">Then deploy the MVC application to an web app in Azure App Service, as described [earlier](#deploybase).</span></span>

<span data-ttu-id="f24f2-348">Dále vytvořte novou cloudovou službu Azure.</span><span class="sxs-lookup"><span data-stu-id="f24f2-348">Next, create a new Azure cloud service.</span></span> <span data-ttu-id="f24f2-349">Skripty, které jsou součástí aplikace Fix It, nevytvářejí ani nenasazují cloudovou službu, takže k tomu musíte použít portál Azure.</span><span class="sxs-lookup"><span data-stu-id="f24f2-349">The scripts included with the Fix It app do not create or deploy the cloud service, so you must use Azure portal for this.</span></span> <span data-ttu-id="f24f2-350">Na portálu klikněte na **Nový** -- **výpočetní –** **cloudová služba** -- **Rychlé vytvoření**a zadejte adresu URL a umístění datového centra.</span><span class="sxs-lookup"><span data-stu-id="f24f2-350">In the portal, click **New** -- **Compute** – **Cloud Service** -- **Quick Create**, and then enter a URL and a data center location.</span></span> <span data-ttu-id="f24f2-351">Použijte stejné datové centrum, do kterého jste webovou aplikaci nasadili.</span><span class="sxs-lookup"><span data-stu-id="f24f2-351">Use the same data center where you deployed the web app.</span></span>

![](the-fix-it-sample-application/_static/image1.png)

<span data-ttu-id="f24f2-352">Před nasazením cloudové služby je třeba aktualizovat některé konfigurační soubory.</span><span class="sxs-lookup"><span data-stu-id="f24f2-352">Before you can deploy the cloud service, you need to update some of the configuration files.</span></span>

<span data-ttu-id="f24f2-353">V aplikaci MyFixIt.WorkerRole\app.config v `connectionStrings`části `appdb` nahraďte hodnotu připojovacího řetězce skutečným připojovacím řetězcem pro databázi SQL.</span><span class="sxs-lookup"><span data-stu-id="f24f2-353">In MyFixIt.WorkerRole\app.config, under `connectionStrings`, replace the value of the `appdb` connection string with the actual connection string for the SQL Database.</span></span> <span data-ttu-id="f24f2-354">Připojovací řetězec můžete získat z portálu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-354">You can get the connection string from the portal.</span></span> <span data-ttu-id="f24f2-355">Na portálu klikněte na **položku SQL Databases** - **appdb** - **View SQL Database connection strings for ADO .Net, ODBC, PHP a JDBC**.</span><span class="sxs-lookup"><span data-stu-id="f24f2-355">In the portal, click **SQL Databases** - **appdb** - **View SQL Database connection strings for ADO .Net, ODBC, PHP, and JDBC**.</span></span> <span data-ttu-id="f24f2-356">Zkopírujte připojovací řetězec ADO.NET a vložte hodnotu do souboru app.config.</span><span class="sxs-lookup"><span data-stu-id="f24f2-356">Copy the ADO.NET connection string and paste the value into the app.config file.</span></span> <span data-ttu-id="f24f2-357">Nahraďte\_heslo\_{vaše heslo zde}" heslem databáze.</span><span class="sxs-lookup"><span data-stu-id="f24f2-357">Replace "{your\_password\_here}" with your database password.</span></span> <span data-ttu-id="f24f2-358">(Za předpokladu, že jste použili skripty k nasazení aplikace `SqlDatabasePassword` MVC, zadali jste heslo databáze v parametru skriptu.)</span><span class="sxs-lookup"><span data-stu-id="f24f2-358">(Assuming you used the scripts to deploy the MVC app, you specified the database password in the `SqlDatabasePassword` script parameter.)</span></span>

<span data-ttu-id="f24f2-359">Výsledek by měl vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="f24f2-359">The result should look like the following:</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample32.xml)]

<span data-ttu-id="f24f2-360">Ve stejném souboru MyFixIt.WorkerRole\app.config v části `appSettings`nahraďte dvě zástupné hodnoty pro účet úložiště Azure.</span><span class="sxs-lookup"><span data-stu-id="f24f2-360">In the same MyFixIt.WorkerRole\app.config file, under `appSettings`, replace the two placeholder values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample33.xml?highlight=2-3)]

<span data-ttu-id="f24f2-361">Přístupový klíč můžete získat z portálu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-361">You can get the access key from the portal.</span></span> <span data-ttu-id="f24f2-362">Přečtěte [si, jak spravovat účty úložiště](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span><span class="sxs-lookup"><span data-stu-id="f24f2-362">See [How To Manage Storage Accounts](https://docs.microsoft.com/azure/storage/common/storage-create-storage-account).</span></span>

<span data-ttu-id="f24f2-363">V myfixitcloudservice\ServiceConfiguration.Cloud.cscfg nahraďte stejné dva zástupné hodnoty pro účet úložiště Azure.</span><span class="sxs-lookup"><span data-stu-id="f24f2-363">In MyFixItCloudService\ServiceConfiguration.Cloud.cscfg, replace the same two placeholders values for the Azure storage account.</span></span>

[!code-xml[Main](the-fix-it-sample-application/samples/sample34.xml?highlight=3)]

<span data-ttu-id="f24f2-364">Teď jste připraveni nasadit cloudovou službu.</span><span class="sxs-lookup"><span data-stu-id="f24f2-364">Now you are ready to deploy the cloud service.</span></span> <span data-ttu-id="f24f2-365">V řešení prozkoumat klikněte pravým tlačítkem myši na projekt MyFixItCloudService a vyberte **publikovat**.</span><span class="sxs-lookup"><span data-stu-id="f24f2-365">In Solution Explore, right-click the MyFixItCloudService project and select **Publish**.</span></span> <span data-ttu-id="f24f2-366">Další informace naleznete[v tématu](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)" Deploy the Application to Azure ", což je v části 2 [tohoto kurzu](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span><span class="sxs-lookup"><span data-stu-id="f24f2-366">For more information, see "[Deploy the Application to Azure](https://www.windowsazure.com/develop/net/tutorials/multi-tier-web-site/2-download-and-run/#deployAz)", which is in part 2 of [this tutorial](https://code.msdn.microsoft.com/Windows-Azure-Multi-Tier-eadceb36).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="f24f2-367">Předchozí</span><span class="sxs-lookup"><span data-stu-id="f24f2-367">Previous</span></span>](more-patterns-and-guidance.md)
