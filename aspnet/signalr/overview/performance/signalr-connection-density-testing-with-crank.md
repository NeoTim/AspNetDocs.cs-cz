---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: Testování hustoty připojení signálem pomocí Crank | Microsoft Docs
author: bradygaster
description: Testování hustoty připojení nástrojem Crank
ms.author: bradyg
ms.date: 02/22/2015
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: 901e039fbb81651ed18d560c99745b7e7f716e01
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78558336"
---
# <a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="b34d2-103">Testování hustoty připojení nástrojem Crank</span><span class="sxs-lookup"><span data-stu-id="b34d2-103">SignalR Connection Density Testing with Crank</span></span>

<span data-ttu-id="b34d2-104">tím, že [FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="b34d2-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="b34d2-105">Tento článek popisuje, jak používat nástroj Crank k otestování aplikace s více simulovanými klienty.</span><span class="sxs-lookup"><span data-stu-id="b34d2-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>

<span data-ttu-id="b34d2-106">Jakmile vaše aplikace běží ve svém hostitelském prostředí (buď webová role Azure, IIS, nebo v místním prostředí s využitím Owin), můžete otestovat reakci aplikace na vysokou úroveň hustoty připojení pomocí nástroje Crank.</span><span class="sxs-lookup"><span data-stu-id="b34d2-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="b34d2-107">Hostující prostředí může být server Internetová informační služba (IIS), hostitel Owin nebo webová role Azure.</span><span class="sxs-lookup"><span data-stu-id="b34d2-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="b34d2-108">(Poznámka: čítače výkonu nejsou k dispozici v Azure App Service Web Apps, takže nebudete moci získat údaje o výkonu z testu hustoty připojení.)</span><span class="sxs-lookup"><span data-stu-id="b34d2-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="b34d2-109">Hustota připojení odkazuje na počet souběžných připojení TCP, která lze na serveru vytvořit.</span><span class="sxs-lookup"><span data-stu-id="b34d2-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="b34d2-110">Každé připojení TCP má za následek svoji vlastní režii a otevření velkého počtu nečinných připojení nakonec vytvoří kritické místo pro paměť.</span><span class="sxs-lookup"><span data-stu-id="b34d2-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="b34d2-111">[Základ signálu](https://github.com/signalr/signalr) obsahuje nástroj pro testování zatížení nazvaný **Crank**.</span><span class="sxs-lookup"><span data-stu-id="b34d2-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="b34d2-112">Nejnovější verzi Crank najdete ve [vývojářské větvi](https://github.com/SignalR/signalr/tree/dev) na GitHubu.</span><span class="sxs-lookup"><span data-stu-id="b34d2-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="b34d2-113">Archiv zip větve pro vývojovou větev si můžete stáhnout [tady](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="b34d2-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="b34d2-114">Crank se dá použít k plnému sytosti paměti serveru, aby se mohl vypočítat celkový počet nečinných připojení na hardwaru serveru.</span><span class="sxs-lookup"><span data-stu-id="b34d2-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="b34d2-115">Alternativně můžete také použít Crank k zátěži testu serveru s určitou velikostí paměti tím, že provedete navýšení připojení, dokud není dosaženo konkrétního počtu nebo určité prahové hodnoty paměti.</span><span class="sxs-lookup"><span data-stu-id="b34d2-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="b34d2-116">Při testování je důležité používat vzdálené klienty, abyste se vyhnuli jakékoli konkurenci pro prostředky (tj. připojení TCP a paměť).</span><span class="sxs-lookup"><span data-stu-id="b34d2-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="b34d2-117">Monitorujte klienty, abyste se ujistili, že nedošlo k žádným kritickým bodům, které by mohly zabránit serveru v dosažení plné kapacity (paměti nebo procesoru).</span><span class="sxs-lookup"><span data-stu-id="b34d2-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="b34d2-118">Možná budete muset zvýšit počet klientů, aby bylo možné plně načíst Server.</span><span class="sxs-lookup"><span data-stu-id="b34d2-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="b34d2-119">Spuštění testu hustoty připojení</span><span class="sxs-lookup"><span data-stu-id="b34d2-119">Running a Connection Density Test</span></span>

<span data-ttu-id="b34d2-120">Tato část popisuje kroky potřebné ke spuštění testu hustoty připojení v aplikaci signalizace.</span><span class="sxs-lookup"><span data-stu-id="b34d2-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="b34d2-121">Stáhněte a sestavte [vývojovou větev základu signálu](https://github.com/SignalR/SignalR/archive/dev.zip).</span><span class="sxs-lookup"><span data-stu-id="b34d2-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="b34d2-122">Na příkazovém řádku přejděte do složky &lt;Project Directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span><span class="sxs-lookup"><span data-stu-id="b34d2-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="b34d2-123">Nasaďte aplikaci do svého zamýšleného hostitelského prostředí.</span><span class="sxs-lookup"><span data-stu-id="b34d2-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="b34d2-124">Poznamenejte si koncový bod, který vaše aplikace používá; například v aplikaci vytvořené v [Začínáme kurzu](../getting-started/tutorial-getting-started-with-signalr.md)je koncový bod `http://<yourhost>:8080/signalr`.</span><span class="sxs-lookup"><span data-stu-id="b34d2-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="b34d2-125">Nainstalujte [čítače výkonu signálu](signalr-performance.md#perfcounters) na server.</span><span class="sxs-lookup"><span data-stu-id="b34d2-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="b34d2-126">Pokud je vaše aplikace spuštěná v Azure, přečtěte si téma [použití čítačů výkonu signálů ve webové roli Azure](using-signalr-performance-counters-in-an-azure-web-role.md).</span><span class="sxs-lookup"><span data-stu-id="b34d2-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="b34d2-127">Po stažení a sestavení základu kódu a nainstalování čítačů výkonu na hostitele lze nástroj příkazového řádku Crank najít ve složce `src\Microsoft.AspNet.SignalR.Crank\bin\Debug`.</span><span class="sxs-lookup"><span data-stu-id="b34d2-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="b34d2-128">K dispozici jsou možnosti pro nástroj Crank:</span><span class="sxs-lookup"><span data-stu-id="b34d2-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="b34d2-129">**/?** : Zobrazuje obrazovku help.</span><span class="sxs-lookup"><span data-stu-id="b34d2-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="b34d2-130">Dostupné možnosti se zobrazí také v případě, že je parametr **adresy URL** vynechán.</span><span class="sxs-lookup"><span data-stu-id="b34d2-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="b34d2-131">**/URL**: adresa URL pro připojení k signalizaci.</span><span class="sxs-lookup"><span data-stu-id="b34d2-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="b34d2-132">Tento parametr je povinný.</span><span class="sxs-lookup"><span data-stu-id="b34d2-132">This parameter is required.</span></span> <span data-ttu-id="b34d2-133">Pro aplikaci signalizace, která používá výchozí mapování, bude cesta končit "/SignalR".</span><span class="sxs-lookup"><span data-stu-id="b34d2-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="b34d2-134">**/Transport**: název použitého přenosu.</span><span class="sxs-lookup"><span data-stu-id="b34d2-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="b34d2-135">Výchozí hodnota je `auto`, ve kterém se vybere nejlepší dostupný protokol.</span><span class="sxs-lookup"><span data-stu-id="b34d2-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="b34d2-136">Mezi možnosti patří `WebSockets`, `ServerSentEvents`a `LongPolling` (`ForeverFrame` není možnost pro Crank, protože se používá klient .NET namísto použití aplikace Internet Explorer).</span><span class="sxs-lookup"><span data-stu-id="b34d2-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="b34d2-137">Další informace o tom, jak signál vybírá přenosy, najdete v tématu [přenosy a záložní](../getting-started/introduction-to-signalr.md#transports)služby.</span><span class="sxs-lookup"><span data-stu-id="b34d2-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="b34d2-138">**/BatchSize**: počet klientů přidaných do každé dávky.</span><span class="sxs-lookup"><span data-stu-id="b34d2-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="b34d2-139">Výchozí hodnota je 50.</span><span class="sxs-lookup"><span data-stu-id="b34d2-139">The default is 50.</span></span>
- <span data-ttu-id="b34d2-140">**/ConnectInterval**: interval v milisekundách mezi přidáváním připojení.</span><span class="sxs-lookup"><span data-stu-id="b34d2-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="b34d2-141">Výchozí hodnota je 500.</span><span class="sxs-lookup"><span data-stu-id="b34d2-141">The default is 500.</span></span>
- <span data-ttu-id="b34d2-142">**/Connections**: počet připojení použitých k načtení a otestování aplikace.</span><span class="sxs-lookup"><span data-stu-id="b34d2-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="b34d2-143">Výchozí hodnota je 100 000.</span><span class="sxs-lookup"><span data-stu-id="b34d2-143">The default is 100,000.</span></span>
- <span data-ttu-id="b34d2-144">**/ConnectTimeout**: časový limit v sekundách před přerušením testu.</span><span class="sxs-lookup"><span data-stu-id="b34d2-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="b34d2-145">Výchozí hodnota je 300.</span><span class="sxs-lookup"><span data-stu-id="b34d2-145">The default is 300.</span></span>
- <span data-ttu-id="b34d2-146">**MinServerMBytes**: minimální dostupný server megabajtů.</span><span class="sxs-lookup"><span data-stu-id="b34d2-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="b34d2-147">Výchozí hodnota je 500.</span><span class="sxs-lookup"><span data-stu-id="b34d2-147">The default is 500.</span></span>
- <span data-ttu-id="b34d2-148">**SendBytes**: velikost datové části odeslané na server v bajtech.</span><span class="sxs-lookup"><span data-stu-id="b34d2-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="b34d2-149">Výchozí hodnota je 0.</span><span class="sxs-lookup"><span data-stu-id="b34d2-149">The default is 0.</span></span>
- <span data-ttu-id="b34d2-150">**SendInterval**: zpoždění v milisekundách mezi zprávami na server.</span><span class="sxs-lookup"><span data-stu-id="b34d2-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="b34d2-151">Výchozí hodnota je 500.</span><span class="sxs-lookup"><span data-stu-id="b34d2-151">The default is 500.</span></span>
- <span data-ttu-id="b34d2-152">**SendTimeout**: časový limit v milisekundách pro zprávy na server.</span><span class="sxs-lookup"><span data-stu-id="b34d2-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="b34d2-153">Výchozí hodnota je 300.</span><span class="sxs-lookup"><span data-stu-id="b34d2-153">The default is 300.</span></span>
- <span data-ttu-id="b34d2-154">**ControllerUrl**: adresa URL, kam bude jeden klient hostovat centrum kontrolérů.</span><span class="sxs-lookup"><span data-stu-id="b34d2-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="b34d2-155">Výchozí hodnota je null (žádné centrum řadičů).</span><span class="sxs-lookup"><span data-stu-id="b34d2-155">The default is null (no controller hub).</span></span> <span data-ttu-id="b34d2-156">Centrum kontrolérů se spustí při spuštění relace Crank; mezi centrem kontrolérů a Crank se neprovádí žádný další kontakt.</span><span class="sxs-lookup"><span data-stu-id="b34d2-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="b34d2-157">**NumClients**: počet simulovaných klientů, které se mají připojit k aplikaci.</span><span class="sxs-lookup"><span data-stu-id="b34d2-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="b34d2-158">Výchozí hodnota je jedna.</span><span class="sxs-lookup"><span data-stu-id="b34d2-158">The default is one.</span></span>
- <span data-ttu-id="b34d2-159">**Logfile**: název souboru protokolu pro testovací běh.</span><span class="sxs-lookup"><span data-stu-id="b34d2-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="b34d2-160">Výchozí formát je `crank.csv`.</span><span class="sxs-lookup"><span data-stu-id="b34d2-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="b34d2-161">**SampleInterval**: čas v milisekundách mezi ukázkami čítače výkonu.</span><span class="sxs-lookup"><span data-stu-id="b34d2-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="b34d2-162">Výchozí hodnota je 1000.</span><span class="sxs-lookup"><span data-stu-id="b34d2-162">The default is 1000.</span></span>
- <span data-ttu-id="b34d2-163">**SignalRInstance**: název instance pro čítače výkonu na serveru.</span><span class="sxs-lookup"><span data-stu-id="b34d2-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="b34d2-164">Ve výchozím nastavení se použije stav připojení klienta.</span><span class="sxs-lookup"><span data-stu-id="b34d2-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="b34d2-165">Příklad</span><span class="sxs-lookup"><span data-stu-id="b34d2-165">Example</span></span>

<span data-ttu-id="b34d2-166">Následující příkaz otestuje web s názvem `pfsignalr` v Azure, který hostuje aplikaci na portu 8080 s centrem s názvem "ControllerHub" s použitím připojení 100.</span><span class="sxs-lookup"><span data-stu-id="b34d2-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
