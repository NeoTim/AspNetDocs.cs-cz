---
uid: signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
title: 'Kurz: vysílání serveru pomocí ASP.NET signalizace 1. x | Microsoft Docs'
author: bradygaster
description: V tomto kurzu se dozvíte, jak vytvořit webovou aplikaci, která používá ASP.NET signál k poskytování funkcí všesměrového vysílání serveru. Všesměrové vysílání serveru znamená, že se jedná o obecnou...
ms.author: bradyg
ms.date: 04/10/2013
ms.assetid: ab7b2554-956a-4f6d-b2a0-4ae0c62e8580
msc.legacyurl: /signalr/overview/older-versions/tutorial-server-broadcast-with-aspnet-signalr
msc.type: authoredcontent
ms.openlocfilehash: 68908be34f6b010e512677fe5f5e31bfdefab592
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78579406"
---
# <a name="tutorial-server-broadcast-with-aspnet-signalr-1x"></a><span data-ttu-id="94d9a-104">Kurz: Serverové vysílání s knihovnou ASP.NET SignalR 1.x</span><span class="sxs-lookup"><span data-stu-id="94d9a-104">Tutorial: Server Broadcast with ASP.NET SignalR 1.x</span></span>

<span data-ttu-id="94d9a-105">autorem [Fletcher](https://github.com/pfletcher), který [Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="94d9a-105">by [Patrick Fletcher](https://github.com/pfletcher), [Tom Dykstra](https://github.com/tdykstra)</span></span>

[!INCLUDE [Consider ASP.NET Core SignalR](~/includes/signalr/signalr-version-disambiguation.md)]

> <span data-ttu-id="94d9a-106">V tomto kurzu se dozvíte, jak vytvořit webovou aplikaci, která používá ASP.NET signál k poskytování funkcí všesměrového vysílání serveru.</span><span class="sxs-lookup"><span data-stu-id="94d9a-106">This tutorial shows how to create a web application that uses ASP.NET SignalR to provide server broadcast functionality.</span></span> <span data-ttu-id="94d9a-107">Všesměrové vysílání serveru znamená, že se komunikace odesílaná klientům spouští serverem.</span><span class="sxs-lookup"><span data-stu-id="94d9a-107">Server broadcast means that communications sent to clients are initiated by the server.</span></span> <span data-ttu-id="94d9a-108">Tento scénář vyžaduje jiný programovací přístup než scénáře peer-to-peer, jako jsou například aplikace chatu, ve kterých je komunikace odesílaná klientům iniciována jedním nebo více klienty.</span><span class="sxs-lookup"><span data-stu-id="94d9a-108">This scenario requires a different programming approach than peer-to-peer scenarios such as chat applications, in which communications sent to clients are initiated by one or more of the clients.</span></span>
> 
> <span data-ttu-id="94d9a-109">Aplikace, kterou vytvoříte v tomto kurzu, simuluje burzovní, což je typický scénář pro funkce všesměrového vysílání serveru.</span><span class="sxs-lookup"><span data-stu-id="94d9a-109">The application that you'll create in this tutorial simulates a stock ticker, a typical scenario for server broadcast functionality.</span></span>
> 
> <span data-ttu-id="94d9a-110">Komentáře k tomuto kurzu jsou Vítá vás.</span><span class="sxs-lookup"><span data-stu-id="94d9a-110">Comments on the tutorial are welcome.</span></span> <span data-ttu-id="94d9a-111">Pokud máte dotazy, které přímo nesouvisejí s kurzem, můžete je publikovat do [fóra signálu ASP.NET](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) nebo [StackOverflow.com](http://stackoverflow.com).</span><span class="sxs-lookup"><span data-stu-id="94d9a-111">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET SignalR forum](https://forums.asp.net/1254.aspx/1?ASP+NET+SignalR) or [StackOverflow.com](http://stackoverflow.com).</span></span>

## <a name="overview"></a><span data-ttu-id="94d9a-112">Přehled</span><span class="sxs-lookup"><span data-stu-id="94d9a-112">Overview</span></span>

<span data-ttu-id="94d9a-113">Balíček NuGet [Microsoft. ASPNET. signale. Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet nainstaluje ukázku simulované burzovní aplikace v projektu Visual studia.</span><span class="sxs-lookup"><span data-stu-id="94d9a-113">The [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package installs a sample simulated stock ticker application in a Visual Studio project.</span></span> <span data-ttu-id="94d9a-114">V první části tohoto kurzu vytvoříte zjednodušenou verzi této aplikace od začátku.</span><span class="sxs-lookup"><span data-stu-id="94d9a-114">In the first part of this tutorial, you'll create a simplified version of that application from scratch.</span></span> <span data-ttu-id="94d9a-115">Ve zbývající části kurzu nainstalujete balíček NuGet a zkontrolujete další funkce a kód, které vytvoří.</span><span class="sxs-lookup"><span data-stu-id="94d9a-115">In the remainder of the tutorial, you'll install the NuGet package and review the additional features and code that it creates.</span></span>

<span data-ttu-id="94d9a-116">Burzovní aplikace se nachází jako zástupce druhu aplikace v reálném čase, ve kterém chcete pravidelně vysílat oznámení ze serveru do všech připojených klientů.</span><span class="sxs-lookup"><span data-stu-id="94d9a-116">The stock ticker application is a representative of a kind of real-time application in which you want to periodically "push," or broadcast, notifications from the server to all connected clients.</span></span>

<span data-ttu-id="94d9a-117">Aplikace, kterou sestavíte v první části tohoto kurzu, zobrazí mřížku s uloženými daty.</span><span class="sxs-lookup"><span data-stu-id="94d9a-117">The application that you'll build in the first part of this tutorial displays a grid with stock data.</span></span>

![Počáteční verze StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image1.png)

<span data-ttu-id="94d9a-119">Server pravidelně aktualizuje skladové ceny a nahraje aktualizace všem připojeným klientům.</span><span class="sxs-lookup"><span data-stu-id="94d9a-119">Periodically the server randomly updates stock prices and pushes the updates to all connected clients.</span></span> <span data-ttu-id="94d9a-120">V prohlížeči se v reakci na oznámení ze serveru dynamicky mění čísla a symboly ve sloupcích **Změna** a **%** .</span><span class="sxs-lookup"><span data-stu-id="94d9a-120">In the browser the numbers and symbols in the **Change** and **%** columns dynamically change in response to notifications from the server.</span></span> <span data-ttu-id="94d9a-121">Pokud otevřete další prohlížeče na stejné adrese URL, všechny zobrazí stejná data a stejné změny dat současně.</span><span class="sxs-lookup"><span data-stu-id="94d9a-121">If you open additional browsers to the same URL, they all show the same data and the same changes to the data simultaneously.</span></span>

<span data-ttu-id="94d9a-122">Tento kurz obsahuje následující oddíly:</span><span class="sxs-lookup"><span data-stu-id="94d9a-122">This tutorial contains the following sections:</span></span>

- [<span data-ttu-id="94d9a-123">Požadavky</span><span class="sxs-lookup"><span data-stu-id="94d9a-123">Prerequisites</span></span>](#prerequisites)
- [<span data-ttu-id="94d9a-124">Vytvořit projekt</span><span class="sxs-lookup"><span data-stu-id="94d9a-124">Create the project</span></span>](#createproject)
- [<span data-ttu-id="94d9a-125">Přidání balíčků NuGet pro signál</span><span class="sxs-lookup"><span data-stu-id="94d9a-125">Add the SignalR NuGet packages</span></span>](#nugetpackages)
- [<span data-ttu-id="94d9a-126">Nastavení serverového kódu</span><span class="sxs-lookup"><span data-stu-id="94d9a-126">Set up the server code</span></span>](#server)
- [<span data-ttu-id="94d9a-127">Nastavení kódu klienta</span><span class="sxs-lookup"><span data-stu-id="94d9a-127">Set up the client code</span></span>](#client)
- [<span data-ttu-id="94d9a-128">Testování aplikace</span><span class="sxs-lookup"><span data-stu-id="94d9a-128">Test the application</span></span>](#test)
- [<span data-ttu-id="94d9a-129">Povolení protokolování</span><span class="sxs-lookup"><span data-stu-id="94d9a-129">Enable logging</span></span>](#enablelogging)
- [<span data-ttu-id="94d9a-130">Instalace a kontrola úplné ukázky StockTicker</span><span class="sxs-lookup"><span data-stu-id="94d9a-130">Install and review the full StockTicker sample</span></span>](#fullsample)
- [<span data-ttu-id="94d9a-131">Další kroky</span><span class="sxs-lookup"><span data-stu-id="94d9a-131">Next steps</span></span>](#nextsteps)

> [!NOTE]
> <span data-ttu-id="94d9a-132">Pokud nechcete pracovat s postupem sestavování aplikace, můžete do nového **prázdného projektu webové aplikace ASP.NET** nainstalovat signál. ukázkový balíček a pomocí těchto kroků získat vysvětlení kódu.</span><span class="sxs-lookup"><span data-stu-id="94d9a-132">If you don't want to work through the steps of building the application, you can install the SignalR.Sample package in a new **Empty ASP.NET Web Application** project, and read through these steps to get explanations of the code.</span></span> <span data-ttu-id="94d9a-133">První část kurzu se zabývá podmnožinou signálu. vzorový kód a druhá část vysvětluje klíčové funkce dalších funkcí v nástroji Signal. Sample Package.</span><span class="sxs-lookup"><span data-stu-id="94d9a-133">The first part of the tutorial covers a subset of the SignalR.Sample code, and the second part explains key features of the additional functionality in the SignalR.Sample package.</span></span>

<a id="prerequisites"></a>

## <a name="prerequisites"></a><span data-ttu-id="94d9a-134">Předpoklady</span><span class="sxs-lookup"><span data-stu-id="94d9a-134">Prerequisites</span></span>

<span data-ttu-id="94d9a-135">Než začnete, ujistěte se, že máte v počítači nainstalovanou aplikaci Visual Studio 2012 nebo 2010 SP1.</span><span class="sxs-lookup"><span data-stu-id="94d9a-135">Before you start, make sure that you have Visual Studio 2012 or 2010 SP1 installed on your computer.</span></span> <span data-ttu-id="94d9a-136">Pokud nemáte Visual Studio, přečtěte si článek [ASP.NET downloads](https://www.asp.net/downloads) , kde získáte bezplatnou aplikaci visual Studio 2012 Express for Web.</span><span class="sxs-lookup"><span data-stu-id="94d9a-136">If you don't have Visual Studio, see [ASP.NET Downloads](https://www.asp.net/downloads) to get the free Visual Studio 2012 Express for Web.</span></span>

<span data-ttu-id="94d9a-137">Pokud máte Visual Studio 2010, ujistěte se, že je nainstalováno [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) .</span><span class="sxs-lookup"><span data-stu-id="94d9a-137">If you have Visual Studio 2010, make sure that [NuGet](https://visualstudiogallery.msdn.microsoft.com/27077b70-9dad-4c64-adcf-c7cf6bc9970c) is installed.</span></span>

<a id="createproject"></a>

## <a name="create-the-project"></a><span data-ttu-id="94d9a-138">Vytvoření projektu</span><span class="sxs-lookup"><span data-stu-id="94d9a-138">Create the project</span></span>

1. <span data-ttu-id="94d9a-139">V nabídce **soubor** klikněte na příkaz **Nový projekt**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-139">From the **File** menu click **New Project**.</span></span>
2. <span data-ttu-id="94d9a-140">V dialogovém okně **Nový projekt** rozbalte **C#** v části **šablony** a vyberte možnost **Web**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-140">In the **New Project** dialog box, expand **C#** under **Templates** and select **Web**.</span></span>
3. <span data-ttu-id="94d9a-141">Vyberte šablonu **ASP.NET prázdné webové aplikace** , pojmenujte ho *signaler. StockTicker*a klikněte na **OK**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-141">Select the **ASP.NET Empty Web Application** template, name the project *SignalR.StockTicker*, and click **OK**.</span></span>

    ![Dialogové okno Nový projekt](tutorial-server-broadcast-with-aspnet-signalr/_static/image2.png)

<a id="nugetpackages"></a>

## <a name="add-the-signalr-nuget-packages"></a><span data-ttu-id="94d9a-143">Přidání balíčků NuGet pro signál</span><span class="sxs-lookup"><span data-stu-id="94d9a-143">Add the SignalR NuGet Packages</span></span>

### <a name="add-the-signalr-and-jquery-nuget-packages"></a><span data-ttu-id="94d9a-144">Přidání balíčků Signal a JQuery NuGet</span><span class="sxs-lookup"><span data-stu-id="94d9a-144">Add the SignalR and JQuery NuGet Packages</span></span>

<span data-ttu-id="94d9a-145">Pomocí instalace balíčku NuGet můžete do projektu přidat funkci signalizace.</span><span class="sxs-lookup"><span data-stu-id="94d9a-145">You can add SignalR functionality to a project by installing a NuGet package.</span></span>

1. <span data-ttu-id="94d9a-146">Klikněte na **nástroje | Správce balíčků NuGet | Konzola správce balíčků**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-146">Click **Tools | NuGet Package Manager | Package Manager Console**.</span></span>
2. <span data-ttu-id="94d9a-147">Ve Správci balíčků zadejte následující příkaz.</span><span class="sxs-lookup"><span data-stu-id="94d9a-147">Enter the following command in the package manager.</span></span>

    [!code-powershell[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample1.ps1)]

    <span data-ttu-id="94d9a-148">Balíček signalizace nainstaluje několik dalších balíčků NuGet jako závislosti.</span><span class="sxs-lookup"><span data-stu-id="94d9a-148">The SignalR package installs a number of other NuGet packages as dependencies.</span></span> <span data-ttu-id="94d9a-149">Po dokončení instalace máte všechny součásti serveru a klienta, které jsou nutné k použití signalizace v aplikaci ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="94d9a-149">When the installation is finished you have all of the server and client components required to use SignalR in an ASP.NET application.</span></span>

<a id="server"></a>

## <a name="set-up-the-server-code"></a><span data-ttu-id="94d9a-150">Nastavení serverového kódu</span><span class="sxs-lookup"><span data-stu-id="94d9a-150">Set up the server code</span></span>

<span data-ttu-id="94d9a-151">V této části nastavíte kód, který běží na serveru.</span><span class="sxs-lookup"><span data-stu-id="94d9a-151">In this section you set up the code that runs on the server.</span></span>

### <a name="create-the-stock-class"></a><span data-ttu-id="94d9a-152">Vytvoření třídy akcie</span><span class="sxs-lookup"><span data-stu-id="94d9a-152">Create the Stock class</span></span>

<span data-ttu-id="94d9a-153">Začnete vytvořením třídy burzovního modelu, kterou použijete k ukládání a přenosu informací o zásobách.</span><span class="sxs-lookup"><span data-stu-id="94d9a-153">You begin by creating the Stock model class that you'll use to store and transmit information about a stock.</span></span>

1. <span data-ttu-id="94d9a-154">Vytvořte nový soubor třídy ve složce projektu a pojmenujte jej *Stock.cs*a potom kód šablony nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="94d9a-154">Create a new class file in the project folder, name it *Stock.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample2.cs)]

    <span data-ttu-id="94d9a-155">Tyto dvě vlastnosti, které nastavíte při vytváření akcií, jsou symbolem (například MSFT pro Microsoft) a cenou.</span><span class="sxs-lookup"><span data-stu-id="94d9a-155">The two properties that you'll set when you create stocks are the Symbol (for example, MSFT for Microsoft) and the Price.</span></span> <span data-ttu-id="94d9a-156">Ostatní vlastnosti závisí na tom, jak a kdy jste nastavili cenu.</span><span class="sxs-lookup"><span data-stu-id="94d9a-156">The other properties depend on how and when you set Price.</span></span> <span data-ttu-id="94d9a-157">Při prvním nastavení ceny se hodnota rozšíří na DayOpen.</span><span class="sxs-lookup"><span data-stu-id="94d9a-157">The first time you set Price, the value gets propagated to DayOpen.</span></span> <span data-ttu-id="94d9a-158">Po dalším nastavování ceny se hodnoty vlastností Change a PercentChange vypočítávají na základě rozdílu mezi cenou a DayOpen.</span><span class="sxs-lookup"><span data-stu-id="94d9a-158">Subsequent times when you set Price, the Change and PercentChange property values are calculated based on the difference between Price and DayOpen.</span></span>

### <a name="create-the-stockticker-and-stocktickerhub-classes"></a><span data-ttu-id="94d9a-159">Vytvoření tříd StockTicker a StockTickerHub</span><span class="sxs-lookup"><span data-stu-id="94d9a-159">Create the StockTicker and StockTickerHub classes</span></span>

<span data-ttu-id="94d9a-160">K řízení interakce mezi klientem a serverem použijete rozhraní API centra signalizace.</span><span class="sxs-lookup"><span data-stu-id="94d9a-160">You'll use the SignalR Hub API to handle server-to-client interaction.</span></span> <span data-ttu-id="94d9a-161">Třída StockTickerHub, která je odvozena z třídy centra signálů, bude zpracovávat přijímání připojení a volání metod od klientů.</span><span class="sxs-lookup"><span data-stu-id="94d9a-161">A StockTickerHub class that derives from the SignalR Hub class will handle receiving connections and method calls from clients.</span></span> <span data-ttu-id="94d9a-162">Je také potřeba zachovat skladová data a spustit objekt časovače, aby pravidelně spouštěl cenové aktualizace, nezávisle na připojeních klienta.</span><span class="sxs-lookup"><span data-stu-id="94d9a-162">You also need to maintain stock data and run a Timer object to periodically trigger price updates, independently of client connections.</span></span> <span data-ttu-id="94d9a-163">Tyto funkce nemůžete umístit do třídy centra, protože instance centra jsou přechodné.</span><span class="sxs-lookup"><span data-stu-id="94d9a-163">You can't put these functions in a Hub class, because Hub instances are transient.</span></span> <span data-ttu-id="94d9a-164">Instance třídy centra se vytvoří pro každou operaci na rozbočovači, například připojení a volání z klienta na server.</span><span class="sxs-lookup"><span data-stu-id="94d9a-164">A Hub class instance is created for each operation on the hub, such as connections and calls from the client to the server.</span></span> <span data-ttu-id="94d9a-165">Proto mechanismus, který udržuje skladová data, aktualizuje ceny a vysílá, je nutné, aby se aktualizace ceny spouštěly v samostatné třídě, kterou pojmenovat StockTicker.</span><span class="sxs-lookup"><span data-stu-id="94d9a-165">So the mechanism that keeps stock data, updates prices, and broadcasts the price updates has to run in a separate class, which you'll name StockTicker.</span></span>

![Všesměrové vysílání z StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image4.png)

<span data-ttu-id="94d9a-167">Chcete, aby na serveru běžela jenom jedna instance třídy StockTicker, takže budete muset nastavit odkaz z každé instance StockTickerHub na instanci StockTicker typu singleton.</span><span class="sxs-lookup"><span data-stu-id="94d9a-167">You only want one instance of the StockTicker class to run on the server, so you'll need to set up a reference from each StockTickerHub instance to the singleton StockTicker instance.</span></span> <span data-ttu-id="94d9a-168">Třída StockTicker musí umožňovat všesměrové vysílání klientům, protože má uložená data a aktivuje aktualizace, ale StockTicker není třída centra.</span><span class="sxs-lookup"><span data-stu-id="94d9a-168">The StockTicker class has to be able to broadcast to clients because it has the stock data and triggers updates, but StockTicker is not a Hub class.</span></span> <span data-ttu-id="94d9a-169">Třída StockTicker proto musí získat odkaz na objekt kontextu připojení centra signalizace.</span><span class="sxs-lookup"><span data-stu-id="94d9a-169">Therefore, the StockTicker class has to get a reference to the SignalR Hub connection context object.</span></span> <span data-ttu-id="94d9a-170">Pak může pomocí objektu kontextu připojení vysílače vysílat klientům.</span><span class="sxs-lookup"><span data-stu-id="94d9a-170">It can then use the SignalR connection context object to broadcast to clients.</span></span>

1. <span data-ttu-id="94d9a-171">V **Průzkumník řešení**klikněte pravým tlačítkem myši na projekt a klikněte na příkaz **Přidat novou položku**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-171">In **Solution Explorer**, right-click the project and click **Add New Item**.</span></span>
2. <span data-ttu-id="94d9a-172">Pokud máte Visual Studio 2012 s [aktualizací ASP.NET and Web Tools 2012,2](https://go.microsoft.com/fwlink/?LinkId=279941), klikněte v části  **C# vizuál** na **Web** a vyberte šablonu položky **Třída rozbočovače signálu** .</span><span class="sxs-lookup"><span data-stu-id="94d9a-172">If you have Visual Studio 2012 with the [ASP.NET and Web Tools 2012.2 Update](https://go.microsoft.com/fwlink/?LinkId=279941), click **Web** under **Visual C#** and select the **SignalR Hub Class** item template.</span></span> <span data-ttu-id="94d9a-173">V opačném případě vyberte šablonu **třídy** .</span><span class="sxs-lookup"><span data-stu-id="94d9a-173">Otherwise, select the **Class** template.</span></span>
3. <span data-ttu-id="94d9a-174">Pojmenujte novou třídu *StockTickerHub.cs*a pak klikněte na **Přidat**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-174">Name the new class *StockTickerHub.cs*, and then click **Add**.</span></span>

    ![Přidat StockTickerHub.cs](tutorial-server-broadcast-with-aspnet-signalr/_static/image5.png)
4. <span data-ttu-id="94d9a-176">Nahraďte kód šablony následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="94d9a-176">Replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample3.cs)]

    <span data-ttu-id="94d9a-177">Třída [centra](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) se používá k definování metod, které mohou klienti volat na serveru.</span><span class="sxs-lookup"><span data-stu-id="94d9a-177">The [Hub](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hub(v=vs.111).aspx) class is used to define methods the clients can call on the server.</span></span> <span data-ttu-id="94d9a-178">Definujete jednu metodu: `GetAllStocks()`.</span><span class="sxs-lookup"><span data-stu-id="94d9a-178">You are defining one method: `GetAllStocks()`.</span></span> <span data-ttu-id="94d9a-179">Když se klient poprvé připojí k serveru, zavolá tuto metodu, aby získal seznam všech populací s jejich aktuálními cenami.</span><span class="sxs-lookup"><span data-stu-id="94d9a-179">When a client initially connects to the server, it will call this method to get a list of all of the stocks with their current prices.</span></span> <span data-ttu-id="94d9a-180">Metoda může provádět synchronní a vracet `IEnumerable<Stock>`, protože vrací data z paměti.</span><span class="sxs-lookup"><span data-stu-id="94d9a-180">The method can execute synchronously and return `IEnumerable<Stock>` because it is returning data from memory.</span></span> <span data-ttu-id="94d9a-181">Pokud metoda musela získat data pomocí něčeho, co by vyžadovala čekání, například vyhledávání databáze nebo volání webové služby, zadejte `Task<IEnumerable<Stock>>` jako návratovou hodnotu pro povolení asynchronního zpracování.</span><span class="sxs-lookup"><span data-stu-id="94d9a-181">If the method had to get the data by doing something that would involve waiting, such as a database lookup or a web service call, you would specify `Task<IEnumerable<Stock>>` as the return value to enable asynchronous processing.</span></span> <span data-ttu-id="94d9a-182">Další informace najdete v tématu [Průvodce rozhraním API pro centra ASP.NET signálu – Server – kdy se má provést asynchronní spuštění](index.md).</span><span class="sxs-lookup"><span data-stu-id="94d9a-182">For more information, see [ASP.NET SignalR Hubs API Guide - Server - When to execute asynchronously](index.md).</span></span>

    <span data-ttu-id="94d9a-183">Atribut HubName určuje, jak bude v klientovi odkazováno na centrum JavaScript Code.</span><span class="sxs-lookup"><span data-stu-id="94d9a-183">The HubName attribute specifies how the Hub will be referenced in JavaScript code on the client.</span></span> <span data-ttu-id="94d9a-184">Výchozí název na klientovi Pokud nepoužíváte tento atribut, je ve stylu CamelCase verze použita názvu třídy, což v tomto případě by bylo stockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="94d9a-184">The default name on the client if you don't use this attribute is a camel-cased version of the class name, which in this case would be stockTickerHub.</span></span>

    <span data-ttu-id="94d9a-185">Jak uvidíte později při vytváření třídy StockTicker, vytvoří se instance singleton této třídy ve vlastnosti statické instance.</span><span class="sxs-lookup"><span data-stu-id="94d9a-185">As you'll see later when you create the StockTicker class, a singleton instance of that class is created in its static Instance property.</span></span> <span data-ttu-id="94d9a-186">Tato instance typu Singleton StockTicker zůstává v paměti bez ohledu na to, kolik klientů se připojuje nebo odpojuje a že tato instance je to, co metoda GetAllStocks používá k vrácení aktuálních informací o zásobách.</span><span class="sxs-lookup"><span data-stu-id="94d9a-186">That singleton instance of StockTicker remains in memory no matter how many clients connect or disconnect, and that instance is what the GetAllStocks method uses to return current stock information.</span></span>
5. <span data-ttu-id="94d9a-187">Vytvořte nový soubor třídy ve složce projektu a pojmenujte jej *StockTicker.cs*a potom kód šablony nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="94d9a-187">Create a new class file in the project folder, name it *StockTicker.cs*, and then replace the template code with the following code:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample4.cs)]

    <span data-ttu-id="94d9a-188">Vzhledem k tomu, že více vláken bude používat stejnou instanci StockTicker kódu, musí být třída StockTicker threadsafe.</span><span class="sxs-lookup"><span data-stu-id="94d9a-188">Since multiple threads will be running the same instance of StockTicker code, the StockTicker class has to be threadsafe.</span></span>

    ### <a name="storing-the-singleton-instance-in-a-static-field"></a><span data-ttu-id="94d9a-189">Ukládání instance singleton do statického pole</span><span class="sxs-lookup"><span data-stu-id="94d9a-189">Storing the singleton instance in a static field</span></span>

    <span data-ttu-id="94d9a-190">Kód inicializuje pole instance statického \_, které vrátí vlastnost instance s instancí třídy, a toto je jediná instance třídy, kterou lze vytvořit, protože konstruktor je označen jako Private.</span><span class="sxs-lookup"><span data-stu-id="94d9a-190">The code initializes the static \_instance field that backs the Instance property with an instance of the class, and this is the only instance of the class that can be created, because the constructor is marked as private.</span></span> <span data-ttu-id="94d9a-191">[Opožděná inicializace](https://msdn.microsoft.com/library/dd997286.aspx) se používá pro pole \_instance, nikoli z důvodů výkonu, ale pro zajištění, že je vytvoření instance threadsafe.</span><span class="sxs-lookup"><span data-stu-id="94d9a-191">[Lazy initialization](https://msdn.microsoft.com/library/dd997286.aspx) is used for the \_instance field, not for performance reasons but to ensure that the instance creation is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample5.cs)]

    <span data-ttu-id="94d9a-192">Pokaždé, když se klient připojí k serveru, nová instance třídy StockTickerHub spuštěné v samostatném vlákně získá instanci StockTicker singleton z statické vlastnosti StockTicker. instance, jak jste viděli dříve ve třídě StockTickerHub.</span><span class="sxs-lookup"><span data-stu-id="94d9a-192">Each time a client connects to the server, a new instance of the StockTickerHub class running in a separate thread gets the StockTicker singleton instance from the StockTicker.Instance static property, as you saw earlier in the StockTickerHub class.</span></span>

    ### <a name="storing-stock-data-in-a-concurrentdictionary"></a><span data-ttu-id="94d9a-193">Ukládání uložených dat v ConcurrentDictionary</span><span class="sxs-lookup"><span data-stu-id="94d9a-193">Storing stock data in a ConcurrentDictionary</span></span>

    <span data-ttu-id="94d9a-194">Konstruktor inicializuje kolekci \_ch populací s některými vzorovými daty a GetAllStocks vrátí akcie.</span><span class="sxs-lookup"><span data-stu-id="94d9a-194">The constructor initializes the \_stocks collection with some sample stock data, and GetAllStocks returns the stocks.</span></span> <span data-ttu-id="94d9a-195">Jak jste viděli dříve, tato kolekce populací se zase vrací pomocí StockTickerHub. GetAllStocks, což je metoda serveru ve třídě centra, kterou můžou klienti volat.</span><span class="sxs-lookup"><span data-stu-id="94d9a-195">As you saw earlier, this collection of stocks is in turn returned by StockTickerHub.GetAllStocks which is a server method in the Hub class that clients can call.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample6.cs)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample7.cs)]

    <span data-ttu-id="94d9a-196">Kolekce akcie je definována jako [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) typ pro bezpečnost vlákna.</span><span class="sxs-lookup"><span data-stu-id="94d9a-196">The stocks collection is defined as a [ConcurrentDictionary](https://msdn.microsoft.com/library/dd287191.aspx) type for thread safety.</span></span> <span data-ttu-id="94d9a-197">Jako alternativu můžete použít objekt [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) a explicitně zamknout slovník při provádění změn v něm.</span><span class="sxs-lookup"><span data-stu-id="94d9a-197">As an alternative, you could use a [Dictionary](https://msdn.microsoft.com/library/xfhwa508.aspx) object and explicitly lock the dictionary when you make changes to it.</span></span>

    <span data-ttu-id="94d9a-198">Pro tuto ukázkovou aplikaci je možné uložit data aplikace do paměti a ztratit data, když je instance StockTicker vyřazena.</span><span class="sxs-lookup"><span data-stu-id="94d9a-198">For this sample application, it's OK to store application data in memory and to lose the data when the StockTicker instance is disposed.</span></span> <span data-ttu-id="94d9a-199">V reálné aplikaci byste pracovali s back-end datovým úložištěm, jako je databáze.</span><span class="sxs-lookup"><span data-stu-id="94d9a-199">In a real application you would work with a back-end data store such as a database.</span></span>

    ### <a name="periodically-updating-stock-prices"></a><span data-ttu-id="94d9a-200">Pravidelná aktualizace cen akcií</span><span class="sxs-lookup"><span data-stu-id="94d9a-200">Periodically updating stock prices</span></span>

    <span data-ttu-id="94d9a-201">Konstruktor spustí objekt Timer, který pravidelně volá metody, které aktualizují skladové ceny náhodným základem.</span><span class="sxs-lookup"><span data-stu-id="94d9a-201">The constructor starts up a Timer object that periodically calls methods that update stock prices on a random basis.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample8.cs)]

    <span data-ttu-id="94d9a-202">UpdateStockPrices je volána časovačem, který předává hodnotu null v parametru State.</span><span class="sxs-lookup"><span data-stu-id="94d9a-202">UpdateStockPrices is called by the Timer, which passes in null in the state parameter.</span></span> <span data-ttu-id="94d9a-203">Před aktualizací cen se na \_objekt updateStockPricesLock zavede zámek.</span><span class="sxs-lookup"><span data-stu-id="94d9a-203">Before updating prices, a lock is taken on the \_updateStockPricesLock object.</span></span> <span data-ttu-id="94d9a-204">Kód zkontroluje, jestli už jiný podproces aktualizuje ceny, a pak na každou populaci v seznamu zavolá TryUpdateStockPrice.</span><span class="sxs-lookup"><span data-stu-id="94d9a-204">The code checks if another thread is already updating prices, and then it calls TryUpdateStockPrice on each stock in the list.</span></span> <span data-ttu-id="94d9a-205">Metoda TryUpdateStockPrice rozhoduje o tom, jestli se má změnit cena akcií, a kolik se má změnit.</span><span class="sxs-lookup"><span data-stu-id="94d9a-205">The TryUpdateStockPrice method decides whether to change the stock price, and how much to change it.</span></span> <span data-ttu-id="94d9a-206">Pokud dojde ke změně ceny akcií, BroadcastStockPrice se zavolá, aby se změnila cena za zásobu u všech připojených klientů.</span><span class="sxs-lookup"><span data-stu-id="94d9a-206">If the stock price is changed, BroadcastStockPrice is called to broadcast the stock price change to all connected clients.</span></span>

    <span data-ttu-id="94d9a-207">Příznak \_updatingStockPrices je označený jako [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) , aby se zajistilo, že přístup k němu je threadsafe.</span><span class="sxs-lookup"><span data-stu-id="94d9a-207">The \_updatingStockPrices flag is marked as [volatile](https://msdn.microsoft.com/library/x13ttww7.aspx) to ensure that access to it is threadsafe.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample9.cs)]

    <span data-ttu-id="94d9a-208">V reálné aplikaci metoda TryUpdateStockPrice zavolá webovou službu, aby vyhledala cenu. v tomto kódu používá generátor náhodných čísel k náhodnému provedení změn.</span><span class="sxs-lookup"><span data-stu-id="94d9a-208">In a real application, the TryUpdateStockPrice method would call a web service to look up the price; in this code it uses a random number generator to make changes randomly.</span></span>

    ### <a name="getting-the-signalr-context-so-that-the-stockticker-class-can-broadcast-to-clients"></a><span data-ttu-id="94d9a-209">Získání kontextu signálu, aby třída StockTicker mohla vysílat klientům</span><span class="sxs-lookup"><span data-stu-id="94d9a-209">Getting the SignalR context so that the StockTicker class can broadcast to clients</span></span>

    <span data-ttu-id="94d9a-210">Vzhledem k tomu, že změny ceny pocházejí zde v objektu StockTicker, jedná se o objekt, který musí volat metodu updateStockPrice na všech připojených klientech.</span><span class="sxs-lookup"><span data-stu-id="94d9a-210">Because the price changes originate here in the StockTicker object, this is the object that needs to call an updateStockPrice method on all connected clients.</span></span> <span data-ttu-id="94d9a-211">Ve třídě centra máte rozhraní API pro volání metod klienta, ale StockTicker není odvozeno od třídy hub a nemá odkaz na žádný objekt hub.</span><span class="sxs-lookup"><span data-stu-id="94d9a-211">In a Hub class you have an API for calling client methods, but StockTicker does not derive from the Hub class and does not have a reference to any Hub object.</span></span> <span data-ttu-id="94d9a-212">Aby bylo proto možné vysílat klientům připojeným, třída StockTicker musí získat kontextovou instanci signálu pro třídu StockTickerHub a použít ji k volání metod v klientech.</span><span class="sxs-lookup"><span data-stu-id="94d9a-212">Therefore, in order to broadcast to connected clients, the StockTicker class has to get the SignalR context instance for the StockTickerHub class and use that to call methods on clients.</span></span>

    <span data-ttu-id="94d9a-213">Kód získá odkaz na kontext signalizace při vytvoření instance třídy singleton, předá tento odkaz na konstruktor a konstruktor ho vloží do vlastnosti klienti.</span><span class="sxs-lookup"><span data-stu-id="94d9a-213">The code gets a reference to the SignalR context when it creates the singleton class instance, passes that reference to the constructor, and the constructor puts it in the Clients property.</span></span>

    <span data-ttu-id="94d9a-214">Existují dva důvody, proč chcete kontext získat pouze jednou: získání kontextu je náročná operace a jeho získání je zajištěno, že se zachová zamýšlené pořadí zpráv odesílaných klientům.</span><span class="sxs-lookup"><span data-stu-id="94d9a-214">There are two reasons why you want to get the context just once: getting the context is an expensive operation, and getting it once ensures that the intended order of messages sent to clients is preserved.</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample10.cs)]

    <span data-ttu-id="94d9a-215">Získání vlastnosti klientů kontextu a jeho vložení do vlastnosti StockTickerClient umožňuje napsat kód pro volání klientských metod, které vypadají stejně jako ve třídě centra.</span><span class="sxs-lookup"><span data-stu-id="94d9a-215">Getting the Clients property of the context and putting it in the StockTickerClient property lets you write code to call client methods that looks the same as it would in a Hub class.</span></span> <span data-ttu-id="94d9a-216">Například pro všesměrové vysílání pro všechny klienty můžete napsat clients. All. updateStockPrice (Stock).</span><span class="sxs-lookup"><span data-stu-id="94d9a-216">For instance, to broadcast to all clients you can write Clients.All.updateStockPrice(stock).</span></span>

    <span data-ttu-id="94d9a-217">Metoda updateStockPrice, kterou voláte v BroadcastStockPrice, ještě neexistuje. později ji přidáte při psaní kódu, který běží na klientovi.</span><span class="sxs-lookup"><span data-stu-id="94d9a-217">The updateStockPrice method that you are calling in BroadcastStockPrice doesn't exist yet; you'll add it later when you write code that runs on the client.</span></span> <span data-ttu-id="94d9a-218">Sem můžete odkazovat na updateStockPrice, protože klienti. All jsou dynamické, což znamená, že se výraz vyhodnotí za běhu.</span><span class="sxs-lookup"><span data-stu-id="94d9a-218">You can refer to updateStockPrice here because Clients.All is dynamic, which means the expression will be evaluated at runtime.</span></span> <span data-ttu-id="94d9a-219">Když se spustí toto volání metody, odesílatel pošle do klienta název metody a hodnotu parametru. Pokud má klient metodu s názvem updateStockPrice, bude tato metoda volána a hodnota parametru bude předána.</span><span class="sxs-lookup"><span data-stu-id="94d9a-219">When this method call executes, SignalR will send the method name and the parameter value to the client, and if the client has a method named updateStockPrice, that method will be called and the parameter value will be passed to it.</span></span>

    <span data-ttu-id="94d9a-220">Klienti. All znamená odeslání všem klientům.</span><span class="sxs-lookup"><span data-stu-id="94d9a-220">Clients.All means send to all clients.</span></span> <span data-ttu-id="94d9a-221">Signalizace nabízí další možnosti určení klientů nebo skupin klientů, které se mají odeslat.</span><span class="sxs-lookup"><span data-stu-id="94d9a-221">SignalR gives you other options to specify which clients or groups of clients to send to.</span></span> <span data-ttu-id="94d9a-222">Další informace najdete v tématu [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span><span class="sxs-lookup"><span data-stu-id="94d9a-222">For more information, see [HubConnectionContext](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubs.hubconnectioncontext(v=vs.111).aspx).</span></span>

### <a name="register-the-signalr-route"></a><span data-ttu-id="94d9a-223">Registrace trasy signalizace</span><span class="sxs-lookup"><span data-stu-id="94d9a-223">Register the SignalR route</span></span>

<span data-ttu-id="94d9a-224">Server musí znát, která adresa URL má zachytit a směrovat na signál.</span><span class="sxs-lookup"><span data-stu-id="94d9a-224">The server needs to know which URL to intercept and direct to SignalR.</span></span> <span data-ttu-id="94d9a-225">K tomu je třeba přidat kód do souboru *Global. asax* .</span><span class="sxs-lookup"><span data-stu-id="94d9a-225">To do that you'll add some code to the *Global.asax* file.</span></span>

1. <span data-ttu-id="94d9a-226">V **Průzkumník řešení**klikněte pravým tlačítkem myši na projekt a potom klikněte na tlačítko **Přidat novou položku**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-226">In **Solution Explorer**, right-click the project, and then click **Add New Item**.</span></span>
2. <span data-ttu-id="94d9a-227">Vyberte šablonu položky **globální třídy aplikace** a klikněte na tlačítko **Přidat**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-227">Select the **Global Application Class** item template, and then click **Add**.</span></span>

    ![Add global.asax](tutorial-server-broadcast-with-aspnet-signalr/_static/image6.png)
3. <span data-ttu-id="94d9a-229">Přidejte registrační kód trasy signalizace do aplikace\_spustit metodu:</span><span class="sxs-lookup"><span data-stu-id="94d9a-229">Add the SignalR route registration code to the Application\_Start method:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample11.cs)]

    <span data-ttu-id="94d9a-230">Ve výchozím nastavení je základní adresa URL pro všechny přenosy signálu "/SignalR" a "/SignalR/Hubs" se používá k načtení dynamicky generovaného souboru JavaScriptu, který definuje proxy pro všechna centra ve vaší aplikaci.</span><span class="sxs-lookup"><span data-stu-id="94d9a-230">By default, the base URL for all SignalR traffic is "/signalr", and "/signalr/hubs" is used to retrieve a dynamically generated JavaScript file that defines proxies for all the Hubs you have in your application.</span></span> <span data-ttu-id="94d9a-231">Metoda MapHubs zahrnuje přetížení, která umožňují zadat jinou základní adresu URL a určité možnosti signalizace v instanci třídy [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) .</span><span class="sxs-lookup"><span data-stu-id="94d9a-231">The MapHubs method includes overloads that let you specify a different base URL and certain SignalR options in an instance of the [HubConfiguration](https://msdn.microsoft.com/library/microsoft.aspnet.signalr.hubconfiguration(v=vs.111).aspx) class.</span></span>
4. <span data-ttu-id="94d9a-232">Do horní části souboru přidejte příkaz using:</span><span class="sxs-lookup"><span data-stu-id="94d9a-232">Add a using statement at the top of the file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample12.cs)]
5. <span data-ttu-id="94d9a-233">Uložte a zavřete soubor *Global. asax* a sestavte projekt.</span><span class="sxs-lookup"><span data-stu-id="94d9a-233">Save and close the *Global.asax* file, and build the project.</span></span>

<span data-ttu-id="94d9a-234">Nyní jste dokončili nastavení kódu serveru.</span><span class="sxs-lookup"><span data-stu-id="94d9a-234">You have now completed setting up the server code.</span></span> <span data-ttu-id="94d9a-235">V další části nastavíte klienta.</span><span class="sxs-lookup"><span data-stu-id="94d9a-235">In the next section you'll set up the client.</span></span>

<a id="client"></a>

## <a name="set-up-the-client-code"></a><span data-ttu-id="94d9a-236">Nastavení kódu klienta</span><span class="sxs-lookup"><span data-stu-id="94d9a-236">Set up the client code</span></span>

1. <span data-ttu-id="94d9a-237">Vytvořte nový soubor HTML ve složce projektu a pojmenujte jej *StockTicker. html*.</span><span class="sxs-lookup"><span data-stu-id="94d9a-237">Create a new HTML file in the project folder, and name it *StockTicker.html*.</span></span>
2. <span data-ttu-id="94d9a-238">Nahraďte kód šablony následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="94d9a-238">Replace the template code with the following code:</span></span>

    [!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample13.html)]

    <span data-ttu-id="94d9a-239">HTML vytvoří tabulku s 5 sloupci, řádkem záhlaví a datovým řádkem s jedinou buňkou, která zahrnuje všechny 5 sloupců.</span><span class="sxs-lookup"><span data-stu-id="94d9a-239">The HTML creates a table with 5 columns, a header row, and a data row with a single cell that spans all 5 columns.</span></span> <span data-ttu-id="94d9a-240">Řádek data zobrazí "načítání..." a zobrazí se pouze při spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="94d9a-240">The data row displays "loading..." and will only be shown momentarily when the application starts.</span></span> <span data-ttu-id="94d9a-241">JavaScriptový kód odstraní tento řádek a přidá ho do svých řádků s uloženými daty načtenými ze serveru.</span><span class="sxs-lookup"><span data-stu-id="94d9a-241">JavaScript code will remove that row and add in its place rows with stock data retrieved from the server.</span></span>

    <span data-ttu-id="94d9a-242">Značky skriptu určují soubor skriptu jQuery, základní soubor skriptu signálu, soubor skriptu proxy signalizace a soubor skriptu StockTicker, který vytvoříte později.</span><span class="sxs-lookup"><span data-stu-id="94d9a-242">The script tags specify the jQuery script file, the SignalR core script file, the SignalR proxies script file, and a StockTicker script file that you'll create later.</span></span> <span data-ttu-id="94d9a-243">Soubor skriptu proxy signálů, který určuje adresu URL "/SignalR/Hubs", je dynamicky generován a definuje metody proxy pro metody ve třídě centra, v tomto případě pro StockTickerHub. GetAllStocks.</span><span class="sxs-lookup"><span data-stu-id="94d9a-243">The SignalR proxies script file, which specifies the "/signalr/hubs" URL, is dynamically generated and defines proxy methods for the methods on the Hub class, in this case for StockTickerHub.GetAllStocks.</span></span> <span data-ttu-id="94d9a-244">Pokud budete chtít, můžete tento soubor JavaScriptu vygenerovat ručně pomocí [nástrojů pro signalizaci](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) a zakázat dynamické vytváření souborů ve volání metody MapHubs.</span><span class="sxs-lookup"><span data-stu-id="94d9a-244">If you prefer, you can generate this JavaScript file manually by using [SignalR Utilities](http://nuget.org/packages/Microsoft.AspNet.SignalR.Utils/) and disable dynamic file creation in the MapHubs method call.</span></span>
3. > [!IMPORTANT]
   > <span data-ttu-id="94d9a-245">Ujistěte se, že odkazy na soubory JavaScriptu v souboru *StockTicker. html* jsou správné.</span><span class="sxs-lookup"><span data-stu-id="94d9a-245">Make sure that the JavaScript file references in *StockTicker.html* are correct.</span></span> <span data-ttu-id="94d9a-246">To znamená, že verze jQuery ve značce Script (1.8.2 v příkladu) je stejná jako verze jQuery ve složce Scripts vašeho projektu a ujistěte se, že verze signalizace ve značce skriptu je stejná jako verze signalizace *ve složce* *skriptů* vašeho projektu.</span><span class="sxs-lookup"><span data-stu-id="94d9a-246">That is, make sure that the jQuery version in your script tag (1.8.2 in the example) is the same as the jQuery version in your project's *Scripts* folder, and make sure that the SignalR version in your script tag is the same as the SignalR version in your project's *Scripts* folder.</span></span> <span data-ttu-id="94d9a-247">V případě potřeby změňte názvy souborů ve značkách skriptu.</span><span class="sxs-lookup"><span data-stu-id="94d9a-247">Change the file names in the script tags if necessary.</span></span>
4. <span data-ttu-id="94d9a-248">V **Průzkumník řešení**klikněte pravým tlačítkem na *StockTicker. html*a pak klikněte na **nastavit jako úvodní stránku**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-248">In **Solution Explorer**, right-click *StockTicker.html*, and then click **Set as Start Page**.</span></span>
5. <span data-ttu-id="94d9a-249">Vytvořte nový soubor JavaScriptu ve složce projektu a pojmenujte ho *StockTicker. js*.</span><span class="sxs-lookup"><span data-stu-id="94d9a-249">Create a new JavaScript file in the project folder and name it *StockTicker.js*..</span></span>
6. <span data-ttu-id="94d9a-250">Nahraďte kód šablony následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="94d9a-250">Replace the template code with the following code:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample14.js)]

    <span data-ttu-id="94d9a-251">$. připojení odkazuje na proxy signálů.</span><span class="sxs-lookup"><span data-stu-id="94d9a-251">$.connection refers to the SignalR proxies.</span></span> <span data-ttu-id="94d9a-252">Kód získá odkaz na proxy třídu pro třídu StockTickerHub a umístí ji do proměnné Tick.</span><span class="sxs-lookup"><span data-stu-id="94d9a-252">The code gets a reference to the proxy for the StockTickerHub class and puts it in the ticker variable.</span></span> <span data-ttu-id="94d9a-253">Název proxy je název, který byl nastaven atributem [HubName]:</span><span class="sxs-lookup"><span data-stu-id="94d9a-253">The proxy name is the name that was set by the [HubName] attribute:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample15.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample16.cs)]

    <span data-ttu-id="94d9a-254">Po definování všech proměnných a funkcí inicializuje poslední řádek kódu v souboru připojení k signalizaci voláním funkce pro spuštění signálu.</span><span class="sxs-lookup"><span data-stu-id="94d9a-254">After all the variables and functions are defined, the last line of code in the file initializes the SignalR connection by calling the SignalR start function.</span></span> <span data-ttu-id="94d9a-255">Funkce Start se provádí asynchronně a vrací [odložený objekt jQuery](http://api.jquery.com/category/deferred-object/), což znamená, že můžete zavolat funkci Hotovo a zadat funkci, která bude volána po dokončení asynchronní operace.</span><span class="sxs-lookup"><span data-stu-id="94d9a-255">The start function executes asynchronously and returns a [jQuery Deferred object](http://api.jquery.com/category/deferred-object/), which means you can call the done function to specify the function to call when the asynchronous operation is completed..</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample17.js)]

    <span data-ttu-id="94d9a-256">Funkce Init volá funkci getAllStocks na serveru a používá informace, které server vrátí k aktualizaci skladové tabulky.</span><span class="sxs-lookup"><span data-stu-id="94d9a-256">The init function calls the getAllStocks function on the server and uses the information that the server returns to update the stock table.</span></span> <span data-ttu-id="94d9a-257">Všimněte si, že ve výchozím nastavení je v klientovi nutné použít ve stylu CamelCase velká a malá písmena, ale název metody je Pascal-použita na serveru.</span><span class="sxs-lookup"><span data-stu-id="94d9a-257">Notice that by default, you have to use camel casing on the client although the method name is pascal-cased on the server.</span></span> <span data-ttu-id="94d9a-258">Pravidlo ve stylu CamelCase-velká písmena se vztahuje pouze na metody, nikoli na objekty.</span><span class="sxs-lookup"><span data-stu-id="94d9a-258">The camel-casing rule only applies to methods, not objects.</span></span> <span data-ttu-id="94d9a-259">Například odkazujete na akcie. Symbol a burzovní. Price, not Stock. symbol nebo Stock. Price.</span><span class="sxs-lookup"><span data-stu-id="94d9a-259">For example, you refer to stock.Symbol and stock.Price, not stock.symbol or stock.price.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample18.js)]

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample19.cs)]

    <span data-ttu-id="94d9a-260">Pokud jste chtěli použít na klientovi velká písmena Pascal, nebo pokud jste chtěli použít zcela jiný název metody, mohli byste metodu hub pomocí atributu HubMethodName vytvořit stejným způsobem jako samotnou třídu centra s atributem HubName.</span><span class="sxs-lookup"><span data-stu-id="94d9a-260">If you wanted to use pascal casing on the client, or if you wanted to use a completely different method name, you could decorate the Hub method with the HubMethodName attribute the same way you decorated the Hub class itself with the HubName attribute.</span></span>

    <span data-ttu-id="94d9a-261">V metodě Init je pro každý uložený objekt přijatý ze serveru vytvořen kód HTML pro řádek tabulky voláním formatStock pro formátování vlastností uloženého objektu a následným voláním supplant (která je definována v horní části *StockTicker. js*) k nahrazení zástupných symbolů v proměnné rowTemplate s hodnotami uložených vlastností objektu.</span><span class="sxs-lookup"><span data-stu-id="94d9a-261">In the init method, HTML for a table row is created for each stock object received from the server by calling formatStock to format properties of the stock object, and then by calling supplant (which is defined at the top of *StockTicker.js*) to replace placeholders in the rowTemplate variable with the stock object property values.</span></span> <span data-ttu-id="94d9a-262">Výsledný kód HTML se pak připojí k uložené tabulce.</span><span class="sxs-lookup"><span data-stu-id="94d9a-262">The resulting HTML is then appended to the stock table.</span></span>

    <span data-ttu-id="94d9a-263">Zavoláte init tím, že ho předáte do jako funkci zpětného volání, která se spustí po dokončení asynchronní funkce spuštění.</span><span class="sxs-lookup"><span data-stu-id="94d9a-263">You call init by passing it in as a callback function that executes after the asynchronous start function completes.</span></span> <span data-ttu-id="94d9a-264">Pokud jste jako příkaz init jako samostatného JavaScriptu použili po volání metody Start, funkce by nefungovala, protože by se spouštěla okamžitě bez čekání na dokončení funkce Start pro dokončení navázání připojení.</span><span class="sxs-lookup"><span data-stu-id="94d9a-264">If you called init as a separate JavaScript statement after calling start, the function would fail because it would execute immediately without waiting for the start function to finish establishing the connection.</span></span> <span data-ttu-id="94d9a-265">V takovém případě se funkce init pokusí zavolat funkci getAllStocks před navázáním připojení k serveru.</span><span class="sxs-lookup"><span data-stu-id="94d9a-265">In that case, the init function would try to call the getAllStocks function before the server connection is established.</span></span>

    <span data-ttu-id="94d9a-266">Když server změní cenu akcií, zavolá updateStockPrice na připojené klienty.</span><span class="sxs-lookup"><span data-stu-id="94d9a-266">When the server changes a stock's price, it calls the updateStockPrice on connected clients.</span></span> <span data-ttu-id="94d9a-267">Funkce je přidána do vlastnosti klienta proxy serveru stockTicker, aby byla k dispozici pro volání ze serveru.</span><span class="sxs-lookup"><span data-stu-id="94d9a-267">The function is added to the client property of the stockTicker proxy in order to make it available to calls from the server.</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample20.js)]

    <span data-ttu-id="94d9a-268">Funkce updateStockPrice formátuje burzovní objekt přijatý ze serveru do řádku tabulky stejným způsobem jako ve funkci init.</span><span class="sxs-lookup"><span data-stu-id="94d9a-268">The updateStockPrice function formats a stock object received from the server into a table row the same way as in the init function.</span></span> <span data-ttu-id="94d9a-269">Místo připojení řádku k tabulce ale nalezne aktuální řádek v tabulce a nahradí ho novým řádkem.</span><span class="sxs-lookup"><span data-stu-id="94d9a-269">However, instead of appending the row to the table, it finds the stock's current row in the table and replaces that row with the new one.</span></span>

<a id="test"></a>

## <a name="test-the-application"></a><span data-ttu-id="94d9a-270">Testování aplikace</span><span class="sxs-lookup"><span data-stu-id="94d9a-270">Test the application</span></span>

1. <span data-ttu-id="94d9a-271">Stisknutím klávesy F5 spusťte aplikaci v režimu ladění.</span><span class="sxs-lookup"><span data-stu-id="94d9a-271">Press F5 to run the application in debug mode.</span></span>

    <span data-ttu-id="94d9a-272">V tabulce po prvním zobrazení se zobrazí "načítání...". řádek a po krátkém zpoždění se zobrazí počáteční skladová data a pak se ceny akcií začnou měnit.</span><span class="sxs-lookup"><span data-stu-id="94d9a-272">The stock table initially displays the "loading..." line, then after a short delay the initial stock data is displayed, and then the stock prices start to change.</span></span>

    ![Načítá](tutorial-server-broadcast-with-aspnet-signalr/_static/image7.png)

    ![Počáteční skladová tabulka](tutorial-server-broadcast-with-aspnet-signalr/_static/image8.png)

    ![Skladová tabulka, která přijímá změny ze serveru](tutorial-server-broadcast-with-aspnet-signalr/_static/image9.png)
2. <span data-ttu-id="94d9a-276">Zkopírujte adresu URL z panelu Adresa prohlížeče a vložte ji do jednoho nebo více nových oken prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="94d9a-276">Copy the URL from the browser address bar and paste it into one or more new browser window(s).</span></span>

    <span data-ttu-id="94d9a-277">Počáteční zobrazovací displej je stejný jako první prohlížeč a změny probíhají současně.</span><span class="sxs-lookup"><span data-stu-id="94d9a-277">The initial stock display is the same as the first browser and changes happen simultaneously.</span></span>
3. <span data-ttu-id="94d9a-278">Zavřete všechny prohlížeče a otevřete nový prohlížeč a pak přejít na stejnou adresu URL.</span><span class="sxs-lookup"><span data-stu-id="94d9a-278">Close all browsers and open a new browser, then go to the same URL.</span></span>

    <span data-ttu-id="94d9a-279">Objekt typu Singleton StockTicker pokračuje v běhu na serveru, takže zobrazená tabulka v zásobách ukazuje, že zásoby se nadále mění.</span><span class="sxs-lookup"><span data-stu-id="94d9a-279">The StockTicker singleton object has continued to run in the server, so the stock table display shows that the stocks have continued to change.</span></span> <span data-ttu-id="94d9a-280">(Počáteční tabulka se nezobrazuje s nulovými hodnotami změny.)</span><span class="sxs-lookup"><span data-stu-id="94d9a-280">(You don't see the initial table with zero change figures.)</span></span>
4. <span data-ttu-id="94d9a-281">Zavřete prohlížeč.</span><span class="sxs-lookup"><span data-stu-id="94d9a-281">Close the browser.</span></span>

<a id="enablelogging"></a>

## <a name="enable-logging"></a><span data-ttu-id="94d9a-282">Povolte protokolování</span><span class="sxs-lookup"><span data-stu-id="94d9a-282">Enable logging</span></span>

<span data-ttu-id="94d9a-283">Signál má vestavěnou funkci protokolování, kterou můžete na klientovi povolit, aby při řešení potíží mohl pomoci.</span><span class="sxs-lookup"><span data-stu-id="94d9a-283">SignalR has a built-in logging function that you can enable on the client to aid in troubleshooting.</span></span> <span data-ttu-id="94d9a-284">V této části povolíte protokolování a uvidíte příklady, které ukazují, jak protokoly říkají, které z následujících signálů přenosových metod používá:</span><span class="sxs-lookup"><span data-stu-id="94d9a-284">In this section you enable logging and see examples that show how logs tell you which of the following transport methods SignalR is using:</span></span>

- <span data-ttu-id="94d9a-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), které podporuje služba IIS 8 a aktuální prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="94d9a-285">[WebSockets](http://en.wikipedia.org/wiki/WebSocket), supported by IIS 8 and current browsers.</span></span>
- <span data-ttu-id="94d9a-286">[Události odeslané serverem](http://en.wikipedia.org/wiki/Server-sent_events), které podporují jiné prohlížeče než Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="94d9a-286">[Server-sent events](http://en.wikipedia.org/wiki/Server-sent_events), supported by browsers other than Internet Explorer.</span></span>
- <span data-ttu-id="94d9a-287">[Trvale rámec](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), který podporuje Internet Explorer.</span><span class="sxs-lookup"><span data-stu-id="94d9a-287">[Forever frame](http://en.wikipedia.org/wiki/Comet_(programming)#Hidden_iframe), supported by Internet Explorer.</span></span>
- <span data-ttu-id="94d9a-288">[Dlouhé cyklické dotazování AJAX](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), podporované všemi prohlížeči</span><span class="sxs-lookup"><span data-stu-id="94d9a-288">[Ajax long polling](http://en.wikipedia.org/wiki/Comet_(programming)#Ajax_with_long_polling), supported by all browsers.</span></span>

<span data-ttu-id="94d9a-289">Pro jakékoli dané připojení vybírá signál nejlepší metodu přenosu, kterou podporuje server i klientská podpora.</span><span class="sxs-lookup"><span data-stu-id="94d9a-289">For any given connection, SignalR chooses the best transport method that both the server and the client support.</span></span>

1. <span data-ttu-id="94d9a-290">Otevřete *StockTicker. js* a přidejte řádek kódu, který povolí protokolování hned před kódem, který inicializuje připojení na konci souboru:</span><span class="sxs-lookup"><span data-stu-id="94d9a-290">Open *StockTicker.js* and add a line of code to enable logging immediately before the code that initializes the connection at the end of the file:</span></span>

    [!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample21.js)]
2. <span data-ttu-id="94d9a-291">Stisknutím klávesy F5 spusťte projekt.</span><span class="sxs-lookup"><span data-stu-id="94d9a-291">Press F5 to run the project.</span></span>
3. <span data-ttu-id="94d9a-292">Otevřete okno vývojářské nástroje v prohlížeči a vyberte konzolu, abyste zobrazili protokoly.</span><span class="sxs-lookup"><span data-stu-id="94d9a-292">Open your browser's developer tools window, and select the Console to see the logs.</span></span> <span data-ttu-id="94d9a-293">Možná budete muset aktualizovat stránku, aby se zobrazily protokoly signalizace vyjednávat přenosovou metodou pro nové připojení.</span><span class="sxs-lookup"><span data-stu-id="94d9a-293">You might have to refresh the page to see the logs of Signalr negotiating the transport method for a new connection.</span></span>

    <span data-ttu-id="94d9a-294">Pokud používáte Internet Explorer 10 v systému Windows 8 (IIS 8), je přenosová metoda WebSockets.</span><span class="sxs-lookup"><span data-stu-id="94d9a-294">If you are running Internet Explorer 10 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Konzola IE 10 IIS 8](tutorial-server-broadcast-with-aspnet-signalr/_static/image10.png)

    <span data-ttu-id="94d9a-296">Pokud používáte Internet Explorer 10 v systému Windows 7 (IIS 7,5), je přenosová metoda IFRAME.</span><span class="sxs-lookup"><span data-stu-id="94d9a-296">If you are running Internet Explorer 10 on Windows 7 (IIS 7.5), the transport method is iframe.</span></span>

    ![Konzola IE 10, IIS 7,5](tutorial-server-broadcast-with-aspnet-signalr/_static/image11.png)

    <span data-ttu-id="94d9a-298">V prohlížeči Firefox nainstalujte doplněk Firebug a získejte okno konzoly.</span><span class="sxs-lookup"><span data-stu-id="94d9a-298">In Firefox, install the Firebug add-in to get a Console window.</span></span> <span data-ttu-id="94d9a-299">Pokud používáte Firefox 19 v systému Windows 8 (IIS 8), je přenosová metoda WebSockets.</span><span class="sxs-lookup"><span data-stu-id="94d9a-299">If you are running Firefox 19 on Windows 8 (IIS 8), the transport method is WebSockets.</span></span>

    ![Firefox 19 WebSockets služby IIS 8](tutorial-server-broadcast-with-aspnet-signalr/_static/image12.png)

    <span data-ttu-id="94d9a-301">Pokud používáte Firefox 19 v systému Windows 7 (IIS 7,5), přenosová metoda je události odesílané serverem.</span><span class="sxs-lookup"><span data-stu-id="94d9a-301">If you are running Firefox 19 on Windows 7 (IIS 7.5), the transport method is server-sent events.</span></span>

    ![Konzola Firefox 19 IIS 7,5](tutorial-server-broadcast-with-aspnet-signalr/_static/image13.png)

<a id="fullsample"></a>

## <a name="install-and-review-the-full-stockticker-sample"></a><span data-ttu-id="94d9a-303">Instalace a kontrola úplné ukázky StockTicker</span><span class="sxs-lookup"><span data-stu-id="94d9a-303">Install and review the full StockTicker sample</span></span>

<span data-ttu-id="94d9a-304">Aplikace StockTicker, která je nainstalovaná balíčkem [Microsoft. ASPNET. signaler. Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet, zahrnuje více funkcí, než je zjednodušená verze, kterou jste právě vytvořili úplně od začátku.</span><span class="sxs-lookup"><span data-stu-id="94d9a-304">The StockTicker application that is installed by the [Microsoft.AspNet.SignalR.Sample](http://nuget.org/packages/microsoft.aspnet.signalr.sample) NuGet package includes more features than the simplified version that you just created from scratch.</span></span> <span data-ttu-id="94d9a-305">V této části kurzu nainstalujete balíček NuGet a zkontrolujete nové funkce a kód, který je implementuje.</span><span class="sxs-lookup"><span data-stu-id="94d9a-305">In this section of the tutorial, you install the NuGet package and review the new features and the code that implements them.</span></span>

### <a name="install-the-signalrsample-nuget-package"></a><span data-ttu-id="94d9a-306">Instalace nástroje Signal. Sample NuGet Package</span><span class="sxs-lookup"><span data-stu-id="94d9a-306">Install the SignalR.Sample NuGet package</span></span>

1. <span data-ttu-id="94d9a-307">V **Průzkumník řešení**klikněte pravým tlačítkem na projekt a pak klikněte na **Spravovat balíčky NuGet**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-307">In **Solution Explorer**, right-click the project and click **Manage NuGet Packages**.</span></span>
2. <span data-ttu-id="94d9a-308">V dialogovém okně **Spravovat balíčky NuGet** klikněte na **online**, do pole **Hledat online** zadejte *Signal. Sample* a pak klikněte na **nainstalovat** v nástroji **Signal. Sample** Package.</span><span class="sxs-lookup"><span data-stu-id="94d9a-308">In the **Manage NuGet Packages** dialog box, click **Online**, enter *SignalR.Sample* in the **Search Online** box, and then click **Install** in the **SignalR.Sample** package.</span></span>

    ![Nainstalovat signál. ukázkový balíček](tutorial-server-broadcast-with-aspnet-signalr/_static/image14.png)
3. <span data-ttu-id="94d9a-310">V souboru *Global. asax* přidejte komentář k části Route. Routes. MapHubs (); řádek, který jste přidali dříve v aplikaci\_spustit metodu.</span><span class="sxs-lookup"><span data-stu-id="94d9a-310">In the *Global.asax* file, comment out the RouteTable.Routes.MapHubs(); line that you added earlier in the Application\_Start method.</span></span>

    <span data-ttu-id="94d9a-311">Kód v souboru *Global. asax* již není potřeba, protože signál. ukázkový balíček registruje trasu signálů do souboru *App\_Start/RegisterHubs. cs* :</span><span class="sxs-lookup"><span data-stu-id="94d9a-311">The code in *Global.asax* is no longer needed because the SignalR.Sample package registers the SignalR route in the *App\_Start/RegisterHubs.cs* file:</span></span>

    [!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample22.cs)]

    <span data-ttu-id="94d9a-312">Třída webactivator, na kterou je odkazováno atributem Assembly, je obsažena v balíčku WebActivatorEx NuGet, který je nainstalován jako závislost v balíčku nástroje Signal. Sample.</span><span class="sxs-lookup"><span data-stu-id="94d9a-312">The WebActivator class that is referenced by the assembly attribute is included in the WebActivatorEx NuGet package, which is installed as a dependency of the SignalR.Sample package.</span></span>
4. <span data-ttu-id="94d9a-313">V **Průzkumník řešení**rozbalte složku *Signal. Sample* , která byla vytvořena instalací nástroje Signal. Sample Package.</span><span class="sxs-lookup"><span data-stu-id="94d9a-313">In **Solution Explorer**, expand the *SignalR.Sample* folder which was created by installing the SignalR.Sample package.</span></span>
5. <span data-ttu-id="94d9a-314">Ve složce *Signal. Sample* klikněte pravým tlačítkem na *StockTicker. html*a pak klikněte na **nastavit jako úvodní stránku**.</span><span class="sxs-lookup"><span data-stu-id="94d9a-314">In the *SignalR.Sample* folder, right-click *StockTicker.html*, and then click **Set As Start Page**.</span></span>

    > [!NOTE]
    > <span data-ttu-id="94d9a-315">Instalace nástroje Signal. vzorový balíček NuGet může změnit verzi jQuery, kterou máte ve složce *Scripts* .</span><span class="sxs-lookup"><span data-stu-id="94d9a-315">Installing The SignalR.Sample NuGet package might change the version of jQuery that you have in your *Scripts* folder.</span></span> <span data-ttu-id="94d9a-316">Nový soubor *StockTicker. html* , který balíček nainstaluje do nástroje *Signal. vzorová* složka bude synchronizována s verzí jQuery, kterou balíček nainstaluje, ale pokud chcete znovu spustit původní soubor *StockTicker. html* , bude pravděpodobně nutné nejprve aktualizovat odkaz jQuery ve značce Script.</span><span class="sxs-lookup"><span data-stu-id="94d9a-316">The new *StockTicker.html* file that the package installs in the *SignalR.Sample* folder will be in sync with the jQuery version that the package installs, but if you want to run your original *StockTicker.html* file again, you might have to update the jQuery reference in the script tag first.</span></span>

### <a name="run-the-application"></a><span data-ttu-id="94d9a-317">Spuštění aplikace</span><span class="sxs-lookup"><span data-stu-id="94d9a-317">Run the application</span></span>

1. <span data-ttu-id="94d9a-318">Stisknutím klávesy F5 spusťte aplikaci.</span><span class="sxs-lookup"><span data-stu-id="94d9a-318">Press F5 to run the application.</span></span>

    <span data-ttu-id="94d9a-319">Kromě mřížky, kterou jste viděli dříve, zobrazuje celá burzovní aplikace v pravém okně, ve kterém se zobrazují stejná burzovní data.</span><span class="sxs-lookup"><span data-stu-id="94d9a-319">In addition to the grid that you saw earlier, the full stock ticker application shows a horizontally scrolling window that displays the same stock data.</span></span> <span data-ttu-id="94d9a-320">Při prvním spuštění aplikace je "trh" "zavřený" a zobrazí se statická mřížka a okno se značkami, které se neposunují.</span><span class="sxs-lookup"><span data-stu-id="94d9a-320">When you run the application for the first time, the "market" is "closed" and you see a static grid and a ticker window that isn't scrolling.</span></span>

    ![Spuštění obrazovky StockTicker](tutorial-server-broadcast-with-aspnet-signalr/_static/image15.png)

    <span data-ttu-id="94d9a-322">Po kliknutí na **otevřít na trhu**se pole se seznamem **živých zásob** začne posouvat vodorovně a server začne pravidelně vysílat změny cen akcií náhodně.</span><span class="sxs-lookup"><span data-stu-id="94d9a-322">When you click **Open Market**, the **Live Stock Ticker** box starts to scroll horizontally, and the server starts to periodically broadcast stock price changes on a random basis.</span></span> <span data-ttu-id="94d9a-323">Pokaždé, když se změní cena za zásobu, aktualizují se i živá **Skladová tabulka** a pole se seznamem **živých akcií** .</span><span class="sxs-lookup"><span data-stu-id="94d9a-323">Each time a stock price changes, both the **Live Stock Table** grid and the **Live Stock Ticker** box are updated.</span></span> <span data-ttu-id="94d9a-324">Pokud je změna cen akcií kladná, zobrazí se akcie se zeleným pozadím a pokud je změna záporná, zobrazí se na skladě červené pozadí.</span><span class="sxs-lookup"><span data-stu-id="94d9a-324">When a stock's price change is positive, the stock is shown with a green background, and when the change is negative, the stock is shown with a red background.</span></span>

    ![Aplikace StockTicker, otevřený trh](tutorial-server-broadcast-with-aspnet-signalr/_static/image16.png)

    <span data-ttu-id="94d9a-326">Tlačítko **Zavřít na trhu** zastaví změny a zastaví rolování a tlačítko **reset** obnoví všechna skladovaná data do počátečního stavu před zahájením změn cen.</span><span class="sxs-lookup"><span data-stu-id="94d9a-326">The **Close Market** button stops the changes and stops the ticker scrolling, and the **Reset** button resets all stock data to the initial state before price changes started.</span></span> <span data-ttu-id="94d9a-327">Pokud otevřete více oken prohlížeče a přejdete na stejnou adresu URL, zobrazí se stejná data v každém prohlížeči v současné době dynamicky aktualizována.</span><span class="sxs-lookup"><span data-stu-id="94d9a-327">If you open more browser windows and go to the same URL, you see the same data dynamically updated at the same time in each browser.</span></span> <span data-ttu-id="94d9a-328">Po kliknutí na jedno z těchto tlačítek všechny prohlížeče reagují stejným způsobem současně.</span><span class="sxs-lookup"><span data-stu-id="94d9a-328">When you click one of the buttons, all browsers respond the same way at the same time.</span></span>

### <a name="live-stock-ticker-display"></a><span data-ttu-id="94d9a-329">Živý displej se zobrazením akcií</span><span class="sxs-lookup"><span data-stu-id="94d9a-329">Live Stock Ticker display</span></span>

<span data-ttu-id="94d9a-330">**Živý burzovní** displej je neuspořádaný seznam v elementu div, který je formátovaný na jeden řádek pomocí stylů CSS.</span><span class="sxs-lookup"><span data-stu-id="94d9a-330">The **Live Stock Ticker** display is an unordered list in a div element that is formatted into a single line by CSS styles.</span></span> <span data-ttu-id="94d9a-331">Tento ovládací prvek se inicializuje a aktualizuje stejným způsobem jako tabulka: nahrazením zástupných symbolů v &lt;li&gt; řetězce šablony a dynamickém přidáním &lt;li&gt; prvků do prvku &lt;ul&gt;.</span><span class="sxs-lookup"><span data-stu-id="94d9a-331">The ticker is initialized and updated the same way as the table: by replacing placeholders in a &lt;li&gt; template string and dynamically adding the &lt;li&gt; elements to the &lt;ul&gt; element.</span></span> <span data-ttu-id="94d9a-332">Posouvání se provádí pomocí funkce jQuery animace, která v rámci div mění okraj vlevo od neuspořádaného seznamu.</span><span class="sxs-lookup"><span data-stu-id="94d9a-332">The scrolling is performed by using the jQuery animate function to vary the margin-left of the unordered list within the div.</span></span>

<span data-ttu-id="94d9a-333">Burzovní modul HTML s taktem:</span><span class="sxs-lookup"><span data-stu-id="94d9a-333">The stock ticker HTML:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample23.html)]

<span data-ttu-id="94d9a-334">Základní funkce pro vystavování akcií:</span><span class="sxs-lookup"><span data-stu-id="94d9a-334">The stock ticker CSS:</span></span>

[!code-html[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample24.html)]

<span data-ttu-id="94d9a-335">Kód jQuery, který usnadňuje posunutí:</span><span class="sxs-lookup"><span data-stu-id="94d9a-335">The jQuery code that makes it scroll:</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample25.js)]

### <a name="additional-methods-on-the-server-that-the-client-can-call"></a><span data-ttu-id="94d9a-336">Další metody na serveru, který může klient volat</span><span class="sxs-lookup"><span data-stu-id="94d9a-336">Additional methods on the server that the client can call</span></span>

<span data-ttu-id="94d9a-337">Třída StockTickerHub definuje čtyři další metody, které může klient volat:</span><span class="sxs-lookup"><span data-stu-id="94d9a-337">The StockTickerHub class defines four additional methods that the client can call:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample26.cs)]

<span data-ttu-id="94d9a-338">OpenMarket, CloseMarket a Reset jsou volány v reakci na tlačítka v horní části stránky.</span><span class="sxs-lookup"><span data-stu-id="94d9a-338">OpenMarket, CloseMarket, and Reset are called in response to the buttons at the top of the page.</span></span> <span data-ttu-id="94d9a-339">Ukazují vzor jednoho klienta, který aktivuje změnu stavu, která je okamžitě šířena všem klientům.</span><span class="sxs-lookup"><span data-stu-id="94d9a-339">They demonstrate the pattern of one client triggering a change in state that is immediately propagated to all clients.</span></span> <span data-ttu-id="94d9a-340">Každá z těchto metod volá metodu ve třídě StockTicker, která ovlivňuje změnu stavu trhu a pak vysílá nový stav.</span><span class="sxs-lookup"><span data-stu-id="94d9a-340">Each of these methods calls a method in the StockTicker class that effects the market state change and then broadcasts the new state.</span></span>

<span data-ttu-id="94d9a-341">Ve třídě StockTicker je stav trhu uchováván pomocí vlastnosti MarketState, která vrací hodnotu výčtu MarketState:</span><span class="sxs-lookup"><span data-stu-id="94d9a-341">In the StockTicker class, the state of the market is maintained by a MarketState property that returns a MarketState enum value:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample27.cs)]

<span data-ttu-id="94d9a-342">Každá z metod, které mění stav trhu, je v bloku zámku, protože třída StockTicker musí být threadsafe:</span><span class="sxs-lookup"><span data-stu-id="94d9a-342">Each of the methods that change the market state do so inside a lock block because the StockTicker class has to be threadsafe:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample28.cs)]

<span data-ttu-id="94d9a-343">Chcete-li zajistit, aby byl tento kód threadsafe, pole \_marketState, které vrací vlastnost MarketState, je označeno jako volatile,</span><span class="sxs-lookup"><span data-stu-id="94d9a-343">To ensure that this code is threadsafe, the \_marketState field that backs the MarketState property is marked as volatile,</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample29.cs)]

<span data-ttu-id="94d9a-344">Metody BroadcastMarketStateChange a BroadcastMarketReset jsou podobné metodě BroadcastStockPrice, kterou jste již viděli, s výjimkou volání různých metod definovaných v klientovi:</span><span class="sxs-lookup"><span data-stu-id="94d9a-344">The BroadcastMarketStateChange and BroadcastMarketReset methods are similar to the BroadcastStockPrice method that you already saw, except they call different methods defined at the client:</span></span>

[!code-csharp[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample30.cs)]

### <a name="additional-functions-on-the-client-that-the-server-can-call"></a><span data-ttu-id="94d9a-345">Další funkce v klientovi, které může server volat</span><span class="sxs-lookup"><span data-stu-id="94d9a-345">Additional functions on the client that the server can call</span></span>

<span data-ttu-id="94d9a-346">Funkce updateStockPrice nyní zpracovává mřížku i zobrazení značek a používá jQuery. Color k blikání červených a zelených barev.</span><span class="sxs-lookup"><span data-stu-id="94d9a-346">The updateStockPrice function now handles both the grid and the ticker display, and it uses jQuery.Color to flash red and green colors.</span></span>

<span data-ttu-id="94d9a-347">Nové funkce v nástroji *Signal. StockTicker. js* povolují a zakazují tlačítka na základě stavu na trhu a zastavují nebo spouštějí horizontální posouvání okna se značkami.</span><span class="sxs-lookup"><span data-stu-id="94d9a-347">New functions in *SignalR.StockTicker.js* enable and disable the buttons based on market state, and they stop or start the ticker window horizontal scrolling.</span></span> <span data-ttu-id="94d9a-348">Vzhledem k tomu, že se přidávají více funkcí do Tick. Client, je k jejich přidání použita [funkce jQuery Extended](http://api.jquery.com/jQuery.extend/) .</span><span class="sxs-lookup"><span data-stu-id="94d9a-348">Since multiple functions are being added to ticker.client, the [jQuery extend function](http://api.jquery.com/jQuery.extend/) is used to add them.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample31.js)]

### <a name="additional-client-setup-after-establishing-the-connection"></a><span data-ttu-id="94d9a-349">Další nastavení klienta po navázání připojení</span><span class="sxs-lookup"><span data-stu-id="94d9a-349">Additional client setup after establishing the connection</span></span>

<span data-ttu-id="94d9a-350">Poté, co klient připojení naváže, provede další práci: zjistit, jestli je trh otevřený nebo zavřený, aby mohl volat příslušnou funkci marketOpened nebo marketClosed, a připojit volání metody serveru k tlačítkům.</span><span class="sxs-lookup"><span data-stu-id="94d9a-350">After the client establishes the connection, it has some additional work to do: find out if the market is open or closed in order to call the appropriate marketOpened or marketClosed function, and attach the server method calls to the buttons.</span></span>

[!code-javascript[Main](tutorial-server-broadcast-with-aspnet-signalr/samples/sample32.js)]

<span data-ttu-id="94d9a-351">Metody serveru nejsou kabelové až po navázání spojení, takže se kód nemůže pokusit volat metody serveru předtím, než budou k dispozici.</span><span class="sxs-lookup"><span data-stu-id="94d9a-351">The server methods are not wired up to the buttons until after the connection is established, so that the code can't try to call the server methods before they are available.</span></span>

<a id="nextsteps"></a>

## <a name="next-steps"></a><span data-ttu-id="94d9a-352">Další kroky</span><span class="sxs-lookup"><span data-stu-id="94d9a-352">Next steps</span></span>

<span data-ttu-id="94d9a-353">V tomto kurzu jste se naučili, jak programovat aplikaci pro signalizaci, která vysílá zprávy ze serveru do všech připojených klientů, a to v pravidelných intervalech a jako reakci na oznámení od libovolného klienta.</span><span class="sxs-lookup"><span data-stu-id="94d9a-353">In this tutorial you've learned how to program a SignalR application that broadcasts messages from the server to all connected clients, both on a periodic basis and in response to notifications from any client.</span></span> <span data-ttu-id="94d9a-354">Vzor použití vícehodnotové instance s více vlákny k údržbě stavu serveru lze také použít ve scénářích hraní online her pro více hráčů.</span><span class="sxs-lookup"><span data-stu-id="94d9a-354">The pattern of using a multi-threaded singleton instance to maintain server state can also be also used in multi-player online game scenarios.</span></span> <span data-ttu-id="94d9a-355">Příklad najdete v tématu [hry pro sestřelení, která je založená na nástroji Signal](https://github.com/NTaylorMullen/ShootR).</span><span class="sxs-lookup"><span data-stu-id="94d9a-355">For an example, see [the ShootR game that is based on SignalR](https://github.com/NTaylorMullen/ShootR).</span></span>

<span data-ttu-id="94d9a-356">Kurzy, které ukazují scénáře komunikace peer-to-peer, najdete v tématu [Začínáme s nástrojem pro signalizaci](index.md) a [aktualizací v reálném čase pomocí nástroje signaler](index.md).</span><span class="sxs-lookup"><span data-stu-id="94d9a-356">For tutorials that show peer-to-peer communication scenarios, see [Getting Started with SignalR](index.md) and [Real-Time Updating with SignalR](index.md).</span></span>

<span data-ttu-id="94d9a-357">Další informace o pokročilých konceptech vývoje signálů najdete v následujících lokalitách, které jsou ve zdrojovém kódu a prostředcích signalizace:</span><span class="sxs-lookup"><span data-stu-id="94d9a-357">To learn more advanced SignalR development concepts, visit the following sites for SignalR source code and resources:</span></span>

- [<span data-ttu-id="94d9a-358">ASP.NET signál</span><span class="sxs-lookup"><span data-stu-id="94d9a-358">ASP.NET SignalR</span></span>](https://asp.net/signalr/)
- [<span data-ttu-id="94d9a-359">Projekt signálu</span><span class="sxs-lookup"><span data-stu-id="94d9a-359">SignalR Project</span></span>](http://signalr.net/)
- [<span data-ttu-id="94d9a-360">GitHub a ukázky signálů</span><span class="sxs-lookup"><span data-stu-id="94d9a-360">SignalR Github and Samples</span></span>](https://github.com/SignalR/SignalR)
- [<span data-ttu-id="94d9a-361">Wiki signálu</span><span class="sxs-lookup"><span data-stu-id="94d9a-361">SignalR Wiki</span></span>](https://github.com/SignalR/SignalR/wiki)
