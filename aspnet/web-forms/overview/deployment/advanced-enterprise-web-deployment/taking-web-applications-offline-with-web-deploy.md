---
uid: web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
title: Přepnutí webových aplikací do režimu offline pomocí Nasazení webu | Microsoft Docs
author: jrjlee
description: Toto téma popisuje, jak převést webovou aplikaci do režimu offline po dobu trvání automatizovaného nasazení pomocí webové depl služby Internetová informační služba (IIS)...
ms.author: riande
ms.date: 05/04/2012
ms.assetid: 3e9f6e7d-8967-4586-94d5-d3a122f12529
msc.legacyurl: /web-forms/overview/deployment/advanced-enterprise-web-deployment/taking-web-applications-offline-with-web-deploy
msc.type: authoredcontent
ms.openlocfilehash: ba60664a0c3daa0650cd7e7cfc4ab9da08df3440
ms.sourcegitcommit: e365196c75ce93cd8967412b1cfdc27121816110
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 02/07/2020
ms.locfileid: "77075135"
---
# <a name="taking-web-applications-offline-with-web-deploy"></a><span data-ttu-id="7f1f3-103">Převedení webových aplikací offline nástrojem pro nasazení webu</span><span class="sxs-lookup"><span data-stu-id="7f1f3-103">Taking Web Applications Offline with Web Deploy</span></span>

<span data-ttu-id="7f1f3-104">od [Jason Novák](https://github.com/jrjlee)</span><span class="sxs-lookup"><span data-stu-id="7f1f3-104">by [Jason Lee](https://github.com/jrjlee)</span></span>

[<span data-ttu-id="7f1f3-105">Stáhnout PDF</span><span class="sxs-lookup"><span data-stu-id="7f1f3-105">Download PDF</span></span>](https://msdnshared.blob.core.windows.net/media/MSDNBlogsFS/prod.evol.blogs.msdn.com/CommunityServer.Blogs.Components.WeblogFiles/00/00/00/63/56/8130.DeployingWebAppsInEnterpriseScenarios.pdf)

> <span data-ttu-id="7f1f3-106">Toto téma popisuje, jak převést webovou aplikaci do režimu offline po dobu trvání automatizovaného nasazení pomocí nástroje pro nasazení webu služby Internetová informační služba (IIS) (Nasazení webu).</span><span class="sxs-lookup"><span data-stu-id="7f1f3-106">This topic describes how to take a web application offline for the duration of an automated deployment using the Internet Information Services (IIS) Web Deployment Tool (Web Deploy).</span></span> <span data-ttu-id="7f1f3-107">Uživatelé, kteří přešli do webové aplikace, budou přesměrováni do *aplikace\_offline souboru. htm* až do dokončení nasazení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-107">Users who browse to the web application are redirected to an *App\_offline.htm* file until the deployment is complete.</span></span>

<span data-ttu-id="7f1f3-108">Toto téma je součástí série kurzů založených na požadavcích podnikového nasazení fiktivní společnosti s názvem Fabrikam, Inc. Tato série kurzů používá ukázkové řešení&#x2014;, pomocí kterého [řešení](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;správce kontaktů představuje webovou aplikaci s realistickou úrovní složitosti, včetně aplikace ASP.NET MVC 3, služby Windows Communication Foundation (WCF) a databázového projektu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-108">This topic forms part of a series of tutorials based around the enterprise deployment requirements of a fictional company named Fabrikam, Inc. This tutorial series uses a sample solution&#x2014;the [Contact Manager solution](../web-deployment-in-the-enterprise/the-contact-manager-solution.md)&#x2014;to represent a web application with a realistic level of complexity, including an ASP.NET MVC 3 application, a Windows Communication Foundation (WCF) service, and a database project.</span></span>

<span data-ttu-id="7f1f3-109">Metoda nasazení na srdce těchto kurzů je založena na způsobu rozdělení souborů projektu popsaných v tématu [Principy souboru projektu](../web-deployment-in-the-enterprise/understanding-the-project-file.md), ve kterém je proces sestavení řízen dvěma soubory&#x2014;projektu jeden, který obsahuje pokyny pro sestavení, které platí pro každé cílové prostředí, a jedno obsahující nastavení sestavení a nasazení specifické pro konkrétní prostředí.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-109">The deployment method at the heart of these tutorials is based on the split project file approach described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md), in which the build process is controlled by two project files&#x2014;one containing build instructions that apply to every destination environment, and one containing environment-specific build and deployment settings.</span></span> <span data-ttu-id="7f1f3-110">V době sestavení je soubor projektu specifický pro prostředí sloučen do souboru projektu prostředí – nezávislá a vytvoří kompletní sadu instrukcí pro sestavení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-110">At build time, the environment-specific project file is merged into the environment-agnostic project file to form a complete set of build instructions.</span></span>

## <a name="task-overview"></a><span data-ttu-id="7f1f3-111">Přehled úlohy</span><span class="sxs-lookup"><span data-stu-id="7f1f3-111">Task Overview</span></span>

<span data-ttu-id="7f1f3-112">V mnoha scénářích budete chtít při provádění změn v souvisejících součástech, jako jsou databáze nebo webové služby, převést webovou aplikaci do offline režimu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-112">In a lot of scenarios, you'll want to take a web application offline while you make changes to related components, like databases or web services.</span></span> <span data-ttu-id="7f1f3-113">Ve službě IIS a ASP.NET to můžete dosáhnout umístěním souboru s názvem *App\_offline. htm* do kořenové složky webu služby IIS nebo webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-113">Typically, in IIS and ASP.NET, you accomplish this by placing a file named *App\_offline.htm* in the root folder of the IIS website or web application.</span></span> <span data-ttu-id="7f1f3-114">*Aplikace\_offline souboru. htm* je standardní soubor HTML a obvykle obsahuje jednoduchou zprávu, která dává uživateli, že lokalita je dočasně nedostupná z důvodu údržby.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-114">The *App\_offline.htm* file is a standard HTML file and will usually contain a simple message advising the user that the site is temporarily unavailable due to maintenance.</span></span> <span data-ttu-id="7f1f3-115">I když *aplikace\_offline souboru. htm* existuje v kořenové složce webu, služba IIS automaticky přesměruje všechny požadavky na daný soubor.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-115">While the *App\_offline.htm* file exists in the root folder of the website, IIS will automatically redirect any requests to the file.</span></span> <span data-ttu-id="7f1f3-116">Až dokončíte aktualizace, odeberte *aplikaci\_offline souboru. htm* a web bude pokračovat v obsluze požadavků obvyklým způsobem.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-116">When you've finished making updates, you remove the *App\_offline.htm* file and the website resumes serving requests as usual.</span></span>

<span data-ttu-id="7f1f3-117">Když použijete Nasazení webu k provádění automatizovaných nebo jednoduchých nasazení do cílového prostředí, možná budete chtít přidat a odebrat *aplikaci\_offline souboru. htm* do procesu nasazení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-117">When you use Web Deploy to perform automated or single-step deployments to a target environment, you may want to incorporate adding and removing the *App\_offline.htm* file into your deployment process.</span></span> <span data-ttu-id="7f1f3-118">K tomu je potřeba provést tyto úlohy vysoké úrovně:</span><span class="sxs-lookup"><span data-stu-id="7f1f3-118">To do this, you'll need to complete these high-level tasks:</span></span>

- <span data-ttu-id="7f1f3-119">V souboru projektu Microsoft Build Engine (MSBuild), který používáte k řízení procesu nasazení, vytvořte cíl nástroje MSBuild, který zkopíruje *aplikaci\_offline soubor. htm* na cílový server před zahájením všech úloh nasazení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-119">In the Microsoft Build Engine (MSBuild) project file that you use to control the deployment process, create an MSBuild target that copies an *App\_offline.htm* file to the destination server before any deployment tasks begin.</span></span>
- <span data-ttu-id="7f1f3-120">Přidejte další cíl nástroje MSBuild, který odebere *aplikaci\_offline souboru. htm* z cílového serveru po dokončení všech úloh nasazení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-120">Add another MSBuild target that removes the *App\_offline.htm* file from the destination server when all deployment tasks are complete.</span></span>
- <span data-ttu-id="7f1f3-121">V projektu webové aplikace vytvořte soubor *. WPP. targets* , který zajistí, že je do balíčku pro nasazení přidána *aplikace\_offline soubor. htm* při vyvolání nasazení webu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-121">In the web application project, create a *.wpp.targets* file that ensures that an *App\_offline.htm* file is added to the deployment package when Web Deploy is invoked.</span></span>

<span data-ttu-id="7f1f3-122">V tomto tématu se dozvíte, jak provádět tyto postupy.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-122">This topic will show you how to perform these procedures.</span></span> <span data-ttu-id="7f1f3-123">V úlohách a návodech v tomto tématu se předpokládá, že jste již vytvořili řešení, které obsahuje alespoň jeden projekt webové aplikace a že k řízení procesu nasazení použijete vlastní soubor projektu, jak je popsáno v tématu [nasazení webu v podniku](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span><span class="sxs-lookup"><span data-stu-id="7f1f3-123">The tasks and walkthroughs in this topic assume that you've already created a solution that contains at least one web application project, and that you use a custom project file to control the deployment process as described in [Web Deployment in the Enterprise](../web-deployment-in-the-enterprise/web-deployment-in-the-enterprise.md).</span></span> <span data-ttu-id="7f1f3-124">Alternativně můžete použít ukázkové řešení [Contact Manageru](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) a postupovat podle příkladů v tématu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-124">Alternatively, you can use the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution to follow the examples in the topic.</span></span>

## <a name="adding-an-app_offline-file-to-a-web-application-project"></a><span data-ttu-id="7f1f3-125">Přidání aplikace\_offline souboru do projektu webové aplikace</span><span class="sxs-lookup"><span data-stu-id="7f1f3-125">Adding an App\_Offline File to a Web Application Project</span></span>

<span data-ttu-id="7f1f3-126">První úkol, který je třeba dokončit, je přidání *aplikace\_offline* souboru do projektu webové aplikace:</span><span class="sxs-lookup"><span data-stu-id="7f1f3-126">The first task you need to complete is to add an *App\_offline* file to your web application project:</span></span>

- <span data-ttu-id="7f1f3-127">Chcete-li zabránit tomu, aby soubor v konfliktu s procesem vývoje (nechcete, aby byla vaše aplikace trvale offline), měli byste ji zavolat na jinou hodnotu než *aplikace\_offline. htm*.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-127">To prevent the file from interfering with the development process (you don't want your application to be permanently offline), you should call it something other than *App\_offline.htm*.</span></span> <span data-ttu-id="7f1f3-128">Souborovou aplikaci můžete například pojmenovat *\_offline-Template. htm*.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-128">For example, you could name the file *App\_offline-template.htm*.</span></span>
- <span data-ttu-id="7f1f3-129">Chcete-li zabránit nasazení souboru tak, jak je, měli byste nastavit akci sestavení na **žádné**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-129">To prevent the file from being deployed as-is, you should set the build action to **None**.</span></span>

<span data-ttu-id="7f1f3-130">**Přidání aplikace\_offline souboru do projektu webové aplikace**</span><span class="sxs-lookup"><span data-stu-id="7f1f3-130">**To add an App\_offline file to a web application project**</span></span>

1. <span data-ttu-id="7f1f3-131">Otevřete řešení v aplikaci Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-131">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="7f1f3-132">V okně **Průzkumník řešení** klikněte pravým tlačítkem myši na projekt webové aplikace, přejděte na **Přidat**a klikněte na **Nová položka**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-132">In the **Solution Explorer** window, right-click your web application project, point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="7f1f3-133">V dialogovém okně **Přidat novou položku** vyberte možnost **Stránka HTML**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-133">In the **Add New Item** dialog box, select **HTML Page**.</span></span>
4. <span data-ttu-id="7f1f3-134">Do pole **název** zadejte **App\_offline-Template. htm**a pak klikněte na **Přidat**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-134">In the **Name** box, type **App\_offline-template.htm**, and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image1.png)
5. <span data-ttu-id="7f1f3-135">Přidejte jednoduchý kód HTML, který informuje uživatele o tom, že aplikace není k dispozici, a pak soubor uložte.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-135">Add some simple HTML to inform users that the application is unavailable, and then save the file.</span></span> <span data-ttu-id="7f1f3-136">Nezahrnujte žádné značky na straně serveru (například všechny značky, které jsou s předponou "ASP:").</span><span class="sxs-lookup"><span data-stu-id="7f1f3-136">Do not include any server-side tags (for example, any tags that are prefixed with "asp:").</span></span> 

    ![](taking-web-applications-offline-with-web-deploy/_static/image2.png)
6. <span data-ttu-id="7f1f3-137">V okně **Průzkumník řešení** klikněte pravým tlačítkem myši na nový soubor a potom klikněte na příkaz **vlastnosti**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-137">In the **Solution Explorer** window, right-click the new file, and then click **Properties**.</span></span>
7. <span data-ttu-id="7f1f3-138">V okně **vlastnosti** vyberte na řádku **Akce sestavení** možnost **žádný**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-138">In the **Properties** window, in the **Build Action** row, select **None**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image3.png)

## <a name="deploying-and-deleting-an-app_offline-file"></a><span data-ttu-id="7f1f3-139">Nasazení a odstranění aplikace\_offline souboru</span><span class="sxs-lookup"><span data-stu-id="7f1f3-139">Deploying and Deleting an App\_Offline File</span></span>

<span data-ttu-id="7f1f3-140">Dalším krokem je úprava logiky nasazení a zkopírování souboru na cílový server na začátku procesu nasazení a jeho odebrání na konci.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-140">The next step is to modify your deployment logic to copy the file to the destination server at the start of the deployment process and remove it at the end.</span></span>

> [!NOTE]
> <span data-ttu-id="7f1f3-141">Další postup předpokládá, že používáte vlastní soubor projektu MSBuild k řízení procesu nasazení, jak je popsáno v tématu [Principy souboru projektu](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span><span class="sxs-lookup"><span data-stu-id="7f1f3-141">The next procedure assumes that you're using a custom MSBuild project file to control your deployment process, as described in [Understanding the Project File](../web-deployment-in-the-enterprise/understanding-the-project-file.md).</span></span> <span data-ttu-id="7f1f3-142">Pokud nasazujete přímo ze sady Visual Studio, budete muset použít jiný přístup.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-142">If you're deploying direct from Visual Studio, you'll need to use a different approach.</span></span> <span data-ttu-id="7f1f3-143">Sayed Ibrahim Hashimi popisuje jeden takový postup, [jak během publikování převést vaši webovou aplikaci do offline režimu](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span><span class="sxs-lookup"><span data-stu-id="7f1f3-143">Sayed Ibrahim Hashimi describes one such approach in [How to Take Your Web App Offline During Publishing](http://sedodream.com/2012/01/08/HowToTakeYourWebAppOfflineDuringPublishing.aspx).</span></span>

<span data-ttu-id="7f1f3-144">Chcete-li nasadit *aplikaci\_offline* souboru na cílový web služby IIS, je nutné vyvolat soubor MSDeploy. exe pomocí [zprostředkovatele nasazení webu **contentPath** ](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span><span class="sxs-lookup"><span data-stu-id="7f1f3-144">To deploy an *App\_offline* file to a destination IIS website, you need to invoke MSDeploy.exe using the [Web Deploy **contentPath** provider](https://technet.microsoft.com/library/dd569034(WS.10).aspx).</span></span> <span data-ttu-id="7f1f3-145">Zprostředkovatel **contentPath** podporuje cesty k fyzickým adresářům i webové aplikace IIS nebo cesty k aplikacím, což usnadňuje volbu synchronizace souborů mezi složkou projektu sady Visual Studio a webovou aplikací služby IIS.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-145">The **contentPath** provider supports both physical directory paths and IIS website or application paths, which makes it the ideal choice for synchronizing a file between a Visual Studio project folder and an IIS web application.</span></span> <span data-ttu-id="7f1f3-146">Chcete-li nasadit soubor, váš příkaz MSDeploy by měl vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="7f1f3-146">To deploy the file, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample1.cmd)]

<span data-ttu-id="7f1f3-147">Chcete-li odebrat soubor z cílové lokality na konci procesu nasazení, příkaz MSDeploy by měl vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="7f1f3-147">To remove the file from the destination site at the end of the deployment process, your MSDeploy command should resemble this:</span></span>

[!code-console[Main](taking-web-applications-offline-with-web-deploy/samples/sample2.cmd)]

<span data-ttu-id="7f1f3-148">Chcete-li tyto příkazy automatizovat jako součást procesu sestavení a nasazení, je třeba je integrovat do vlastního souboru projektu MSBuild.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-148">To automate these commands as part of a build and deployment process, you need to integrate them into your custom MSBuild project file.</span></span> <span data-ttu-id="7f1f3-149">Další postup popisuje, jak to provést.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-149">The next procedure describes how to do this.</span></span>

<span data-ttu-id="7f1f3-150">**Nasazení a odstranění aplikace\_offline souboru**</span><span class="sxs-lookup"><span data-stu-id="7f1f3-150">**To deploy and delete an App\_offline file**</span></span>

1. <span data-ttu-id="7f1f3-151">V aplikaci Visual Studio 2010 otevřete soubor projektu MSBuild, který řídí proces nasazení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-151">In Visual Studio 2010, open the MSBuild project file that controls your deployment process.</span></span> <span data-ttu-id="7f1f3-152">V ukázkovém řešení [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) se jedná o soubor *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-152">In the [Contact Manager](../web-deployment-in-the-enterprise/the-contact-manager-solution.md) sample solution, this is the *Publish.proj* file.</span></span>
2. <span data-ttu-id="7f1f3-153">V kořenovém elementu **projektu** vytvořte nový prvek **Property** pro ukládání proměnných *aplikace\_offline* nasazení:</span><span class="sxs-lookup"><span data-stu-id="7f1f3-153">In the root **Project** element, create a new **PropertyGroup** element to store variables for the *App\_offline* deployment:</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample3.xml)]
3. <span data-ttu-id="7f1f3-154">Vlastnost **SourceRoot** je definována jinde v souboru *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-154">The **SourceRoot** property is defined elsewhere in the *Publish.proj* file.</span></span> <span data-ttu-id="7f1f3-155">Označuje umístění kořenové složky pro zdrojový obsah vzhledem k aktuální cestě&#x2014;jinými slovy vzhledem k umístění souboru *Publish. proj* .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-155">It indicates the location of the root folder for the source content relative to the current path&#x2014;in other words, relative to the location of the *Publish.proj* file.</span></span>
4. <span data-ttu-id="7f1f3-156">Zprostředkovatel služby **contentPath** nebude akceptovat relativní cesty k souborům, takže před jeho nasazením musíte získat absolutní cestu ke zdrojovému souboru.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-156">The **contentPath** provider will not accept relative file paths, so you need to get an absolute path to your source file before you can deploy it.</span></span> <span data-ttu-id="7f1f3-157">K tomu můžete použít úlohu [ConvertToAbsolutePath –](https://msdn.microsoft.com/library/bb882668.aspx) .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-157">You can use the [ConvertToAbsolutePath](https://msdn.microsoft.com/library/bb882668.aspx) task to do this.</span></span>
5. <span data-ttu-id="7f1f3-158">Přidejte nový **cílový** element s názvem **GetAppOfflineAbsolutePath**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-158">Add a new **Target** element named **GetAppOfflineAbsolutePath**.</span></span> <span data-ttu-id="7f1f3-159">V rámci tohoto cíle použijte úlohu **ConvertToAbsolutePath –** k získání absolutní cesty k *aplikaci\_offline souboru šablony* do složky projektu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-159">Within this target, use the **ConvertToAbsolutePath** task to get an absolute path to the *App\_offline-template* file in your project folder.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample4.xml)]
6. <span data-ttu-id="7f1f3-160">Tento cíl vezme relativní cestu k *aplikaci\_offline souboru šablony* ve složce projektu a uloží ji do nové vlastnosti jako absolutní cestu k souboru.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-160">This target takes the relative path to the *App\_offline-template* file in your project folder and saves it to a new property as an absolute file path.</span></span> <span data-ttu-id="7f1f3-161">Atribut **BeforeTargets** určuje, že chcete, aby se tento cíl spustil před cílem **DeployAppOffline** , který vytvoříte v dalším kroku.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-161">The **BeforeTargets** attribute specifies that you want this target to execute before the **DeployAppOffline** target, which you'll create in the next step.</span></span>
7. <span data-ttu-id="7f1f3-162">Přidejte nový cíl s názvem **DeployAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-162">Add a new target named **DeployAppOffline**.</span></span> <span data-ttu-id="7f1f3-163">V rámci tohoto cíle volejte příkaz MSDeploy. exe, který nasadí vaši *aplikaci\_offline* souboru na cílový webový server.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-163">Within this target, invoke the MSDeploy.exe command that deploys your *App\_offline* file to the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample5.xml)]
8. <span data-ttu-id="7f1f3-164">V tomto příkladu je vlastnost **ContactManagerIisPath** definovaná jinde v souboru projektu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-164">In this example, the **ContactManagerIisPath** property is defined elsewhere in the project file.</span></span> <span data-ttu-id="7f1f3-165">Toto je jednoduše cesta k aplikaci služby IIS ve formátu *[název webu IIS]/[název aplikace]* .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-165">This is simply an IIS application path, in the form *[IIS Website Name]/[Application Name]*.</span></span> <span data-ttu-id="7f1f3-166">Zahrnutí podmínky v cíli umožňuje uživatelům přepínání *aplikace\_offline* nasazení, a to změnou hodnoty vlastnosti nebo zadáním parametru příkazového řádku.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-166">Including a condition in the target enables users to switch the *App\_offline* deployment on or off by changing a property value or providing a command-line parameter.</span></span>
9. <span data-ttu-id="7f1f3-167">Přidejte nový cíl s názvem **DeleteAppOffline**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-167">Add a new target named **DeleteAppOffline**.</span></span> <span data-ttu-id="7f1f3-168">V rámci tohoto cíle volejte příkaz MSDeploy. exe, který odebere vaši *aplikaci\_offline* souboru z cílového webového serveru.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-168">Within this target, invoke the MSDeploy.exe command that removes your *App\_offline* file from the destination web server.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample6.xml)]
10. <span data-ttu-id="7f1f3-169">Konečným úkolem je vyvolat tyto nové cíle v příslušných bodech během provádění souboru projektu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-169">The final task is to invoke these new targets at appropriate points during the execution of your project file.</span></span> <span data-ttu-id="7f1f3-170">Můžete to udělat různými způsoby.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-170">You can do this in various ways.</span></span> <span data-ttu-id="7f1f3-171">Například v souboru *Publish. proj* vlastnost **FullPublishDependsOn** určuje seznam cílů, které musí být spuštěny v pořadí, kdy je vyvolán výchozí cíl **FullPublish** .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-171">For example, in the *Publish.proj* file, the **FullPublishDependsOn** property specifies a list of targets that must be executed in order when the **FullPublish** default target is invoked.</span></span>
11. <span data-ttu-id="7f1f3-172">Upravte soubor projektu MSBuild tak, aby vyvolal cíle **DeployAppOffline** a **DeleteAppOffline** ve vhodných bodech v procesu publikování.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-172">Modify your MSBuild project file to invoke the **DeployAppOffline** and **DeleteAppOffline** targets at appropriate points in the publishing process.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample7.xml)]

<span data-ttu-id="7f1f3-173">Když spustíte vlastní soubor projektu MSBuild, *aplikace\_offline* soubor se nasadí na server hned po úspěšném sestavení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-173">When you run your custom MSBuild project file, the *App\_offline* file will be deployed to the server immediately after a successful build.</span></span> <span data-ttu-id="7f1f3-174">Po dokončení všech úloh nasazení se pak odstraní ze serveru.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-174">It will then be deleted from the server once all the deployment tasks are complete.</span></span>

## <a name="adding-an-app_offline-file-to-deployment-packages"></a><span data-ttu-id="7f1f3-175">Přidání aplikace\_offline souboru do balíčků pro nasazení</span><span class="sxs-lookup"><span data-stu-id="7f1f3-175">Adding an App\_Offline File to Deployment Packages</span></span>

<span data-ttu-id="7f1f3-176">V závislosti na tom, jak nakonfigurujete nasazení, se&#x2014;&#x2014;může při nasazení webového balíčku do cíle automaticky odstranit veškerý existující obsah v cílové webové aplikaci IIS, jako je například *aplikace\_offline. htm* .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-176">Depending on how you configure your deployment, any existing content at the destination IIS web application&#x2014;like the *App\_offline.htm* file&#x2014;may be deleted automatically when you deploy a web package to the destination.</span></span> <span data-ttu-id="7f1f3-177">Aby bylo zajištěno, že *aplikace\_offline souboru. htm* zůstane v platnosti po dobu trvání nasazení, je třeba zahrnout soubor do samotného balíčku pro nasazení webu společně s nasazením souboru přímo na začátku procesu nasazení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-177">To ensure that the *App\_offline.htm* file remains in place for the duration of the deployment, you need to include the file within the web deployment package itself in addition to deploying the file directly at the start of the deployment process.</span></span>

- <span data-ttu-id="7f1f3-178">Pokud jste postupovali s předchozími úkoly v tomto tématu, přihlásili jste se do projektu webové aplikace *\_v režimu offline. htm aplikace* v jiném názvu souboru (používáme *App\_offline-Template. htm*) a nastavíte akci sestavení na **žádná**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-178">If you've followed the previous tasks in this topic, you'll have added the *App\_offline.htm* file to your web application project under a different filename (we used *App\_offline-template.htm*) and you'll have set the build action to **None**.</span></span> <span data-ttu-id="7f1f3-179">Tyto změny jsou nezbytné, aby se zabránilo souboru v konfliktu s vývojem a laděním.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-179">These changes are necessary to prevent the file from interfering with development and debugging.</span></span> <span data-ttu-id="7f1f3-180">V důsledku toho je nutné přizpůsobit proces balení, aby bylo zajištěno, že *aplikace\_offline souboru. htm* je součástí balíčku pro nasazení webu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-180">As a result, you need to customize the packaging process to ensure that the *App\_offline.htm* file is included in the web deployment package.</span></span>

<span data-ttu-id="7f1f3-181">Kanál pro publikování na webu (WPP) používá seznam položek s názvem **FilesForPackagingFromProject** k vytvoření seznamu souborů, které by měly být zahrnuty do balíčku pro nasazení webu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-181">The Web Publishing Pipeline (WPP) uses an item list named **FilesForPackagingFromProject** to build a list of files that should be included in the web deployment package.</span></span> <span data-ttu-id="7f1f3-182">Obsah svých webových balíčků můžete přizpůsobit přidáním vlastních položek do tohoto seznamu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-182">You can customize the contents of your web packages by adding your own items to this list.</span></span> <span data-ttu-id="7f1f3-183">K tomu je potřeba provést tyto kroky vysoké úrovně:</span><span class="sxs-lookup"><span data-stu-id="7f1f3-183">To do this, you need to complete these high-level steps:</span></span>

1. <span data-ttu-id="7f1f3-184">Vytvořte vlastní soubor projektu nazvaný *[název projektu]. WPP. targets* ve stejné složce jako soubor projektu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-184">Create a custom project file named *[project name].wpp.targets* in the same folder as your project file.</span></span>

    > [!NOTE]
    > <span data-ttu-id="7f1f3-185">Soubor *. WPP. targets* musí být ve stejné složce jako soubor&#x2014;projektu webové aplikace, například *ContactManager. Mvc. csproj*&#x2014;, nikoli ve stejné složce jako jakékoli vlastní soubory projektu, které slouží k řízení procesu sestavení a nasazení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-185">The *.wpp.targets* file needs to go in the same folder as your web application project file&#x2014;for example, *ContactManager.Mvc.csproj*&#x2014;rather than in the same folder as any custom project files you use to control the build and deployment process.</span></span>
2. <span data-ttu-id="7f1f3-186">V souboru *. WPP. targets* vytvořte nový cíl nástroje MSBuild, který se spustí *před* cílem **CopyAllFilesToSingleFolderForPackage** .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-186">In the *.wpp.targets* file, create a new MSBuild target that executes *before* the **CopyAllFilesToSingleFolderForPackage** target.</span></span> <span data-ttu-id="7f1f3-187">Toto je cíl WPP, který vytváří seznam věcí, které se mají zahrnout do balíčku.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-187">This is the WPP target that builds a list of things to include in the package.</span></span>
3. <span data-ttu-id="7f1f3-188">V novém cíli vytvořte element **Item** .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-188">In the new target, create an **ItemGroup** element.</span></span>
4. <span data-ttu-id="7f1f3-189">V prvku skupiny **položek** přidejte položku **FilesForPackagingFromProject** a určete *aplikaci\_offline. htm* .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-189">In the **ItemGroup** element, add a **FilesForPackagingFromProject** item and specify the *App\_offline.htm* file.</span></span>

<span data-ttu-id="7f1f3-190">Soubor *. WPP. targets* by měl vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="7f1f3-190">The *.wpp.targets* file should resemble this:</span></span>

[!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample8.xml)]

<span data-ttu-id="7f1f3-191">Toto jsou klíčové body poznámky v tomto příkladu:</span><span class="sxs-lookup"><span data-stu-id="7f1f3-191">These are the key points of note in this example:</span></span>

- <span data-ttu-id="7f1f3-192">Atribut **BeforeTargets** vloží tento cíl do WPP tím, že určí, že by měl být proveden těsně před cílem **CopyAllFilesToSingleFolderForPackage** .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-192">The **BeforeTargets** attribute inserts this target into the WPP by specifying that it should be executed immediately before the **CopyAllFilesToSingleFolderForPackage** target.</span></span>
- <span data-ttu-id="7f1f3-193">Položka **FilesForPackagingFromProject** používá hodnotu metadat **DestinationRelativePath** k přejmenování souboru z *aplikace\_offline-template. htm* na *aplikaci\_offline. htm* při přidání do seznamu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-193">The **FilesForPackagingFromProject** item uses the **DestinationRelativePath** metadata value to rename the file from *App\_offline-template.htm* to *App\_offline.htm* as it's added to the list.</span></span>

<span data-ttu-id="7f1f3-194">Následující postup ukazuje, jak přidat tento soubor *. WPP. targets* do projektu webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-194">The next procedure shows you how to add this *.wpp.targets* file to a web application project.</span></span>

<span data-ttu-id="7f1f3-195">**Přidání souboru. WPP. targets do balíčku pro nasazení webu**</span><span class="sxs-lookup"><span data-stu-id="7f1f3-195">**To add a .wpp.targets file to a web deployment package**</span></span>

1. <span data-ttu-id="7f1f3-196">Otevřete řešení v aplikaci Visual Studio 2010.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-196">Open your solution in Visual Studio 2010.</span></span>
2. <span data-ttu-id="7f1f3-197">V okně **Průzkumník řešení** klikněte pravým tlačítkem myši na uzel projektu webové aplikace (například **ContactManager. Mvc**), přejděte na **Přidat**a klikněte na **Nová položka**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-197">In the **Solution Explorer** window, right-click your web application project node (for example, **ContactManager.Mvc**), point to **Add**, and then click **New Item**.</span></span>
3. <span data-ttu-id="7f1f3-198">V dialogovém okně **Přidat novou položku** vyberte šablonu **souboru XML** .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-198">In the **Add New Item** dialog box, select the **XML File** template.</span></span>
4. <span data-ttu-id="7f1f3-199">Do pole **název** zadejte *[název projektu] \* \* *. WPP. targets** (například **ContactManager. Mvc. WPP. targets**) a pak klikněte na **Přidat**.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-199">In the **Name** box, type *[project name]\*\*\*.wpp.targets*\* (for example, **ContactManager.Mvc.wpp.targets**), and then click **Add**.</span></span>

    ![](taking-web-applications-offline-with-web-deploy/_static/image4.png)

    > [!NOTE]
    > <span data-ttu-id="7f1f3-200">Pokud přidáte novou položku do kořenového uzlu projektu, je soubor vytvořen ve stejné složce jako soubor projektu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-200">If you add a new item to the root node of a project, the file is created in the same folder as the project file.</span></span> <span data-ttu-id="7f1f3-201">To můžete ověřit tak, že otevřete složku v Průzkumníku Windows.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-201">You can verify this by opening the folder in Windows Explorer.</span></span>
5. <span data-ttu-id="7f1f3-202">Do souboru přidejte kód MSBuild popsaný výše.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-202">In the file, add the MSBuild markup described previously.</span></span>

    [!code-xml[Main](taking-web-applications-offline-with-web-deploy/samples/sample9.xml)]
6. <span data-ttu-id="7f1f3-203">Uložte a zavřete soubor *[název projektu]. WPP. targets* .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-203">Save and close the *[project name].wpp.targets* file.</span></span>

<span data-ttu-id="7f1f3-204">Při příštím sestavení a zabalení projektu webové aplikace bude modul WPP automaticky detekovat soubor *. WPP. targets* .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-204">The next time you build and package your web application project, the WPP will automatically detect the *.wpp.targets* file.</span></span> <span data-ttu-id="7f1f3-205">Soubor *app\_offline-Template. htm* bude součástí výsledného balíčku pro nasazení webu jako *aplikace\_offline. htm*.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-205">The *App\_offline-template.htm* file will be included in the resulting web deployment package as *App\_offline.htm*.</span></span>

> [!NOTE]
> <span data-ttu-id="7f1f3-206">Pokud se nasazení nezdaří, *aplikace\_offline souboru. htm* zůstane na svém místě a vaše aplikace zůstane offline.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-206">If your deployment fails, the *App\_offline.htm* file will remain in place and your application will remain offline.</span></span> <span data-ttu-id="7f1f3-207">To je obvykle požadované chování.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-207">This is typically the desired behavior.</span></span> <span data-ttu-id="7f1f3-208">Pokud chcete aplikaci převést zpět do režimu online, můžete *aplikaci odstranit\_offline souboru. htm* z webového serveru.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-208">To bring your application back online, you can delete the *App\_offline.htm* file from your web server.</span></span> <span data-ttu-id="7f1f3-209">Případně, pokud opravíte nějaké chyby a spustíte úspěšné nasazení, bude odebrána *aplikace\_offline souboru. htm* .</span><span class="sxs-lookup"><span data-stu-id="7f1f3-209">Alternatively, if you correct any errors and run a successful deployment, the *App\_offline.htm* file will be removed.</span></span>

## <a name="conclusion"></a><span data-ttu-id="7f1f3-210">Závěr</span><span class="sxs-lookup"><span data-stu-id="7f1f3-210">Conclusion</span></span>

<span data-ttu-id="7f1f3-211">Toto téma popisuje, jak převést webovou aplikaci do režimu offline po dobu trvání nasazení, publikováním *aplikace\_souboru offline. htm* na cílovém serveru na začátku procesu nasazení a jeho odebráním na konci.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-211">This topic described how to take a web application offline for the duration of a deployment, by publishing an *App\_offline.htm* file to the destination server at the start of the deployment process and removing it at the end.</span></span> <span data-ttu-id="7f1f3-212">Popisuje také způsob zahrnutí *aplikace\_offline souboru. htm* do balíčku pro nasazení webu.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-212">It also covered how to include an *App\_offline.htm* file in a web deployment package.</span></span>

## <a name="further-reading"></a><span data-ttu-id="7f1f3-213">Další čtení</span><span class="sxs-lookup"><span data-stu-id="7f1f3-213">Further Reading</span></span>

<span data-ttu-id="7f1f3-214">Další informace o procesu balení a nasazení najdete v tématu [sestavování a balení projektů webových aplikací](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Konfigurace parametrů pro nasazení webového balíčku](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md)a [nasazení webových balíčků](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span><span class="sxs-lookup"><span data-stu-id="7f1f3-214">For more information on the packaging and deployment process, see [Building and Packaging Web Application Projects](../web-deployment-in-the-enterprise/building-and-packaging-web-application-projects.md), [Configuring Parameters for Web Package Deployment](../web-deployment-in-the-enterprise/configuring-parameters-for-web-package-deployment.md), and [Deploying Web Packages](../web-deployment-in-the-enterprise/deploying-web-packages.md).</span></span>

<span data-ttu-id="7f1f3-215">Pokud publikujete své webové aplikace přímo ze sady Visual Studio a nepoužijete vlastní přístup k souboru projektu MSBuild popsaný v těchto kurzech, budete muset při publikování převést aplikaci do offline režimu. přihlášení.</span><span class="sxs-lookup"><span data-stu-id="7f1f3-215">If you publish your web applications directly from Visual Studio, rather than using the custom MSBuild project file approach described in these tutorials, you'll need to use a slightly different approach to take your application offline during the publishing process.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="7f1f3-216">[Předchozí](excluding-files-and-folders-from-deployment.md)
> [Další](running-windows-powershell-scripts-from-msbuild-project-files.md)</span><span class="sxs-lookup"><span data-stu-id="7f1f3-216">[Previous](excluding-files-and-folders-from-deployment.md)
[Next](running-windows-powershell-scripts-from-msbuild-project-files.md)</span></span>
