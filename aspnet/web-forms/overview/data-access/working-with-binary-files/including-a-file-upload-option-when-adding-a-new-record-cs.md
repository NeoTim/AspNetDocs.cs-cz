---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
title: Zahrnutí možnosti nahrání souboru při přidání nového záznamu (C#) | Microsoft Docs
author: rick-anderson
description: V tomto kurzu se dozvíte, jak vytvořit webové rozhraní, které umožňuje uživateli zadat textová data a nahrát binární soubory. K ilustraci dostupných možností t...
ms.author: riande
ms.date: 03/27/2007
ms.assetid: 362ade25-3965-4fb2-88d2-835c4786244f
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-cs
msc.type: authoredcontent
ms.openlocfilehash: f1287e180151b3034a7b90ef4b3f1fbe68354a09
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/28/2019
ms.locfileid: "74577169"
---
# <a name="including-a-file-upload-option-when-adding-a-new-record-c"></a><span data-ttu-id="b94e2-104">Zahrnutí možnosti nahrání souboru při přidání nového záznamu (C#)</span><span class="sxs-lookup"><span data-stu-id="b94e2-104">Including a File Upload Option When Adding a New Record (C#)</span></span>

<span data-ttu-id="b94e2-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b94e2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b94e2-106">[Stáhnout ukázkovou aplikaci](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) nebo [Stáhnout PDF](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="b94e2-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_CS.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-cs/_static/datatutorial56cs1.pdf)</span></span>

> <span data-ttu-id="b94e2-107">V tomto kurzu se dozvíte, jak vytvořit webové rozhraní, které umožňuje uživateli zadat textová data a nahrát binární soubory.</span><span class="sxs-lookup"><span data-stu-id="b94e2-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="b94e2-108">K ilustraci možností dostupných pro ukládání binárních dat se v databázi uloží jeden soubor, zatímco druhý je uložený v systému souborů.</span><span class="sxs-lookup"><span data-stu-id="b94e2-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>

## <a name="introduction"></a><span data-ttu-id="b94e2-109">Úvod</span><span class="sxs-lookup"><span data-stu-id="b94e2-109">Introduction</span></span>

<span data-ttu-id="b94e2-110">V předchozích dvou kurzech jsme prozkoumali techniky pro ukládání binárních dat, která jsou přidružená k datovému modelu aplikace s. prohlédli jsme si, jak pomocí ovládacího prvku pro nahrání souborů odesílat soubory z klienta na webový server a jak prezentovat tato binární data v datech. ovládací prvek eb</span><span class="sxs-lookup"><span data-stu-id="b94e2-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="b94e2-111">Ještě máme mluvit o tom, jak přidružit nahraná data k datovému modelu, ale.</span><span class="sxs-lookup"><span data-stu-id="b94e2-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="b94e2-112">V tomto kurzu vytvoříme webovou stránku, na které se přidá nová kategorie.</span><span class="sxs-lookup"><span data-stu-id="b94e2-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="b94e2-113">Kromě textových polí pro název a Popis kategorie a bude tato stránka muset zahrnovat dva ovládací prvky pro nahrání souborů pro nový obrázek kategorie a jeden pro brožuru.</span><span class="sxs-lookup"><span data-stu-id="b94e2-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="b94e2-114">Nahraný obrázek bude uložen přímo ve sloupci nový záznam s `Picture`, zatímco brožura bude uložena do složky `~/Brochures` s cestou k souboru uloženému ve sloupci nový záznam s `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="b94e2-115">Před vytvořením této nové webové stránky budeme muset architekturu aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="b94e2-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="b94e2-116">Hlavní dotaz `CategoriesTableAdapter` s nenačítá `Picture` sloupci.</span><span class="sxs-lookup"><span data-stu-id="b94e2-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="b94e2-117">V důsledku toho metoda automaticky generovaného `Insert` má pouze vstupy pro pole `CategoryName`, `Description`a `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="b94e2-118">Proto musíme v TableAdapter vytvořit další metodu, která vyzve k zadání všech čtyř `Categories` polí.</span><span class="sxs-lookup"><span data-stu-id="b94e2-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="b94e2-119">Třída `CategoriesBLL` v vrstvě obchodní logiky bude také muset aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="b94e2-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="b94e2-120">Krok 1: Přidání metody`InsertWithPicture`do`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="b94e2-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="b94e2-121">Když jsme vytvořili `CategoriesTableAdapter` zpátky v kurzu [Vytvoření vrstvy přístupu k datům](../introduction/creating-a-data-access-layer-cs.md) , nakonfigurovali jsme ji tak, aby na základě hlavního dotazu automaticky generovala příkazy `INSERT`, `UPDATE`a `DELETE`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="b94e2-122">Kromě toho jsme TableAdapteri, že používá přímý přístup k databázi, který vytvořil metody `Insert`, `Update`a `Delete`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="b94e2-123">Tyto metody spouštějí automaticky generované `INSERT`, `UPDATE`a `DELETE` příkazy a následně přijímají vstupní parametry založené na sloupcích vrácených hlavním dotazem.</span><span class="sxs-lookup"><span data-stu-id="b94e2-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="b94e2-124">V kurzu [nahrávání souborů](uploading-files-cs.md) jsme vylepšili hlavní dotaz `CategoriesTableAdapter` s pro použití sloupce `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-124">In the [Uploading Files](uploading-files-cs.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="b94e2-125">Vzhledem k tomu, že hlavní dotaz `CategoriesTableAdapter` s neodkazuje na sloupec `Picture`, nemůžeme přidat nový záznam ani aktualizovat existující záznam s hodnotou sloupce `Picture`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="b94e2-126">Aby bylo možné zachytit tyto informace, můžeme buď vytvořit novou metodu v TableAdapter, která se používá speciálně pro vložení záznamu s binárními daty, nebo můžeme přizpůsobit automaticky generovaný `INSERT` příkaz.</span><span class="sxs-lookup"><span data-stu-id="b94e2-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="b94e2-127">Problém s přizpůsobením automaticky generovaného příkazu `INSERT` je to, že riskujeme, že naše přizpůsobení přepsal průvodcem.</span><span class="sxs-lookup"><span data-stu-id="b94e2-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="b94e2-128">Představte si například, že jsme přizpůsobili příkaz `INSERT`, aby zahrnoval použití `Picture` sloupce.</span><span class="sxs-lookup"><span data-stu-id="b94e2-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="b94e2-129">Tím se aktualizuje metoda TableAdapter s `Insert` tak, aby zahrnovala další vstupní parametr pro binární data kategorie s obrázku.</span><span class="sxs-lookup"><span data-stu-id="b94e2-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="b94e2-130">Pak můžeme vytvořit metodu v vrstvě obchodní logiky, která použije tuto metodu DAL, a vyvolat tuto metodu knihoven BLL prostřednictvím prezentační vrstvy a vše by fungovalo velmi dokonalé.</span><span class="sxs-lookup"><span data-stu-id="b94e2-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="b94e2-131">To znamená, až do příštího nakonfigurovaného TableAdapter prostřednictvím Průvodce konfigurací TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="b94e2-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="b94e2-132">Jakmile se průvodce dokončí, naše přizpůsobení `INSERT` příkazu by se přepsaly, `Insert` metoda by se vrátila do původní formy a náš kód by se už nekompiluje!</span><span class="sxs-lookup"><span data-stu-id="b94e2-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="b94e2-133">Nejedná se o problém při použití uložených procedur místo ad-hoc příkazů SQL.</span><span class="sxs-lookup"><span data-stu-id="b94e2-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="b94e2-134">V budoucím kurzu se místo ad-hoc příkazů SQL ve vrstvě přístupu k datům podíváme na použití uložených procedur.</span><span class="sxs-lookup"><span data-stu-id="b94e2-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>

<span data-ttu-id="b94e2-135">Aby se zabránilo tomuto potenciálnímu starostí, nemusíte místo přizpůsobení automaticky generovaných příkazů SQL vytvořit novou metodu pro TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="b94e2-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="b94e2-136">Tato metoda s názvem `InsertWithPicture`akceptuje hodnoty pro sloupce `CategoryName`, `Description`, `BrochurePath`a `Picture` a spustí příkaz `INSERT`, který ukládá všechny čtyři hodnoty do nového záznamu.</span><span class="sxs-lookup"><span data-stu-id="b94e2-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="b94e2-137">Otevřete typovou datovou sadu a v návrháři klikněte pravým tlačítkem myši na záhlaví `CategoriesTableAdapter` s a v místní nabídce vyberte možnost Přidat dotaz.</span><span class="sxs-lookup"><span data-stu-id="b94e2-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="b94e2-138">Tím se spustí Průvodce konfigurací dotazu TableAdapter, který začíná dotazem, jak by měl dotaz TableAdapter získat přístup k databázi.</span><span class="sxs-lookup"><span data-stu-id="b94e2-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="b94e2-139">Vyberte možnost použít příkazy jazyka SQL a klikněte na tlačítko Další.</span><span class="sxs-lookup"><span data-stu-id="b94e2-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="b94e2-140">V dalším kroku se zobrazí výzva k zadání typu dotazu, který se má vygenerovat.</span><span class="sxs-lookup"><span data-stu-id="b94e2-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="b94e2-141">Vzhledem k tomu, že jsme znovu vytvořili dotaz pro přidání nového záznamu do tabulky `Categories`, vyberte možnost Vložit a klikněte na tlačítko Další.</span><span class="sxs-lookup"><span data-stu-id="b94e2-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>

<span data-ttu-id="b94e2-142">[![vyberte možnost vložení.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image1.png)</span></span>

<span data-ttu-id="b94e2-143">**Obrázek 1**: vyberte možnost vložení ([kliknutím zobrazíte obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png)).</span><span class="sxs-lookup"><span data-stu-id="b94e2-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.png))</span></span>

<span data-ttu-id="b94e2-144">Teď je potřeba zadat příkaz `INSERT` SQL.</span><span class="sxs-lookup"><span data-stu-id="b94e2-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="b94e2-145">Průvodce automaticky navrhne `INSERT` příkaz, který odpovídá hlavnímu dotazu TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="b94e2-146">V tomto případě je to příkaz `INSERT`, který vloží hodnoty `CategoryName`, `Description`a `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="b94e2-147">Aktualizujte příkaz tak, aby byl zahrnutý `Picture` sloupec společně s parametrem `@Picture`, například takto:</span><span class="sxs-lookup"><span data-stu-id="b94e2-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>

[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample1.sql)]

<span data-ttu-id="b94e2-148">Poslední obrazovka průvodce vás požádá o pojmenování nové metody TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="b94e2-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="b94e2-149">Zadejte `InsertWithPicture` a klikněte na Dokončit.</span><span class="sxs-lookup"><span data-stu-id="b94e2-149">Enter `InsertWithPicture` and click Finish.</span></span>

<span data-ttu-id="b94e2-150">[![název novou metodu TableAdapter InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.png)</span></span>

<span data-ttu-id="b94e2-151">**Obrázek 2**: pojmenování nové metody TableAdapter `InsertWithPicture` ([kliknutím zobrazíte obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="b94e2-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.png))</span></span>

## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="b94e2-152">Krok 2: aktualizace vrstvy obchodní logiky</span><span class="sxs-lookup"><span data-stu-id="b94e2-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="b94e2-153">Vzhledem k tomu, že prezentační vrstva by měla pouze rozhraní s vrstvou obchodní logiky, než ji obejít a přejít přímo do vrstvy přístupu k datům, musíme vytvořit metodu knihoven BLL, která vyvolá metodu DAL, kterou jsme právě vytvořili (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="b94e2-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="b94e2-154">Pro tento kurz vytvořte metodu ve třídě `CategoriesBLL` s názvem `InsertWithPicture`, která přijímá jako vstup tři `string` s a pole `byte`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `string` s and a `byte` array.</span></span> <span data-ttu-id="b94e2-155">Vstupní parametry `string` jsou pro název kategorie, popis a cestu k souboru brožury, zatímco `byte` pole je pro binární obsah obrázku kategorie s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-155">The `string` input parameters are for the category s name, description, and brochure file path, while the `byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="b94e2-156">Jak ukazuje následující kód, tato metoda knihoven BLL vyvolá odpovídající metodu DAL:</span><span class="sxs-lookup"><span data-stu-id="b94e2-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample2.cs)]

> [!NOTE]
> <span data-ttu-id="b94e2-157">Před přidáním metody `InsertWithPicture` do knihoven BLL se ujistěte, že jste uložili typovou datovou sadu.</span><span class="sxs-lookup"><span data-stu-id="b94e2-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="b94e2-158">Vzhledem k tomu, že se kód třídy `CategoriesTableAdapter` automaticky generuje na základě typované datové sady, pokud nechcete nejdřív Uložit změny do typované datové sady, nebude mít vlastnost `Adapter` informace o metodě `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won't know about the `InsertWithPicture` method.</span></span>

## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="b94e2-159">Krok 3: výpis stávajících kategorií a jejich binárních dat</span><span class="sxs-lookup"><span data-stu-id="b94e2-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="b94e2-160">V tomto kurzu vytvoříme stránku, která umožní koncovému uživateli přidat do systému novou kategorii a zadat obrázek a brožuru pro novou kategorii.</span><span class="sxs-lookup"><span data-stu-id="b94e2-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="b94e2-161">V [předchozím kurzu](displaying-binary-data-in-the-data-web-controls-cs.md) jsme použili prvek GridView s vlastností TemplateField a ImageField k zobrazení jednotlivých kategorií s názvem, popisem, obrázkem a odkazem ke stažení jeho brožury.</span><span class="sxs-lookup"><span data-stu-id="b94e2-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-cs.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="b94e2-162">Tuto funkci je možné replikovat pro tento kurz, takže se vytvoří stránka, která bude obsahovat seznam všech existujících kategorií a umožní vytváření nových.</span><span class="sxs-lookup"><span data-stu-id="b94e2-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="b94e2-163">Začněte tím, že otevřete stránku `DisplayOrDownload.aspx` ze složky `BinaryData`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="b94e2-164">Přejít do zobrazení zdroje a zkopírovat deklarativní syntaxi GridView a ObjectDataSource s a vložit do prvku `<asp:Content>` v `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="b94e2-165">Také nenezapomeňte kopírovat přes `GenerateBrochureLink` metodu z třídy kódu na pozadí `DisplayOrDownload.aspx` na `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>

<span data-ttu-id="b94e2-166">[![zkopírování a vložení deklarativní syntaxe ze DisplayOrDownload. aspx do UploadInDetailsView. aspx.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.png)</span></span>

<span data-ttu-id="b94e2-167">**Obrázek 3**: zkopírování a vložení deklarativní syntaxe z `DisplayOrDownload.aspx` do `UploadInDetailsView.aspx` ([kliknutím zobrazíte obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="b94e2-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.png))</span></span>

<span data-ttu-id="b94e2-168">Po zkopírování deklarativní syntaxe a metody `GenerateBrochureLink` do stránky `UploadInDetailsView.aspx` zobrazte stránku pomocí prohlížeče, aby bylo zajištěno, že vše bylo zkopírováno správně.</span><span class="sxs-lookup"><span data-stu-id="b94e2-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="b94e2-169">Měl by se zobrazit prvek GridView obsahující osm kategorií, které obsahují odkaz ke stažení brožury a také obrázek kategorie s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>

<span data-ttu-id="b94e2-170">[![by se teď měla zobrazit každá kategorie spolu s jejich binárními daty.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.png)</span></span>

<span data-ttu-id="b94e2-171">**Obrázek 4**: teď byste měli vidět jednotlivé kategorie spolu s jejími binárními daty ([kliknutím zobrazíte obrázek v plné velikosti).](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.png))</span></span>

## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="b94e2-172">Krok 4: Konfigurace`CategoriesDataSource`pro podporu vložení</span><span class="sxs-lookup"><span data-stu-id="b94e2-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="b94e2-173">`CategoriesDataSource` ObjectDataSource, kterou používá `Categories` GridView, aktuálně neposkytuje možnost vkládat data.</span><span class="sxs-lookup"><span data-stu-id="b94e2-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="b94e2-174">Aby bylo možné podporovat vkládání prostřednictvím tohoto ovládacího prvku zdroje dat, musíme namapovat svou `Insert` metodu na metodu v podkladovém objektu, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="b94e2-175">Konkrétně je chceme namapovat na `CategoriesBLL` metodu, kterou jsme přidali zpátky v kroku 2, `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="b94e2-176">Začněte tím, že kliknete na odkaz konfigurace zdroje dat z inteligentní značky ObjectDataSource s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="b94e2-177">Na první obrazovce se zobrazuje objekt, se kterým je zdroj dat nakonfigurován pro práci s `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="b94e2-178">Toto nastavení nechte beze změny a kliknutím na tlačítko Další přejděte na obrazovku definovat metody dat.</span><span class="sxs-lookup"><span data-stu-id="b94e2-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="b94e2-179">Přejděte na kartu Vložení a v rozevíracím seznamu vyberte metodu `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="b94e2-180">Kliknutím na Dokončit dokončete průvodce.</span><span class="sxs-lookup"><span data-stu-id="b94e2-180">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="b94e2-181">[![nakonfigurovat prvek ObjectDataSource na použití metody InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.png)</span></span>

<span data-ttu-id="b94e2-182">**Obrázek 5**: Konfigurace prvku ObjectDataSource pro použití metody `InsertWithPicture` ([kliknutím zobrazíte obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="b94e2-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.png))</span></span>

> [!NOTE]
> <span data-ttu-id="b94e2-183">Po dokončení průvodce může Visual Studio požádat, zda chcete aktualizovat pole a klíče, čímž dojde k opětovnému vygenerování polí webové ovládací prvky dat.</span><span class="sxs-lookup"><span data-stu-id="b94e2-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="b94e2-184">Zvolte možnost Ne, protože výběrem možnosti Ano dojde k přepsání všech úprav polí, které jste mohli udělat.</span><span class="sxs-lookup"><span data-stu-id="b94e2-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>

<span data-ttu-id="b94e2-185">Po dokončení průvodce prvek ObjectDataSource nyní zahrne hodnotu pro vlastnost `InsertMethod` a také `InsertParameters` pro sloupce čtyř kategorií, jak ukazuje následující deklarativní kód:</span><span class="sxs-lookup"><span data-stu-id="b94e2-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>

[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="b94e2-186">Krok 5: vytvoření rozhraní pro vložení</span><span class="sxs-lookup"><span data-stu-id="b94e2-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="b94e2-187">Jak je uvedeno v [přehledu o vkládání, aktualizaci a odstraňování dat](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), ovládací prvek DetailsView poskytuje integrované rozhraní pro vložení, které lze využít při práci s ovládacím prvkem zdroje dat, který podporuje vkládání.</span><span class="sxs-lookup"><span data-stu-id="b94e2-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="b94e2-188">Do této stránky přidejte ovládací prvek DetailsView nad prvek GridView, který bude trvale vykreslovat rozhraní pro vložení, což uživateli umožňuje rychle přidat novou kategorii.</span><span class="sxs-lookup"><span data-stu-id="b94e2-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="b94e2-189">Po přidání nové kategorie v ovládacím prvku DetailsView se prvek GridView pod ním automaticky aktualizuje a zobrazí novou kategorii.</span><span class="sxs-lookup"><span data-stu-id="b94e2-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="b94e2-190">Začněte přetažením prvku DetailsView z panelu nástrojů do návrháře nad ovládací prvek GridView, nastavením jeho vlastnosti `ID` na `NewCategory` a vymazáním hodnot vlastností `Height` a `Width`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="b94e2-191">Z inteligentní značky DetailsView s vytvořte vazby na existující `CategoriesDataSource` a zaškrtněte políčko Povolit vložení.</span><span class="sxs-lookup"><span data-stu-id="b94e2-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>

<span data-ttu-id="b94e2-192">[![Přivážete prvek DetailsView k CategoriesDataSource a povolit vkládání](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.png)</span></span>

<span data-ttu-id="b94e2-193">**Obrázek 6**: Svázání prvku DetailsView s `CategoriesDataSource` a povolení vložení ([kliknutím zobrazíte obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="b94e2-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image12.png))</span></span>

<span data-ttu-id="b94e2-194">Chcete-li prvek DetailsView trvale vykreslit v rozhraní pro vložení, nastavte jeho vlastnost `DefaultMode` na hodnotu `Insert`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="b94e2-195">Všimněte si, že prvek DetailsView má pět BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`a `BrochurePath` i když se `CategoryID` vlastnost BoundField nevykresluje v rozhraní pro vložení, protože jeho vlastnost `InsertVisible` je nastavená na `false`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `false`.</span></span> <span data-ttu-id="b94e2-196">Tyto BoundFields existují, protože jsou sloupce vracené metodou `GetCategories()`, což je to, co prvek ObjectDataSource vyvolá k načtení dat.</span><span class="sxs-lookup"><span data-stu-id="b94e2-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="b94e2-197">Pro vložení ale nechcete, aby uživatel mohl zadat hodnotu pro `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="b94e2-198">Kromě toho je potřeba jim dovolit, aby nahráli obrázek pro novou kategorii a nahráli PDF pro brožuru.</span><span class="sxs-lookup"><span data-stu-id="b94e2-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="b94e2-199">Odeberte `NumberOfProducts` vlastnost BoundField z ovládacího prvku DetailsView a pak aktualizujte `HeaderText` vlastnosti `CategoryName` a `BrochurePath` BoundFields na kategorii a brožuru v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="b94e2-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="b94e2-200">Dále převeďte `BrochurePath` vlastnost BoundField na TemplateField a přidejte nové pole TemplateField pro obrázek, čímž tuto novou hodnotu TemplateField `HeaderText` obrázku.</span><span class="sxs-lookup"><span data-stu-id="b94e2-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="b94e2-201">Přesuňte pole `Picture` TemplateField tak, aby bylo mezi `BrochurePath` TemplateField a CommandField.</span><span class="sxs-lookup"><span data-stu-id="b94e2-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>

![Navázání prvku DetailsView na CategoriesDataSource a povolení vložení](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image7.gif)

<span data-ttu-id="b94e2-203">**Obrázek 7**: Svázání prvku DetailsView s `CategoriesDataSource` a povolení vložení</span><span class="sxs-lookup"><span data-stu-id="b94e2-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>

<span data-ttu-id="b94e2-204">Pokud jste převedli `BrochurePath` vlastnost BoundField na TemplateField prostřednictvím dialogového okna Upravit pole, pole TemplateField zahrnuje `ItemTemplate`, `EditItemTemplate`a `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="b94e2-205">Je ale potřeba, abyste ale mohli odebrat i ostatní dvě šablony, ale nebudete mít k dispozici jenom `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="b94e2-206">V tomto okamžiku by deklarativní syntaxe ovládacího prvku DetailsView s vypadala takto:</span><span class="sxs-lookup"><span data-stu-id="b94e2-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="b94e2-207">Přidání ovládacích prvků nahrání souborů pro brožuru a pole obrázků</span><span class="sxs-lookup"><span data-stu-id="b94e2-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="b94e2-208">V předposílání `BrochurePath` TemplateField s `InsertItemTemplate` obsahuje textové pole, zatímco `Picture` TemplateField neobsahuje žádné šablony.</span><span class="sxs-lookup"><span data-stu-id="b94e2-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="b94e2-209">Abychom mohli použít ovládací prvky pro nahrání souborů, musíme tyto dvě `InsertItemTemplate`y TemplateField aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="b94e2-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="b94e2-210">Z inteligentní značky DetailsView s zvolte možnost Upravit šablony a potom v rozevíracím seznamu vyberte `InsertItemTemplate` `BrochurePath` TemplateField s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="b94e2-211">Odeberte textové pole a přetáhněte ovládací prvek pro nahrání souborů ze sady nástrojů do šablony.</span><span class="sxs-lookup"><span data-stu-id="b94e2-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="b94e2-212">Nastavte `ID` ovládacího prvku pro nahrání souboru s `BrochureUpload`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="b94e2-213">Podobně přidejte ovládací prvek pro nahrání souborů do `Picture` TemplateField s `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="b94e2-214">Nastavte tuto `ID` ovládacího prvku pro nahrání souborů na `PictureUpload`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>

<span data-ttu-id="b94e2-215">[![přidat ovládací prvek pro nahrání souborů do šablona InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image13.png)</span></span>

<span data-ttu-id="b94e2-216">**Obrázek 8**: Přidání ovládacího prvku pro nahrání souborů do `InsertItemTemplate` ([kliknutím zobrazíte obrázek v plné velikosti](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="b94e2-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image14.png))</span></span>

<span data-ttu-id="b94e2-217">Po provedení těchto dodatků bude tato dvě deklarativní syntaxe ' TemplateField s ':</span><span class="sxs-lookup"><span data-stu-id="b94e2-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>

[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample5.aspx)]

<span data-ttu-id="b94e2-218">Když uživatel přidá novou kategorii, chceme zajistit, aby byla brožura a obrázek správného typu souboru.</span><span class="sxs-lookup"><span data-stu-id="b94e2-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="b94e2-219">V případě brožury musí uživatel dodat soubor PDF.</span><span class="sxs-lookup"><span data-stu-id="b94e2-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="b94e2-220">Pro obrázek potřebujeme, aby uživatel nahrál soubor s obrázkem, ale povolili jsme *jakýkoliv* soubor obrázku nebo jenom soubory obrázků určitého typu, jako je GIF nebo JPGs?</span><span class="sxs-lookup"><span data-stu-id="b94e2-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="b94e2-221">Aby bylo možné použít různé typy souborů, potřebujeme, abyste rozšířili schéma `Categories`, aby zahrnovalo sloupec, který zachytává typ souboru, aby se tento typ mohl odeslat klientovi prostřednictvím `Response.ContentType` v `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="b94e2-222">Vzhledem k tomu, že tento sloupec nepoužíváme, by byl obezřetný, aby bylo možné omezit uživatelům pouze zadání konkrétního typu souboru obrázku.</span><span class="sxs-lookup"><span data-stu-id="b94e2-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="b94e2-223">Existující image `Categories` tabulky jsou rastrové obrázky, ale JPGs jsou vhodnější formát souboru pro obrázky, které jsou obsluhovány na webu.</span><span class="sxs-lookup"><span data-stu-id="b94e2-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="b94e2-224">Pokud uživatel nahraje nesprávný typ souboru, musíme zrušit vložení a zobrazit zprávu s informacemi o problému.</span><span class="sxs-lookup"><span data-stu-id="b94e2-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="b94e2-225">Přidejte ovládací prvek popisek webu pod ovládacím prvkem DetailsView.</span><span class="sxs-lookup"><span data-stu-id="b94e2-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="b94e2-226">Vlastnost `ID` nastavte na `UploadWarning`, vymažte vlastnost `Text`, nastavte vlastnost `CssClass` na Warning a `Visible` a `EnableViewState` vlastnosti na `false`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="b94e2-227">`Warning` Třída CSS je definována v `Styles.css` a vykresluje text ve velkém, červeném, kurzívě tučném písmu.</span><span class="sxs-lookup"><span data-stu-id="b94e2-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="b94e2-228">V ideálním případě se `CategoryName` a `Description` BoundFields převede na pole TemplateField a přizpůsobená rozhraní pro vložení.</span><span class="sxs-lookup"><span data-stu-id="b94e2-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="b94e2-229">Rozhraní `Description` pro vložení například by pravděpodobně lépe vyhovovalo víceřádkovým textovým polem.</span><span class="sxs-lookup"><span data-stu-id="b94e2-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="b94e2-230">A vzhledem k tomu, že `CategoryName` sloupec nepřijímá `NULL` hodnoty, měla by být přidána RequiredFieldValidator, která zajistí, že uživatel zadá hodnotu pro nový název kategorie.</span><span class="sxs-lookup"><span data-stu-id="b94e2-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="b94e2-231">Tento postup je ponechán jako cvičení pro čtenáře.</span><span class="sxs-lookup"><span data-stu-id="b94e2-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="b94e2-232">Přečtěte si další informace k [přizpůsobení rozhraní pro úpravu dat](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) pro podrobnější pohled na rozšíření rozhraní pro úpravu dat.</span><span class="sxs-lookup"><span data-stu-id="b94e2-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) for an in-depth look at augmenting the data modification interfaces.</span></span>

## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="b94e2-233">Krok 6: uložení nahrané brožury do systému souborů webového serveru s</span><span class="sxs-lookup"><span data-stu-id="b94e2-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="b94e2-234">Když uživatel zadá hodnoty do nové kategorie a klikne na tlačítko Vložit, dojde k postbacku a vložení pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="b94e2-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="b94e2-235">Nejprve se aktivuje [událost`ItemInserting`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="b94e2-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="b94e2-236">Dále je vyvolána metoda ObjectDataSource s `Insert()`, což vede k přidání nového záznamu do tabulky `Categories`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="b94e2-237">Poté je aktivována událost DetailsView s [`ItemInserted`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) .</span><span class="sxs-lookup"><span data-stu-id="b94e2-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="b94e2-238">Před vyvoláním metody ObjectDataSource `Insert()` je třeba nejprve zkontrolovat, že uživatel nahrál příslušné typy souborů a pak uložit brožuru PDF do systému souborů webového serveru s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="b94e2-239">Vytvořte obslužnou rutinu události pro událost DetailsView s `ItemInserting` a přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="b94e2-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample6.cs)]

<span data-ttu-id="b94e2-240">Obslužná rutina události začíná odkazem na ovládací prvek nahrání `BrochureUpload` ze šablon ovládacího prvku DetailsView s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="b94e2-241">Až se nahrála brožura, nahraná Přípona souboru s se vyšetří.</span><span class="sxs-lookup"><span data-stu-id="b94e2-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="b94e2-242">Pokud rozšíření není. PDF, zobrazí se upozornění, vložení se zruší a spuštění obslužné rutiny události skončí.</span><span class="sxs-lookup"><span data-stu-id="b94e2-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="b94e2-243">Spoléhání se na nahrané rozšíření souboru s není jistou technikou, aby bylo zajištěno, že nahraný soubor je dokument PDF.</span><span class="sxs-lookup"><span data-stu-id="b94e2-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="b94e2-244">Uživatel může mít platný dokument PDF s rozšířením `.Brochure`, nebo mohl vytvořit dokument, který není v PDF, a udělit mu `.pdf` rozšíření.</span><span class="sxs-lookup"><span data-stu-id="b94e2-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="b94e2-245">Binární obsah souboru s by se musel programově prozkoumat, aby bylo možné tento typ souboru ještě neprůkazně ověřit.</span><span class="sxs-lookup"><span data-stu-id="b94e2-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="b94e2-246">Takové důkladné přístupy se sice často přehnaně důkladné; Kontrola rozšíření je pro většinu scénářů dostačující.</span><span class="sxs-lookup"><span data-stu-id="b94e2-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>

<span data-ttu-id="b94e2-247">Jak je popsáno v kurzu při [nahrávání souborů](uploading-files-cs.md) , je potřeba při ukládání souborů do systému souborů dbát na to, aby jeden uživatel s nahráváním nepřepisoval další s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-247">As discussed in the [Uploading Files](uploading-files-cs.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="b94e2-248">V tomto kurzu se pokusíme použít stejný název jako nahraný soubor.</span><span class="sxs-lookup"><span data-stu-id="b94e2-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="b94e2-249">Pokud již existuje soubor v adresáři `~/Brochures` se stejným názvem souboru, přidáme číslo na konci, dokud nebude nalezen jedinečný název.</span><span class="sxs-lookup"><span data-stu-id="b94e2-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="b94e2-250">Například pokud uživatel nahraje soubor brožury s názvem `Meats.pdf`, ale ve složce `~/Brochures` již existuje soubor s názvem `Meats.pdf`, změníme název uloženého souboru na `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="b94e2-251">Pokud existuje, zkusíme `Meats-2.pdf`a tak dále, dokud se nenajde jedinečný název souboru.</span><span class="sxs-lookup"><span data-stu-id="b94e2-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="b94e2-252">Následující kód používá [metodu`File.Exists(path)`](https://msdn.microsoft.com/library/system.io.file.exists.aspx) k určení, zda soubor se zadaným názvem souboru již existuje.</span><span class="sxs-lookup"><span data-stu-id="b94e2-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="b94e2-253">Pokud ano, bude i nadále zkoušet nové názvy souborů pro brožuru, dokud nebude nalezen žádný konflikt.</span><span class="sxs-lookup"><span data-stu-id="b94e2-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample7.cs)]

<span data-ttu-id="b94e2-254">Jakmile bude nalezen platný název souboru, je třeba soubor uložit do systému souborů a prvek ObjectDataSource `brochurePath``InsertParameter` musí být aktualizován, aby byl tento název souboru zapsán do databáze.</span><span class="sxs-lookup"><span data-stu-id="b94e2-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="b94e2-255">Jak jsme se v kurzu *nahrávání souborů* viděli zpátky, soubor se dá uložit pomocí `SaveAs(path)` metoda nahrání souboru s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="b94e2-256">Chcete-li aktualizovat parametr ObjectDataSource s `brochurePath`, použijte kolekci `e.Values`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample8.cs)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="b94e2-257">Krok 7: uložení nahraného obrázku do databáze</span><span class="sxs-lookup"><span data-stu-id="b94e2-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="b94e2-258">Abychom uložili nahraný obrázek do nového záznamu `Categories`, musíme nahraného binárního obsahu přiřadit parametru ObjectDataSource s `picture` v události DetailsView s `ItemInserting`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="b94e2-259">Než začneme s tímto přiřazením, musíme nejdřív zkontrolovat, že nahraný obrázek je JPG, a ne jiný typ obrázku.</span><span class="sxs-lookup"><span data-stu-id="b94e2-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="b94e2-260">Jak je uvedeno v kroku 6, pomocí nahraného souboru s obrázkem s můžete zjistit jeho typ.</span><span class="sxs-lookup"><span data-stu-id="b94e2-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="b94e2-261">Zatímco tabulka `Categories` umožňuje `NULL` hodnoty pro sloupec `Picture`, všechny kategorie nyní mají obrázek.</span><span class="sxs-lookup"><span data-stu-id="b94e2-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="b94e2-262">Pojďme uživateli přinutit, aby při přidávání nové kategorie přes tuto stránku zadali obrázek.</span><span class="sxs-lookup"><span data-stu-id="b94e2-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="b94e2-263">Následující kód zkontroluje, zda byl obrázek nahrán a zda má odpovídající rozšíření.</span><span class="sxs-lookup"><span data-stu-id="b94e2-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample9.cs)]

<span data-ttu-id="b94e2-264">Tento kód by měl být umístěn *před* kódem z kroku 6, aby v případě, že dojde k potížím s nahráváním obrázku, obslužná rutina události skončí před uložením souboru brožury do systému souborů.</span><span class="sxs-lookup"><span data-stu-id="b94e2-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="b94e2-265">Za předpokladu, že byl nahrán příslušný soubor, přiřaďte nahraný binární obsah k hodnotě parametru obrázku s následujícím řádkem kódu:</span><span class="sxs-lookup"><span data-stu-id="b94e2-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample10.cs)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="b94e2-266">Kompletní obslužná rutina události`ItemInserting`</span><span class="sxs-lookup"><span data-stu-id="b94e2-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="b94e2-267">V případě úplnost je zde `ItemInserting` obslužná rutina události v celém rozsahu:</span><span class="sxs-lookup"><span data-stu-id="b94e2-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample11.cs)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="b94e2-268">Krok 8: Oprava stránky`DisplayCategoryPicture.aspx`</span><span class="sxs-lookup"><span data-stu-id="b94e2-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="b94e2-269">Počkejte chvilku, než se otestuje rozhraní pro vložení rozhraní a `ItemInserting` obslužnou rutinu, která se vytvořila během posledních několika kroků.</span><span class="sxs-lookup"><span data-stu-id="b94e2-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="b94e2-270">Přejděte na stránku `UploadInDetailsView.aspx` v prohlížeči a pokuste se přidat kategorii, ale vynechejte obrázek nebo zadejte obrázek, který není typu JPG, nebo brožuru, která není ve formátu PDF.</span><span class="sxs-lookup"><span data-stu-id="b94e2-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="b94e2-271">V některých případech se zobrazí chybová zpráva a pracovní postup vložení byl zrušen.</span><span class="sxs-lookup"><span data-stu-id="b94e2-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>

<span data-ttu-id="b94e2-272">[![se zobrazí zpráva s upozorněním, pokud se nahraje neplatný typ souboru.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image15.png)</span></span>

<span data-ttu-id="b94e2-273">**Obrázek 9**: při odeslání neplatného typu souboru se zobrazí zpráva s upozorněním ([kliknutím zobrazíte obrázek v plné velikosti).](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image16.png))</span></span>

<span data-ttu-id="b94e2-274">Jakmile ověříte, že stránka vyžaduje nahrávání obrázku a nepřijímá soubory ve formátu PDF ani jiné než JPG, přidejte novou kategorii s platným obrázkem JPG a nechejte pole brožura prázdné.</span><span class="sxs-lookup"><span data-stu-id="b94e2-274">Once you have verified that the page requires a picture to be uploaded and won't accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="b94e2-275">Po kliknutí na tlačítko Vložit se stránka odešle zpět a nový záznam se přidá do tabulky `Categories` s nahraným binárním obsahem obrázků s uloženými přímo v databázi.</span><span class="sxs-lookup"><span data-stu-id="b94e2-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="b94e2-276">Prvek GridView se aktualizuje a zobrazí řádek pro nově přidanou kategorii, ale na obrázku 10 se zobrazí nový obrázek kategorie není správně vykreslen.</span><span class="sxs-lookup"><span data-stu-id="b94e2-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>

<span data-ttu-id="b94e2-277">[![se nový obrázek kategorie nezobrazí.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image17.png)</span></span>

<span data-ttu-id="b94e2-278">**Obrázek 10**: obrázek nové kategorie není zobrazený ([kliknutím zobrazíte obrázek v plné velikosti).](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image18.png))</span></span>

<span data-ttu-id="b94e2-279">Důvod, proč se nový obrázek nezobrazuje, je, že `DisplayCategoryPicture.aspx` stránka, která vrací zadaný obrázek kategorie s, je nakonfigurována pro zpracování rastrových obrázků, které mají hlavičku OLE.</span><span class="sxs-lookup"><span data-stu-id="b94e2-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="b94e2-280">Tato hlavička bajtu 78 se před odesláním zpátky klientovi vrátí z binárního obsahu `Picture`ového sloupce.</span><span class="sxs-lookup"><span data-stu-id="b94e2-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="b94e2-281">Ale soubor s příponou. JPG, který jsme právě Nahráli pro novou kategorii, nemá tuto hlavičku OLE. Proto jsou z binárních dat image s odebírány platné bajty, které jsou nezbytné.</span><span class="sxs-lookup"><span data-stu-id="b94e2-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="b94e2-282">Vzhledem k tomu, že jsou teď v tabulce `Categories` obě bitmapy s hlavičkou OLE a JPGs, musíme aktualizovat `DisplayCategoryPicture.aspx` tak, aby se vynechá vyřazení hlaviček OLE pro původní osm kategorií, a obejít tuto úpravu pro novější záznamy kategorií.</span><span class="sxs-lookup"><span data-stu-id="b94e2-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="b94e2-283">V našem dalším kurzu probereme, jak aktualizovat existující image záznamu a aktualizujeme všechny staré obrázky kategorií, aby byly JPGs.</span><span class="sxs-lookup"><span data-stu-id="b94e2-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="b94e2-284">Teď ale použijte následující kód v `DisplayCategoryPicture.aspx` k obložení hlaviček OLE jenom pro tyto původní osm kategorií:</span><span class="sxs-lookup"><span data-stu-id="b94e2-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample12.cs)]

<span data-ttu-id="b94e2-285">Tato změna znamená, že obrázek JPG je nyní vykreslen správně v prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="b94e2-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>

<span data-ttu-id="b94e2-286">[![obrázků JPG pro nové kategorie se správně vykreslí.](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image19.png)</span></span>

<span data-ttu-id="b94e2-287">**Obrázek 11**: obrázky ve formátu jpg pro nové kategorie jsou správně vykresleny ([kliknutím zobrazíte obrázek v plné velikosti).](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="b94e2-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-cs/_static/image20.png))</span></span>

## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="b94e2-288">Krok 9: odstranění brožury na straně výjimky</span><span class="sxs-lookup"><span data-stu-id="b94e2-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="b94e2-289">Jedním z výzev k ukládání binárních dat do systému souborů webového serveru s je, že zavádí odpojení mezi datovým modelem a jeho binárními daty.</span><span class="sxs-lookup"><span data-stu-id="b94e2-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="b94e2-290">Proto se při každém odstranění záznamu musí odebrat i odpovídající binární data v systému souborů.</span><span class="sxs-lookup"><span data-stu-id="b94e2-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="b94e2-291">To může přijít do hry i při vkládání.</span><span class="sxs-lookup"><span data-stu-id="b94e2-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="b94e2-292">Vezměte v úvahu následující scénář: uživatel přidá novou kategorii a určí platný obrázek a brožuru.</span><span class="sxs-lookup"><span data-stu-id="b94e2-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="b94e2-293">Po kliknutí na tlačítko Vložit dojde k postbacku a událost ovládacího prvku DetailsView `ItemInserting` se aktivuje a uloží brožuru do systému souborů webového serveru s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="b94e2-294">Dále je vyvolána metoda ObjectDataSource s `Insert()`, která volá metodu `InsertWithPicture` `CategoriesBLL` třídy s, která volá metodu `InsertWithPicture` `CategoriesTableAdapter` s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="b94e2-295">Co se stane, když je databáze offline, nebo pokud v příkazu `INSERT` SQL dojde k chybě?</span><span class="sxs-lookup"><span data-stu-id="b94e2-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="b94e2-296">Jasně se vložení nezdaří, takže do databáze se nepřidá žádný nový řádek kategorie.</span><span class="sxs-lookup"><span data-stu-id="b94e2-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="b94e2-297">Ale pořád máme nahraný soubor brožury v systému souborů webového serveru s!</span><span class="sxs-lookup"><span data-stu-id="b94e2-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="b94e2-298">Tento soubor je nutné odstranit na straně výjimky během vkládání pracovního postupu.</span><span class="sxs-lookup"><span data-stu-id="b94e2-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="b94e2-299">Jak bylo popsáno dříve v kurzu [zpracování knihoven BLL a na úrovni dal v kurzu stránky ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) , pokud je vyvolána výjimka v rámci hloubky architektury, která je seznáma prostřednictvím různých vrstev.</span><span class="sxs-lookup"><span data-stu-id="b94e2-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="b94e2-300">V prezentační vrstvě můžeme určit, zda došlo k výjimce z události `ItemInserted` ovládacího prvku.</span><span class="sxs-lookup"><span data-stu-id="b94e2-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="b94e2-301">Tato obslužná rutina události také poskytuje hodnoty `InsertParameters`ObjectDataSource s.</span><span class="sxs-lookup"><span data-stu-id="b94e2-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="b94e2-302">Proto můžeme vytvořit obslužnou rutinu události pro událost `ItemInserted`, která kontroluje, zda došlo k výjimce, a pokud ano, odstraní soubor určený parametrem ObjectDataSource s `brochurePath`:</span><span class="sxs-lookup"><span data-stu-id="b94e2-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>

[!code-csharp[Main](including-a-file-upload-option-when-adding-a-new-record-cs/samples/sample13.cs)]

## <a name="summary"></a><span data-ttu-id="b94e2-303">Přehled</span><span class="sxs-lookup"><span data-stu-id="b94e2-303">Summary</span></span>

<span data-ttu-id="b94e2-304">K dispozici je řada kroků, které je třeba provést, aby bylo možné poskytovat webové rozhraní pro přidávání záznamů, které zahrnují binární data.</span><span class="sxs-lookup"><span data-stu-id="b94e2-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="b94e2-305">Pokud jsou binární data ukládána přímo do databáze, je pravděpodobné, že budete muset aktualizovat architekturu a přidat konkrétní metody, které budou zpracovávat případy, kdy jsou vložena binární data.</span><span class="sxs-lookup"><span data-stu-id="b94e2-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="b94e2-306">Po aktualizaci architektury je dalším krokem vytvoření rozhraní pro vložení, které lze provést pomocí ovládacího prvku DetailsView, který je přizpůsobený tak, aby zahrnoval ovládací prvek nahrání souboru pro každé binární datové pole.</span><span class="sxs-lookup"><span data-stu-id="b94e2-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="b94e2-307">Nahraná data je pak možné uložit do systému souborů webového serveru s nebo přiřadit k parametru zdroje dat v obslužné rutině ovládacího prvku DetailsView s `ItemInserting`.</span><span class="sxs-lookup"><span data-stu-id="b94e2-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="b94e2-308">Ukládání binárních dat do systému souborů vyžaduje více plánování než ukládání dat přímo do databáze.</span><span class="sxs-lookup"><span data-stu-id="b94e2-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="b94e2-309">Aby bylo možné zabránit jednomu uživateli v zápisu dalších souborů, je třeba zvolit schéma pojmenování.</span><span class="sxs-lookup"><span data-stu-id="b94e2-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="b94e2-310">V případě, že se vložení databáze nepovede, je třeba provést další kroky, aby se nahraný soubor odstranil.</span><span class="sxs-lookup"><span data-stu-id="b94e2-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="b94e2-311">Teď máme možnost přidat do systému nové kategorie s brožurou a obrázkem, ale zatím jsme si vyhledali, jak aktualizovat existující binární data v kategorii nebo jak správně odebrat binární data pro odstraněnou kategorii.</span><span class="sxs-lookup"><span data-stu-id="b94e2-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="b94e2-312">Tato dvě témata prozkoumáme v dalším kurzu.</span><span class="sxs-lookup"><span data-stu-id="b94e2-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="b94e2-313">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="b94e2-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="b94e2-314">O autorovi</span><span class="sxs-lookup"><span data-stu-id="b94e2-314">About the Author</span></span>

<span data-ttu-id="b94e2-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor 7 ASP/ASP. NET Books a zakladatel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="b94e2-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b94e2-316">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="b94e2-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b94e2-317">Nejnovější kniha je [*Sams naučit se ASP.NET 2,0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="b94e2-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="b94e2-318">Dá se získat na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b94e2-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="b94e2-319">nebo prostřednictvím svého blogu, který najdete na adrese [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="b94e2-319">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="b94e2-320">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="b94e2-320">Special Thanks To</span></span>

<span data-ttu-id="b94e2-321">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="b94e2-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="b94e2-322">Kontroloři vedoucích k tomuto kurzu byli Dave Gardner, Teresa Murphy a Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="b94e2-322">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="b94e2-323">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="b94e2-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="b94e2-324">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b94e2-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b94e2-325">[Předchozí](displaying-binary-data-in-the-data-web-controls-cs.md)
> [Další](updating-and-deleting-existing-binary-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="b94e2-325">[Previous](displaying-binary-data-in-the-data-web-controls-cs.md)
[Next](updating-and-deleting-existing-binary-data-cs.md)</span></span>
