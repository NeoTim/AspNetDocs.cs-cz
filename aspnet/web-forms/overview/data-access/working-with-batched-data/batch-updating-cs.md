---
uid: web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
title: Dávková aktualizaceC#() | Microsoft Docs
author: rick-anderson
description: Naučte se aktualizovat více databázových záznamů v rámci jedné operace. Ve vrstvě uživatelského rozhraní sestavíme prvek GridView, ve kterém je každý řádek upravitelný. V datech...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 4e849bcc-c557-4bc3-937e-f7453ee87265
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-updating-cs
msc.type: authoredcontent
ms.openlocfilehash: baaaf37c47cc57d90ea579a5c20949bf8cfc7a3c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78589290"
---
# <a name="batch-updating-c"></a><span data-ttu-id="35bf5-105">Dávkové aktualizace (C#)</span><span class="sxs-lookup"><span data-stu-id="35bf5-105">Batch Updating (C#)</span></span>

<span data-ttu-id="35bf5-106">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="35bf5-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="35bf5-107">[Stažení kódu](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip) nebo [stažení PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="35bf5-107">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_64_CS.zip) or [Download PDF](batch-updating-cs/_static/datatutorial64cs1.pdf)</span></span>

> <span data-ttu-id="35bf5-108">Naučte se aktualizovat více databázových záznamů v rámci jedné operace.</span><span class="sxs-lookup"><span data-stu-id="35bf5-108">Learn how to update multiple database records in a single operation.</span></span> <span data-ttu-id="35bf5-109">Ve vrstvě uživatelského rozhraní sestavíme prvek GridView, ve kterém je každý řádek upravitelný.</span><span class="sxs-lookup"><span data-stu-id="35bf5-109">In the User Interface Layer we build a GridView where each row is editable.</span></span> <span data-ttu-id="35bf5-110">Ve vrstvě přístupu k datům zabalíme operace více aktualizací v rámci transakce, aby se zajistilo, že všechny aktualizace budou úspěšné nebo že se vrátí zpět všechny aktualizace.</span><span class="sxs-lookup"><span data-stu-id="35bf5-110">In the Data Access Layer we wrap the multiple Update operations within a transaction to ensure that all updates succeed or all updates are rolled back.</span></span>

## <a name="introduction"></a><span data-ttu-id="35bf5-111">Úvod</span><span class="sxs-lookup"><span data-stu-id="35bf5-111">Introduction</span></span>

<span data-ttu-id="35bf5-112">V [předchozím kurzu](wrapping-database-modifications-within-a-transaction-cs.md) jsme viděli, jak vrstvu pro přístup k datům rozšíříte tak, aby přidala podporu pro databázové transakce.</span><span class="sxs-lookup"><span data-stu-id="35bf5-112">In the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md) we saw how to extend the Data Access Layer to add support for database transactions.</span></span> <span data-ttu-id="35bf5-113">Transakce databáze zaručují, že řada příkazů pro úpravu dat bude považována za jednu atomickou operaci, která zajistí, že všechny úpravy selžou nebo budou úspěšné.</span><span class="sxs-lookup"><span data-stu-id="35bf5-113">Database transactions guarantee that a series of data modification statements will be treated as one atomic operation, which ensures that all modifications will fail or all will succeed.</span></span> <span data-ttu-id="35bf5-114">Díky tomu, že tato funkce nižší úrovně přecházejí ze své míry, jsme připraveni na vytvoření rozhraní pro úpravu dat Batch.</span><span class="sxs-lookup"><span data-stu-id="35bf5-114">With this low-level DAL functionality out of the way, we re ready to turn our attention to creating batch data modification interfaces.</span></span>

<span data-ttu-id="35bf5-115">V tomto kurzu sestavíme GridView, kde je každý řádek upravitelný (viz obrázek 1).</span><span class="sxs-lookup"><span data-stu-id="35bf5-115">In this tutorial we'll build a GridView where each row is editable (see Figure 1).</span></span> <span data-ttu-id="35bf5-116">Vzhledem k tomu, že se jednotlivé řádky vykreslují ve svém rozhraní pro úpravy, neexistuje žádný sloupec, který by měl mít tlačítka pro úpravy, aktualizaci a zrušení.</span><span class="sxs-lookup"><span data-stu-id="35bf5-116">Since each row is rendered in its editing interface, there s no need for a column of Edit, Update, and Cancel buttons.</span></span> <span data-ttu-id="35bf5-117">Místo toho existují dvě tlačítka pro aktualizaci produktů na stránce, na které se po kliknutí zobrazí výčet řádků GridView a aktualizace databáze.</span><span class="sxs-lookup"><span data-stu-id="35bf5-117">Instead, there are two Update Products buttons on the page that, when clicked, enumerate the GridView rows and update the database.</span></span>

<span data-ttu-id="35bf5-118">[![každý řádek v prvku GridView je upravitelný](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-118">[![Each Row in the GridView is Editable](batch-updating-cs/_static/image1.gif)](batch-updating-cs/_static/image1.png)</span></span>

<span data-ttu-id="35bf5-119">**Obrázek 1**: každý řádek v prvku GridView je upravitelný ([kliknutím zobrazíte obrázek v plné velikosti).](batch-updating-cs/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-119">**Figure 1**: Each Row in the GridView is Editable ([Click to view full-size image](batch-updating-cs/_static/image2.png))</span></span>

<span data-ttu-id="35bf5-120">Pojďme začít!</span><span class="sxs-lookup"><span data-stu-id="35bf5-120">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="35bf5-121">V kurzu [provádění dávkových aktualizací](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) jsme vytvořili rozhraní Batch pro úpravu pomocí ovládacího prvku DataList.</span><span class="sxs-lookup"><span data-stu-id="35bf5-121">In the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we created a batch editing interface using the DataList control.</span></span> <span data-ttu-id="35bf5-122">Tento kurz se liší od předchozí verze v, který používá prvek GridView a dávková aktualizace se provádí v rámci transakce.</span><span class="sxs-lookup"><span data-stu-id="35bf5-122">This tutorial differs from the previous one in that is uses a GridView and the batch update is performed within the scope of a transaction.</span></span> <span data-ttu-id="35bf5-123">Po dokončení tohoto kurzu se můžete vrátit k předchozímu kurzu a aktualizovat ho, aby používaly funkce související s transakční transakce přidané v předchozím kurzu.</span><span class="sxs-lookup"><span data-stu-id="35bf5-123">After completing this tutorial I encourage you to return to the earlier tutorial and update it to use the database transaction-related functionality added in the preceding tutorial.</span></span>

## <a name="examining-the-steps-for-making-all-gridview-rows-editable"></a><span data-ttu-id="35bf5-124">Prozkoumání kroků pro úpravy všech řádků GridView</span><span class="sxs-lookup"><span data-stu-id="35bf5-124">Examining the Steps for Making All GridView Rows Editable</span></span>

<span data-ttu-id="35bf5-125">Jak je popsáno v kurzu [vložení, aktualizace a odstranění dat](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) , GridView nabízí integrovanou podporu pro úpravu svých podkladových dat na jednotlivých řádcích.</span><span class="sxs-lookup"><span data-stu-id="35bf5-125">As discussed in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial, the GridView offers built-in support for editing its underlying data on a per-row basis.</span></span> <span data-ttu-id="35bf5-126">V interním prvku GridView poznámky k řádku, který je upravitelný pomocí jeho [vlastnosti`EditIndex`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="35bf5-126">Internally, the GridView notes what row is editable through its [`EditIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.editindex(VS.80).aspx).</span></span> <span data-ttu-id="35bf5-127">Vzhledem k tomu, že prvek GridView je svázán se zdrojem dat, kontroluje každý řádek, aby bylo vidět, zda index řádku odpovídá hodnotě `EditIndex`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-127">As the GridView is being bound to its data source, it checks each row to see if the index of the row equals the value of `EditIndex`.</span></span> <span data-ttu-id="35bf5-128">V takovém případě se pole s řádky vykreslují pomocí rozhraní pro úpravy.</span><span class="sxs-lookup"><span data-stu-id="35bf5-128">If so, that row s fields are rendered using their editing interfaces.</span></span> <span data-ttu-id="35bf5-129">Pro BoundFields rozhraní pro úpravy je textové pole, jehož vlastnost `Text` je přiřazena hodnota datového pole zadaného vlastností vlastnost BoundField s `DataField`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-129">For BoundFields, the editing interface is a TextBox whose `Text` property is assigned the value of the data field specified by the BoundField s `DataField` property.</span></span> <span data-ttu-id="35bf5-130">U TemplateField jsou `EditItemTemplate` použity místo `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-130">For TemplateFields, the `EditItemTemplate` is used in place of the `ItemTemplate`.</span></span>

<span data-ttu-id="35bf5-131">Pokud uživatel klikne na tlačítko pro úpravy řádku, odvoláte, aby se pracovní postup úpravy spustil.</span><span class="sxs-lookup"><span data-stu-id="35bf5-131">Recall that the editing workflow starts when a user clicks a row s Edit button.</span></span> <span data-ttu-id="35bf5-132">Tím dojde k postbacku, nastaví vlastnost GridView `EditIndex` na indexovaná řádková řádku a znovu sváže data s mřížkou.</span><span class="sxs-lookup"><span data-stu-id="35bf5-132">This causes a postback, sets the GridView s `EditIndex` property to the clicked row s index, and rebinds the data to the grid.</span></span> <span data-ttu-id="35bf5-133">Při kliknutí na tlačítko Storno řádku se při postbacku `EditIndex` nastaví na hodnotu `-1` před tím, než se data znovu naváže k mřížce.</span><span class="sxs-lookup"><span data-stu-id="35bf5-133">When a row s Cancel button is clicked, on postback the `EditIndex` is set to a value of `-1` before rebinding the data to the grid.</span></span> <span data-ttu-id="35bf5-134">Vzhledem k tomu, že řádky GridView s začínají indexování nulou, nastavení `EditIndex` pro `-1` má vliv na zobrazení prvku GridView v režimu jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="35bf5-134">Since the GridView s rows start indexing at zero, setting `EditIndex` to `-1` has the effect of displaying the GridView in read-only mode.</span></span>

<span data-ttu-id="35bf5-135">Vlastnost `EditIndex` pracuje dobře u úprav pro jednotlivé řádky, ale není navržena pro dávkové úpravy.</span><span class="sxs-lookup"><span data-stu-id="35bf5-135">The `EditIndex` property works well for per-row editing, but is not designed for batch editing.</span></span> <span data-ttu-id="35bf5-136">Aby bylo možné celý prvek GridView upravovat, musíme mít každý řádek vykreslený pomocí rozhraní pro úpravy.</span><span class="sxs-lookup"><span data-stu-id="35bf5-136">To make the entire GridView editable, we need to have each row render using its editing interface.</span></span> <span data-ttu-id="35bf5-137">Nejjednodušší způsob, jak to provést, je vytvořit, kde je každé upravitelné pole implementováno jako TemplateField s jeho rozhraním pro úpravy definované v `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-137">The easiest way to accomplish this is to create where each editable field is implemented as a TemplateField with its editing interface defined in the `ItemTemplate`.</span></span>

<span data-ttu-id="35bf5-138">V několika dalších krocích vytvoříme kompletně upravitelnou GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-138">Over the next several steps we'll create a completely editable GridView.</span></span> <span data-ttu-id="35bf5-139">V kroku 1 začneme vytvořením prvku GridView a jeho prvku ObjectDataSource a převedeme své BoundFields a třídě CheckBoxField podporována na TemplateFields.</span><span class="sxs-lookup"><span data-stu-id="35bf5-139">In Step 1 we'll start by creating the GridView and its ObjectDataSource and convert its BoundFields and CheckBoxField into TemplateFields.</span></span> <span data-ttu-id="35bf5-140">V krocích 2 a 3 přesunete rozhraní pro úpravy z vlastností TemplateField `EditItemTemplate` s na jejich `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="35bf5-140">In Steps 2 and 3 we'll move the editing interfaces from the TemplateFields `EditItemTemplate` s to their `ItemTemplate` s.</span></span>

## <a name="step-1-displaying-product-information"></a><span data-ttu-id="35bf5-141">Krok 1: zobrazení informací o produktu</span><span class="sxs-lookup"><span data-stu-id="35bf5-141">Step 1: Displaying Product Information</span></span>

<span data-ttu-id="35bf5-142">Předtím, než se obáváme o vytvoření prvku GridView, kde jsou řádky editovatelné, nechte začít pouhým zobrazením informací o produktu.</span><span class="sxs-lookup"><span data-stu-id="35bf5-142">Before we worry about creating a GridView where are rows are editable, let s start by simply displaying the product information.</span></span> <span data-ttu-id="35bf5-143">Otevřete stránku `BatchUpdate.aspx` ve složce `BatchData` a přetáhněte prvek GridView z panelu nástrojů do návrháře.</span><span class="sxs-lookup"><span data-stu-id="35bf5-143">Open the `BatchUpdate.aspx` page in the `BatchData` folder and drag a GridView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="35bf5-144">Nastavte `ID` prvku GridView s `ProductsGrid` a ze své inteligentní značky vyberte možnost svázání s novým prvkem ObjectDataSource s názvem `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-144">Set the GridView s `ID` to `ProductsGrid` and, from its smart tag, choose to bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="35bf5-145">Nakonfigurujte prvek ObjectDataSource tak, aby načetl jeho data z metody `ProductsBLL` třídy s `GetProducts`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-145">Configure the ObjectDataSource to retrieve its data from the `ProductsBLL` class s `GetProducts` method.</span></span>

<span data-ttu-id="35bf5-146">[![nakonfigurovat prvek ObjectDataSource tak, aby používal třídu ProductsBLL](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-146">[![Configure the ObjectDataSource to Use the ProductsBLL Class](batch-updating-cs/_static/image2.gif)](batch-updating-cs/_static/image3.png)</span></span>

<span data-ttu-id="35bf5-147">**Obrázek 2**: Konfigurace prvku ObjectDataSource, aby používal třídu `ProductsBLL` ([kliknutím zobrazíte obrázek v plné velikosti](batch-updating-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="35bf5-147">**Figure 2**: Configure the ObjectDataSource to Use the `ProductsBLL` Class ([Click to view full-size image](batch-updating-cs/_static/image4.png))</span></span>

<span data-ttu-id="35bf5-148">[![načíst data produktu pomocí metody GetProducts](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-148">[![Retrieve the Product Data Using the GetProducts Method](batch-updating-cs/_static/image3.gif)](batch-updating-cs/_static/image5.png)</span></span>

<span data-ttu-id="35bf5-149">**Obrázek 3**: načtení dat produktu pomocí metody `GetProducts` ([kliknutím zobrazíte obrázek v plné velikosti](batch-updating-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="35bf5-149">**Figure 3**: Retrieve the Product Data Using the `GetProducts` Method ([Click to view full-size image](batch-updating-cs/_static/image6.png))</span></span>

<span data-ttu-id="35bf5-150">Podobně jako v prvku GridView jsou funkce úprav ObjectDataSource s navrženy pro práci na jednotlivých řádcích.</span><span class="sxs-lookup"><span data-stu-id="35bf5-150">Like the GridView, the ObjectDataSource s modification features are designed to work on a per-row basis.</span></span> <span data-ttu-id="35bf5-151">Aby bylo možné aktualizovat sadu záznamů, je nutné zapsat bitovou kopii kódu do třídy ASP.NET stránky s kódem na pozadí, která data zabalí a předává je do knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="35bf5-151">In order to update a set of records, we'll need to write a bit of code in the ASP.NET page s code-behind class that batches the data and passes it to the BLL.</span></span> <span data-ttu-id="35bf5-152">Proto nastavte rozevírací seznamy v rámci karet ObjectDataSource s aktualizace, vložit a odstranit na (žádné).</span><span class="sxs-lookup"><span data-stu-id="35bf5-152">Therefore, set the drop-down lists in the ObjectDataSource s UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="35bf5-153">Kliknutím na Dokončit dokončete průvodce.</span><span class="sxs-lookup"><span data-stu-id="35bf5-153">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="35bf5-154">[![nastavení rozevíracích seznamů na kartách aktualizace, vložení a odstranění na (žádné)](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-154">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-updating-cs/_static/image4.gif)](batch-updating-cs/_static/image7.png)</span></span>

<span data-ttu-id="35bf5-155">**Obrázek 4**: nastavení rozevíracích seznamů na kartách aktualizace, vložení a odstranění na (žádné) ([kliknutím zobrazíte obrázek v plné velikosti).](batch-updating-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-155">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image8.png))</span></span>

<span data-ttu-id="35bf5-156">Po dokončení Průvodce konfigurací zdroje dat by deklarativní označení ObjectDataSource s mělo vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="35bf5-156">After completing the Configure Data Source wizard, the ObjectDataSource s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample1.aspx)]

<span data-ttu-id="35bf5-157">Dokončení Průvodce konfigurací zdroje dat také způsobí, že Visual Studio vytvoří BoundFields a třídě CheckBoxField podporována pro pole dat produktu v prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-157">Completing the Configure Data Source wizard also causes Visual Studio to create BoundFields and a CheckBoxField for the product data fields in the GridView.</span></span> <span data-ttu-id="35bf5-158">V tomto kurzu umožníte uživateli zobrazit a upravit jenom název produktu, kategorii, cenu a ukončený stav.</span><span class="sxs-lookup"><span data-stu-id="35bf5-158">For this tutorial, let s only allow the user to view and edit the product s name, category, price, and discontinued status.</span></span> <span data-ttu-id="35bf5-159">Odeberte všechna pole s výjimkou `ProductName`, `CategoryName`, `UnitPrice`a `Discontinued` a přejmenujte `HeaderText` vlastnosti prvních tří polí na produkt, kategorii a cenu.</span><span class="sxs-lookup"><span data-stu-id="35bf5-159">Remove all but the `ProductName`, `CategoryName`, `UnitPrice`, and `Discontinued` fields and rename the `HeaderText` properties of the first three fields to Product, Category, and Price, respectively.</span></span> <span data-ttu-id="35bf5-160">Nakonec zaškrtněte políčka Povolit stránkování a Povolit řazení v inteligentní značce GridView s.</span><span class="sxs-lookup"><span data-stu-id="35bf5-160">Lastly, check the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="35bf5-161">V tomto okamžiku má prvek GridView tři BoundFields (`ProductName`, `CategoryName`a `UnitPrice`) a třídě CheckBoxField podporována (`Discontinued`).</span><span class="sxs-lookup"><span data-stu-id="35bf5-161">At this point the GridView has three BoundFields (`ProductName`, `CategoryName`, and `UnitPrice`) and a CheckBoxField (`Discontinued`).</span></span> <span data-ttu-id="35bf5-162">Musíme převést tato čtyři pole na pole TemplateField a pak přesunout rozhraní pro úpravy z `EditItemTemplate` TemplateField s na jeho `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-162">We need to convert these four fields into TemplateFields and then move the editing interface from the TemplateField s `EditItemTemplate` to its `ItemTemplate`.</span></span>

> [!NOTE]
> <span data-ttu-id="35bf5-163">Prozkoumali jsme vytváření a přizpůsobení vlastností TemplateField v kurzu [přizpůsobení rozhraní pro úpravu dat](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="35bf5-163">We explored creating and customizing TemplateFields in the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span> <span data-ttu-id="35bf5-164">Provedeme vás kroky převodu BoundFields a třídě CheckBoxField podporována na TemplateFields a definování jejich rozhraní pro úpravy ve svých `ItemTemplate`ech, ale pokud se dostanete k zablokování nebo potřebujete aktualizační program, nemusíte váhají, abyste se mohli vrátit k předchozímu kurzu.</span><span class="sxs-lookup"><span data-stu-id="35bf5-164">We'll walk through the steps of converting the BoundFields and CheckBoxField into TemplateFields and defining their editing interfaces in their `ItemTemplate` s, but if you get stuck or need a refresher, don t hesitate to refer back to this earlier tutorial.</span></span>

<span data-ttu-id="35bf5-165">Z inteligentní značky GridView s klikněte na odkaz Upravit sloupce a otevřete dialogové okno pole.</span><span class="sxs-lookup"><span data-stu-id="35bf5-165">From the GridView s smart tag, click the Edit Columns link to open the Fields dialog box.</span></span> <span data-ttu-id="35bf5-166">Potom vyberte jednotlivá pole a klikněte na tlačítko převést toto pole na odkaz TemplateField.</span><span class="sxs-lookup"><span data-stu-id="35bf5-166">Next, select each field and click the Convert this field into a TemplateField link.</span></span>

![Převést existující BoundFields a třídě CheckBoxField podporována na TemplateField](batch-updating-cs/_static/image5.gif)

<span data-ttu-id="35bf5-168">**Obrázek 5**: převod existujících BoundFields a třídě CheckBoxField podporována na TemplateField</span><span class="sxs-lookup"><span data-stu-id="35bf5-168">**Figure 5**: Convert the Existing BoundFields and CheckBoxField Into TemplateField</span></span>

<span data-ttu-id="35bf5-169">Teď, když je každé pole TemplateField, jsme připraveni přesunout rozhraní pro úpravy z `EditItemTemplate` s na `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="35bf5-169">Now that each field is a TemplateField, we re ready to move the editing interface from the `EditItemTemplate` s to the `ItemTemplate` s.</span></span>

## <a name="step-2-creating-theproductnameunitprice-anddiscontinuedediting-interfaces"></a><span data-ttu-id="35bf5-170">Krok 2: vytvoření rozhraní pro úpravy`ProductName`,`UnitPrice`a`Discontinued`</span><span class="sxs-lookup"><span data-stu-id="35bf5-170">Step 2: Creating the`ProductName`,`UnitPrice`, and`Discontinued`Editing Interfaces</span></span>

<span data-ttu-id="35bf5-171">Vytváření `ProductName`, `UnitPrice`a `Discontinued`ch editačních rozhraní jsou témata tohoto kroku a jsou poměrně jednoduchá, protože každé rozhraní je již definováno v `EditItemTemplate`TemplateField.</span><span class="sxs-lookup"><span data-stu-id="35bf5-171">Creating the `ProductName`, `UnitPrice`, and `Discontinued` editing interfaces are the topic of this step and are pretty straightforward, as each interface is already defined in the TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="35bf5-172">Vytvoření rozhraní pro úpravy `CategoryName` je trochu důležitější, protože musíme vytvořit DropDownList příslušných kategorií.</span><span class="sxs-lookup"><span data-stu-id="35bf5-172">Creating the `CategoryName` editing interface is a bit more involved since we need to create a DropDownList of the applicable categories.</span></span> <span data-ttu-id="35bf5-173">Toto `CategoryName` pro úpravu rozhraní se používá v kroku 3.</span><span class="sxs-lookup"><span data-stu-id="35bf5-173">This `CategoryName` editing interface is tackled in Step 3.</span></span>

<span data-ttu-id="35bf5-174">Pojďme začít s `ProductName` TemplateField.</span><span class="sxs-lookup"><span data-stu-id="35bf5-174">Let s start with the `ProductName` TemplateField.</span></span> <span data-ttu-id="35bf5-175">Klikněte na odkaz Upravit šablony z inteligentní značky GridView s a přejděte k podrobnostem `ProductName` TemplateField s `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-175">Click on the Edit Templates link from the GridView s smart tag and drill down to the `ProductName` TemplateField s `EditItemTemplate`.</span></span> <span data-ttu-id="35bf5-176">Vyberte textové pole, zkopírujte ho do schránky a vložte ho do `ProductName` TemplateField `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-176">Select the TextBox, copy it to the clipboard, and then paste it to the `ProductName` TemplateField s `ItemTemplate`.</span></span> <span data-ttu-id="35bf5-177">Změňte vlastnost TextBox s `ID` na `ProductName`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-177">Change the TextBox s `ID` property to `ProductName`.</span></span>

<span data-ttu-id="35bf5-178">Dále přidejte RequiredFieldValidator do `ItemTemplate`, abyste zajistili, že uživatel zadá hodnotu pro každý název produktu.</span><span class="sxs-lookup"><span data-stu-id="35bf5-178">Next, add a RequiredFieldValidator to the `ItemTemplate` to ensure that the user provides a value for each product s name.</span></span> <span data-ttu-id="35bf5-179">Nastavte vlastnost `ControlToValidate` na NázevVýrobku. vlastnost `ErrorMessage` na ni musíte zadat název produktu.</span><span class="sxs-lookup"><span data-stu-id="35bf5-179">Set the `ControlToValidate` property to ProductName, the `ErrorMessage` property to You must provide the product's name.</span></span> <span data-ttu-id="35bf5-180">a vlastnost `Text` pro \*.</span><span class="sxs-lookup"><span data-stu-id="35bf5-180">and the `Text` property to \*.</span></span> <span data-ttu-id="35bf5-181">Po provedení těchto přidání do `ItemTemplate`by vaše obrazovka měla vypadat podobně jako na obrázku 6.</span><span class="sxs-lookup"><span data-stu-id="35bf5-181">After making these additions to the `ItemTemplate`, your screen should look similar to Figure 6.</span></span>

<span data-ttu-id="35bf5-182">[![NázevVýrobku TemplateField nyní obsahuje textové pole a RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-182">[![The ProductName TemplateField Now Includes a TextBox and a RequiredFieldValidator](batch-updating-cs/_static/image6.gif)](batch-updating-cs/_static/image9.png)</span></span>

<span data-ttu-id="35bf5-183">**Obrázek 6**: `ProductName` TemplateField teď obsahuje textové pole a RequiredFieldValidator ([kliknutím zobrazíte obrázek v plné velikosti).](batch-updating-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-183">**Figure 6**: The `ProductName` TemplateField Now Includes a TextBox and a RequiredFieldValidator ([Click to view full-size image](batch-updating-cs/_static/image10.png))</span></span>

<span data-ttu-id="35bf5-184">Pro rozhraní `UnitPrice` pro úpravy Začněte tím, že zkopírujete textové pole z `EditItemTemplate` do `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-184">For the `UnitPrice` editing interface, start by copying the TextBox from the `EditItemTemplate` to the `ItemTemplate`.</span></span> <span data-ttu-id="35bf5-185">Dále umístěte do textového pole $ před a nastavte jeho vlastnost `ID` na hodnotu UnitPrice a vlastnost `Columns` na hodnotu 8.</span><span class="sxs-lookup"><span data-stu-id="35bf5-185">Next, place a $ in front of the TextBox and set its `ID` property to UnitPrice and its `Columns` property to 8 .</span></span>

<span data-ttu-id="35bf5-186">Přidejte také CompareValidator do `ItemTemplate` `UnitPrice` s, abyste zajistili, že hodnota zadaná uživatelem je platná hodnota měny větší nebo rovna $0,00.</span><span class="sxs-lookup"><span data-stu-id="35bf5-186">Also add a CompareValidator to the `UnitPrice` s `ItemTemplate` to ensure that the value entered by the user is a valid currency value greater than or equal to $0.00.</span></span> <span data-ttu-id="35bf5-187">Nastavte vlastnost validátoru `ControlToValidate` na hodnotu UnitPrice. vlastnost `ErrorMessage` na hodnotu, kterou musíte zadat platnou hodnotu měny.</span><span class="sxs-lookup"><span data-stu-id="35bf5-187">Set the validator s `ControlToValidate` property to UnitPrice, its `ErrorMessage` property to You must enter a valid currency value.</span></span> <span data-ttu-id="35bf5-188">Vynechejte prosím všechny symboly měn., vlastnost `Text` \*, jeho vlastnost `Type` na `Currency`, jeho vlastnost `Operator` `GreaterThanEqual`a jeho vlastnost `ValueToCompare` na hodnotu 0.</span><span class="sxs-lookup"><span data-stu-id="35bf5-188">Please omit any currency symbols., its `Text` property to \*, its `Type` property to `Currency`, its `Operator` property to `GreaterThanEqual`, and its `ValueToCompare` property to 0 .</span></span>

<span data-ttu-id="35bf5-189">[![přidat CompareValidator, aby se zajistilo, že zadaná cena je nezáporná hodnota měny.](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-189">[![Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value](batch-updating-cs/_static/image7.gif)](batch-updating-cs/_static/image11.png)</span></span>

<span data-ttu-id="35bf5-190">**Obrázek 7**: přidejte CompareValidator, abyste zajistili, že zadaná cena je nezáporná hodnota měny ([kliknutím zobrazíte obrázek v plné velikosti).](batch-updating-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-190">**Figure 7**: Add a CompareValidator to Ensure the Price Entered is a Non-Negative Currency Value ([Click to view full-size image](batch-updating-cs/_static/image12.png))</span></span>

<span data-ttu-id="35bf5-191">Pro `Discontinued` TemplateField můžete použít zaškrtávací políčko již definované v `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-191">For the `Discontinued` TemplateField you can use the CheckBox already defined in the `ItemTemplate`.</span></span> <span data-ttu-id="35bf5-192">Jednoduše nastavte jeho `ID` na ukončeno a jeho vlastnost `Enabled` na `true`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-192">Simply set its `ID` to Discontinued and its `Enabled` property to `true`.</span></span>

## <a name="step-3-creating-thecategorynameediting-interface"></a><span data-ttu-id="35bf5-193">Krok 3: vytvoření rozhraní pro úpravy`CategoryName`</span><span class="sxs-lookup"><span data-stu-id="35bf5-193">Step 3: Creating the`CategoryName`Editing Interface</span></span>

<span data-ttu-id="35bf5-194">Rozhraní pro úpravy v `CategoryName` TemplateField s `EditItemTemplate` obsahuje textové pole, které zobrazuje hodnotu `CategoryName` dat.</span><span class="sxs-lookup"><span data-stu-id="35bf5-194">The editing interface in the `CategoryName` TemplateField s `EditItemTemplate` contains a TextBox that displays the value of the `CategoryName` data field.</span></span> <span data-ttu-id="35bf5-195">Musíme to nahradit ovládacím prvkem DropDownList, který obsahuje seznam možných kategorií.</span><span class="sxs-lookup"><span data-stu-id="35bf5-195">We need to replace this with a DropDownList that lists the possible categories.</span></span>

> [!NOTE]
> <span data-ttu-id="35bf5-196">V kurzu [přizpůsobení rozhraní pro úpravu dat](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) je podrobnější a kompletní diskuzi o přizpůsobení šablony, která obsahuje DropDownList, a to na rozdíl od textového pole.</span><span class="sxs-lookup"><span data-stu-id="35bf5-196">The [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial contains a more thorough and complete discussion on customizing a template to include a DropDownList as opposed to a TextBox.</span></span> <span data-ttu-id="35bf5-197">I když jsou tyto kroky dokončené, zobrazí se tersely.</span><span class="sxs-lookup"><span data-stu-id="35bf5-197">While the steps here are complete, they are presented tersely.</span></span> <span data-ttu-id="35bf5-198">Podrobnější pohled na vytváření a konfiguraci ovládacích prvků kategorie DropDownList najdete v kurzu [přizpůsobení rozhraní pro úpravu dat](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="35bf5-198">For a more in-depth look at creating and configuring the categories DropDownList, refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial.</span></span>

<span data-ttu-id="35bf5-199">Přetáhněte objekt DropDownList z panelu nástrojů na `CategoryName` TemplateField s `ItemTemplate`a nastavte jeho `ID` na `Categories`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-199">Drag a DropDownList from the Toolbox onto the `CategoryName` TemplateField s `ItemTemplate`, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="35bf5-200">V tomto okamžiku by byl obvykle definován zdroj dat DropDownList s pomocí inteligentní značky a vytvoření nového prvku ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="35bf5-200">At this point we would usually define the DropDownLists s data source through its smart tag, creating a new ObjectDataSource.</span></span> <span data-ttu-id="35bf5-201">To však přidá prvek ObjectDataSource v rámci `ItemTemplate`, což způsobí, že bude vytvořena instance ObjectDataSource pro každý řádek prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-201">However, this will add the ObjectDataSource within the `ItemTemplate`, which will result in an ObjectDataSource instance created for each GridView row.</span></span> <span data-ttu-id="35bf5-202">Místo toho je možné vytvořit prvek ObjectDataSource mimo prvky GridView s prvky TemplateField.</span><span class="sxs-lookup"><span data-stu-id="35bf5-202">Instead, let s create the ObjectDataSource outside of the GridView s TemplateFields.</span></span> <span data-ttu-id="35bf5-203">Ukončete úpravu šablony a přetáhněte prvek ObjectDataSource z panelu nástrojů do návrháře pod `ProductsDataSource` ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="35bf5-203">End the template editing and drag an ObjectDataSource from the Toolbox onto the Designer beneath the `ProductsDataSource` ObjectDataSource.</span></span> <span data-ttu-id="35bf5-204">Pojmenujte novou `CategoriesDataSource` ObjectDataSource a nakonfigurujte ji tak, aby používala metodu `GetCategories` `CategoriesBLL` třídy s.</span><span class="sxs-lookup"><span data-stu-id="35bf5-204">Name the new ObjectDataSource `CategoriesDataSource` and configure it to use the `CategoriesBLL` class s `GetCategories` method.</span></span>

<span data-ttu-id="35bf5-205">[![nakonfigurovat prvek ObjectDataSource tak, aby používal třídu CategoriesBLL](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-205">[![Configure the ObjectDataSource to Use the CategoriesBLL Class](batch-updating-cs/_static/image8.gif)](batch-updating-cs/_static/image13.png)</span></span>

<span data-ttu-id="35bf5-206">**Obrázek 8**: Konfigurace prvku ObjectDataSource, aby používal třídu `CategoriesBLL` ([kliknutím zobrazíte obrázek v plné velikosti](batch-updating-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="35bf5-206">**Figure 8**: Configure the ObjectDataSource to Use the `CategoriesBLL` Class ([Click to view full-size image](batch-updating-cs/_static/image14.png))</span></span>

<span data-ttu-id="35bf5-207">[![načíst data kategorie pomocí metody GetCategories](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-207">[![Retrieve the Category Data Using the GetCategories Method](batch-updating-cs/_static/image9.gif)](batch-updating-cs/_static/image15.png)</span></span>

<span data-ttu-id="35bf5-208">**Obrázek 9**: načtení dat kategorie pomocí metody `GetCategories` ([kliknutím zobrazíte obrázek v plné velikosti](batch-updating-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="35bf5-208">**Figure 9**: Retrieve the Category Data Using the `GetCategories` Method ([Click to view full-size image](batch-updating-cs/_static/image16.png))</span></span>

<span data-ttu-id="35bf5-209">Vzhledem k tomu, že je tento prvek ObjectDataSource použit pouze k načtení dat, nastavte rozevírací seznamy na kartách aktualizovat a odstranit na hodnotu (žádné).</span><span class="sxs-lookup"><span data-stu-id="35bf5-209">Since this ObjectDataSource is used merely to retrieve data, set the drop-down lists in the UPDATE and DELETE tabs to (None).</span></span> <span data-ttu-id="35bf5-210">Kliknutím na Dokončit dokončete průvodce.</span><span class="sxs-lookup"><span data-stu-id="35bf5-210">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="35bf5-211">[![nastavení rozevíracích seznamů na kartách aktualizovat a odstranit na (žádné)](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-211">[![Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None)](batch-updating-cs/_static/image10.gif)](batch-updating-cs/_static/image17.png)</span></span>

<span data-ttu-id="35bf5-212">**Obrázek 10**: nastavení rozevíracích seznamů na kartách aktualizovat a odstranit na (žádné) ([kliknutím zobrazíte obrázek v plné velikosti).](batch-updating-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-212">**Figure 10**: Set the Drop-Down Lists in the UPDATE and DELETE Tabs to (None) ([Click to view full-size image](batch-updating-cs/_static/image18.png))</span></span>

<span data-ttu-id="35bf5-213">Po dokončení průvodce by deklarativní označení `CategoriesDataSource` s mělo vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="35bf5-213">After completing the wizard, the `CategoriesDataSource` s declarative markup should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample2.aspx)]

<span data-ttu-id="35bf5-214">Po vytvoření a konfiguraci `CategoriesDataSource` se vraťte do `CategoryName` TemplateField `ItemTemplate` a v inteligentní značce DropDownList klikněte na odkaz zvolit zdroj dat.</span><span class="sxs-lookup"><span data-stu-id="35bf5-214">With the `CategoriesDataSource` created and configured, return to the `CategoryName` TemplateField s `ItemTemplate` and, from the DropDownList s smart tag, click on the Choose Data Source link.</span></span> <span data-ttu-id="35bf5-215">V Průvodci konfigurací zdroje dat vyberte v prvním rozevíracím seznamu možnost `CategoriesDataSource` a zvolte, že chcete `CategoryName` použít pro zobrazení a `CategoryID` jako hodnotu.</span><span class="sxs-lookup"><span data-stu-id="35bf5-215">In the Data Source Configuration wizard, select the `CategoriesDataSource` option from the first drop-down list and choose to have `CategoryName` used for the display and `CategoryID` as the value.</span></span>

<span data-ttu-id="35bf5-216">[![vazby ovládacího prvkem DropDownList na CategoriesDataSource](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-216">[![Bind the DropDownList to the CategoriesDataSource](batch-updating-cs/_static/image11.gif)](batch-updating-cs/_static/image19.png)</span></span>

<span data-ttu-id="35bf5-217">**Obrázek 11**: Svázání ovládacího prvkem DropDownList s `CategoriesDataSource`em ([kliknutím zobrazíte obrázek v plné velikosti](batch-updating-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="35bf5-217">**Figure 11**: Bind the DropDownList to the `CategoriesDataSource` ([Click to view full-size image](batch-updating-cs/_static/image20.png))</span></span>

<span data-ttu-id="35bf5-218">V tomto okamžiku `Categories` DropDownList zobrazí seznam všech kategorií, ale zatím nevybere odpovídající kategorii pro produkt vázaný na řádek GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-218">At this point the `Categories` DropDownList lists all of the categories, but it does not yet automatically select the appropriate category for the product bound to the GridView row.</span></span> <span data-ttu-id="35bf5-219">Abychom to dosáhli, je potřeba nastavit `Categories` DropDownList s `SelectedValue` na hodnotu `CategoryID` produktu s produktem.</span><span class="sxs-lookup"><span data-stu-id="35bf5-219">To accomplish this we need to set the `Categories` DropDownList s `SelectedValue` to the product s `CategoryID` value.</span></span> <span data-ttu-id="35bf5-220">Klikněte na odkaz Upravit datové vazby z inteligentní značky DropDownList s a přidružte vlastnost `SelectedValue` k datovému poli `CategoryID`, jak je znázorněno na obrázku 12.</span><span class="sxs-lookup"><span data-stu-id="35bf5-220">Click on the Edit DataBindings link from the DropDownList s smart tag and associate the `SelectedValue` property with the `CategoryID` data field as shown in Figure 12.</span></span>

![Vytvořit vazby hodnoty KódKategorie produktu s vlastností DropDownList s SelectedValue](batch-updating-cs/_static/image12.gif)

<span data-ttu-id="35bf5-222">**Obrázek 12**: svázání hodnoty `CategoryID` produktů s vlastností DropDownList s `SelectedValue`</span><span class="sxs-lookup"><span data-stu-id="35bf5-222">**Figure 12**: Bind the Product s `CategoryID` Value to the DropDownList s `SelectedValue` Property</span></span>

<span data-ttu-id="35bf5-223">Jeden poslední problém zůstává: Pokud produkt nemá `CategoryID` zadanou hodnotu, výsledkem příkazu DataBinding na `SelectedValue` bude výjimka.</span><span class="sxs-lookup"><span data-stu-id="35bf5-223">One last problem remains: if the product doesn t have a `CategoryID` value specified then the databinding statement on `SelectedValue` will result in an exception.</span></span> <span data-ttu-id="35bf5-224">Důvodem je skutečnost, že ovládací prvek DropDownList obsahuje pouze položky pro kategorie a nenabízí možnost pro tyto produkty, které mají `NULL` hodnotu databáze pro `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-224">This is because the DropDownList contains only items for the categories and does not offer an option for those products that have a `NULL` database value for `CategoryID`.</span></span> <span data-ttu-id="35bf5-225">Chcete-li tento problém napravit, nastavte vlastnost `AppendDataBoundItems` DropDownList na `true` a přidejte novou položku do ovládacího prvků DropDownList, vynechejte vlastnost `Value` z deklarativní syntaxe.</span><span class="sxs-lookup"><span data-stu-id="35bf5-225">To remedy this, set the DropDownList s `AppendDataBoundItems` property to `true` and add a new item to the DropDownList, omitting the `Value` property from the declarative syntax.</span></span> <span data-ttu-id="35bf5-226">Proto se ujistěte, že deklarativní syntaxe `Categories` DropDownList s vypadá takto:</span><span class="sxs-lookup"><span data-stu-id="35bf5-226">That is, make sure that the `Categories` DropDownList s declarative syntax looks like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample3.aspx)]

<span data-ttu-id="35bf5-227">Všimněte si, jak `<asp:ListItem Value="">` – vybrat jeden – má jeho `Value` atribut explicitně nastaven na prázdný řetězec.</span><span class="sxs-lookup"><span data-stu-id="35bf5-227">Note how the `<asp:ListItem Value="">` -- Select One -- has its `Value` attribute explicitly set to an empty string.</span></span> <span data-ttu-id="35bf5-228">Přečtěte si kurz [přizpůsobení rozhraní pro úpravu dat](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) pro podrobnější diskuzi o tom, proč je tato další položka DropDownList potřebná pro zpracování `NULL`ho případu a proč je nutné přiřadit vlastnost `Value` prázdnému řetězci.</span><span class="sxs-lookup"><span data-stu-id="35bf5-228">Refer back to the [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-cs.md) tutorial for a more thorough discussion on why this additional DropDownList item is needed to handle the `NULL` case and why assignment of the `Value` property to an empty string is essential.</span></span>

> [!NOTE]
> <span data-ttu-id="35bf5-229">Tady je potenciální problém s výkonem a škálovatelností, které je potřeba zmínit.</span><span class="sxs-lookup"><span data-stu-id="35bf5-229">There is a potential performance and scalability issue here that is worth mentioning.</span></span> <span data-ttu-id="35bf5-230">Vzhledem k tomu, že každý řádek má ovládací prvek DropDownList, který používá `CategoriesDataSource` jako zdroj dat, metoda `CategoriesBLL` třídy `GetCategories` se zavolá *n* krát na stránku, kde *n* je počet řádků v prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-230">Since each row has a DropDownList that uses the `CategoriesDataSource` as its data source, the `CategoriesBLL` class s `GetCategories` method will be called *n* times per page visit, where *n* is the number of rows in the GridView.</span></span> <span data-ttu-id="35bf5-231">Tato *n* volání `GetCategories` mají za následek *n* dotazů na databázi.</span><span class="sxs-lookup"><span data-stu-id="35bf5-231">These *n* calls to `GetCategories` result in *n* queries to the database.</span></span> <span data-ttu-id="35bf5-232">Tento dopad na databázi může být slabší ukládáním do mezipaměti vrácených kategorií, a to buď v mezipaměti pro požadavky, nebo přes vrstvu ukládání do mezipaměti s využitím závislosti mezipaměti SQL nebo velmi krátké doby platnosti.</span><span class="sxs-lookup"><span data-stu-id="35bf5-232">This impact on the database could be lessened by caching the returned categories either in a per-request cache or through the Caching Layer using a SQL caching dependency or a very short time-based expiry.</span></span> <span data-ttu-id="35bf5-233">Další informace o možnosti ukládání do mezipaměti pro jednotlivé požadavky najdete v tématu [`HttpContext.Items` úložiště mezipaměti pro žádosti](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="35bf5-233">For more information on the per-request caching option, see [`HttpContext.Items` a Per-Request Cache Store](http://aspnet.4guysfromrolla.com/articles/060904-1.aspx).</span></span>

## <a name="step-4-completing-the-editing-interface"></a><span data-ttu-id="35bf5-234">Krok 4: dokončení rozhraní pro úpravy</span><span class="sxs-lookup"><span data-stu-id="35bf5-234">Step 4: Completing the Editing Interface</span></span>

<span data-ttu-id="35bf5-235">Provedli jsme několik změn v šablonách GridView, aniž by bylo nutné se pozastavit, aby se zobrazil náš pokrok.</span><span class="sxs-lookup"><span data-stu-id="35bf5-235">We ve made a number of changes to the GridView s templates without pausing to view our progress.</span></span> <span data-ttu-id="35bf5-236">Chvilku si můžete prohlédnout v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="35bf5-236">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="35bf5-237">Jak ukazuje obrázek 13, jednotlivé řádky jsou vykresleny pomocí `ItemTemplate`, který obsahuje rozhraní pro úpravu buňky s buňkami.</span><span class="sxs-lookup"><span data-stu-id="35bf5-237">As Figure 13 shows, each row is rendered using its `ItemTemplate`, which contains the cell s editing interface.</span></span>

<span data-ttu-id="35bf5-238">[![každý řádek prvku GridView je upravitelný](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-238">[![Each GridView Row is Editable](batch-updating-cs/_static/image13.gif)](batch-updating-cs/_static/image21.png)</span></span>

<span data-ttu-id="35bf5-239">**Obrázek 13**: každý řádek prvku GridView je upravitelný ([kliknutím zobrazíte obrázek v plné velikosti](batch-updating-cs/_static/image22.png)).</span><span class="sxs-lookup"><span data-stu-id="35bf5-239">**Figure 13**: Each GridView Row is Editable ([Click to view full-size image](batch-updating-cs/_static/image22.png))</span></span>

<span data-ttu-id="35bf5-240">K dispozici je několik menších potíží s formátováním, které by se v této fázi měli postarat.</span><span class="sxs-lookup"><span data-stu-id="35bf5-240">There are a few minor formatting issues that we should take care of at this point.</span></span> <span data-ttu-id="35bf5-241">Nejdříve si všimněte, že hodnota `UnitPrice` obsahuje čtyři desetinná místa.</span><span class="sxs-lookup"><span data-stu-id="35bf5-241">First, note that the `UnitPrice` value contains four decimal points.</span></span> <span data-ttu-id="35bf5-242">Chcete-li tento problém vyřešit, vraťte se do `UnitPrice` TemplateField s `ItemTemplate` a z inteligentní značky TextBox s klikněte na odkaz Upravit datové vazby.</span><span class="sxs-lookup"><span data-stu-id="35bf5-242">To fix this, return to the `UnitPrice` TemplateField s `ItemTemplate` and, from the TextBox s smart tag, click on the Edit DataBindings link.</span></span> <span data-ttu-id="35bf5-243">Dále určete, že vlastnost `Text` má být formátována jako číslo.</span><span class="sxs-lookup"><span data-stu-id="35bf5-243">Next, specify that the `Text` property should be formatted as a number.</span></span>

![Naformátovat vlastnost text jako číslo](batch-updating-cs/_static/image14.gif)

<span data-ttu-id="35bf5-245">**Obrázek 14**: naformátování vlastnosti `Text` jako čísla</span><span class="sxs-lookup"><span data-stu-id="35bf5-245">**Figure 14**: Format the `Text` Property as a Number</span></span>

<span data-ttu-id="35bf5-246">Za druhé zařaďte zaškrtávací políčko ve sloupci `Discontinued` (místo toho, aby se zarovnalo doleva).</span><span class="sxs-lookup"><span data-stu-id="35bf5-246">Second, let s center the checkbox in the `Discontinued` column (rather than having it left-aligned).</span></span> <span data-ttu-id="35bf5-247">Klikněte na Upravit sloupce z inteligentní značky GridView s a vyberte `Discontinued` TemplateField ze seznamu polí v levém dolním rohu.</span><span class="sxs-lookup"><span data-stu-id="35bf5-247">Click on Edit Columns from the GridView s smart tag and select the `Discontinued` TemplateField from the list of fields in the bottom left corner.</span></span> <span data-ttu-id="35bf5-248">Přejděte k podrobnostem `ItemStyle` a nastavte vlastnost `HorizontalAlign` na střed, jak je znázorněno na obrázku 15.</span><span class="sxs-lookup"><span data-stu-id="35bf5-248">Drill down into `ItemStyle` and set the `HorizontalAlign` property to Center as shown in Figure 15.</span></span>

![Vycentrovat zaškrtávací políčko, které je ukončeno](batch-updating-cs/_static/image15.gif)

<span data-ttu-id="35bf5-250">**Obrázek 15**: prostřední zaškrtávací políčko `Discontinued`</span><span class="sxs-lookup"><span data-stu-id="35bf5-250">**Figure 15**: Center the `Discontinued` CheckBox</span></span>

<span data-ttu-id="35bf5-251">Dále do stránky přidejte ovládací prvek ovládací souhrnu ověření a nastavte jeho vlastnost `ShowMessageBox` na `true` a jeho vlastnost `ShowSummary` na `false`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-251">Next, add a ValidationSummary control to the page and set its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="35bf5-252">Přidejte také webové ovládací prvky tlačítko, které při kliknutí aktualizují změny uživatele.</span><span class="sxs-lookup"><span data-stu-id="35bf5-252">Also add the Button Web controls that, when clicked, will update the user s changes.</span></span> <span data-ttu-id="35bf5-253">Konkrétně přidejte dvě webové ovládací prvky tlačítko, jednu nad prvek GridView a jednu nad ním, nastavením obou ovládacích prvků `Text` vlastnosti pro aktualizaci produktů.</span><span class="sxs-lookup"><span data-stu-id="35bf5-253">Specifically, add two Button Web controls, one above the GridView and one below it, setting both controls `Text` properties to Update Products .</span></span>

<span data-ttu-id="35bf5-254">Vzhledem k tomu, že rozhraní pro úpravy GridView s je definované ve svých TemplateFieldch `ItemTemplate` s, `EditItemTemplate` s je nadbytečný a může být odstraněno.</span><span class="sxs-lookup"><span data-stu-id="35bf5-254">Since the GridView s editing interface is defined in its TemplateFields `ItemTemplate` s, the `EditItemTemplate` s are superfluous and may be deleted.</span></span>

<span data-ttu-id="35bf5-255">Po provedení výše zmíněných změn formátování, přidání ovládacích prvků tlačítko a odebrání zbytečných `EditItemTemplate` s, by vaše deklarativní syntaxe stránky měla vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="35bf5-255">After making the above mentioned formatting changes, adding the Button controls, and removing the unnecessary `EditItemTemplate` s, your page s declarative syntax should look like the following:</span></span>

[!code-aspx[Main](batch-updating-cs/samples/sample4.aspx)]

<span data-ttu-id="35bf5-256">Obrázek 16 znázorňuje tuto stránku při prohlížení přes prohlížeč po přidání webového ovládacího prvku tlačítka a provedené změny formátování.</span><span class="sxs-lookup"><span data-stu-id="35bf5-256">Figure 16 shows this page when viewed through a browser after the Button Web controls have been added and the formatting changes made.</span></span>

<span data-ttu-id="35bf5-257">[![stránka teď obsahuje dvě tlačítka pro aktualizaci produktů.](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-257">[![The Page Now Includes Two Update Products Buttons](batch-updating-cs/_static/image16.gif)](batch-updating-cs/_static/image23.png)</span></span>

<span data-ttu-id="35bf5-258">**Obrázek 16**: stránka teď obsahuje dvě tlačítka pro aktualizaci produktů ([kliknutím zobrazíte obrázek v plné velikosti).](batch-updating-cs/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="35bf5-258">**Figure 16**: The Page Now Includes Two Update Products Buttons ([Click to view full-size image](batch-updating-cs/_static/image24.png))</span></span>

## <a name="step-5-updating-the-products"></a><span data-ttu-id="35bf5-259">Krok 5: aktualizace produktů</span><span class="sxs-lookup"><span data-stu-id="35bf5-259">Step 5: Updating the Products</span></span>

<span data-ttu-id="35bf5-260">Když uživatel navštíví tuto stránku, provede změny a potom klikněte na jedno z těchto dvou tlačítek pro aktualizaci produktů.</span><span class="sxs-lookup"><span data-stu-id="35bf5-260">When a user visits this page they will make their modifications and then click one of the two Update Products buttons.</span></span> <span data-ttu-id="35bf5-261">V tomto bodě musíme nějakým způsobem Uložit uživatelem zadané hodnoty pro každý řádek do instance `ProductsDataTable` a pak předat metodu knihoven BLL, která pak předává tuto `ProductsDataTable` instanci do metody DAL s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-261">At that point we need to somehow save the user-entered values for each row into a `ProductsDataTable` instance and then pass that to a BLL method that will then pass that `ProductsDataTable` instance to the DAL s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="35bf5-262">Metoda `UpdateWithTransaction`, kterou jsme vytvořili v [předchozím kurzu](wrapping-database-modifications-within-a-transaction-cs.md), zajišťuje, že dávka změn bude aktualizována jako atomická operace.</span><span class="sxs-lookup"><span data-stu-id="35bf5-262">The `UpdateWithTransaction` method, which we created in the [preceding tutorial](wrapping-database-modifications-within-a-transaction-cs.md), ensures that the batch of changes will be updated as an atomic operation.</span></span>

<span data-ttu-id="35bf5-263">Vytvořte metodu s názvem `BatchUpdate` v `BatchUpdate.aspx.cs` a přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="35bf5-263">Create a method named `BatchUpdate` in `BatchUpdate.aspx.cs` and add the following code:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample5.cs)]

<span data-ttu-id="35bf5-264">Tato metoda začíná tím, že získá všechny produkty zpátky v `ProductsDataTable` prostřednictvím volání metody `GetProducts` knihoven BLL s.</span><span class="sxs-lookup"><span data-stu-id="35bf5-264">This method starts out by getting all of the products back in a `ProductsDataTable` via a call to the BLL s `GetProducts` method.</span></span> <span data-ttu-id="35bf5-265">Potom vytvoří výčet [`Rows` kolekce](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx)`ProductGrid` GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-265">It then enumerates the `ProductGrid` GridView s [`Rows` collection](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rows(VS.80).aspx).</span></span> <span data-ttu-id="35bf5-266">Kolekce `Rows` obsahuje [instanci`GridViewRow`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) pro každý řádek zobrazený v prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-266">The `Rows` collection contains a [`GridViewRow` instance](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewrow.aspx) for each row displayed in the GridView.</span></span> <span data-ttu-id="35bf5-267">Vzhledem k tomu, že se zobrazuje maximálně deset řádků na stránce, nebude mít `Rows` kolekce GridViews více než deset položek.</span><span class="sxs-lookup"><span data-stu-id="35bf5-267">Since we are showing at most ten rows per page, the GridView s `Rows` collection will have no more than ten items.</span></span>

<span data-ttu-id="35bf5-268">Pro každý řádek je `ProductID` převzata z kolekce `DataKeys` a v `ProductsDataTable`je vybrána příslušná `ProductsRow`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-268">For each row the `ProductID` is grabbed from the `DataKeys` collection and the appropriate `ProductsRow` is selected from the `ProductsDataTable`.</span></span> <span data-ttu-id="35bf5-269">Na čtyři vstupní ovládací prvky TemplateField jsou programově odkazovány a jejich hodnoty jsou přiřazeny vlastnostem `ProductsRow` instance s.</span><span class="sxs-lookup"><span data-stu-id="35bf5-269">The four TemplateField input controls are programmatically referenced and their values assigned to the `ProductsRow` instance s properties.</span></span> <span data-ttu-id="35bf5-270">Po použití hodnot jednotlivých řádků GridView a k aktualizaci `ProductsDataTable`je předána metodě knihoven BLL s `UpdateWithTransaction`, která, jak jsme viděli v předchozím kurzu, jednoduše zavolá do metody DAL s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-270">After each GridView row s values have been used to update the `ProductsDataTable`, it s passed to the BLL s `UpdateWithTransaction` method which, as we saw in the preceding tutorial, simply calls down into the DAL s `UpdateWithTransaction` method.</span></span>

<span data-ttu-id="35bf5-271">Algoritmus dávkové aktualizace použitý pro účely tohoto kurzu aktualizuje každý řádek v `ProductsDataTable`, který odpovídá řádku v prvku GridView, bez ohledu na to, zda byly informace o produktu změněny.</span><span class="sxs-lookup"><span data-stu-id="35bf5-271">The batch update algorithm used for this tutorial updates each row in the `ProductsDataTable` that corresponds to a row in the GridView, regardless of whether the product s information has been changed.</span></span> <span data-ttu-id="35bf5-272">I když tyto nevidomé aktualizace většinou nedochází k problémům s výkonem, můžou vést k nadbytečným záznamům, pokud převedete změny auditování v tabulce databáze.</span><span class="sxs-lookup"><span data-stu-id="35bf5-272">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="35bf5-273">Zpět v kurzu [provádění dávkových aktualizací](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) jsme prozkoumali, že služba Batch aktualizuje rozhraní pomocí prvku DataList a přidala kód, který by aktualizoval pouze ty záznamy, které byly ve skutečnosti změněny uživatelem.</span><span class="sxs-lookup"><span data-stu-id="35bf5-273">Back in the [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) tutorial we explored a batch updating interface with the DataList and added code that would only update those records that were actually modified by the user.</span></span> <span data-ttu-id="35bf5-274">Využijte techniky od [aktualizace služby Batch](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) k aktualizaci kódu v tomto kurzu, pokud je to potřeba.</span><span class="sxs-lookup"><span data-stu-id="35bf5-274">Feel free to use the techniques from [Performing Batch Updates](../editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs.md) to update the code in this tutorial, if desired.</span></span>

> [!NOTE]
> <span data-ttu-id="35bf5-275">Při navázání zdroje dat na prvek GridView pomocí inteligentní značky Visual Studio automaticky přiřadí hodnoty primárního klíče zdroje dat k vlastnosti GridView `DataKeyNames`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-275">When binding the data source to the GridView through its smart tag, Visual Studio automatically assigns the data source s primary key value(s) to the GridView s `DataKeyNames` property.</span></span> <span data-ttu-id="35bf5-276">Pokud jste prvek ObjectDataSource nevytvořili v prvku GridView pomocí inteligentní značky GridView s, jak je uvedeno v kroku 1, bude nutné ručně nastavit vlastnost GridView `DataKeyNames` na ProductID, aby bylo možné získat přístup k hodnotě `ProductID` pro každý řádek prostřednictvím kolekce `DataKeys`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-276">If you did not bind the ObjectDataSource to the GridView through the GridView s smart tag as outlined in Step 1, then you will need to manually set the GridView s `DataKeyNames` property to ProductID in order to access the `ProductID` value for each row through the `DataKeys` collection.</span></span>

<span data-ttu-id="35bf5-277">Kód používaný v `BatchUpdate` je podobný tomu, který se používá v metodách `UpdateProduct` knihoven BLL s, hlavní rozdíl spočívá v tom, že v `UpdateProduct`ch metodách je z architektury načtena pouze jedna instance `ProductRow`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-277">The code used in `BatchUpdate` is similar to that used in the BLL s `UpdateProduct` methods, the main difference being that in the `UpdateProduct` methods only a single `ProductRow` instance is retrieved from the architecture.</span></span> <span data-ttu-id="35bf5-278">Kód, který přiřazuje vlastnosti `ProductRow`, je stejný mezi metodami `UpdateProducts` a kódem v rámci `foreach` smyčky v `BatchUpdate`, jako je to celkový vzor.</span><span class="sxs-lookup"><span data-stu-id="35bf5-278">The code that assigns the properties of the `ProductRow` is the same between the `UpdateProducts` methods and the code within the `foreach` loop in `BatchUpdate`, as is the overall pattern.</span></span>

<span data-ttu-id="35bf5-279">K dokončení tohoto kurzu musíme mít při kliknutí na tlačítko Aktualizovat produkty vyvolanou metodu `BatchUpdate`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-279">To complete this tutorial, we need to have the `BatchUpdate` method invoked when either of the Update Products buttons is clicked.</span></span> <span data-ttu-id="35bf5-280">Vytvořte obslužné rutiny události pro `Click` události těchto dvou ovládacích prvků tlačítko a přidejte následující kód do obslužných rutin událostí:</span><span class="sxs-lookup"><span data-stu-id="35bf5-280">Create event handlers for the `Click` events of these two Button controls and add the following code in the event handlers:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample6.cs)]

<span data-ttu-id="35bf5-281">Nejprve bude provedeno volání `BatchUpdate`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-281">First a call is made to `BatchUpdate`.</span></span> <span data-ttu-id="35bf5-282">V dalším kroku se `ClientScript property` použít k vložení JavaScriptu, který zobrazí MessageBox, který čte produkty, které byly aktualizovány.</span><span class="sxs-lookup"><span data-stu-id="35bf5-282">Next, the `ClientScript property` is used to inject JavaScript that will display a messagebox that reads The products have been updated.</span></span>

<span data-ttu-id="35bf5-283">Vyzkoušejte si test tohoto kódu minutou.</span><span class="sxs-lookup"><span data-stu-id="35bf5-283">Take a minute to test out this code.</span></span> <span data-ttu-id="35bf5-284">Navštivte `BatchUpdate.aspx` v prohlížeči, upravte počet řádků a klikněte na jedno z tlačítek pro aktualizaci produktů.</span><span class="sxs-lookup"><span data-stu-id="35bf5-284">Visit `BatchUpdate.aspx` through a browser, edit a number of rows, and click one of the Update Products buttons.</span></span> <span data-ttu-id="35bf5-285">Za předpokladu, že nejsou k dispozici žádné chyby ověřování, měli byste vidět MessageBox, který čte produkty.</span><span class="sxs-lookup"><span data-stu-id="35bf5-285">Assuming there are no input validation errors, you should see a messagebox that reads The products have been updated.</span></span> <span data-ttu-id="35bf5-286">K ověření atomické aktualizace zvažte přidání omezení náhodného `CHECK`, jako je, které nepovoluje `UnitPrice` hodnoty 1234,56.</span><span class="sxs-lookup"><span data-stu-id="35bf5-286">To verify the atomicity of the update, consider adding a random `CHECK` constraint, like one that disallows `UnitPrice` values of 1234.56.</span></span> <span data-ttu-id="35bf5-287">Pak z `BatchUpdate.aspx`upravte několik záznamů a nezapomeňte nastavit jednu z `UnitPrice` hodnoty produktu na zakázanou hodnotu (1234,56).</span><span class="sxs-lookup"><span data-stu-id="35bf5-287">Then from `BatchUpdate.aspx`, edit a number of records, making sure to set one of the product s `UnitPrice` value to the forbidden value ( 1234.56 ).</span></span> <span data-ttu-id="35bf5-288">To by mělo mít za následek chybu, když kliknete na aktualizovat produkty s ostatními změnami během této dávkové operace zpátky na původní hodnoty.</span><span class="sxs-lookup"><span data-stu-id="35bf5-288">This should result in an error when clicking Update Products with the other changes during that batch operation rolled back to their original values.</span></span>

## <a name="an-alternativebatchupdatemethod"></a><span data-ttu-id="35bf5-289">Alternativní metoda`BatchUpdate`</span><span class="sxs-lookup"><span data-stu-id="35bf5-289">An Alternative`BatchUpdate`Method</span></span>

<span data-ttu-id="35bf5-290">Metoda `BatchUpdate`, kterou jsme právě zkontrolovali, načte *všechny* produkty z metody `GetProducts` knihoven BLL s a pak aktualizuje pouze ty záznamy, které se zobrazí v prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-290">The `BatchUpdate` method we just examined retrieves *all* of the products from the BLL s `GetProducts` method and then updates just those records that appear in the GridView.</span></span> <span data-ttu-id="35bf5-291">Tento přístup je ideální, pokud GridView nepoužívá stránkování, ale pokud k tomu dojde, může to být stovky, tisíce nebo desítky tisíců produktů, ale pouze deset řádků v prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-291">This approach is ideal if the GridView does not use paging, but if it does, there may be hundreds, thousands, or tens of thousands of products, but only ten rows in the GridView.</span></span> <span data-ttu-id="35bf5-292">V takovém případě jsou všechny produkty z databáze pouze pro úpravu 10 z nich méně, než je ideální.</span><span class="sxs-lookup"><span data-stu-id="35bf5-292">In such a case, getting all of the products from the database only to modify 10 of them is less than ideal.</span></span>

<span data-ttu-id="35bf5-293">Pro tyto typy situací zvažte místo toho použití následující metody `BatchUpdateAlternate`:</span><span class="sxs-lookup"><span data-stu-id="35bf5-293">For those types of situations, consider using the following `BatchUpdateAlternate` method instead:</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample7.cs)]

<span data-ttu-id="35bf5-294">`BatchMethodAlternate` spustí vytvořením nového prázdného `ProductsDataTable` s názvem `products`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-294">`BatchMethodAlternate` starts by creating a new empty `ProductsDataTable` named `products`.</span></span> <span data-ttu-id="35bf5-295">Pak kroky prostřednictvím kolekce `Rows` GridView. a pro každý řádek získá konkrétní informace o produktu pomocí metody `GetProductByProductID(productID)` knihoven BLL s.</span><span class="sxs-lookup"><span data-stu-id="35bf5-295">It then steps through the GridView s `Rows` collection and for each row gets the particular product information using the BLL s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="35bf5-296">Načtená `ProductsRow` instance má své vlastnosti aktualizované stejným způsobem jako `BatchUpdate`, ale po aktualizaci řádku, který je importován do `products``ProductsDataTable` prostřednictvím [metody`ImportRow(DataRow)`](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx)DataTable s.</span><span class="sxs-lookup"><span data-stu-id="35bf5-296">The retrieved `ProductsRow` instance has its properties updated in the same fashion as `BatchUpdate`, but after updating the row it is imported into the `products``ProductsDataTable` via the DataTable s [`ImportRow(DataRow)` method](https://msdn.microsoft.com/library/system.data.datatable.importrow(VS.80).aspx).</span></span>

<span data-ttu-id="35bf5-297">Po dokončení smyčky `foreach` `products` obsahuje jednu instanci `ProductsRow` pro každý řádek v prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-297">After the `foreach` loop completes, `products` contains one `ProductsRow` instance for each row in the GridView.</span></span> <span data-ttu-id="35bf5-298">Vzhledem k tomu, že se každá z `ProductsRow` instancí přidala do `products` (místo aktualizace), pokud je do metody `UpdateWithTransaction` znovu předána, `ProductsTableAdapter` se pokusí vložit každý záznam do databáze.</span><span class="sxs-lookup"><span data-stu-id="35bf5-298">Since each of the `ProductsRow` instances have been added to the `products` (instead of updated), if we blindly pass it to the `UpdateWithTransaction` method the `ProductsTableAdapter` will try to insert each of the records into the database.</span></span> <span data-ttu-id="35bf5-299">Místo toho je potřeba určit, že se všechny tyto řádky změnily (nepřidalo se).</span><span class="sxs-lookup"><span data-stu-id="35bf5-299">Instead, we need to specify that each of these rows has been modified (not added).</span></span>

<span data-ttu-id="35bf5-300">To lze provést přidáním nové metody do knihoven BLL s názvem `UpdateProductsWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-300">This can be accomplished by adding a new method to the BLL named `UpdateProductsWithTransaction`.</span></span> <span data-ttu-id="35bf5-301">`UpdateProductsWithTransaction`, zobrazené níže, nastaví `RowState` každé z `ProductsRow` instancí v `ProductsDataTable` na `Modified` a pak předá `ProductsDataTable` metodě DAL s `UpdateWithTransaction`.</span><span class="sxs-lookup"><span data-stu-id="35bf5-301">`UpdateProductsWithTransaction`, shown below, sets the `RowState` of each of the `ProductsRow` instances in the `ProductsDataTable` to `Modified` and then passes the `ProductsDataTable` to the DAL s `UpdateWithTransaction` method.</span></span>

[!code-csharp[Main](batch-updating-cs/samples/sample8.cs)]

## <a name="summary"></a><span data-ttu-id="35bf5-302">Souhrn</span><span class="sxs-lookup"><span data-stu-id="35bf5-302">Summary</span></span>

<span data-ttu-id="35bf5-303">Prvek GridView poskytuje integrované možnosti pro úpravu pro jednotlivé řádky, ale neobsahuje podporu pro vytváření plně upravitelných rozhraní.</span><span class="sxs-lookup"><span data-stu-id="35bf5-303">The GridView provides built-in per-row editing capabilities, but lacks support for creating fully editable interfaces.</span></span> <span data-ttu-id="35bf5-304">Jak jsme viděli v tomto kurzu, taková rozhraní jsou možná, ale vyžaduje práci.</span><span class="sxs-lookup"><span data-stu-id="35bf5-304">As we saw in this tutorial, such interfaces are possible, but require a bit of work.</span></span> <span data-ttu-id="35bf5-305">Chcete-li vytvořit prvek GridView, kde je každý řádek upravitelný, je nutné převést pole GridView s na TemplateFields a definovat rozhraní pro úpravy v rámci `ItemTemplate` s.</span><span class="sxs-lookup"><span data-stu-id="35bf5-305">To create a GridView where every row is editable, we need to convert the GridView s fields into TemplateFields and define the editing interface within the `ItemTemplate` s.</span></span> <span data-ttu-id="35bf5-306">Kromě toho musí být na stránku přidány webové ovládací prvky tlačítka aktualizovat všechny typy, oddělené od prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="35bf5-306">Additionally, Update All -type Button Web controls must be added to the page, separate from the GridView.</span></span> <span data-ttu-id="35bf5-307">Tato tlačítka `Click` obslužných rutin událostí musí vytvořit výčet `Rows` kolekce GridView, uložit změny v `ProductsDataTable`a předat aktualizované informace do příslušné metody knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="35bf5-307">These Buttons `Click` event handlers need to enumerate the GridView s `Rows` collection, store the changes in a `ProductsDataTable`, and pass the updated information into the appropriate BLL method.</span></span>

<span data-ttu-id="35bf5-308">V dalším kurzu se dozvíte, jak vytvořit rozhraní pro odstranění dávky.</span><span class="sxs-lookup"><span data-stu-id="35bf5-308">In the next tutorial we'll see how to create an interface for batch deleting.</span></span> <span data-ttu-id="35bf5-309">Konkrétně jednotlivé řádky prvku GridView budou obsahovat zaškrtávací políčko a místo toho, aby obsahovali tlačítka aktualizovat všechny typy, budou k dispozici tlačítka pro odstranění vybraných řádků.</span><span class="sxs-lookup"><span data-stu-id="35bf5-309">In particular, each GridView row will include a checkbox and instead of Update All -type buttons, we'll have Delete Selected Rows buttons.</span></span>

<span data-ttu-id="35bf5-310">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="35bf5-310">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="35bf5-311">O autorovi</span><span class="sxs-lookup"><span data-stu-id="35bf5-311">About the Author</span></span>

<span data-ttu-id="35bf5-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor 7 ASP/ASP. NET Books a zakladatel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="35bf5-312">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="35bf5-313">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="35bf5-313">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="35bf5-314">Nejnovější kniha je [*Sams naučit se ASP.NET 2,0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="35bf5-314">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="35bf5-315">Dá se získat na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="35bf5-315">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="35bf5-316">nebo prostřednictvím svého blogu, který najdete na adrese [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="35bf5-316">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="35bf5-317">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="35bf5-317">Special Thanks To</span></span>

<span data-ttu-id="35bf5-318">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="35bf5-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="35bf5-319">Kontroloři vedoucích k tomuto kurzu byli Teresa Murphy a David Suru.</span><span class="sxs-lookup"><span data-stu-id="35bf5-319">Lead reviewers for this tutorial were Teresa Murphy and David Suru.</span></span> <span data-ttu-id="35bf5-320">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="35bf5-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="35bf5-321">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="35bf5-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="35bf5-322">[Předchozí](wrapping-database-modifications-within-a-transaction-cs.md)
> [Další](batch-deleting-cs.md)</span><span class="sxs-lookup"><span data-stu-id="35bf5-322">[Previous](wrapping-database-modifications-within-a-transaction-cs.md)
[Next](batch-deleting-cs.md)</span></span>
