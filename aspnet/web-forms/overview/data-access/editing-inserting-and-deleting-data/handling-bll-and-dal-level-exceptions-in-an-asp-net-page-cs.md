---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
title: Zpracování výjimek na úrovni knihoven BLL-a DAL na stránce ASP.NET (C#) | Microsoft Docs
author: rick-anderson
description: V tomto kurzu se dozvíte, jak zobrazit přívětivou a informativní chybovou zprávu, která by během operace vložení, aktualizace nebo odstranění mohla nastat výjimka...
ms.author: riande
ms.date: 07/17/2006
ms.assetid: 49d8a66c-3ea8-4087-839f-179d1d94512a
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
msc.type: authoredcontent
ms.openlocfilehash: 2b9cdb5af6f33171b191d5a80473c7796eb098d9
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78608386"
---
# <a name="handling-bll--and-dal-level-exceptions-in-an-aspnet-page-c"></a><span data-ttu-id="44ae3-103">Zpracování výjimek na úrovni knihoven BLL a DAL na stránce ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="44ae3-103">Handling BLL- and DAL-Level Exceptions in an ASP.NET Page (C#)</span></span>

<span data-ttu-id="44ae3-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="44ae3-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="44ae3-105">[Stáhnout ukázkovou aplikaci](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) nebo [Stáhnout PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="44ae3-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span></span>

> <span data-ttu-id="44ae3-106">V tomto kurzu se dozvíte, jak zobrazit přívětivou a informativní chybovou zprávu, pokud se během operace vložení, aktualizace nebo odstranění webového ovládacího prvku ASP.NET data vyskytla výjimka.</span><span class="sxs-lookup"><span data-stu-id="44ae3-106">In this tutorial we will see how to display a friendly, informative error message should an exception occur during an insert, update, or delete operation of an ASP.NET data Web control.</span></span>

## <a name="introduction"></a><span data-ttu-id="44ae3-107">Úvod</span><span class="sxs-lookup"><span data-stu-id="44ae3-107">Introduction</span></span>

<span data-ttu-id="44ae3-108">Práce s daty z webové aplikace v ASP.NET s využitím vícevrstvé architektury aplikace zahrnuje následující tři obecné kroky:</span><span class="sxs-lookup"><span data-stu-id="44ae3-108">Working with data from an ASP.NET web application using a tiered application architecture involves the following three general steps:</span></span>

1. <span data-ttu-id="44ae3-109">Určete, jaká metoda vrstvy obchodní logiky musí být vyvolána a jaké hodnoty parametrů se mají předat.</span><span class="sxs-lookup"><span data-stu-id="44ae3-109">Determine what method of the Business Logic Layer needs to be invoked and what parameter values to pass it.</span></span> <span data-ttu-id="44ae3-110">Hodnoty parametrů můžou být pevně kódované, programově přiřazené nebo vstupy zadané uživatelem.</span><span class="sxs-lookup"><span data-stu-id="44ae3-110">The parameter values can be hard coded, programmatically-assigned, or inputs entered by the user.</span></span>
2. <span data-ttu-id="44ae3-111">Vyvolat metodu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-111">Invoke the method.</span></span>
3. <span data-ttu-id="44ae3-112">Zpracování výsledků.</span><span class="sxs-lookup"><span data-stu-id="44ae3-112">Process the results.</span></span> <span data-ttu-id="44ae3-113">Při volání metody knihoven BLL, která vrací data, může to zahrnovat vázání dat na webový ovládací prvek dat.</span><span class="sxs-lookup"><span data-stu-id="44ae3-113">When calling a BLL method that returns data, this may involve binding the data to a data Web control.</span></span> <span data-ttu-id="44ae3-114">Pro metody knihoven BLL, které mění data, to může zahrnovat provedení některé akce na základě návratové hodnoty nebo řádného zpracování jakékoli výjimky, která vznikla v kroku 2.</span><span class="sxs-lookup"><span data-stu-id="44ae3-114">For BLL methods that modify data, this may include performing some action based on a return value or gracefully handling any exception that arose in Step 2.</span></span>

<span data-ttu-id="44ae3-115">Jak jsme viděli v [předchozím kurzu](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), ovládací prvky ObjectDataSource a data webového ovládacího prvku poskytují body rozšiřitelnosti pro kroky 1 a 3.</span><span class="sxs-lookup"><span data-stu-id="44ae3-115">As we saw in the [previous tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), both the ObjectDataSource and the data Web controls provide extensibility points for Steps 1 and 3.</span></span> <span data-ttu-id="44ae3-116">Prvek GridView, například aktivuje jeho událost `RowUpdating` před přiřazením jeho hodnot polí do kolekce `UpdateParameters` prvku ObjectDataSource; jeho událost `RowUpdated` je vyvolána poté, co prvek ObjectDataSource dokončí operaci.</span><span class="sxs-lookup"><span data-stu-id="44ae3-116">The GridView, for example, fires its `RowUpdating` event prior to assigning its field values to its ObjectDataSource's `UpdateParameters` collection; its `RowUpdated` event is raised after the ObjectDataSource has completed the operation.</span></span>

<span data-ttu-id="44ae3-117">Již jsme prozkoumali události, které se aktivují v kroku 1, a zjistili jste, jak je lze použít k přizpůsobení vstupních parametrů nebo zrušení operace.</span><span class="sxs-lookup"><span data-stu-id="44ae3-117">We've already examined the events that fire during Step 1 and have seen how they can be used to customize the input parameters or cancel the operation.</span></span> <span data-ttu-id="44ae3-118">V tomto kurzu provedeme upozornění na události, které se aktivují po dokončení operace.</span><span class="sxs-lookup"><span data-stu-id="44ae3-118">In this tutorial we'll turn our attention to the events that fire after the operation has completed.</span></span> <span data-ttu-id="44ae3-119">Pomocí těchto obslužných rutin událostí na úrovni post můžeme mimo jiné zjistit, jestli během operace došlo k výjimce, a nemusíte ji řádně napravit a zobrazovat na obrazovce přívětivou, informativní chybovou zprávu, a to než výchozí ASP.NET. Stránka výjimky.</span><span class="sxs-lookup"><span data-stu-id="44ae3-119">With these post-level event handlers we can, among other things, determine if an exception occurred during the operation and handle it gracefully, displaying a friendly, informative error message on the screen rather than defaulting to the standard ASP.NET exception page.</span></span>

<span data-ttu-id="44ae3-120">Pro ilustraci práce s těmito událostmi po úrovních vytvoříme stránku, která obsahuje seznam produktů v upravitelném prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="44ae3-120">To illustrate working with these post-level events, let's create a page that lists the products in an editable GridView.</span></span> <span data-ttu-id="44ae3-121">Pokud při aktualizaci produktu dojde k výjimce, zobrazí se na stránce ASP.NET krátká zpráva nad prvku GridView, což vysvětluje, že došlo k problému.</span><span class="sxs-lookup"><span data-stu-id="44ae3-121">When updating a product, if an exception is raised our ASP.NET page will display a short message above the GridView explaining that a problem has occurred.</span></span> <span data-ttu-id="44ae3-122">Pojďme začít!</span><span class="sxs-lookup"><span data-stu-id="44ae3-122">Let's get started!</span></span>

## <a name="step-1-creating-an-editable-gridview-of-products"></a><span data-ttu-id="44ae3-123">Krok 1: vytvoření upravitelného prvku GridView u produktů</span><span class="sxs-lookup"><span data-stu-id="44ae3-123">Step 1: Creating an Editable GridView of Products</span></span>

<span data-ttu-id="44ae3-124">V předchozím kurzu jsme vytvořili upravitelný prvek GridView s pouze dvěma poli `ProductName` a `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-124">In the previous tutorial we created an editable GridView with just two fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="44ae3-125">To vyžadovalo vytvoření dalšího přetížení pro metodu `UpdateProduct` `ProductsBLL` třídy, jednu, která přijala pouze tři vstupní parametry (název produktu, Jednotková cena a ID), a to na rozdíl od parametru pro každé pole produktu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-125">This required creating an additional overload for the `ProductsBLL` class's `UpdateProduct` method, one that only accepted three input parameters (the product's name, unit price, and ID) as opposed a parameter for each product field.</span></span> <span data-ttu-id="44ae3-126">Pro tento kurz Pojďme tuto techniku znovu vymezit vytvořením upravitelného prvku GridView, který zobrazuje název produktu, množství na jednotku, cenu za jednotku a jednotky na skladě, ale umožňuje upravovat jenom název, jednotkovou cenu a jednotky na skladě.</span><span class="sxs-lookup"><span data-stu-id="44ae3-126">For this tutorial, let's practice this technique again, creating an editable GridView that displays the product's name, quantity per unit, unit price, and units in stock, but only allows the name, unit price, and units in stock to be edited.</span></span>

<span data-ttu-id="44ae3-127">Aby bylo možné tento scénář přizpůsobit, budete potřebovat další přetížení metody `UpdateProduct`, jednu, která přijímá čtyři parametry: název produktu, Jednotková cena, jednotky na skladě a ID.</span><span class="sxs-lookup"><span data-stu-id="44ae3-127">To accommodate this scenario we'll need another overload of the `UpdateProduct` method, one that accepts four parameters: the product's name, unit price, units in stock, and ID.</span></span> <span data-ttu-id="44ae3-128">Do třídy `ProductsBLL` přidejte následující metodu:</span><span class="sxs-lookup"><span data-stu-id="44ae3-128">Add the following method to the `ProductsBLL` class:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample1.cs)]

<span data-ttu-id="44ae3-129">Po dokončení této metody jsme připraveni vytvořit stránku ASP.NET, která umožňuje úpravu těchto čtyř konkrétních polí produktu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-129">With this method complete, we're ready to create the ASP.NET page that allows for editing these four particular product fields.</span></span> <span data-ttu-id="44ae3-130">Otevřete stránku `ErrorHandling.aspx` ve složce `EditInsertDelete` a přidejte prvek GridView do stránky pomocí návrháře.</span><span class="sxs-lookup"><span data-stu-id="44ae3-130">Open the `ErrorHandling.aspx` page in the `EditInsertDelete` folder and add a GridView to the page through the Designer.</span></span> <span data-ttu-id="44ae3-131">Vytvořte vazby na prvek GridView k novému prvku ObjectDataSource, mapování `Select()` metody na metodu `GetProducts()` `ProductsBLL` třídy a metodu `Update()` na `UpdateProduct` přetížení, které jste právě vytvořili.</span><span class="sxs-lookup"><span data-stu-id="44ae3-131">Bind the GridView to a new ObjectDataSource, mapping the `Select()` method to the `ProductsBLL` class's `GetProducts()` method and the `Update()` method to the `UpdateProduct` overload just created.</span></span>

<span data-ttu-id="44ae3-132">[![použít přetížení metody UpdateProduct, které přijímá čtyři vstupní parametry.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-132">[![Use the UpdateProduct Method Overload That Accepts Four Input Parameters](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span></span>

<span data-ttu-id="44ae3-133">**Obrázek 1**: použití přetížení metody `UpdateProduct`, které přijímá čtyři vstupní parametry ([kliknutím zobrazíte obrázek v plné velikosti).](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-133">**Figure 1**: Use the `UpdateProduct` Method Overload That Accepts Four Input Parameters ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png))</span></span>

<span data-ttu-id="44ae3-134">Tím se vytvoří prvek ObjectDataSource s kolekcí `UpdateParameters` se čtyřmi parametry a GridView s polem pro každé pole produktu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-134">This will create an ObjectDataSource with an `UpdateParameters` collection with four parameters and a GridView with a field for each of the product fields.</span></span> <span data-ttu-id="44ae3-135">Deklarativní označení prvku ObjectDataSource přiřadí vlastnost `OldValuesParameterFormatString` hodnotu `original_{0}`, která způsobí výjimku, protože naše třída knihoven BLL neočekává, že vstupní parametr s názvem `original_productID` má být předán.</span><span class="sxs-lookup"><span data-stu-id="44ae3-135">The ObjectDataSource's declarative markup assigns the `OldValuesParameterFormatString` property the value `original_{0}`, which will cause an exception since our BLL class's don't expect an input parameter named `original_productID` to be passed in.</span></span> <span data-ttu-id="44ae3-136">Nezapomeňte odebrání tohoto nastavení zcela odebrat z deklarativní syntaxe (nebo ho nastavte na výchozí hodnotu `{0}`).</span><span class="sxs-lookup"><span data-stu-id="44ae3-136">Don't forget to remove this setting altogether from the declarative syntax (or set it to the default value, `{0}`).</span></span>

<span data-ttu-id="44ae3-137">Potom zredukovali dolů v prvku GridView, aby zahrnovala pouze `ProductName`, `QuantityPerUnit`, `UnitPrice`a `UnitsInStock` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="44ae3-137">Next, pare down the GridView to include only the `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` BoundFields.</span></span> <span data-ttu-id="44ae3-138">Také můžete použít jakékoli formátování na úrovni pole, které považujete za nutné (například změna vlastností `HeaderText`).</span><span class="sxs-lookup"><span data-stu-id="44ae3-138">Also feel free to apply any field-level formatting you deem necessary (such as changing the `HeaderText` properties).</span></span>

<span data-ttu-id="44ae3-139">V předchozím kurzu jsme se podívali na způsob formátování `UnitPrice` vlastnost BoundField jako měny v režimu jen pro čtení a v režimu úprav.</span><span class="sxs-lookup"><span data-stu-id="44ae3-139">In the previous tutorial we looked at how to format the `UnitPrice` BoundField as a currency both in read-only mode and edit mode.</span></span> <span data-ttu-id="44ae3-140">Pojďme to udělat tady.</span><span class="sxs-lookup"><span data-stu-id="44ae3-140">Let's do the same here.</span></span> <span data-ttu-id="44ae3-141">Vystavte si, že toto nastavení vlastnosti `DataFormatString` vlastnost BoundField na `{0:c}`, jeho vlastnost `HtmlEncode` na `false`a jeho `ApplyFormatInEditMode` na `true`, jak je znázorněno na obrázku 2.</span><span class="sxs-lookup"><span data-stu-id="44ae3-141">Recall that this required setting the BoundField's `DataFormatString` property to `{0:c}`, its `HtmlEncode` property to `false`, and its `ApplyFormatInEditMode` to `true`, as shown in Figure 2.</span></span>

<span data-ttu-id="44ae3-142">[![nakonfigurovat vlastnost BoundField UnitPrice, který se má zobrazit jako měna](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-142">[![Configure the UnitPrice BoundField to Display as a Currency](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span></span>

<span data-ttu-id="44ae3-143">**Obrázek 2**: Konfigurace `UnitPrice` vlastnost BoundField, která se má zobrazit jako měna ([kliknutím zobrazíte obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="44ae3-143">**Figure 2**: Configure the `UnitPrice` BoundField to Display as a Currency ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span></span>

<span data-ttu-id="44ae3-144">Formátování `UnitPrice` jako měny v rozhraní pro úpravy vyžaduje vytvoření obslužné rutiny události pro událost `RowUpdating` prvku GridView, která analyzuje řetězec ve formátu měny na hodnotu `decimal`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-144">Formatting the `UnitPrice` as a currency in the editing interface requires creating an event handler for the GridView's `RowUpdating` event that parses the currency-formatted string into a `decimal` value.</span></span> <span data-ttu-id="44ae3-145">Odvolat, zda `RowUpdating` obslužná rutina události z posledního kurzu zkontrolována, zda uživatel zadal hodnotu `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-145">Recall that the `RowUpdating` event handler from the last tutorial also checked to ensure that the user provided a `UnitPrice` value.</span></span> <span data-ttu-id="44ae3-146">V tomto kurzu ale umožníte uživateli vynechat tuto cenu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-146">However, for this tutorial let's allow the user to omit the price.</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample2.cs)]

<span data-ttu-id="44ae3-147">Náš prvek GridView obsahuje `QuantityPerUnit` vlastnost BoundField, ale tento vlastnost BoundField by měl být pouze pro účely zobrazení a uživatel by neměl být upravitelný.</span><span class="sxs-lookup"><span data-stu-id="44ae3-147">Our GridView includes a `QuantityPerUnit` BoundField, but this BoundField should be only for display purposes and should not be editable by the user.</span></span> <span data-ttu-id="44ae3-148">Pokud to chcete uspořádat, jednoduše nastavte vlastnost `ReadOnly` BoundFields na `true`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-148">To arrange this, simply set the BoundFields' `ReadOnly` property to `true`.</span></span>

<span data-ttu-id="44ae3-149">[![nastavit QuantityPerUnit vlastnost BoundField jen pro čtení](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-149">[![Make the QuantityPerUnit BoundField Read-Only](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span></span>

<span data-ttu-id="44ae3-150">**Obrázek 3**: nastavte `QuantityPerUnit` vlastnost BoundField jen pro čtení ([kliknutím zobrazíte obrázek v plné velikosti).](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-150">**Figure 3**: Make the `QuantityPerUnit` BoundField Read-Only ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png))</span></span>

<span data-ttu-id="44ae3-151">Nakonec zaškrtněte políčko Povolit úpravy z inteligentní značky GridView.</span><span class="sxs-lookup"><span data-stu-id="44ae3-151">Finally, check the Enable Editing checkbox from the GridView's smart tag.</span></span> <span data-ttu-id="44ae3-152">Po dokončení těchto kroků by měl Návrhář `ErrorHandling.aspx` stránky vypadat podobně jako obrázek 4.</span><span class="sxs-lookup"><span data-stu-id="44ae3-152">After completing these steps the `ErrorHandling.aspx` page's Designer should look similar to Figure 4.</span></span>

<span data-ttu-id="44ae3-153">[![odebrat všechny kromě požadovaných BoundFields a zaškrtnout políčko Povolit úpravy.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-153">[![Remove All But the Needed BoundFields and Check the Enable Editing Checkbox](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span></span>

<span data-ttu-id="44ae3-154">**Obrázek 4**: Odeberte všechna kromě potřebná BoundFields a zaškrtněte políčko Povolit úpravy ([kliknutím zobrazíte obrázek v plné velikosti).](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-154">**Figure 4**: Remove All But the Needed BoundFields and Check the Enable Editing Checkbox ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png))</span></span>

<span data-ttu-id="44ae3-155">V tuto chvíli máme seznam všech produktů ' `ProductName`, `QuantityPerUnit`, `UnitPrice`a `UnitsInStock` polí; je však možné upravovat pouze pole `ProductName`, `UnitPrice`a `UnitsInStock`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-155">At this point we have a list of all of the products' `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` fields; however, only the `ProductName`, `UnitPrice`, and `UnitsInStock` fields can be edited.</span></span>

<span data-ttu-id="44ae3-156">[![uživatelé teď můžou snadno upravovat názvy, ceny a jednotky produktů v uložených polích.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-156">[![Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span></span>

<span data-ttu-id="44ae3-157">**Obrázek 5**: uživatelé teď můžou snadno upravovat názvy, ceny a jednotky produktů v uložených polích ([kliknutím zobrazíte obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png)).</span><span class="sxs-lookup"><span data-stu-id="44ae3-157">**Figure 5**: Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png))</span></span>

## <a name="step-2-gracefully-handling-dal-level-exceptions"></a><span data-ttu-id="44ae3-158">Krok 2: řádné zpracování výjimek na úrovni DAL</span><span class="sxs-lookup"><span data-stu-id="44ae3-158">Step 2: Gracefully Handling DAL-Level Exceptions</span></span>

<span data-ttu-id="44ae3-159">I když náš upravitelný GridView funguje, když uživatelé zadají právní hodnoty pro název upravovaného produktu, cenu a jednotky na skladě, a zadáním neplatných hodnot způsobí výjimku.</span><span class="sxs-lookup"><span data-stu-id="44ae3-159">While our editable GridView works wonderfully when users enter legal values for the edited product's name, price, and units in stock, entering illegal values results in an exception.</span></span> <span data-ttu-id="44ae3-160">Například vynechání hodnoty `ProductName` způsobí vyvolání [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) , protože vlastnost `ProductName` ve třídě `ProductsRow` má vlastnost `AllowDBNull` nastavenou na `false`; Pokud je databáze mimo provoz, při pokusu o připojení k databázi vygeneruje služba TableAdapter `SqlException`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-160">For example, omitting the `ProductName` value causes a [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) to be thrown since the `ProductName` property in the `ProductsRow` class has its `AllowDBNull` property set to `false`; if the database is down, a `SqlException` will be thrown by the TableAdapter when attempting to connect to the database.</span></span> <span data-ttu-id="44ae3-161">Bez provedení jakékoli akce se tyto výjimky doplní z vrstvy přístupu k datům do vrstvy obchodní logiky, pak na stránku ASP.NET a nakonec do modulu runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="44ae3-161">Without taking any action, these exceptions bubble up from the Data Access Layer to the Business Logic Layer, then to the ASP.NET page, and finally to the ASP.NET runtime.</span></span>

<span data-ttu-id="44ae3-162">V závislosti na tom, jak je vaše webová aplikace nakonfigurovaná a jestli nedošlo k aplikaci `localhost`, může mít Neošetřená výjimka buď obecný server – chybovou stránku, podrobnou zprávu o chybě nebo uživatelsky přívětivou webovou stránku.</span><span class="sxs-lookup"><span data-stu-id="44ae3-162">Depending on how your web application is configured and whether or not you're visiting the application from `localhost`, an unhandled exception can result in either a generic server-error page, a detailed error report, or a user-friendly web page.</span></span> <span data-ttu-id="44ae3-163">Další informace o tom, jak modul runtime ASP.NET reaguje na nezachycenou výjimku, najdete v tématu [zpracování chyb webové aplikace v ASP.NET](http://www.15seconds.com/issue/030102.htm) a [elementu customErrors](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) .</span><span class="sxs-lookup"><span data-stu-id="44ae3-163">See [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) and the [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) for more information on how the ASP.NET runtime responds to an uncaught exception.</span></span>

<span data-ttu-id="44ae3-164">Obrázek 6 zobrazuje obrazovku zjištěné při pokusu o aktualizaci produktu bez zadání `ProductName` hodnoty.</span><span class="sxs-lookup"><span data-stu-id="44ae3-164">Figure 6 shows the screen encountered when attempting to update a product without specifying the `ProductName` value.</span></span> <span data-ttu-id="44ae3-165">Toto je výchozí podrobná zpráva o chybách, která se zobrazí, když připravujete prostřednictvím `localhost`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-165">This is the default detailed error report displayed when coming through `localhost`.</span></span>

<span data-ttu-id="44ae3-166">[![vynechání názvu produktu zobrazí podrobnosti o výjimce.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-166">[![Omitting the Product's Name Will Display Exception Details](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span></span>

<span data-ttu-id="44ae3-167">**Obrázek 6**: vynechání názvu produktu zobrazí podrobnosti o výjimce ([kliknutím zobrazíte obrázek v plné velikosti).](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-167">**Figure 6**: Omitting the Product's Name Will Display Exception Details ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png))</span></span>

<span data-ttu-id="44ae3-168">I když jsou informace o výjimce užitečné při testování aplikace, předvádí se koncovému uživateli s takovou obrazovkou, která je v tváři výjimky, méně než ideální.</span><span class="sxs-lookup"><span data-stu-id="44ae3-168">While such exception details are helpful when testing an application, presenting an end user with such a screen in the face of an exception is less than ideal.</span></span> <span data-ttu-id="44ae3-169">Koncový uživatel pravděpodobně neví, co je `NoNullAllowedException` nebo proč to bylo způsobeno.</span><span class="sxs-lookup"><span data-stu-id="44ae3-169">An end user likely doesn't know what a `NoNullAllowedException` is or why it was caused.</span></span> <span data-ttu-id="44ae3-170">Lepším řešením je prezentovat uživatele více uživatelsky přívětivými zprávami s vysvětlením, že při pokusu o aktualizaci produktu došlo k potížím.</span><span class="sxs-lookup"><span data-stu-id="44ae3-170">A better approach is to present the user with a more user-friendly message explaining that there were problems attempting to update the product.</span></span>

<span data-ttu-id="44ae3-171">Pokud při provádění operace dojde k výjimce, události na úrovni post v prvku ObjectDataSource i v ovládacím prvku data web poskytují způsob, jak je rozpoznat a zrušit výjimku z šíření až do modulu runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="44ae3-171">If an exception occurs when performing the operation, the post-level events in both the ObjectDataSource and the data Web control provide a means to detect it and cancel the exception from bubbling up to the ASP.NET runtime.</span></span> <span data-ttu-id="44ae3-172">V našem příkladu vytvoříme obslužnou rutinu události pro událost `RowUpdated` prvku GridView, která určuje, zda byla vyvolána výjimka, a pokud ano, zobrazí podrobnosti o výjimce v ovládacím prvku web Label.</span><span class="sxs-lookup"><span data-stu-id="44ae3-172">For our example, let's create an event handler for the GridView's `RowUpdated` event that determines if an exception has fired and, if so, displays the exception details in a Label Web control.</span></span>

<span data-ttu-id="44ae3-173">Začněte přidáním popisku na stránku ASP.NET a nastavením jeho vlastnosti `ID` na `ExceptionDetails` a vymažte jeho vlastnost `Text`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-173">Start by adding a Label to the ASP.NET page, setting its `ID` property to `ExceptionDetails` and clearing out its `Text` property.</span></span> <span data-ttu-id="44ae3-174">Aby bylo možné nakreslit uživatele na tuto zprávu, nastavte jeho vlastnost `CssClass` na `Warning`, což je Třída CSS, kterou jsme přidali do souboru `Styles.css` v předchozím kurzu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-174">In order to draw the user's eye to this message, set its `CssClass` property to `Warning`, which is a CSS class we added to the `Styles.css` file in the previous tutorial.</span></span> <span data-ttu-id="44ae3-175">Odvolání této třídy CSS způsobí, že se text popisku zobrazí červeně, kurzívou, tučně a extra velkým písmem.</span><span class="sxs-lookup"><span data-stu-id="44ae3-175">Recall that this CSS class causes the Label's text to be displayed in a red, italic, bold, extra large font.</span></span>

<span data-ttu-id="44ae3-176">[![přidání webového ovládacího prvku popisek na stránku](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-176">[![Add a Label Web Control to the Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span></span>

<span data-ttu-id="44ae3-177">**Obrázek 7**: Přidání webového ovládacího prvku popisek na stránku ([kliknutím zobrazíte obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="44ae3-177">**Figure 7**: Add a Label Web Control to the Page ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span></span>

<span data-ttu-id="44ae3-178">Vzhledem k tomu, že chceme, aby byl tento ovládací prvek web popisku viditelný pouze ihned po výskytu výjimky, nastavte jeho vlastnost `Visible` na hodnotu false v obslužné rutině události `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="44ae3-178">Since we want this Label Web control to be visible only immediately after an exception has occurred, set its `Visible` property to false in the `Page_Load` event handler:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample3.cs)]

<span data-ttu-id="44ae3-179">U tohoto kódu na první návštěvě stránky a následných postbackech má ovládací prvek `ExceptionDetails` nastavenou vlastnost `Visible` nastavenou na `false`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-179">With this code, on the first page visit and subsequent postbacks the `ExceptionDetails` control will have its `Visible` property set to `false`.</span></span> <span data-ttu-id="44ae3-180">V tváři výjimky na úrovni DAL nebo knihoven BLL, která se dá rozpoznat v obslužné rutině události `RowUpdated` prvku GridView, nastavíme vlastnost `Visible` ovládacího prvku `ExceptionDetails` na hodnotu true.</span><span class="sxs-lookup"><span data-stu-id="44ae3-180">In the face of a DAL- or BLL-level exception, which we can detect in the GridView's `RowUpdated` event handler, we will set the `ExceptionDetails` control's `Visible` property to true.</span></span> <span data-ttu-id="44ae3-181">Vzhledem k tomu, že se obslužné rutiny událostí webového ovládacího prvku vyskytují po obslužné rutině `Page_Load` události v životním cyklu stránky, bude zobrazen popisek.</span><span class="sxs-lookup"><span data-stu-id="44ae3-181">Since Web control event handlers occur after the `Page_Load` event handler in the page lifecycle, the Label will be shown.</span></span> <span data-ttu-id="44ae3-182">Při příštím postbacku však obslužná rutina události `Page_Load` vrátí vlastnost `Visible` zpět do `false`a skryje ji ze zobrazení znovu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-182">However, on the next postback, the `Page_Load` event handler will revert the `Visible` property back to `false`, hiding it from view again.</span></span>

> [!NOTE]
> <span data-ttu-id="44ae3-183">Případně je možné odebrat nutnost nastavení vlastnosti `Visible` ovládacího prvku `ExceptionDetails` v `Page_Load` přiřazením jeho `Visible` vlastnosti `false` v deklarativní syntaxi a zakázáním jeho stavu zobrazení (nastavením vlastnosti `EnableViewState` na `false`).</span><span class="sxs-lookup"><span data-stu-id="44ae3-183">Alternatively, we could remove the necessity for setting the `ExceptionDetails` control's `Visible` property in `Page_Load` by assigning its `Visible` property `false` in the declarative syntax and disabling its view state (setting its `EnableViewState` property to `false`).</span></span> <span data-ttu-id="44ae3-184">Tento alternativní postup budeme používat v budoucím kurzu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-184">We'll use this alternative approach in a future tutorial.</span></span>

<span data-ttu-id="44ae3-185">Při přidání ovládacího prvku popisek je dalším krokem vytvoření obslužné rutiny události pro událost `RowUpdated` prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="44ae3-185">With the Label control added, our next step is to create the event handler for the GridView's `RowUpdated` event.</span></span> <span data-ttu-id="44ae3-186">Vyberte prvek GridView v návrháři, přejděte na okno Vlastnosti a klikněte na ikonu blesku a uveďte události prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="44ae3-186">Select the GridView in the Designer, go to the Properties window, and click the lightning bolt icon, listing the GridView's events.</span></span> <span data-ttu-id="44ae3-187">Již by měla existovat položka pro událost `RowUpdating` prvku GridView, protože jsme vytvořili obslužnou rutinu události pro tuto událost dříve v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-187">There should already be an entry there for the GridView's `RowUpdating` event, as we created an event handler for this event earlier in this tutorial.</span></span> <span data-ttu-id="44ae3-188">Vytvořte také obslužnou rutinu události pro událost `RowUpdated`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-188">Create an event handler for the `RowUpdated` event as well.</span></span>

![Vytvoření obslužné rutiny události pro událost RowUpdated metody Update prvku GridView](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image22.png)

<span data-ttu-id="44ae3-190">**Obrázek 8**: vytvoření obslužné rutiny události pro událost `RowUpdated` prvku GridView</span><span class="sxs-lookup"><span data-stu-id="44ae3-190">**Figure 8**: Create an Event Handler for the GridView's `RowUpdated` Event</span></span>

> [!NOTE]
> <span data-ttu-id="44ae3-191">Můžete také vytvořit obslužnou rutinu události prostřednictvím rozevíracích seznamů v horní části souboru třídy kódu na pozadí.</span><span class="sxs-lookup"><span data-stu-id="44ae3-191">You can also create the event handler through the drop-down lists at the top of the code-behind class file.</span></span> <span data-ttu-id="44ae3-192">V rozevíracím seznamu na levé straně vyberte prvek GridView a událost `RowUpdated` z pravé části.</span><span class="sxs-lookup"><span data-stu-id="44ae3-192">Select the GridView from the drop-down list on the left and the `RowUpdated` event from the one on the right.</span></span>

<span data-ttu-id="44ae3-193">Vytvořením této obslužné rutiny události se přidá následující kód do třídy kódu na pozadí stránky ASP.NET:</span><span class="sxs-lookup"><span data-stu-id="44ae3-193">Creating this event handler will add the following code to the ASP.NET page's code-behind class:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample4.cs)]

<span data-ttu-id="44ae3-194">Tento druhý vstupní parametr obslužné rutiny události je objekt typu [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), který má tři vlastnosti zájmu pro zpracování výjimek:</span><span class="sxs-lookup"><span data-stu-id="44ae3-194">This event handler's second input parameter is an object of type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), which has three properties of interest for handling exceptions:</span></span>

- <span data-ttu-id="44ae3-195">`Exception` odkaz na vyvolanou výjimku; Pokud nebyla vyvolána žádná výjimka, bude mít tato vlastnost hodnotu `null`</span><span class="sxs-lookup"><span data-stu-id="44ae3-195">`Exception` a reference to the thrown exception; if no exception has been thrown, this property will have a value of `null`</span></span>
- <span data-ttu-id="44ae3-196">`ExceptionHandled` logickou hodnotu, která označuje, zda byla výjimka zpracována v obslužné rutině události `RowUpdated`; Pokud `false` (výchozí), výjimka se znovu vyvolá percolating až do ASP.NET runtime</span><span class="sxs-lookup"><span data-stu-id="44ae3-196">`ExceptionHandled` a Boolean value that indicates whether or not the exception was handled in the `RowUpdated` event handler; if `false` (the default), the exception is re-thrown, percolating up to the ASP.NET runtime</span></span>
- <span data-ttu-id="44ae3-197">`KeepInEditMode` Pokud je nastavená na `true` upravený řádek prvku GridView zůstane v režimu úprav; Pokud `false` (výchozí), řádek GridView se vrátí zpět do režimu jen pro čtení.</span><span class="sxs-lookup"><span data-stu-id="44ae3-197">`KeepInEditMode` if set to `true` the edited GridView row remains in edit mode; if `false` (the default), the GridView row reverts back to its read-only mode</span></span>

<span data-ttu-id="44ae3-198">Náš kód, poté, by měl ověřit, zda `Exception` není `null`, což znamená, že při provádění této operace byla vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="44ae3-198">Our code, then, should check to see if `Exception` is not `null`, meaning that an exception was raised while performing the operation.</span></span> <span data-ttu-id="44ae3-199">V takovém případě chceme:</span><span class="sxs-lookup"><span data-stu-id="44ae3-199">If this is the case, we want to:</span></span>

- <span data-ttu-id="44ae3-200">Zobrazit uživatelsky přívětivou zprávu v popisku `ExceptionDetails`</span><span class="sxs-lookup"><span data-stu-id="44ae3-200">Display a user-friendly message in the `ExceptionDetails` Label</span></span>
- <span data-ttu-id="44ae3-201">Označení, že byla výjimka zpracována</span><span class="sxs-lookup"><span data-stu-id="44ae3-201">Indicate that the exception was handled</span></span>
- <span data-ttu-id="44ae3-202">Ponechat řádek GridView v režimu úprav</span><span class="sxs-lookup"><span data-stu-id="44ae3-202">Keep the GridView row in edit mode</span></span>

<span data-ttu-id="44ae3-203">Následující kód dosahuje těchto cílů:</span><span class="sxs-lookup"><span data-stu-id="44ae3-203">This following code accomplishes these objectives:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample5.cs)]

<span data-ttu-id="44ae3-204">Tato obslužná rutina události začíná kontrolou, zda `e.Exception` `null`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-204">This event handler begins by checking to see if `e.Exception` is `null`.</span></span> <span data-ttu-id="44ae3-205">Pokud není, vlastnost `Visible` popisku `ExceptionDetails` je nastavená na `true` a vlastnost `Text` na hodnotu došlo k potížím s aktualizací produktu.</span><span class="sxs-lookup"><span data-stu-id="44ae3-205">If it's not, the `ExceptionDetails` Label's `Visible` property is set to `true` and its `Text` property to "There was a problem updating the product."</span></span> <span data-ttu-id="44ae3-206">Podrobnosti o skutečné výjimce, která byla vyvolána, je uložena ve vlastnosti `InnerException` objektu `e.Exception`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-206">The details of the actual exception that was thrown reside in the `e.Exception` object's `InnerException` property.</span></span> <span data-ttu-id="44ae3-207">Tato vnitřní výjimka je prověřena a pokud má konkrétní typ, připojí se k vlastnosti `Text` `ExceptionDetails` popisku Další, užitečná zpráva.</span><span class="sxs-lookup"><span data-stu-id="44ae3-207">This inner exception is examined and, if it is of a particular type, an additional, helpful message is appended to the `ExceptionDetails` Label's `Text` property.</span></span> <span data-ttu-id="44ae3-208">A konečně vlastnosti `ExceptionHandled` a `KeepInEditMode` jsou nastaveny na `true`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-208">Lastly, the `ExceptionHandled` and `KeepInEditMode` properties are both set to `true`.</span></span>

<span data-ttu-id="44ae3-209">Obrázek 9 ukazuje snímek obrazovky této stránky při vynechání názvu produktu. Obrázek 10 zobrazuje výsledky při zadání neplatné hodnoty `UnitPrice` (-50).</span><span class="sxs-lookup"><span data-stu-id="44ae3-209">Figure 9 shows a screen shot of this page when omitting the name of the product; Figure 10 shows the results when entering an illegal `UnitPrice` value (-50).</span></span>

<span data-ttu-id="44ae3-210">[![NázevVýrobku vlastnost BoundField musí obsahovat hodnotu.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-210">[![The ProductName BoundField Must Contain a Value](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span></span>

<span data-ttu-id="44ae3-211">**Obrázek 9**: `ProductName` vlastnost BoundField musí obsahovat hodnotu ([kliknutím zobrazíte obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png)).</span><span class="sxs-lookup"><span data-stu-id="44ae3-211">**Figure 9**: The `ProductName` BoundField Must Contain a Value ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png))</span></span>

<span data-ttu-id="44ae3-212">[![záporné hodnoty UnitPrice nejsou povolené.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-212">[![Negative UnitPrice Values are Not Allowed](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span></span>

<span data-ttu-id="44ae3-213">**Obrázek 10**: záporné hodnoty `UnitPrice` nejsou povoleny ([kliknutím zobrazíte obrázek v plné velikosti).](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-213">**Figure 10**: Negative `UnitPrice` Values are Not Allowed ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png))</span></span>

<span data-ttu-id="44ae3-214">Nastavením vlastnosti `e.ExceptionHandled` na `true`, obslužná rutina `RowUpdated` události označila, že zpracovala výjimku.</span><span class="sxs-lookup"><span data-stu-id="44ae3-214">By setting the `e.ExceptionHandled` property to `true`, the `RowUpdated` event handler has indicated that it has handled the exception.</span></span> <span data-ttu-id="44ae3-215">Proto výjimka nebude šířit až do modulu runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="44ae3-215">Therefore, the exception won't propagate up to the ASP.NET runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="44ae3-216">Obrázky 9 a 10 znázorňují řádný způsob, jak zpracovat výjimky způsobené neplatným uživatelským vstupem.</span><span class="sxs-lookup"><span data-stu-id="44ae3-216">Figures 9 and 10 show a graceful way to handle exceptions raised due to invalid user input.</span></span> <span data-ttu-id="44ae3-217">V ideálním případě by se tento neplatný vstup nikdy nedostal do vrstvy obchodní logiky na prvním místě, protože před vyvoláním metody `UpdateProduct` `ProductsBLL` třídy by se měla ověřit, jestli jsou vstupy uživatele platné.</span><span class="sxs-lookup"><span data-stu-id="44ae3-217">Ideally, though, such invalid input will never reach the Business Logic Layer in the first place, as the ASP.NET page should ensure that the user's inputs are valid before invoking the `ProductsBLL` class's `UpdateProduct` method.</span></span> <span data-ttu-id="44ae3-218">V našem dalším kurzu se dozvíte, jak přidat ověřovací ovládací prvky do rozhraní pro úpravy a vkládání, aby se zajistilo, že data odeslaná do vrstvy obchodní logiky odpovídají obchodním pravidlům.</span><span class="sxs-lookup"><span data-stu-id="44ae3-218">In our next tutorial we'll see how to add validation controls to the editing and inserting interfaces to ensure that the data submitted to the Business Logic Layer conforms to the business rules.</span></span> <span data-ttu-id="44ae3-219">Ověřování ovládací prvky nebrání pouze vyvolání metody `UpdateProduct`, dokud nejsou platná uživatelem zadaná data, ale také poskytují více informativní uživatelské prostředí pro identifikaci problémů se zadáváním dat.</span><span class="sxs-lookup"><span data-stu-id="44ae3-219">The validation controls not only prevent the invocation of the `UpdateProduct` method until the user-supplied data is valid, but also provide a more informative user experience for identifying data entry problems.</span></span>

## <a name="step-3-gracefully-handling-bll-level-exceptions"></a><span data-ttu-id="44ae3-220">Krok 3: řádné zpracování výjimek na úrovni knihoven BLL</span><span class="sxs-lookup"><span data-stu-id="44ae3-220">Step 3: Gracefully Handling BLL-Level Exceptions</span></span>

<span data-ttu-id="44ae3-221">Při vkládání, aktualizaci nebo odstraňování dat může vrstva přístupu k datům vyvolat výjimku na straně chyby související s daty.</span><span class="sxs-lookup"><span data-stu-id="44ae3-221">When inserting, updating, or deleting data, the Data Access Layer may throw an exception in the face of a data-related error.</span></span> <span data-ttu-id="44ae3-222">Databáze je možná offline, požadovaný sloupec databázové tabulky pravděpodobně nemá zadanou hodnotu nebo omezení na úrovni tabulky bylo porušeno.</span><span class="sxs-lookup"><span data-stu-id="44ae3-222">The database may be offline, a required database table column might not have had a value specified, or a table-level constraint may have been violated.</span></span> <span data-ttu-id="44ae3-223">Kromě striktních výjimek souvisejících s daty může vrstva obchodní logiky použít výjimky, které označují, kdy byla porušena obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="44ae3-223">In addition to strictly data-related exceptions, the Business Logic Layer can use exceptions to indicate when business rules have been violated.</span></span> <span data-ttu-id="44ae3-224">V kurzu [Vytvoření vrstvy obchodní logiky](../introduction/creating-a-business-logic-layer-cs.md) jste například přidali kontrolu obchodního pravidla do původního `UpdateProduct` přetížení.</span><span class="sxs-lookup"><span data-stu-id="44ae3-224">In the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial, for example, we added a business rule check to the original `UpdateProduct` overload.</span></span> <span data-ttu-id="44ae3-225">Konkrétně Pokud uživatel označí produkt jako vyřazený, vyžadujeme, aby tento produkt nebyl jediným poskytovatelem poskytovaným jeho dodavatelem.</span><span class="sxs-lookup"><span data-stu-id="44ae3-225">Specifically, if the user was marking a product as discontinued, we required that the product not be the only one provided by its supplier.</span></span> <span data-ttu-id="44ae3-226">Pokud tato podmínka byla narušena, `ApplicationException` byla vyvolána.</span><span class="sxs-lookup"><span data-stu-id="44ae3-226">If this condition was violated, an `ApplicationException` was thrown.</span></span>

<span data-ttu-id="44ae3-227">Pro `UpdateProduct` přetížení vytvořené v tomto kurzu přidáme obchodní pravidlo, které zabrání nastavení `UnitPrice` pole na novou hodnotu, která je větší než dvojnásobek původní `UnitPrice` hodnoty.</span><span class="sxs-lookup"><span data-stu-id="44ae3-227">For the `UpdateProduct` overload created in this tutorial, let's add a business rule that prohibits the `UnitPrice` field from being set to a new value that's more than twice the original `UnitPrice` value.</span></span> <span data-ttu-id="44ae3-228">Chcete-li toho dosáhnout, upravte `UpdateProduct` přetížení tak, že provede tuto kontrolu a vyvolá `ApplicationException`, pokud je pravidlo porušeno.</span><span class="sxs-lookup"><span data-stu-id="44ae3-228">To accomplish this, adjust the `UpdateProduct` overload so that it performs this check and throws an `ApplicationException` if the rule is violated.</span></span> <span data-ttu-id="44ae3-229">Následující aktualizovaná metoda:</span><span class="sxs-lookup"><span data-stu-id="44ae3-229">The updated method follows:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample6.cs)]

<span data-ttu-id="44ae3-230">Tato změna způsobí, že jakákoli aktualizace ceny, která je více než dvojnásobek stávající ceny, vygeneruje `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-230">With this change, any price update that is more than twice the existing price will cause an `ApplicationException` to be thrown.</span></span> <span data-ttu-id="44ae3-231">Stejně jako výjimka vyvolaná z DAL, tato knihoven BLLá `ApplicationException` může být zjištěna a zpracována v obslužné rutině události `RowUpdated` prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="44ae3-231">Just like the exception raised from the DAL, this BLL-raised `ApplicationException` can be detected and handled in the GridView's `RowUpdated` event handler.</span></span> <span data-ttu-id="44ae3-232">Ve skutečnosti kód obslužné rutiny události `RowUpdated` jako napsaný, správně detekuje tuto výjimku a zobrazí hodnotu vlastnosti `Message` `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="44ae3-232">In fact, the `RowUpdated` event handler's code, as written, will correctly detect this exception and display the `ApplicationException`'s `Message` property value.</span></span> <span data-ttu-id="44ae3-233">Obrázek 11 znázorňuje snímek obrazovky, když se uživatel pokusí aktualizovat cenu hodnoty Chai na $50,00, což je více než dvojnásobek aktuální ceny $19,95.</span><span class="sxs-lookup"><span data-stu-id="44ae3-233">Figure 11 shows a screen shot when a user attempts to update the price of Chai to $50.00, which is more than double its current price of $19.95.</span></span>

<span data-ttu-id="44ae3-234">[![obchodních pravidel zakáže ceny zvýšení ceny za více než dvojnásobek ceny produktu.](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-234">[![The Business Rules Disallow Price Increases That More Than Double a Product's Price](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span></span>

<span data-ttu-id="44ae3-235">**Obrázek 11**: obchodní pravidla neumožňují zvýšení ceny za více než dvojnásobek ceny produktu ([kliknutím zobrazíte obrázek v plné velikosti).](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="44ae3-235">**Figure 11**: The Business Rules Disallow Price Increases That More Than Double a Product's Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png))</span></span>

> [!NOTE]
> <span data-ttu-id="44ae3-236">V ideálním případě by se pravidla obchodní logiky refaktoroval z přetížení `UpdateProduct` metody a do společné metody.</span><span class="sxs-lookup"><span data-stu-id="44ae3-236">Ideally our business logic rules would be refactored out of the `UpdateProduct` method overloads and into a common method.</span></span> <span data-ttu-id="44ae3-237">Tento postup je ponechán jako cvičení pro čtenáře.</span><span class="sxs-lookup"><span data-stu-id="44ae3-237">This is left as an exercise for the reader.</span></span>

## <a name="summary"></a><span data-ttu-id="44ae3-238">Souhrn</span><span class="sxs-lookup"><span data-stu-id="44ae3-238">Summary</span></span>

<span data-ttu-id="44ae3-239">Během vkládání, aktualizace a odstraňování operací se webový ovládací prvek dat i prvek ObjectDataSource účastní událostí před a na úrovni, které zastavují skutečnou operaci.</span><span class="sxs-lookup"><span data-stu-id="44ae3-239">During inserting, updating, and deleting operations, both the data Web control and the ObjectDataSource involved fire pre- and post-level events that bookend the actual operation.</span></span> <span data-ttu-id="44ae3-240">Jak jsme viděli v tomto kurzu a předchozí, při práci s upravitelným ovládacím prvkem GridView `RowUpdating` událost prvku GridView, následovanou událostmi `Updating` elementu ObjectDataSource, v níž je příkaz Update proveden na podkladovém objektu ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="44ae3-240">As we saw in this tutorial and the preceding one, when working with an editable GridView the GridView's `RowUpdating` event fires, followed by the ObjectDataSource's `Updating` event, at which point the update command is made to the ObjectDataSource's underlying object.</span></span> <span data-ttu-id="44ae3-241">Po dokončení operace se aktivuje událost `Updated` ObjectDataSource a za ní následuje událost `RowUpdated` prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="44ae3-241">After the operation has completed, the ObjectDataSource's `Updated` event fires, followed by the GridView's `RowUpdated` event.</span></span>

<span data-ttu-id="44ae3-242">Můžeme vytvořit obslužné rutiny událostí pro události před úrovní, aby bylo možné přizpůsobit vstupní parametry nebo události na úrovni po, aby bylo možné kontrolovat výsledky operace a reagovat na ně.</span><span class="sxs-lookup"><span data-stu-id="44ae3-242">We can create event handlers for the pre-level events in order to customize the input parameters or for the post-level events in order to inspect and respond to the operation's results.</span></span> <span data-ttu-id="44ae3-243">Obslužné rutiny události po úrovni se nejčastěji používají k detekci, zda během operace došlo k výjimce.</span><span class="sxs-lookup"><span data-stu-id="44ae3-243">Post-level event handlers are most commonly used to detect whether an exception occurred during the operation.</span></span> <span data-ttu-id="44ae3-244">Na přední straně výjimky mohou tyto obslužné rutiny události na úrovni, volitelně zpracovat výjimku na své vlastní.</span><span class="sxs-lookup"><span data-stu-id="44ae3-244">In the face of an exception, these post-level event handlers can optionally handle the exception on their own.</span></span> <span data-ttu-id="44ae3-245">V tomto kurzu jsme zjistili, jak takovou výjimku zvládnout zobrazením popisné chybové zprávy.</span><span class="sxs-lookup"><span data-stu-id="44ae3-245">In this tutorial we saw how to handle such an exception by displaying a friendly error message.</span></span>

<span data-ttu-id="44ae3-246">V dalším kurzu se dozvíte, jak snížit pravděpodobnost výjimek vyplývajících z potíží s formátováním dat (například zadáním záporné `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="44ae3-246">In the next tutorial we'll see how to lessen the likelihood of exceptions arising from data formatting issues (such as entering a negative `UnitPrice`).</span></span> <span data-ttu-id="44ae3-247">Konkrétně se podíváme na postup přidání ověřovacích ovládacích prvků do rozhraní pro úpravy a vkládání.</span><span class="sxs-lookup"><span data-stu-id="44ae3-247">Specifically, we'll look at how to add validation controls to the editing and inserting interfaces.</span></span>

<span data-ttu-id="44ae3-248">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="44ae3-248">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="44ae3-249">O autorovi</span><span class="sxs-lookup"><span data-stu-id="44ae3-249">About the Author</span></span>

<span data-ttu-id="44ae3-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor 7 ASP/ASP. NET Books a zakladatel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="44ae3-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="44ae3-251">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="44ae3-251">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="44ae3-252">Nejnovější kniha je [*Sams naučit se ASP.NET 2,0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="44ae3-252">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="44ae3-253">Dá se získat na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="44ae3-253">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="44ae3-254">nebo prostřednictvím svého blogu, který najdete na adrese [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="44ae3-254">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="44ae3-255">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="44ae3-255">Special Thanks To</span></span>

<span data-ttu-id="44ae3-256">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="44ae3-256">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="44ae3-257">Kontrolor pro tento kurz byl Liz Shulok.</span><span class="sxs-lookup"><span data-stu-id="44ae3-257">Lead reviewer for this tutorial was Liz Shulok.</span></span> <span data-ttu-id="44ae3-258">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="44ae3-258">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="44ae3-259">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="44ae3-259">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="44ae3-260">[Předchozí](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
> [Další](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span><span class="sxs-lookup"><span data-stu-id="44ae3-260">[Previous](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
[Next](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span></span>
