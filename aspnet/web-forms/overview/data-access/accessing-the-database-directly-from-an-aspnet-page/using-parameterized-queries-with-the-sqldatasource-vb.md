---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
title: Použití parametrizovaných dotazů ve třídě SqlDataSource (VB) | Microsoft Docs
author: rick-anderson
description: V tomto kurzu budeme pokračovat v hledání na ovládacím prvku SqlDataSource a naučíte se, jak definovat parametrizované dotazy. Parametry lze zadat současně deklaraci...
ms.author: riande
ms.date: 02/20/2007
ms.assetid: e322f34c-83b7-41ea-ab65-ab1e0bdcc609
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: 19b93ff6c0878ae6ed546d347cafef95fd2a01e6
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/28/2019
ms.locfileid: "74598045"
---
# <a name="using-parameterized-queries-with-the-sqldatasource-vb"></a><span data-ttu-id="a5b31-104">Použití parametrizovaných dotazů s ovládacím prvkem SqlDataSource (VB)</span><span class="sxs-lookup"><span data-stu-id="a5b31-104">Using Parameterized Queries with the SqlDataSource (VB)</span></span>

<span data-ttu-id="a5b31-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a5b31-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a5b31-106">[Stáhnout ukázkovou aplikaci](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe) nebo [Stáhnout PDF](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a5b31-106">[Download Sample App](https://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe) or [Download PDF](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span></span>

> <span data-ttu-id="a5b31-107">V tomto kurzu budeme pokračovat v hledání na ovládacím prvku SqlDataSource a naučíte se, jak definovat parametrizované dotazy.</span><span class="sxs-lookup"><span data-stu-id="a5b31-107">In this tutorial, we continue our look at the SqlDataSource control and learn how to define parameterized queries.</span></span> <span data-ttu-id="a5b31-108">Parametry lze zadat deklarativně i programově a lze je načíst z několika umístění, jako je například QueryString, stav relace, další ovládací prvky a další.</span><span class="sxs-lookup"><span data-stu-id="a5b31-108">The parameters can be specified both declaratively and programmatically, and can be pulled from a number of locations such as the querystring, Session state, other controls, and more.</span></span>

## <a name="introduction"></a><span data-ttu-id="a5b31-109">Úvod</span><span class="sxs-lookup"><span data-stu-id="a5b31-109">Introduction</span></span>

<span data-ttu-id="a5b31-110">V předchozím kurzu jsme viděli, jak použít ovládací prvek SqlDataSource k načtení dat přímo z databáze.</span><span class="sxs-lookup"><span data-stu-id="a5b31-110">In the previous tutorial we saw how to use the SqlDataSource control to retrieve data directly from a database.</span></span> <span data-ttu-id="a5b31-111">Pomocí Průvodce konfigurací zdroje dat můžeme zvolit databázi a potom buď: Vyberte sloupce, které se mají vrátit z tabulky nebo zobrazení. Zadejte vlastní příkaz SQL. nebo použijte uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="a5b31-111">Using the Configure Data Source wizard, we could choose the database and then either: pick the columns to return from a table or view; enter a custom SQL statement; or use a stored procedure.</span></span> <span data-ttu-id="a5b31-112">Bez ohledu na `SELECT` to, jestli se mají vybrat sloupce z tabulky nebo zobrazit nebo zadat vlastní příkaz SQL, se vlastnosti `SelectCommand` ovládacího prvku SqlDataSource přiřadí Výsledný příkaz SQL `SELECT`, který se spustí při vyvolání metody `Select()` SqlDataSource (buď prostřednictvím kódu programu, nebo automaticky z webového ovládacího prvku data).</span><span class="sxs-lookup"><span data-stu-id="a5b31-112">Whether selecting columns from a table or view or entering a custom SQL statement, the SqlDataSource control s `SelectCommand` property is assigned the resulting ad-hoc SQL `SELECT` statement and it is this `SELECT` statement that is executed when the SqlDataSource s `Select()` method is invoked (either programmatically or automatically from a data Web control).</span></span>

<span data-ttu-id="a5b31-113">Příkazy SQL `SELECT` používané v předchozích ukázkách kurzu s chybí `WHERE` klauzulí.</span><span class="sxs-lookup"><span data-stu-id="a5b31-113">The SQL `SELECT` statements used in the previous tutorial s demos lacked `WHERE` clauses.</span></span> <span data-ttu-id="a5b31-114">V příkazu `SELECT` lze použít klauzuli `WHERE` k omezení vrácených výsledků.</span><span class="sxs-lookup"><span data-stu-id="a5b31-114">In a `SELECT` statement, the `WHERE` clause can be used to limit the results returned.</span></span> <span data-ttu-id="a5b31-115">Pokud například chcete zobrazit názvy produktů více než $50,00, můžeme použít následující dotaz:</span><span class="sxs-lookup"><span data-stu-id="a5b31-115">For example, to display the names of products costing more than $50.00, we could use the following query:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="a5b31-116">Hodnoty používané v klauzuli `WHERE` se obvykle určují pomocí některého externího zdroje, jako je například hodnota QueryString, proměnná relace nebo vstup uživatele z webového ovládacího prvku na stránce.</span><span class="sxs-lookup"><span data-stu-id="a5b31-116">Typically, the values used in a `WHERE` clause are determine by some external source, such as a querystring value, a session variable, or user input from a Web control on the page.</span></span> <span data-ttu-id="a5b31-117">V ideálním případě jsou tyto vstupy zadány pomocí *parametrů*.</span><span class="sxs-lookup"><span data-stu-id="a5b31-117">Ideally, such inputs are specified through the use of *parameters*.</span></span> <span data-ttu-id="a5b31-118">U Microsoft SQL Server jsou parametry označeny pomocí `@parameterName`, jako v:</span><span class="sxs-lookup"><span data-stu-id="a5b31-118">With Microsoft SQL Server, parameters are denoted using `@parameterName`, as in:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample2.sql)]

<span data-ttu-id="a5b31-119">Třída SqlDataSource podporuje parametrizované dotazy, pro `SELECT` příkazy a `INSERT`, `UPDATE`a `DELETE` příkazy.</span><span class="sxs-lookup"><span data-stu-id="a5b31-119">The SqlDataSource supports parameterized queries, both for `SELECT` statements and `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="a5b31-120">Hodnoty parametrů je navíc možné automaticky načíst z nejrůznějších zdrojů. QueryString, stav relace, ovládací prvky na stránce a tak dále lze přiřadit programově.</span><span class="sxs-lookup"><span data-stu-id="a5b31-120">Moreover, the parameter values can be automatically pulled from a variety of sources the querystring, session state, controls on the page, and so on or can be assigned programmatically.</span></span> <span data-ttu-id="a5b31-121">V tomto kurzu se dozvíte, jak definovat parametrizované dotazy a jak deklarativně i programově zadat hodnoty parametrů.</span><span class="sxs-lookup"><span data-stu-id="a5b31-121">In this tutorial, we'll see how to define parameterized queries as well as how to specify the parameter values both declaratively and programmatically.</span></span>

> [!NOTE]
> <span data-ttu-id="a5b31-122">V předchozím kurzu jsme porovnali prvek ObjectDataSource, který je nášm nástrojem, který je v prvních 46 kurzech, který se nachází ve třídě SqlDataSource a označuje jejich koncepční podobnosti.</span><span class="sxs-lookup"><span data-stu-id="a5b31-122">In the previous tutorial we compared the ObjectDataSource which has been our tool of choice over the first 46 tutorials with the SqlDataSource, noting their conceptual similarities.</span></span> <span data-ttu-id="a5b31-123">Tyto podobnosti se také rozšíří na parametry.</span><span class="sxs-lookup"><span data-stu-id="a5b31-123">These similarities also extend to parameters.</span></span> <span data-ttu-id="a5b31-124">Parametry ObjectDataSource s mapované na vstupní parametry pro metody ve vrstvě obchodní logiky.</span><span class="sxs-lookup"><span data-stu-id="a5b31-124">The ObjectDataSource s parameters mapped to the input parameters for the methods in the Business Logic Layer.</span></span> <span data-ttu-id="a5b31-125">Pomocí SqlDataSource jsou parametry definovány přímo v rámci dotazu SQL.</span><span class="sxs-lookup"><span data-stu-id="a5b31-125">With the SqlDataSource, the parameters are defined directly within the SQL query.</span></span> <span data-ttu-id="a5b31-126">Oba ovládací prvky mají kolekce parametrů pro jejich `Select()`, `Insert()`, `Update()`a metody `Delete()` a obě můžou mít tyto hodnoty parametrů naplněné z předdefinovaných zdrojů (hodnoty QueryString, proměnné relace atd.) nebo přiřazené programově.</span><span class="sxs-lookup"><span data-stu-id="a5b31-126">Both controls have collections of parameters for their `Select()`, `Insert()`, `Update()`, and `Delete()` methods, and both can have these parameter values populated from pre-defined sources (querystring values, session variables, and so on) or assigned programmatically.</span></span>

## <a name="creating-a-parameterized-query"></a><span data-ttu-id="a5b31-127">Vytvoření parametrického dotazu</span><span class="sxs-lookup"><span data-stu-id="a5b31-127">Creating a Parameterized Query</span></span>

<span data-ttu-id="a5b31-128">Průvodce pro ovládací prvek SqlDataSource s konfigurací zdroje dat nabízí tři cesty vedoucíy pro definování příkazu, který se má provést pro načtení záznamů databáze:</span><span class="sxs-lookup"><span data-stu-id="a5b31-128">The SqlDataSource control s Configure Data Source wizard offers three avenues for defining the command to execute to retrieve database records:</span></span>

- <span data-ttu-id="a5b31-129">Když vybíráte sloupce z existující tabulky nebo zobrazení,</span><span class="sxs-lookup"><span data-stu-id="a5b31-129">By picking the columns from an existing table or view,</span></span>
- <span data-ttu-id="a5b31-130">Zadáním vlastního příkazu SQL nebo</span><span class="sxs-lookup"><span data-stu-id="a5b31-130">By entering a custom SQL statement, or</span></span>
- <span data-ttu-id="a5b31-131">Výběrem uložené procedury</span><span class="sxs-lookup"><span data-stu-id="a5b31-131">By choosing a stored procedure</span></span>

<span data-ttu-id="a5b31-132">Když vybíráte sloupce z existující tabulky nebo zobrazení, parametry klauzule `WHERE` musí být zadány pomocí dialogového okna Přidat `WHERE` klauzuli.</span><span class="sxs-lookup"><span data-stu-id="a5b31-132">When picking columns from an existing table or view, the parameters for the `WHERE` clause must be specified through the Add `WHERE` Clause dialog box.</span></span> <span data-ttu-id="a5b31-133">Při vytváření vlastního příkazu SQL však můžete zadat parametry přímo do klauzule `WHERE` (pomocí `@parameterName` pro označení každého parametru).</span><span class="sxs-lookup"><span data-stu-id="a5b31-133">When creating a custom SQL statement, however, you can enter the parameters directly into the `WHERE` clause (using `@parameterName` to denote each parameter).</span></span> <span data-ttu-id="a5b31-134">[Uložená procedura](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) se skládá z jednoho nebo více příkazů SQL a tyto příkazy mohou být parametrizované.</span><span class="sxs-lookup"><span data-stu-id="a5b31-134">A [stored procedure](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consists of one or more SQL statements, and these statements can be parameterized.</span></span> <span data-ttu-id="a5b31-135">Parametry použité v příkazech jazyka SQL však musí být předány jako vstupní parametry do uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="a5b31-135">The parameters used in the SQL statements, however, must be passed in as input parameters to the stored procedure.</span></span>

<span data-ttu-id="a5b31-136">Vzhledem k tomu, že vytvoření parametrizovaného dotazu závisí na tom, jak je `SelectCommand` SqlDataSource, se můžeme podívat na všechny tři přístupy.</span><span class="sxs-lookup"><span data-stu-id="a5b31-136">Since creating a parameterized query depends on how the SqlDataSource s `SelectCommand` is specified, let s take a look at all three approaches.</span></span> <span data-ttu-id="a5b31-137">Chcete-li začít, otevřete stránku `ParameterizedQueries.aspx` ve složce `SqlDataSource`, přetáhněte ovládací prvek SqlDataSource ze sady nástrojů do návrháře a nastavte jeho `ID` na `Products25BucksAndUnderDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-137">To get started, open the `ParameterizedQueries.aspx` page in the `SqlDataSource` folder, drag a SqlDataSource control from the Toolbox onto the Designer, and set its `ID` to `Products25BucksAndUnderDataSource`.</span></span> <span data-ttu-id="a5b31-138">Potom klikněte na odkaz konfigurace zdroje dat z inteligentní značky Control s.</span><span class="sxs-lookup"><span data-stu-id="a5b31-138">Next, click the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="a5b31-139">Vyberte databázi, kterou chcete použít (`NORTHWINDConnectionString`) a klikněte na další.</span><span class="sxs-lookup"><span data-stu-id="a5b31-139">Select the database to use (`NORTHWINDConnectionString`) and click Next.</span></span>

## <a name="step-1-adding-awhereclause-when-picking-the-columns-from-a-table-or-view"></a><span data-ttu-id="a5b31-140">Krok 1: Přidání klauzule`WHERE`při výběru sloupců z tabulky nebo zobrazení</span><span class="sxs-lookup"><span data-stu-id="a5b31-140">Step 1: Adding a`WHERE`Clause When Picking the Columns from a Table or View</span></span>

<span data-ttu-id="a5b31-141">Když vyberete data, která se mají vrátit z databáze pomocí ovládacího prvku SqlDataSource, Průvodce konfigurací zdroje dat nám umožní jednoduše vybrat sloupce, které se vrátí z existující tabulky nebo zobrazení (viz obrázek 1).</span><span class="sxs-lookup"><span data-stu-id="a5b31-141">When selecting the data to return from the database with the SqlDataSource control, the Configure Data Source wizard allows us to simply pick the columns to return from an existing table or view (see Figure 1).</span></span> <span data-ttu-id="a5b31-142">Tím se automaticky vytvoří příkaz SQL `SELECT`, který je odeslán do databáze při vyvolání metody SqlDataSource s `Select()`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-142">Doing so automatically builds up a SQL `SELECT` statement, which is what is sent to the database when the SqlDataSource s `Select()` method is invoked.</span></span> <span data-ttu-id="a5b31-143">Stejně jako v předchozím kurzu vyberte v rozevíracím seznamu tabulku Products a zaškrtněte sloupce `ProductID`, `ProductName`a `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-143">As we did in the previous tutorial, select the Products table from the drop-down list and check the `ProductID`, `ProductName`, and `UnitPrice` columns.</span></span>

<span data-ttu-id="a5b31-144">[![vybrat sloupce, které se mají vrátit z tabulky nebo zobrazení](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-144">[![Pick the Columns to Return from a Table or View](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="a5b31-145">**Obrázek 1**: Vyberte sloupce, které se mají vrátit z tabulky nebo zobrazení ([kliknutím zobrazíte obrázek v plné velikosti](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png)).</span><span class="sxs-lookup"><span data-stu-id="a5b31-145">**Figure 1**: Pick the Columns to Return from a Table or View ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png))</span></span>

<span data-ttu-id="a5b31-146">Chcete-li do příkazu `SELECT` zahrnout klauzuli `WHERE`, klikněte na tlačítko `WHERE`, které vyvolá dialogové okno Přidat `WHERE` klauzuli (viz obrázek 2).</span><span class="sxs-lookup"><span data-stu-id="a5b31-146">To include a `WHERE` clause in the `SELECT` statement, click the `WHERE` button, which brings up the Add `WHERE` Clause dialog box (see Figure 2).</span></span> <span data-ttu-id="a5b31-147">Chcete-li přidat parametr pro omezení výsledků vrácených dotazem `SELECT`, nejprve vyberte sloupec, podle kterého chcete data filtrovat.</span><span class="sxs-lookup"><span data-stu-id="a5b31-147">To add a parameter to limit the results returned by the `SELECT` query, first choose the column to filter the data by.</span></span> <span data-ttu-id="a5b31-148">Dále vyberte operátor, který se má použít pro filtrování (=, &lt;, &lt;=, &gt;atd.).</span><span class="sxs-lookup"><span data-stu-id="a5b31-148">Next, choose the operator to use for filtering (=, &lt;, &lt;=, &gt;, and so on).</span></span> <span data-ttu-id="a5b31-149">Nakonec vyberte zdroj hodnoty parametru s, například ze stavu QueryString nebo relace.</span><span class="sxs-lookup"><span data-stu-id="a5b31-149">Finally, choose the source of the parameter s value, such as from the querystring or session state.</span></span> <span data-ttu-id="a5b31-150">Po nakonfigurování parametru klikněte na tlačítko Přidat a zahrňte ho do `SELECT`ového dotazu.</span><span class="sxs-lookup"><span data-stu-id="a5b31-150">After configuring the parameter, click the Add button to include it in the `SELECT` query.</span></span>

<span data-ttu-id="a5b31-151">V tomto příkladu vrátíme pouze výsledky, kde `UnitPrice` hodnota je menší nebo rovna $25,00.</span><span class="sxs-lookup"><span data-stu-id="a5b31-151">For this example, let s only return those results where the `UnitPrice` value is less than or equal to $25.00.</span></span> <span data-ttu-id="a5b31-152">Proto vyberte `UnitPrice` z rozevíracího seznamu sloupec a &lt;= v rozevíracím seznamu operátor.</span><span class="sxs-lookup"><span data-stu-id="a5b31-152">Therefore, pick `UnitPrice` from the Column drop-down list and &lt;= from the Operator drop-down list.</span></span> <span data-ttu-id="a5b31-153">Při použití pevně zakódované hodnoty parametru (například $25,00) nebo pokud má být hodnota parametru zadána programově, vyberte v rozevíracím seznamu zdroj možnost žádná.</span><span class="sxs-lookup"><span data-stu-id="a5b31-153">When using a hard-coded parameter value (such as $25.00) or if the parameter value is to be specified programmatically, select None from the Source drop-down list.</span></span> <span data-ttu-id="a5b31-154">Potom do textového pole hodnota 25,00 zadejte pevně zakódovaný parametr a kliknutím na tlačítko Přidat proces dokončete.</span><span class="sxs-lookup"><span data-stu-id="a5b31-154">Next, enter the hard-coded parameter value in the Value textbox 25.00 and complete the process by clicking the Add button.</span></span>

<span data-ttu-id="a5b31-155">[![omezit výsledky vrácené z dialogového okna Přidat klauzuli WHERE](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-155">[![Limit the Results Returned from the Add WHERE Clause Dialog Box](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="a5b31-156">**Obrázek 2**: omezení výsledků vrácených z dialogového okna přidat klauzuli `WHERE` ([kliknutím zobrazíte obrázek v plné velikosti](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="a5b31-156">**Figure 2**: Limit the Results Returned from the Add `WHERE` Clause Dialog Box ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span></span>

<span data-ttu-id="a5b31-157">Po přidání parametru se kliknutím na tlačítko OK vraťte do Průvodce konfigurací zdroje dat.</span><span class="sxs-lookup"><span data-stu-id="a5b31-157">After adding the parameter, click OK to return to the Configure Data Source wizard.</span></span> <span data-ttu-id="a5b31-158">Příkaz `SELECT` v dolní části Průvodce by teď měl obsahovat klauzuli `WHERE` s parametrem s názvem `@UnitPrice`:</span><span class="sxs-lookup"><span data-stu-id="a5b31-158">The `SELECT` statement at the bottom of the wizard should now include a `WHERE` clause with a parameter named `@UnitPrice`:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample3.sql)]

> [!NOTE]
> <span data-ttu-id="a5b31-159">Pokud v klauzuli `WHERE` zadáte v dialogovém okně Přidat `WHERE` klauzuli více podmínek, průvodce je spojí s operátorem `AND`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-159">If you specify multiple conditions in the `WHERE` clause from the Add `WHERE` Clause dialog box, the wizard joins them with the `AND` operator.</span></span> <span data-ttu-id="a5b31-160">Pokud potřebujete zahrnout `OR` do klauzule `WHERE` (například `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`), musíte vytvořit `SELECT` příkaz pomocí vlastní obrazovky příkazů SQL.</span><span class="sxs-lookup"><span data-stu-id="a5b31-160">If you need to include an `OR` in the `WHERE` clause (such as `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) then you have to build the `SELECT` statement through the custom SQL statement screen.</span></span>

<span data-ttu-id="a5b31-161">Dokončete konfiguraci značky SqlDataSource (klikněte na tlačítko Další a pak na Dokončit) a pak zkontrolujte deklarativní označení SqlDataSource s.</span><span class="sxs-lookup"><span data-stu-id="a5b31-161">Complete configuring the SqlDataSource (click Next, then Finish) and then inspect the SqlDataSource s declarative markup.</span></span> <span data-ttu-id="a5b31-162">Značka nyní obsahuje kolekci `<SelectParameters>`, která vypíše zdroje pro parametry v `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-162">The markup now includes a `<SelectParameters>` collection, which spells out the sources for the parameters in the `SelectCommand`.</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample4.aspx)]

<span data-ttu-id="a5b31-163">Při vyvolání metody `Select()` SqlDataSource, je před odesláním do databáze v `SelectCommand` `@UnitPrice` použita hodnota parametru `UnitPrice` (25,00).</span><span class="sxs-lookup"><span data-stu-id="a5b31-163">When the SqlDataSource s `Select()` method is invoked, the `UnitPrice` parameter value (25.00) is applied to the `@UnitPrice` parameter in the `SelectCommand` before being sent to the database.</span></span> <span data-ttu-id="a5b31-164">Výsledkem je, že v `Products` tabulce jsou vráceny pouze ty produkty menší nebo rovny $25,00.</span><span class="sxs-lookup"><span data-stu-id="a5b31-164">The net result is that only those products less than or equal to $25.00 are returned from the `Products` table.</span></span> <span data-ttu-id="a5b31-165">Potvrďte to tak, že na stránku přidáte prvek GridView, svážete ho s tímto zdrojem dat a pak tuto stránku zobrazíte v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="a5b31-165">To confirm this, add a GridView to the page, bind it to this data source, and then view the page through a browser.</span></span> <span data-ttu-id="a5b31-166">Měli byste vidět jenom ty produkty, které jsou uvedené v seznamu, který je menší nebo roven $25,00, jak obrázek 3 potvrdí.</span><span class="sxs-lookup"><span data-stu-id="a5b31-166">You should only see those products listed that are less than or equal to $25.00, as Figure 3 confirms.</span></span>

<span data-ttu-id="a5b31-167">[![se zobrazí jenom ty produkty, které jsou menší nebo rovny $25,00.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-167">[![Only Those Products Less Than or Equal to $25.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="a5b31-168">**Obrázek 3**: zobrazuje se jenom tento počet produktů, které jsou menší nebo rovny $25,00 ([kliknutím zobrazíte obrázek v plné velikosti).](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-168">**Figure 3**: Only Those Products Less Than or Equal to $25.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png))</span></span>

## <a name="step-2-adding-parameters-to-a-custom-sql-statement"></a><span data-ttu-id="a5b31-169">Krok 2: Přidání parametrů do vlastního příkazu SQL</span><span class="sxs-lookup"><span data-stu-id="a5b31-169">Step 2: Adding Parameters to a Custom SQL Statement</span></span>

<span data-ttu-id="a5b31-170">Při přidávání vlastního příkazu SQL můžete zadat klauzuli `WHERE` explicitně nebo zadat hodnotu do buňky filtru Tvůrce dotazů.</span><span class="sxs-lookup"><span data-stu-id="a5b31-170">When adding a custom SQL statement you can enter the `WHERE` clause explicitly or specify a value in the Filter cell of the Query Builder.</span></span> <span data-ttu-id="a5b31-171">K tomu je možné Ukázat, že se zobrazí pouze tyto produkty v prvku GridView, jejichž ceny jsou nižší než určitá prahová hodnota.</span><span class="sxs-lookup"><span data-stu-id="a5b31-171">To demonstrate this, let s display just those products in a GridView whose prices are less than a certain threshold.</span></span> <span data-ttu-id="a5b31-172">Začněte přidáním textového pole na stránku `ParameterizedQueries.aspx`, aby se tato prahová hodnota z uživatele shromáždila.</span><span class="sxs-lookup"><span data-stu-id="a5b31-172">Start by adding a TextBox to the `ParameterizedQueries.aspx` page to collect this threshold value from the user.</span></span> <span data-ttu-id="a5b31-173">Nastavte vlastnost TextBox s `ID` na `MaxPrice`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-173">Set the TextBox s `ID` property to `MaxPrice`.</span></span> <span data-ttu-id="a5b31-174">Přidejte webový ovládací prvek tlačítko a nastavte jeho vlastnost `Text`, aby se zobrazily odpovídající produkty.</span><span class="sxs-lookup"><span data-stu-id="a5b31-174">Add a Button Web control and set its `Text` property to Display Matching Products .</span></span>

<span data-ttu-id="a5b31-175">Dále přetáhněte prvek GridView na stránku a z jeho inteligentní značky vyberte, chcete-li vytvořit novou SqlDataSource s názvem `ProductsFilteredByPriceDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-175">Next, drag a GridView onto the page and from its smart tag choose to create a new SqlDataSource named `ProductsFilteredByPriceDataSource`.</span></span> <span data-ttu-id="a5b31-176">V Průvodci konfigurací zdroje dat přejděte na obrazovku zadat vlastní příkaz SQL nebo uloženou proceduru (viz obrázek 4) a zadejte následující dotaz:</span><span class="sxs-lookup"><span data-stu-id="a5b31-176">From the Configure Data Source wizard, proceed to the Specify a custom SQL statement or stored procedure screen (see Figure 4) and enter the following query:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample5.sql)]

<span data-ttu-id="a5b31-177">Po zadání dotazu (buď ručně nebo prostřednictvím Tvůrce dotazů) klikněte na další.</span><span class="sxs-lookup"><span data-stu-id="a5b31-177">After entering the query (either manually or through the Query Builder), click Next.</span></span>

<span data-ttu-id="a5b31-178">[![vrátit pouze ty produkty, které jsou menší nebo rovny hodnotě parametru](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-178">[![Return Only Those Products Less Than or Equal to a Parameter Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="a5b31-179">**Obrázek 4**: vrácení pouze těch produktů, které jsou menší nebo rovny hodnotě parametru ([kliknutím zobrazíte obrázek v plné velikosti](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="a5b31-179">**Figure 4**: Return Only Those Products Less Than or Equal to a Parameter Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span></span>

<span data-ttu-id="a5b31-180">Vzhledem k tomu, že dotaz obsahuje parametry, zobrazí další obrazovka v průvodci nápovědu pro zdroj hodnot parametrů.</span><span class="sxs-lookup"><span data-stu-id="a5b31-180">Since the query includes parameters, the next screen in the wizard prompts us for the source of the parameters values.</span></span> <span data-ttu-id="a5b31-181">Z rozevíracího seznamu zdroj parametrů vyberte ovládací prvek a `MaxPrice` (ovládací prvek TextBox s `ID` hodnota) z rozevíracího seznamu ControlID.</span><span class="sxs-lookup"><span data-stu-id="a5b31-181">Choose Control from the Parameter source drop-down list and `MaxPrice` (the TextBox control s `ID` value) from the ControlID drop-down list.</span></span> <span data-ttu-id="a5b31-182">Můžete také zadat volitelnou výchozí hodnotu, která se použije v případě, že uživatel nezadal žádný text do textového pole `MaxPrice`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-182">You can also enter an optional default value to use in the case where the user has not entered any text into the `MaxPrice` TextBox.</span></span> <span data-ttu-id="a5b31-183">V tomto časovém období nezadávejte výchozí hodnotu.</span><span class="sxs-lookup"><span data-stu-id="a5b31-183">For the time being, do not enter a default value.</span></span>

<span data-ttu-id="a5b31-184">[![vlastnost text TextBox MaxPrice s textem se používá jako zdroj parametru.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-184">[![The MaxPrice TextBox s Text Property is Used as the Parameter Source](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="a5b31-185">**Obrázek 5**: vlastnost `MaxPrice` TextBox s `Text` se používá jako zdroj parametru ([kliknutím zobrazíte obrázek v plné velikosti).](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-185">**Figure 5**: The `MaxPrice` TextBox s `Text` Property is Used as the Parameter Source ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png))</span></span>

<span data-ttu-id="a5b31-186">Dokončete Průvodce konfigurací zdroje dat kliknutím na tlačítko Další a potom na Dokončit.</span><span class="sxs-lookup"><span data-stu-id="a5b31-186">Complete the Configure Data Source wizard by clicking Next, then Finish.</span></span> <span data-ttu-id="a5b31-187">Následuje deklarativní označení pro prvek GridView, TextBox, Button a SqlDataSource:</span><span class="sxs-lookup"><span data-stu-id="a5b31-187">The declarative markup for the GridView, TextBox, Button, and SqlDataSource follows:</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample6.aspx)]

<span data-ttu-id="a5b31-188">Všimněte si, že parametr v sekci `<SelectParameters>` SqlDataSource je `ControlParameter`, která zahrnuje další vlastnosti, jako je `ControlID` a `PropertyName`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-188">Note that the parameter within the SqlDataSource s `<SelectParameters>` section is a `ControlParameter`, which includes additional properties like `ControlID` and `PropertyName`.</span></span> <span data-ttu-id="a5b31-189">Když je vyvolána metoda `Select()` SqlDataSource, `ControlParameter` převede hodnotu ze zadané vlastnosti ovládacího prvku web a přiřadí ji k odpovídajícímu parametru v `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-189">When the SqlDataSource s `Select()` method is invoked, the `ControlParameter` grabs the value from the specified Web control property and assigns it to the corresponding parameter in the `SelectCommand`.</span></span> <span data-ttu-id="a5b31-190">V tomto příkladu se jako hodnota parametru `@MaxPrice` používá vlastnost text `MaxPrice` s.</span><span class="sxs-lookup"><span data-stu-id="a5b31-190">In this example, the `MaxPrice` s Text property is used as the `@MaxPrice` parameter value.</span></span>

<span data-ttu-id="a5b31-191">Tuto stránku si můžete zobrazit pomocí prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="a5b31-191">Take a minute to view this page through a browser.</span></span> <span data-ttu-id="a5b31-192">Při první návštěvě stránky nebo pokaždé, když `MaxPrice` textového pole chybí hodnota, se v prvku GridView zobrazí žádné záznamy.</span><span class="sxs-lookup"><span data-stu-id="a5b31-192">When first visiting the page or whenever the `MaxPrice` TextBox lacks a value no records are displayed in the GridView.</span></span>

<span data-ttu-id="a5b31-193">[Když je textové pole MaxPrice prázdné, neobjeví se žádné záznamy. ![](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-193">[![No Records are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="a5b31-194">**Obrázek 6**: když je textové pole `MaxPrice` prázdné ([kliknutím zobrazíte obrázek v plné velikosti](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png)), nezobrazí se žádné záznamy.</span><span class="sxs-lookup"><span data-stu-id="a5b31-194">**Figure 6**: No Records are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png))</span></span>

<span data-ttu-id="a5b31-195">Důvod, proč nejsou zobrazeny žádné produkty, je, že ve výchozím nastavení je prázdný řetězec pro hodnotu parametru převeden na hodnotu `NULL` databáze.</span><span class="sxs-lookup"><span data-stu-id="a5b31-195">The reason no products are shown is because, by default, an empty string for a parameter value is converted into a database `NULL` value.</span></span> <span data-ttu-id="a5b31-196">Vzhledem k tomu, že se porovnání `[UnitPrice] <= NULL` vždy vyhodnocuje jako false, nejsou vráceny žádné výsledky.</span><span class="sxs-lookup"><span data-stu-id="a5b31-196">Since the comparison of `[UnitPrice] <= NULL` always evaluates as False, no results are returned.</span></span>

<span data-ttu-id="a5b31-197">Do textového pole zadejte hodnotu, třeba 5,00, a klikněte na tlačítko Zobrazit porovnání produktů.</span><span class="sxs-lookup"><span data-stu-id="a5b31-197">Enter a value into the textbox, like 5.00, and click the Display Matching Products button.</span></span> <span data-ttu-id="a5b31-198">Při zpětném volání, třída SqlDataSource informuje prvek GridView, že došlo ke změně některého z jeho zdrojů parametrů.</span><span class="sxs-lookup"><span data-stu-id="a5b31-198">On postback, the SqlDataSource informs the GridView that one of its parameter sources has changed.</span></span> <span data-ttu-id="a5b31-199">V důsledku toho se prvek GridView znovu připojí ke třídě SqlDataSource a zobrazí tyto produkty menší nebo rovny $5,00.</span><span class="sxs-lookup"><span data-stu-id="a5b31-199">Consequently, the GridView rebinds to the SqlDataSource, displaying those products less than or equal to $5.00.</span></span>

<span data-ttu-id="a5b31-200">[Zobrazí se ![é produkty menší nebo rovny $5,00.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-200">[![Products Less Than or Equal to $5.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span></span>

<span data-ttu-id="a5b31-201">**Obrázek 7**: zobrazí se produkty, které jsou menší nebo rovny $5,00 ([kliknutím zobrazíte obrázek v plné velikosti).](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-201">**Figure 7**: Products Less Than or Equal to $5.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png))</span></span>

## <a name="initially-displaying-all-products"></a><span data-ttu-id="a5b31-202">Počáteční zobrazení všech produktů</span><span class="sxs-lookup"><span data-stu-id="a5b31-202">Initially Displaying All Products</span></span>

<span data-ttu-id="a5b31-203">Místo zobrazování žádného produktu při prvním načtení stránky můžeme zobrazit *všechny* produkty.</span><span class="sxs-lookup"><span data-stu-id="a5b31-203">Rather than displaying no products when the page is first loaded, we may want to display *all* products.</span></span> <span data-ttu-id="a5b31-204">Jedním ze způsobů, jak zobrazit seznam všech produktů pokaždé, když je textové pole `MaxPrice` prázdné, je nastavit výchozí hodnotu parametru s některými neskutečně vysokou hodnotou, jako je 1000000, protože je pravděpodobné, že v seznamu Northwind Traders bude někdy inventář, jehož jednotková cena překračuje $1 000 000.</span><span class="sxs-lookup"><span data-stu-id="a5b31-204">One way to list all products whenever the `MaxPrice` TextBox is empty is to set the parameter s default value to some insanely high value, like 1000000, since it s unlikely that Northwind Traders will ever have inventory whose unit price exceeds $1,000,000.</span></span> <span data-ttu-id="a5b31-205">Tento přístup je ale shortsighted a nemusí fungovat v jiných situacích.</span><span class="sxs-lookup"><span data-stu-id="a5b31-205">However, this approach is shortsighted and might not work in other situations.</span></span>

<span data-ttu-id="a5b31-206">V předchozích kurzech – [deklarativní parametry](../basic-reporting/declarative-parameters-vb.md) a [filtrování hlavního/podrobného filtru s ovládacím prvkem DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) jsme dělali s podobným problémem.</span><span class="sxs-lookup"><span data-stu-id="a5b31-206">In previous tutorials - [Declarative Parameters](../basic-reporting/declarative-parameters-vb.md) and [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) we were faced with a similar problem.</span></span> <span data-ttu-id="a5b31-207">Naše řešení mělo tuto logiku vložit do vrstvy obchodní logiky.</span><span class="sxs-lookup"><span data-stu-id="a5b31-207">Our solution there was to put this logic in the Business Logic Layer.</span></span> <span data-ttu-id="a5b31-208">Konkrétně knihoven BLL zkontroloval příchozí hodnotu, a pokud `NULL` nebo nějaké rezervované hodnoty, bylo volání směrováno na metodu DAL, která vrátila všechny záznamy.</span><span class="sxs-lookup"><span data-stu-id="a5b31-208">Specifically, the BLL examined the incoming value and, if it was `NULL` or some reserved value, the call was routed to the DAL method that returned all records.</span></span> <span data-ttu-id="a5b31-209">Pokud byla vstupní hodnota normální hodnotou filtrování, bylo provedeno volání metody DAL, která provedla příkaz jazyka SQL, který použil parametrizovanou klauzuli `WHERE` se zadanou hodnotou.</span><span class="sxs-lookup"><span data-stu-id="a5b31-209">If the incoming value was a normal filtering value, a call was made to the DAL method that executed a SQL statement that used a parameterized `WHERE` clause with the supplied value.</span></span>

<span data-ttu-id="a5b31-210">Bohužel při použití SqlDataSource tuto architekturu vynecháváme.</span><span class="sxs-lookup"><span data-stu-id="a5b31-210">Unfortunately, we bypass the architecture when using the SqlDataSource.</span></span> <span data-ttu-id="a5b31-211">Místo toho je potřeba přizpůsobit příkaz SQL inteligentnímu převzetí všech záznamů, pokud je parametr `@MaximumPrice` `NULL` nebo některá rezervovaná hodnota.</span><span class="sxs-lookup"><span data-stu-id="a5b31-211">Instead, we need to customize the SQL statement to intelligently grab all records if the `@MaximumPrice` parameter is `NULL` or some reserved value.</span></span> <span data-ttu-id="a5b31-212">Pro účely tohoto cvičení ji nechte mít, aby v případě, že je parametr `@MaximumPrice` stejný jako `-1.0`, byly vráceny *všechny* záznamy (`-1.0` fungovat jako rezervovaná hodnota, protože žádný produkt nemůže mít záporný `UnitPrice` hodnotu).</span><span class="sxs-lookup"><span data-stu-id="a5b31-212">For this exercise, let s have it so that if the `@MaximumPrice` parameter is equal to `-1.0`, then *all* of the records are to be returned (`-1.0` works as a reserved value since no product can have a negative `UnitPrice` value).</span></span> <span data-ttu-id="a5b31-213">K tomu můžeme použít následující příkaz SQL:</span><span class="sxs-lookup"><span data-stu-id="a5b31-213">To accomplish this we can use the following SQL statement:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample7.sql)]

<span data-ttu-id="a5b31-214">Tato klauzule `WHERE` vrátí *všechny* záznamy, pokud se parametr `@MaximumPrice` rovná `-1.0`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-214">This `WHERE` clause returns *all* records if the `@MaximumPrice` parameter equals `-1.0`.</span></span> <span data-ttu-id="a5b31-215">Pokud hodnota parametru není `-1.0`, vrátí se pouze ty produkty, jejichž `UnitPrice` je menší nebo rovno hodnotě `@MaximumPrice` parametru.</span><span class="sxs-lookup"><span data-stu-id="a5b31-215">If the parameter value is not `-1.0`, only those products whose `UnitPrice` is less than or equal to the `@MaximumPrice` parameter value are returned.</span></span> <span data-ttu-id="a5b31-216">Nastavením výchozí hodnoty parametru `@MaximumPrice` na `-1.0`, při prvním načtení stránky (nebo pokaždé, když je pole `MaxPrice` prázdné) `@MaximumPrice` bude mít hodnotu `-1.0` a zobrazí se všechny produkty.</span><span class="sxs-lookup"><span data-stu-id="a5b31-216">By setting the default value of the `@MaximumPrice` parameter to `-1.0`, on the first page load (or whenever the `MaxPrice` TextBox is empty), `@MaximumPrice` will have a value of `-1.0` and all products will be displayed.</span></span>

<span data-ttu-id="a5b31-217">[Když je textové pole MaxPrice prázdné, ![se teď všechny produkty zobrazovat.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-217">[![Now All Products are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span></span>

<span data-ttu-id="a5b31-218">**Obrázek 8**: teď se zobrazí všechny produkty, když je textové pole `MaxPrice` prázdné ([kliknutím zobrazíte obrázek v plné velikosti).](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-218">**Figure 8**: Now All Products are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png))</span></span>

<span data-ttu-id="a5b31-219">S tímto přístupem je potřeba vzít v paměti několik aspektů.</span><span class="sxs-lookup"><span data-stu-id="a5b31-219">There are a couple of caveats to note with this approach.</span></span> <span data-ttu-id="a5b31-220">Nejprve si pojistěte, aby datový typ parametru s byl odvozen využitím IT v dotazu SQL.</span><span class="sxs-lookup"><span data-stu-id="a5b31-220">First, realize that the parameter s data type is inferred by it s usage in the SQL query.</span></span> <span data-ttu-id="a5b31-221">Změníte-li klauzuli `WHERE` z `@MaximumPrice = -1.0` na `@MaximumPrice = -1`, modul runtime zpracuje parametr jako celé číslo.</span><span class="sxs-lookup"><span data-stu-id="a5b31-221">If you change the `WHERE` clause from `@MaximumPrice = -1.0` to `@MaximumPrice = -1`, the runtime treats the parameter as an integer.</span></span> <span data-ttu-id="a5b31-222">Pokud se pak pokusíte přiřadit `MaxPrice` TextBox k desítkové hodnotě (například 5,00), dojde k chybě, protože nemůže převést 5,00 na celé číslo.</span><span class="sxs-lookup"><span data-stu-id="a5b31-222">If you then attempt to assign the `MaxPrice` TextBox to a decimal value (like 5.00 ), an error will occur because it cannot convert 5.00 to an integer.</span></span> <span data-ttu-id="a5b31-223">Chcete-li tento problém napravit, buď se ujistěte, že používáte `@MaximumPrice = -1.0` v klauzuli `WHERE` nebo ještě lépe nastavte vlastnost `ControlParameter` objektů s `Type` na hodnotu Decimal.</span><span class="sxs-lookup"><span data-stu-id="a5b31-223">To remedy this, either make sure that you use `@MaximumPrice = -1.0` in the `WHERE` clause or, better yet, set the `ControlParameter` object s `Type` property to Decimal .</span></span>

<span data-ttu-id="a5b31-224">Po přidání `OR @MaximumPrice = -1.0` do klauzule `WHERE` nemůže dotazovací modul použít index v `UnitPrice` (za předpokladu, že existuje), což by vedlo k prohledávání tabulky.</span><span class="sxs-lookup"><span data-stu-id="a5b31-224">Secondly, by adding the `OR @MaximumPrice = -1.0` to the `WHERE` clause, the query engine cannot use an index on `UnitPrice` (assuming one exists), thereby resulting in a table scan.</span></span> <span data-ttu-id="a5b31-225">To může mít vliv na výkon, pokud je v `Products` tabulce dostatečně velký počet záznamů.</span><span class="sxs-lookup"><span data-stu-id="a5b31-225">This can impact performance if there are a sufficiently large number of records in the `Products` table.</span></span> <span data-ttu-id="a5b31-226">Lepším přístupem je přesunutí této logiky do úložné procedury, kde příkaz `IF` buď provede `SELECT` dotaz z tabulky `Products` bez klauzule `WHERE`, pokud se mají vrátit všechny záznamy, nebo jedna z jejích klauzulí `WHERE` obsahuje pouze kritéria `UnitPrice`, aby bylo možné použít index.</span><span class="sxs-lookup"><span data-stu-id="a5b31-226">A better approach would be to move this logic to a stored procedure where an `IF` statement would either perform a `SELECT` query from the `Products` table without a `WHERE` clause when all records need to be returned or one whose `WHERE` clause contains just the `UnitPrice` criteria, so that an index can be used.</span></span>

## <a name="step-3-creating-and-using-parameterized-stored-procedures"></a><span data-ttu-id="a5b31-227">Krok 3: vytvoření a použití parametrizovaných uložených procedur</span><span class="sxs-lookup"><span data-stu-id="a5b31-227">Step 3: Creating and Using Parameterized Stored Procedures</span></span>

<span data-ttu-id="a5b31-228">Uložené procedury mohou zahrnovat sadu vstupních parametrů, které lze použít v příkazech jazyka SQL definovaných v rámci uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="a5b31-228">Stored procedures can include a set of input parameters that can then be used in the SQL statement(s) defined within the stored procedure.</span></span> <span data-ttu-id="a5b31-229">Při konfiguraci aplikace SqlDataSource tak, aby používala uloženou proceduru, která přijímá vstupní parametry, lze tyto hodnoty parametrů zadat stejným způsobem jako s příkazy SQL ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="a5b31-229">When configuring the SqlDataSource to use a stored procedure that accepts input parameters, these parameter values can be specified using the same techniques as with ad-hoc SQL statements.</span></span>

<span data-ttu-id="a5b31-230">Chcete-li ilustrovat použití uložených procedur ve třídě SqlDataSource, je nutné vytvořit novou uloženou proceduru v databázi Northwind s názvem `GetProductsByCategory`, která přijímá parametr s názvem `@CategoryID` a vrátí všechny sloupce produktů, jejichž `CategoryID` sloupec odpovídá `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-230">To illustrate using stored procedures in the SqlDataSource, let s create a new stored procedure in the Northwind database named `GetProductsByCategory`, which accepts a parameter named `@CategoryID` and returns all of the columns of the products whose `CategoryID` column matches `@CategoryID`.</span></span> <span data-ttu-id="a5b31-231">Chcete-li vytvořit uloženou proceduru, přejděte do Průzkumník serveru a přejděte do databáze `NORTHWND.MDF`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-231">To create a stored procedure, go to the Server Explorer and drill down into the `NORTHWND.MDF` database.</span></span> <span data-ttu-id="a5b31-232">(Pokud nevidíte Průzkumník serveru, přepněte ho do nabídky zobrazení a vyberte možnost Průzkumník serveru.)</span><span class="sxs-lookup"><span data-stu-id="a5b31-232">(If you don t see the Server Explorer, bring it up by going to the View menu and selecting the Server Explorer option.)</span></span>

<span data-ttu-id="a5b31-233">Z databáze `NORTHWND.MDF` klikněte pravým tlačítkem na složku uložené procedury, vyberte možnost Přidat novou uloženou proceduru a zadejte následující syntaxi:</span><span class="sxs-lookup"><span data-stu-id="a5b31-233">From the `NORTHWND.MDF` database, right-click on the Stored Procedures folder, choose Add New Stored Procedure, and enter the following syntax:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample8.sql)]

<span data-ttu-id="a5b31-234">Uložte uloženou proceduru kliknutím na ikonu Uložit (nebo CTRL + S).</span><span class="sxs-lookup"><span data-stu-id="a5b31-234">Click the Save icon (or Ctrl+S) to save the stored procedure.</span></span> <span data-ttu-id="a5b31-235">Uloženou proceduru můžete otestovat tak, že na ni kliknete pravým tlačítkem ze složky uložené procedury a kliknete na spustit.</span><span class="sxs-lookup"><span data-stu-id="a5b31-235">You can test the stored procedure by right-clicking it from the Stored Procedures folder and choosing Execute.</span></span> <span data-ttu-id="a5b31-236">Zobrazí se výzva k zadání parametrů uložené procedury (`@CategoryID`v této instanci), po jejichž uplynutí se výsledky zobrazí v okně výstup.</span><span class="sxs-lookup"><span data-stu-id="a5b31-236">This will prompt you for the stored procedure s parameters (`@CategoryID`, in this instance), after which the results will be displayed in the Output window.</span></span>

<span data-ttu-id="a5b31-237">[![uloženou proceduru GetProductsByCategory při spuštění s @CategoryID 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-237">[![The GetProductsByCategory Stored Procedure when Executed with a @CategoryID of 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span></span>

<span data-ttu-id="a5b31-238">**Obrázek 9**: `GetProductsByCategory` uloženou proceduru při spuštění s `@CategoryID` 1 ([kliknutím zobrazíte obrázek v plné velikosti](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="a5b31-238">**Figure 9**: The `GetProductsByCategory` Stored Procedure when Executed with a `@CategoryID` of 1 ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span></span>

<span data-ttu-id="a5b31-239">Tuto uloženou proceduru můžete použít k zobrazení všech produktů v kategorii nápoje v prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="a5b31-239">Let s use this stored procedure to display all products in the Beverages category in a GridView.</span></span> <span data-ttu-id="a5b31-240">Přidejte na stránku nový prvek GridView a vytvořte jeho vazby k nové třídě SqlDataSource s názvem `BeverageProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-240">Add a new GridView to the page and bind it to a new SqlDataSource named `BeverageProductsDataSource`.</span></span> <span data-ttu-id="a5b31-241">Přejděte na obrazovku zadat vlastní příkaz SQL nebo uloženou proceduru, vyberte přepínač uložené procedury a z rozevíracího seznamu vyberte `GetProductsByCategory` uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="a5b31-241">Continue to the Specify a custom SQL statement or stored procedure screen, select the Stored procedure radio button, and pick the `GetProductsByCategory` stored procedure from the drop-down list.</span></span>

<span data-ttu-id="a5b31-242">[![v rozevíracím seznamu vyberte uloženou proceduru GetProductsByCategory.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-242">[![Select the GetProductsByCategory Stored Procedure from the Drop-Down List](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span></span>

<span data-ttu-id="a5b31-243">**Obrázek 10**: v rozevíracím seznamu vyberte uloženou proceduru `GetProductsByCategory` ([kliknutím zobrazíte obrázek v plné velikosti).](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-243">**Figure 10**: Select the `GetProductsByCategory` Stored Procedure from the Drop-Down List ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png))</span></span>

<span data-ttu-id="a5b31-244">Vzhledem k tomu, že úložná procedura akceptuje vstupní parametr (`@CategoryID`), zobrazí se kliknutím na další výzva k zadání zdroje pro tuto hodnotu parametru s.</span><span class="sxs-lookup"><span data-stu-id="a5b31-244">Since the stored procedure accepts an input parameter (`@CategoryID`), clicking Next prompts us to specify the source for this parameter s value.</span></span> <span data-ttu-id="a5b31-245">`CategoryID` nápoje mají hodnotu 1, takže rozevírací seznam zdroj parametrů ponechte v žádné a zadejte hodnotu 1 do textového pole DefaultValue.</span><span class="sxs-lookup"><span data-stu-id="a5b31-245">The Beverages `CategoryID` is 1, so leave the Parameter source drop-down list at None and enter 1 into the DefaultValue textbox.</span></span>

<span data-ttu-id="a5b31-246">[pro vrácení produktů v kategorii nápoje ![použít pevně kódovanou hodnotu 1.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-246">[![Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span></span>

<span data-ttu-id="a5b31-247">**Obrázek 11**: použití pevně zakódované hodnoty 1 pro vrácení produktů v kategorii nápoje ([kliknutím zobrazíte obrázek v plné velikosti](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="a5b31-247">**Figure 11**: Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span></span>

<span data-ttu-id="a5b31-248">Jak ukazuje následující deklarativní označení, při použití uložené procedury je vlastnost SqlDataSource s `SelectCommand` nastavena na název uložené procedury a [vlastnost`SelectCommandType`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) je nastavena na hodnotu `StoredProcedure`, což značí, že `SelectCommand` je název uložené procedury a nikoli příkaz SQL ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="a5b31-248">As the following declarative markup shows, when using a stored procedure, the SqlDataSource s `SelectCommand` property is set to the name of the stored procedure and the [`SelectCommandType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) is set to `StoredProcedure`, indicating that the `SelectCommand` is the name of a stored procedure rather than an ad-hoc SQL statement.</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample9.aspx)]

<span data-ttu-id="a5b31-249">Otestujte stránku v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="a5b31-249">Test out the page in a browser.</span></span> <span data-ttu-id="a5b31-250">Zobrazí se pouze ty produkty, které patří do kategorie nápoje, i když se zobrazí *všechna* pole produktu, protože `GetProductsByCategory` uložená procedura vrátí všechny sloupce z tabulky `Products`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-250">Only those products that belong to the Beverages category are displayed, although *all* of the product fields are displayed since the `GetProductsByCategory` stored procedure returns all of the columns from the `Products` table.</span></span> <span data-ttu-id="a5b31-251">Můžeme samozřejmě omezit nebo přizpůsobit pole zobrazená v prvku GridView v dialogovém okně Upravit sloupce GridView.</span><span class="sxs-lookup"><span data-stu-id="a5b31-251">We could, of course, limit or customize the fields displayed in the GridView from the GridView s Edit Columns dialog box.</span></span>

<span data-ttu-id="a5b31-252">[![zobrazí se všechny nápoje.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-252">[![All of the Beverages are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span></span>

<span data-ttu-id="a5b31-253">**Obrázek 12**: zobrazí se všechny nápoje ([kliknutím zobrazíte obrázek v plné velikosti).](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-253">**Figure 12**: All of the Beverages are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png))</span></span>

## <a name="step-4-programmatically-invoking-a-sqldatasource-sselectstatement"></a><span data-ttu-id="a5b31-254">Krok 4: vyvolání příkazu`Select()`SqlDataSource s pomocí kódu programu</span><span class="sxs-lookup"><span data-stu-id="a5b31-254">Step 4: Programmatically Invoking a SqlDataSource s`Select()`Statement</span></span>

<span data-ttu-id="a5b31-255">Příklady, které jsme si poznamenali v předchozím kurzu, a v tomto kurzu mají i nadále vázané ovládací prvky SqlDataSource přímo na prvek GridView.</span><span class="sxs-lookup"><span data-stu-id="a5b31-255">The examples we ve seen in the previous tutorial and this tutorial so far have bound SqlDataSource controls directly to a GridView.</span></span> <span data-ttu-id="a5b31-256">Data ovládacího prvku SqlDataSource však lze programově přistupovat a zobrazit v kódu.</span><span class="sxs-lookup"><span data-stu-id="a5b31-256">The SqlDataSource control s data, however, can be programmatically accessed and enumerated in code.</span></span> <span data-ttu-id="a5b31-257">To může být zvláště užitečné, když potřebujete zadat dotaz na data, abyste je zkontrolovali, ale nemusíte je zobrazit.</span><span class="sxs-lookup"><span data-stu-id="a5b31-257">This can be particularly useful when you need to query data to inspect it, but don t need to display it.</span></span> <span data-ttu-id="a5b31-258">Místo toho, abyste museli zapisovat všechen často používaný kód ADO.NET pro připojení k databázi, zadejte příkaz a načtěte výsledky. můžete tak nechat, aby tento kód monotonous zpracovala třída SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a5b31-258">Rather than having to write all of the boilerplate ADO.NET code to connect to the database, specify the command, and retrieve the results, you can let the SqlDataSource handle this monotonous code.</span></span>

<span data-ttu-id="a5b31-259">Představte si, že se vám při práci s daty ve třídě SqlDataSource s data připravuje váš nadřízený, na který se přibližuje požadavek na vytvoření webové stránky, která zobrazuje název náhodně vybrané kategorie a jejích přidružených produktů.</span><span class="sxs-lookup"><span data-stu-id="a5b31-259">To illustrate working with the SqlDataSource s data programmatically, imagine that your boss has approached you with a request to create a web page that displays the name of a randomly selected category and its associated products.</span></span> <span data-ttu-id="a5b31-260">To znamená, že když uživatel navštíví tuto stránku, chceme v tabulce `Categories` náhodně zvolit kategorii, zobrazit název kategorie a pak uvést seznam produktů patřících do této kategorie.</span><span class="sxs-lookup"><span data-stu-id="a5b31-260">That is, when a user visits this page, we want to randomly choose a category from the `Categories` table, display the category name, and then list the products belonging to that category.</span></span>

<span data-ttu-id="a5b31-261">Abychom to dosáhli, potřebujeme dva ovládací prvky SqlDataSource pro vytvoření náhodné kategorie z `Categories` tabulky a další pro získání produktů kategorie s.</span><span class="sxs-lookup"><span data-stu-id="a5b31-261">To accomplish this we need two SqlDataSource controls one to grab a random category from the `Categories` table and another to get the category s products.</span></span> <span data-ttu-id="a5b31-262">Vytvoříme SqlDataSource, která v tomto kroku načte náhodný záznam kategorie. Krok 5 se zabývá vytvářením značky SqlDataSource, která načítá produkty kategorie s.</span><span class="sxs-lookup"><span data-stu-id="a5b31-262">We'll build the SqlDataSource that retrieves a random category record in this step; Step 5 looks at crafting the SqlDataSource that retrieves the category s products.</span></span>

<span data-ttu-id="a5b31-263">Začněte přidáním SqlDataSource do `ParameterizedQueries.aspx` a nastavte jeho `ID` na `RandomCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-263">Start by adding a SqlDataSource to `ParameterizedQueries.aspx` and set its `ID` to `RandomCategoryDataSource`.</span></span> <span data-ttu-id="a5b31-264">Nakonfigurujte ji tak, aby používala následující dotaz SQL:</span><span class="sxs-lookup"><span data-stu-id="a5b31-264">Configure it so that it uses the following SQL query:</span></span>

[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample10.sql)]

<span data-ttu-id="a5b31-265">`ORDER BY NEWID()` vrátí záznamy seřazené v náhodném pořadí (viz [použití `NEWID()` k náhodnému řazení záznamů](http://www.sqlteam.com/item.asp?ItemID=8747)).</span><span class="sxs-lookup"><span data-stu-id="a5b31-265">`ORDER BY NEWID()` returns the records sorted in random order (see [Using `NEWID()` to Randomly Sort Records](http://www.sqlteam.com/item.asp?ItemID=8747)).</span></span> <span data-ttu-id="a5b31-266">`SELECT TOP 1` vrátí první záznam ze sady výsledků dotazu.</span><span class="sxs-lookup"><span data-stu-id="a5b31-266">`SELECT TOP 1` returns the first record from the result set.</span></span> <span data-ttu-id="a5b31-267">Tento dotaz společně vloží hodnoty sloupce `CategoryID` a `CategoryName` z jedné náhodně vybrané kategorie.</span><span class="sxs-lookup"><span data-stu-id="a5b31-267">Put together, this query returns the `CategoryID` and `CategoryName` column values from a single, randomly selected category.</span></span>

<span data-ttu-id="a5b31-268">Chcete-li zobrazit kategorii s `CategoryName` hodnotou, přidejte na stránku webový ovládací prvek popisek, nastavte jeho vlastnost `ID` na hodnotu `CategoryNameLabel`a vymažte jeho vlastnost `Text`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-268">To display the category s `CategoryName` value, add a Label Web control to the page, set its `ID` property to `CategoryNameLabel`, and clear out its `Text` property.</span></span> <span data-ttu-id="a5b31-269">Abychom mohli programově načíst data z ovládacího prvku SqlDataSource, musíme vyvolat jeho `Select()` metodu.</span><span class="sxs-lookup"><span data-stu-id="a5b31-269">To programmatically retrieve the data from a SqlDataSource control, we need to invoke its `Select()` method.</span></span> <span data-ttu-id="a5b31-270">[Metoda`Select()`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) očekává jeden vstupní parametr typu [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), který určuje, jak se mají data před vrácením vrátit.</span><span class="sxs-lookup"><span data-stu-id="a5b31-270">The [`Select()` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) expects a single input parameter of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), which specifies how the data should be messaged before being returned.</span></span> <span data-ttu-id="a5b31-271">To může zahrnovat pokyny pro řazení a filtrování dat a používá se při řazení nebo stránkování přes data z ovládacího prvku SqlDataSource k datovým webovým ovládacím prvkům.</span><span class="sxs-lookup"><span data-stu-id="a5b31-271">This can include instructions on sorting and filtering the data, and is used by the data Web controls when sorting or paging through the data from a SqlDataSource control.</span></span> <span data-ttu-id="a5b31-272">Pro náš příklad ale potřebujeme, aby data byla před vrácením změněna, a proto budou předána do objektu `DataSourceSelectArguments.Empty`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-272">For our example, though, we don t need the data to be modified before being returned, and therefore will pass in the `DataSourceSelectArguments.Empty` object.</span></span>

<span data-ttu-id="a5b31-273">Metoda `Select()` vrátí objekt, který implementuje `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-273">The `Select()` method returns an object that implements `IEnumerable`.</span></span> <span data-ttu-id="a5b31-274">Přesný typ vrácený závisí na hodnotě [vlastnosti`DataSourceMode`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx)ovládacího prvku SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a5b31-274">The precise type returned depends on the value of the SqlDataSource control s [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span></span> <span data-ttu-id="a5b31-275">Jak je popsáno v předchozím kurzu, tato vlastnost může být nastavena na hodnotu buď `DataSet`, nebo `DataReader`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-275">As discussed in the previous tutorial, this property can be set to a value of either `DataSet` or `DataReader`.</span></span> <span data-ttu-id="a5b31-276">Pokud je nastavena na `DataSet`, metoda `Select()` vrátí objekt [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) ; Pokud je nastaveno na `DataReader`, vrátí objekt, který implementuje [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span><span class="sxs-lookup"><span data-stu-id="a5b31-276">If set to `DataSet`, the `Select()` method returns a [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) object; if set to `DataReader`, it returns an object that implements [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span></span> <span data-ttu-id="a5b31-277">Vzhledem k tomu, že `RandomCategoryDataSource` SqlDataSource má svou vlastnost `DataSourceMode` nastavenou na `DataSet` (výchozí), budeme pracovat s objektem DataView.</span><span class="sxs-lookup"><span data-stu-id="a5b31-277">Since the `RandomCategoryDataSource` SqlDataSource has its `DataSourceMode` property set to `DataSet` (the default), we will be working with a DataView object.</span></span>

<span data-ttu-id="a5b31-278">Následující kód ilustruje, jak načíst záznamy z `RandomCategoryDataSource` SqlDataSource jako objekt DataView a jak načíst `CategoryName` hodnotu sloupce z prvního řádku DataView:</span><span class="sxs-lookup"><span data-stu-id="a5b31-278">The following code illustrates how to retrieve the records from the `RandomCategoryDataSource` SqlDataSource as a DataView as well as how to read the `CategoryName` column value from the first DataView row:</span></span>

[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample11.vb)]

<span data-ttu-id="a5b31-279">`randomCategoryView(0)` vrátí první `DataRowView` v objektu DataView.</span><span class="sxs-lookup"><span data-stu-id="a5b31-279">`randomCategoryView(0)` returns the first `DataRowView` in the DataView.</span></span> <span data-ttu-id="a5b31-280">`randomCategoryView(0)("CategoryName")` vrátí hodnotu sloupce `CategoryName` v tomto prvním řádku.</span><span class="sxs-lookup"><span data-stu-id="a5b31-280">`randomCategoryView(0)("CategoryName")` returns the value of the `CategoryName` column in this first row.</span></span> <span data-ttu-id="a5b31-281">Všimněte si, že DataView je volně typované.</span><span class="sxs-lookup"><span data-stu-id="a5b31-281">Note that the DataView is loosely-typed.</span></span> <span data-ttu-id="a5b31-282">Chcete-li odkazovat na konkrétní hodnotu sloupce, musíme předat název sloupce jako řetězec (CategoryName, v tomto případě).</span><span class="sxs-lookup"><span data-stu-id="a5b31-282">To reference a particular column value we need to pass in the name of the column as a string ( CategoryName, in this case).</span></span> <span data-ttu-id="a5b31-283">Obrázek 13 zobrazuje zprávu zobrazenou v `CategoryNameLabel` při zobrazení stránky.</span><span class="sxs-lookup"><span data-stu-id="a5b31-283">Figure 13 shows the message displayed in the `CategoryNameLabel` when viewing the page.</span></span> <span data-ttu-id="a5b31-284">Skutečný název kategorie se samozřejmě náhodně vybere na základě `RandomCategoryDataSource` SqlDataSource na každé návštěvě stránky (včetně postbacků).</span><span class="sxs-lookup"><span data-stu-id="a5b31-284">Of course, the actual category name displayed is randomly selected by the `RandomCategoryDataSource` SqlDataSource on each visit to the page (including postbacks).</span></span>

<span data-ttu-id="a5b31-285">[![se zobrazí náhodně vybraný název kategorie s.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-285">[![The Randomly Selected Category s Name is Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span></span>

<span data-ttu-id="a5b31-286">**Obrázek 13**: zobrazí se náhodně vybraný název kategorie s ([kliknutím zobrazíte obrázek v plné velikosti).](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-286">**Figure 13**: The Randomly Selected Category s Name is Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png))</span></span>

> [!NOTE]
> <span data-ttu-id="a5b31-287">Pokud byla vlastnost `DataSourceMode` ovládacího prvku SqlDataSource nastavena na hodnotu `DataReader`, návratová hodnota z metody `Select()` by musela být převedena na `IDataReader`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-287">If the SqlDataSource control s `DataSourceMode` property had been set to `DataReader`, the return value from the `Select()` method would have needed to be cast to `IDataReader`.</span></span> <span data-ttu-id="a5b31-288">Pro načtení `CategoryName` hodnoty sloupce z prvního řádku používáme kód jako:</span><span class="sxs-lookup"><span data-stu-id="a5b31-288">To read the `CategoryName` column value from the first row, we d use code like:</span></span>

[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample12.vb)]

<span data-ttu-id="a5b31-289">Při náhodném výběru kategorie se znovu připravujeme k přidání prvku GridView, který obsahuje seznam produktů kategorií.</span><span class="sxs-lookup"><span data-stu-id="a5b31-289">With the SqlDataSource randomly selecting a category, we re ready to add the GridView that lists the category s products.</span></span>

> [!NOTE]
> <span data-ttu-id="a5b31-290">Namísto použití webového ovládacího prvku popisek k zobrazení kategorie s název jsme mohli na stránku přidat FormView nebo DetailsView a vytvořit vazbu na třídě SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a5b31-290">Rather than using a Label Web control to display the category s name, we could have added a FormView or DetailsView to the page, binding it to the SqlDataSource.</span></span> <span data-ttu-id="a5b31-291">Použití popisku ale nám umožňuje prozkoumat, jak programově vyvolat příkaz SqlDataSource s `Select()` a pracovat s jeho výslednými daty v kódu.</span><span class="sxs-lookup"><span data-stu-id="a5b31-291">Using the Label, however, allowed us to explore how to programmatically invoke the SqlDataSource s `Select()` statement and work with its resulting data in code.</span></span>

## <a name="step-5-assigning-parameter-values-programmatically"></a><span data-ttu-id="a5b31-292">Krok 5: přiřazení hodnot parametrů prostřednictvím kódu programu</span><span class="sxs-lookup"><span data-stu-id="a5b31-292">Step 5: Assigning Parameter Values Programmatically</span></span>

<span data-ttu-id="a5b31-293">Všechny příklady, které jsme doposud viděli v tomto kurzu, použily pevně zakódované hodnoty parametru nebo jeden z předdefinovaných zdrojů parametrů (hodnota QueryString, webový ovládací prvek na stránce atd.).</span><span class="sxs-lookup"><span data-stu-id="a5b31-293">All of the examples we ve seen so far in this tutorial have used either a hard-coded parameter value or one taken from one of the pre-defined parameter sources (a querystring value, a Web control on the page, and so on).</span></span> <span data-ttu-id="a5b31-294">Parametry ovládacího prvku SqlDataSource ale lze nastavit také programově.</span><span class="sxs-lookup"><span data-stu-id="a5b31-294">However, the SqlDataSource control s parameters can also be set programmatically.</span></span> <span data-ttu-id="a5b31-295">Abychom dokončili náš aktuální příklad, potřebujeme SqlDataSource, který vrátí všechny produkty patřící do určité kategorie.</span><span class="sxs-lookup"><span data-stu-id="a5b31-295">To complete our current example, we need a SqlDataSource that returns all of the products belonging to a specified category.</span></span> <span data-ttu-id="a5b31-296">Tato třída SqlDataSource bude mít parametr `CategoryID`, jehož hodnota musí být nastavena na základě hodnoty `CategoryID` sloupce vráceného `RandomCategoryDataSource`m SqlDataSource v obslužné rutině události `Page_Load`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-296">This SqlDataSource will have a `CategoryID` parameter whose value needs to be set based on the `CategoryID` column value returned by the `RandomCategoryDataSource` SqlDataSource in the `Page_Load` event handler.</span></span>

<span data-ttu-id="a5b31-297">Začněte přidáním prvku GridView na stránku a vytvořte jeho vazby na novou třídě SqlDataSource s názvem `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a5b31-297">Start by adding a GridView to the page and bind it to a new SqlDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="a5b31-298">Podobně jako v kroku 3, nakonfigurujete SqlDataSource, aby vyvolalo `GetProductsByCategory` uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="a5b31-298">Much like we did in Step 3, configure the SqlDataSource so that it invokes the `GetProductsByCategory` stored procedure.</span></span> <span data-ttu-id="a5b31-299">Rozevírací seznam pro zdroj parametrů nechejte nastavený na žádná, ale nezadávejte výchozí hodnotu, protože tuto výchozí hodnotu nastavíme programově.</span><span class="sxs-lookup"><span data-stu-id="a5b31-299">Leave the Parameter source drop-down list set to None, but do not enter a default value, as we will set this default value programmatically.</span></span>

<span data-ttu-id="a5b31-300">[![nespecifikovat zdroj parametru nebo výchozí hodnotu](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-300">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span></span>

<span data-ttu-id="a5b31-301">**Obrázek 14**: nezadávejte zdroj parametru ani výchozí hodnotu ([kliknutím zobrazíte obrázek v plné velikosti](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png)).</span><span class="sxs-lookup"><span data-stu-id="a5b31-301">**Figure 14**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png))</span></span>

<span data-ttu-id="a5b31-302">Po dokončení průvodce SqlDataSource by výsledný deklarativní kód měl vypadat podobně jako následující:</span><span class="sxs-lookup"><span data-stu-id="a5b31-302">After completing the SqlDataSource wizard, the resulting declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample13.aspx)]

<span data-ttu-id="a5b31-303">`DefaultValue` parametru `CategoryID` můžeme programově přiřadit v obslužné rutině události `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="a5b31-303">We can assign the `DefaultValue` of the `CategoryID` parameter programmatically in the `Page_Load` event handler:</span></span>

[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample14.vb)]

<span data-ttu-id="a5b31-304">S tímto sčítáním stránka obsahuje prvek GridView, který zobrazuje produkty přidružené k náhodně vybrané kategorii.</span><span class="sxs-lookup"><span data-stu-id="a5b31-304">With this addition, the page includes a GridView that shows the products associated with the randomly selected category.</span></span>

<span data-ttu-id="a5b31-305">[![nespecifikovat zdroj parametru nebo výchozí hodnotu](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="a5b31-305">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span></span>

<span data-ttu-id="a5b31-306">**Obrázek 15**: nezadávejte zdroj parametru ani výchozí hodnotu ([kliknutím zobrazíte obrázek v plné velikosti](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png)).</span><span class="sxs-lookup"><span data-stu-id="a5b31-306">**Figure 15**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png))</span></span>

## <a name="summary"></a><span data-ttu-id="a5b31-307">Přehled</span><span class="sxs-lookup"><span data-stu-id="a5b31-307">Summary</span></span>

<span data-ttu-id="a5b31-308">Třída SqlDataSource umožňuje vývojářům stránek definovat parametrizované dotazy, jejichž hodnoty parametrů mohou být pevně kódované, získány z předem definovaných zdrojů parametrů nebo přiřazeny programově.</span><span class="sxs-lookup"><span data-stu-id="a5b31-308">The SqlDataSource enables page developers to define parameterized queries whose parameter values can be hard-coded, pulled from pre-defined parameter sources, or assigned programmatically.</span></span> <span data-ttu-id="a5b31-309">V tomto kurzu jsme zjistili, jak vytvořit parametrizovaný dotaz pomocí Průvodce konfigurací zdroje dat pro dotazy SQL ad hoc i pro uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="a5b31-309">In this tutorial we saw how to craft a parameterized query from the Configure Data Source wizard for both ad-hoc SQL queries and stored procedures.</span></span> <span data-ttu-id="a5b31-310">Zjistili jsme také použití pevně zakódovaných zdrojů parametrů, webového ovládacího prvku jako zdroje parametrů a programovému zadání hodnoty parametru.</span><span class="sxs-lookup"><span data-stu-id="a5b31-310">We also looked at using hard-coded parameter sources, a Web control as a parameter source, and programmatically specifying the parameter value.</span></span>

<span data-ttu-id="a5b31-311">Podobně jako u prvku ObjectDataSource, třída SqlDataSource také poskytuje možnosti pro úpravu jeho podkladových dat.</span><span class="sxs-lookup"><span data-stu-id="a5b31-311">Like with the ObjectDataSource, the SqlDataSource also provides capabilities to modify its underlying data.</span></span> <span data-ttu-id="a5b31-312">V dalším kurzu se podíváme na to, jak definovat `INSERT`, `UPDATE`a `DELETE` příkazy ve třídě SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="a5b31-312">In the next tutorial we'll look at how to define `INSERT`, `UPDATE`, and `DELETE` statements with the SqlDataSource.</span></span> <span data-ttu-id="a5b31-313">Po přidání těchto příkazů můžeme využít integrované funkce vkládání, úprav a odstraňování, které jsou součástí ovládacích prvků GridView, DetailsView a FormView.</span><span class="sxs-lookup"><span data-stu-id="a5b31-313">Once these statements have been added, we can utilize the built-in inserting, editing, and deleting features inherent to the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="a5b31-314">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="a5b31-314">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a5b31-315">O autorovi</span><span class="sxs-lookup"><span data-stu-id="a5b31-315">About the Author</span></span>

<span data-ttu-id="a5b31-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor 7 ASP/ASP. NET Books a zakladatel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="a5b31-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a5b31-317">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="a5b31-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a5b31-318">Nejnovější kniha je [*Sams naučit se ASP.NET 2,0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a5b31-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a5b31-319">Dá se získat na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a5b31-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a5b31-320">nebo prostřednictvím svého blogu, který najdete na adrese [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a5b31-320">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a5b31-321">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="a5b31-321">Special Thanks To</span></span>

<span data-ttu-id="a5b31-322">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="a5b31-322">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a5b31-323">Recenzenti potenciálních zákazníků pro tento kurz byly Scott Clyde, Randell Schmidt a Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="a5b31-323">Lead reviewers for this tutorial were Scott Clyde, Randell Schmidt, and Ken Pespisa.</span></span> <span data-ttu-id="a5b31-324">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="a5b31-324">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a5b31-325">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a5b31-325">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a5b31-326">[Předchozí](querying-data-with-the-sqldatasource-control-vb.md)
> [Další](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span><span class="sxs-lookup"><span data-stu-id="a5b31-326">[Previous](querying-data-with-the-sqldatasource-control-vb.md)
[Next](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span></span>
