---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
title: Vytvoření vrstvy obchodní logiky (C#) | Microsoft Docs
author: rick-anderson
description: V tomto kurzu se dozvíte, jak centralizovat vaše obchodní pravidla do vrstvy obchodní logiky (knihoven BLL), která slouží jako prostředník pro výměnu dat mezi t...
ms.author: riande
ms.date: 03/31/2010
ms.assetid: 85554606-47cb-4e4f-9848-eed9da579056
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: df96f3e7422a0537bf1b003a33fe8d71a671ac33
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78605621"
---
# <a name="creating-a-business-logic-layer-c"></a><span data-ttu-id="b9931-103">Vytvoření vrstvy obchodní logiky (C#)</span><span class="sxs-lookup"><span data-stu-id="b9931-103">Creating a Business Logic Layer (C#)</span></span>

<span data-ttu-id="b9931-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b9931-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b9931-105">[Stáhnout ukázkovou aplikaci](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) nebo [Stáhnout PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="b9931-105">[Download Sample App](https://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_2_CS.exe) or [Download PDF](creating-a-business-logic-layer-cs/_static/datatutorial02cs1.pdf)</span></span>

> <span data-ttu-id="b9931-106">V tomto kurzu se dozvíte, jak centralizovat vaše obchodní pravidla do vrstvy obchodní logiky (knihoven BLL), která slouží jako prostředník pro výměnu dat mezi prezentační vrstvou a DAL.</span><span class="sxs-lookup"><span data-stu-id="b9931-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>

## <a name="introduction"></a><span data-ttu-id="b9931-107">Úvod</span><span class="sxs-lookup"><span data-stu-id="b9931-107">Introduction</span></span>

<span data-ttu-id="b9931-108">Vrstva přístupu k datům (DAL) vytvořená v [prvním kurzu](creating-a-data-access-layer-cs.md) čistě odděluje logiku přístupu k datům z logiky prezentace.</span><span class="sxs-lookup"><span data-stu-id="b9931-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-cs.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="b9931-109">Nicméně zatímco DAL čistě odděluje údaje o přístupu k datům z prezentační vrstvy, nevynutila žádná obchodní pravidla, která by mohla platit.</span><span class="sxs-lookup"><span data-stu-id="b9931-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="b9931-110">U naší aplikace například můžeme chtít zakázat pole `CategoryID` nebo `SupplierID` tabulky `Products`, která se mají změnit, když je pole `Discontinued` nastaveno na hodnotu 1, nebo můžeme vynutilit pravidla seniority, což zabrání situacím, kdy je zaměstnanec spravován jiným uživatelem, který byl zařazen po nich.</span><span class="sxs-lookup"><span data-stu-id="b9931-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="b9931-111">Dalším běžným scénářem je autorizace, ale jenom uživatelé v určité roli můžou odstranit produkty nebo můžou změnit `UnitPrice`ou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="b9931-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="b9931-112">V tomto kurzu se dozvíte, jak centralizovat tato obchodní pravidla do vrstvy obchodní logiky (knihoven BLL), která slouží jako prostředník pro výměnu dat mezi prezentační vrstvou a DAL.</span><span class="sxs-lookup"><span data-stu-id="b9931-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="b9931-113">V reálné aplikaci by měla být knihoven BLL implementována jako samostatný projekt knihovny tříd; Nicméně pro tyto kurzy implementujeme knihoven BLL jako řadu tříd v naší složce `App_Code`, aby se zjednodušila struktura projektu.</span><span class="sxs-lookup"><span data-stu-id="b9931-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="b9931-114">Obrázek 1 znázorňuje vztahy architektury mezi prezentační vrstvou, knihoven BLL a DAL.</span><span class="sxs-lookup"><span data-stu-id="b9931-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>

![KNIHOVEN BLL odděluje prezentační vrstvu od vrstvy přístupu k datům a ukládá obchodní pravidla.](creating-a-business-logic-layer-cs/_static/image1.png)

<span data-ttu-id="b9931-116">**Obrázek 1**: knihoven BLL odděluje prezentační vrstvu od vrstvy přístupu k datům a ukládá obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="b9931-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>

## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="b9931-117">Krok 1: vytvoření tříd knihoven BLL</span><span class="sxs-lookup"><span data-stu-id="b9931-117">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="b9931-118">Naše knihoven BLL se skládají ze čtyř tříd, jedna pro každý TableAdapter v rámci DAL; Každá z těchto tříd knihoven BLL bude mít metody pro načítání, vkládání, aktualizaci a odstraňování z odpovídajících TableAdapter v rámci DAL, přičemž se použijí vhodná obchodní pravidla.</span><span class="sxs-lookup"><span data-stu-id="b9931-118">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="b9931-119">Aby bylo možné čistě oddělit třídy související s DAL a knihoven BLL, vytvoříme dvě podsložky ve složce `App_Code` `DAL` a `BLL`.</span><span class="sxs-lookup"><span data-stu-id="b9931-119">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="b9931-120">Jednoduše klikněte pravým tlačítkem myši na složku `App_Code` v Průzkumník řešení a vyberte možnost Nová složka.</span><span class="sxs-lookup"><span data-stu-id="b9931-120">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="b9931-121">Po vytvoření těchto dvou složek přesuňte typovou datovou sadu vytvořenou v prvním kurzu do podsložky `DAL`.</span><span class="sxs-lookup"><span data-stu-id="b9931-121">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="b9931-122">Dále vytvořte v podsložce `BLL` čtyři soubory třídy knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="b9931-122">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="b9931-123">Chcete-li to provést, klikněte pravým tlačítkem myši na podsložku `BLL`, vyberte možnost Přidat novou položku a vyberte šablonu třídy.</span><span class="sxs-lookup"><span data-stu-id="b9931-123">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="b9931-124">Pojmenujte čtyři třídy `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`a `EmployeesBLL`.</span><span class="sxs-lookup"><span data-stu-id="b9931-124">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>

![Přidat čtyři nové třídy do složky App_Code](creating-a-business-logic-layer-cs/_static/image2.png)

<span data-ttu-id="b9931-126">**Obrázek 2**: Přidání čtyř nových tříd do složky `App_Code`</span><span class="sxs-lookup"><span data-stu-id="b9931-126">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>

<span data-ttu-id="b9931-127">Nyní přidáme do každé třídy metody, které jednoduše zabalí metody definované pro objekty TableAdapter z prvního kurzu.</span><span class="sxs-lookup"><span data-stu-id="b9931-127">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="b9931-128">V současné době budou tyto metody volat přímo na DAL. později se vrátíme k přidání jakékoli potřebné obchodní logiky.</span><span class="sxs-lookup"><span data-stu-id="b9931-128">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="b9931-129">Pokud používáte Visual Studio Standard Edition nebo vyšší (to znamená, že *nepoužíváte* Visual Web Developer), můžete volitelně navrhnout třídy vizuálně pomocí [Návrhář tříd](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span><span class="sxs-lookup"><span data-stu-id="b9931-129">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="b9931-130">Další informace o této nové funkci v aplikaci Visual Studio najdete na [blogu Návrhář tříd](https://blogs.msdn.com/classdesigner/default.aspx) .</span><span class="sxs-lookup"><span data-stu-id="b9931-130">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>

<span data-ttu-id="b9931-131">Pro třídu `ProductsBLL` musíme přidat celkem sedm metod:</span><span class="sxs-lookup"><span data-stu-id="b9931-131">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="b9931-132">`GetProducts()` vrátí všechny produkty.</span><span class="sxs-lookup"><span data-stu-id="b9931-132">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="b9931-133">`GetProductByProductID(productID)` vrátí produkt se zadaným ID produktu.</span><span class="sxs-lookup"><span data-stu-id="b9931-133">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="b9931-134">`GetProductsByCategoryID(categoryID)` vrátí všechny produkty ze zadané kategorie.</span><span class="sxs-lookup"><span data-stu-id="b9931-134">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="b9931-135">`GetProductsBySupplier(supplierID)` vrátí všechny produkty od určeného dodavatele.</span><span class="sxs-lookup"><span data-stu-id="b9931-135">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="b9931-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` vloží do databáze nový produkt pomocí předaných hodnot; Vrátí hodnotu `ProductID` nově vloženého záznamu.</span><span class="sxs-lookup"><span data-stu-id="b9931-136">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="b9931-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` aktualizuje existující produkt v databázi pomocí předaných hodnot. Vrátí `true`, pokud se přesně jeden řádek aktualizoval, `false` jinak.</span><span class="sxs-lookup"><span data-stu-id="b9931-137">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `true` if precisely one row was updated, `false` otherwise</span></span>
- <span data-ttu-id="b9931-138">`DeleteProduct(productID)` Odstraní zadaný produkt z databáze.</span><span class="sxs-lookup"><span data-stu-id="b9931-138">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="b9931-139">ProductsBLL.cs</span><span class="sxs-lookup"><span data-stu-id="b9931-139">ProductsBLL.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample1.cs)]

<span data-ttu-id="b9931-140">Metody, které jednoduše vracejí data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`a `GetProductBySuppliersID` jsou poměrně jednoduché, protože se jednoduše volají na DAL.</span><span class="sxs-lookup"><span data-stu-id="b9931-140">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="b9931-141">V některých scénářích můžou existovat obchodní pravidla, která je potřeba implementovat na této úrovni (například autorizační pravidla na základě aktuálně přihlášeného uživatele nebo role, ke které uživatel patří), ale tyto metody ponecháme tak, jak jsou.</span><span class="sxs-lookup"><span data-stu-id="b9931-141">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="b9931-142">Pro tyto metody pak knihoven BLL slouží pouze jako proxy, prostřednictvím kterého prezentační vrstva přistupuje k podkladovým datům z vrstvy přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="b9931-142">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="b9931-143">Metody `AddProduct` a `UpdateProduct` obě přijímají jako parametry hodnoty pro různá pole produktu a přidávají nový produkt nebo aktualizují existující produkt, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="b9931-143">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="b9931-144">Vzhledem k tomu, že mnoho sloupců `Product` tabulky může přijmout `NULL` hodnoty (`CategoryID`, `SupplierID`a `UnitPrice`), tyto vstupní parametry pro `AddProduct` a `UpdateProduct`, které mapují na tyto sloupce, používají [typy s možnou hodnotou null](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="b9931-144">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="b9931-145">Typy s možnou hodnotou null jsou v rozhraní .NET 2,0 nové a poskytují techniku pro určení, zda by měl být typ hodnoty místo `null`.</span><span class="sxs-lookup"><span data-stu-id="b9931-145">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `null`.</span></span> <span data-ttu-id="b9931-146">V C# můžete označit typ hodnoty jako typ s možnou hodnotou null přidáním `?` za typ (například `int? x;`).</span><span class="sxs-lookup"><span data-stu-id="b9931-146">In C# you can flag a value type as a nullable type by adding `?` after the type (like `int? x;`).</span></span> <span data-ttu-id="b9931-147">Další informace najdete v části [typy s možnou hodnotou null](https://msdn.microsoft.com/library/1t3y8s4s.aspx) v [ C# průvodci programováním](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) .</span><span class="sxs-lookup"><span data-stu-id="b9931-147">Refer to the [Nullable Types](https://msdn.microsoft.com/library/1t3y8s4s.aspx) section in the [C# Programming Guide](https://msdn.microsoft.com/library/67ef8sbd%28VS.80%29.aspx) for more information.</span></span>

<span data-ttu-id="b9931-148">Všechny tři metody vrací logickou hodnotu, která označuje, zda byl řádek vložen, aktualizován nebo odstraněn, protože výsledkem operace není ovlivněný řádek.</span><span class="sxs-lookup"><span data-stu-id="b9931-148">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="b9931-149">Například pokud vývojář stránky volá `DeleteProduct` předání v `ProductID` pro neexistující produkt, nebude příkaz `DELETE` vydaný pro databázi nijak ovlivněn, takže metoda `DeleteProduct` bude vracet `false`.</span><span class="sxs-lookup"><span data-stu-id="b9931-149">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `false`.</span></span>

<span data-ttu-id="b9931-150">Všimněte si, že při přidávání nového produktu nebo aktualizaci existujícího produktu převezmeme nové nebo změněné hodnoty pole produktu jako seznam skalárních hodnot na rozdíl od přijetí instance `ProductsRow`.</span><span class="sxs-lookup"><span data-stu-id="b9931-150">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="b9931-151">Tento přístup se vybral, protože třída `ProductsRow` je odvozená od `DataRow` třídy ADO.NET, která nemá výchozí konstruktor bez parametrů.</span><span class="sxs-lookup"><span data-stu-id="b9931-151">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="b9931-152">Aby bylo možné vytvořit novou instanci `ProductsRow`, je nutné nejprve vytvořit instanci `ProductsDataTable` a poté vyvolat metodu `NewProductRow()` (kterou provedeme v `AddProduct`).</span><span class="sxs-lookup"><span data-stu-id="b9931-152">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="b9931-153">Tím dojde k nedostatku svých hlav při vkládání a aktualizaci produktů pomocí prvku ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="b9931-153">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="b9931-154">V krátkém případě se prvek ObjectDataSource pokusí vytvořit instanci vstupních parametrů.</span><span class="sxs-lookup"><span data-stu-id="b9931-154">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="b9931-155">Pokud metoda knihoven BLL očekává instanci `ProductsRow`, prvek ObjectDataSource se pokusí jeden vytvořit, ale selže z důvodu nedostatku výchozího konstruktoru bez parametrů.</span><span class="sxs-lookup"><span data-stu-id="b9931-155">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="b9931-156">Další informace o tomto problému naleznete v následujících dvou příspěvcích na fórech ASP.NET: [aktualizace objectdatasources pomocí datových sad se silnými typy](https://forums.asp.net/1098630/ShowPost.aspx)a [problém s datovou sadou ObjectDataSource a silně typovaného typu](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="b9931-156">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="b9931-157">Dále kód v `AddProduct` i `UpdateProduct`vytvoří instanci `ProductsRow` a naplní ji hodnotami, které jsou právě předány.</span><span class="sxs-lookup"><span data-stu-id="b9931-157">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="b9931-158">Při přiřazování hodnot k datacolumnům objektu DataRow může dojít k různým kontrolám ověření na úrovni pole.</span><span class="sxs-lookup"><span data-stu-id="b9931-158">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="b9931-159">Proto ručním vložením předaných hodnot do objektu DataRow pomůže zajistit, aby byla data předána do metody knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="b9931-159">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="b9931-160">Třídy DataRow silného typu generované v aplikaci Visual Studio bohužel nepoužívají typy s možnou hodnotou null.</span><span class="sxs-lookup"><span data-stu-id="b9931-160">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="b9931-161">Místo toho, abyste označili, že konkrétní DataColumn v objektu DataRow by měl odpovídat hodnotě `NULL` databáze, je nutné použít metodu `SetColumnNameNull()`.</span><span class="sxs-lookup"><span data-stu-id="b9931-161">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="b9931-162">V `UpdateProduct` nejdřív nahrajeme produkt, který se má aktualizovat pomocí `GetProductByProductID(productID)`.</span><span class="sxs-lookup"><span data-stu-id="b9931-162">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="b9931-163">I když se to může zdát jako zbytečných cest k databázi, tato dodatečná cesta se v budoucích kurzech ukáže v budoucích kurzech, které se seznámí s optimistické souběžnosti.</span><span class="sxs-lookup"><span data-stu-id="b9931-163">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="b9931-164">Optimistická souběžnost je technika, která zajistí, že dva uživatelé, kteří pracují současně se stejnými daty, nechtěně nepřepisují žádné další změny.</span><span class="sxs-lookup"><span data-stu-id="b9931-164">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="b9931-165">Při překonávání celého záznamu je také snazší vytvořit metody aktualizace v knihoven BLL, které upraví pouze podmnožinu sloupců objektu DataRow.</span><span class="sxs-lookup"><span data-stu-id="b9931-165">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="b9931-166">Při zkoumání `SuppliersBLL` třídy uvidíme takový příklad.</span><span class="sxs-lookup"><span data-stu-id="b9931-166">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="b9931-167">Nakonec si všimněte, že třída `ProductsBLL` má pro ni použit [atribut DataObject](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) (syntaxe `[System.ComponentModel.DataObject]` těsně před příkazem třídy v horní části souboru) a metody mají [atributy DataObjectMethodAttribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="b9931-167">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="b9931-168">Atribut `DataObject` označuje třídu jako objekt vhodný pro vazbu k [ovládacímu prvku ObjectDataSource](https://msdn.microsoft.com/library/9a4kyhcx.aspx), zatímco `DataObjectMethodAttribute` označuje účel metody.</span><span class="sxs-lookup"><span data-stu-id="b9931-168">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="b9931-169">Jak uvidíme v budoucích kurzech, ASP.NET 2.0 ObjectDataSource usnadňuje deklarativní přístup k datům z třídy.</span><span class="sxs-lookup"><span data-stu-id="b9931-169">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="b9931-170">Aby bylo možné filtrovat seznam možných tříd, ke kterým lze navazovat vazby v průvodci ObjectDataSource, ve výchozím nastavení se v rozevíracím seznamu Průvodce zobrazují pouze ty třídy označené jako `DataObjects`.</span><span class="sxs-lookup"><span data-stu-id="b9931-170">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="b9931-171">Třída `ProductsBLL` bude fungovat stejně i bez těchto atributů, ale přidáním jim usnadňuje práci v průvodci ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="b9931-171">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="b9931-172">Přidání dalších tříd</span><span class="sxs-lookup"><span data-stu-id="b9931-172">Adding the Other Classes</span></span>

<span data-ttu-id="b9931-173">Po dokončení `ProductsBLL` třídy je stále potřeba přidat třídy pro práci s kategoriemi, dodavateli a zaměstnanci.</span><span class="sxs-lookup"><span data-stu-id="b9931-173">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="b9931-174">Vytvořte si chvilku pro vytvoření následujících tříd a metod pomocí konceptů z výše uvedeného příkladu:</span><span class="sxs-lookup"><span data-stu-id="b9931-174">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="b9931-175">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="b9931-175">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="b9931-176">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="b9931-176">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="b9931-177">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="b9931-177">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="b9931-178">Jedna z metod, které se zaznamená, je metoda `UpdateSupplierAddress` `SuppliersBLL` třídy.</span><span class="sxs-lookup"><span data-stu-id="b9931-178">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="b9931-179">Tato metoda poskytuje rozhraní pro aktualizaci pouze informací o adrese dodavatele.</span><span class="sxs-lookup"><span data-stu-id="b9931-179">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="b9931-180">Interně Tato metoda přečte v objektu `SupplierDataRow` pro zadanou `supplierID` (pomocí `GetSupplierBySupplierID`), nastaví jeho vlastnosti související s adresou a pak zavolá do `Update` metody `SupplierDataTable`.</span><span class="sxs-lookup"><span data-stu-id="b9931-180">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="b9931-181">Následující metoda `UpdateSupplierAddress`:</span><span class="sxs-lookup"><span data-stu-id="b9931-181">The `UpdateSupplierAddress` method follows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample2.cs)]

<span data-ttu-id="b9931-182">Informace najdete v tomto článku ke stažení pro úplnou implementaci tříd knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="b9931-182">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="b9931-183">Krok 2: přístup k typovým datovým sadám prostřednictvím tříd knihoven BLL</span><span class="sxs-lookup"><span data-stu-id="b9931-183">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="b9931-184">V prvním kurzu jsme viděli příklady práce přímo s typovou datovou sadou, ale s přidáním našich tříd knihoven BLL, musí prezentační vrstva pracovat s knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="b9931-184">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="b9931-185">V příkladu `AllProducts.aspx` v prvním kurzu `ProductsTableAdapter` byl použit k navázání seznamu produktů na prvek GridView, jak je znázorněno v následujícím kódu:</span><span class="sxs-lookup"><span data-stu-id="b9931-185">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample3.cs)]

<span data-ttu-id="b9931-186">Chcete-li použít nové třídy knihoven BLL, je třeba změnit první řádek kódu pouhým nahrazením objektu `ProductsTableAdapter` objektem `ProductBLL`:</span><span class="sxs-lookup"><span data-stu-id="b9931-186">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample4.cs)]

<span data-ttu-id="b9931-187">Ke třídám knihoven BLL lze také přistupovat deklarativně (jako lze použít typovou datovou sadu) pomocí prvku ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="b9931-187">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="b9931-188">V následujících kurzech se podrobněji podíváme na ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="b9931-188">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>

<span data-ttu-id="b9931-189">[![se seznam produktů zobrazuje v prvku GridView.](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b9931-189">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-cs/_static/image4.png)](creating-a-business-logic-layer-cs/_static/image3.png)</span></span>

<span data-ttu-id="b9931-190">**Obrázek 3**: seznam produktů se zobrazí v prvku GridView ([kliknutím zobrazíte obrázek v plné velikosti](creating-a-business-logic-layer-cs/_static/image5.png)).</span><span class="sxs-lookup"><span data-stu-id="b9931-190">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image5.png))</span></span>

## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="b9931-191">Krok 3: Přidání ověřování na úrovni pole do tříd DataRow</span><span class="sxs-lookup"><span data-stu-id="b9931-191">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="b9931-192">Ověřování na úrovni pole jsou kontroly, které se vztahují k hodnotám vlastností obchodních objektů při vkládání nebo aktualizaci.</span><span class="sxs-lookup"><span data-stu-id="b9931-192">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="b9931-193">Některá ověřovací pravidla na úrovni polí pro produkty zahrnují:</span><span class="sxs-lookup"><span data-stu-id="b9931-193">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="b9931-194">Pole `ProductName` musí mít délku 40 znaků nebo méně.</span><span class="sxs-lookup"><span data-stu-id="b9931-194">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="b9931-195">Pole `QuantityPerUnit` nesmí být delší než 20 znaků.</span><span class="sxs-lookup"><span data-stu-id="b9931-195">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="b9931-196">Pole `ProductID`, `ProductName`a `Discontinued` jsou povinná, ale všechna ostatní pole jsou volitelná.</span><span class="sxs-lookup"><span data-stu-id="b9931-196">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="b9931-197">Pole `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`a `ReorderLevel` musí být větší nebo rovna nule.</span><span class="sxs-lookup"><span data-stu-id="b9931-197">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="b9931-198">Tato pravidla mohou a by se měla vyjádřit na úrovni databáze.</span><span class="sxs-lookup"><span data-stu-id="b9931-198">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="b9931-199">Omezení počtu znaků u polí `ProductName` a `QuantityPerUnit` jsou zachycena datovými typy těchto sloupců v tabulce `Products` (`nvarchar(40)` a `nvarchar(20)`uvedeném v uvedeném pořadí).</span><span class="sxs-lookup"><span data-stu-id="b9931-199">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="b9931-200">Zda jsou pole povinná a volitelná, se vyjádří, pokud sloupec databázových tabulek povoluje `NULL` s.</span><span class="sxs-lookup"><span data-stu-id="b9931-200">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="b9931-201">Existují čtyři [kontrolní omezení](https://msdn.microsoft.com/library/ms188258.aspx) , která zajišťují, že se do `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`nebo `ReorderLevel` sloupců dají pouze hodnoty větší než nula nebo se jim rovnat.</span><span class="sxs-lookup"><span data-stu-id="b9931-201">Four [check constraints](https://msdn.microsoft.com/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="b9931-202">Kromě vynucování těchto pravidel v databázi by měly být také vynuceny na úrovni datové sady.</span><span class="sxs-lookup"><span data-stu-id="b9931-202">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="b9931-203">Ve skutečnosti je délka pole a údaj, zda je hodnota vyžadována nebo volitelná, již zachycena pro sadu datových sloupců v objektu DataTable.</span><span class="sxs-lookup"><span data-stu-id="b9931-203">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="b9931-204">Pokud chcete zobrazit automaticky zadané ověřování na úrovni pole, přejděte do návrháře DataSet, vyberte pole z jedné z datových tabulek a pak přejděte na okno Vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="b9931-204">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="b9931-205">Jak ukazuje obrázek 4, `QuantityPerUnit` DataColumn v `ProductsDataTable` má maximální délku 20 znaků a povoluje `NULL` hodnoty.</span><span class="sxs-lookup"><span data-stu-id="b9931-205">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="b9931-206">Pokud se pokusíte nastavit vlastnost `QuantityPerUnit` `ProductsDataRow`na hodnotu řetězce delší než 20 znaků, bude vyvolána `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="b9931-206">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>

<span data-ttu-id="b9931-207">[![DataColumn poskytuje základní ověřování na úrovni pole.](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="b9931-207">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-cs/_static/image7.png)](creating-a-business-logic-layer-cs/_static/image6.png)</span></span>

<span data-ttu-id="b9931-208">**Obrázek 4**: sloupec DataColumn poskytuje základní ověřování na úrovni pole ([kliknutím zobrazíte obrázek v plné velikosti](creating-a-business-logic-layer-cs/_static/image8.png)).</span><span class="sxs-lookup"><span data-stu-id="b9931-208">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image8.png))</span></span>

<span data-ttu-id="b9931-209">Bohužel nemůžeme specifikovat kontroly hranic, například `UnitPrice` hodnota musí být větší nebo rovna nule, a to prostřednictvím okno Vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="b9931-209">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="b9931-210">Pro poskytnutí tohoto typu ověřování na úrovni pole musíme vytvořit obslužnou rutinu události pro událost [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) objektu DataTable.</span><span class="sxs-lookup"><span data-stu-id="b9931-210">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="b9931-211">Jak je uvedeno v [předchozím kurzu](creating-a-data-access-layer-cs.md), datové sady, datové tabulky a objekty DataRow vytvořené typovou datovou sadou lze rozšířit prostřednictvím použití dílčích tříd.</span><span class="sxs-lookup"><span data-stu-id="b9931-211">As mentioned in the [preceding tutorial](creating-a-data-access-layer-cs.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="b9931-212">Pomocí této techniky můžeme vytvořit obslužnou rutinu události `ColumnChanging` pro třídu `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="b9931-212">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="b9931-213">Začněte vytvořením třídy ve složce `App_Code` s názvem `ProductsDataTable.ColumnChanging.cs`.</span><span class="sxs-lookup"><span data-stu-id="b9931-213">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.cs`.</span></span>

<span data-ttu-id="b9931-214">[![přidat novou třídu do složky App_Code](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b9931-214">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-cs/_static/image10.png)](creating-a-business-logic-layer-cs/_static/image9.png)</span></span>

<span data-ttu-id="b9931-215">**Obrázek 5**: Přidání nové třídy do složky `App_Code` ([kliknutím zobrazíte obrázek v plné velikosti](creating-a-business-logic-layer-cs/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="b9931-215">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-cs/_static/image11.png))</span></span>

<span data-ttu-id="b9931-216">Dále vytvořte obslužnou rutinu události pro událost `ColumnChanging`, která zajistí, aby hodnoty sloupce `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`a `ReorderLevel` (pokud nejsou `NULL`) byly větší nebo rovny nule.</span><span class="sxs-lookup"><span data-stu-id="b9931-216">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="b9931-217">Pokud je některý z těchto sloupců mimo rozsah, vyvolejte `ArgumentException`.</span><span class="sxs-lookup"><span data-stu-id="b9931-217">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="b9931-218">ProductsDataTable.ColumnChanging.cs</span><span class="sxs-lookup"><span data-stu-id="b9931-218">ProductsDataTable.ColumnChanging.cs</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample5.cs)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="b9931-219">Krok 4: Přidání vlastních obchodních pravidel do tříd knihoven BLL</span><span class="sxs-lookup"><span data-stu-id="b9931-219">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="b9931-220">Kromě ověřování na úrovni pole můžou existovat vlastní obchodní pravidla vysoké úrovně, která zahrnují různé entity nebo koncepty, které se vyhodnotit na úrovni jednoho sloupce, například:</span><span class="sxs-lookup"><span data-stu-id="b9931-220">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="b9931-221">Pokud je produkt vyřazený, jeho `UnitPrice` nejde aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="b9931-221">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="b9931-222">Země pobytu zaměstnance musí být stejná jako země pobytu svého nadřízeného.</span><span class="sxs-lookup"><span data-stu-id="b9931-222">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="b9931-223">Produkt nelze ukončit, pokud se jedná o jediný produkt poskytovaný dodavatelem.</span><span class="sxs-lookup"><span data-stu-id="b9931-223">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="b9931-224">Třídy knihoven BLL by měly obsahovat kontroly, aby se zajistilo dodržování obchodních pravidel aplikace.</span><span class="sxs-lookup"><span data-stu-id="b9931-224">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="b9931-225">Tyto kontroly lze přidat přímo do metod, na které se vztahují.</span><span class="sxs-lookup"><span data-stu-id="b9931-225">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="b9931-226">Představte si, že naše obchodní pravidla určují, že produkt nejde označit jako vyřazený, pokud byl jediným produktem od daného dodavatele.</span><span class="sxs-lookup"><span data-stu-id="b9931-226">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="b9931-227">To znamená, že pokud produkt *X* byl jediným produktem, který jsme koupili *od dodavatele a*, nemůžeme *X* označit jako vyřazené; Pokud se ale dodavatel *Y* doručí se třemi produkty, *a*, *B*a *C*, můžeme označit všechny z nich jako ukončené.</span><span class="sxs-lookup"><span data-stu-id="b9931-227">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="b9931-228">Liché obchodní pravidlo, ale obchodní pravidla a běžné zvyklosti nejsou vždycky zarovnaná!</span><span class="sxs-lookup"><span data-stu-id="b9931-228">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="b9931-229">Abyste toto obchodní pravidlo vynutili v `UpdateProducts` metodě, začneme tak, že zkontrolujete, jestli `Discontinued` byla nastavená na `true`, a pokud ano, zavoláme `GetProductsBySupplierID` k určení, kolik produktů jsme si koupili od dodavatele tohoto produktu.</span><span class="sxs-lookup"><span data-stu-id="b9931-229">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `true` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="b9931-230">Pokud od tohoto dodavatele koupíte jenom jeden produkt, vyvoláme `ApplicationException`.</span><span class="sxs-lookup"><span data-stu-id="b9931-230">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample6.cs)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="b9931-231">Reakce na chyby ověřování v prezentační vrstvě</span><span class="sxs-lookup"><span data-stu-id="b9931-231">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="b9931-232">Při volání knihoven BLL z prezentační vrstvy se můžeme rozhodnout, zda se pokusíte zpracovat jakékoli výjimky, které mohou být vyvolány, nebo umožnit jejich bublinu až do ASP.NET (což vyvolá událost `Error` `HttpApplication`).</span><span class="sxs-lookup"><span data-stu-id="b9931-232">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="b9931-233">Abychom mohli zpracovat výjimku při práci s knihoven BLL programově, můžeme použít příkaz [Try... blok catch](https://msdn.microsoft.com/library/0yd65esw.aspx) , jak ukazuje následující příklad:</span><span class="sxs-lookup"><span data-stu-id="b9931-233">To handle an exception when working with the BLL programmatically, we can use a [try...catch](https://msdn.microsoft.com/library/0yd65esw.aspx) block, as the following example shows:</span></span>

[!code-csharp[Main](creating-a-business-logic-layer-cs/samples/sample7.cs)]

<span data-ttu-id="b9931-234">Jak uvidíme v budoucích kurzech, zpracování výjimek, které se doplňují z knihoven BLL při použití webového ovládacího prvku data pro vložení, aktualizaci nebo odstranění dat, je možné zpracovat přímo v obslužné rutině události, a to na rozdíl od nutnosti zalamovat kód v `try...catch`ch blocích.</span><span class="sxs-lookup"><span data-stu-id="b9931-234">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `try...catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="b9931-235">Souhrn</span><span class="sxs-lookup"><span data-stu-id="b9931-235">Summary</span></span>

<span data-ttu-id="b9931-236">Dobře navržená aplikace je vytvořená do samostatných vrstev, z nichž každý zapouzdřuje určitou roli.</span><span class="sxs-lookup"><span data-stu-id="b9931-236">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="b9931-237">V prvním kurzu této série článků jsme vytvořili vrstvu přístupu k datům pomocí zadaných datových sad; v tomto kurzu jsme sestavili vrstvu obchodní logiky jako řadu tříd v `App_Code` složce aplikace, která volá na naši DAL.</span><span class="sxs-lookup"><span data-stu-id="b9931-237">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="b9931-238">KNIHOVEN BLL implementuje logiku na úrovni polí a na úrovni firmy pro naši aplikaci.</span><span class="sxs-lookup"><span data-stu-id="b9931-238">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="b9931-239">Kromě vytvoření samostatného knihoven BLL jako v tomto kurzu je další možností rozšířit metody objekty TableAdapter pomocí částečných tříd.</span><span class="sxs-lookup"><span data-stu-id="b9931-239">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="b9931-240">Použití této techniky ale neumožňuje přepsat existující metody ani Nedělit naše DAL a naše knihoven BLL jako čistě jako přístup, který jsme udělali v tomto článku.</span><span class="sxs-lookup"><span data-stu-id="b9931-240">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="b9931-241">Po dokončení DAL a knihoven BLL jsme připraveni začít s naší prezentační vrstvou.</span><span class="sxs-lookup"><span data-stu-id="b9931-241">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="b9931-242">V [dalším kurzu](master-pages-and-site-navigation-cs.md) podíváme se na stručný přehled z témat pro přístup k datům a definujte konzistentní rozložení stránky pro použití v rámci kurzů.</span><span class="sxs-lookup"><span data-stu-id="b9931-242">In the [next tutorial](master-pages-and-site-navigation-cs.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="b9931-243">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="b9931-243">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="b9931-244">O autorovi</span><span class="sxs-lookup"><span data-stu-id="b9931-244">About the Author</span></span>

<span data-ttu-id="b9931-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor 7 ASP/ASP. NET Books a zakladatel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="b9931-245">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b9931-246">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="b9931-246">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b9931-247">Nejnovější kniha je [*Sams naučit se ASP.NET 2,0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="b9931-247">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="b9931-248">Dá se získat na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b9931-248">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="b9931-249">nebo prostřednictvím svého blogu, který najdete na adrese [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="b9931-249">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="b9931-250">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="b9931-250">Special Thanks To</span></span>

<span data-ttu-id="b9931-251">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="b9931-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="b9931-252">Recenzenti potenciálních zákazníků pro tento kurz byly Liz Shulok, Dennis Patterson, Carlos Santos a Hilton Giesenow.</span><span class="sxs-lookup"><span data-stu-id="b9931-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="b9931-253">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="b9931-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="b9931-254">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b9931-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="b9931-255">[Předchozí](creating-a-data-access-layer-cs.md)
> [Další](master-pages-and-site-navigation-cs.md)</span><span class="sxs-lookup"><span data-stu-id="b9931-255">[Previous](creating-a-data-access-layer-cs.md)
[Next](master-pages-and-site-navigation-cs.md)</span></span>
