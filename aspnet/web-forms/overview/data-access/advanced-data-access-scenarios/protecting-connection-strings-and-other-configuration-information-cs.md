---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
title: Ochrana připojovacích řetězců a dalších konfiguračních údajů (C#) | Dokumentace Microsoftu
author: rick-anderson
description: Aplikace ASP.NET obvykle ukládá informace o konfiguraci v souboru Web.config. Některé z těchto informací je citlivý a zaručuje ochranu. Ve výchozí...
ms.author: riande
ms.date: 08/03/2007
ms.assetid: ad8dd396-30f7-4abe-ac02-a0b84422e5be
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
msc.type: authoredcontent
ms.openlocfilehash: eab1ad6cd4636ab3d35988ec8dc762c8a8f51ef4
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/09/2019
ms.locfileid: "59421131"
---
# <a name="protecting-connection-strings-and-other-configuration-information-c"></a><span data-ttu-id="d03b8-105">Ochrana připojovacích řetězců a dalších konfiguračních údajů (C#)</span><span class="sxs-lookup"><span data-stu-id="d03b8-105">Protecting Connection Strings and Other Configuration Information (C#)</span></span>

<span data-ttu-id="d03b8-106">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d03b8-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d03b8-107">[Stáhněte si kód](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) nebo [stahovat PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="d03b8-107">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) or [Download PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span></span>

> <span data-ttu-id="d03b8-108">Aplikace ASP.NET obvykle ukládá informace o konfiguraci v souboru Web.config.</span><span class="sxs-lookup"><span data-stu-id="d03b8-108">An ASP.NET application typically stores configuration information in a Web.config file.</span></span> <span data-ttu-id="d03b8-109">Některé z těchto informací je citlivý a zaručuje ochranu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-109">Some of this information is sensitive and warrants protection.</span></span> <span data-ttu-id="d03b8-110">Ve výchozím nastavení nebude možné tento soubor dodávat do návštěvníky webu, ale správce nebo se hacker může získat přístup k systému souborů webového serveru a zobrazit obsah souboru.</span><span class="sxs-lookup"><span data-stu-id="d03b8-110">By default this file will not be served to a Web site visitor, but an administrator or a hacker may gain access to the Web server's file system and view the contents of the file.</span></span> <span data-ttu-id="d03b8-111">V tomto kurzu jsme dozvíte, že technologie ASP.NET 2.0, umožníte nám kvůli ochraně citlivých informací tím, že šifruje části souboru Web.config.</span><span class="sxs-lookup"><span data-stu-id="d03b8-111">In this tutorial we learn that ASP.NET 2.0 allows us to protect sensitive information by encrypting sections of the Web.config file.</span></span>


## <a name="introduction"></a><span data-ttu-id="d03b8-112">Úvod</span><span class="sxs-lookup"><span data-stu-id="d03b8-112">Introduction</span></span>

<span data-ttu-id="d03b8-113">Informace o konfiguraci pro aplikace ASP.NET je obvykle uložen v souboru XML s názvem `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="d03b8-113">Configuration information for ASP.NET applications is commonly stored in an XML file named `Web.config`.</span></span> <span data-ttu-id="d03b8-114">V průběhu těchto kurzů jsme aktualizovali `Web.config` několika časy.</span><span class="sxs-lookup"><span data-stu-id="d03b8-114">Over the course of these tutorials we have updated the `Web.config` a handful of times.</span></span> <span data-ttu-id="d03b8-115">Při vytváření `Northwind` typované datové sady v [první kurz](../introduction/creating-a-data-access-layer-cs.md), například informace o připojovacím řetězci byl automaticky přidán do `Web.config` v `<connectionStrings>` oddílu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-115">When creating the `Northwind` Typed DataSet in the [first tutorial](../introduction/creating-a-data-access-layer-cs.md), for example, connection string information was automatically added to `Web.config` in the `<connectionStrings>` section.</span></span> <span data-ttu-id="d03b8-116">V pozdější [stránky předlohy a navigace na webu](../introduction/master-pages-and-site-navigation-cs.md) kurzu ručně aktualizovali jsme `Web.config`, přidáním `<pages>` element označující, že všechny stránky technologie ASP.NET v našem projektu by měly používat `DataWebControls` motiv.</span><span class="sxs-lookup"><span data-stu-id="d03b8-116">Later, in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, we manually updated `Web.config`, adding a `<pages>` element indicating that all of the ASP.NET pages in our project should use the `DataWebControls` Theme.</span></span>

<span data-ttu-id="d03b8-117">Protože `Web.config` mohou obsahovat citlivá data, jako je například připojovací řetězce, je důležité, který obsah `Web.config` zachovaná, bezpečné a skryté z neoprávněné uživatele.</span><span class="sxs-lookup"><span data-stu-id="d03b8-117">Since `Web.config` may contain sensitive data such as connection strings, it is important that the contents of `Web.config` be kept safe and hidden from unauthorized viewers.</span></span> <span data-ttu-id="d03b8-118">Ve výchozím nastavení, všechny HTTP žádosti do souboru s `.config` rozšíření se postará modul ASP.NET, který vrátí *typ stránky není poskytováni,* zprávy je znázorněno na obrázku 1.</span><span class="sxs-lookup"><span data-stu-id="d03b8-118">By default, any HTTP request to a file with the `.config` extension is handled by the ASP.NET engine, which returns the *This type of page is not served* message shown in Figure 1.</span></span> <span data-ttu-id="d03b8-119">To znamená, že nelze zobrazit návštěvníci vašeho `Web.config` s obsah souboru tak, že jednoduše zadáte http://www.YourServer.com/Web.config do adresního řádku svého prohlížeče s.</span><span class="sxs-lookup"><span data-stu-id="d03b8-119">This means that visitors cannot view your `Web.config` file s contents by simply entering http://www.YourServer.com/Web.config into their browser s Address bar.</span></span>


[![V<span data-ttu-id="d03b8-120">isiting Web.config prostřednictvím prohlížeč vrátí tento typ stránky není obsluhovat zprávy]</span><span class="sxs-lookup"><span data-stu-id="d03b8-120">isiting Web.config Through a Browser Returns a This type of page is not served Message]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)

<span data-ttu-id="d03b8-121">**Obrázek 1**: Navštívit `Web.config` prostřednictvím prohlížeč vrátí tento typ stránky není poskytováni zprávy ([kliknutím ji zobrazíte obrázek v plné velikosti](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="d03b8-121">**Figure 1**: Visiting `Web.config` Through a Browser Returns a This type of page is not served Message ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span></span>


<span data-ttu-id="d03b8-122">Ale co když je útočník schopen nalézt některé zneužití, umožňující jí chcete-li zobrazit vaše `Web.config` s obsah souboru?</span><span class="sxs-lookup"><span data-stu-id="d03b8-122">But what if an attacker is able to find some other exploit that allows her to view your `Web.config` file s contents?</span></span> <span data-ttu-id="d03b8-123">Co může útočník udělat pomocí těchto informací a popíše, co děláte dalším stupněm ochrany citlivých informací v rámci `Web.config`?</span><span class="sxs-lookup"><span data-stu-id="d03b8-123">What could an attacker do with this information, and what steps can be taken to further protect the sensitive information within `Web.config`?</span></span> <span data-ttu-id="d03b8-124">Naštěstí většině částí v `Web.config` neobsahují citlivé informace.</span><span class="sxs-lookup"><span data-stu-id="d03b8-124">Fortunately, most sections in `Web.config` do not contain sensitive information.</span></span> <span data-ttu-id="d03b8-125">Jaké poškození může útočník perpetrate Pokud název výchozí motivu, který používá vaše stránky technologie ASP.NET, které znají?</span><span class="sxs-lookup"><span data-stu-id="d03b8-125">What harm can an attacker perpetrate if they know the name of the default Theme used by your ASP.NET pages?</span></span>

<span data-ttu-id="d03b8-126">Některé `Web.config` části, ale obsahují citlivé informace, které mohou zahrnovat připojovací řetězce, uživatelská jména, hesla, názvy serverů, šifrovacích klíčů a tak dále.</span><span class="sxs-lookup"><span data-stu-id="d03b8-126">Certain `Web.config` sections, however, contain sensitive information that may include connection strings, user names, passwords, server names, encryption keys, and so forth.</span></span> <span data-ttu-id="d03b8-127">Tyto informace se většinou nacházejí ve následující `Web.config` oddíly:</span><span class="sxs-lookup"><span data-stu-id="d03b8-127">This information is typically found in the following `Web.config` sections:</span></span>

- `<appSettings>`
- `<connectionStrings>`
- `<identity>`
- `<sessionState>`

<span data-ttu-id="d03b8-128">V tomto kurzu se podíváme na techniky k ochraně těchto citlivých informací konfigurace.</span><span class="sxs-lookup"><span data-stu-id="d03b8-128">In this tutorial we will look at techniques for protecting such sensitive configuration information.</span></span> <span data-ttu-id="d03b8-129">Jak vidíte, rozhraní .NET Framework verze 2.0 obsahuje chráněné konfigurace systému, který umožňuje programově šifrování a dešifrování vybranou konfigurační oddíly podrobným.</span><span class="sxs-lookup"><span data-stu-id="d03b8-129">As we will see, the .NET Framework version 2.0 includes a protected configurations system that makes programmatically encrypting and decrypting selected configuration sections a breeze.</span></span>

> [!NOTE]
> <span data-ttu-id="d03b8-130">V tomto kurzu končí podívat s doporučením společnosti Microsoft pro připojení k databázi z aplikace technologie ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d03b8-130">This tutorial concludes with a look at Microsoft s recommendations for connecting to a database from an ASP.NET application.</span></span> <span data-ttu-id="d03b8-131">Kromě šifrování připojovací řetězce, pomáhá posílit ochranu systému díky zajištění, které se připojujete k databázi zabezpečeným způsobem.</span><span class="sxs-lookup"><span data-stu-id="d03b8-131">In addition to encrypting your connection strings, you can help harden your system by ensuring that you are connecting to the database in a secure fashion.</span></span>


## <a name="step-1-exploring-aspnet-20-s-protected-configuration-options"></a><span data-ttu-id="d03b8-132">Krok 1: Zkoumání ASP.NET 2.0 s chráněné možnosti konfigurace</span><span class="sxs-lookup"><span data-stu-id="d03b8-132">Step 1: Exploring ASP.NET 2.0 s Protected Configuration Options</span></span>

<span data-ttu-id="d03b8-133">Technologie ASP.NET 2.0 obsahuje chráněné konfigurace systému pro šifrování a dešifrování informace o konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="d03b8-133">ASP.NET 2.0 includes a protected configuration system for encrypting and decrypting configuration information.</span></span> <span data-ttu-id="d03b8-134">To zahrnuje metody v rozhraní .NET Framework, je možné programově zašifrovat nebo dešifrovat informace o konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="d03b8-134">This includes methods in the .NET Framework that can be used to programmatically encrypt or decrypt configuration information.</span></span> <span data-ttu-id="d03b8-135">Používá systém chráněné konfigurace [modelu poskytovatele](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), která vývojářům umožňuje zvolit, jaké implementaci se používá.</span><span class="sxs-lookup"><span data-stu-id="d03b8-135">The protected configuration system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), which allows developers to choose what cryptographic implementation is used.</span></span>

<span data-ttu-id="d03b8-136">Rozhraní .NET Framework se dodává s dva poskytovatelé chráněné konfigurace:</span><span class="sxs-lookup"><span data-stu-id="d03b8-136">The .NET Framework ships with two protected configuration providers:</span></span>

- <span data-ttu-id="d03b8-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) -používá asymetrický [algoritmus RSA](http://en.wikipedia.org/wiki/Rsa) pro šifrování a dešifrování.</span><span class="sxs-lookup"><span data-stu-id="d03b8-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) - uses the asymmetric [RSA algorithm](http://en.wikipedia.org/wiki/Rsa) for encryption and decryption.</span></span>
- <span data-ttu-id="d03b8-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) -používá Windows [Data Protection API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) pro šifrování a dešifrování.</span><span class="sxs-lookup"><span data-stu-id="d03b8-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) - uses the Windows [Data Protection API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) for encryption and decryption.</span></span>

<span data-ttu-id="d03b8-139">Od systému chráněné konfigurace implementuje vzor návrhu poskytovatele, je možné vytvářet vlastní chráněné konfigurace zprostředkovatele a zařadit ho do své aplikace.</span><span class="sxs-lookup"><span data-stu-id="d03b8-139">Since the protected configuration system implements the provider design pattern, it is possible to create your own protected configuration provider and plug it into your application.</span></span> <span data-ttu-id="d03b8-140">Zobrazit [implementace poskytovatele konfigurace chráněné](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) Další informace o tomto procesu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-140">See [Implementing a Protected Configuration Provider](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) for more information on this process.</span></span>

<span data-ttu-id="d03b8-141">Poskytovatelé RSA a DPAPI pomocí kláves pro jejich šifrování a dešifrování rutiny a tyto klíče mohou být uloženy v počítači - nebo -úrovni uživatele.</span><span class="sxs-lookup"><span data-stu-id="d03b8-141">The RSA and DPAPI providers use keys for their encryption and decryption routines, and these keys can be stored at the machine- or user-level.</span></span> <span data-ttu-id="d03b8-142">Úroveň počítače klíče jsou ideální pro scénáře, ve kterém je webová aplikace spuštěna na svůj vlastní vyhrazený server nebo pokud existuje více aplikací na serveru, potřebujete sdílet šifrované informace.</span><span class="sxs-lookup"><span data-stu-id="d03b8-142">Machine-level keys are ideal for scenarios where the web application runs on its own dedicated server or if there are multiple applications on a server that need to share encrypted information.</span></span> <span data-ttu-id="d03b8-143">Individuální klíče jsou bezpečnější možnost v sdílená hostitelská prostředí, kde jiné aplikace na stejném serveru správně neměl moct dešifrovat konfigurační oddíly funkce s chránit vaše aplikace.</span><span class="sxs-lookup"><span data-stu-id="d03b8-143">User-level keys are a more secure option in shared hosting environments where other applications on the same server should not be able to decrypt your application s protected configuration sections.</span></span>

<span data-ttu-id="d03b8-144">V tomto kurzu použije našich příkladů DPAPI zprostředkovatele a klíče úrovni počítače.</span><span class="sxs-lookup"><span data-stu-id="d03b8-144">In this tutorial our examples will use the DPAPI provider and machine-level keys.</span></span> <span data-ttu-id="d03b8-145">Konkrétně se podíváme na šifrování `<connectionStrings>` tématu `Web.config`, i když chráněný konfigurační systém lze použít k většině žádné šifrování `Web.config` oddílu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-145">Specifically, we will look at encrypting the `<connectionStrings>` section in `Web.config`, although the protected configuration system can be used to encrypt most any `Web.config` section.</span></span> <span data-ttu-id="d03b8-146">Informace o používání klíčů individuální nebo pomocí zprostředkovatele RSA vyhledejte prostředky v části Další čtení na konci tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-146">For information on using user-level keys or using the RSA provider, consult the resources in the Further Readings section at the end of this tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="d03b8-147">`RSAProtectedConfigurationProvider` a `DPAPIProtectedConfigurationProvider` poskytovatelé jsou registrované ve `machine.config` soubor s názvy zprostředkovatelů `RsaProtectedConfigurationProvider` a `DataProtectionConfigurationProvider`v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="d03b8-147">The `RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider` providers are registered in the `machine.config` file with the provider names `RsaProtectedConfigurationProvider` and `DataProtectionConfigurationProvider`, respectively.</span></span> <span data-ttu-id="d03b8-148">Při šifrování nebo dešifrování informace o konfiguraci bude potřeba zadat název odpovídající zprostředkovatele (`RsaProtectedConfigurationProvider` nebo `DataProtectionConfigurationProvider`) namísto skutečný typ název (`RSAProtectedConfigurationProvider` a `DPAPIProtectedConfigurationProvider`).</span><span class="sxs-lookup"><span data-stu-id="d03b8-148">When encrypting or decrypting configuration information we will need to supply the appropriate provider name (`RsaProtectedConfigurationProvider` or `DataProtectionConfigurationProvider`) rather than the actual type name (`RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider`).</span></span> <span data-ttu-id="d03b8-149">Můžete najít `machine.config` soubor `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG` složky.</span><span class="sxs-lookup"><span data-stu-id="d03b8-149">You can find the `machine.config` file in the `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG` folder.</span></span>


## <a name="step-2-programmatically-encrypting-and-decrypting-configuration-sections"></a><span data-ttu-id="d03b8-150">Krok 2: Programově šifrování a dešifrování konfigurační oddíly funkce</span><span class="sxs-lookup"><span data-stu-id="d03b8-150">Step 2: Programmatically Encrypting and Decrypting Configuration Sections</span></span>

<span data-ttu-id="d03b8-151">Po zadání několika řádků kódu jsme šifrování nebo dešifrování konkrétní konfigurační oddíl se zadaným zprostředkovatelem.</span><span class="sxs-lookup"><span data-stu-id="d03b8-151">With a few lines of code we can encrypt or decrypt a particular configuration section using a specified provider.</span></span> <span data-ttu-id="d03b8-152">Kód, protože jsme se zobrazí po chvíli, jednoduše prostřednictvím kódu programu odkazovat na části odpovídající konfiguraci volat jeho `ProtectSection` nebo `UnprotectSection` metodu a poté zavolejte `Save` metoda a zachová tak změny.</span><span class="sxs-lookup"><span data-stu-id="d03b8-152">The code, as we will see shortly, simply needs to programmatically reference the appropriate configuration section, call its `ProtectSection` or `UnprotectSection` method, and then call the `Save` method to persist the changes.</span></span> <span data-ttu-id="d03b8-153">Kromě toho rozhraní .NET Framework obsahuje užitečné příkazového řádku nástroj, který můžete šifrovat a dešifrovat informace o konfiguraci.</span><span class="sxs-lookup"><span data-stu-id="d03b8-153">Moreover, the .NET Framework includes a helpful command line utility that can encrypt and decrypt configuration information.</span></span> <span data-ttu-id="d03b8-154">Podíváme se na tento nástroj příkazového řádku v kroku 3.</span><span class="sxs-lookup"><span data-stu-id="d03b8-154">We will explore this command line utility in Step 3.</span></span>

<span data-ttu-id="d03b8-155">Pro ilustraci programově chrání informace o konfiguraci, umožňují s vytvoření stránky technologie ASP.NET, který obsahuje tlačítka pro šifrování a dešifrování `<connectionStrings>` tématu `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="d03b8-155">To illustrate programmatically protecting configuration information, let s create an ASP.NET page that includes buttons for encrypting and decrypting the `<connectionStrings>` section in `Web.config`.</span></span>

<span data-ttu-id="d03b8-156">Začněte otevřením `EncryptingConfigSections.aspx` stránku `AdvancedDAL` složky.</span><span class="sxs-lookup"><span data-stu-id="d03b8-156">Start by opening the `EncryptingConfigSections.aspx` page in the `AdvancedDAL` folder.</span></span> <span data-ttu-id="d03b8-157">Přetáhněte ovládací prvek textového pole z panelu nástrojů do Návrháře nastavení jeho `ID` vlastnost `WebConfigContents`, jeho `TextMode` vlastnost `MultiLine`a jeho `Width` a `Rows` vlastnosti 95 %, 15, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="d03b8-157">Drag a TextBox control from the Toolbox onto the Designer, setting its `ID` property to `WebConfigContents`, its `TextMode` property to `MultiLine`, and its `Width` and `Rows` properties to 95% and 15, respectively.</span></span> <span data-ttu-id="d03b8-158">Tento ovládací prvek textové pole se zobrazí obsah `Web.config` umožňuje nám chcete rychle zobrazit, pokud se obsah nebo není zašifrovaná.</span><span class="sxs-lookup"><span data-stu-id="d03b8-158">This TextBox control will display the contents of `Web.config` allowing us to quickly see if the contents are encrypted or not.</span></span> <span data-ttu-id="d03b8-159">Samozřejmě v reálné aplikaci byste nikdy chcete zobrazit obsah `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="d03b8-159">Of course, in a real application you would never want to display the contents of `Web.config`.</span></span>

<span data-ttu-id="d03b8-160">Pod textové pole, přidejte dva ovládací prvky tlačítka s názvem `EncryptConnStrings` a `DecryptConnStrings`.</span><span class="sxs-lookup"><span data-stu-id="d03b8-160">Beneath the TextBox, add two Button controls named `EncryptConnStrings` and `DecryptConnStrings`.</span></span> <span data-ttu-id="d03b8-161">Nastavte jejich vlastnosti Text připojovací řetězce šifrování a dešifrování řetězce připojení.</span><span class="sxs-lookup"><span data-stu-id="d03b8-161">Set their Text properties to Encrypt Connection Strings and Decrypt Connection Strings .</span></span>

<span data-ttu-id="d03b8-162">V tomto okamžiku vaše obrazovka by měla vypadat podobně jako na obrázku 2.</span><span class="sxs-lookup"><span data-stu-id="d03b8-162">At this point your screen should look similar to Figure 2.</span></span>


[![A<span data-ttu-id="d03b8-163">dd textové pole a dva ovládací prvky tlačítka Web na stránku]</span><span class="sxs-lookup"><span data-stu-id="d03b8-163">dd a TextBox and Two Button Web Controls to the Page]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)

<span data-ttu-id="d03b8-164">**Obrázek 2**: Přidání textového pole a dva ovládací prvky tlačítka Web na stránku ([kliknutím ji zobrazíte obrázek v plné velikosti](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="d03b8-164">**Figure 2**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span></span>


<span data-ttu-id="d03b8-165">Dále musíme napsat kód, který načte a zobrazí obsah `Web.config` v `WebConfigContents` textového pole na stránce při prvním načtení.</span><span class="sxs-lookup"><span data-stu-id="d03b8-165">Next, we need to write code that loads and displays the contents of `Web.config` in the `WebConfigContents` TextBox when the page is first loaded.</span></span> <span data-ttu-id="d03b8-166">Přidejte následující kód do třídy stránky s kódem na pozadí.</span><span class="sxs-lookup"><span data-stu-id="d03b8-166">Add the following code to the page s code-behind class.</span></span> <span data-ttu-id="d03b8-167">Tento kód přidá metodu s názvem `DisplayWebConfig` a nazve je z `Page_Load` obslužné rutiny události při `Page.IsPostBack` je `false`:</span><span class="sxs-lookup"><span data-stu-id="d03b8-167">This code adds a method named `DisplayWebConfig` and calls it from the `Page_Load` event handler when `Page.IsPostBack` is `false`:</span></span>


[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample1.cs)]

<span data-ttu-id="d03b8-168">`DisplayWebConfig` Metoda používá [ `File` třídy](https://msdn.microsoft.com/library/system.io.file.aspx) otevřete aplikaci s `Web.config` souboru [ `StreamReader` třídy](https://msdn.microsoft.com/library/system.io.streamreader.aspx) přečtení jeho obsahu do řetězce a [ `Path` třídy](https://msdn.microsoft.com/library/system.io.path.aspx) ke generování fyzickou cestu k `Web.config` souboru.</span><span class="sxs-lookup"><span data-stu-id="d03b8-168">The `DisplayWebConfig` method uses the [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) to open the application s `Web.config` file, the [`StreamReader` class](https://msdn.microsoft.com/library/system.io.streamreader.aspx) to read its contents into a string, and the [`Path` class](https://msdn.microsoft.com/library/system.io.path.aspx) to generate the physical path to the `Web.config` file.</span></span> <span data-ttu-id="d03b8-169">Tyto tři třídy se nacházejí v [ `System.IO` obor názvů](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="d03b8-169">These three classes are all found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="d03b8-170">V důsledku toho budete muset přidat `using` `System.IO` příkaz do horní části třídy modelu code-behind nebo, případně tyto třídy názvy s předponou `System.IO.` .</span><span class="sxs-lookup"><span data-stu-id="d03b8-170">Consequently, you will need to add a `using` `System.IO` statement to the top of the code-behind class or, alternatively, prefix these class names with `System.IO.` .</span></span>

<span data-ttu-id="d03b8-171">V dalším kroku je potřeba přidat obslužné rutiny události pro dva ovládací prvky tlačítka `Click` události a přidání nezbytného kódu k šifrování a dešifrování `<connectionStrings>` části pomocí klíče počítače úrovni s poskytovateli rozhraní DPAPI.</span><span class="sxs-lookup"><span data-stu-id="d03b8-171">Next, we need to add event handlers for the two Button controls `Click` events and add the necessary code to encrypt and decrypt the `<connectionStrings>` section using a machine-level key with the DPAPI provider.</span></span> <span data-ttu-id="d03b8-172">Z návrháře, klikněte dvakrát na každé z tlačítka pro přidání `Click` obslužné rutiny události v modelu code-behind třídu a přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="d03b8-172">From the Designer, double-click each of the Buttons to add a `Click` event handler in the code-behind class and then add the following code:</span></span>


[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample2.cs)]

<span data-ttu-id="d03b8-173">Kód použitý v obslužné rutině dvě události je téměř shodná.</span><span class="sxs-lookup"><span data-stu-id="d03b8-173">The code used in the two event handlers is nearly identical.</span></span> <span data-ttu-id="d03b8-174">Oba začít tím, že získáme informace o aktuální aplikaci s `Web.config` souboru prostřednictvím [ `WebConfigurationManager` třídy](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) s [ `OpenWebConfiguration` metoda](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx).</span><span class="sxs-lookup"><span data-stu-id="d03b8-174">They both start by getting information about the current application s `Web.config` file via the [`WebConfigurationManager` class](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) s [`OpenWebConfiguration` method](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx).</span></span> <span data-ttu-id="d03b8-175">Tato metoda vrátí konfiguračním souboru webu pro zadanou virtuální cestu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-175">This method returns the web configuration file for the specified virtual path.</span></span> <span data-ttu-id="d03b8-176">Další, `Web.config` soubor s `<connectionStrings>` oddílu se přistupuje přes [ `Configuration` třídy](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) s [ `GetSection(sectionName)` metoda](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx), který vrátí hodnotu [ `ConfigurationSection` ](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) objektu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-176">Next, the `Web.config` file s `<connectionStrings>` section is accessed via the [`Configuration` class](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) s [`GetSection(sectionName)` method](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx), which returns a [`ConfigurationSection`](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) object.</span></span>

<span data-ttu-id="d03b8-177">`ConfigurationSection` Objekt zahrnuje [ `SectionInformation` vlastnost](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) , která poskytuje další informace a funkce týkající se konfigurační oddíl.</span><span class="sxs-lookup"><span data-stu-id="d03b8-177">The `ConfigurationSection` object includes a [`SectionInformation` property](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) that provides additional information and functionality regarding the configuration section.</span></span> <span data-ttu-id="d03b8-178">Jako kód výše znázorňuje, můžeme určit, jestli se šifruje konfiguračního oddílu tak, že zkontrolujete `SectionInformation` vlastnost s `IsProtected` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="d03b8-178">As the code above shows, we can determine whether the configuration section is encrypted by checking the `SectionInformation` property s `IsProtected` property.</span></span> <span data-ttu-id="d03b8-179">Navíc můžete šifrovat nebo dešifrovat prostřednictvím části `SectionInformation` vlastnost s `ProtectSection(provider)` a `UnprotectSection` metody.</span><span class="sxs-lookup"><span data-stu-id="d03b8-179">Moreover, the section can be encrypted or decrypted via the `SectionInformation` property s `ProtectSection(provider)` and `UnprotectSection` methods.</span></span>

<span data-ttu-id="d03b8-180">`ProtectSection(provider)` Metoda přijímá jako vstupní řetězec určující název poskytovatele chráněné konfigurace pro použití při šifrování.</span><span class="sxs-lookup"><span data-stu-id="d03b8-180">The `ProtectSection(provider)` method accepts as input a string specifying the name of the protected configuration provider to use when encrypting.</span></span> <span data-ttu-id="d03b8-181">V `EncryptConnString` předáme DataProtectionConfigurationProvider do obslužné rutiny události tlačítka s `ProtectSection(provider)` metodu tak, aby používalo poskytovateli rozhraní DPAPI.</span><span class="sxs-lookup"><span data-stu-id="d03b8-181">In the `EncryptConnString` Button s event handler we pass DataProtectionConfigurationProvider into the `ProtectSection(provider)` method so that the DPAPI provider is used.</span></span> <span data-ttu-id="d03b8-182">`UnprotectSection` Metody můžete určit zprostředkovatele, který se použil k zašifrování konfiguračního oddílu a proto není nutné žádné vstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="d03b8-182">The `UnprotectSection` method can determine the provider that was used to encrypt the configuration section and therefore does not require any input parameters.</span></span>

<span data-ttu-id="d03b8-183">Po volání `ProtectSection(provider)` nebo `UnprotectSection` metoda, je třeba zavolat `Configuration` objektu s [ `Save` metoda](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) a zachová tak změny.</span><span class="sxs-lookup"><span data-stu-id="d03b8-183">After calling the `ProtectSection(provider)` or `UnprotectSection` method, you must call the `Configuration` object s [`Save` method](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) to persist the changes.</span></span> <span data-ttu-id="d03b8-184">Jakmile informace o konfiguraci byla zašifrovaná nebo dešifrovat, a tyto změny uložit, říkáme `DisplayWebConfig` k načtení aktualizované `Web.config` obsah do ovládacího prvku textového pole.</span><span class="sxs-lookup"><span data-stu-id="d03b8-184">Once the configuration information has been encrypted or decrypted and the changes saved, we call `DisplayWebConfig` to load the updated `Web.config` contents into the TextBox control.</span></span>

<span data-ttu-id="d03b8-185">Po zadání výše uvedený kód ji otestovat přechodem `EncryptingConfigSections.aspx` stránky prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="d03b8-185">Once you have entered the above code, test it by visiting the `EncryptingConfigSections.aspx` page through a browser.</span></span> <span data-ttu-id="d03b8-186">Zpočátku zobrazí stránka, která uvádí obsah `Web.config` s `<connectionStrings>` části zobrazí ve formátu prostého textu (viz obrázek 3).</span><span class="sxs-lookup"><span data-stu-id="d03b8-186">You should initially see a page that lists the contents of `Web.config` with the `<connectionStrings>` section displayed in plain-text (see Figure 3).</span></span>


[![A<span data-ttu-id="d03b8-187">dd textové pole a dva ovládací prvky tlačítka Web na stránku]</span><span class="sxs-lookup"><span data-stu-id="d03b8-187">dd a TextBox and Two Button Web Controls to the Page]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)

<span data-ttu-id="d03b8-188">**Obrázek 3**: Přidání textového pole a dva ovládací prvky tlačítka Web na stránku ([kliknutím ji zobrazíte obrázek v plné velikosti](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="d03b8-188">**Figure 3**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span></span>


<span data-ttu-id="d03b8-189">Nyní klikněte na tlačítko šifrovat připojovací řetězce.</span><span class="sxs-lookup"><span data-stu-id="d03b8-189">Now click the Encrypt Connection Strings button.</span></span> <span data-ttu-id="d03b8-190">Pokud je povoleno ověření požadavku, značky vrácena zpět `WebConfigContents` TextBox způsobí `HttpRequestValidationException`, který zobrazí zprávu, která je potenciálně nebezpečná `Request.Form` z klienta byla zjištěna hodnota.</span><span class="sxs-lookup"><span data-stu-id="d03b8-190">If request validation is enabled, the markup posted back from the `WebConfigContents` TextBox will produce an `HttpRequestValidationException`, which displays the message, A potentially dangerous `Request.Form` value was detected from the client.</span></span> <span data-ttu-id="d03b8-191">Žádost o ověření, která je povolena ve výchozím nastavení v technologii ASP.NET 2.0, zakazují zpětná volání, které zahrnují bez kódování HTML a pomoct zabránit útokům prostřednictvím injektáže skriptu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-191">Request validation, which is enabled by default in ASP.NET 2.0, prohibits postbacks that include un-encoded HTML and is designed to help prevent script-injection attacks.</span></span> <span data-ttu-id="d03b8-192">Tato kontrola je možné zakázat na stránce - nebo -úrovni aplikace.</span><span class="sxs-lookup"><span data-stu-id="d03b8-192">This check can be disabled at the page- or application-level.</span></span> <span data-ttu-id="d03b8-193">Chcete-li vypnout pro tuto stránku, nastavte `ValidateRequest` nastavení `false` v `@Page` směrnice.</span><span class="sxs-lookup"><span data-stu-id="d03b8-193">To turn it off for this page, set the `ValidateRequest` setting to `false` in the `@Page` directive.</span></span> <span data-ttu-id="d03b8-194">`@Page` – Direktiva se nachází v horní části stránky s deklarativní.</span><span class="sxs-lookup"><span data-stu-id="d03b8-194">The `@Page` directive is found at the top of the page s declarative markup.</span></span>


[!code-aspx[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample3.aspx)]

<span data-ttu-id="d03b8-195">Další informace o ověření žádosti, jeho účel, zakažte ho na stránce - a -úrovni aplikace, jak jak kódovat do formátu HTML značky, naleznete v tématu [ověření požadavku – prevence útoků skript](../../../../whitepapers/request-validation.md).</span><span class="sxs-lookup"><span data-stu-id="d03b8-195">For more information on request validation, its purpose, how to disable it at the page- and application-level, as well as how to HTML encode markup, see [Request Validation - Preventing Script Attacks](../../../../whitepapers/request-validation.md).</span></span>

<span data-ttu-id="d03b8-196">Po zakázání ověření žádosti pro stránku, zkuste to znovu kliknutím na tlačítko šifrovat připojovací řetězce.</span><span class="sxs-lookup"><span data-stu-id="d03b8-196">After disabling request validation for the page, try clicking the Encrypt Connection Strings button again.</span></span> <span data-ttu-id="d03b8-197">Na zpětné volání, budou mít přístup konfiguračního souboru a jeho `<connectionStrings>` části šifrované pomocí poskytovatele rozhraní DPAPI.</span><span class="sxs-lookup"><span data-stu-id="d03b8-197">On postback, the configuration file will be accessed and its `<connectionStrings>` section encrypted using the DPAPI provider.</span></span> <span data-ttu-id="d03b8-198">Textové pole se pak aktualizuje a zobrazí nový `Web.config` obsah.</span><span class="sxs-lookup"><span data-stu-id="d03b8-198">The TextBox is then updated to display the new `Web.config` content.</span></span> <span data-ttu-id="d03b8-199">Obrázek 4 ukazuje, `<connectionStrings>` informace je zašifrovaný.</span><span class="sxs-lookup"><span data-stu-id="d03b8-199">As Figure 4 shows, the `<connectionStrings>` information is now encrypted.</span></span>


[![C<span data-ttu-id="d03b8-200">licking šifrování připojovací řetězce tlačítko šifruje &lt;connectionString&gt; části]</span><span class="sxs-lookup"><span data-stu-id="d03b8-200">licking the Encrypt Connection Strings Button Encrypts the &lt;connectionString&gt; Section]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)

<span data-ttu-id="d03b8-201">**Obrázek 4**: Kliknutí zašifrovat připojovací řetězce tlačítko šifruje `<connectionString>` oddílu ([kliknutím ji zobrazíte obrázek v plné velikosti](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="d03b8-201">**Figure 4**: Clicking the Encrypt Connection Strings Button Encrypts the `<connectionString>` Section ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span></span>


<span data-ttu-id="d03b8-202">Šifrovaný `<connectionStrings>` část vygenerované v mém počítači se řídí, i když některé z obsahu `<CipherData>` byl prvek odebrán pro zkrácení:</span><span class="sxs-lookup"><span data-stu-id="d03b8-202">The encrypted `<connectionStrings>` section generated on my computer follows, although some of the content in the `<CipherData>` element has been removed for brevity:</span></span>


[!code-xml[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample4.xml)]

> [!NOTE]
> <span data-ttu-id="d03b8-203">`<connectionStrings>` Prvek určuje zprostředkovatele, který slouží k provádění šifrování (`DataProtectionConfigurationProvider`).</span><span class="sxs-lookup"><span data-stu-id="d03b8-203">The `<connectionStrings>` element specifies the provider used to perform the encryption (`DataProtectionConfigurationProvider`).</span></span> <span data-ttu-id="d03b8-204">Tyto informace používá `UnprotectSection` metodu po kliknutí na tlačítko dešifrování řetězce připojení.</span><span class="sxs-lookup"><span data-stu-id="d03b8-204">This information is used by the `UnprotectSection` method when the Decrypt Connection Strings button is clicked.</span></span>


<span data-ttu-id="d03b8-205">Když se informace o připojovacím řetězci přistupuje z `Web.config` – buď pomocí ovládacího prvku SqlDataSource napíšeme kód nebo automaticky generovaný kód z objektů TableAdapter v naší datové sady typu – jsou automaticky dešifrována.</span><span class="sxs-lookup"><span data-stu-id="d03b8-205">When the connection string information is accessed from `Web.config` - either by code we write, from a SqlDataSource control, or the auto-generated code from the TableAdapters in our Typed DataSets - it is automatically decrypted.</span></span> <span data-ttu-id="d03b8-206">Stručně řečeno, jsme nemusíte přidávat žádné další kódu nebo logice k dešifrování šifrovaný `<connectionString>` oddílu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-206">In short, we do not need to add any extra code or logic to decrypt the encrypted `<connectionString>` section.</span></span> <span data-ttu-id="d03b8-207">Abychom to navštíví některý z předchozích kurzů v tuto chvíli, jako je například tento kurz jednoduchého zobrazení z části základní tvorbou sestav (`~/BasicReporting/SimpleDisplay.aspx`).</span><span class="sxs-lookup"><span data-stu-id="d03b8-207">To demonstrate this, visit one of the earlier tutorials at this time, such as the Simple Display tutorial from the Basic Reporting section (`~/BasicReporting/SimpleDisplay.aspx`).</span></span> <span data-ttu-id="d03b8-208">Jak je vidět na obrázku 5, tento kurz pracuje přesně tak, jak jsme byste očekávali, označující, že šifrované připojovacího řetězce se automaticky dešifruje stránka technologie ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="d03b8-208">As Figure 5 shows, the tutorial works exactly as we would expect it, indicating that the encrypted connection string information is being automatically decrypted by the ASP.NET page.</span></span>


[![T<span data-ttu-id="d03b8-209">má vrstvy přístupu k datům automaticky dešifruje informace o připojovacím řetězci]</span><span class="sxs-lookup"><span data-stu-id="d03b8-209">he Data Access Layer Automatically Decrypts the Connection String Information]</span></span>(protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)

<span data-ttu-id="d03b8-210">**Obrázek 5**: Vrstva přístupu k datům automaticky dešifruje informace o připojovacím řetězci ([kliknutím ji zobrazíte obrázek v plné velikosti](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="d03b8-210">**Figure 5**: The Data Access Layer Automatically Decrypts the Connection String Information ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span></span>


<span data-ttu-id="d03b8-211">Vrátit zpět `<connectionStrings>` části zpět do její znázornění prostého textu, klikněte na tlačítko dešifrování řetězce připojení.</span><span class="sxs-lookup"><span data-stu-id="d03b8-211">To revert the `<connectionStrings>` section back to its plain-text representation, click the Decrypt Connection Strings button.</span></span> <span data-ttu-id="d03b8-212">Při zpětném odeslání byste měli vidět připojovací řetězce v `Web.config` ve formátu prostého textu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-212">On postback you should see the connection strings in `Web.config` in plain-text.</span></span> <span data-ttu-id="d03b8-213">V tomto okamžiku vaše obrazovka by měla vypadat stejně, jako kdyby při první návštěvě této stránky (viz obrázek 3).</span><span class="sxs-lookup"><span data-stu-id="d03b8-213">At this point your screen should look like it did when first visiting this page (see in Figure 3).</span></span>

## <a name="step-3-encrypting-configuration-sections-usingaspnetregiisexe"></a><span data-ttu-id="d03b8-214">Krok 3: Konfigurační oddíly funkce pomocí šifrování`aspnet_regiis.exe`</span><span class="sxs-lookup"><span data-stu-id="d03b8-214">Step 3: Encrypting Configuration Sections Using`aspnet_regiis.exe`</span></span>

<span data-ttu-id="d03b8-215">Zahrnuje celou řadu nástrojů příkazového řádku v rozhraní .NET Framework `$WINDOWS$\Microsoft.NET\Framework\version\` složky.</span><span class="sxs-lookup"><span data-stu-id="d03b8-215">The .NET Framework includes a variety of command line tools in the `$WINDOWS$\Microsoft.NET\Framework\version\` folder.</span></span> <span data-ttu-id="d03b8-216">V [použití závislostí mezipaměti SQL](../caching-data/using-sql-cache-dependencies-cs.md) kurz, například jsme se podívali na použití `aspnet_regsql.exe` nástroj příkazového řádku pro přidání infrastrukturu nutnou pro závislosti mezipaměti SQL.</span><span class="sxs-lookup"><span data-stu-id="d03b8-216">In the [Using SQL Cache Dependencies](../caching-data/using-sql-cache-dependencies-cs.md) tutorial, for instance, we looked at using the `aspnet_regsql.exe` command line tool to add the infrastructure necessary for SQL cache dependencies.</span></span> <span data-ttu-id="d03b8-217">Dalším nástrojem užitečné příkazový řádek v této složce je [nástroje ASP.NET IIS Registration (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span><span class="sxs-lookup"><span data-stu-id="d03b8-217">Another useful command line tool in this folder is the [ASP.NET IIS Registration tool (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span></span> <span data-ttu-id="d03b8-218">Jak již název napovídá, nástroje ASP.NET IIS Registration slouží především pro registraci aplikace technologie ASP.NET 2.0 s Microsoft s profesionální webový server IIS.</span><span class="sxs-lookup"><span data-stu-id="d03b8-218">As its name implies, the ASP.NET IIS Registration tool is primarily used to register an ASP.NET 2.0 application with Microsoft s professional-grade Web server, IIS.</span></span> <span data-ttu-id="d03b8-219">Kromě jeho funkce související s IIS nástroje ASP.NET IIS Registration také slouží k šifrování nebo dešifrování zadaný konfigurační oddíly funkce v `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="d03b8-219">In addition to its IIS-related features, the ASP.NET IIS Registration tool can also be used to encrypt or decrypt specified configuration sections in `Web.config`.</span></span>

<span data-ttu-id="d03b8-220">Následující příkaz ukazuje obecnou syntaxi použitý k šifrování konfiguračního oddílu s `aspnet_regiis.exe` nástroj příkazového řádku:</span><span class="sxs-lookup"><span data-stu-id="d03b8-220">The following statement shows the general syntax used to encrypt a configuration section with the `aspnet_regiis.exe` command line tool:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample5.cmd)]

<span data-ttu-id="d03b8-221">*část* oddíl konfigurace pro šifrování (například connectionStrings), je *fyzické\_directory* je úplnou fyzickou cestu k kořenový adresář webové aplikace s a *zprostředkovatele*  je název zprostředkovatele chráněné konfigurace (například DataProtectionConfigurationProvider).</span><span class="sxs-lookup"><span data-stu-id="d03b8-221">*section* is the configuration section to encrypt (like connectionStrings ), the *physical\_directory* is the full, physical path to the web application s root directory, and *provider* is the name of the protected configuration provider to use (such as DataProtectionConfigurationProvider ).</span></span> <span data-ttu-id="d03b8-222">Můžete také webové aplikace bude zaregistrovaná ve službě IIS můžete zadat virtuální cesta, která místo fyzickou cestu, použijte tuto syntaxi:</span><span class="sxs-lookup"><span data-stu-id="d03b8-222">Alternatively, if the web application is registered in IIS you can enter the virtual path instead of the physical path using the following syntax:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample6.cmd)]

<span data-ttu-id="d03b8-223">Následující `aspnet_regiis.exe` šifruje příklad `<connectionStrings>` části pomocí rozhraní DPAPI zprostředkovatele s klíčem úrovni počítače:</span><span class="sxs-lookup"><span data-stu-id="d03b8-223">The following `aspnet_regiis.exe` example encrypts the `<connectionStrings>` section using the DPAPI provider with a machine-level key:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample7.cmd)]

<span data-ttu-id="d03b8-224">Podobně platí `aspnet_regiis.exe` nástroj příkazového řádku je možné dešifrovat konfigurační oddíly funkce.</span><span class="sxs-lookup"><span data-stu-id="d03b8-224">Similarly, the `aspnet_regiis.exe` command line tool can be used to decrypt configuration sections.</span></span> <span data-ttu-id="d03b8-225">Namísto použití `-pef` přepnout, použijte `-pdf` (nebo namísto něj `-pe`, použijte `-pd`).</span><span class="sxs-lookup"><span data-stu-id="d03b8-225">Instead of using the `-pef` switch, use `-pdf` (or instead of `-pe`, use `-pd`).</span></span> <span data-ttu-id="d03b8-226">Všimněte si také, že název zprostředkovatele není nutné k dešifrování.</span><span class="sxs-lookup"><span data-stu-id="d03b8-226">Also, note that the provider name is not necessary when decrypting.</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample8.cmd)]

> [!NOTE]
> <span data-ttu-id="d03b8-227">Protože používáme rozhraní DPAPI poskytovatele, který používá klíče, které jsou specifické pro počítač, je nutné spustit `aspnet_regiis.exe` ze stejného počítače, ve kterém se obsluhuje webové stránky.</span><span class="sxs-lookup"><span data-stu-id="d03b8-227">Since we are using the DPAPI provider, which uses keys specific to the computer, you must run `aspnet_regiis.exe` from the same machine from which the web pages are being served.</span></span> <span data-ttu-id="d03b8-228">Například je-li spustit tento program příkazového řádku z místního vývojového počítače a pak nahrajte zašifrovaný soubor Web.config na provozní server, provozní server nebude možné dešifrovat informace o připojovacím řetězci, vzhledem k tomu, že byla přenášena šifrovaná pomocí klíčů konkrétní do svého vývojového počítače.</span><span class="sxs-lookup"><span data-stu-id="d03b8-228">For example, if you run this command line program from your local development machine and then upload the encrypted Web.config file to the production server, the production server will not be able to decrypt the connection string information since it was encrypted using keys specific to your development machine.</span></span> <span data-ttu-id="d03b8-229">Zprostředkovatel RSA nemá toto omezení, jak je možné exportovat klíčů RSA do jiného počítače.</span><span class="sxs-lookup"><span data-stu-id="d03b8-229">The RSA provider does not have this limitation as it is possible to export the RSA keys to another machine.</span></span>


## <a name="understanding-database-authentication-options"></a><span data-ttu-id="d03b8-230">Principy možnosti ověřování databáze</span><span class="sxs-lookup"><span data-stu-id="d03b8-230">Understanding Database Authentication Options</span></span>

<span data-ttu-id="d03b8-231">Předtím, než všechny aplikace může vydat `SELECT`, `INSERT`, `UPDATE`, nebo `DELETE` dotazy do databáze Microsoft SQL Server, databázi musíte nejprve identifikovat žadatel.</span><span class="sxs-lookup"><span data-stu-id="d03b8-231">Before any application can issue `SELECT`, `INSERT`, `UPDATE`, or `DELETE` queries to a Microsoft SQL Server database, the database first must identify the requestor.</span></span> <span data-ttu-id="d03b8-232">Tento proces se označuje jako *ověřování* a systému SQL Server nabízí dvě metody ověřování:</span><span class="sxs-lookup"><span data-stu-id="d03b8-232">This process is known as *authentication* and SQL Server provides two methods of authentication:</span></span>

- <span data-ttu-id="d03b8-233">**Ověřování Windows** – proces, pod kterým běží aplikace se používá ke komunikaci s databází.</span><span class="sxs-lookup"><span data-stu-id="d03b8-233">**Windows Authentication** - the process under which the application is running is used to communicate with the database.</span></span> <span data-ttu-id="d03b8-234">Při spuštění aplikace ASP.NET pomocí sady Visual Studio 2005 s serveru ASP.NET Development Server, předpokládá aplikace ASP.NET identity aktuálně přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="d03b8-234">When running an ASP.NET application through Visual Studio 2005 s ASP.NET Development Server, the ASP.NET application assumes the identity of the currently logged on user.</span></span> <span data-ttu-id="d03b8-235">Pro aplikace ASP.NET na Internet Information Server (IIS), ASP.NET, aplikace obvykle převzít identitu `domainName``\MachineName` nebo `domainName``\NETWORK SERVICE`, i když je možné přizpůsobit.</span><span class="sxs-lookup"><span data-stu-id="d03b8-235">For ASP.NET applications on Microsoft Internet Information Server (IIS), ASP.NET applications usually assume the identity of `domainName``\MachineName` or `domainName``\NETWORK SERVICE`, although this can be customized.</span></span>
- <span data-ttu-id="d03b8-236">**Ověřování SQL** – uživatelské jméno a heslo hodnoty se zadávají jako přihlašovací údaje pro ověřování.</span><span class="sxs-lookup"><span data-stu-id="d03b8-236">**SQL Authentication** - a user ID and password values are supplied as credentials for authentication.</span></span> <span data-ttu-id="d03b8-237">Pomocí ověřování SQL ID uživatele a heslo zadané v připojovacím řetězci.</span><span class="sxs-lookup"><span data-stu-id="d03b8-237">With SQL authentication, the user ID and password are provided in the connection string.</span></span>

<span data-ttu-id="d03b8-238">Ověřování Windows je upřednostňována před ověřování SQL, protože je bezpečnější.</span><span class="sxs-lookup"><span data-stu-id="d03b8-238">Windows authentication is preferred over SQL authentication because it is more secure.</span></span> <span data-ttu-id="d03b8-239">Pokud webový server a serverem databáze nachází na dvou různých počítačích, přihlašovací údaje se neodesílají přes síť jako prostý text s ověřováním Windows je připojovací řetězec bez uživatelského jména a hesla.</span><span class="sxs-lookup"><span data-stu-id="d03b8-239">With Windows authentication the connection string is free from a username and password and if the web server and database server reside on two different machines, the credentials are not sent over the network in plain-text.</span></span> <span data-ttu-id="d03b8-240">Pomocí ověřování SQL přihlašovací údaje pro ověřování jsou však pevně zakódované v připojovacím řetězci a se přenáší z webového serveru databázový server ve formátu prostého textu.</span><span class="sxs-lookup"><span data-stu-id="d03b8-240">With SQL authentication, however, the authentication credentials are hard-coded in the connection string and are transmitted from the web server to the database server in plain-text.</span></span>

<span data-ttu-id="d03b8-241">Tyto kurzy využívají ověřování Windows.</span><span class="sxs-lookup"><span data-stu-id="d03b8-241">These tutorials have used Windows authentication.</span></span> <span data-ttu-id="d03b8-242">Můžete zjistit, který režim ověřování je používán kontrola připojovacího řetězce.</span><span class="sxs-lookup"><span data-stu-id="d03b8-242">You can tell what authentication mode is being used by inspecting the connection string.</span></span> <span data-ttu-id="d03b8-243">Připojovací řetězec v `Web.config` byl pro naše kurzy:</span><span class="sxs-lookup"><span data-stu-id="d03b8-243">The connection string in `Web.config` for our tutorials has been:</span></span>

`Data Source=.\SQLEXPRESS; AttachDbFilename=|DataDirectory|\NORTHWND.MDF; Integrated Security=True; User Instance=True`

<span data-ttu-id="d03b8-244">Integrated Security = True a nedostatečné uživatelské jméno a heslo znamenat, že se používá ověřování Windows.</span><span class="sxs-lookup"><span data-stu-id="d03b8-244">The Integrated Security=True and lack of a username and password indicate that Windows authentication is being used.</span></span> <span data-ttu-id="d03b8-245">V některých připojovací řetězce termín důvěryhodné připojení = Ano nebo Integrated Security = SSPI se používá namísto Integrated Security = True, ale všechny tři označuje použití ověřování Windows.</span><span class="sxs-lookup"><span data-stu-id="d03b8-245">In some connection strings the term Trusted Connection=Yes or Integrated Security=SSPI is used instead of Integrated Security=True, but all three indicate the use of Windows authentication.</span></span>

<span data-ttu-id="d03b8-246">Následující příklad ukazuje připojovací řetězec, který používá ověřování SQL.</span><span class="sxs-lookup"><span data-stu-id="d03b8-246">The following example shows a connection string that uses SQL authentication.</span></span> <span data-ttu-id="d03b8-247">Poznámka: přihlašovací údaje vkládán připojovací řetězec:</span><span class="sxs-lookup"><span data-stu-id="d03b8-247">Note the credentials embedded within the connection string:</span></span>

`Server=serverName; Database=Northwind; uid=userID; pwd=password`

<span data-ttu-id="d03b8-248">Představte si, že útočník je moct zobrazit vaše aplikace s `Web.config` souboru.</span><span class="sxs-lookup"><span data-stu-id="d03b8-248">Imagine that an attacker is able to view your application s `Web.config` file.</span></span> <span data-ttu-id="d03b8-249">Pokud používáte ověřování SQL pro připojení k databázi, která je přístupná přes Internet, útočník může použít tento připojovací řetězec pro připojení k databázi SQL Management Studio nebo ze stránky technologie ASP.NET na vlastní web.</span><span class="sxs-lookup"><span data-stu-id="d03b8-249">If you use SQL authentication to connect to a database that is accessible over the Internet, the attacker can use this connection string to connect to your database through SQL Management Studio or from ASP.NET pages on their own website.</span></span> <span data-ttu-id="d03b8-250">K zmírnění této hrozby, šifrovat informace o připojovacím řetězci v `Web.config` pomocí systému chráněné konfigurace.</span><span class="sxs-lookup"><span data-stu-id="d03b8-250">To help mitigate this threat, encrypt the connection string information in `Web.config` using the protected configuration system.</span></span>

> [!NOTE]
> <span data-ttu-id="d03b8-251">Další informace o různých typech ověřování, které jsou k dispozici v systému SQL Server najdete v tématu [vytváření bezpečných aplikací technologie ASP.NET: Ověřování, autorizaci a bezpečnou komunikaci](https://msdn.microsoft.com/library/aa302392.aspx).</span><span class="sxs-lookup"><span data-stu-id="d03b8-251">For more information on the different types of authentication available in SQL Server, see [Building Secure ASP.NET Applications: Authentication, Authorization, and Secure Communication](https://msdn.microsoft.com/library/aa302392.aspx).</span></span> <span data-ttu-id="d03b8-252">Další připojovací řetězec příklady ilustrující rozdíly mezi syntaxe ověřování Windows a SQL, najdete v tématu [ConnectionStrings.com](http://www.connectionstrings.com/).</span><span class="sxs-lookup"><span data-stu-id="d03b8-252">For further connection string examples illustrating the differences between Windows and SQL authentication syntax, refer to [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>


## <a name="summary"></a><span data-ttu-id="d03b8-253">Souhrn</span><span class="sxs-lookup"><span data-stu-id="d03b8-253">Summary</span></span>

<span data-ttu-id="d03b8-254">Ve výchozím nastavení, soubory s `.config` rozšíření v aplikaci technologie ASP.NET není možné přistupovat prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="d03b8-254">By default, files with a `.config` extension in an ASP.NET application cannot be accessed through a browser.</span></span> <span data-ttu-id="d03b8-255">Tyto typy souborů, nebudou zobrazeny, protože mohou obsahovat citlivé informace, jako jsou databázové připojovací řetězce, uživatelská jména a hesla a tak dále.</span><span class="sxs-lookup"><span data-stu-id="d03b8-255">These types of files are not returned because they may contain sensitive information, such as database connection strings, usernames and passwords, and so on.</span></span> <span data-ttu-id="d03b8-256">Chráněné konfigurační systém v rozhraní .NET 2.0 pomáhá rozšířit ochranu citlivých informací tím, že zadaný konfigurační oddíly funkce šifrování.</span><span class="sxs-lookup"><span data-stu-id="d03b8-256">The protected configuration system in .NET 2.0 helps further protect sensitive information by allowing specified configuration sections to be encrypted.</span></span> <span data-ttu-id="d03b8-257">Existují dva poskytovatelé integrované chráněné konfigurace: ten, který používá algoritmus RSA a ten, který používá Windows Data Protection API (DPAPI).</span><span class="sxs-lookup"><span data-stu-id="d03b8-257">There are two built-in protected configuration providers: one that uses the RSA algorithm and one that uses the Windows Data Protection API (DPAPI).</span></span>

<span data-ttu-id="d03b8-258">V tomto kurzu jsme se podívali na tom, jak šifrování a dešifrování pomocí zprostředkovatele rozhraní DPAPI nastavení konfigurace.</span><span class="sxs-lookup"><span data-stu-id="d03b8-258">In this tutorial we looked at how to encrypt and decrypt configuration settings using the DPAPI provider.</span></span> <span data-ttu-id="d03b8-259">To lze provést prostřednictvím kódu programu, jako jsme viděli v kroku 2, stejně jako prostřednictvím `aspnet_regiis.exe` nástroj příkazového řádku, které bylo popsané v kroku 3.</span><span class="sxs-lookup"><span data-stu-id="d03b8-259">This can be accomplished both programmatically, as we saw in Step 2, as well as through the `aspnet_regiis.exe` command line tool, which was covered in Step 3.</span></span> <span data-ttu-id="d03b8-260">Další informace o používání klíčů individuální nebo místo toho použít zprostředkovatel RSA najdete v materiálech v části Další čtení.</span><span class="sxs-lookup"><span data-stu-id="d03b8-260">For more information on using user-level keys or using the RSA provider instead, see the resources in the Further Reading section.</span></span>

<span data-ttu-id="d03b8-261">Všechno nejlepší programování!</span><span class="sxs-lookup"><span data-stu-id="d03b8-261">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="d03b8-262">Další čtení</span><span class="sxs-lookup"><span data-stu-id="d03b8-262">Further Reading</span></span>

<span data-ttu-id="d03b8-263">Další informace o tématech, které jsou popsané v tomto kurzu najdete na následujících odkazech:</span><span class="sxs-lookup"><span data-stu-id="d03b8-263">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d03b8-264">Vytváření zabezpečených už teď funguje: Ověřování, autorizaci a zabezpečenou komunikaci</span><span class="sxs-lookup"><span data-stu-id="d03b8-264">Building Secure ASP.NET Application: Authentication, Authorization, and Secure Communication</span></span>](https://msdn.microsoft.com/library/aa302392.aspx)
- [<span data-ttu-id="d03b8-265">Informace o konfiguraci v technologii ASP.NET 2.0 šifrování aplikací</span><span class="sxs-lookup"><span data-stu-id="d03b8-265">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="d03b8-266">Šifrování `Web.config` hodnoty v technologii ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="d03b8-266">Encrypting `Web.config` Values in ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/archive/2006/01/09/434893.aspx)
- [<span data-ttu-id="d03b8-267">Postupy: Zašifrovat konfigurační oddíly funkce v technologii ASP.NET 2.0 pomocí rozhraní DPAPI</span><span class="sxs-lookup"><span data-stu-id="d03b8-267">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using DPAPI</span></span>](https://msdn.microsoft.com/library/ms998280.aspx)
- [<span data-ttu-id="d03b8-268">Postupy: Zašifrovat konfigurační oddíly funkce v technologii ASP.NET 2.0 pomocí technologie RSA</span><span class="sxs-lookup"><span data-stu-id="d03b8-268">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using RSA</span></span>](https://msdn.microsoft.com/library/ms998283.aspx)
- [<span data-ttu-id="d03b8-269">Konfigurace rozhraní API v rozhraní .NET 2.0</span><span class="sxs-lookup"><span data-stu-id="d03b8-269">The Configuration API in .NET 2.0</span></span>](http://www.odetocode.com/Articles/418.aspx)
- [<span data-ttu-id="d03b8-270">Ochrana dat pro Windows</span><span class="sxs-lookup"><span data-stu-id="d03b8-270">Windows Data Protection</span></span>](https://msdn.microsoft.com/library/ms995355.aspx)

## <a name="about-the-author"></a><span data-ttu-id="d03b8-271">O autorovi</span><span class="sxs-lookup"><span data-stu-id="d03b8-271">About the Author</span></span>

<span data-ttu-id="d03b8-272">[Scott Meisnerová](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor sedm ASP/ASP.NET knih a Zakladatel [4GuysFromRolla.com](http://www.4guysfromrolla.com), má práce s Microsoft webových technologiích od roku 1998.</span><span class="sxs-lookup"><span data-stu-id="d03b8-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d03b8-273">Scott funguje jako nezávislý konzultant, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="d03b8-273">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d03b8-274">Jeho nejnovější knihy [ *Edice nakladatelství Sams naučit sami ASP.NET 2.0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="d03b8-274">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="d03b8-275">Může být dosáhl v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d03b8-275">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="d03b8-276">nebo prostřednictvím jeho blogu, který lze nalézt v [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="d03b8-276">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="d03b8-277">Speciální k</span><span class="sxs-lookup"><span data-stu-id="d03b8-277">Special Thanks To</span></span>

<span data-ttu-id="d03b8-278">V této sérii kurzů byl recenzován uživatelem mnoho užitečných revidující.</span><span class="sxs-lookup"><span data-stu-id="d03b8-278">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d03b8-279">Vedoucí revidující pro účely tohoto kurzu byly Teresy Murphy a Randy Schmidt.</span><span class="sxs-lookup"><span data-stu-id="d03b8-279">Lead reviewers for this tutorial were Teresa Murphy and Randy Schmidt.</span></span> <span data-ttu-id="d03b8-280">Zajímat téma Moje nadcházejících článcích MSDN?</span><span class="sxs-lookup"><span data-stu-id="d03b8-280">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d03b8-281">Pokud ano, vyřaďte mě řádek na [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="d03b8-281">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="d03b8-282">[Předchozí](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
> [další](debugging-stored-procedures-cs.md)</span><span class="sxs-lookup"><span data-stu-id="d03b8-282">[Previous](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
[Next](debugging-stored-procedures-cs.md)</span></span>
