---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
title: Používání stávajících uložených procedur pro objekty TableAdapter (C#) typované datové sady | Microsoft Docs
author: rick-anderson
description: V předchozím kurzu jsme zjistili, jak pomocí Průvodce TableAdapter vygenerovat nové uložené procedury. V tomto kurzu se naučíme, jak stejné TableAdapter...
ms.author: riande
ms.date: 07/18/2007
ms.assetid: 440bef2a-1641-4238-99e3-8e2d44e7d94c
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs
msc.type: authoredcontent
ms.openlocfilehash: cfe03c244fb6f9f0a201aecb6eae211ab946175f
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78531953"
---
# <a name="using-existing-stored-procedures-for-the-typed-datasets-tableadapters-c"></a><span data-ttu-id="0e520-104">Použití stávajících uložených procedur komponentami TableAdapter typových sad dat (C#)</span><span class="sxs-lookup"><span data-stu-id="0e520-104">Using Existing Stored Procedures for the Typed DataSet's TableAdapters (C#)</span></span>

<span data-ttu-id="0e520-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0e520-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0e520-106">[Stažení kódu](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_CS.zip) nebo [stažení PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial68cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="0e520-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_68_CS.zip) or [Download PDF](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/datatutorial68cs1.pdf)</span></span>

> <span data-ttu-id="0e520-107">V předchozím kurzu jsme zjistili, jak pomocí Průvodce TableAdapter vygenerovat nové uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="0e520-107">In the previous tutorial we learned how to use the TableAdapter Wizard to generate new stored procedures.</span></span> <span data-ttu-id="0e520-108">V tomto kurzu se dozvíte, jak může stejný Průvodce TableAdapter pracovat se stávajícími uloženými procedurami.</span><span class="sxs-lookup"><span data-stu-id="0e520-108">In this tutorial we learn how the same TableAdapter Wizard can work with existing stored procedures.</span></span> <span data-ttu-id="0e520-109">Také se dozvíte, jak ručně přidat nové uložené procedury do naší databáze.</span><span class="sxs-lookup"><span data-stu-id="0e520-109">We also learn how to manually add new stored procedures to our database.</span></span>

## <a name="introduction"></a><span data-ttu-id="0e520-110">Úvod</span><span class="sxs-lookup"><span data-stu-id="0e520-110">Introduction</span></span>

<span data-ttu-id="0e520-111">V [předchozím kurzu](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) jsme viděli, jak může být zadaná datová sada s objekty TableAdapter nakonfigurovaná tak, aby používala uložené procedury pro přístup k datům, nikoli k příkazům SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="0e520-111">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) we saw how the Typed DataSet s TableAdapters could be configured to use stored procedures to access data rather than ad-hoc SQL statements.</span></span> <span data-ttu-id="0e520-112">Zejména jsme prozkoumali, jak má Průvodce TableAdapter automaticky vytvořit tyto uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="0e520-112">In particular, we examined how to have the TableAdapter wizard automatically create these stored procedures.</span></span> <span data-ttu-id="0e520-113">Při přenosu starší verze aplikace do ASP.NET 2,0 nebo při sestavování webu ASP.NET 2,0 kolem existujícího datového modelu je pravděpodobné, že databáze již obsahuje uložené procedury, které potřebujeme.</span><span class="sxs-lookup"><span data-stu-id="0e520-113">When porting a legacy application to ASP.NET 2.0 or when building an ASP.NET 2.0 website around an existing data model, chances are that the database already contains the stored procedures we need.</span></span> <span data-ttu-id="0e520-114">Alternativně můžete chtít vytvořit uložené procedury ručně nebo pomocí jiného nástroje než Průvodce TableAdapter, který automaticky vygeneruje vaše uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="0e520-114">Alternatively, you may prefer to create your stored procedures by hand or through some tool other than the TableAdapter wizard that auto-generates your stored procedures.</span></span>

<span data-ttu-id="0e520-115">V tomto kurzu se podíváme na to, jak nakonfigurovat TableAdapter na použití existujících uložených procedur.</span><span class="sxs-lookup"><span data-stu-id="0e520-115">In this tutorial we will look at how to configure the TableAdapter to use existing stored procedures.</span></span> <span data-ttu-id="0e520-116">Vzhledem k tomu, že databáze Northwind má pouze malou sadu vestavěných uložených procedur, podíváme se také na kroky potřebné k ručnímu přidání nových uložených procedur do databáze prostřednictvím prostředí sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="0e520-116">Since the Northwind database only has a small set of built-in stored procedures, we will also look at the steps needed to manually add new stored procedures to the database through the Visual Studio environment.</span></span> <span data-ttu-id="0e520-117">Pojďme začít!</span><span class="sxs-lookup"><span data-stu-id="0e520-117">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="0e520-118">V rámci kurzových [úprav v rámci transakce](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) jsme do TableAdapter přidali metody pro podporu transakcí (`BeginTransaction`, `CommitTransaction`a tak dále).</span><span class="sxs-lookup"><span data-stu-id="0e520-118">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial we added methods to the TableAdapter to support transactions (`BeginTransaction`, `CommitTransaction`, and so on).</span></span> <span data-ttu-id="0e520-119">Transakce lze případně spravovat zcela v rámci uložené procedury, která nevyžaduje žádné úpravy kódu vrstvy přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="0e520-119">Alternatively, transactions can be managed entirely within a stored procedure, which requires no modifications to the Data Access Layer code.</span></span> <span data-ttu-id="0e520-120">V tomto kurzu prozkoumáme příkazy T-SQL, které se použijí ke spuštění příkazů uložené procedury s v rámci rozsahu transakce.</span><span class="sxs-lookup"><span data-stu-id="0e520-120">In this tutorial we'll explore the T-SQL commands used to execute a stored procedure s statements within the scope of a transaction.</span></span>

## <a name="step-1-adding-stored-procedures-to-the-northwind-database"></a><span data-ttu-id="0e520-121">Krok 1: Přidání uložených procedur do databáze Northwind</span><span class="sxs-lookup"><span data-stu-id="0e520-121">Step 1: Adding Stored Procedures to the Northwind Database</span></span>

<span data-ttu-id="0e520-122">Visual Studio usnadňuje přidání nových uložených procedur do databáze.</span><span class="sxs-lookup"><span data-stu-id="0e520-122">Visual Studio makes it easy to add new stored procedures to a database.</span></span> <span data-ttu-id="0e520-123">Přidáme do databáze Northwind novou uloženou proceduru, která vrátí všechny sloupce z `Products` tabulky pro ty, které mají určitou hodnotu `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="0e520-123">Let s add a new stored procedure to the Northwind database that returns all columns from the `Products` table for those that have a particular `CategoryID` value.</span></span> <span data-ttu-id="0e520-124">V okně Průzkumník serveru rozbalte databázi Northwind, aby se zobrazily její složky – diagramy databáze, tabulky, zobrazení a tak dále.</span><span class="sxs-lookup"><span data-stu-id="0e520-124">From the Server Explorer window, expand the Northwind database so that its folders - Database Diagrams, Tables, Views, and so forth - are displayed.</span></span> <span data-ttu-id="0e520-125">Jak jsme viděli v předchozím kurzu, složka uložené procedury obsahuje databázi s existujícími uloženými procedurami.</span><span class="sxs-lookup"><span data-stu-id="0e520-125">As we saw in the preceding tutorial, the Stored Procedures folder contains the database s existing stored procedures.</span></span> <span data-ttu-id="0e520-126">Chcete-li přidat novou uloženou proceduru, jednoduše klikněte pravým tlačítkem myši na složku uložené procedury a v místní nabídce vyberte možnost Přidat novou uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="0e520-126">To add a new stored procedure, simply right-click the Stored Procedures folder and choose the Add New Stored Procedure option from the context menu.</span></span>

<span data-ttu-id="0e520-127">[![klikněte pravým tlačítkem na složku uložené procedury a přidejte novou uloženou proceduru.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-127">[![Right-Click the Stored Procedures Folder and Add a New Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image2.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image1.png)</span></span>

<span data-ttu-id="0e520-128">**Obrázek 1**: klikněte pravým tlačítkem na složku uložené procedury a přidejte novou uloženou proceduru ([kliknutím zobrazíte obrázek v plné velikosti).](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-128">**Figure 1**: Right-Click the Stored Procedures Folder and Add a New Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image3.png))</span></span>

<span data-ttu-id="0e520-129">Jak ukazuje obrázek 1, výběrem možnosti Přidat novou uloženou proceduru se otevře okno skriptu v aplikaci Visual Studio s osnovou SQL skriptu potřebného k vytvoření uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="0e520-129">As Figure 1 shows, selecting the Add New Stored Procedure option opens a script window in Visual Studio with the outline of the SQL script needed to create the stored procedure.</span></span> <span data-ttu-id="0e520-130">Tato úloha se dá využít k uložení tohoto skriptu a jeho provedení. v takovém případě bude uložená procedura přidána do databáze.</span><span class="sxs-lookup"><span data-stu-id="0e520-130">It is our job to flesh out this script and execute it, at which point the stored procedure will be added to the database.</span></span>

<span data-ttu-id="0e520-131">Zadejte následující skript:</span><span class="sxs-lookup"><span data-stu-id="0e520-131">Enter the following script:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample1.sql)]

<span data-ttu-id="0e520-132">Když se tento skript spustí, přidá se do databáze Northwind s názvem `Products_SelectByCategoryID`nová uložená procedura.</span><span class="sxs-lookup"><span data-stu-id="0e520-132">This script, when executed, will add a new stored procedure to the Northwind database named `Products_SelectByCategoryID`.</span></span> <span data-ttu-id="0e520-133">Tato uložená procedura přijímá jeden vstupní parametr (`@CategoryID`typu `int`) a vrací všechna pole pro tyto produkty s hodnotou odpovídajícího `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="0e520-133">This stored procedure accepts a single input parameter (`@CategoryID`, of type `int`) and it returns all of the fields for those products with a matching `CategoryID` value.</span></span>

<span data-ttu-id="0e520-134">Chcete-li spustit tento skript `CREATE PROCEDURE` a přidat uloženou proceduru do databáze, klikněte na panelu nástrojů na ikonu Uložit nebo stiskněte klávesu CTRL + S.</span><span class="sxs-lookup"><span data-stu-id="0e520-134">To execute this `CREATE PROCEDURE` script and add the stored procedure to the database, click the Save icon in the toolbar or hit Ctrl+S.</span></span> <span data-ttu-id="0e520-135">Po takovém případě se složka uložených procedur aktualizuje a zobrazí nově vytvořenou uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="0e520-135">After doing so, the Stored Procedures folder refreshes, showing the newly created stored procedure.</span></span> <span data-ttu-id="0e520-136">Také se skript v okně změní Subtlety z `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` na `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="0e520-136">Also, the script in the window will change subtlety from `CREATE PROCEDURE dbo.Products_SelectProductByCategoryID` to `ALTER PROCEDURE` `dbo.Products_SelectProductByCategoryID`.</span></span> <span data-ttu-id="0e520-137">`CREATE PROCEDURE` do databáze přidá novou uloženou proceduru, zatímco `ALTER PROCEDURE` aktualizuje stávající.</span><span class="sxs-lookup"><span data-stu-id="0e520-137">`CREATE PROCEDURE` adds a new stored procedure to the database, while `ALTER PROCEDURE` updates an existing one.</span></span> <span data-ttu-id="0e520-138">Vzhledem k tomu, že se začátek skriptu změnil na `ALTER PROCEDURE`, změna vstupních parametrů uložených procedur nebo příkazů SQL a kliknutí na ikonu Uložit aktualizuje uloženou proceduru těmito změnami.</span><span class="sxs-lookup"><span data-stu-id="0e520-138">Since the start of the script has changed to `ALTER PROCEDURE`, changing the stored procedures input parameters or SQL statements and clicking the Save icon will update the stored procedure with these changes.</span></span>

<span data-ttu-id="0e520-139">Obrázek 2 ukazuje Visual Studio po uložení uložené procedury `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="0e520-139">Figure 2 shows Visual Studio after the `Products_SelectByCategoryID` stored procedure has been saved.</span></span>

<span data-ttu-id="0e520-140">[![se uložená procedura Products_SelectByCategoryID přidala do databáze.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-140">[![The Stored Procedure Products_SelectByCategoryID Has Been Added to the Database](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image5.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image4.png)</span></span>

<span data-ttu-id="0e520-141">**Obrázek 2**: uložená procedura `Products_SelectByCategoryID` byla přidána do databáze ([kliknutím zobrazíte obrázek v plné velikosti).](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-141">**Figure 2**: The Stored Procedure `Products_SelectByCategoryID` Has Been Added to the Database ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image6.png))</span></span>

## <a name="step-2-configuring-the-tableadapter-to-use-an-existing-stored-procedure"></a><span data-ttu-id="0e520-142">Krok 2: Konfigurace TableAdapter pro použití existující uložené procedury</span><span class="sxs-lookup"><span data-stu-id="0e520-142">Step 2: Configuring the TableAdapter to Use an Existing Stored Procedure</span></span>

<span data-ttu-id="0e520-143">Teď, když se do databáze přidala uložená procedura `Products_SelectByCategoryID`, můžeme nakonfigurovat vrstvu přístupu k datům, aby používala tuto uloženou proceduru, když je vyvolána jedna z jejích metod.</span><span class="sxs-lookup"><span data-stu-id="0e520-143">Now that the `Products_SelectByCategoryID` stored procedure has been added to the database, we can configure our Data Access Layer to use this stored procedure when one of its methods is invoked.</span></span> <span data-ttu-id="0e520-144">Konkrétně přidáme metodu `GetProductsByCategoryID(categoryID)` do `ProductsTableAdapter` v datové sadě `NorthwindWithSprocs` typu, která volá `Products_SelectByCategoryID` uloženou proceduru, kterou jsme právě vytvořili.</span><span class="sxs-lookup"><span data-stu-id="0e520-144">In particular, we will add a `GetProductsByCategoryID(categoryID)` method to the `ProductsTableAdapter` in the `NorthwindWithSprocs` Typed DataSet that calls the `Products_SelectByCategoryID` stored procedure we just created.</span></span>

<span data-ttu-id="0e520-145">Začněte tím, že otevřete `NorthwindWithSprocs` datovou sadu.</span><span class="sxs-lookup"><span data-stu-id="0e520-145">Start by opening the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="0e520-146">Klikněte pravým tlačítkem na `ProductsTableAdapter` a výběrem možnosti Přidat dotaz spusťte Průvodce konfigurací dotazu TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="0e520-146">Right-click on the `ProductsTableAdapter` and choose Add Query to launch the TableAdapter Query Configuration wizard.</span></span> <span data-ttu-id="0e520-147">V [předchozím kurzu](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) jsme se rozhodli, že TableAdapter vytvoří novou uloženou proceduru pro nás.</span><span class="sxs-lookup"><span data-stu-id="0e520-147">In the [preceding tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md) we opted to have the TableAdapter create a new stored procedure for us.</span></span> <span data-ttu-id="0e520-148">Pro tento kurz ale chceme, aby se nová metoda TableAdapter nacházela na stávající uloženou proceduru `Products_SelectByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="0e520-148">For this tutorial, however, we want to wire the new TableAdapter method to the existing `Products_SelectByCategoryID` stored procedure.</span></span> <span data-ttu-id="0e520-149">Proto v prvním kroku průvodce použijte možnost použít existující uloženou proceduru a potom klikněte na tlačítko Další.</span><span class="sxs-lookup"><span data-stu-id="0e520-149">Therefore, choose the Use existing stored procedure option from the wizard s first step and then click Next.</span></span>

<span data-ttu-id="0e520-150">[![zvolit možnost použít existující uloženou proceduru](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-150">[![Choose the Use existing stored procedure Option](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image8.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image7.png)</span></span>

<span data-ttu-id="0e520-151">**Obrázek 3**: vyberte možnost použít existující uloženou proceduru ([kliknutím zobrazíte obrázek v plné velikosti).](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-151">**Figure 3**: Choose the Use existing stored procedure Option ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image9.png))</span></span>

<span data-ttu-id="0e520-152">Následující obrazovka nabízí rozevírací seznam naplněný uloženými procedurami databáze.</span><span class="sxs-lookup"><span data-stu-id="0e520-152">The following screen provides a drop-down list populated with the database s stored procedures.</span></span> <span data-ttu-id="0e520-153">Výběr uložené procedury vypíše vstupní parametry na levé straně a datová pole, která se vrátí (pokud existují) na pravé straně.</span><span class="sxs-lookup"><span data-stu-id="0e520-153">Selecting a stored procedure lists its input parameters on the left and the data fields returned (if any) on the right.</span></span> <span data-ttu-id="0e520-154">V seznamu vyberte uloženou proceduru `Products_SelectByCategoryID` a klikněte na další.</span><span class="sxs-lookup"><span data-stu-id="0e520-154">Choose the `Products_SelectByCategoryID` stored procedure from the list and click Next.</span></span>

<span data-ttu-id="0e520-155">[![vybrat uloženou proceduru Products_SelectByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-155">[![Pick the Products_SelectByCategoryID Stored Procedure](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image11.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image10.png)</span></span>

<span data-ttu-id="0e520-156">**Obrázek 4**: vyberte uloženou proceduru `Products_SelectByCategoryID` ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image12.png)).</span><span class="sxs-lookup"><span data-stu-id="0e520-156">**Figure 4**: Pick the `Products_SelectByCategoryID` Stored Procedure ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image12.png))</span></span>

<span data-ttu-id="0e520-157">Na další obrazovce se zobrazí informace o tom, jaký druh dat je vrácen uloženou procedurou, a naše odpověď zde určuje typ vrácený metodou TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="0e520-157">The next screen asks us what kind of data is returned by the stored procedure and our answer here determines the type returned by the TableAdapter s method.</span></span> <span data-ttu-id="0e520-158">Například pokud oznamujeme, že se vrátí tabulková data, metoda vrátí instanci `ProductsDataTable` naplněnou záznamy vrácenými uloženou procedurou.</span><span class="sxs-lookup"><span data-stu-id="0e520-158">For example, if we indicate that tabular data is returned, the method will return a `ProductsDataTable` instance populated with the records returned by the stored procedure.</span></span> <span data-ttu-id="0e520-159">Naproti tomu, pokud oznamujeme, že tato uložená procedura vrátí jedinou hodnotu, `object` TableAdapter vrátí hodnotu, která je přiřazena k hodnotě v prvním sloupci prvního záznamu vráceného uloženou procedurou.</span><span class="sxs-lookup"><span data-stu-id="0e520-159">In contrast, if we indicate that this stored procedure returns a single value the TableAdapter will return an `object` that is assigned the value in the first column of the first record returned by the stored procedure.</span></span>

<span data-ttu-id="0e520-160">Vzhledem k tomu, že `Products_SelectByCategoryID` uložená procedura vrátí všechny produkty patřící do konkrétní kategorie, vyberte první data v tabulkovém typu odpovědi a klikněte na další.</span><span class="sxs-lookup"><span data-stu-id="0e520-160">Since the `Products_SelectByCategoryID` stored procedure returns all products that belong to a particular category, choose the first answer - Tabular data - and click Next.</span></span>

<span data-ttu-id="0e520-161">[![označují, že uložená procedura vrátí tabulková data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-161">[![Indicate that the Stored Procedure Returns Tabular Data](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image14.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image13.png)</span></span>

<span data-ttu-id="0e520-162">**Obrázek 5**: označení, že uložená procedura vrátí tabulková data ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="0e520-162">**Figure 5**: Indicate that the Stored Procedure Returns Tabular Data ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image15.png))</span></span>

<span data-ttu-id="0e520-163">To vše zůstává, chcete-li určit, jaké vzory metod použít a které jsou následovány názvy těchto metod.</span><span class="sxs-lookup"><span data-stu-id="0e520-163">All that remains is to indicate what method patterns to use followed by the names for these methods.</span></span> <span data-ttu-id="0e520-164">Ponechte naplnit DataTable a vraťte možnosti DataTable, ale přejmenujte metody na `FillByCategoryID` a `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="0e520-164">Leave both the Fill a DataTable and Return a DataTable options checked, but rename the methods to `FillByCategoryID` and `GetProductsByCategoryID`.</span></span> <span data-ttu-id="0e520-165">Pak klikněte na další a zkontrolujte souhrnné úkoly, které průvodce provede.</span><span class="sxs-lookup"><span data-stu-id="0e520-165">Then click Next to review a summary of the tasks the wizard will perform.</span></span> <span data-ttu-id="0e520-166">Pokud vše vypadá správně, klikněte na Dokončit.</span><span class="sxs-lookup"><span data-stu-id="0e520-166">If everything looks correct, click Finish.</span></span>

<span data-ttu-id="0e520-167">[![pojmenovat metody FillByCategoryID a GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-167">[![Name the Methods FillByCategoryID and GetProductsByCategoryID](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image17.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image16.png)</span></span>

<span data-ttu-id="0e520-168">**Obrázek 6**: pojmenování metod `FillByCategoryID` a `GetProductsByCategoryID` ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="0e520-168">**Figure 6**: Name the Methods `FillByCategoryID` and `GetProductsByCategoryID` ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image18.png))</span></span>

> [!NOTE]
> <span data-ttu-id="0e520-169">Metody TableAdapter, které jsme právě vytvořili, `FillByCategoryID` a `GetProductsByCategoryID`, očekávají vstupní parametr typu `int`.</span><span class="sxs-lookup"><span data-stu-id="0e520-169">The TableAdapter methods we just created, `FillByCategoryID` and `GetProductsByCategoryID`, expect an input parameter of type `int`.</span></span> <span data-ttu-id="0e520-170">Tato hodnota vstupního parametru se předává do uložené procedury prostřednictvím parametru `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="0e520-170">This input parameter value is passed into the stored procedure via its `@CategoryID` parameter.</span></span> <span data-ttu-id="0e520-171">Pokud změníte `Products_SelectByCategory` uložené procedury s parametry, budete muset také aktualizovat parametry těchto metod TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="0e520-171">If you modify the `Products_SelectByCategory` stored procedure s parameters, you'll need to also update the parameters for these TableAdapter methods.</span></span> <span data-ttu-id="0e520-172">Jak je popsáno v [předchozím kurzu](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md), lze to provést jedním ze dvou způsobů: ručním přidáním nebo odebráním parametrů z kolekce Parameters nebo spuštěním Průvodce TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="0e520-172">As discussed in the [previous tutorial](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md), this can be done in one of two ways: by manually adding or removing parameters from the parameters collection or by rerunning the TableAdapter wizard.</span></span>

## <a name="step-3-adding-agetproductsbycategoryidcategoryidmethod-to-the-bll"></a><span data-ttu-id="0e520-173">Krok 3: Přidání metody`GetProductsByCategoryID(categoryID)`do knihoven BLL</span><span class="sxs-lookup"><span data-stu-id="0e520-173">Step 3: Adding a`GetProductsByCategoryID(categoryID)`Method to the BLL</span></span>

<span data-ttu-id="0e520-174">Po dokončení metody `GetProductsByCategoryID` DAL je dalším krokem poskytnutí přístupu k této metodě ve vrstvě obchodní logiky.</span><span class="sxs-lookup"><span data-stu-id="0e520-174">With the `GetProductsByCategoryID` DAL method complete, the next step is to provide access to this method in the Business Logic Layer.</span></span> <span data-ttu-id="0e520-175">Otevřete soubor `ProductsBLLWithSprocs` třídy a přidejte následující metodu:</span><span class="sxs-lookup"><span data-stu-id="0e520-175">Open the `ProductsBLLWithSprocs` class file and add the following method:</span></span>

[!code-csharp[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample2.cs)]

<span data-ttu-id="0e520-176">Tato metoda knihoven BLL jednoduše vrátí `ProductsDataTable` vrácenou metodou `ProductsTableAdapter` s `GetProductsByCategoryID`.</span><span class="sxs-lookup"><span data-stu-id="0e520-176">This BLL method simply returns the `ProductsDataTable` returned from the `ProductsTableAdapter` s `GetProductsByCategoryID` method.</span></span> <span data-ttu-id="0e520-177">Atribut `DataObjectMethodAttribute` poskytuje metadata používaná průvodcem zdroj dat v prvku ObjectDataSource s konfigurací.</span><span class="sxs-lookup"><span data-stu-id="0e520-177">The `DataObjectMethodAttribute` attribute provides metadata used by the ObjectDataSource s Configure Data Source wizard.</span></span> <span data-ttu-id="0e520-178">Konkrétně se tato metoda zobrazí v rozevíracím seznamu vybrat kartu s.</span><span class="sxs-lookup"><span data-stu-id="0e520-178">In particular, this method will appear in the SELECT tab s drop-down list.</span></span>

## <a name="step-4-displaying-products-by-category"></a><span data-ttu-id="0e520-179">Krok 4: zobrazení produktů podle kategorií</span><span class="sxs-lookup"><span data-stu-id="0e520-179">Step 4: Displaying Products by Category</span></span>

<span data-ttu-id="0e520-180">Chcete-li otestovat nově přidanou `Products_SelectByCategoryID` uloženou proceduru a odpovídající metody DAL a knihoven BLL, vytvoříme stránku ASP.NET, která obsahuje DropDownList a GridView.</span><span class="sxs-lookup"><span data-stu-id="0e520-180">To test the newly added `Products_SelectByCategoryID` stored procedure and the corresponding DAL and BLL methods, let s create an ASP.NET page that contains a DropDownList and a GridView.</span></span> <span data-ttu-id="0e520-181">DropDownList zobrazí seznam všech kategorií v databázi, zatímco v prvku GridView se zobrazí produkty patřící do vybrané kategorie.</span><span class="sxs-lookup"><span data-stu-id="0e520-181">The DropDownList will list all of the categories in the database while the GridView will display the products belonging to the selected category.</span></span>

> [!NOTE]
> <span data-ttu-id="0e520-182">V předchozích kurzech jsme vytvořili rozhraní hlavní/podrobnosti pomocí ovládacích prvků DropDownList.</span><span class="sxs-lookup"><span data-stu-id="0e520-182">We ve created master/detail interfaces using DropDownLists in previous tutorials.</span></span> <span data-ttu-id="0e520-183">Podrobnější pohled na implementaci takové sestavy hlavní/podrobnosti najdete v kurzu zobrazení [hlavního/podrobného filtru pomocí DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="0e520-183">For a more in-depth look at implementing such a master/detail report, refer to the [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-cs.md) tutorial.</span></span>

<span data-ttu-id="0e520-184">Otevřete stránku `ExistingSprocs.aspx` ve složce `AdvancedDAL` a přetáhněte DropDownList z panelu nástrojů na Návrhář.</span><span class="sxs-lookup"><span data-stu-id="0e520-184">Open the `ExistingSprocs.aspx` page in the `AdvancedDAL` folder and drag a DropDownList from the Toolbox onto the Designer.</span></span> <span data-ttu-id="0e520-185">Nastavte vlastnost `ID` DropDownList s na `Categories` a její vlastnost `AutoPostBack` na `true`.</span><span class="sxs-lookup"><span data-stu-id="0e520-185">Set the DropDownList s `ID` property to `Categories` and its `AutoPostBack` property to `true`.</span></span> <span data-ttu-id="0e520-186">Dále z jeho inteligentní značky vytvořte objekt DropDownList s novým prvkem ObjectDataSource s názvem `CategoriesDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0e520-186">Next, from its smart tag, bind the DropDownList to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="0e520-187">Nakonfigurujte prvek ObjectDataSource tak, aby načítají jeho data z metody `CategoriesBLL` třídy s `GetCategories`.</span><span class="sxs-lookup"><span data-stu-id="0e520-187">Configure the ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="0e520-188">Nastavte rozevírací seznamy na kartách aktualizace, vložení a odstranění na (žádné).</span><span class="sxs-lookup"><span data-stu-id="0e520-188">Set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="0e520-189">[![načíst data z metody CategoriesBLL třídy s GetCategories](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-189">[![Retrieve Data from the CategoriesBLL Class s GetCategories Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image20.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image19.png)</span></span>

<span data-ttu-id="0e520-190">**Obrázek 7**: načtení dat z metody `GetCategories` `CategoriesBLL` třídy s ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="0e520-190">**Figure 7**: Retrieve Data from the `CategoriesBLL` Class s `GetCategories` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image21.png))</span></span>

<span data-ttu-id="0e520-191">[![nastavení rozevíracích seznamů na kartách aktualizace, vložení a odstranění na (žádné)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-191">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image23.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image22.png)</span></span>

<span data-ttu-id="0e520-192">**Obrázek 8**: nastavení rozevíracích seznamů na kartách aktualizace, vložení a odstranění na (žádné) ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="0e520-192">**Figure 8**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image24.png))</span></span>

<span data-ttu-id="0e520-193">Po dokončení průvodce ObjectDataSource nakonfigurujte DropDownList tak, aby zobrazilo pole `CategoryName` dat a `CategoryID` pole jako `Value` pro každý `ListItem`.</span><span class="sxs-lookup"><span data-stu-id="0e520-193">After completing the ObjectDataSource wizard, configure the DropDownList to display the `CategoryName` data field and to use the `CategoryID` field as the `Value` for each `ListItem`.</span></span>

<span data-ttu-id="0e520-194">V tomto okamžiku by deklarativní označení DropDownList a ObjectDataSource s mělo vypadat podobně jako následující:</span><span class="sxs-lookup"><span data-stu-id="0e520-194">At this point, the DropDownList and ObjectDataSource s declarative markup should similar to the following:</span></span>

[!code-aspx[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample3.aspx)]

<span data-ttu-id="0e520-195">Dále přetáhněte prvek GridView do návrháře a umístěte jej pod ovládací prvek DropDownList.</span><span class="sxs-lookup"><span data-stu-id="0e520-195">Next, drag a GridView onto the Designer, placing it beneath the DropDownList.</span></span> <span data-ttu-id="0e520-196">Nastavte `ID` prvku GridView s `ProductsByCategory` a ze své inteligentní značky jej navažte na nový prvek ObjectDataSource s názvem `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="0e520-196">Set the GridView s `ID` to `ProductsByCategory` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="0e520-197">Nakonfigurujte `ProductsByCategoryDataSource` prvek ObjectDataSource pro použití `ProductsBLLWithSprocs` třídy, který získá data pomocí metody `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="0e520-197">Configure the `ProductsByCategoryDataSource` ObjectDataSource to use the `ProductsBLLWithSprocs` class, having it retrieve its data using the `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="0e520-198">Vzhledem k tomu, že se tento prvek GridView použije jenom k zobrazení dat, nastavte rozevírací seznamy na kartách aktualizace, vložení a odstranění na (žádné) a klikněte na další.</span><span class="sxs-lookup"><span data-stu-id="0e520-198">Since this GridView will only be used to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) and click Next.</span></span>

<span data-ttu-id="0e520-199">[![nakonfigurovat prvek ObjectDataSource tak, aby používal třídu ProductsBLLWithSprocs](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-199">[![Configure the ObjectDataSource to Use the ProductsBLLWithSprocs Class](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image26.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image25.png)</span></span>

<span data-ttu-id="0e520-200">**Obrázek 9**: Konfigurace prvku ObjectDataSource, aby používal třídu `ProductsBLLWithSprocs` ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="0e520-200">**Figure 9**: Configure the ObjectDataSource to Use the `ProductsBLLWithSprocs` Class ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image27.png))</span></span>

<span data-ttu-id="0e520-201">[![načíst data z metody GetProductsByCategoryID (KódKategorie)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-201">[![Retrieve Data from the GetProductsByCategoryID(categoryID) Method](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image29.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image28.png)</span></span>

<span data-ttu-id="0e520-202">**Obrázek 10**: načtení dat z metody `GetProductsByCategoryID(categoryID)` ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="0e520-202">**Figure 10**: Retrieve Data from the `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image30.png))</span></span>

<span data-ttu-id="0e520-203">Metoda zvolená na kartě vybrat očekává parametr, takže poslední krok průvodce vás vyzve k zadání zdroje parametru s.</span><span class="sxs-lookup"><span data-stu-id="0e520-203">The method chosen in the SELECT tab expects a parameter, so the final step of the wizard prompts us for the parameter s source.</span></span> <span data-ttu-id="0e520-204">V rozevíracím seznamu zdroj parametrů nastavte ovládací prvek a vyberte ovládací prvek `Categories` v rozevíracím seznamu ControlID.</span><span class="sxs-lookup"><span data-stu-id="0e520-204">Set the Parameter source drop-down list to Control and choose the `Categories` control from the ControlID drop-down list.</span></span> <span data-ttu-id="0e520-205">Kliknutím na Dokončit dokončete průvodce.</span><span class="sxs-lookup"><span data-stu-id="0e520-205">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="0e520-206">[![použít kategorii DropDownList jako zdroj parametru KódKategorie](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-206">[![Use the Categories DropDownList as the Source of the categoryID Parameter](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image32.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image31.png)</span></span>

<span data-ttu-id="0e520-207">**Obrázek 11**: jako zdroj parametru `categoryID` použijte `Categories` DropDownList ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png)).</span><span class="sxs-lookup"><span data-stu-id="0e520-207">**Figure 11**: Use the `Categories` DropDownList as the Source of the `categoryID` Parameter ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image33.png))</span></span>

<span data-ttu-id="0e520-208">Po dokončení průvodce ObjectDataSource Visual Studio přidá BoundFields a třídě CheckBoxField podporována pro každé pole dat produktu.</span><span class="sxs-lookup"><span data-stu-id="0e520-208">Upon completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="0e520-209">V takovém případě můžete tato pole přizpůsobit podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="0e520-209">Feel free to customize these fields as you see fit.</span></span>

<span data-ttu-id="0e520-210">Navštivte stránku v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="0e520-210">Visit the page through a browser.</span></span> <span data-ttu-id="0e520-211">Při návštěvě stránky je vybrána kategorie nápoje a odpovídající produkty uvedené v mřížce.</span><span class="sxs-lookup"><span data-stu-id="0e520-211">When visiting the page the Beverages category is selected and the corresponding products listed in the grid.</span></span> <span data-ttu-id="0e520-212">Změna rozevíracího seznamu na alternativní kategorii, jak ukazuje obrázek 12, způsobí postback a znovu načte mřížku s produkty nově vybrané kategorie.</span><span class="sxs-lookup"><span data-stu-id="0e520-212">Changing the drop-down list to an alternative category, as Figure 12 shows, causes a postback and reloads the grid with the products of the newly selected category.</span></span>

<span data-ttu-id="0e520-213">[![se zobrazí produkty v kategorii plodiny.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-213">[![The Products in the Produce Category are Displayed](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image35.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image34.png)</span></span>

<span data-ttu-id="0e520-214">**Obrázek 12**: zobrazí se produkty v kategorii plodiny ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image36.png)).</span><span class="sxs-lookup"><span data-stu-id="0e520-214">**Figure 12**: The Products in the Produce Category are Displayed ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image36.png))</span></span>

## <a name="step-5-wrapping-a-stored-procedure-s-statements-within-the-scope-of-a-transaction"></a><span data-ttu-id="0e520-215">Krok 5: zabalení uložených procedur s příkazy v rámci oboru transakce</span><span class="sxs-lookup"><span data-stu-id="0e520-215">Step 5: Wrapping a Stored Procedure s Statements Within the Scope of a Transaction</span></span>

<span data-ttu-id="0e520-216">V rámci kurzových [úprav v rámci transakce](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) jsme provedli postupy pro provádění řady příkazů pro úpravu databáze v rámci rozsahu transakce.</span><span class="sxs-lookup"><span data-stu-id="0e520-216">In the [Wrapping Database Modifications within a Transaction](../working-with-batched-data/wrapping-database-modifications-within-a-transaction-cs.md) tutorial we discussed techniques for performing a series of database modification statements within the scope of a transaction.</span></span> <span data-ttu-id="0e520-217">Navrácení změn provedených v rámci zastřešující transakce buď úspěšně, nebo neúspěšných, s jistotou nedělitelnost</span><span class="sxs-lookup"><span data-stu-id="0e520-217">Recall that the modifications performed under the umbrella of a transaction either all succeed or all fail, guaranteeing atomicity.</span></span> <span data-ttu-id="0e520-218">Mezi techniky použití transakcí patří:</span><span class="sxs-lookup"><span data-stu-id="0e520-218">Techniques for using transactions include:</span></span>

- <span data-ttu-id="0e520-219">Pomocí tříd v oboru názvů `System.Transactions`,</span><span class="sxs-lookup"><span data-stu-id="0e520-219">Using the classes in the `System.Transactions` namespace,</span></span>
- <span data-ttu-id="0e520-220">Vrstva přístupu k datům používá třídy ADO.NET jako `SqlTransaction`a</span><span class="sxs-lookup"><span data-stu-id="0e520-220">Having the Data Access Layer use ADO.NET classes like `SqlTransaction`, and</span></span>
- <span data-ttu-id="0e520-221">Přidání příkazů transakce T-SQL přímo do uložené procedury</span><span class="sxs-lookup"><span data-stu-id="0e520-221">Adding the T-SQL transaction commands directly within the stored procedure</span></span>

<span data-ttu-id="0e520-222">V *rámci kurzu transakce zalamování změn databáze* byly použity třídy ADO.NET v dal.</span><span class="sxs-lookup"><span data-stu-id="0e520-222">The *Wrapping Database Modifications within a Transaction* tutorial used the ADO.NET classes in the DAL.</span></span> <span data-ttu-id="0e520-223">Zbývající část tohoto kurzu prověřuje způsob správy transakce pomocí příkazů T-SQL z uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="0e520-223">The remainder of this tutorial examines how to manage a transaction using T-SQL commands from within a stored procedure.</span></span>

<span data-ttu-id="0e520-224">Tři klíčové příkazy jazyka SQL pro ruční spuštění, potvrzení a vrácení transakce jsou `BEGIN TRANSACTION`, `COMMIT TRANSACTION`a `ROLLBACK TRANSACTION`v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="0e520-224">The three key SQL commands for manually starting, committing, and rolling back a transaction are `BEGIN TRANSACTION`, `COMMIT TRANSACTION`, and `ROLLBACK TRANSACTION`, respectively.</span></span> <span data-ttu-id="0e520-225">Podobně jako u přístupu ADO.NET potřebuje při použití transakcí z uložené procedury použít následující vzor:</span><span class="sxs-lookup"><span data-stu-id="0e520-225">Like with the ADO.NET approach, when using transactions from within a stored procedure we need to apply the following pattern:</span></span>

1. <span data-ttu-id="0e520-226">Označuje začátek transakce.</span><span class="sxs-lookup"><span data-stu-id="0e520-226">Indicate the start of a transaction.</span></span>
2. <span data-ttu-id="0e520-227">Spusťte příkazy SQL, které tvoří transakci.</span><span class="sxs-lookup"><span data-stu-id="0e520-227">Execute the SQL statements that comprise the transaction.</span></span>
3. <span data-ttu-id="0e520-228">Pokud dojde k chybě v některém z příkazů z kroku 2, vraťte transakci zpět.</span><span class="sxs-lookup"><span data-stu-id="0e520-228">If there is an error in any one of the statements from Step 2, rollback the transaction</span></span>
4. <span data-ttu-id="0e520-229">Pokud všechny příkazy z kroku 2 se dokončí bez chyby, potvrďte transakci.</span><span class="sxs-lookup"><span data-stu-id="0e520-229">If all of the statements from Step 2 complete without error, commit the transaction.</span></span>

<span data-ttu-id="0e520-230">Tento model může být implementován v syntaxi T-SQL pomocí následující šablony:</span><span class="sxs-lookup"><span data-stu-id="0e520-230">This pattern can be implemented in T-SQL syntax using the following template:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample4.sql)]

<span data-ttu-id="0e520-231">Šablona začíná definováním `TRY...CATCH`ho bloku, konstrukce nového do SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="0e520-231">The template starts by defining a `TRY...CATCH` block, a construct new to SQL Server 2005.</span></span> <span data-ttu-id="0e520-232">Podobně jako u `try...catch`ch C#bloků v systému, `TRY...CATCH` blok SQL spouští příkazy v bloku `TRY`.</span><span class="sxs-lookup"><span data-stu-id="0e520-232">Like with `try...catch` blocks in C#, the SQL `TRY...CATCH` block executes the statements in the `TRY` block.</span></span> <span data-ttu-id="0e520-233">Pokud některý příkaz vyvolá chybu, řízení je okamžitě převedeno na blok `CATCH`.</span><span class="sxs-lookup"><span data-stu-id="0e520-233">If any statement raises an error, control is immediately transferred to the `CATCH` block.</span></span>

<span data-ttu-id="0e520-234">Pokud nedochází k žádným chybám, které provádějí příkazy SQL, které strukturu transakci, příkaz `COMMIT TRANSACTION` potvrdí změny a dokončí transakci.</span><span class="sxs-lookup"><span data-stu-id="0e520-234">If there are no errors executing the SQL statements that makeup the transaction, the `COMMIT TRANSACTION` statement commits the changes and completes the transaction.</span></span> <span data-ttu-id="0e520-235">Pokud však jeden z příkazů způsobí chybu, `ROLLBACK TRANSACTION` v bloku `CATCH` vrátí databázi do stavu před zahájením transakce.</span><span class="sxs-lookup"><span data-stu-id="0e520-235">If, however, one of the statements results in an error, the `ROLLBACK TRANSACTION` in the `CATCH` block returns the database to its state prior to the start of the transaction.</span></span> <span data-ttu-id="0e520-236">Uložená procedura také vyvolá chybu pomocí [příkazu RAISERROR](https://msdn.microsoft.com/library/ms178592.aspx), který způsobí, že `SqlException` v aplikaci vyvolána.</span><span class="sxs-lookup"><span data-stu-id="0e520-236">The stored procedure also raises an error using the [RAISERROR command](https://msdn.microsoft.com/library/ms178592.aspx), which causes a `SqlException` to be raised in the application.</span></span>

> [!NOTE]
> <span data-ttu-id="0e520-237">Vzhledem k tomu, že je `TRY...CATCH` blok novinkou SQL Server 2005, nebude tato šablona fungovat, pokud používáte starší verze Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0e520-237">Since the `TRY...CATCH` block is new to SQL Server 2005, the above template will not work if you are using older versions of Microsoft SQL Server.</span></span> <span data-ttu-id="0e520-238">Pokud nepoužíváte SQL Server 2005, prostudujte si část [Správa transakcí v SQL Server uložených procedurách](http://www.4guysfromrolla.com/webtech/080305-1.shtml) pro šablonu, která bude fungovat s jinými verzemi SQL Server.</span><span class="sxs-lookup"><span data-stu-id="0e520-238">If you are not using SQL Server 2005, consult [Managing Transactions in SQL Server Stored Procedures](http://www.4guysfromrolla.com/webtech/080305-1.shtml) for a template that will work with other versions of SQL Server.</span></span>

<span data-ttu-id="0e520-239">Pojďme se podívat na konkrétní příklad.</span><span class="sxs-lookup"><span data-stu-id="0e520-239">Let s look at a concrete example.</span></span> <span data-ttu-id="0e520-240">Mezi tabulkami `Categories` a `Products` existuje omezení cizího klíče, což znamená, že každé `CategoryID` pole v tabulce `Products` musí být namapováno na `CategoryID` hodnotu v tabulce `Categories`.</span><span class="sxs-lookup"><span data-stu-id="0e520-240">A foreign key constraint exists between the `Categories` and `Products` tables, meaning that each `CategoryID` field in the `Products` table must map to a `CategoryID` value in the `Categories` table.</span></span> <span data-ttu-id="0e520-241">Výsledkem jakékoli akce, která by porušila toto omezení, například pokus o odstranění kategorie s přidruženými produkty, má za následek porušení omezení cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="0e520-241">Any action that would violate this constraint, such as attempting to delete a category that has associated products, results in a foreign key constraint violation.</span></span> <span data-ttu-id="0e520-242">Pokud to chcete ověřit, přečtěte si příklad aktualizace a odstranění stávajících binárních dat v části práce s binárními daty (`~/BinaryData/UpdatingAndDeleting.aspx`).</span><span class="sxs-lookup"><span data-stu-id="0e520-242">To verify this, revisit the Updating and Deleting Existing Binary Data example in the Working with Binary Data section (`~/BinaryData/UpdatingAndDeleting.aspx`).</span></span> <span data-ttu-id="0e520-243">Tato stránka obsahuje všechny kategorie v systému spolu s tlačítky upravit a odstranit (viz obrázek 13), ale pokud se pokusíte odstranit kategorii, která má přidružené produkty, například nápoje – odstranění se nezdaří kvůli porušení omezení cizího klíče (viz obrázek 14).</span><span class="sxs-lookup"><span data-stu-id="0e520-243">This page lists each category in the system along with Edit and Delete buttons (see Figure 13), but if you attempt to delete a category that has associated products - such as Beverages - the delete fails due to a foreign key constraint violation (see Figure 14).</span></span>

<span data-ttu-id="0e520-244">[![se každá kategorie zobrazuje v prvku GridView s tlačítky upravit a odstranit](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-244">[![Each Category is Displayed in a GridView with Edit and Delete Buttons](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image38.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image37.png)</span></span>

<span data-ttu-id="0e520-245">**Obrázek 13**: Každá kategorie se zobrazuje v prvku GridView s tlačítky upravit a odstranit ([kliknutím zobrazíte obrázek v plné velikosti](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image39.png)).</span><span class="sxs-lookup"><span data-stu-id="0e520-245">**Figure 13**: Each Category is Displayed in a GridView with Edit and Delete Buttons ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image39.png))</span></span>

<span data-ttu-id="0e520-246">[![nemůžete odstranit kategorii, která má existující produkty.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-246">[![You Cannot Delete a Category that has Existing Products](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image41.png)](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image40.png)</span></span>

<span data-ttu-id="0e520-247">**Obrázek 14**: nelze odstranit kategorii, která obsahuje existující produkty ([kliknutím zobrazíte obrázek v plné velikosti).](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="0e520-247">**Figure 14**: You Cannot Delete a Category that has Existing Products ([Click to view full-size image](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image42.png))</span></span>

<span data-ttu-id="0e520-248">Představte si, že ale chceme, aby se kategorie odstranily bez ohledu na to, jestli mají přidružené produkty.</span><span class="sxs-lookup"><span data-stu-id="0e520-248">Imagine, though, that we want to allow categories to be deleted regardless of whether they have associated products.</span></span> <span data-ttu-id="0e520-249">Pokud má být kategorie s produkty smazána, Představte si, že chceme také odstranit stávající produkty (i když další možností je jednoduše nastavit produkty `CategoryID` hodnoty na `NULL`).</span><span class="sxs-lookup"><span data-stu-id="0e520-249">Should a category with products be deleted, imagine that we want to also delete its existing products (although another option would be to simply set its products `CategoryID` values to `NULL`).</span></span> <span data-ttu-id="0e520-250">Tato funkce se dá implementovat pomocí pravidel kaskádového omezení cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="0e520-250">This functionality could be implemented through the cascade rules of the foreign key constraint.</span></span> <span data-ttu-id="0e520-251">Alternativně můžeme vytvořit uloženou proceduru, která přijímá vstupní parametr `@CategoryID` a při vyvolání explicitně odstraní všechny přidružené produkty a pak zadanou kategorii.</span><span class="sxs-lookup"><span data-stu-id="0e520-251">Alternatively, we could create a stored procedure that accepts a `@CategoryID` input parameter and, when invoked, explicitly deletes all of the associated products and then the specified category.</span></span>

<span data-ttu-id="0e520-252">Náš první pokus na takovou uloženou proceduru by mohl vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="0e520-252">Our first attempt at such a stored procedure might look like the following:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample5.sql)]

<span data-ttu-id="0e520-253">I když se tím neodstraní přidružené produkty a kategorie, neudělá to v rámci transakce.</span><span class="sxs-lookup"><span data-stu-id="0e520-253">While this will definitely delete the associated products and category, it does not do so under the umbrella of a transaction.</span></span> <span data-ttu-id="0e520-254">Představte si, že je u `Categories` nějaké jiné omezení cizího klíče, které by bránilo odstranění konkrétní `@CategoryID` hodnoty.</span><span class="sxs-lookup"><span data-stu-id="0e520-254">Imagine that there is some other foreign key constraint on `Categories` that would prohibit the deletion of a particular `@CategoryID` value.</span></span> <span data-ttu-id="0e520-255">Problémem je to, že v takovém případě se před pokusem o odstranění kategorie odstraní všechny produkty.</span><span class="sxs-lookup"><span data-stu-id="0e520-255">The problem is that in such a case all of the products will be deleted before we attempt to delete the category.</span></span> <span data-ttu-id="0e520-256">Čistý výsledek je takový, že pro takovou kategorii by tato uložená procedura odebrala všechny své produkty, zatímco tato kategorie stále obsahuje související záznamy v některé jiné tabulce.</span><span class="sxs-lookup"><span data-stu-id="0e520-256">The net result is that for such a category, this stored procedure would remove all of its products while the category remained since it still has related records in some other table.</span></span>

<span data-ttu-id="0e520-257">Pokud byla uložená procedura zabalena v rámci rozsahu transakce, ale odstranění do `Products` tabulky by se vrátilo zpět na tvář neúspěšného odstranění při `Categories`.</span><span class="sxs-lookup"><span data-stu-id="0e520-257">If the stored procedure were wrapped within the scope of a transaction, however, the deletes to the `Products` table would be rolled back in the face of a failed delete on `Categories`.</span></span> <span data-ttu-id="0e520-258">Následující skript uložených procedur používá transakci k zajištění nedělitelnost mezi dvěma příkazy `DELETE`:</span><span class="sxs-lookup"><span data-stu-id="0e520-258">The following stored procedure script uses a transaction to assure atomicity between the two `DELETE` statements:</span></span>

[!code-sql[Main](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/samples/sample6.sql)]

<span data-ttu-id="0e520-259">Chvíli přidejte `Categories_Delete` uloženou proceduru do databáze Northwind.</span><span class="sxs-lookup"><span data-stu-id="0e520-259">Take a moment to add the `Categories_Delete` stored procedure to the Northwind database.</span></span> <span data-ttu-id="0e520-260">Pokyny k přidání uložených procedur do databáze najdete v části zpět ke kroku 1.</span><span class="sxs-lookup"><span data-stu-id="0e520-260">Refer back to Step 1 for instructions on adding stored procedures to a database.</span></span>

## <a name="step-6-updating-thecategoriestableadapter"></a><span data-ttu-id="0e520-261">Krok 6: aktualizace`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="0e520-261">Step 6: Updating the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="0e520-262">I když jsme do databáze přidali `Categories_Delete` uloženou proceduru, je DAL v současné době nakonfigurovaná k provedení odstranění pomocí ad hoc příkazů SQL.</span><span class="sxs-lookup"><span data-stu-id="0e520-262">While we ve added the `Categories_Delete` stored procedure to the database, the DAL is currently configured to use ad-hoc SQL statements to perform the delete.</span></span> <span data-ttu-id="0e520-263">Musíme aktualizovat `CategoriesTableAdapter` a dát mu pokyn použít místo toho `Categories_Delete` uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="0e520-263">We need to update the `CategoriesTableAdapter` and instruct it to use the `Categories_Delete` stored procedure instead.</span></span>

> [!NOTE]
> <span data-ttu-id="0e520-264">Dříve v tomto kurzu jsme pracovali s `NorthwindWithSprocs` datovou sadou.</span><span class="sxs-lookup"><span data-stu-id="0e520-264">Earlier in this tutorial we were working with the `NorthwindWithSprocs` DataSet.</span></span> <span data-ttu-id="0e520-265">Tato datová sada ale má jenom jednu entitu, `ProductsDataTable`a potřebujeme pracovat s kategoriemi.</span><span class="sxs-lookup"><span data-stu-id="0e520-265">But that DataSet only has a single entity, `ProductsDataTable`, and we need to work with categories.</span></span> <span data-ttu-id="0e520-266">Proto ve zbývající části tohoto kurzu zjistíte, že se ve vrstvě pro přístup k datům I m odkazuje na `Northwind` datovou sadu, kterou jsme vytvořili poprvé v kurzu [Vytvoření vrstvy přístupu k datům](../introduction/creating-a-data-access-layer-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="0e520-266">Therefore, for the remainder of this tutorial when I talk about the Data Access Layer I m referring to the `Northwind` DataSet, the one that we first created in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial.</span></span>

<span data-ttu-id="0e520-267">Otevřete datovou sadu Northwind, vyberte `CategoriesTableAdapter`a přejít na okno Vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="0e520-267">Open the Northwind DataSet, select the `CategoriesTableAdapter`, and go to the Properties window.</span></span> <span data-ttu-id="0e520-268">Okno Vlastnosti uvádí `InsertCommand`, `UpdateCommand`, `DeleteCommand`a `SelectCommand` používané v TableAdapter a také název a informace o připojení.</span><span class="sxs-lookup"><span data-stu-id="0e520-268">The Properties window lists the `InsertCommand`, `UpdateCommand`, `DeleteCommand`, and `SelectCommand` used by the TableAdapter, as well as its name and connection information.</span></span> <span data-ttu-id="0e520-269">Rozbalením vlastnosti `DeleteCommand` zobrazíte její podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="0e520-269">Expand the `DeleteCommand` property to see its details.</span></span> <span data-ttu-id="0e520-270">Jak ukazuje obrázek 15, vlastnost `DeleteCommand` s `CommandType` je nastavena na text, který dává pokyn k odeslání textu ve vlastnosti `CommandText` jako dotaz SQL ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="0e520-270">As Figure 15 shows, the `DeleteCommand` s `CommandType` property is set to Text, which instructs it to send the text in the `CommandText` property as an ad-hoc SQL query.</span></span>

![Vyberte CategoriesTableAdapter v návrháři, aby se zobrazily jeho vlastnosti v okně Vlastnosti.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image43.png)

<span data-ttu-id="0e520-272">**Obrázek 15**: vyberte `CategoriesTableAdapter` v návrháři, aby se zobrazily jeho vlastnosti v okně Vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="0e520-272">**Figure 15**: Select the `CategoriesTableAdapter` in the Designer to View Its Properties in the Properties Window</span></span>

<span data-ttu-id="0e520-273">Chcete-li změnit tato nastavení, vyberte v okno Vlastnosti text (DeleteCommand) a v rozevíracím seznamu zvolte možnost (nové).</span><span class="sxs-lookup"><span data-stu-id="0e520-273">To change these settings, select the (DeleteCommand) text in the Properties window and choose (New) from the drop-down list.</span></span> <span data-ttu-id="0e520-274">Tím se vymažou nastavení vlastností `CommandText`, `CommandType`a `Parameters`.</span><span class="sxs-lookup"><span data-stu-id="0e520-274">This will clear out the settings for the `CommandText`, `CommandType`, and `Parameters` properties.</span></span> <span data-ttu-id="0e520-275">V dalším kroku nastavte vlastnost `CommandType` na `StoredProcedure` a potom zadejte název uložené procedury pro `CommandText` (`dbo.Categories_Delete`).</span><span class="sxs-lookup"><span data-stu-id="0e520-275">Next, set the `CommandType` property to `StoredProcedure` and then type in the name of the stored procedure for the `CommandText` (`dbo.Categories_Delete`).</span></span> <span data-ttu-id="0e520-276">Pokud zadáte vlastnosti v tomto pořadí – nejdříve `CommandType` a potom `CommandText` – Visual Studio automaticky naplní kolekci Parameters.</span><span class="sxs-lookup"><span data-stu-id="0e520-276">If you make sure to enter the properties in this order - first the `CommandType` and then the `CommandText` - Visual Studio will automatically populate the Parameters collection.</span></span> <span data-ttu-id="0e520-277">Pokud tyto vlastnosti v tomto pořadí nezadáte, budete muset ručně přidat parametry pomocí editoru kolekce Parameters.</span><span class="sxs-lookup"><span data-stu-id="0e520-277">If you do not enter these properties in this order, you will have to manually add the parameters through the Parameters Collection Editor.</span></span> <span data-ttu-id="0e520-278">V obou případech je vhodné kliknout na tři tečky ve vlastnosti Parameters a vyvolat tak editor kolekce Parameters, aby bylo možné ověřit, zda byly provedeny správné změny nastavení parametrů (viz obrázek 16).</span><span class="sxs-lookup"><span data-stu-id="0e520-278">In either case, it s prudent to click on the ellipses in the Parameters property to bring up the Parameters Collection Editor to verify that the correct parameter settings changes have been made (see Figure 16).</span></span> <span data-ttu-id="0e520-279">Pokud v dialogovém okně nevidíte žádné parametry, přidejte parametr `@CategoryID` ručně (nemusíte `@RETURN_VALUE` parametr přidat).</span><span class="sxs-lookup"><span data-stu-id="0e520-279">If you do not see any parameters in the dialog box, add the `@CategoryID` parameter manually (you do not need to add the `@RETURN_VALUE` parameter).</span></span>

![Ujistěte se, že je nastavení parametrů správné.](using-existing-stored-procedures-for-the-typed-dataset-s-tableadapters-cs/_static/image44.png)

<span data-ttu-id="0e520-281">**Obrázek 16**: Ujistěte se, že je nastavení parametrů správné.</span><span class="sxs-lookup"><span data-stu-id="0e520-281">**Figure 16**: Ensure That the Parameters Settings are Correct</span></span>

<span data-ttu-id="0e520-282">Po aktualizaci DAL dojde k odstranění kategorie k automatickému odstranění všech přidružených produktů a k tomu v rámci transakce.</span><span class="sxs-lookup"><span data-stu-id="0e520-282">Once the DAL has been updated, deleting a category will automatically delete all of its associated products and do so under the umbrella of a transaction.</span></span> <span data-ttu-id="0e520-283">Pokud to chcete ověřit, vraťte se na stránku aktualizace a odstranění stávajících binárních dat a klikněte na tlačítko Odstranit pro jednu z kategorií.</span><span class="sxs-lookup"><span data-stu-id="0e520-283">To verify this, return to the Updating and Deleting Existing Binary Data page and click the Delete button for one of the categories.</span></span> <span data-ttu-id="0e520-284">Jedním kliknutím myši se odstraní kategorie a všechny její přidružené produkty.</span><span class="sxs-lookup"><span data-stu-id="0e520-284">With one single click of the mouse, the category and all of its associated products will be deleted.</span></span>

> [!NOTE]
> <span data-ttu-id="0e520-285">Než otestujete `Categories_Delete` uloženou proceduru, která odstraní řadu produktů společně s vybranou kategorií, může být vhodné vytvořit záložní kopii vaší databáze.</span><span class="sxs-lookup"><span data-stu-id="0e520-285">Before testing the `Categories_Delete` stored procedure, which will delete a number of products along with the selected category, it might be prudent to make a backup copy of your database.</span></span> <span data-ttu-id="0e520-286">Pokud používáte databázi `NORTHWND.MDF` v `App_Data`, stačí zavřít aplikaci Visual Studio a zkopírovat soubory MDF a LDF v `App_Data` do jiné složky.</span><span class="sxs-lookup"><span data-stu-id="0e520-286">If you are using the `NORTHWND.MDF` database in `App_Data`, simply close Visual Studio and copy the MDF and LDF files in `App_Data` to some other folder.</span></span> <span data-ttu-id="0e520-287">Po otestování funkčnosti můžete databázi obnovit ukončením sady Visual Studio a nahrazením aktuálních souborů MDF a LDF v `App_Data` záložními kopiemi.</span><span class="sxs-lookup"><span data-stu-id="0e520-287">After testing the functionality, you can restore the database by closing Visual Studio and replacing the current MDF and LDF files in `App_Data` with the backup copies.</span></span>

## <a name="summary"></a><span data-ttu-id="0e520-288">Souhrn</span><span class="sxs-lookup"><span data-stu-id="0e520-288">Summary</span></span>

<span data-ttu-id="0e520-289">I když Průvodce TableAdapterí automaticky vygeneruje uložené procedury pro nás, nastane čas, kdy je možné tyto uložené procedury už vytvořit nebo je chtít vytvořit ručně nebo pomocí jiných nástrojů.</span><span class="sxs-lookup"><span data-stu-id="0e520-289">While the TableAdapter s wizard will automatically generate stored procedures for us, there are times when we might already have such stored procedures created or want to create them manually or with other tools instead.</span></span> <span data-ttu-id="0e520-290">Pro uspokojení takových scénářů může být TableAdapter také nakonfigurován tak, aby odkazoval na stávající uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="0e520-290">To accommodate such scenarios, the TableAdapter can also be configured to point to an existing stored procedure.</span></span> <span data-ttu-id="0e520-291">V tomto kurzu jsme se vyhlédli do postupu ručního přidání uložených procedur do databáze prostřednictvím prostředí sady Visual Studio a způsobu, jak tyto uložené procedury nakabelovat metody TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="0e520-291">In this tutorial we looked at how to manually add stored procedures to a database through the Visual Studio environment and how to wire the TableAdapter s methods to these stored procedures.</span></span> <span data-ttu-id="0e520-292">Prozkoumali jsme také příkazy T-SQL a vzor skriptu, který se používá pro spouštění, potvrzování a vracení zpětných transakcí z uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="0e520-292">We also examined the T-SQL commands and script pattern used for starting, committing, and rolling back transactions from within a stored procedure.</span></span>

<span data-ttu-id="0e520-293">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="0e520-293">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="0e520-294">O autorovi</span><span class="sxs-lookup"><span data-stu-id="0e520-294">About the Author</span></span>

<span data-ttu-id="0e520-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor 7 ASP/ASP. NET Books a zakladatel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="0e520-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0e520-296">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="0e520-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0e520-297">Nejnovější kniha je [*Sams naučit se ASP.NET 2,0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="0e520-297">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="0e520-298">Dá se získat na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0e520-298">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="0e520-299">nebo prostřednictvím svého blogu, který najdete na adrese [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="0e520-299">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="0e520-300">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="0e520-300">Special Thanks To</span></span>

<span data-ttu-id="0e520-301">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="0e520-301">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="0e520-302">Kontroloři vedoucích k tomuto kurzu byli Hilton Geisenow, S Ren Jacob Lauritsen a Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="0e520-302">Lead reviewers for this tutorial were Hilton Geisenow, S ren Jacob Lauritsen, and Teresa Murphy.</span></span> <span data-ttu-id="0e520-303">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="0e520-303">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="0e520-304">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0e520-304">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0e520-305">[Předchozí](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
> [Další](updating-the-tableadapter-to-use-joins-cs.md)</span><span class="sxs-lookup"><span data-stu-id="0e520-305">[Previous](creating-new-stored-procedures-for-the-typed-dataset-s-tableadapters-cs.md)
[Next](updating-the-tableadapter-to-use-joins-cs.md)</span></span>
