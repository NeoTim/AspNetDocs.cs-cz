---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs
title: Provádění dávkových aktualizacíC#() | Microsoft Docs
author: rick-anderson
description: Naučte se, jak vytvořit plně upravitelný prvek DataList, kde jsou všechny jeho položky v režimu úprav a jejichž hodnoty se dají uložit kliknutím na tlačítko Aktualizovat vše na...
ms.author: riande
ms.date: 10/30/2006
ms.assetid: 57743ca7-5695-4e07-aed1-44b297f245a9
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/performing-batch-updates-cs
msc.type: authoredcontent
ms.openlocfilehash: cde12a4d24555216adc49dd02818901278932eaa
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/28/2019
ms.locfileid: "74631631"
---
# <a name="performing-batch-updates-c"></a><span data-ttu-id="a74a5-103">Provádění dávkových aktualizací (C#)</span><span class="sxs-lookup"><span data-stu-id="a74a5-103">Performing Batch Updates (C#)</span></span>

<span data-ttu-id="a74a5-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a74a5-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a74a5-105">[Stáhnout ukázkovou aplikaci](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_CS.exe) nebo [Stáhnout PDF](performing-batch-updates-cs/_static/datatutorial37cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a74a5-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_37_CS.exe) or [Download PDF](performing-batch-updates-cs/_static/datatutorial37cs1.pdf)</span></span>

> <span data-ttu-id="a74a5-106">Naučte se, jak vytvořit plně upravitelný prvek DataList, kde jsou všechny jeho položky v režimu úprav a jejichž hodnoty se dají uložit kliknutím na tlačítko Aktualizovat vše na stránce.</span><span class="sxs-lookup"><span data-stu-id="a74a5-106">Learn how to create a fully-editable DataList where all of its items are in edit mode and whose values can be saved by clicking an "Update All" button on the page.</span></span>

## <a name="introduction"></a><span data-ttu-id="a74a5-107">Úvod</span><span class="sxs-lookup"><span data-stu-id="a74a5-107">Introduction</span></span>

<span data-ttu-id="a74a5-108">V [předchozím kurzu](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) jsme prozkoumali, jak vytvořit prvek DataList na úrovni položky.</span><span class="sxs-lookup"><span data-stu-id="a74a5-108">In the [preceding tutorial](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) we examined how to create an item-level DataList.</span></span> <span data-ttu-id="a74a5-109">Podobně jako u standardních upravitelných prvků GridView, každá položka v prvku DataList zahrnovala tlačítko pro úpravy, které po kliknutí umožní upravit položku.</span><span class="sxs-lookup"><span data-stu-id="a74a5-109">Like the standard editable GridView, each item in the DataList included an Edit button that, when clicked, would make the item editable.</span></span> <span data-ttu-id="a74a5-110">I když tato úprava na úrovni položek funguje dobře pro data, která se aktualizují pouze občas, některé scénáře použití vyžadují, aby uživatel upravoval mnoho záznamů.</span><span class="sxs-lookup"><span data-stu-id="a74a5-110">While this item-level editing works well for data that is only updated occasionally, certain use case scenarios require the user to edit many records.</span></span> <span data-ttu-id="a74a5-111">Pokud uživatel potřebuje upravit desítky záznamů a je nucen kliknout na upravit, provést změny a kliknout na tlačítko Aktualizovat pro každé z nich, může se po kliknutí na tuto produktivitu považovat za překážku.</span><span class="sxs-lookup"><span data-stu-id="a74a5-111">If a user needs to edit dozens of records and is forced to click Edit, make their changes, and click Update for each one, the amount of clicking can hamper her productivity.</span></span> <span data-ttu-id="a74a5-112">V takových situacích lepší možností je poskytnout plně upravitelný prvek DataList *, který je* v režimu úprav a jehož hodnoty lze upravit kliknutím na tlačítko Aktualizovat vše na stránce (viz obrázek 1).</span><span class="sxs-lookup"><span data-stu-id="a74a5-112">In such situations, a better option is to provide a fully-editable DataList, one where *all* of its items are in edit mode and whose values can be edited by clicking an Update All button on the page (see Figure 1).</span></span>

<span data-ttu-id="a74a5-113">[![každou položku v plně upravitelném prvku DataList je možné upravit.](performing-batch-updates-cs/_static/image2.png)](performing-batch-updates-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a74a5-113">[![Each Item in a Fully Editable DataList can be Modified](performing-batch-updates-cs/_static/image2.png)](performing-batch-updates-cs/_static/image1.png)</span></span>

<span data-ttu-id="a74a5-114">**Obrázek 1**: každou položku v plně upravitelném prvku DataList je možné upravit ([kliknutím zobrazíte obrázek v plné velikosti).](performing-batch-updates-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a74a5-114">**Figure 1**: Each Item in a Fully Editable DataList can be Modified ([Click to view full-size image](performing-batch-updates-cs/_static/image3.png))</span></span>

<span data-ttu-id="a74a5-115">V tomto kurzu podíváme se, jak uživatelům umožnit aktualizovat informace o adresách dodavatelů pomocí plně upravitelného prvku DataList.</span><span class="sxs-lookup"><span data-stu-id="a74a5-115">In this tutorial we'll examine how to enable users to update suppliers address information using a fully editable DataList.</span></span>

## <a name="step-1-create-the-editable-user-interface-in-the-datalist-s-itemtemplate"></a><span data-ttu-id="a74a5-116">Krok 1: vytvoření upravitelného uživatelského rozhraní v DataList s ItemTemplate</span><span class="sxs-lookup"><span data-stu-id="a74a5-116">Step 1: Create the Editable User Interface in the DataList s ItemTemplate</span></span>

<span data-ttu-id="a74a5-117">V předchozím kurzu, kde vytvoříme standardní a upravitelný prvek DataList na úrovni položky, jsme použili dvě šablony:</span><span class="sxs-lookup"><span data-stu-id="a74a5-117">In the preceding tutorial, where we creating a standard, item-level editable DataList, we used two templates:</span></span>

- <span data-ttu-id="a74a5-118">`ItemTemplate` obsahuje uživatelské rozhraní jen pro čtení (webové ovládací prvky Label pro zobrazení jednotlivých názvů a cen produktů).</span><span class="sxs-lookup"><span data-stu-id="a74a5-118">`ItemTemplate` contained the read-only user interface (the Label Web controls for displaying each product s name and price).</span></span>
- <span data-ttu-id="a74a5-119">`EditItemTemplate` obsahuje uživatelské rozhraní režimu úprav (dva webové ovládací prvky TextBox).</span><span class="sxs-lookup"><span data-stu-id="a74a5-119">`EditItemTemplate` contained the edit mode user interface (the two TextBox Web controls).</span></span>

<span data-ttu-id="a74a5-120">Vlastnost DataList s `EditItemIndex` určuje, co `DataListItem` (pokud existuje) je vykresleno pomocí `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-120">The DataList s `EditItemIndex` property dictates what `DataListItem` (if any) is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="a74a5-121">Konkrétně `DataListItem`, jehož `ItemIndex` hodnota odpovídá vlastnosti `EditItemIndex` prvku DataList s, je vykreslen pomocí `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-121">In particular, the `DataListItem` whose `ItemIndex` value matches the DataList s `EditItemIndex` property is rendered using the `EditItemTemplate`.</span></span> <span data-ttu-id="a74a5-122">Tento model funguje dobře, když se dá upravovat jenom jedna položka, ale při vytváření plně upravitelného prvku DataList dojde k rozběhu.</span><span class="sxs-lookup"><span data-stu-id="a74a5-122">This model works well when only one item can be edited at a time, but falls apart when creating a fully-editable DataList.</span></span>

<span data-ttu-id="a74a5-123">Pro plně upravitelný prvek DataList chceme, aby *všechny* `DataListItem` s byly vykresleny pomocí upravitelného rozhraní.</span><span class="sxs-lookup"><span data-stu-id="a74a5-123">For a fully editable DataList, we want *all* of the `DataListItem` s to render using the editable interface.</span></span> <span data-ttu-id="a74a5-124">Nejjednodušší způsob, jak to provést, je definovat upravitelné rozhraní v `ItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-124">The simplest way to accomplish this is to define the editable interface in the `ItemTemplate`.</span></span> <span data-ttu-id="a74a5-125">Pro úpravu informací o adrese dodavatele obsahuje upravitelné rozhraní název dodavatele jako text a potom textová pole pro hodnoty adresa, město a země.</span><span class="sxs-lookup"><span data-stu-id="a74a5-125">For modifying the suppliers address information, the editable interface contains the supplier name as text and then TextBoxes for the address, city, and country values.</span></span>

<span data-ttu-id="a74a5-126">Začněte tím, že otevřete stránku `BatchUpdate.aspx`, přidáte ovládací prvek DataList a nastavíte jeho vlastnost `ID` na `Suppliers`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-126">Start by opening the `BatchUpdate.aspx` page, add a DataList control, and set its `ID` property to `Suppliers`.</span></span> <span data-ttu-id="a74a5-127">Z inteligentní značky DataList s Přihlaste se k přidání nového ovládacího prvku ObjectDataSource s názvem `SuppliersDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-127">From the DataList s smart tag, opt to add a new ObjectDataSource control named `SuppliersDataSource`.</span></span>

<span data-ttu-id="a74a5-128">[![vytvořit nový prvek ObjectDataSource s názvem SuppliersDataSource](performing-batch-updates-cs/_static/image5.png)](performing-batch-updates-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a74a5-128">[![Create a New ObjectDataSource Named SuppliersDataSource](performing-batch-updates-cs/_static/image5.png)](performing-batch-updates-cs/_static/image4.png)</span></span>

<span data-ttu-id="a74a5-129">**Obrázek 2**: vytvoření nového prvku ObjectDataSource s názvem `SuppliersDataSource` ([kliknutím zobrazíte obrázek v plné velikosti](performing-batch-updates-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="a74a5-129">**Figure 2**: Create a New ObjectDataSource Named `SuppliersDataSource` ([Click to view full-size image](performing-batch-updates-cs/_static/image6.png))</span></span>

<span data-ttu-id="a74a5-130">Nakonfigurujte prvek ObjectDataSource tak, aby načetl data pomocí metody `SuppliersBLL` třídy s `GetSuppliers()` (viz obrázek 3).</span><span class="sxs-lookup"><span data-stu-id="a74a5-130">Configure the ObjectDataSource to retrieve data using the `SuppliersBLL` class s `GetSuppliers()` method (see Figure 3).</span></span> <span data-ttu-id="a74a5-131">Stejně jako v předchozím kurzu, namísto aktualizace informací o dodavatelích prostřednictvím ObjectDataSource, budeme pracovat přímo s vrstvou obchodní logiky.</span><span class="sxs-lookup"><span data-stu-id="a74a5-131">As with the preceding tutorial, rather than updating the supplier information through the ObjectDataSource, we'll work directly with the Business Logic Layer.</span></span> <span data-ttu-id="a74a5-132">Proto na kartě aktualizace nastavte rozevírací seznam na (žádné) (viz obrázek 4).</span><span class="sxs-lookup"><span data-stu-id="a74a5-132">Therefore, set the drop-down list to (None) in the UPDATE tab (see Figure 4).</span></span>

<span data-ttu-id="a74a5-133">[![načíst informace o dodavateli pomocí metody getsuppliers ()](performing-batch-updates-cs/_static/image8.png)](performing-batch-updates-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="a74a5-133">[![Retrieve Supplier Information Using the GetSuppliers() Method](performing-batch-updates-cs/_static/image8.png)](performing-batch-updates-cs/_static/image7.png)</span></span>

<span data-ttu-id="a74a5-134">**Obrázek 3**: načtení informací o dodavateli pomocí metody `GetSuppliers()` ([kliknutím zobrazíte obrázek v plné velikosti](performing-batch-updates-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="a74a5-134">**Figure 3**: Retrieve Supplier Information Using the `GetSuppliers()` Method ([Click to view full-size image](performing-batch-updates-cs/_static/image9.png))</span></span>

<span data-ttu-id="a74a5-135">[![nastavte rozevírací seznam na (žádné) na kartě aktualizace.](performing-batch-updates-cs/_static/image11.png)](performing-batch-updates-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="a74a5-135">[![Set the Drop-Down List to (None) in the UPDATE Tab](performing-batch-updates-cs/_static/image11.png)](performing-batch-updates-cs/_static/image10.png)</span></span>

<span data-ttu-id="a74a5-136">**Obrázek 4**: Nastavení rozevíracího seznamu na (žádné) na kartě aktualizace ([kliknutím zobrazíte obrázek v plné velikosti](performing-batch-updates-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="a74a5-136">**Figure 4**: Set the Drop-Down List to (None) in the UPDATE Tab ([Click to view full-size image](performing-batch-updates-cs/_static/image12.png))</span></span>

<span data-ttu-id="a74a5-137">Po dokončení Průvodce aplikace Visual Studio automaticky vygeneruje `ItemTemplate` DataList s pro zobrazení každého datového pole vráceného zdrojem dat ve webovém ovládacím prvku popisek.</span><span class="sxs-lookup"><span data-stu-id="a74a5-137">After completing the wizard, Visual Studio automatically generates the DataList s `ItemTemplate` to display each data field returned by the data source in a Label Web control.</span></span> <span data-ttu-id="a74a5-138">Musíme tuto šablonu upravit, aby místo toho poskytovala rozhraní pro úpravy.</span><span class="sxs-lookup"><span data-stu-id="a74a5-138">We need to modify this template so that it provides the editing interface instead.</span></span> <span data-ttu-id="a74a5-139">`ItemTemplate` lze přizpůsobit pomocí návrháře pomocí možnosti Upravit šablony z inteligentní značky DataList s nebo přímo prostřednictvím deklarativní syntaxe.</span><span class="sxs-lookup"><span data-stu-id="a74a5-139">The `ItemTemplate` can be customized through the Designer using the Edit Templates option from the DataList s smart tag or directly through the declarative syntax.</span></span>

<span data-ttu-id="a74a5-140">Počkejte, než se vytvoří rozhraní pro úpravy, které zobrazí název dodavatele jako text, ale obsahuje textová pole pro hodnoty dodavatel s adresami, města a země.</span><span class="sxs-lookup"><span data-stu-id="a74a5-140">Take a moment to create an editing interface that displays the supplier s name as text, but includes TextBoxes for the supplier s address, city, and country values.</span></span> <span data-ttu-id="a74a5-141">Po provedení těchto změn by deklarativní syntaxe stránky s vypadala podobně jako v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="a74a5-141">After making these changes, your page s declarative syntax should look similar to the following:</span></span>

[!code-aspx[Main](performing-batch-updates-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="a74a5-142">Podobně jako v předchozím kurzu musí mít DataList v tomto kurzu povolený stav zobrazení.</span><span class="sxs-lookup"><span data-stu-id="a74a5-142">As with the preceding tutorial, the DataList in this tutorial must have its view state enabled.</span></span>

<span data-ttu-id="a74a5-143">Ve `ItemTemplate` I m používá dvě nové třídy CSS, `SupplierPropertyLabel` a `SupplierPropertyValue`, které byly přidány do třídy `Styles.css` a nakonfigurovány tak, aby používaly stejné nastavení stylu jako `ProductPropertyLabel` a `ProductPropertyValue` třídy CSS.</span><span class="sxs-lookup"><span data-stu-id="a74a5-143">In the `ItemTemplate` I m using two new CSS classes, `SupplierPropertyLabel` and `SupplierPropertyValue`, which have been added to the `Styles.css` class and configured to use the same style settings as the `ProductPropertyLabel` and `ProductPropertyValue` CSS classes.</span></span>

[!code-css[Main](performing-batch-updates-cs/samples/sample2.css)]

<span data-ttu-id="a74a5-144">Po provedení těchto změn navštivte tuto stránku v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="a74a5-144">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="a74a5-145">Jak je znázorněno na obrázku 5, každá položka DataList zobrazuje název dodavatele jako text a používá textová pole k zobrazení adresy, města a země.</span><span class="sxs-lookup"><span data-stu-id="a74a5-145">As Figure 5 shows, each DataList item displays the supplier name as text and uses TextBoxes to display the address, city, and country.</span></span>

<span data-ttu-id="a74a5-146">[![každý dodavatel v prvku DataList je upravitelný](performing-batch-updates-cs/_static/image14.png)](performing-batch-updates-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="a74a5-146">[![Each Supplier in the DataList is Editable](performing-batch-updates-cs/_static/image14.png)](performing-batch-updates-cs/_static/image13.png)</span></span>

<span data-ttu-id="a74a5-147">**Obrázek 5**: každý dodavatel v prvku DataList je upravitelný ([kliknutím zobrazíte obrázek v plné velikosti).](performing-batch-updates-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="a74a5-147">**Figure 5**: Each Supplier in the DataList is Editable ([Click to view full-size image](performing-batch-updates-cs/_static/image15.png))</span></span>

## <a name="step-2-adding-an-update-all-button"></a><span data-ttu-id="a74a5-148">Krok 2: Přidání tlačítka Aktualizovat vše</span><span class="sxs-lookup"><span data-stu-id="a74a5-148">Step 2: Adding an Update All Button</span></span>

<span data-ttu-id="a74a5-149">Každý dodavatel na obrázku 5 má pole adresa, město a země zobrazená v textovém poli. momentálně není k dispozici žádné tlačítko Aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="a74a5-149">While each supplier in Figure 5 has its address, city, and country fields displayed in a TextBox, there currently is no Update button available.</span></span> <span data-ttu-id="a74a5-150">Místo toho, aby bylo tlačítko aktualizace na položku s plně upravitelnými datalisty, obvykle je na stránce k dispozici jediné tlačítko Aktualizovat vše, které po kliknutí aktualizuje *všechny* záznamy v prvku DataList.</span><span class="sxs-lookup"><span data-stu-id="a74a5-150">Rather than having an Update button per item, with fully editable DataLists there is typically a single Update All button on the page that, when clicked, updates *all* of the records in the DataList.</span></span> <span data-ttu-id="a74a5-151">Pro účely tohoto kurzu přidejte dvě možnost aktualizovat všechna tlačítka – jednu v horní části stránky a jednu v dolní části (i když kliknete na tlačítko buď bude mít stejný účinek).</span><span class="sxs-lookup"><span data-stu-id="a74a5-151">For this tutorial, let s add two Update All buttons - one at the top of the page and one at the bottom (although clicking either button will have the same effect).</span></span>

<span data-ttu-id="a74a5-152">Začněte přidáním webového ovládacího prvku tlačítko nad prvkem DataList a nastavením jeho vlastnosti `ID` na `UpdateAll1`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-152">Start by adding a Button Web control above the DataList and set its `ID` property to `UpdateAll1`.</span></span> <span data-ttu-id="a74a5-153">Dále přidejte ovládací prvek pro druhé tlačítko pod prvkem DataList a nastavte jeho `ID` na `UpdateAll2`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-153">Next, add the second Button Web control beneath the DataList, setting its `ID` to `UpdateAll2`.</span></span> <span data-ttu-id="a74a5-154">Nastavte vlastnosti `Text` u dvou tlačítek na hodnotu Aktualizovat vše.</span><span class="sxs-lookup"><span data-stu-id="a74a5-154">Set the `Text` properties for the two Buttons to Update All.</span></span> <span data-ttu-id="a74a5-155">Nakonec vytvořte obslužné rutiny událostí pro obě tlačítka `Click` události.</span><span class="sxs-lookup"><span data-stu-id="a74a5-155">Lastly, create event handlers for both Buttons `Click` events.</span></span> <span data-ttu-id="a74a5-156">Namísto duplikování logiky aktualizace v každé obslužné rutině události je možné, že s logikou pro třetí metodu, `UpdateAllSupplierAddresses`, mají obslužné rutiny události jednoduše vyvolání této třetí metody.</span><span class="sxs-lookup"><span data-stu-id="a74a5-156">Rather than duplicating the update logic in each of the event handlers, let s refactor that logic to a third method, `UpdateAllSupplierAddresses`, having the event handlers simply invoking this third method.</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample3.cs)]

<span data-ttu-id="a74a5-157">Obrázek 6 znázorňuje stránku po přidání všech tlačítek aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="a74a5-157">Figure 6 shows the page after the Update All buttons have been added.</span></span>

<span data-ttu-id="a74a5-158">[na stránku se přidala dvě tlačítka aktualizace pro všechna ![.](performing-batch-updates-cs/_static/image17.png)](performing-batch-updates-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="a74a5-158">[![Two Update All Buttons have been Added to the Page](performing-batch-updates-cs/_static/image17.png)](performing-batch-updates-cs/_static/image16.png)</span></span>

<span data-ttu-id="a74a5-159">**Obrázek 6**: na stránku bylo přidáno dvě aktualizace všech tlačítek ([kliknutím zobrazíte obrázek v plné velikosti](performing-batch-updates-cs/_static/image18.png)).</span><span class="sxs-lookup"><span data-stu-id="a74a5-159">**Figure 6**: Two Update All Buttons have been Added to the Page ([Click to view full-size image](performing-batch-updates-cs/_static/image18.png))</span></span>

## <a name="step-3-updating-all-of-the-suppliers-address-information"></a><span data-ttu-id="a74a5-160">Krok 3: aktualizace všech informací o adrese dodavatele</span><span class="sxs-lookup"><span data-stu-id="a74a5-160">Step 3: Updating All of the Suppliers Address Information</span></span>

<span data-ttu-id="a74a5-161">Se všemi položkami DataList a zobrazujícími rozhraní pro úpravy a přidáním všech tlačítek Aktualizovat vše zůstane zápis kódu pro provedení aktualizace dávky.</span><span class="sxs-lookup"><span data-stu-id="a74a5-161">With all of the DataList s items displaying the editing interface and with the addition of the Update All buttons, all that remains is writing the code to perform the batch update.</span></span> <span data-ttu-id="a74a5-162">Konkrétně musíme projít položky DataList s a volat metodu `SuppliersBLL` třídy s `UpdateSupplierAddress` pro každé z nich.</span><span class="sxs-lookup"><span data-stu-id="a74a5-162">Specifically, we need to loop through the DataList s items and call the `SuppliersBLL` class s `UpdateSupplierAddress` method for each one.</span></span>

<span data-ttu-id="a74a5-163">Kolekce instancí `DataListItem`, ke kterým je strukturu k prvku DataList, je k dispozici prostřednictvím vlastnosti DataList s [`Items`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span><span class="sxs-lookup"><span data-stu-id="a74a5-163">The collection of `DataListItem` instances that makeup the DataList can be accessed via the DataList s [`Items` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.datalist.items.aspx).</span></span> <span data-ttu-id="a74a5-164">S odkazem na `DataListItem`můžeme přesměrovat odpovídající `SupplierID` z kolekce `DataKeys` a programově odkazovat na webové ovládací prvky TextBox v rámci `ItemTemplate`, jak ukazuje následující kód:</span><span class="sxs-lookup"><span data-stu-id="a74a5-164">With a reference to a `DataListItem`, we can grab the corresponding `SupplierID` from the `DataKeys` collection and programmatically reference the TextBox Web controls within the `ItemTemplate` as the following code illustrates:</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample4.cs)]

<span data-ttu-id="a74a5-165">Když uživatel klikne na jedno z tlačítek Aktualizovat vše, metoda `UpdateAllSupplierAddresses` projde každým `DataListItem` v `Suppliers` DataList a zavolá metodu `UpdateSupplierAddress` třídy `SuppliersBLL`, která předává příslušné hodnoty.</span><span class="sxs-lookup"><span data-stu-id="a74a5-165">When the user clicks one of the Update All buttons, the `UpdateAllSupplierAddresses` method iterates through each `DataListItem` in the `Suppliers` DataList and calls the `SuppliersBLL` class s `UpdateSupplierAddress` method, passing in the corresponding values.</span></span> <span data-ttu-id="a74a5-166">Nevložená hodnota pro předávání adresa, město nebo země je hodnota `Nothing` pro `UpdateSupplierAddress` (místo prázdného řetězce), která má za následek `NULL` databáze pro podkladová pole záznamů.</span><span class="sxs-lookup"><span data-stu-id="a74a5-166">A non-entered value for address, city, or country passes is a value of `Nothing` to `UpdateSupplierAddress` (rather than a blank string), which results in a database `NULL` for the underlying record s fields.</span></span>

> [!NOTE]
> <span data-ttu-id="a74a5-167">Jako vylepšení můžete chtít přidat webový ovládací prvek popisek stavu na stránku, která poskytuje zprávu s potvrzením po provedení aktualizace dávky.</span><span class="sxs-lookup"><span data-stu-id="a74a5-167">As an enhancement, you may want to add a status Label Web control to the page that provides some confirmation message after the batch update is performed.</span></span>

## <a name="updating-only-those-addresses-that-have-been-modified"></a><span data-ttu-id="a74a5-168">Aktualizace pouze těch adres, které byly změněny</span><span class="sxs-lookup"><span data-stu-id="a74a5-168">Updating Only Those Addresses That Have Been Modified</span></span>

<span data-ttu-id="a74a5-169">Algoritmus dávkové aktualizace použitý pro tento kurz volá metodu `UpdateSupplierAddress` pro *každého* dodavatele v prvku DataList, a to bez ohledu na to, jestli se změnily informace o adrese.</span><span class="sxs-lookup"><span data-stu-id="a74a5-169">The batch update algorithm used for this tutorial calls the `UpdateSupplierAddress` method for *every* supplier in the DataList, regardless of whether their address information has been changed.</span></span> <span data-ttu-id="a74a5-170">I když tyto nevidomé aktualizace většinou nedochází k problémům s výkonem, můžou vést k nadbytečným záznamům, pokud převedete změny auditování v tabulce databáze.</span><span class="sxs-lookup"><span data-stu-id="a74a5-170">While such blind updates aren't usually a performance issue, they can lead to superfluous records if you re auditing changes to the database table.</span></span> <span data-ttu-id="a74a5-171">Pokud například použijete triggery k zaznamenání všech `UPDATE` s do tabulky `Suppliers` do tabulky auditování, pokaždé, když uživatel klikne na tlačítko Aktualizovat vše, vytvoří se nový záznam auditu pro každého dodavatele v systému bez ohledu na to, jestli uživatel provedl nějaké změny.</span><span class="sxs-lookup"><span data-stu-id="a74a5-171">For example, if you use triggers to record all `UPDATE` s to the `Suppliers` table to an auditing table, every time a user clicks the Update All button a new audit record will be created for each supplier in the system, regardless of whether the user made any changes.</span></span>

<span data-ttu-id="a74a5-172">Třídy DataTable a DataAdapter ADO.NET jsou navržené tak, aby podporovaly dávkové aktualizace, kde pouze změny, odstranění a nové záznamy mají za následek jakoukoli databázovou komunikaci.</span><span class="sxs-lookup"><span data-stu-id="a74a5-172">The ADO.NET DataTable and DataAdapter classes are designed to support batch updates where only modified, deleted, and new records results in any database communication.</span></span> <span data-ttu-id="a74a5-173">Každý řádek v objektu DataTable má [vlastnost`RowState`](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) , která označuje, zda byl řádek přidán do objektu DataTable, odstraněn z něj, změněn nebo zůstane beze změny.</span><span class="sxs-lookup"><span data-stu-id="a74a5-173">Each row in the DataTable has a [`RowState` property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) that indicates whether the row has been added to the DataTable, deleted from it, modified, or remains unchanged.</span></span> <span data-ttu-id="a74a5-174">Při počátečním naplnění objektu DataTable budou všechny řádky označeny beze změny.</span><span class="sxs-lookup"><span data-stu-id="a74a5-174">When a DataTable is initially populated, all rows are marked unchanged.</span></span> <span data-ttu-id="a74a5-175">Když změníte hodnotu některého sloupce řádek s, řádek se označí jako změněný.</span><span class="sxs-lookup"><span data-stu-id="a74a5-175">Changing the value of any of the row s columns marks the row as modified.</span></span>

<span data-ttu-id="a74a5-176">Ve třídě `SuppliersBLL` aktualizujeme zadané informace o dodavatelích na základě prvního čtení záznamu jednoho dodavatele do `SuppliersDataTable` a pak nastavíte hodnoty sloupce `Address`, `City`a `Country` pomocí následujícího kódu:</span><span class="sxs-lookup"><span data-stu-id="a74a5-176">In the `SuppliersBLL` class we update the specified supplier s address information by first reading in the single supplier record into a `SuppliersDataTable` and then set the `Address`, `City`, and `Country` column values using the following code:</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample5.cs)]

<span data-ttu-id="a74a5-177">Tento kód naively přiřadí hodnoty předané adresy, města a země `SuppliersRow` v `SuppliersDataTable` bez ohledu na to, jestli se hodnoty změnily.</span><span class="sxs-lookup"><span data-stu-id="a74a5-177">This code naively assigns the passed-in address, city, and country values to the `SuppliersRow` in the `SuppliersDataTable` regardless of whether or not the values have changed.</span></span> <span data-ttu-id="a74a5-178">Tyto úpravy způsobí, že vlastnost `SuppliersRow` s `RowState` bude označena jako upravená.</span><span class="sxs-lookup"><span data-stu-id="a74a5-178">These modifications cause the `SuppliersRow` s `RowState` property to be marked as modified.</span></span> <span data-ttu-id="a74a5-179">Když je zavolána metoda přístup k datům `Update` vrstvě, zjistí, že `SupplierRow` byla upravena a proto pošle příkaz `UPDATE` do databáze.</span><span class="sxs-lookup"><span data-stu-id="a74a5-179">When the Data Access Layer s `Update` method is called, it sees that the `SupplierRow` has been modified and therefore sends an `UPDATE` command to the database.</span></span>

<span data-ttu-id="a74a5-180">Představme si ale, že jsme do této metody přidali kód pro přiřazení hodnot předaných adres, měst a zemí, pokud se liší od stávajících hodnot `SuppliersRow` s.</span><span class="sxs-lookup"><span data-stu-id="a74a5-180">Imagine, however, that we added code to this method to only assign the passed-in address, city, and country values if they differ from the `SuppliersRow` s existing values.</span></span> <span data-ttu-id="a74a5-181">V případě, že adresa, město a země jsou stejné jako stávající data, nebudou provedeny žádné změny a `RowState` `SupplierRow` s zůstane označena jako nezměněná.</span><span class="sxs-lookup"><span data-stu-id="a74a5-181">In the case where the address, city, and country are the same as the existing data, no changes will be made and the `SupplierRow` s `RowState` will be left marked as unchanged.</span></span> <span data-ttu-id="a74a5-182">Výsledkem netto je, že při volání metody DAL s `Update` se neprovede žádné volání databáze, protože `SuppliersRow` nebyla upravena.</span><span class="sxs-lookup"><span data-stu-id="a74a5-182">The net result is that when the DAL s `Update` method is called, no database call will be made because the `SuppliersRow` has not been modified.</span></span>

<span data-ttu-id="a74a5-183">Chcete-li tuto změnu přijmout, nahraďte příkazy, které neumožňují geograficky přiřadit hodnoty předané adresy, města a země následujícímu kódu:</span><span class="sxs-lookup"><span data-stu-id="a74a5-183">To enact this change, replace the statements that blindly assign the passed-in address, city, and country values with the following code:</span></span>

[!code-csharp[Main](performing-batch-updates-cs/samples/sample6.cs)]

<span data-ttu-id="a74a5-184">S tímto přidaným kódem pošle metoda `Update` DAL do databáze příkaz `UPDATE` pro všechny záznamy, jejichž hodnoty související s adresou se změnily.</span><span class="sxs-lookup"><span data-stu-id="a74a5-184">With this added code, the DAL s `Update` method sends an `UPDATE` statement to the database for only those records whose address-related values have changed.</span></span>

<span data-ttu-id="a74a5-185">Alternativně můžeme sledovat, zda existují nějaké rozdíly mezi předanými poli adres a databázovými daty, a pokud žádný není, jednoduše obejít volání metody DAL s `Update`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-185">Alternatively, we could keep track of whether there are any differences between the passed-in address fields and the database data and, if there are none, simply bypass the call to the DAL s `Update` method.</span></span> <span data-ttu-id="a74a5-186">Tento přístup funguje i v případě, že znovu použijete metodu Direct DB, protože metoda DB Direct t předala `SuppliersRow` instanci, jejíž `RowState` může být zaškrtnuto, aby bylo možné určit, zda je volání databáze skutečně požadováno.</span><span class="sxs-lookup"><span data-stu-id="a74a5-186">This approach works well if you re using the DB direct method, since the DB direct method isn t passed a `SuppliersRow` instance whose `RowState` can be checked to determine whether a database call is actually needed.</span></span>

> [!NOTE]
> <span data-ttu-id="a74a5-187">Pokaždé, když je vyvolána metoda `UpdateSupplierAddress`, se do databáze přivede volání, aby se načetly informace o aktualizovaném záznamu.</span><span class="sxs-lookup"><span data-stu-id="a74a5-187">Each time the `UpdateSupplierAddress` method is invoked, a call is made to the database to retrieve information about the updated record.</span></span> <span data-ttu-id="a74a5-188">Pokud jsou v datech nějaké změny, provedou se další volání databáze, aby se aktualizoval řádek tabulky.</span><span class="sxs-lookup"><span data-stu-id="a74a5-188">Then, if there are any changes in data, another call to the database is made to update the table row.</span></span> <span data-ttu-id="a74a5-189">Tento pracovní postup může být optimalizován vytvořením přetížení metody `UpdateSupplierAddress`, které přijímá instanci `EmployeesDataTable`, která obsahuje *všechny* změny ze stránky `BatchUpdate.aspx`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-189">This workflow could be optimized by creating an `UpdateSupplierAddress` method overload that accepts an `EmployeesDataTable` instance that has *all* of the changes from the `BatchUpdate.aspx` page.</span></span> <span data-ttu-id="a74a5-190">Potom může provést jedno volání databáze a získat všechny záznamy z `Suppliers` tabulky.</span><span class="sxs-lookup"><span data-stu-id="a74a5-190">Then, it could make one call to the database to get all of the records from the `Suppliers` table.</span></span> <span data-ttu-id="a74a5-191">Tyto dvě sady výsledků by se pak mohly zobrazit a jenom záznamy, ve kterých došlo ke změnám, se daly aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="a74a5-191">The two resultsets could then be enumerated and only those records where changes have occurred could be updated.</span></span>

## <a name="summary"></a><span data-ttu-id="a74a5-192">Přehled</span><span class="sxs-lookup"><span data-stu-id="a74a5-192">Summary</span></span>

<span data-ttu-id="a74a5-193">V tomto kurzu jsme viděli, jak vytvořit plně upravitelný prvek DataList, který uživateli umožňuje rychle upravit informace o adrese pro více dodavatelů.</span><span class="sxs-lookup"><span data-stu-id="a74a5-193">In this tutorial we saw how to create a fully editable DataList, allowing a user to quickly modify the address information for multiple suppliers.</span></span> <span data-ttu-id="a74a5-194">Začali jsme definováním rozhraní pro úpravy webovým ovládacím prvkem TextBox pro hodnoty adresa dodavatele, města a země v `ItemTemplate`DataList.</span><span class="sxs-lookup"><span data-stu-id="a74a5-194">We started by defining the editing interface a TextBox Web control for the supplier s address, city, and country values in the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="a74a5-195">Dále jsme přidali všechna tlačítka nad a pod rámec DataList.</span><span class="sxs-lookup"><span data-stu-id="a74a5-195">Next, we added Update All buttons above and below the DataList.</span></span> <span data-ttu-id="a74a5-196">Poté, co uživatel provedl změny a klikli na jedno z tlačítek Aktualizovat vše, jsou `DataListItem`y výčty a je provedeno volání metody `SuppliersBLL` třídy s `UpdateSupplierAddress`.</span><span class="sxs-lookup"><span data-stu-id="a74a5-196">After a user has made his changes and clicked one of the Update All buttons, the `DataListItem` s are enumerated and a call to the `SuppliersBLL` class s `UpdateSupplierAddress` method is made.</span></span>

<span data-ttu-id="a74a5-197">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="a74a5-197">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a74a5-198">O autorovi</span><span class="sxs-lookup"><span data-stu-id="a74a5-198">About the Author</span></span>

<span data-ttu-id="a74a5-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor 7 ASP/ASP. NET Books a zakladatel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="a74a5-199">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a74a5-200">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="a74a5-200">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a74a5-201">Nejnovější kniha je [*Sams naučit se ASP.NET 2,0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a74a5-201">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a74a5-202">Dá se získat na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a74a5-202">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a74a5-203">nebo prostřednictvím svého blogu, který najdete na adrese [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a74a5-203">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a74a5-204">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="a74a5-204">Special Thanks To</span></span>

<span data-ttu-id="a74a5-205">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="a74a5-205">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a74a5-206">Kontroloři vedoucích k tomuto kurzu byli Zack Novotný a Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="a74a5-206">Lead reviewers for this tutorial were Zack Jones and Ken Pespisa.</span></span> <span data-ttu-id="a74a5-207">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="a74a5-207">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a74a5-208">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a74a5-208">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a74a5-209">[Předchozí](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)
> [Další](handling-bll-and-dal-level-exceptions-cs.md)</span><span class="sxs-lookup"><span data-stu-id="a74a5-209">[Previous](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)
[Next](handling-bll-and-dal-level-exceptions-cs.md)</span></span>
