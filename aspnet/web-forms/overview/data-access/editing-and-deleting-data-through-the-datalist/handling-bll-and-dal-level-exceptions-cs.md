---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
title: Zpracování výjimekC#úrovně knihoven BLL-a dal | Microsoft Docs
author: rick-anderson
description: V tomto kurzu se dozvíte, jak tactfully zpracovávat výjimky vyvolané při aktualizaci pracovního postupu upravitelného prvku DataList.
ms.author: riande
ms.date: 10/30/2006
ms.assetid: f8fd58e2-f932-4f08-ab3d-fbf8ff3295d2
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 35ff60be6ed67ea8d1bf226ae70f590100597757
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/28/2019
ms.locfileid: "74634142"
---
# <a name="handling-bll--and-dal-level-exceptions-c"></a><span data-ttu-id="a4e0b-103">Zpracování výjimek na úrovni knihoven BLL a DAL (C#)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-103">Handling BLL- and DAL-Level Exceptions (C#)</span></span>

<span data-ttu-id="a4e0b-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="a4e0b-105">[Stáhnout ukázkovou aplikaci](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) nebo [Stáhnout PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-105">[Download Sample App](https://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-cs/_static/datatutorial38cs1.pdf)</span></span>

> <span data-ttu-id="a4e0b-106">V tomto kurzu se dozvíte, jak tactfully zpracovávat výjimky vyvolané při aktualizaci pracovního postupu upravitelného prvku DataList.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>

## <a name="introduction"></a><span data-ttu-id="a4e0b-107">Úvod</span><span class="sxs-lookup"><span data-stu-id="a4e0b-107">Introduction</span></span>

<span data-ttu-id="a4e0b-108">V [přehledu úprav a odstranění dat v kurzu DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) jsme vytvořili prvek DataList, který nabízí jednoduché možnosti úprav a odstranění.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="a4e0b-109">Přestože je plně funkční, bylo špatně uživatelsky přívětivé, protože jakákoli chyba, ke které došlo během procesu úprav nebo odstranění, způsobila neošetřenou výjimku.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="a4e0b-110">Pokud například vynecháte název produktu nebo, když upravujete produkt, zadáte cenovou hodnotu velmi dostupnou!, vyvolá výjimku.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="a4e0b-111">Vzhledem k tomu, že tato výjimka není zachycena v kódu, je podrobná až do modulu runtime ASP.NET, který pak na webové stránce zobrazí výjimky s podrobnostmi.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="a4e0b-112">Jak jsme viděli při [zpracování výjimek knihoven BLL a dal v kurzu stránky ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) , pokud je výjimka vyvolána z hloubky obchodní logiky nebo vrstvy přístupu k datům, vrátí se podrobnosti o výjimce do prvku ObjectDataSource a následně do prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="a4e0b-113">Zjistili jsme, jak tyto výjimky řádně zpracovat vytvořením `Updated` nebo `RowUpdated` obslužných rutin událostí pro ObjectDataSource nebo GridView, kontrolou výjimky a následnou indikací, že byla výjimka zpracována.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="a4e0b-114">Naše kurzy DataList ale nepoužívají prvek ObjectDataSource k aktualizaci a odstraňování dat.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-114">Our DataList tutorials, however, aren't using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="a4e0b-115">Místo toho pracujeme přímo na knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="a4e0b-116">Aby bylo možné detekovat výjimky pocházející z knihoven BLL nebo DAL, musíme implementovat kód pro zpracování výjimek v rámci kódu na pozadí naší stránky ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="a4e0b-117">V tomto kurzu se dozvíte, jak více tactfully zpracovávat výjimky vyvolané během upravitelného pracovního postupu pro prvek DataList s aktualizací.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="a4e0b-118">V tématu *Přehled úprav a odstranění dat v kurzu DataList* jsme provedli různé techniky pro úpravy a odstraňování dat z prvku DataList, některé techniky, které jsou součástí prvků ObjectDataSource pro aktualizaci a odstranění.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="a4e0b-119">Použijete-li tyto techniky, můžete zpracovat výjimky z knihoven BLL nebo DAL prostřednictvím obslužných rutin události ObjectDataSource `Updated` nebo `Deleted`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>

## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="a4e0b-120">Krok 1: vytvoření upravitelného prvku DataList</span><span class="sxs-lookup"><span data-stu-id="a4e0b-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="a4e0b-121">Předtím, než se obáváme o zpracování výjimek, ke kterým dojde během aktualizačního pracovního postupu, si nejdřív vytvořte upravitelný prvek DataList.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="a4e0b-122">Otevřete stránku `ErrorHandling.aspx` ve složce `EditDeleteDataList`, přidejte prvek DataList do návrháře, nastavte jeho vlastnost `ID` na `Products`a přidejte nový prvek ObjectDataSource s názvem `ProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="a4e0b-123">Nakonfigurujte prvek ObjectDataSource tak, aby pro výběr záznamů používal metodu `ProductsBLL` třídy s `GetProducts()`. v rozevíracích seznamech na kartách vložení, aktualizace a odstranění nastavte (žádné).</span><span class="sxs-lookup"><span data-stu-id="a4e0b-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="a4e0b-124">[![vrátit informace o produktu pomocí metody GetProducts ()](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-cs/_static/image1.png)</span></span>

<span data-ttu-id="a4e0b-125">**Obrázek 1**: vraťte informace o produktu pomocí metody `GetProducts()` ([kliknutím zobrazíte obrázek v plné velikosti).](handling-bll-and-dal-level-exceptions-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image3.png))</span></span>

<span data-ttu-id="a4e0b-126">Po dokončení průvodce ObjectDataSource bude Visual Studio automaticky vytvářet `ItemTemplate` pro prvek DataList.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="a4e0b-127">Tuto položku nahraďte `ItemTemplate`, která zobrazuje každý název a cenu produktu a obsahuje tlačítko pro úpravy.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="a4e0b-128">Dále vytvořte `EditItemTemplate` s webovým ovládacím prvkem TextBox pro název a cenu a tlačítka aktualizovat a Storno.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="a4e0b-129">Nakonec nastavte vlastnost DataList s `RepeatColumns` na 2.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="a4e0b-130">Po těchto změnách by deklarativní označení stránky mělo vypadat podobně jako následující.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="a4e0b-131">Dvojím zkontrolováním, že tlačítka pro úpravy, zrušení a aktualizaci mají své `CommandName` vlastnosti nastavené na upravit, zrušit a aktualizovat, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="a4e0b-132">Pro tento kurz musí být povolený stav zobrazení DataList s.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-132">For this tutorial the DataList s view state must be enabled.</span></span>

<span data-ttu-id="a4e0b-133">Počkejte, než se vám zobrazí náš průběh v prohlížeči (viz obrázek 2).</span><span class="sxs-lookup"><span data-stu-id="a4e0b-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>

<span data-ttu-id="a4e0b-134">[![každý produkt zahrnuje tlačítko pro úpravy.](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-cs/_static/image4.png)</span></span>

<span data-ttu-id="a4e0b-135">**Obrázek 2**: každý produkt obsahuje tlačítko pro úpravy ([kliknutím zobrazíte obrázek v plné velikosti).](handling-bll-and-dal-level-exceptions-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image6.png))</span></span>

<span data-ttu-id="a4e0b-136">V současné době tlačítko pro úpravy způsobuje pouze postback, který mu ještě neumožňuje upravovat produkt.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="a4e0b-137">Pro umožnění úprav musíme pro události `EditCommand`, `CancelCommand`a `UpdateCommand` prvku DataList vytvořit obslužné rutiny událostí.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="a4e0b-138">Události `EditCommand` a `CancelCommand` jednoduše aktualizují vlastnost DataList s `EditItemIndex` a znovu sváže data s DataList:</span><span class="sxs-lookup"><span data-stu-id="a4e0b-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="a4e0b-139">Obslužná rutina události `UpdateCommand` je trochu větší.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="a4e0b-140">Musí číst v upraveném `ProductID` produktů z kolekce `DataKeys` spolu s názvem produktu a cenou z textových polí v `EditItemTemplate`, a potom před vrácením prvku DataList do jeho stavu před tím, než bude prvek DataList vracet, zavolat `UpdateProduct` metody třídy `ProductsBLL`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="a4e0b-141">Prozatím použijte pouze stejný kód z obslužné rutiny události `UpdateCommand` v *přehledu úprav a odstranění dat v kurzu DataList* .</span><span class="sxs-lookup"><span data-stu-id="a4e0b-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="a4e0b-142">Přidáme kód pro řádný zpracování výjimek v kroku 2.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="a4e0b-143">V případě neplatného vstupu, který může mít formu nesprávně formátované jednotkové ceny, neplatnou hodnotu jednotkové ceny jako-$5,00 nebo vynechání názvu produktu, bude vyvolána výjimka.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="a4e0b-144">Vzhledem k tomu, že obslužná rutina události `UpdateCommand` v tomto okamžiku neobsahuje žádný kód pro zpracování výjimek, výjimka bude obsahovat až ASP.NET modul runtime, kde se zobrazí koncovému uživateli (viz obrázek 3).</span><span class="sxs-lookup"><span data-stu-id="a4e0b-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>

![Když dojde k neošetřené výjimce, koncový uživatel uvidí chybovou stránku.](handling-bll-and-dal-level-exceptions-cs/_static/image7.png)

<span data-ttu-id="a4e0b-146">**Obrázek 3**: když dojde k neošetřené výjimce, koncový uživatel uvidí chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>

## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="a4e0b-147">Krok 2: řádné zpracování výjimek v obslužné rutině události UpdateCommand</span><span class="sxs-lookup"><span data-stu-id="a4e0b-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="a4e0b-148">Během pracovního postupu aktualizace mohou být výjimky v obslužné rutině události `UpdateCommand`, knihoven BLL nebo DAL.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="a4e0b-149">Například pokud uživatel zadá cenu, která je příliš náročná, příkaz `Decimal.Parse` v obslužné rutině události `UpdateCommand` vyvolá výjimku `FormatException`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="a4e0b-150">Pokud uživatel vynechá název produktu nebo pokud má cena zápornou hodnotu, dojde k výjimce DAL.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="a4e0b-151">Pokud dojde k výjimce, chceme zobrazit informativní zprávu v rámci samotné stránky.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="a4e0b-152">Přidejte ovládací prvek web popisku na stránku, jejíž `ID` je nastavená na `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="a4e0b-153">Nakonfigurujte text popisku, který se má zobrazit v červeném, tučném písmu a kurzívě, přiřazením jeho vlastnosti `CssClass` do `Warning` třídy šablony stylů CSS, která je definována v souboru `Styles.css`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="a4e0b-154">Když dojde k chybě, chceme, aby se popisek zobrazil jenom jednou.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="a4e0b-155">To znamená, že při následném postbacku by se měla zpráva s upozorněním na návěští zobrazovat.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="a4e0b-156">To se dá udělat tak, že buď vymažete vlastnost `Text` popisku, nebo nastavení jeho vlastnosti `Visible` na `False` v obslužné rutině události `Page_Load` (jak jsme byli zpátky v kurzu [zpracování knihoven BLL a dal výjimky na stránce ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) ), nebo zakázáním podpory stavu zobrazení popisku.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="a4e0b-157">Umožňuje použít druhou možnost.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-157">Let s use the latter option.</span></span>

[!code-aspx[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample4.aspx)]

<span data-ttu-id="a4e0b-158">Když je vyvolána výjimka, přiřadíme podrobnosti o výjimce `ExceptionDetails` vlastnosti ovládacího prvku popisek s `Text`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="a4e0b-159">Vzhledem k tomu, že je stav zobrazení zakázán, při následném postbacku budou ztraceny programové změny vlastností `Text`, vrátí se zpět k výchozímu textu (prázdný řetězec), čímž se skryje zpráva upozornění.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="a4e0b-160">Abychom určili, kdy došlo k chybě, aby se zobrazila užitečná zpráva na stránce, musíme do obslužné rutiny události `UpdateCommand` přidat `Try ... Catch` blok.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="a4e0b-161">`Try` část obsahuje kód, který může vést k výjimce, zatímco blok `Catch` obsahuje kód, který je spuštěn na tvář výjimky.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="a4e0b-162">Další informace o bloku `Try ... Catch` najdete v části [Základy zpracování výjimek](https://msdn.microsoft.com/library/2w8f0bss.aspx) v dokumentaci .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="a4e0b-163">Pokud je vyvolána výjimka jakéhokoliv typu v rámci bloku `Try`, zahájí se spuštění kódu `Catch` bloku s.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="a4e0b-164">Typ výjimky, která je vyvolána `DbException`, `NoNullAllowedException`, `ArgumentException`a tak dále závisí na tom, co přesně vyvolalo chybu na prvním místě.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="a4e0b-165">Pokud dojde k problému na úrovni databáze, bude vyvolána `DbException`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="a4e0b-166">Pokud je zadána neplatná hodnota pro pole `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`nebo `ReorderLevel`, bude vyvolána `ArgumentException`, jak jsme přidali kód pro ověření těchto hodnot polí ve třídě `ProductsDataTable` (viz kurz [Vytvoření vrstvy obchodní logiky](../introduction/creating-a-business-logic-layer-cs.md) ).</span><span class="sxs-lookup"><span data-stu-id="a4e0b-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial).</span></span>

<span data-ttu-id="a4e0b-167">Na základě textu zprávy o typu zachycené výjimky můžeme pro koncového uživatele poskytnout užitečnější vysvětlení.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="a4e0b-168">Následující kód, který byl použit v téměř totožném tvaru zpět při [zpracování výjimek knihoven BLL a dal v kurzu stránky ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) , poskytuje tuto úroveň podrobností:</span><span class="sxs-lookup"><span data-stu-id="a4e0b-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial provides this level of detail:</span></span>

[!code-csharp[Main](handling-bll-and-dal-level-exceptions-cs/samples/sample6.cs)]

<span data-ttu-id="a4e0b-169">Chcete-li dokončit tento kurz, jednoduše zavolejte metodu `DisplayExceptionDetails` z bloku `Catch`, který je předaný v zachycené instanci `Exception` (`ex`).</span><span class="sxs-lookup"><span data-stu-id="a4e0b-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="a4e0b-170">U `Try ... Catch`ho blokování se uživatelům zobrazí více informativní chybová zpráva, jak je znázorněno na obrázcích 4 a 5.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="a4e0b-171">Všimněte si, že v tváři výjimky zůstane prvek DataList v režimu úprav.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="a4e0b-172">Důvodem je, že jakmile dojde k výjimce, tok řízení je okamžitě přesměrován na blok `Catch` a obejít kód, který prvek DataList vrátí do svého stavu před úpravou.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>

<span data-ttu-id="a4e0b-173">[![se zobrazí chybová zpráva, pokud uživatel vynechá požadované pole](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-cs/_static/image9.png)](handling-bll-and-dal-level-exceptions-cs/_static/image8.png)</span></span>

<span data-ttu-id="a4e0b-174">**Obrázek 4**: Pokud uživatel vynechá požadované pole ([kliknutím zobrazíte obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-cs/_static/image10.png)), zobrazí se chybová zpráva.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image10.png))</span></span>

<span data-ttu-id="a4e0b-175">[Při zadání záporné ceny ![zobrazit chybovou zprávu](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-cs/_static/image12.png)](handling-bll-and-dal-level-exceptions-cs/_static/image11.png)</span></span>

<span data-ttu-id="a4e0b-176">**Obrázek 5**: při zadání záporné ceny se zobrazí chybová zpráva ([kliknutím zobrazíte obrázek v plné velikosti](handling-bll-and-dal-level-exceptions-cs/_static/image13.png)).</span><span class="sxs-lookup"><span data-stu-id="a4e0b-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-cs/_static/image13.png))</span></span>

## <a name="summary"></a><span data-ttu-id="a4e0b-177">Přehled</span><span class="sxs-lookup"><span data-stu-id="a4e0b-177">Summary</span></span>

<span data-ttu-id="a4e0b-178">GridView a ObjectDataSource poskytují obslužné rutiny události na úrovni, které obsahují informace o všech výjimkách, které byly vyvolány během procesu aktualizace a odstranění, a také vlastnosti, které lze nastavit tak, aby označovaly, zda byla výjimka zpracována.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="a4e0b-179">Tyto funkce jsou však nedostupné při práci s DataList a přímé použití knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="a4e0b-180">Místo toho zodpovídáme za implementaci zpracování výjimek.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="a4e0b-181">V tomto kurzu jsme viděli, jak přidat zpracování výjimek do upravitelného pracovního postupu DataList s, přidáváním `Try ... Catch` bloku do obslužné rutiny události `UpdateCommand`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="a4e0b-182">Pokud je vyvolána výjimka během pracovního postupu aktualizace, spustí se kód `Catch` bloku s a zobrazí se užitečné informace v popisku `ExceptionDetails`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="a4e0b-183">V tomto okamžiku DataList neprovede žádné úsilí, aby nedocházelo k výjimkám na prvním místě.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="a4e0b-184">I když ví, že záporná cena bude mít za následek výjimku, zatím jsme nepřidali žádné funkce pro proaktivní zabránění uživatelům v zadávání takového neplatného vstupu.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-184">Even though we know that a negative price will result in an exception, we haven't yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="a4e0b-185">V našem dalším kurzu se dozvíte, jak přispět k omezení výjimek způsobených neplatným uživatelským vstupem přidáním ovládacích prvků ověřování v `EditItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="a4e0b-186">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="a4e0b-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="a4e0b-187">Další čtení</span><span class="sxs-lookup"><span data-stu-id="a4e0b-187">Further Reading</span></span>

<span data-ttu-id="a4e0b-188">Další informace o tématech popsaných v tomto kurzu najdete v následujících zdrojích informací:</span><span class="sxs-lookup"><span data-stu-id="a4e0b-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="a4e0b-189">Pokyny k návrhu pro výjimky</span><span class="sxs-lookup"><span data-stu-id="a4e0b-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="a4e0b-190">[Protokolování chyb modulů a obslužných rutin (knihovny elmah)](http://workspaces.gotdotnet.com/elmah) (Open source knihovna pro chyby protokolování)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="a4e0b-191">[Podniková knihovna pro .NET Framework 2,0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (zahrnuje blok aplikace pro správu výjimek)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="a4e0b-192">O autorovi</span><span class="sxs-lookup"><span data-stu-id="a4e0b-192">About the Author</span></span>

<span data-ttu-id="a4e0b-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor 7 ASP/ASP. NET Books a zakladatel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="a4e0b-194">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="a4e0b-195">Nejnovější kniha je [*Sams naučit se ASP.NET 2,0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="a4e0b-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="a4e0b-196">Dá se získat na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="a4e0b-197">nebo prostřednictvím svého blogu, který najdete na adrese [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="a4e0b-197">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="a4e0b-198">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="a4e0b-198">Special Thanks To</span></span>

<span data-ttu-id="a4e0b-199">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-199">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="a4e0b-200">Kontrolor pro tento kurz byl Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="a4e0b-200">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="a4e0b-201">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="a4e0b-201">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="a4e0b-202">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-202">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a4e0b-203">[Předchozí](performing-batch-updates-cs.md)
> [Další](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span><span class="sxs-lookup"><span data-stu-id="a4e0b-203">[Previous](performing-batch-updates-cs.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-cs.md)</span></span>
