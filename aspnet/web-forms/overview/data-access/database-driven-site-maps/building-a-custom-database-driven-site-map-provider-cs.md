---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
title: Vytvoření vlastního zprostředkovatele mapy webu založeného na databázi (C#) | Microsoft Docs
author: rick-anderson
description: Výchozí poskytovatel mapy webu v ASP.NET 2,0 načte jeho data ze statického souboru XML. I když je zprostředkovatel založený na jazyce XML vhodný pro mnoho malých a středně sizch...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: 04b7591d-106f-4f05-87e9-d416cb65a8a6
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
msc.type: authoredcontent
ms.openlocfilehash: a3e27b37703b12c9796e8516f0d805aef1fdf8d8
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/28/2019
ms.locfileid: "74636891"
---
# <a name="building-a-custom-database-driven-site-map-provider-c"></a><span data-ttu-id="c1d4c-104">Vytvoření vlastního databázově řízeného zprostředkovatele mapy webu (C#)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-104">Building a Custom Database-Driven Site Map Provider (C#)</span></span>

<span data-ttu-id="c1d4c-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c1d4c-106">[Stažení kódu](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) nebo [stažení PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-106">[Download Code](https://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span></span>

> <span data-ttu-id="c1d4c-107">Výchozí poskytovatel mapy webu v ASP.NET 2,0 načte jeho data ze statického souboru XML.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="c1d4c-108">I když je zprostředkovatel založený na jazyce XML vhodný pro velký počet malých a středně velkých webů, vyžadují větší webové aplikace dynamičtější mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="c1d4c-109">V tomto kurzu vytvoříme vlastního poskytovatele mapy webu, který načte svá data z vrstvy obchodní logiky, která zase načte data z databáze.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>

## <a name="introduction"></a><span data-ttu-id="c1d4c-110">Úvod</span><span class="sxs-lookup"><span data-stu-id="c1d4c-110">Introduction</span></span>

<span data-ttu-id="c1d4c-111">Funkce mapa webu ASP.NET 2,0 s umožňuje vývojářům stránky definovat mapu webu webové aplikace v některém trvalém médiu, například v souboru XML.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="c1d4c-112">Po definování můžete k datům map lokality přistupovat programově prostřednictvím [třídy`SiteMap`](https://msdn.microsoft.com/library/system.web.sitemap.aspx) v [oboru názvů`System.Web`](https://msdn.microsoft.com/library/system.web.aspx) nebo prostřednictvím různých webových ovládacích prvků navigace, jako jsou ovládací prvky SiteMapPath, menu a TreeView.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="c1d4c-113">Mapový systém lokality používá [model poskytovatele](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) , aby bylo možné vytvořit různé implementace serializace mapy webu a připojit je do webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="c1d4c-114">Výchozí poskytovatel mapy webu, který je dodáván s ASP.NET 2,0, se zachovává se strukturou mapy webu v souboru XML.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="c1d4c-115">Zpět na [stránkách předlohy a](../introduction/master-pages-and-site-navigation-cs.md) v kurzu navigace na webu jsme vytvořili soubor s názvem `Web.sitemap`, který obsahuje tuto strukturu a aktualizovali XML pomocí každého nového kurzu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="c1d4c-116">Výchozí zprostředkovatel mapy webu založený na jazyce XML funguje dobře, pokud je struktura mapy webu poměrně statická, například pro tyto kurzy.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="c1d4c-117">V mnoha scénářích se však vyžaduje více map dynamického webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="c1d4c-118">Vezměte v úvahu mapu webu znázorněnou na obrázku 1, kde se každá kategorie a produkt zobrazuje jako oddíly ve struktuře webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="c1d4c-119">Pomocí této mapy webu mohou webové stránky, které odpovídají kořenovému uzlu, obsahovat seznam všech kategorií, zatímco při návštěvě konkrétní kategorie webové stránky by se zobrazily tyto kategorie produktů a zobrazení konkrétní webové stránky s informacemi o produktu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>

<span data-ttu-id="c1d4c-120">[![kategorií a produktů strukturu struktury map webu](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span></span>

<span data-ttu-id="c1d4c-121">**Obrázek 1**: kategorie a produkty strukturu struktury map webu ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png)).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span></span>

<span data-ttu-id="c1d4c-122">Zatímco tato struktura na základě kategorie a produktu by mohla být pevně zakódovaná do `Web.sitemap` souboru, je třeba aktualizovat soubor pokaždé, když byla kategorie nebo produkt přidaný, odebraný nebo přejmenovaný.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="c1d4c-123">V důsledku toho bude údržba mapy webu výrazně zjednodušená, pokud byla jeho struktura načtena z databáze nebo, v ideálním případě z vrstvy obchodní logiky architektury aplikace.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="c1d4c-124">Tímto způsobem byly přidány, přejmenovány nebo smazány produkty a kategorie, mapa webu se automaticky aktualizuje, aby odrážela tyto změny.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="c1d4c-125">Vzhledem k tomu, že serializace mapy lokality ASP.NET 2,0 s je sestavena základem modelem poskytovatele, můžeme vytvořit vlastního poskytovatele mapy webu, který získává data z alternativního úložiště dat, například databáze nebo architektury.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="c1d4c-126">V tomto kurzu vytvoříme vlastního poskytovatele, který načte data z knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="c1d4c-127">Pojďme začít!</span><span class="sxs-lookup"><span data-stu-id="c1d4c-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="c1d4c-128">Vlastní poskytovatel mapy webu vytvořený v tomto kurzu je pevně spojený s architekturou aplikace a datovým modelem.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="c1d4c-129">Jan Prosise s [uložením map webů v SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) a [poskytovatele mapy webu SQL, kterého jste čekali na články,](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) prozkoumali zobecněný přístup k ukládání dat map webu v SQL Server.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>

## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="c1d4c-130">Krok 1: vytvoření vlastních webových stránek poskytovatele mapy webu</span><span class="sxs-lookup"><span data-stu-id="c1d4c-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="c1d4c-131">Než začneme s vytvářením vlastního poskytovatele mapy webu, můžeme nejdřív přidat stránky ASP.NET, které budeme potřebovat pro tento kurz.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="c1d4c-132">Začněte přidáním nové složky s názvem `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="c1d4c-133">Dále přidejte následující stránky ASP.NET do této složky a nezapomeňte přidružit jednotlivé stránky k `Site.master` hlavní stránce:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="c1d4c-134">Přidejte také podsložku `CustomProviders` do složky `App_Code`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>

![Přidání stránek ASP.NET pro kurzy související se zprostředkovatelem mapy webu](building-a-custom-database-driven-site-map-provider-cs/_static/image2.gif)

<span data-ttu-id="c1d4c-136">**Obrázek 2**: přidání stránek ASP.NET pro kurzy související se zprostředkovatelem mapy webu</span><span class="sxs-lookup"><span data-stu-id="c1d4c-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>

<span data-ttu-id="c1d4c-137">Vzhledem k tomu, že je k dispozici pouze jeden kurz pro tuto část, nepotřebujeme `Default.aspx` k vypsání kurzů oddílu s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="c1d4c-138">Místo toho `Default.aspx` zobrazí kategorie v ovládacím prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="c1d4c-139">Budeme to řešit v kroku 2.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="c1d4c-140">Dále aktualizujte `Web.sitemap` tak, aby obsahovaly odkaz na stránku `Default.aspx`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="c1d4c-141">Konkrétně přidejte následující kód po `<siteMapNode>`ukládání do mezipaměti:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample1.xml)]

<span data-ttu-id="c1d4c-142">Po aktualizaci `Web.sitemap`chvíli počkejte, než se zobrazí web kurzy prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="c1d4c-143">Nabídka na levé straně teď obsahuje položku pro jediný kurz pro poskytovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>

![Mapa webu teď obsahuje položku kurzu pro poskytovatele mapy webu.](building-a-custom-database-driven-site-map-provider-cs/_static/image3.gif)

<span data-ttu-id="c1d4c-145">**Obrázek 3**: Mapa webu teď obsahuje položku kurzu pro poskytovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>

<span data-ttu-id="c1d4c-146">V tomto kurzu s hlavním fokusem je znázornění vytvoření vlastního poskytovatele mapy webu a konfigurace webové aplikace pro použití tohoto poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="c1d4c-147">Konkrétně sestavíme poskytovatele, který vrátí mapu webu, která obsahuje kořenový uzel společně s uzlem pro každou kategorii a produkt, jak je znázorněno na obrázku 1.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="c1d4c-148">Obecně platí, že každý uzel v mapě webu může určovat adresu URL.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="c1d4c-149">Pro naši mapu webu bude `~/SiteMapProvider/Default.aspx`adresa URL kořenového uzlu, která bude obsahovat seznam všech kategorií v databázi.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="c1d4c-150">U každého uzlu kategorie v mapě webu bude uvedena adresa URL, která odkazuje na `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`. zobrazí se seznam všech produktů v zadaném *poli ČísloKategorie*.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="c1d4c-151">Nakonec bude každý uzel mapa webu produktu ukazovat na `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, ve kterém se zobrazí konkrétní podrobnosti o produktu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="c1d4c-152">Abychom mohli začít, musíme vytvořit `Default.aspx`, `ProductsByCategory.aspx`a `ProductDetails.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="c1d4c-153">Tyto stránky jsou dokončeny v krocích 2, 3 a 4 v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="c1d4c-154">Vzhledem k tomu, že je tah tohoto kurzu na poskytovatelích mapy webu a vzhledem k tomu, že minulé kurzy pokryly vytváření těchto seřazení vícestránkových sestav s více stránkami a podrobnostmi, budeme Pospěšte si prostřednictvím kroků 2 až 4.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="c1d4c-155">Pokud potřebujete aktualizační program pro vytváření sestav hlavní/podrobnosti, které jsou rozloženy na více stránkách, přečtěte si kurz pro [filtrování hlavní/podrobnosti na dvou stránkách](../masterdetail/master-detail-filtering-across-two-pages-cs.md) .</span><span class="sxs-lookup"><span data-stu-id="c1d4c-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-cs.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="c1d4c-156">Krok 2: zobrazení seznamu kategorií</span><span class="sxs-lookup"><span data-stu-id="c1d4c-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="c1d4c-157">Otevřete stránku `Default.aspx` ve složce `SiteMapProvider` a přetáhněte prvek GridView z panelu nástrojů do návrháře a nastavte jeho `ID` na `Categories`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="c1d4c-158">Z inteligentní značky GridView s, navažte ji na nový prvek ObjectDataSource s názvem `CategoriesDataSource` a nakonfigurujte ho tak, aby se jeho data navázala pomocí metody `GetCategories` `CategoriesBLL` třídy s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="c1d4c-159">Vzhledem k tomu, že tento prvek GridView pouze zobrazí kategorie a neposkytuje možnosti změny dat, nastavte rozevírací seznamy na kartách aktualizace, vložení a odstranění na hodnotu (žádné).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="c1d4c-160">[![nakonfigurovat prvek ObjectDataSource tak, aby vracel kategorie pomocí metody GetCategories](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span></span>

<span data-ttu-id="c1d4c-161">**Obrázek 4**: Konfigurace prvku ObjectDataSource tak, aby vracela kategorie pomocí metody `GetCategories` ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="c1d4c-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span></span>

<span data-ttu-id="c1d4c-162">[![nastavení rozevíracích seznamů na kartách aktualizace, vložení a odstranění na (žádné)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span></span>

<span data-ttu-id="c1d4c-163">**Obrázek 5**: nastavení rozevíracích seznamů na kartách aktualizace, vložení a odstranění na (žádné) ([kliknutím zobrazíte obrázek v plné velikosti).](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span></span>

<span data-ttu-id="c1d4c-164">Po dokončení Průvodce konfigurací zdroje dat přidá Visual Studio vlastnost BoundField pro `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`a `BrochurePath`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="c1d4c-165">Upravte prvek GridView tak, že obsahuje pouze `CategoryName` a `Description` BoundFields a aktualizujte vlastnost `HeaderText` `CategoryName` vlastnost BoundField s na kategorii.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="c1d4c-166">Dále přidejte HyperLinkField a umístěte ji tak, aby byla v poli nejvíce vlevo.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="c1d4c-167">Vlastnost `DataNavigateUrlFields` nastavte na `CategoryID` a vlastnost `DataNavigateUrlFormatString` na `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="c1d4c-168">Pro zobrazení produktů nastavte vlastnost `Text`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-168">Set the `Text` property to View Products .</span></span>

![Přidání HyperLinkField do kategorií GridView](building-a-custom-database-driven-site-map-provider-cs/_static/image6.gif)

<span data-ttu-id="c1d4c-170">**Obrázek 6**: Přidání prvku HyperLinkField do prvku GridView `Categories`</span><span class="sxs-lookup"><span data-stu-id="c1d4c-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>

<span data-ttu-id="c1d4c-171">Po vytvoření prvku ObjectDataSource a přizpůsobení polí GridViewu budou tyto dva ovládací prvky deklarativním označením vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample2.aspx)]

<span data-ttu-id="c1d4c-172">Obrázek 7 zobrazuje `Default.aspx` při prohlížení v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="c1d4c-173">Kliknutím na odkaz Zobrazit produkty ve kategoriích přejdete na `ProductsByCategory.aspx?CategoryID=categoryID`, které budeme sestavit v kroku 3.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>

<span data-ttu-id="c1d4c-174">[![je každá kategorie uvedená spolu s odkazem Zobrazit produkty.](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span></span>

<span data-ttu-id="c1d4c-175">**Obrázek 7**: Každá kategorie je uvedena spolu s odkazem Zobrazit produkty ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png)).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span></span>

## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="c1d4c-176">Krok 3: výpis vybraných produktů kategorie s</span><span class="sxs-lookup"><span data-stu-id="c1d4c-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="c1d4c-177">Otevřete stránku `ProductsByCategory.aspx` a přidejte prvek GridView a pojmenujte ho `ProductsByCategory`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="c1d4c-178">Z jeho inteligentní značky svažte prvek GridView s novým prvkem ObjectDataSource s názvem `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="c1d4c-179">Nastavte prvek ObjectDataSource na použití `GetProductsByCategoryID(categoryID)` metody `ProductsBLL` třídy s a nastavte rozevírací seznamy na (žádné) na kartách aktualizace, vložení a odstranění.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>

<span data-ttu-id="c1d4c-180">[![použít metodu ProductsBLL třídy s GetProductsByCategoryID (KódKategorie)](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span></span>

<span data-ttu-id="c1d4c-181">**Obrázek 8**: použijte metodu `GetProductsByCategoryID(categoryID)` `ProductsBLL` třídy s ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png)).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span></span>

<span data-ttu-id="c1d4c-182">Poslední krok v Průvodci konfigurací zdroje dat vyzve k zadání zdroje parametru pro *KódKategorie*.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="c1d4c-183">Vzhledem k tomu, že tyto informace jsou předány pomocí pole QueryString `CategoryID`, v rozevíracím seznamu vyberte hodnotu QueryString a do textového pole vlastnost QueryStringField zadejte KódKategorie, jak je znázorněno na obrázku 9.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="c1d4c-184">Kliknutím na Dokončit dokončete průvodce.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-184">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="c1d4c-185">[![použít pole QueryString dotazu KódKategorie pro parametr KódKategorie](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span></span>

<span data-ttu-id="c1d4c-186">**Obrázek 9**: použijte pole `CategoryID` QueryString pro parametr *CategoryID* ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png)).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span></span>

<span data-ttu-id="c1d4c-187">Po dokončení Průvodce přidá Visual Studio odpovídající BoundFields a třídě CheckBoxField podporována do prvku GridView pro pole dat produktu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="c1d4c-188">Odeberte všechny kromě `ProductName`, `UnitPrice`a `SupplierName` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="c1d4c-189">Přizpůsobte tyto tři BoundFields `HeaderText` vlastností, abyste si mohli přečíst produkt, cenu a dodavatele v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="c1d4c-190">Naformátujte `UnitPrice` vlastnost BoundField jako měnu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="c1d4c-191">Dále přidejte HyperLinkField a přesuňte ji do nejvyšší pozice.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="c1d4c-192">Vlastnost `Text` nastavte na hodnotu Zobrazit podrobnosti, její vlastnost `DataNavigateUrlFields` na `ProductID`a její vlastnost `DataNavigateUrlFormatString` na `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>

![Přidejte podrobnosti zobrazení HyperLinkField, které odkazuje na ProductDetails. aspx.](building-a-custom-database-driven-site-map-provider-cs/_static/image10.gif)

<span data-ttu-id="c1d4c-194">**Obrázek 10**: Přidání podrobností zobrazení HyperLinkField, které odkazuje na `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="c1d4c-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>

<span data-ttu-id="c1d4c-195">Po provedení těchto úprav by deklarativní označení GridView a ObjectDataSource s mělo vypadat takto:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample3.aspx)]

<span data-ttu-id="c1d4c-196">Vraťte se do zobrazení `Default.aspx` přes prohlížeč a klikněte na odkaz Zobrazit produkty pro nápoje.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="c1d4c-197">Tím přejdete na `ProductsByCategory.aspx?CategoryID=1`a zobrazí se názvy, ceny a dodavatelé produktů v databázi Northwind, které patří do kategorie nápoje (viz obrázek 11).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="c1d4c-198">Tuto stránku můžete dál vylepšit tak, aby obsahovala odkaz pro vracení uživatelů na stránku seznamu kategorií (`Default.aspx`) a ovládací prvek DetailsView nebo FormView, který zobrazuje název a Popis kategorie s názvem.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>

<span data-ttu-id="c1d4c-199">[![se zobrazí názvy nápojů, ceny a dodavatelé.](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span></span>

<span data-ttu-id="c1d4c-200">**Obrázek 11**: zobrazí se názvy nápojů, ceny a dodavatelé ([kliknutím zobrazíte obrázek v plné velikosti).](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span></span>

## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="c1d4c-201">Krok 4: zobrazení podrobností o produktu</span><span class="sxs-lookup"><span data-stu-id="c1d4c-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="c1d4c-202">Poslední stránka, `ProductDetails.aspx`, zobrazí vybrané podrobnosti o produktech.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="c1d4c-203">Otevřete `ProductDetails.aspx` a přetáhněte prvek DetailsView z panelu nástrojů na Návrhář.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="c1d4c-204">Nastavte vlastnost `ID` ovládacího prvku DetailsView na `ProductInfo` a vymažte hodnoty vlastností `Height` a `Width`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="c1d4c-205">Z jeho inteligentní značky navažte prvek DetailsView na nový prvek ObjectDataSource s názvem `ProductDataSource`a nakonfigurujte prvek ObjectDataSource, aby vyčetl data z metody `GetProductByProductID(productID)` `ProductsBLL` třídy s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="c1d4c-206">Stejně jako u předchozích webových stránek vytvořených v krocích 2 a 3 nastavte rozevírací seznamy na kartách aktualizace, vložení a odstranění na (žádné).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>

<span data-ttu-id="c1d4c-207">[![nakonfigurovat prvek ObjectDataSource na použití metody GetProductByProductID (productID)](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span></span>

<span data-ttu-id="c1d4c-208">**Obrázek 12**: Konfigurace prvku ObjectDataSource pro použití metody `GetProductByProductID(productID)` ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="c1d4c-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span></span>

<span data-ttu-id="c1d4c-209">Poslední krok průvodce konfigurací zdroje dat vyzve k zadání zdroje parametru *ProductID* .</span><span class="sxs-lookup"><span data-stu-id="c1d4c-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="c1d4c-210">Vzhledem k tomu, že tato data přicházejí pomocí pole QueryString `ProductID`, nastavte rozevírací seznam na QueryString a textové pole vlastnost QueryStringField na ProductID.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="c1d4c-211">Nakonec kliknutím na tlačítko Dokončit průvodce dokončete.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-211">Finally, click the Finish button to complete the wizard.</span></span>

<span data-ttu-id="c1d4c-212">[![nakonfigurovat parametr productID, aby vyčetl svou hodnotu z pole ProductID QueryString.](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span></span>

<span data-ttu-id="c1d4c-213">**Obrázek 13**: Konfigurace parametru *ProductID* , který načte svou hodnotu z pole `ProductID` QueryString ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c1d4c-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span></span>

<span data-ttu-id="c1d4c-214">Po dokončení Průvodce konfigurací zdroje dat vytvoří Visual Studio odpovídající BoundFields a třídě CheckBoxField podporována v ovládacím prvku pro pole dat produktu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="c1d4c-215">Odeberte `ProductID`, `SupplierID`a `CategoryID` BoundFields a nakonfigurujte zbývající pole podle potřeby.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="c1d4c-216">Po několiki estetických konfigurací je můj ovládací prvek DetailsView a ObjectDataSource s podobným kódem jako následující:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>

[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample4.aspx)]

<span data-ttu-id="c1d4c-217">Tuto stránku otestujete tak, že se vrátíte do `Default.aspx` a kliknete na Zobrazit produkty pro kategorii nápoje.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="c1d4c-218">Ze seznamu nápojových produktů klikněte na odkaz Zobrazit podrobnosti pro Chai čaj.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="c1d4c-219">Tím přejdete na `ProductDetails.aspx?ProductID=1`, které zobrazí podrobnosti Chai čaj s (viz obrázek 14).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>

<span data-ttu-id="c1d4c-220">[Zobrazí se ![Chai čaj s dodavatel, kategorie, cena a další informace.](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span></span>

<span data-ttu-id="c1d4c-221">**Obrázek 14**: zobrazí se hodnota Chai čaj s, kategorie, ceny a další informace ([kliknutím zobrazíte obrázek v plné velikosti).](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span></span>

## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="c1d4c-222">Krok 5: princip interních pracovních kroků poskytovatele mapy webu</span><span class="sxs-lookup"><span data-stu-id="c1d4c-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="c1d4c-223">Mapa webu je reprezentovaná v paměti webového serveru jako kolekce instancí `SiteMapNode`, které tvoří hierarchii.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="c1d4c-224">Musí existovat přesně jeden kořen, všechny nekořenové uzly musí mít přesně jeden nadřazený uzel a všechny uzly mohou mít libovolný počet podřízených objektů.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="c1d4c-225">Každý objekt `SiteMapNode` představuje oddíl ve struktuře webu. Tyto oddíly často obsahují odpovídající webovou stránku.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="c1d4c-226">V důsledku toho má [třída`SiteMapNode`](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) vlastnosti jako `Title`, `Url`a `Description`, které poskytují informace pro oddíl, který `SiteMapNode` představuje.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="c1d4c-227">K dispozici je také vlastnost `Key`, která jednoznačně identifikuje každý `SiteMapNode` v hierarchii a také vlastnosti používané k vytvoření této hierarchie `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`a tak dále.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="c1d4c-228">Obrázek 15 ukazuje obecnou strukturu mapy webu z obrázku 1, ale podrobné informace o implementaci jsou vysvětlené podrobněji.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>

<span data-ttu-id="c1d4c-229">[![každý oddíl SiteMapNode má vlastnosti, jako je název, adresa URL, klíč a tak dále.](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span></span>

<span data-ttu-id="c1d4c-230">**Obrázek 15**: každá `SiteMapNode` má vlastnosti jako `Title`, `Url`, `Key`a tak dále ([kliknutím zobrazíte obrázek v plné velikosti).](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span></span>

<span data-ttu-id="c1d4c-231">Mapa webu je přístupná prostřednictvím [třídy`SiteMap`](https://msdn.microsoft.com/library/system.web.sitemap.aspx) v [oboru názvů`System.Web`](https://msdn.microsoft.com/library/system.web.aspx).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="c1d4c-232">Tato vlastnost `RootNode` třídy vrací instanci kořenového `SiteMapNode` mapy webu. `CurrentNode` vrátí `SiteMapNode`, jehož vlastnost `Url` odpovídá adrese URL aktuálně požadované stránky.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="c1d4c-233">Tato třída se používá interně pro navigační webové ovládací prvky ASP.NET 2,0 s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="c1d4c-234">Pokud jsou k dispozici vlastnosti `SiteMap` třídy, musí serializovat strukturu mapy webu z nějakého trvalého média do paměti.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="c1d4c-235">Logika serializace mapy webu však není pevně zakódována do `SiteMap` třídy.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="c1d4c-236">Místo toho je za běhu `SiteMap` třída určit, který *poskytovatel* mapy webu se má použít pro serializaci.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="c1d4c-237">Ve výchozím nastavení se používá [třída`XmlSiteMapProvider`](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) , která čte strukturu map webu ze správně formátovaného souboru XML.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="c1d4c-238">Nicméně s trochou práce můžeme vytvořit vlastního poskytovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="c1d4c-239">Všichni poskytovatelé map webu musí být odvozeni od [`SiteMapProvider` třídy](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), která zahrnuje základní metody a vlastnosti potřebné pro poskytovatele mapy webu, ale vynechává mnoho podrobností implementace.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="c1d4c-240">Druhá třída, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), rozšiřuje třídu `SiteMapProvider` a obsahuje robustnější implementaci potřebných funkcí.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="c1d4c-241">Interně `StaticSiteMapProvider` ukládá `SiteMapNode` instance mapy webu do `Hashtable` a poskytuje metody jako `AddNode(child, parent)`, `RemoveNode(siteMapNode),` a `Clear()`, které přidávají a odstraňují `SiteMapNode` s interní `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="c1d4c-242">`XmlSiteMapProvider` je odvozen z `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="c1d4c-243">Při vytváření vlastního poskytovatele mapy webu, který rozšiřuje `StaticSiteMapProvider`, existují dvě abstraktní metody, které musí být přepsány: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) a [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="c1d4c-244">`BuildSiteMap`, jak název naznačuje, zodpovídá za načtení struktury mapy webu z trvalého úložiště a jeho sestavení v paměti.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="c1d4c-245">`GetRootNodeCore` vrátí kořenový uzel na mapě webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="c1d4c-246">Než může webová aplikace použít poskytovatele mapy webu, musí být zaregistrovaná v konfiguraci aplikace.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="c1d4c-247">Ve výchozím nastavení je třída `XmlSiteMapProvider` registrována pomocí `AspNetXmlSiteMapProvider`názvu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="c1d4c-248">Chcete-li zaregistrovat další poskytovatele map webu, přidejte následující kód pro `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample5.xml)]

<span data-ttu-id="c1d4c-249">Hodnota *Name* přiřadí poskytovateli popisný název, zatímco *typ* Určuje plně kvalifikovaný název typu poskytovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="c1d4c-250">Po vytvoření našeho vlastního poskytovatele mapy webu prozkoumáme konkrétní hodnoty *názvu* a hodnot *typu* v kroku 7.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="c1d4c-251">Je vytvořena instance třídy poskytovatele mapy webu při prvním přístupu z třídy `SiteMap` a zůstane v paměti po dobu životnosti webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="c1d4c-252">Vzhledem k tomu, že existuje pouze jedna instance poskytovatele mapy webu, kterou lze vyvolat od více souběžných návštěvníků webu, je nezbytné, aby metody poskytovatele s byly bezpečné pro přístup z více *vláken*.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="c1d4c-253">V zájmu výkonu a škálovatelnosti je důležité, abyste do mezipaměti naukládali strukturu mapy lokality v paměti a místo opakovaného vytváření nevytvořili tuto strukturu uloženou v mezipaměti, a to i při každém vyvolání metody `BuildSiteMap`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="c1d4c-254">v závislosti na tom, jaké navigační ovládací prvky se používají na stránce a hloubku struktury mapy webu, může být `BuildSiteMap` pro požadavek na stránku vyvoláno několikrát.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="c1d4c-255">Pokud v žádném případě neukládáme do mezipaměti strukturu mapy webu v `BuildSiteMap` pak pokaždé, když se vyvolá, potřebujeme znovu načíst informace o produktech a kategoriích z architektury (což by způsobilo dotaz na databázi).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="c1d4c-256">Jak jsme probrali v předchozích kurzech pro ukládání do mezipaměti, můžou být data v mezipaměti zastaralá.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="c1d4c-257">V takovém případě můžeme použít buď vypršení platnosti, nebo vypršení platnosti SQL cache založené na závislostech.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="c1d4c-258">Poskytovatel mapy webu může volitelně přepsat [metodu`Initialize`](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="c1d4c-259">`Initialize` se vyvolá při prvním vytvoření instance poskytovatele mapy webu a předává se všem vlastním atributům přiřazeným poskytovateli v `Web.config` v elementu `<add>`, jako je: `<add name="name" type="type" customAttribute="value" />`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="c1d4c-260">To je užitečné, pokud chcete, aby vývojář stránky mohl určit různá nastavení týkající se poskytovatele mapy webu bez nutnosti upravovat kód poskytovatele s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="c1d4c-261">Například pokud jsme načetli data kategorií a produktů přímo z databáze na rozdíl od architektury, je vhodné, aby vývojář stránky místo použití pevně kódované hodnoty v kódu poskytovatele umožnil určit připojovací řetězec databáze prostřednictvím `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="c1d4c-262">Vlastní poskytovatel mapy webu, který sestavíme v kroku 6, nepřepisuje tuto metodu `Initialize`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="c1d4c-263">Příklad použití metody `Initialize` najdete v článku [Jan Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [uložením map webu v SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) článku.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>

## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="c1d4c-264">Krok 6: Vytvoření vlastního poskytovatele mapy webu</span><span class="sxs-lookup"><span data-stu-id="c1d4c-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="c1d4c-265">Abychom vytvořili vlastního poskytovatele mapy webu, který vytvoří mapu webu z kategorií a produktů v databázi Northwind, musíme vytvořit třídu, která rozšiřuje `StaticSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="c1d4c-266">V kroku 1 jste požádali o přidání složky `CustomProviders` do složky `App_Code` – přidejte novou třídu do této složky s názvem `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="c1d4c-267">Do `NorthwindSiteMapProvider` třídy přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample6.cs)]

<span data-ttu-id="c1d4c-268">Pojďme začít prozkoumávat tuto metodu `BuildSiteMap` třídy, která začíná [příkazem`lock`](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="c1d4c-269">Příkaz `lock` umožňuje zadat pouze jedno vlákno v čase, a tím i serializaci přístupu ke svému kódu a zabránění dvěma souběžným vláknům z krokování na jednom dalším nohou.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="c1d4c-270">`root` `SiteMapNode` proměnné na úrovni třídy slouží k ukládání struktury mapy webu do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="c1d4c-271">Když je mapa webu vytvořena poprvé nebo poprvé po změně podkladových dat, `root` bude `null` a bude vytvořena struktura mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `null` and the site map structure will be constructed.</span></span> <span data-ttu-id="c1d4c-272">Kořenový uzel map webu s je přiřazen `root` během procesu vytváření, takže při příštím volání této metody `root` nebude `null`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `null`.</span></span> <span data-ttu-id="c1d4c-273">Proto pokud `root` není `null` struktura mapy webu se vrátí volajícímu, aniž by ji museli znovu vytvořit.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-273">Consequently, so long as `root` is not `null` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="c1d4c-274">Pokud je kořen `null`, vytvoří se struktura mapy webu z informací o produktu a kategorii.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-274">If root is `null`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="c1d4c-275">Mapa webu je sestavena vytvořením instancí `SiteMapNode` a následným vytvořením hierarchie prostřednictvím volání metody `AddNode` `StaticSiteMapProvider` třídy s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="c1d4c-276">`AddNode` provádí interní účetnictví a ukládá instance `SiteMapNode` roztříděné do `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="c1d4c-277">Předtím, než začneme sestavovat hierarchii, začneme voláním metody `Clear`, která vymaže prvky z interního `Hashtable`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="c1d4c-278">Dále je metoda `ProductsBLL` třídy s `GetProducts` a výsledná `ProductsDataTable` uložená v místních proměnných.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="c1d4c-279">Konstrukce mapy webu začíná vytvořením kořenového uzlu a jeho přiřazením `root`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="c1d4c-280">Přetížení [konstruktoru`SiteMapNode` s](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) , který se tady používá, a v rámci této `BuildSiteMap` se předaly tyto informace:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="c1d4c-281">Odkaz na zprostředkovatele mapy webu (`this`).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-281">A reference to the site map provider (`this`).</span></span>
- <span data-ttu-id="c1d4c-282">`Key``SiteMapNode` s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="c1d4c-283">Požadovaná hodnota musí být pro každý `SiteMapNode`jedinečná.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="c1d4c-284">`Url``SiteMapNode` s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="c1d4c-285">`Url` je volitelné, ale pokud je k dispozici, musí být každá hodnota `Url` `SiteMapNode` s jedinečná.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="c1d4c-286">`Title`, který je třeba zadat `SiteMapNode` s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="c1d4c-287">Volání metody `AddNode(root)` přidá `SiteMapNode` `root` na mapu webu jako kořen.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="c1d4c-288">V dalším kroku se zobrazí výčet všech `ProductRow` ve `ProductsDataTable`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="c1d4c-289">Pokud již existuje `SiteMapNode` pro aktuální kategorii produktů, odkaz na ni.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="c1d4c-290">V opačném případě je nová `SiteMapNode` pro kategorii vytvořena a přidána jako podřízená `SiteMapNode``root` prostřednictvím volání metody `AddNode(categoryNode, root)`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="c1d4c-291">Po nalezení nebo vytvoření odpovídající kategorie `SiteMapNode` uzel se vytvoří `SiteMapNode` pro aktuální produkt a přidá se jako podřízený prvek kategorie `SiteMapNode` prostřednictvím `AddNode(productNode, categoryNode)`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="c1d4c-292">Všimněte si, že hodnota vlastnosti `SiteMapNode` kategorie `Url` je `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, zatímco vlastnost `SiteMapNode` s produktem `Url` má přiřazen `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="c1d4c-293">Tyto produkty, které mají hodnotu `NULL` databáze pro jejich `CategoryID` jsou seskupeny do kategorie `SiteMapNode` jejichž vlastnost `Title` je nastavena na hodnotu None a jejíž vlastnost `Url` je nastavena na prázdný řetězec.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="c1d4c-294">Rozhodli jste se nastavit `Url` na prázdný řetězec, protože metoda `ProductBLL` třídy `GetProductsByCategory(categoryID)` v tuto chvíli neobsahuje schopnost vracet jenom tyto produkty s hodnotou `NULL` `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="c1d4c-295">Také jsem chtěl předvést, jak navigační ovládací prvky vykreslují `SiteMapNode`, který postrádá hodnotu pro jeho vlastnost `Url`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="c1d4c-296">Doporučujem, abyste tento kurz rozšířili tak, aby se vlastnost None `SiteMapNode` s `Url` na `ProductsByCategory.aspx`, ale zobrazila se jenom produkty s hodnotami `NULL` `CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>

<span data-ttu-id="c1d4c-297">Po sestavení mapy webu je do mezipaměti dat přidán libovolný objekt pomocí závislosti mezipaměti SQL na `Categories` a `Products` tabulek prostřednictvím objektu `AggregateCacheDependency`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="c1d4c-298">Prozkoumali jsme pomocí závislostí mezipaměti SQL v předchozím kurzu *pomocí závislostí mezipaměti SQL*.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="c1d4c-299">Vlastní poskytovatel mapy webu však používá přetížení metody datové mezipaměti s `Insert`, kterou jsme ještě prozkoumali.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="c1d4c-300">Toto přetížení přijímá jako konečný vstupní parametr delegáta, který je volán při odebrání objektu z mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="c1d4c-301">Konkrétně Předáte novému [delegátu`CacheItemRemovedCallback`](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) , který odkazuje na metodu `OnSiteMapChanged` definovanou níže ve třídě `NorthwindSiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="c1d4c-302">Reprezentace mapy webu v paměti je uložená v mezipaměti prostřednictvím proměnné na úrovni třídy `root`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="c1d4c-303">Vzhledem k tomu, že existuje pouze jedna instance třídy vlastního zprostředkovatele mapy webu a protože tato instance je sdílena mezi všemi vlákny webové aplikace, tato proměnná třídy slouží jako mezipaměť.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="c1d4c-304">Metoda `BuildSiteMap` také používá datovou mezipaměť, ale pouze jako způsob, jak dostávat oznámení, když se změní podkladová data databáze v tabulkách `Categories` nebo `Products`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="c1d4c-305">Všimněte si, že hodnota vložená do mezipaměti dat je pouze aktuální datum a čas.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="c1d4c-306">Skutečná data mapy webu *nejsou* vložena do mezipaměti dat.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-306">The actual site map data is *not* put in the data cache.</span></span>

<span data-ttu-id="c1d4c-307">Metoda `BuildSiteMap` se dokončí vrácením kořenového uzlu mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="c1d4c-308">Zbývající metody jsou poměrně jasné.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="c1d4c-309">`GetRootNodeCore` zodpovídá za vrácení kořenového uzlu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="c1d4c-310">Vzhledem k tomu, že `BuildSiteMap` vrací kořen, `GetRootNodeCore` jednoduše vrátí návratovou hodnotu `BuildSiteMap` s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="c1d4c-311">Metoda `OnSiteMapChanged` nastaví `root` zpět na `null` při odebrání položky mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-311">The `OnSiteMapChanged` method sets `root` back to `null` when the cache item is removed.</span></span> <span data-ttu-id="c1d4c-312">Když se kořenová sada vrátí zpátky na `null`, při příštím `BuildSiteMap` se znovu vytvoří struktura mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-312">With root set back to `null`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="c1d4c-313">Nakonec vlastnost `CachedDate` vrátí hodnotu data a času uloženou v mezipaměti dat, pokud taková hodnota existuje.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="c1d4c-314">Tuto vlastnost může vývojář stránky použít k určení, kdy byla data mapy webu naposledy uložena do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="c1d4c-315">Krok 7: registrace`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="c1d4c-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="c1d4c-316">Aby naše webová aplikace používala poskytovatele `NorthwindSiteMapProvider` lokality vytvořeného v kroku 6, musíme ho zaregistrovat v `<siteMap>` části `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="c1d4c-317">Konkrétně přidejte následující značku do prvku `<system.web>` v `Web.config`:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>

[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample7.xml)]

<span data-ttu-id="c1d4c-318">Tento kód obsahuje dvě věci: nejdřív indikuje, že je předdefinovaná `AspNetXmlSiteMapProvider` výchozím poskytovatelem mapy webu. za druhé zaregistruje vlastního poskytovatele mapy webu vytvořeného v kroku 6 s popisným názvem Northwind.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="c1d4c-319">Pro poskytovatele mapy webu nacházející se ve složce `App_Code` aplikací je hodnota atributu `type` jednoduše název třídy.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="c1d4c-320">Alternativně může být vlastní poskytovatel mapy webu vytvořen v samostatném projektu knihovny tříd se sestavením, které je umístěno v adresáři `/Bin` webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="c1d4c-321">V takovém případě by hodnota atributu `type` mohla být *obor názvů*. *ClassName*, *AssemblyName* .</span><span class="sxs-lookup"><span data-stu-id="c1d4c-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>

<span data-ttu-id="c1d4c-322">Po aktualizaci `Web.config`chvíli počkejte, než se zobrazí všechny stránky z kurzů v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="c1d4c-323">Všimněte si, že navigační rozhraní na levé straně stále zobrazuje oddíly a kurzy definované v `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="c1d4c-324">Důvodem je to, že `AspNetXmlSiteMapProvider` jako výchozí poskytovatel jsme opustili.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="c1d4c-325">Aby bylo možné vytvořit prvek uživatelského rozhraní navigace, který používá `NorthwindSiteMapProvider`, je nutné explicitně určit, že má být použit poskytovatel mapy webu Northwind.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="c1d4c-326">V kroku 8 si ukážeme, jak to provést.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="c1d4c-327">Krok 8: zobrazení informací o mapě webu pomocí vlastního poskytovatele mapy webu</span><span class="sxs-lookup"><span data-stu-id="c1d4c-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="c1d4c-328">Pomocí vlastního poskytovatele mapy webu vytvořeného a registrovaného v `Web.config`jsme připraveni přidat navigační ovládací prvky do `Default.aspx`, `ProductsByCategory.aspx`a `ProductDetails.aspx` stránek do složky `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="c1d4c-329">Začněte otevřením stránky `Default.aspx` a přetažením `SiteMapPath` z panelu nástrojů do návrháře.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="c1d4c-330">Ovládací prvek SiteMapPath je umístěn v navigační oblasti sady nástrojů.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>

<span data-ttu-id="c1d4c-331">[![přidat SiteMapPath do default. aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span></span>

<span data-ttu-id="c1d4c-332">**Obrázek 16**: Přidání akce SiteMapPath do `Default.aspx` ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="c1d4c-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span></span>

<span data-ttu-id="c1d4c-333">Ovládací prvek SiteMapPath zobrazí popis cesty, který označuje aktuální umístění stránky v mapě webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="c1d4c-334">Do horní části stránky předlohy jsme přidali zpět na *stránkách předlohy a* v kurzu navigace na webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="c1d4c-335">Chvíli počkejte, než tuto stránku zobrazíte v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="c1d4c-336">Hodnota SiteMapPath přidaná na obrázku 16 používá výchozího poskytovatele mapy webu, který získává data z `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="c1d4c-337">Popis cesty proto zobrazuje domovskou &gt; přizpůsobení mapy webu, stejně jako navigace v pravém horním rohu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>

<span data-ttu-id="c1d4c-338">[![popis cesty používá výchozího poskytovatele mapy webu](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span></span>

<span data-ttu-id="c1d4c-339">**Obrázek 17**: navigace s popisem cesty používá výchozího poskytovatele mapy webu ([kliknutím zobrazíte obrázek v plné velikosti).](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span></span>

<span data-ttu-id="c1d4c-340">Chcete-li přidat SiteMapPath na obrázku 16 použijte vlastního poskytovatele mapy webu, který jsme vytvořili v kroku 6, nastavte jeho [vlastnost`SiteMapProvider`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) na Northwind, název, který jsme přiřadili `NorthwindSiteMapProvider` v `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="c1d4c-341">Návrhář bohužel nadále používá výchozího poskytovatele mapy webu, ale pokud po provedení této změny této vlastnosti navštívíte stránku pomocí prohlížeče, uvidíte, že popis cesty teď používá vlastního poskytovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>

<span data-ttu-id="c1d4c-342">[![popis cesty teď používá vlastního poskytovatele mapy webu NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span></span>

<span data-ttu-id="c1d4c-343">**Obrázek 18**: navigace s popisem cesty nyní používá vlastního poskytovatele mapy webu `NorthwindSiteMapProvider` ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="c1d4c-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span></span>

<span data-ttu-id="c1d4c-344">Ovládací prvek SiteMapPath zobrazuje více funkčních uživatelských rozhraní na `ProductsByCategory.aspx` a `ProductDetails.aspx` stránkách.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="c1d4c-345">Přidejte na tyto stránky SiteMapPath a nastavte vlastnost `SiteMapProvider` v obou na Northwind.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="c1d4c-346">Z `Default.aspx` klikněte na odkaz Zobrazit produkty pro nápoje a pak na odkaz Zobrazit podrobnosti pro pole Chai čaj.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="c1d4c-347">Jak ukazuje obrázek 19, popis cesty obsahuje oddíl aktuální mapy webu (Chai čaj) a jeho předchůdce: nápoje a všechny kategorie.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>

<span data-ttu-id="c1d4c-348">[![popis cesty teď používá vlastního poskytovatele mapy webu NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span></span>

<span data-ttu-id="c1d4c-349">**Obrázek 19**: navigace s popisem cesty nyní používá vlastního poskytovatele mapy webu `NorthwindSiteMapProvider` ([kliknutím zobrazíte obrázek v plné velikosti](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="c1d4c-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span></span>

<span data-ttu-id="c1d4c-350">Jiné prvky uživatelského rozhraní navigace lze použít kromě prvku SiteMapPath, jako je například nabídka a ovládací prvky TreeView.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="c1d4c-351">Stránky `Default.aspx`, `ProductsByCategory.aspx`a `ProductDetails.aspx` ve stažení pro tento kurz, například všechny ovládací prvky nabídky zahrnutí (viz obrázek 20).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="c1d4c-352">Podrobnější pohled na navigační ovládací prvky a systém mapy webu v ASP.NET 2,0 najdete v tématu [prozkoumání funkcí navigace na webu ASP.NET 2,0 s](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) a v části [použití ovládacích prvků navigace na webu](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) v [rychlém startu ASP.NET 2,0](https://quickstarts.asp.net/QuickStartv20/aspnet/) .</span><span class="sxs-lookup"><span data-stu-id="c1d4c-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>

<span data-ttu-id="c1d4c-353">[![ovládacího prvku nabídky obsahuje všechny kategorie a produkty.](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span></span>

<span data-ttu-id="c1d4c-354">**Obrázek 20**: ovládací prvek nabídky obsahuje seznam všech kategorií a produktů ([kliknutím zobrazíte obrázek v plné velikosti).](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span></span>

<span data-ttu-id="c1d4c-355">Jak bylo zmíněno dříve v tomto kurzu, struktura mapy webu je k dispozici programově prostřednictvím `SiteMap` třídy.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="c1d4c-356">Následující kód vrátí kořenové `SiteMapNode` výchozího zprostředkovatele:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample8.cs)]

<span data-ttu-id="c1d4c-357">Vzhledem k tomu, že `AspNetXmlSiteMapProvider` je výchozím poskytovatelem pro naši aplikaci, výše uvedený kód vrátí kořenový uzel definovaný v `Web.sitemap`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="c1d4c-358">Chcete-li odkazovat na jiného poskytovatele mapy webu než na výchozí, použijte vlastnost `SiteMap` třídy s [`Providers`](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) , například takto:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample9.cs)]

<span data-ttu-id="c1d4c-359">Kde *Name* je název vlastního zprostředkovatele mapy webu (Northwind, pro naši webovou aplikaci).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="c1d4c-360">Chcete-li získat přístup ke členu, který je specifický pro poskytovatele mapy webu, použijte `SiteMap.Providers["name"]` k načtení instance poskytovatele a jejich přetypování na příslušný typ.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="c1d4c-361">Chcete-li například zobrazit vlastnost `NorthwindSiteMapProvider` s `CachedDate` na stránce ASP.NET, použijte následující kód:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>

[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample10.cs)]

> [!NOTE]
> <span data-ttu-id="c1d4c-362">Ujistěte se, že testujete funkci závislosti mezipaměti SQL.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="c1d4c-363">Po návštěvě `Default.aspx`, `ProductsByCategory.aspx`a `ProductDetails.aspx` stránky, jděte do jednoho z kurzů v části úpravy, vložení a odstranění a upravte název kategorie nebo produktu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="c1d4c-364">Pak se vraťte na jednu ze stránek ve složce `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="c1d4c-365">Za předpokladu, že se pro mechanismus cyklického dotazování předává dostatek času na změnu podkladové databáze, měla by být mapa lokality aktualizována, aby se zobrazil nový název produktu nebo kategorie.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>

## <a name="summary"></a><span data-ttu-id="c1d4c-366">Přehled</span><span class="sxs-lookup"><span data-stu-id="c1d4c-366">Summary</span></span>

<span data-ttu-id="c1d4c-367">Funkce mapy webu ASP.NET 2,0 s obsahuje třídu `SiteMap`, řadu integrovaných webových ovládacích prvků a výchozího poskytovatele mapy webu, který očekává, že informace o mapě webu jsou trvale uložené v souboru XML.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="c1d4c-368">Aby bylo možné používat informace o mapě webu z nějakého jiného zdroje, například z databáze, architektury aplikace nebo vzdálené webové služby, musíme vytvořit vlastního poskytovatele mapy webu.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="c1d4c-369">To zahrnuje vytvoření třídy, která je přímo nebo nepřímo odvozena z třídy `SiteMapProvider`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="c1d4c-370">V tomto kurzu jsme zjistili, jak vytvořit vlastního poskytovatele mapy webu, který bude na základě mapy webu na informace o produktu a kategorii odvrácených z architektury aplikace.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="c1d4c-371">Náš poskytovatel rozšířil třídu `StaticSiteMapProvider` a vznikla tak vytvoření metody `BuildSiteMap`, která načetla data, vytvořila hierarchii mapy webu a ukládá do mezipaměti výslednou strukturu v proměnné na úrovni třídy.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="c1d4c-372">Použili jsme závislost mezipaměti SQL s funkcí zpětného volání k zrušení platnosti struktury uložené v mezipaměti, když se upraví základní `Categories` nebo data `Products`.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="c1d4c-373">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="c1d4c-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="c1d4c-374">Další čtení</span><span class="sxs-lookup"><span data-stu-id="c1d4c-374">Further Reading</span></span>

<span data-ttu-id="c1d4c-375">Další informace o tématech popsaných v tomto kurzu najdete v následujících zdrojích informací:</span><span class="sxs-lookup"><span data-stu-id="c1d4c-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="c1d4c-376">[Uložení map webů v SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) a [poskytovatele mapy webu SQL, kterého jste čekali na](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="c1d4c-377">Podívejte se na model poskytovatele ASP.NET 2,0 s.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="c1d4c-378">Sada nástrojů pro poskytovatele</span><span class="sxs-lookup"><span data-stu-id="c1d4c-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="c1d4c-379">Zkoumání funkcí navigace na webu ASP.NET 2,0 s</span><span class="sxs-lookup"><span data-stu-id="c1d4c-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="c1d4c-380">O autorovi</span><span class="sxs-lookup"><span data-stu-id="c1d4c-380">About the Author</span></span>

<span data-ttu-id="c1d4c-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), autor 7 ASP/ASP. NET Books a zakladatel of [4GuysFromRolla.com](http://www.4guysfromrolla.com), pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c1d4c-382">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c1d4c-383">Nejnovější kniha je [*Sams naučit se ASP.NET 2,0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c1d4c-384">Dá se získat na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="c1d4c-385">nebo prostřednictvím svého blogu, který najdete na adrese [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="c1d4c-385">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="c1d4c-386">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="c1d4c-386">Special Thanks To</span></span>

<span data-ttu-id="c1d4c-387">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-387">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c1d4c-388">Recenzenti potenciálních zákazníků pro tento kurz byly Dave Gardner, Zack Novák, Teresa Murphy a Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="c1d4c-388">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="c1d4c-389">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="c1d4c-389">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c1d4c-390">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c1d4c-390">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="c1d4c-391">Next</span><span class="sxs-lookup"><span data-stu-id="c1d4c-391">Next</span></span>](building-a-custom-database-driven-site-map-provider-vb.md)
