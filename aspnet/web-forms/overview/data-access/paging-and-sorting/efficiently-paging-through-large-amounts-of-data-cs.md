---
uid: web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
title: Účinné stránkování velkých objemů dat (C#) | Dokumentace Microsoftu
author: rick-anderson
description: Výchozí možnost stránkování prvku prezentace dat nevhodné, při práci s velkými objemy dat, jako jeho základní retriev ovládací prvek zdroje dat...
ms.author: riande
ms.date: 08/15/2006
ms.assetid: 59c01998-9326-4ecb-9392-cb9615962140
msc.legacyurl: /web-forms/overview/data-access/paging-and-sorting/efficiently-paging-through-large-amounts-of-data-cs
msc.type: authoredcontent
ms.openlocfilehash: 21f37dc1ffbcb7e8e15e4bed261b68ffc0388c21
ms.sourcegitcommit: 0f1119340e4464720cfd16d0ff15764746ea1fea
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 04/17/2019
ms.locfileid: "59388423"
---
# <a name="efficiently-paging-through-large-amounts-of-data-c"></a><span data-ttu-id="30709-103">Účinné stránkování velkých objemů dat (C#)</span><span class="sxs-lookup"><span data-stu-id="30709-103">Efficiently Paging Through Large Amounts of Data (C#)</span></span>

<span data-ttu-id="30709-104">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="30709-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="30709-105">[Stáhněte si ukázkovou aplikaci](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) nebo [stahovat PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="30709-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_25_CS.exe) or [Download PDF](efficiently-paging-through-large-amounts-of-data-cs/_static/datatutorial25cs1.pdf)</span></span>

> <span data-ttu-id="30709-106">Výchozí možnost stránkování prvku prezentace dat není vhodná, při práci s velkými objemy dat, jako jeho základní ovládací prvek zdroje dat zjišťuje všechny záznamy, i když se zobrazí pouze podmnožinu dat.</span><span class="sxs-lookup"><span data-stu-id="30709-106">The default paging option of a data presentation control is unsuitable when working with large amounts of data, as its underlying data source control retrieves all records, even though only a subset of data is displayed.</span></span> <span data-ttu-id="30709-107">V takových případech jsme musíte zapnout na vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-107">In such circumstances, we must turn to custom paging.</span></span>


## <a name="introduction"></a><span data-ttu-id="30709-108">Úvod</span><span class="sxs-lookup"><span data-stu-id="30709-108">Introduction</span></span>

<span data-ttu-id="30709-109">Jak jsme probírali v předchozím kurzu, stránkování je implementovat v jednom ze dvou způsobů:</span><span class="sxs-lookup"><span data-stu-id="30709-109">As we discussed in the preceding tutorial, paging can be implemented in one of two ways:</span></span>

- <span data-ttu-id="30709-110">**Výchozí stránkování** může být implementována pouze kontrola možnost Povolit stránkování v datech webový ovládací prvek s inteligentní značky, ale při prohlížení stránky dat ObjectDataSource načte *všechny* záznamů, dokonce i i když jsou na stránce se zobrazí pouze jejich podmnožinu</span><span class="sxs-lookup"><span data-stu-id="30709-110">**Default Paging** can be implemented by simply checking the Enable Paging option in the data Web control s smart tag; however, whenever viewing a page of data, the ObjectDataSource retrieves *all* of the records, even though only a subset of them are displayed in the page</span></span>
- <span data-ttu-id="30709-111">**Vlastní stránkování** zlepšuje výkon výchozí stránkování načtením jen takové záznamy z databáze, která musí být zobrazen pro konkrétní stránce požadovaná tímto uživatelem; data však vlastní stránkování vyžaduje trochu další úsilí k implementaci než výchozí stránkování</span><span class="sxs-lookup"><span data-stu-id="30709-111">**Custom Paging** improves the performance of default paging by retrieving only those records from the database that need to be displayed for the particular page of data requested by the user; however, custom paging involves a bit more effort to implement than default paging</span></span>

<span data-ttu-id="30709-112">Kvůli snadnému provádění jenom zaškrtněte zaškrtávací políčko a níž Hotovo!</span><span class="sxs-lookup"><span data-stu-id="30709-112">Due to the ease of implementation just check a checkbox and you re done!</span></span> <span data-ttu-id="30709-113">výchozí stránkování je atraktivní možnosti.</span><span class="sxs-lookup"><span data-stu-id="30709-113">default paging is an attractive option.</span></span> <span data-ttu-id="30709-114">Svůj přístup není k dispozici ve při načítání všechny záznamy, ale umožňuje nepravděpodobné číselné volbou při procházení dostatečně velké objemy dat nebo pro weby s mnoha souběžnými uživateli.</span><span class="sxs-lookup"><span data-stu-id="30709-114">Its na�ve approach in retrieving all of the records, though, makes it an implausible choice when paging through sufficiently large amounts of data or for sites with many concurrent users.</span></span> <span data-ttu-id="30709-115">V takových případech jsme musíte zapnout na vlastní stránkování, aby bylo možné poskytovat responzivní systému.</span><span class="sxs-lookup"><span data-stu-id="30709-115">In such circumstances, we must turn to custom paging in order to provide a responsive system.</span></span>

<span data-ttu-id="30709-116">Výzvy vlastní stránkování je schopnost vytvořit dotaz, který vrátí přesnou sadu záznamů potřebné pro konkrétní stránce data.</span><span class="sxs-lookup"><span data-stu-id="30709-116">The challenge of custom paging is being able to write a query that returns the precise set of records needed for a particular page of data.</span></span> <span data-ttu-id="30709-117">Naštěstí Microsoft SQL Server 2005 poskytuje new – klíčové slovo pro výsledky hodnocení umožňující nám napsat dotaz, který můžete efektivně načítat správné podmnožinu záznamů.</span><span class="sxs-lookup"><span data-stu-id="30709-117">Fortunately, Microsoft SQL Server 2005 provides a new keyword for ranking results, which enables us to write a query that can efficiently retrieve the proper subset of records.</span></span> <span data-ttu-id="30709-118">V tomto kurzu uvidíme, jak používat tento nový SQL Server 2005 – klíčové slovo implementovat vlastní stránkování v prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="30709-118">In this tutorial we'll see how to use this new SQL Server 2005 keyword to implement custom paging in a GridView control.</span></span> <span data-ttu-id="30709-119">Přestože je stejná jako výchozí stránkování, krokování z jedné stránky na další pomocí uživatelského rozhraní pro vlastní stránkování vlastní stránkování může být několik řádů rychleji než výchozí stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-119">While the user interface for custom paging is identical to that for default paging, stepping from one page to the next using custom paging can be several orders of magnitude faster than default paging.</span></span>

> [!NOTE]
> <span data-ttu-id="30709-120">Přesné výkonový zisk plynoucí vykazují vlastní stránkování, závisí na celkový počet záznamů stránkování prostřednictvím a zatížení umístěných na databázovém serveru.</span><span class="sxs-lookup"><span data-stu-id="30709-120">The exact performance gain exhibited by custom paging depends on the total number of records being paged through and the load being placed on the database server.</span></span> <span data-ttu-id="30709-121">Na konci tohoto kurzu podíváme na některé hrubý metriky, které prezentovat výhod ve výkonu, které získali prostřednictvím vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-121">At the end of this tutorial we'll look at some rough metrics that showcase the benefits in performance obtained through custom paging.</span></span>


## <a name="step-1-understanding-the-custom-paging-process"></a><span data-ttu-id="30709-122">Krok 1: Vysvětlení procesu vlastní stránkování</span><span class="sxs-lookup"><span data-stu-id="30709-122">Step 1: Understanding the Custom Paging Process</span></span>

<span data-ttu-id="30709-123">Při procházení dat po stránkách, přesné záznamy zobrazené na stránce závisí na stránce se požadovaná data a počet záznamů zobrazených na stránce.</span><span class="sxs-lookup"><span data-stu-id="30709-123">When paging through data, the precise records displayed in a page depend upon the page of data being requested and the number of records displayed per page.</span></span> <span data-ttu-id="30709-124">Představte si například, že jsme chtěli stránkovat 81 produkty 10 produkty na stránku zobrazení.</span><span class="sxs-lookup"><span data-stu-id="30709-124">For example, imagine that we wanted to page through the 81 products, displaying 10 products per page.</span></span> <span data-ttu-id="30709-125">Při prohlížení na první stránce, d chceme produkty 1 až 10. Při prohlížení na druhé stránce jsme d zajímat produkty 11 až 20 a tak dále.</span><span class="sxs-lookup"><span data-stu-id="30709-125">When viewing the first page, we d want products 1 through 10; when viewing the second page we d be interested in products 11 through 20, and so on.</span></span>

<span data-ttu-id="30709-126">Existují tři proměnné, které určují, jaké záznamů je potřeba načíst a jakým způsobem má být vykreslen rozhraní stránkování:</span><span class="sxs-lookup"><span data-stu-id="30709-126">There are three variables that dictate what records need to be retrieved and how the paging interface should be rendered:</span></span>

- <span data-ttu-id="30709-127">**Start Index řádku** index první řádek na stránce dat zobrazíte; to může index dá vypočítat jako index stránky vynásobí záznamy zobrazených na stránce a přičtení jedné.</span><span class="sxs-lookup"><span data-stu-id="30709-127">**Start Row Index** the index of the first row in the page of data to display; this index can be calculated by multiplying the page index by the records to display per page and adding one.</span></span> <span data-ttu-id="30709-128">Například při procházení záznamů 10 najednou, první stránka (jehož index stránky je 0), Start Index řádku je 0 \* 10 + 1 nebo 1; na druhé stránce (jehož index stránky je 1), Start Index řádku je 1 \* 10 + 1 , nebo 11.</span><span class="sxs-lookup"><span data-stu-id="30709-128">For example, when paging through records 10 at a time, for the first page (whose page index is 0), the Start Row Index is 0 \* 10 + 1, or 1; for the second page (whose page index is 1), the Start Row Index is 1 \* 10 + 1, or 11.</span></span>
- <span data-ttu-id="30709-129">**Maximální počet řádků** maximální počet záznamů zobrazených na stránce.</span><span class="sxs-lookup"><span data-stu-id="30709-129">**Maximum Rows** the maximum number of records to display per page.</span></span> <span data-ttu-id="30709-130">Tato proměnná se označuje jako maximální počet řádků, protože pro poslední existuje stránka může být méně záznamů vrácených než je velikost stránky.</span><span class="sxs-lookup"><span data-stu-id="30709-130">This variable is referred to as maximum rows since for the last page there may be fewer records returned than the page size.</span></span> <span data-ttu-id="30709-131">Například při procházení 81 produkty 10 záznamů na stránku, devátý a poslední stránka bude mít jenom jeden záznam.</span><span class="sxs-lookup"><span data-stu-id="30709-131">For example, when paging through the 81 products 10 records per page, the ninth and final page will have just one record.</span></span> <span data-ttu-id="30709-132">Žádné stránky, ale zobrazí více výsledků, než je hodnota maximální počet řádků.</span><span class="sxs-lookup"><span data-stu-id="30709-132">No page, though, will show more records than the Maximum Rows value.</span></span>
- <span data-ttu-id="30709-133">**Celkový počet záznamů** celkový počet záznamů stránkování prostřednictvím.</span><span class="sxs-lookup"><span data-stu-id="30709-133">**Total Record Count** the total number of records being paged through.</span></span> <span data-ttu-id="30709-134">Zatímco tato proměnná není t potřebných k určení záznamů pro danou stránku, vyžadují rozhraní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-134">While this variable isn t needed to determine what records to retrieve for a given page, it does dictate the paging interface.</span></span> <span data-ttu-id="30709-135">Například pokud existují 81 stránkování prostřednictvím produktů, stránkovací rozhraní věděl, může zobrazit devět čísla stránek ve stránkovacím rozhraní.</span><span class="sxs-lookup"><span data-stu-id="30709-135">For example, if there are 81 products being paged through, the paging interface knows to display nine page numbers in the paging UI.</span></span>

<span data-ttu-id="30709-136">S výchozí stránkování, je vypočítán Index řádku spustit jako produktu index stránky a velikost stránky plus jedna, že maximální počet řádků je jednoduše velikost stránky.</span><span class="sxs-lookup"><span data-stu-id="30709-136">With default paging, the Start Row Index is computed as the product of the page index and the page size plus one, whereas the Maximum Rows is simply the page size.</span></span> <span data-ttu-id="30709-137">Od výchozího stránkování načte všechny záznamy z databáze při vykreslování libovolnou stránku dat, index pro každý řádek se označuje, díky čemuž Přesun na řádek Start Index řádku jednoduchý úkol.</span><span class="sxs-lookup"><span data-stu-id="30709-137">Since default paging retrieves all of the records from the database when rendering any page of data, the index for each row is known, thereby making moving to Start Row Index row a trivial task.</span></span> <span data-ttu-id="30709-138">Navíc je snadno dostupný, protože celkový počet záznamů s jednoduše počet záznamů v objektu DataTable (nebo jakýkoli objekt se používá k ukládání výsledků databáze).</span><span class="sxs-lookup"><span data-stu-id="30709-138">Moreover, the Total Record Count is readily available, as it s simply the number of records in the DataTable (or whatever object is being used to hold the database results).</span></span>

<span data-ttu-id="30709-139">Zadané proměnné Start Index řádku a maximální počet řádků, vlastní implementaci stránkování musí vracet pouze přesné podmnožinu záznamů spuštění na řádek indexu spustit až maximální počet řádků počet záznamů, které potom.</span><span class="sxs-lookup"><span data-stu-id="30709-139">Given the Start Row Index and Maximum Rows variables, a custom paging implementation must only return the precise subset of records starting at the Start Row Index and up to Maximum Rows number of records after that.</span></span> <span data-ttu-id="30709-140">Vlastní stránkování poskytuje dva problémy:</span><span class="sxs-lookup"><span data-stu-id="30709-140">Custom paging provides two challenges:</span></span>

- <span data-ttu-id="30709-141">Jsme musí být schopen efektivně přidružit každý řádek v veškerá data stránkování prostřednictvím tak, že můžeme začít vrací záznamy na zadaný Index řádku Start index řádku</span><span class="sxs-lookup"><span data-stu-id="30709-141">We must be able to efficiently associate a row index with each row in the entire data being paged through so that we can start returning records at the specified Start Row Index</span></span>
- <span data-ttu-id="30709-142">Potřebujeme pro poskytování celkový počet záznamů stránkování prostřednictvím</span><span class="sxs-lookup"><span data-stu-id="30709-142">We need to provide the total number of records being paged through</span></span>

<span data-ttu-id="30709-143">V následujících dvou kroků prozkoumáme skriptu SQL nutné odpovědět na tyto dvě výzvy.</span><span class="sxs-lookup"><span data-stu-id="30709-143">In the next two steps we'll examine the SQL script needed to respond to these two challenges.</span></span> <span data-ttu-id="30709-144">Kromě skript SQL také potřebujeme k implementaci metody v knihoven BLL a DAL.</span><span class="sxs-lookup"><span data-stu-id="30709-144">In addition to the SQL script, we'll also need to implement methods in the DAL and BLL.</span></span>

## <a name="step-2-returning-the-total-number-of-records-being-paged-through"></a><span data-ttu-id="30709-145">Krok 2: Vrátí celkový počet záznamů stránkování prostřednictvím</span><span class="sxs-lookup"><span data-stu-id="30709-145">Step 2: Returning the Total Number of Records Being Paged Through</span></span>

<span data-ttu-id="30709-146">Před Zkoumáme, jak získat přesné podmnožinu záznamů pro na stránce se zobrazí, umožní s nejdřív se podívejte na tom, jak vrátit celkový počet záznamů stránkování prostřednictvím.</span><span class="sxs-lookup"><span data-stu-id="30709-146">Before we examine how to retrieve the precise subset of records for the page being displayed, let s first look at how to return the total number of records being paged through.</span></span> <span data-ttu-id="30709-147">Tyto informace je potřeba, abyste mohli správně nakonfigurovat uživatelského rozhraní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-147">This information is needed in order to properly configure the paging user interface.</span></span> <span data-ttu-id="30709-148">Celkový počet záznamů vrácených dotazem SQL konkrétní můžete získat pomocí [ `COUNT` agregační funkce](https://msdn.microsoft.com/library/ms175997.aspx).</span><span class="sxs-lookup"><span data-stu-id="30709-148">The total number of records returned by a particular SQL query can be obtained by using the [`COUNT` aggregate function](https://msdn.microsoft.com/library/ms175997.aspx).</span></span> <span data-ttu-id="30709-149">Například, chcete-li zjistit celkový počet záznamů v `Products` tabulku, můžeme použít následující dotaz:</span><span class="sxs-lookup"><span data-stu-id="30709-149">For example, to determine the total number of records in the `Products` table, we can use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample1.sql)]

<span data-ttu-id="30709-150">Umožní s přidejte metodu k naší DAL, která vrací tyto informace.</span><span class="sxs-lookup"><span data-stu-id="30709-150">Let s add a method to our DAL that returns this information.</span></span> <span data-ttu-id="30709-151">Zejména, vytvoříme DAL metodu nazvanou `TotalNumberOfProducts()` , který se spustí `SELECT` výše uvedeném příkazu.</span><span class="sxs-lookup"><span data-stu-id="30709-151">In particular, we'll create a DAL method called `TotalNumberOfProducts()` that executes the `SELECT` statement shown above.</span></span>

<span data-ttu-id="30709-152">Začněte otevřením `Northwind.xsd` soubor typované datové sady v `App_Code/DAL` složky.</span><span class="sxs-lookup"><span data-stu-id="30709-152">Start by opening the `Northwind.xsd` Typed DataSet file in the `App_Code/DAL` folder.</span></span> <span data-ttu-id="30709-153">Pak klikněte pravým tlačítkem na `ProductsTableAdapter` v návrháři a zvolte Přidat dotaz.</span><span class="sxs-lookup"><span data-stu-id="30709-153">Next, right-click on the `ProductsTableAdapter` in the Designer and choose Add Query.</span></span> <span data-ttu-id="30709-154">Jako jsme viděli v předchozích kurzech se ve to umožní, abychom mohli přidat novou metodu vrstvy Dal, která při vyvolání, spustí konkrétní příkaz SQL nebo uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="30709-154">As we ve seen in previous tutorials, this will allow us to add a new method to the DAL that, when invoked, will execute a particular SQL statement or stored procedure.</span></span> <span data-ttu-id="30709-155">Stejně jako u našich metody TableAdapter v předchozích kurzech, použijte příkaz SQL ad-hoc optimalizované pro tento jeden.</span><span class="sxs-lookup"><span data-stu-id="30709-155">As with our TableAdapter methods in previous tutorials, for this one opt to use an ad-hoc SQL statement.</span></span>


![Použití příkazu SQL Ad-Hoc](efficiently-paging-through-large-amounts-of-data-cs/_static/image1.png)

<span data-ttu-id="30709-157">**Obrázek 1**: Použití příkazu SQL Ad-Hoc</span><span class="sxs-lookup"><span data-stu-id="30709-157">**Figure 1**: Use an Ad-Hoc SQL Statement</span></span>


<span data-ttu-id="30709-158">Na další obrazovce můžeme určit, jaký typ dotazu vytvořte.</span><span class="sxs-lookup"><span data-stu-id="30709-158">On the next screen we can specify what type of query to create.</span></span> <span data-ttu-id="30709-159">Vzhledem k tomu, že tento dotaz vrátí jednu skalární hodnota celkový počet záznamů v `Products` zvolte tabulky `SELECT` vracející možnost hodnotu jednom.</span><span class="sxs-lookup"><span data-stu-id="30709-159">Since this query will return a single, scalar value the total number of records in the `Products` table choose the `SELECT` which returns a singe value option.</span></span>


![Konfigurovat dotaz, který bude použit příkaz SELECT, který vrací jedinou hodnotu](efficiently-paging-through-large-amounts-of-data-cs/_static/image2.png)

<span data-ttu-id="30709-161">**Obrázek 2**: Konfigurovat dotaz, který bude použit příkaz SELECT, který vrací jedinou hodnotu</span><span class="sxs-lookup"><span data-stu-id="30709-161">**Figure 2**: Configure the Query to Use a SELECT Statement that Returns a Single Value</span></span>


<span data-ttu-id="30709-162">Po označující typ použití dotazu, budeme dále musíte zadat dotaz.</span><span class="sxs-lookup"><span data-stu-id="30709-162">After indicating the type of query to use, we must next specify the query.</span></span>


![Použití vyberte COUNT(\*) z dotazu produkty](efficiently-paging-through-large-amounts-of-data-cs/_static/image3.png)

<span data-ttu-id="30709-164">**Obrázek 3**: Použít vyberte počet (\*) od produktů dotazu</span><span class="sxs-lookup"><span data-stu-id="30709-164">**Figure 3**: Use the SELECT COUNT(\*) FROM Products Query</span></span>


<span data-ttu-id="30709-165">Nakonec zadejte název metody.</span><span class="sxs-lookup"><span data-stu-id="30709-165">Finally, specify the name for the method.</span></span> <span data-ttu-id="30709-166">Stejně jako s výše uvedené, umožňují použít `TotalNumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="30709-166">As aforementioned, let s use `TotalNumberOfProducts`.</span></span>


![Pojmenujte TotalNumberOfProducts DAL – metoda](efficiently-paging-through-large-amounts-of-data-cs/_static/image4.png)

<span data-ttu-id="30709-168">**Obrázek 4**: Pojmenujte TotalNumberOfProducts DAL – metoda</span><span class="sxs-lookup"><span data-stu-id="30709-168">**Figure 4**: Name the DAL Method TotalNumberOfProducts</span></span>


<span data-ttu-id="30709-169">Po kliknutí na tlačítko Dokončit, průvodce přidá `TotalNumberOfProducts` metoda vrstvy Dal.</span><span class="sxs-lookup"><span data-stu-id="30709-169">After clicking Finish, the wizard will add the `TotalNumberOfProducts` method to the DAL.</span></span> <span data-ttu-id="30709-170">Metody vracející skalární v DAL vrátí typy připouštějící hodnotu Null v případě, že výsledkem bude příkaz jazyka SQL je `NULL`.</span><span class="sxs-lookup"><span data-stu-id="30709-170">The scalar returning methods in the DAL return nullable types, in case the result from the SQL query is `NULL`.</span></span> <span data-ttu-id="30709-171">Naše `COUNT` dotaz, ale vždy vrátí non -`NULL` hodnota; bez ohledu na to, vrátí metoda DAL s možnou hodnotou Null celé číslo.</span><span class="sxs-lookup"><span data-stu-id="30709-171">Our `COUNT` query, however, will always return a non-`NULL` value; regardless, the DAL method returns a nullable integer.</span></span>

<span data-ttu-id="30709-172">Kromě metodu DAL potřebujeme také metody v BLL.</span><span class="sxs-lookup"><span data-stu-id="30709-172">In addition to the DAL method, we also need a method in the BLL.</span></span> <span data-ttu-id="30709-173">Otevřít `ProductsBLL` třídy soubor a přidejte `TotalNumberOfProducts` metodu, která jednoduše volá, aby s vrstvou DAL `TotalNumberOfProducts` metoda:</span><span class="sxs-lookup"><span data-stu-id="30709-173">Open the `ProductsBLL` class file and add a `TotalNumberOfProducts` method that simply calls down to the DAL s `TotalNumberOfProducts` method:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample2.cs)]

<span data-ttu-id="30709-174">S vrstvou DAL `TotalNumberOfProducts` metoda vrátí celé číslo s možnou hodnotou Null; nicméně, jsme vytvořili `ProductsBLL` třída s `TotalNumberOfProducts` metodu tak, aby se standardní celé číslo.</span><span class="sxs-lookup"><span data-stu-id="30709-174">The DAL s `TotalNumberOfProducts` method returns a nullable integer; however, we ve created the `ProductsBLL` class s `TotalNumberOfProducts` method so that it returns a standard integer.</span></span> <span data-ttu-id="30709-175">Proto musíme mít `ProductsBLL` třída s `TotalNumberOfProducts` metoda vrátit hodnotu část s možnou hodnotou Null celé číslo, které jsou vrácené s vrstvou DAL `TotalNumberOfProducts` metody.</span><span class="sxs-lookup"><span data-stu-id="30709-175">Therefore, we need to have the `ProductsBLL` class s `TotalNumberOfProducts` method return the value portion of the nullable integer returned by the DAL s `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="30709-176">Volání `GetValueOrDefault()` vrátí hodnotu na celé číslo s možnou hodnotou Null, pokud existuje; pokud celočíselná hodnota s možnou hodnotou null je `null`, ale vrátí celé číslo výchozí hodnota je 0.</span><span class="sxs-lookup"><span data-stu-id="30709-176">The call to `GetValueOrDefault()` returns the value of the nullable integer, if it exists; if the nullable integer is `null`, however, it returns the default integer value, 0.</span></span>

## <a name="step-3-returning-the-precise-subset-of-records"></a><span data-ttu-id="30709-177">Krok 3: Vrací přesné podmnožinu záznamů</span><span class="sxs-lookup"><span data-stu-id="30709-177">Step 3: Returning the Precise Subset of Records</span></span>

<span data-ttu-id="30709-178">Naše dalším krokem je vytvoření metod v DAL a BLL, ve kterém přijmout Start Index řádku a maximální počet řádků proměnné jsme probírali výše a vrátí odpovídající záznamy.</span><span class="sxs-lookup"><span data-stu-id="30709-178">Our next task is to create methods in the DAL and BLL that accept the Start Row Index and Maximum Rows variables discussed earlier and return the appropriate records.</span></span> <span data-ttu-id="30709-179">Než to, umožňují s první pohled na potřebné skript SQL.</span><span class="sxs-lookup"><span data-stu-id="30709-179">Before we do that, let s first look at the needed SQL script.</span></span> <span data-ttu-id="30709-180">Před obrovskou výzvou – směřující nám je, že nám musí být schopen efektivně přiřazovat indexu na každý řádek v celé výsledky stránkování prostřednictvím tak, aby vrátíme jenom ty záznamy, spuštění na řádek indexu spustit (a až maximální počet záznamů počet záznamů).</span><span class="sxs-lookup"><span data-stu-id="30709-180">The challenge facing us is that we must be able to efficiently assign an index to each row in the entire results being paged through so that we can return just those records starting at the Start Row Index (and up to the Maximum Records number of records).</span></span>

<span data-ttu-id="30709-181">Toto není výzvu, pokud již existuje sloupec v tabulce databáze, která slouží jako index řádku.</span><span class="sxs-lookup"><span data-stu-id="30709-181">This is not a challenge if there is already a column in the database table that serves as a row index.</span></span> <span data-ttu-id="30709-182">Na první pohled může myslíme si, který `Products` tabulky s `ProductID` pole bude stačit, jako má první produkt `ProductID` 1 sekundu a 2, a tak dále.</span><span class="sxs-lookup"><span data-stu-id="30709-182">At first glance we might think that the `Products` table s `ProductID` field would suffice, as the first product has `ProductID` of 1, the second a 2, and so on.</span></span> <span data-ttu-id="30709-183">Odstraňuje se produkt však zůstanou mezera v pořadí, anulovány tento přístup.</span><span class="sxs-lookup"><span data-stu-id="30709-183">However, deleting a product leaves a gap in the sequence, nullifying this approach.</span></span>

<span data-ttu-id="30709-184">Existují dvě obecné postupy slouží k efektivní přidružení index řádku dat na stránce, a tím umožnit přesné podmnožinu záznamů se má načíst:</span><span class="sxs-lookup"><span data-stu-id="30709-184">There are two general techniques used to efficiently associate a row index with the data to page through, thereby enabling the precise subset of records to be retrieved:</span></span>

- <span data-ttu-id="30709-185">**Pomocí SQL Server 2005 s `ROW_NUMBER()` – klíčové slovo** nový SQL Server 2005 `ROW_NUMBER()` – klíčové slovo přidruží hodnoticí záznamech vrácené podle pořadí.</span><span class="sxs-lookup"><span data-stu-id="30709-185">**Using SQL Server 2005 s `ROW_NUMBER()` Keyword** new to SQL Server 2005, the `ROW_NUMBER()` keyword associates a ranking with each returned record based on some ordering.</span></span> <span data-ttu-id="30709-186">Toto pořadí lze použít jako index řádku pro každý řádek.</span><span class="sxs-lookup"><span data-stu-id="30709-186">This ranking can be used as a row index for each row.</span></span>
- <span data-ttu-id="30709-187">**Pomocí proměnné tabulky a `SET ROWCOUNT`**  systému SQL Server s [ `SET ROWCOUNT` příkaz](https://msdn.microsoft.com/library/ms188774.aspx) slouží k určení, kolik celkem záznamů dotaz by měl zpracovat před ukončením; [tabulky proměnných](http://www.sqlteam.com/item.asp?ItemID=9454) představují lokální proměnné jazyka T-SQL, které mohou obsahovat tabulková data akin k [dočasné tabulky](http://www.sqlteam.com/item.asp?ItemID=2029).</span><span class="sxs-lookup"><span data-stu-id="30709-187">**Using a Table Variable and `SET ROWCOUNT`** SQL Server s [`SET ROWCOUNT` statement](https://msdn.microsoft.com/library/ms188774.aspx) can be used to specify how many total records a query should process before terminating; [table variables](http://www.sqlteam.com/item.asp?ItemID=9454) are local T-SQL variables that can hold tabular data, akin to [temporary tables](http://www.sqlteam.com/item.asp?ItemID=2029).</span></span> <span data-ttu-id="30709-188">Tento postup funguje stejně dobře s Microsoft SQL Server 2005 a SQL Server 2000 (vzhledem k tomu `ROW_NUMBER()` přístup funguje pouze s SQL Server 2005).</span><span class="sxs-lookup"><span data-stu-id="30709-188">This approach works equally well with both Microsoft SQL Server 2005 and SQL Server 2000 (whereas the `ROW_NUMBER()` approach only works with SQL Server 2005).</span></span>  
  
  <span data-ttu-id="30709-189">Zde spočívá v vytvoření proměnné tabulky, který má `IDENTITY` sloupce a sloupce pro primární klíče v tabulce, jejichž data se stránkování prostřednictvím.</span><span class="sxs-lookup"><span data-stu-id="30709-189">The idea here is to create a table variable that has an `IDENTITY` column and columns for the primary keys of the table whose data is being paged through.</span></span> <span data-ttu-id="30709-190">V dalším kroku je obsah tabulky, jejichž data se stránkování prostřednictvím zálohované do proměnné tabulky, a tím přidružíte sekvenční řádek indexu (prostřednictvím `IDENTITY` sloupce) pro každý záznam v tabulce.</span><span class="sxs-lookup"><span data-stu-id="30709-190">Next, the contents of the table whose data is being paged through is dumped into the table variable, thereby associating a sequential row index (via the `IDENTITY` column) for each record in the table.</span></span> <span data-ttu-id="30709-191">Jakmile připravil proměnnou tabulky `SELECT` příkaz na proměnnou tabulky spojit s podkladové tabulce, mohou být provedeny a vytáhnout konkrétní záznamy.</span><span class="sxs-lookup"><span data-stu-id="30709-191">Once the table variable has been populated, a `SELECT` statement on the table variable, joined with the underlying table, can be executed to pull out the particular records.</span></span> <span data-ttu-id="30709-192">`SET ROWCOUNT` Prohlášení se používá k inteligentně omezit počet záznamů, které je potřeba zálohované do proměnné tabulky.</span><span class="sxs-lookup"><span data-stu-id="30709-192">The `SET ROWCOUNT` statement is used to intelligently limit the number of records that need to be dumped into the table variable.</span></span>  
  
  <span data-ttu-id="30709-193">Této efektivity přístup s je založen na číslo stránky, které jsou požadovány, jako `SET ROWCOUNT` hodnota přiřazena hodnota Start Index řádku a maximální počet řádků.</span><span class="sxs-lookup"><span data-stu-id="30709-193">This approach s efficiency is based on the page number being requested, as the `SET ROWCOUNT` value is assigned the value of Start Row Index plus the Maximum Rows.</span></span> <span data-ttu-id="30709-194">Při procházení nízkými čísly stránek, jako je například první několik stránek tento přístup je velmi efektivní.</span><span class="sxs-lookup"><span data-stu-id="30709-194">When paging through low-numbered pages such as the first few pages of data this approach is very efficient.</span></span> <span data-ttu-id="30709-195">Ale vykazuje výchozí stránkování jako výkon při načítání stránky poblíž konce.</span><span class="sxs-lookup"><span data-stu-id="30709-195">However, it exhibits default paging-like performance when retrieving a page near the end.</span></span>

<span data-ttu-id="30709-196">V tomto kurzu se implementuje pomocí vlastní stránkování `ROW_NUMBER()` – klíčové slovo.</span><span class="sxs-lookup"><span data-stu-id="30709-196">This tutorial implements custom paging using the `ROW_NUMBER()` keyword.</span></span> <span data-ttu-id="30709-197">Další informace o používání proměnnou tabulky a `SET ROWCOUNT` techniku, naleznete v tématu [další efektivní metodu pro stránkování prostřednictvím velkých sad výsledků dotazu A](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="30709-197">For more information on using the table variable and `SET ROWCOUNT` technique, see [A More Efficient Method for Paging Through Large Result Sets](http://www.4guysfromrolla.com/webtech/042606-1.shtml).</span></span>

<span data-ttu-id="30709-198">`ROW_NUMBER()` – Klíčové slovo přidružený k pořadí jednotlivých záznamů vrácených průběhu konkrétní řazení pomocí následující syntaxe:</span><span class="sxs-lookup"><span data-stu-id="30709-198">The `ROW_NUMBER()` keyword associated a ranking with each record returned over a particular ordering using the following syntax:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample3.sql)]

<span data-ttu-id="30709-199">`ROW_NUMBER()` vrátí číselnou hodnotu, která určuje pořadí pro každý záznam s ohledem na uvedené pořadí.</span><span class="sxs-lookup"><span data-stu-id="30709-199">`ROW_NUMBER()` returns a numerical value that specifies the rank for each record with regards to the indicated ordering.</span></span> <span data-ttu-id="30709-200">Například zobrazíte počet rozměrů pro jednotlivé produkty, seřazené od nejvíce nákladné nejméně, můžeme použít následující dotaz:</span><span class="sxs-lookup"><span data-stu-id="30709-200">For example, to see the rank for each product, ordered from the most expensive to the least, we could use the following query:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample4.sql)]

<span data-ttu-id="30709-201">Obrázek 5 ukazuje tento dotaz s výsledky při spuštění v okně dotazu v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="30709-201">Figure 5 shows this query s results when run through the query window in Visual Studio.</span></span> <span data-ttu-id="30709-202">Všimněte si, že produkty jsou řazeny podle cen, spolu s pořadí ceny pro každý řádek.</span><span class="sxs-lookup"><span data-stu-id="30709-202">Note that the products are ordered by price, along with a price rank for each row.</span></span>


![Cena řád je součástí pro každý záznam vrátil](efficiently-paging-through-large-amounts-of-data-cs/_static/image5.png)

<span data-ttu-id="30709-204">**Obrázek 5**: Cena řád je součástí pro každý záznam vrátil</span><span class="sxs-lookup"><span data-stu-id="30709-204">**Figure 5**: The Price Rank is Included for Each Returned Record</span></span>


> [!NOTE]
> <span data-ttu-id="30709-205">`ROW_NUMBER()` pouze jedna z mnoha nových funkcí hodnocení je k dispozici v systému SQL Server 2005.</span><span class="sxs-lookup"><span data-stu-id="30709-205">`ROW_NUMBER()` is just one of the many new ranking functions available in SQL Server 2005.</span></span> <span data-ttu-id="30709-206">Podrobnější diskuzi o `ROW_NUMBER()`, společně s další hodnocení funkce, přečtěte si [vrácení seřazených výsledků s Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span><span class="sxs-lookup"><span data-stu-id="30709-206">For a more thorough discussion of `ROW_NUMBER()`, along with the other ranking functions, read [Returning Ranked Results with Microsoft SQL Server 2005](http://www.4guysfromrolla.com/webtech/010406-1.shtml).</span></span>


<span data-ttu-id="30709-207">Při hodnocení výsledky podle zadaného `ORDER BY` sloupec v `OVER` – klauzule (`UnitPrice`, v předchozím příkladu), SQL Server musí řazení výsledků.</span><span class="sxs-lookup"><span data-stu-id="30709-207">When ranking the results by the specified `ORDER BY` column in the `OVER` clause (`UnitPrice`, in the above example), SQL Server must sort the results.</span></span> <span data-ttu-id="30709-208">To je rychlá operace v případě clusterovaného indexu přes sloupců, které jsou právě výsledky seřazené podle, nebo pokud je pokrytí indexu, ale může být dražší jinak.</span><span class="sxs-lookup"><span data-stu-id="30709-208">This is a quick operation if there is a clustered index over the column(s) the results are being ordered by, or if there is a covering index, but can be more costly otherwise.</span></span> <span data-ttu-id="30709-209">Chcete-li zvýšit výkon pro dotazy na dostatečně velký, zvažte přidání neclusterovaný index pro sloupec, podle kterého se výsledky jsou řazeny podle.</span><span class="sxs-lookup"><span data-stu-id="30709-209">To help improve performance for sufficiently large queries, consider adding a non-clustered index for the column by which the results are ordered by.</span></span> <span data-ttu-id="30709-210">Zobrazit [hodnocení funkcí a výkonu v systému SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) pro podrobnější pohled na důležité informace o výkonu.</span><span class="sxs-lookup"><span data-stu-id="30709-210">See [Ranking Functions and Performance in SQL Server 2005](http://www.sql-server-performance.com/ak_ranking_functions.asp) for a more detailed look at the performance considerations.</span></span>

<span data-ttu-id="30709-211">Hodnocení informace vrácené `ROW_NUMBER()` nelze použít přímo v `WHERE` klauzuli.</span><span class="sxs-lookup"><span data-stu-id="30709-211">The ranking information returned by `ROW_NUMBER()` cannot directly be used in the `WHERE` clause.</span></span> <span data-ttu-id="30709-212">Ale odvozené tabulky je možné vrátit `ROW_NUMBER()` výsledek, který pak může objevit v `WHERE` klauzuli.</span><span class="sxs-lookup"><span data-stu-id="30709-212">However, a derived table can be used to return the `ROW_NUMBER()` result, which can then appear in the `WHERE` clause.</span></span> <span data-ttu-id="30709-213">Například následující dotaz používá odvozené tabulky budou vráceny sloupce ProductName a UnitPrice spolu s `ROW_NUMBER()` výsledek a pak používá `WHERE` klauzule pouze vráceny produkty, jejichž cena řád je 11 až 20:</span><span class="sxs-lookup"><span data-stu-id="30709-213">For example, the following query uses a derived table to return the ProductName and UnitPrice columns, along with the `ROW_NUMBER()` result, and then uses a `WHERE` clause to only return those products whose price rank is between 11 and 20:</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample5.sql)]

<span data-ttu-id="30709-214">Tento koncept trochu další rozšíření, můžeme využít tento přístup pro načtení konkrétní stránky údaje požadované hodnoty Start Index řádku a maximální počet řádků:</span><span class="sxs-lookup"><span data-stu-id="30709-214">Extending this concept a bit further, we can utilize this approach to retrieve a specific page of data given the desired Start Row Index and Maximum Rows values:</span></span>


[!code-html[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample6.html)]

> [!NOTE]
> <span data-ttu-id="30709-215">Jak uvidíme dále v tomto kurzu *`StartRowIndex`* poskytnutých ObjectDataSource indexování od nuly, že `ROW_NUMBER()` hodnotu vrácenou příkazem SQL Server 2005 je indexováno od 1.</span><span class="sxs-lookup"><span data-stu-id="30709-215">As we will see later on in this tutorial, the *`StartRowIndex`* supplied by the ObjectDataSource is indexed starting at zero, whereas the `ROW_NUMBER()` value returned by SQL Server 2005 is indexed starting at 1.</span></span> <span data-ttu-id="30709-216">Proto `WHERE` klauzule vrátí záznamy kde `PriceRank` striktně větší než *`StartRowIndex`* a menší než nebo rovna hodnotě *`StartRowIndex`*  +  *`MaximumRows`*.</span><span class="sxs-lookup"><span data-stu-id="30709-216">Therefore, the `WHERE` clause returns those records where `PriceRank` is strictly greater than *`StartRowIndex`* and less than or equal to *`StartRowIndex`* + *`MaximumRows`*.</span></span>


<span data-ttu-id="30709-217">Nyní, který jsme probírali jak ve `ROW_NUMBER()` lze použít k načtení konkrétní stránky dat, na základě hodnot Start Index řádku a maximální počet řádků, teď musíme implementovat tuto logiku metody v knihoven BLL a DAL.</span><span class="sxs-lookup"><span data-stu-id="30709-217">Now that we ve discussed how `ROW_NUMBER()` can be used to retrieve a particular page of data given the Start Row Index and Maximum Rows values, we now need to implement this logic as methods in the DAL and BLL.</span></span>

<span data-ttu-id="30709-218">Při vytváření tohoto dotazu že musí rozhodneme řazení podle kterého se bude řazena výsledky; umožní s seřazení produktů podle jejich názvu v abecedním pořadí.</span><span class="sxs-lookup"><span data-stu-id="30709-218">When creating this query we must decide the ordering by which the results will be ranked; let s sort the products by their name in alphabetical order.</span></span> <span data-ttu-id="30709-219">To znamená, že s vlastní implementaci stránkování v tomto kurzu jsme nebude možné vytvořit vlastní stránkovanou sestavu, než se také dají řadit.</span><span class="sxs-lookup"><span data-stu-id="30709-219">This means that with the custom paging implementation in this tutorial we will not be able to create a custom paged report than can also be sorted.</span></span> <span data-ttu-id="30709-220">V dalším kurzu se ale podíváme jak tato funkce může být poskytnuta.</span><span class="sxs-lookup"><span data-stu-id="30709-220">In the next tutorial, though, we'll see how such functionality can be provided.</span></span>

<span data-ttu-id="30709-221">V předchozí části jsme vytvořili metodu DAL jako ad-hoc příkazu SQL.</span><span class="sxs-lookup"><span data-stu-id="30709-221">In the previous section we created the DAL method as an ad-hoc SQL statement.</span></span> <span data-ttu-id="30709-222">Bohužel analyzátor jazyka T-SQL v sadě Visual Studio používá t TableAdapter Průvodce kódu jako `OVER` syntaxe používané `ROW_NUMBER()` funkce.</span><span class="sxs-lookup"><span data-stu-id="30709-222">Unfortunately, the T-SQL parser in Visual Studio used by the TableAdapter wizard doesn t like the `OVER` syntax used by the `ROW_NUMBER()` function.</span></span> <span data-ttu-id="30709-223">Tato metoda DAL jsme proto musíte vytvořit jako uloženou proceduru.</span><span class="sxs-lookup"><span data-stu-id="30709-223">Therefore, we must create this DAL method as a stored procedure.</span></span> <span data-ttu-id="30709-224">V Průzkumníku serveru vyberte z nabídky Zobrazit (nebo přístupů Ctrl + Alt + S) a rozbalte `NORTHWND.MDF` uzlu.</span><span class="sxs-lookup"><span data-stu-id="30709-224">Select the Server Explorer from the View menu (or hit Ctrl+Alt+S) and expand the `NORTHWND.MDF` node.</span></span> <span data-ttu-id="30709-225">Pokud chcete přidat novou úložnou proceduru, klikněte pravým tlačítkem na uzel uložené procedury a zvolte Přidat novou uloženou proceduru (viz obrázek 6).</span><span class="sxs-lookup"><span data-stu-id="30709-225">To add a new stored procedure, right-click on the Stored Procedures node and choose Add a New Stored Procedure (see Figure 6).</span></span>


![Přidat novou úložnou proceduru pro stránkování prostřednictvím produktů](efficiently-paging-through-large-amounts-of-data-cs/_static/image6.png)

<span data-ttu-id="30709-227">**Obrázek 6**: Přidat novou úložnou proceduru pro stránkování prostřednictvím produktů</span><span class="sxs-lookup"><span data-stu-id="30709-227">**Figure 6**: Add a New Stored Procedure for Paging Through the Products</span></span>


<span data-ttu-id="30709-228">Tuto uloženou proceduru by měla přijímat dvě celočíselné vstupní parametry - `@startRowIndex` a `@maximumRows` a použít `ROW_NUMBER()` funkce seřazené podle `ProductName` pole vrací pouze řádky větší než zadaný `@startRowIndex` a menší než nebo rovno `@startRowIndex`  +  `@maximumRow` s.</span><span class="sxs-lookup"><span data-stu-id="30709-228">This stored procedure should accept two integer input parameters - `@startRowIndex` and `@maximumRows` and use the `ROW_NUMBER()` function ordered by the `ProductName` field, returning only those rows greater than the specified `@startRowIndex` and less than or equal to `@startRowIndex` + `@maximumRow` s.</span></span> <span data-ttu-id="30709-229">Zadejte následující skript do nové uložené procedury a pak klikněte na ikonu Uložit do databáze přidat uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="30709-229">Enter the following script into the new stored procedure and then click the Save icon to add the stored procedure to the database.</span></span>


[!code-sql[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample7.sql)]

<span data-ttu-id="30709-230">Po vytvoření uložené procedury, věnujte chvíli otestování. Klikněte pravým tlačítkem na `GetProductsPaged` uloženou proceduru název v Průzkumníku serveru a zvolte možnost spouštět.</span><span class="sxs-lookup"><span data-stu-id="30709-230">After creating the stored procedure, take a moment to test it out. Right-click on the `GetProductsPaged` stored procedure name in the Server Explorer and choose the Execute option.</span></span> <span data-ttu-id="30709-231">Visual Studio vás pak vyzve k zadání vstupní parametry `@startRowIndex` a `@maximumRow` s (viz obrázek 7).</span><span class="sxs-lookup"><span data-stu-id="30709-231">Visual Studio will then prompt you for the input parameters, `@startRowIndex` and `@maximumRow` s (see Figure 7).</span></span> <span data-ttu-id="30709-232">Zkuste jiné hodnoty a podívejte se na výsledky.</span><span class="sxs-lookup"><span data-stu-id="30709-232">Try different values and examine the results.</span></span>


![Zadejte hodnotu @startRowIndex a @maximumRows parametry](efficiently-paging-through-large-amounts-of-data-cs/_static/image7.png)

<span data-ttu-id="30709-234"><strong>Obrázek 7</strong>: Zadejte hodnotu @startRowIndex a @maximumRows parametry</span><span class="sxs-lookup"><span data-stu-id="30709-234"><strong>Figure 7</strong>: Enter a Value for the @startRowIndex and @maximumRows Parameters</span></span>


<span data-ttu-id="30709-235">Po výběru těchto vstupní hodnoty parametrů, v okně výstupu se zobrazí výsledky.</span><span class="sxs-lookup"><span data-stu-id="30709-235">After choosing these input parameters values, the Output window will show the results.</span></span> <span data-ttu-id="30709-236">Obrázek 8 ukazuje výsledky při předávání v 10 pro obě `@startRowIndex` a `@maximumRows` parametry.</span><span class="sxs-lookup"><span data-stu-id="30709-236">Figure 8 shows the results when passing in 10 for both the `@startRowIndex` and `@maximumRows` parameters.</span></span>


<span data-ttu-id="30709-237">[![Jsou vráceny záznamy, že by se zobrazí v druhé Data stránky](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="30709-237">[![The Records That Would Appear in the Second Page of Data are Returned](efficiently-paging-through-large-amounts-of-data-cs/_static/image9.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image8.png)</span></span>

<span data-ttu-id="30709-238">**Obrázek 8**: Záznamy, že by se zobrazí v druhé stránce Data jsou vráceny ([kliknutím ji zobrazíte obrázek v plné velikosti](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="30709-238">**Figure 8**: The Records That Would Appear in the Second Page of Data are Returned ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image10.png))</span></span>


<span data-ttu-id="30709-239">Tuto uloženou proceduru vytvořili, můžeme znovu připravený k vytvoření `ProductsTableAdapter` metody.</span><span class="sxs-lookup"><span data-stu-id="30709-239">With this stored procedure created, we re ready to create the `ProductsTableAdapter` method.</span></span> <span data-ttu-id="30709-240">Otevřít `Northwind.xsd` typová, klikněte pravým tlačítkem v `ProductsTableAdapter`a zvolte možnost přidat dotaz.</span><span class="sxs-lookup"><span data-stu-id="30709-240">Open the `Northwind.xsd` Typed DataSet, right-click in the `ProductsTableAdapter`, and choose the Add Query option.</span></span> <span data-ttu-id="30709-241">Místo vytváření dotazů pomocí příkazu SQL ad-hoc, vytvořte ho pomocí stávající úložnou proceduru.</span><span class="sxs-lookup"><span data-stu-id="30709-241">Instead of creating the query using an ad-hoc SQL statement, create it using an existing stored procedure.</span></span>


![Vytvořit metodu DAL pomocí stávající úložnou proceduru](efficiently-paging-through-large-amounts-of-data-cs/_static/image11.png)

<span data-ttu-id="30709-243">**Obrázek 9**: Vytvořit metodu DAL pomocí stávající úložnou proceduru</span><span class="sxs-lookup"><span data-stu-id="30709-243">**Figure 9**: Create the DAL Method Using an Existing Stored Procedure</span></span>


<span data-ttu-id="30709-244">Dále jsme vyzváni k výběru uloženou proceduru, která se má vyvolat.</span><span class="sxs-lookup"><span data-stu-id="30709-244">Next, we are prompted to select the stored procedure to invoke.</span></span> <span data-ttu-id="30709-245">Vyberte si `GetProductsPaged` uloženou proceduru z rozevíracího seznamu.</span><span class="sxs-lookup"><span data-stu-id="30709-245">Pick the `GetProductsPaged` stored procedure from the drop-down list.</span></span>


![Zvolte GetProductsPaged uloženou proceduru z rozevíracího seznamu](efficiently-paging-through-large-amounts-of-data-cs/_static/image12.png)

<span data-ttu-id="30709-247">**Obrázek 10**: Zvolte GetProductsPaged uloženou proceduru z rozevíracího seznamu</span><span class="sxs-lookup"><span data-stu-id="30709-247">**Figure 10**: Choose the GetProductsPaged Stored Procedure from the Drop-Down List</span></span>


<span data-ttu-id="30709-248">Na další obrazovce pak zeptá, jaký druh dat je vrácený uložená procedura: tabulková data, jedinou hodnotu nebo žádnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="30709-248">The next screen then asks you what kind of data is returned by the stored procedure: tabular data, a single value, or no value.</span></span> <span data-ttu-id="30709-249">Vzhledem k tomu, `GetProductsPaged` uložené procedury může vrátit více záznamů, označuje, že vrátí tabulková data.</span><span class="sxs-lookup"><span data-stu-id="30709-249">Since the `GetProductsPaged` stored procedure can return multiple records, indicate that it returns tabular data.</span></span>


![Označuje, že bude procedura vracet tabulková Data](efficiently-paging-through-large-amounts-of-data-cs/_static/image13.png)

<span data-ttu-id="30709-251">**Obrázek 11**: Označuje, že bude procedura vracet tabulková Data</span><span class="sxs-lookup"><span data-stu-id="30709-251">**Figure 11**: Indicate that the Stored Procedure Returns Tabular Data</span></span>


<span data-ttu-id="30709-252">Nakonec uveďte názvy metod, které chcete vytvořili.</span><span class="sxs-lookup"><span data-stu-id="30709-252">Finally, indicate the names of the methods you want to have created.</span></span> <span data-ttu-id="30709-253">Stejně jako u našich kurzů pro předchozí, pokračujte a vytvoření datové tabulky metod pomocí obou výplně a vrátit tabulku DataTable.</span><span class="sxs-lookup"><span data-stu-id="30709-253">As with our previous tutorials, go ahead and create methods using both the Fill a DataTable and Return a DataTable.</span></span> <span data-ttu-id="30709-254">Pojmenujte první metodu `FillPaged` a druhá `GetProductsPaged`.</span><span class="sxs-lookup"><span data-stu-id="30709-254">Name the first method `FillPaged` and the second `GetProductsPaged`.</span></span>


![Název metody FillPaged a GetProductsPaged](efficiently-paging-through-large-amounts-of-data-cs/_static/image14.png)

<span data-ttu-id="30709-256">**Obrázek 12**: Název metody FillPaged a GetProductsPaged</span><span class="sxs-lookup"><span data-stu-id="30709-256">**Figure 12**: Name the Methods FillPaged and GetProductsPaged</span></span>


<span data-ttu-id="30709-257">Kromě toho vytvořit vrstvy DAL metody vrátit konkrétní stránce produktů, musíme také poskytuje tyto funkce v BLL.</span><span class="sxs-lookup"><span data-stu-id="30709-257">In addition to created a DAL method to return a particular page of products, we also need to provide such functionality in the BLL.</span></span> <span data-ttu-id="30709-258">Stejná jako metoda DAL s BLL GetProductsPaged metoda dvou celé číslo vstupů pro určení Start Index řádku a maximální počet řádků, musíte přijmout a musí vracet jenom ty záznamy, které spadají do zadaného rozsahu.</span><span class="sxs-lookup"><span data-stu-id="30709-258">Like the DAL method, the BLL s GetProductsPaged method must accept two integer inputs for specifying the Start Row Index and Maximum Rows, and must return just those records that fall within the specified range.</span></span> <span data-ttu-id="30709-259">Vytvoření BLL metody ve třídě ProductsBLL pouze volání dolů do s vrstvou DAL GetProductsPaged metody, například takto:</span><span class="sxs-lookup"><span data-stu-id="30709-259">Create such a BLL method in the ProductsBLL class that merely calls down into the DAL s GetProductsPaged method, like so:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample8.cs)]

<span data-ttu-id="30709-260">Můžete použít libovolný název pro metody s BLL vstupní parametry, ale protože jsme se zobrazí po chvíli, rozhodnete použít `startRowIndex` a `maximumRows` nám ušetří speciální hodně práce při konfiguraci ObjectDataSource při použití této metody.</span><span class="sxs-lookup"><span data-stu-id="30709-260">You can use any name for the BLL method s input parameters, but, as we will see shortly, choosing to use `startRowIndex` and `maximumRows` saves us from an extra bit of work when configuring an ObjectDataSource to use this method.</span></span>

## <a name="step-4-configuring-the-objectdatasource-to-use-custom-paging"></a><span data-ttu-id="30709-261">Krok 4: Konfigurace ObjectDataSource používat vlastní stránkování</span><span class="sxs-lookup"><span data-stu-id="30709-261">Step 4: Configuring the ObjectDataSource to Use Custom Paging</span></span>

<span data-ttu-id="30709-262">U knihoven BLL a DAL metod pro konkrétní podmnožinu záznamů úplný přístup k řízení jsme znovu připravený k vytvoření GridView této stránky si její podkladové záznamy používá vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-262">With the BLL and DAL methods for accessing a particular subset of records complete, we re ready to create a GridView control that pages through its underlying records using custom paging.</span></span> <span data-ttu-id="30709-263">Začněte otevřením `EfficientPaging.aspx` stránku `PagingAndSorting` složky, přidejte na stránku GridView a nakonfigurujte ho na použití nového ovládacího prvku ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="30709-263">Start by opening the `EfficientPaging.aspx` page in the `PagingAndSorting` folder, add a GridView to the page, and configure it to use a new ObjectDataSource control.</span></span> <span data-ttu-id="30709-264">V našich kurzech posledních jsme měli často ObjectDataSource konfigurován pro použití `ProductsBLL` třída s `GetProducts` metody.</span><span class="sxs-lookup"><span data-stu-id="30709-264">In our past tutorials, we often had the ObjectDataSource configured to use the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="30709-265">Tentokrát ale chceme použít `GetProductsPaged` metoda místo toho od `GetProducts` vrátí metoda *všechny* produktů v databázi vzhledem k tomu `GetProductsPaged` vrátí jenom konkrétní podmnožinu záznamů.</span><span class="sxs-lookup"><span data-stu-id="30709-265">This time, however, we want to use the `GetProductsPaged` method instead, since the `GetProducts` method returns *all* of the products in the database whereas `GetProductsPaged` returns just a particular subset of records.</span></span>


![Konfigurace ObjectDataSource metody GetProductsPaged ProductsBLL třída s](efficiently-paging-through-large-amounts-of-data-cs/_static/image15.png)

<span data-ttu-id="30709-267">**Obrázek 13**: Konfigurace ObjectDataSource metody GetProductsPaged ProductsBLL třída s</span><span class="sxs-lookup"><span data-stu-id="30709-267">**Figure 13**: Configure the ObjectDataSource to Use the ProductsBLL Class s GetProductsPaged Method</span></span>


<span data-ttu-id="30709-268">Od jsme opětovné vytváření GridView jen pro čtení věnujte chvíli nastavit metodu rozevíracího seznamu v INSERT, UPDATE a odstranit karty na (žádný).</span><span class="sxs-lookup"><span data-stu-id="30709-268">Since we re creating a read-only GridView, take a moment to set the method drop-down list in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>

<span data-ttu-id="30709-269">V dalším kroku průvodce ObjectDataSource vyzve nám zdroje `GetProductsPaged` metody s `startRowIndex` a `maximumRows` vstupní hodnoty parametrů.</span><span class="sxs-lookup"><span data-stu-id="30709-269">Next, the ObjectDataSource wizard prompts us for the sources of the `GetProductsPaged` method s `startRowIndex` and `maximumRows` input parameters values.</span></span> <span data-ttu-id="30709-270">Tyto vstupní parametry to jednoduše ve skutečnosti nastaví v prvku GridView automaticky ponechte zdrojová sada na hodnotu None a klikněte na tlačítko Dokončit.</span><span class="sxs-lookup"><span data-stu-id="30709-270">These input parameters will actually be set by the GridView automatically, so simply leave the source set to None and click Finish.</span></span>


![Ponechte vstupní parametr zdroje jako None](efficiently-paging-through-large-amounts-of-data-cs/_static/image16.png)

<span data-ttu-id="30709-272">**Obrázek 14**: Ponechte vstupní parametr zdroje jako None</span><span class="sxs-lookup"><span data-stu-id="30709-272">**Figure 14**: Leave the Input Parameter Sources as None</span></span>


<span data-ttu-id="30709-273">Po dokončení Průvodce prvek ObjectDataSource, bude prvku GridView obsahovat vlastnost BoundField nebo třídě CheckBoxField pro každé pole data produktu.</span><span class="sxs-lookup"><span data-stu-id="30709-273">After completing the ObjectDataSource wizard, the GridView will contain a BoundField or CheckBoxField for each of the product data fields.</span></span> <span data-ttu-id="30709-274">Teď můžete přizpůsobit vzhled ovládacího prvku GridView s podle svých potřeb.</span><span class="sxs-lookup"><span data-stu-id="30709-274">Feel free to tailor the GridView s appearance as you see fit.</span></span> <span data-ttu-id="30709-275">Můžu odebrat přihlášení k zobrazení pouze `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, a `UnitPrice` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="30709-275">I ve opted to display only the `ProductName`, `CategoryName`, `SupplierName`, `QuantityPerUnit`, and `UnitPrice` BoundFields.</span></span> <span data-ttu-id="30709-276">Nakonfigurujte také GridView pro podporu stránkování zaškrtnutím políčka Povolit stránkování v jeho inteligentních značek.</span><span class="sxs-lookup"><span data-stu-id="30709-276">Also, configure the GridView to support paging by checking the Enable Paging checkbox in its smart tag.</span></span> <span data-ttu-id="30709-277">Po provedení těchto změn ovládacími prvky GridView a ObjectDataSource deklarativní by měl vypadat nějak takto:</span><span class="sxs-lookup"><span data-stu-id="30709-277">After these changes, the GridView and ObjectDataSource declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample9.aspx)]

<span data-ttu-id="30709-278">Pokud na stránce prostřednictvím prohlížeče prvku GridView. je však není odkud nalezen.</span><span class="sxs-lookup"><span data-stu-id="30709-278">If you visit the page through a browser, however, the GridView is no where to be found.</span></span>


![GridView se nezobrazuje](efficiently-paging-through-large-amounts-of-data-cs/_static/image17.png)

<span data-ttu-id="30709-280">**Obrázek 15**: GridView se nezobrazuje</span><span class="sxs-lookup"><span data-stu-id="30709-280">**Figure 15**: The GridView is Not Displayed</span></span>


<span data-ttu-id="30709-281">Protože ObjectDataSource právě používá 0 jako hodnoty pro oba prvku GridView. chybí `GetProductsPaged` `startRowIndex` a `maximumRows` vstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="30709-281">The GridView is missing because the ObjectDataSource is currently using 0 as the values for both of the `GetProductsPaged` `startRowIndex` and `maximumRows` input parameters.</span></span> <span data-ttu-id="30709-282">Proto výsledný dotaz SQL vrací žádné záznamy a proto se nezobrazí prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="30709-282">Hence, the resulting SQL query is returning no records and therefore the GridView is not displayed.</span></span>

<span data-ttu-id="30709-283">Chcete-li to napravit, musíme nakonfigurovat ObjectDataSource používat vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-283">To remedy this, we need to configure the ObjectDataSource to use custom paging.</span></span> <span data-ttu-id="30709-284">Můžete to provést v následujících krocích:</span><span class="sxs-lookup"><span data-stu-id="30709-284">This can be accomplished in the following steps:</span></span>

1. <span data-ttu-id="30709-285">**Nastavit prvek ObjectDataSource s `EnablePaging` vlastnost `true`**  tak prvek ObjectDataSource, musíte předat informaci o `SelectMethod` dva další parametry: zadat Start Index řádku ([ `StartRowIndexParameterName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)) a zadat maximální počet řádků ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span><span class="sxs-lookup"><span data-stu-id="30709-285">**Set the ObjectDataSource s `EnablePaging` property to `true`** this indicates to the ObjectDataSource that it must pass to the `SelectMethod` two additional parameters: one to specify the Start Row Index ([`StartRowIndexParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.startrowindexparametername.aspx)), and one to specify the Maximum Rows ([`MaximumRowsParameterName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.maximumrowsparametername.aspx)).</span></span>
2. <span data-ttu-id="30709-286">**Nastavit prvek ObjectDataSource s `StartRowIndexParameterName` a `MaximumRowsParameterName` vlastnosti odpovídajícím způsobem** `StartRowIndexParameterName` a `MaximumRowsParameterName` vlastnosti označit názvy vstupních parametrů předané do `SelectMethod` pro vlastní účely stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-286">**Set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` Properties Accordingly** the `StartRowIndexParameterName` and `MaximumRowsParameterName` properties indicate the names of the input parameters passed into the `SelectMethod` for custom paging purposes.</span></span> <span data-ttu-id="30709-287">Ve výchozím nastavení, jsou tyto názvy parametrů `startIndexRow` a `maximumRows`, což je důvod, proč při vytváření `GetProductsPaged` metoda v BLL, můžu použít tyto hodnoty pro vstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="30709-287">By default, these parameter names are `startIndexRow` and `maximumRows`, which is why, when creating the `GetProductsPaged` method in the BLL, I used these values for the input parameters.</span></span> <span data-ttu-id="30709-288">Pokud jste se rozhodli použít různé názvy parametrů pro BLL s `GetProductsPaged` metody, jako `startIndex` a `maxRows`pro příklad, je třeba nastavit prvku ObjectDataSource s `StartRowIndexParameterName` a `MaximumRowsParameterName` vlastnosti odpovídajícím způsobem (jako je například hodnota startIndex pro `StartRowIndexParameterName` a maxRows. pro `MaximumRowsParameterName`).</span><span class="sxs-lookup"><span data-stu-id="30709-288">If you chose to use different parameter names for the BLL s `GetProductsPaged` method such as `startIndex` and `maxRows`, for example you would need to set the ObjectDataSource s `StartRowIndexParameterName` and `MaximumRowsParameterName` properties accordingly (such as startIndex for `StartRowIndexParameterName` and maxRows for `MaximumRowsParameterName`).</span></span>
3. <span data-ttu-id="30709-289">**Nastavit prvek ObjectDataSource s [ `SelectCountMethod` vlastnost](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) název metody, která vrací celkový počet číslo sady záznamů se stránkovaného fondu přes (`TotalNumberOfProducts`)** Vzpomeňte si, že `ProductsBLL` třída s `TotalNumberOfProducts`metoda vrátí celkový počet záznamů stránkování pomocí vrstvy DAL metodu, která se spustí `SELECT COUNT(*) FROM Products` dotazu.</span><span class="sxs-lookup"><span data-stu-id="30709-289">**Set the ObjectDataSource s [`SelectCountMethod` Property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.selectcountmethod(VS.80).aspx) to the Name of the Method that Returns the Total Number of Records Being Paged Through (`TotalNumberOfProducts`)** recall that the `ProductsBLL` class s `TotalNumberOfProducts` method returns the total number of records being paged through using a DAL method that executes a `SELECT COUNT(*) FROM Products` query.</span></span> <span data-ttu-id="30709-290">Tyto informace vyžadované ObjectDataSource, aby bylo možné správně vykreslit rozhraní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-290">This information is needed by the ObjectDataSource in order to correctly render the paging interface.</span></span>
4. <span data-ttu-id="30709-291">**Odeberte `startRowIndex` a `maximumRows` `<asp:Parameter>` prvky z prvku ObjectDataSource s deklarativní** při konfiguraci ObjectDataSource prostřednictvím průvodce, Visual Studio automaticky přidá dvě `<asp:Parameter>` elementy pro `GetProductsPaged` metody s vstupní parametry.</span><span class="sxs-lookup"><span data-stu-id="30709-291">**Remove the `startRowIndex` and `maximumRows` `<asp:Parameter>` Elements from the ObjectDataSource s Declarative Markup** when configuring the ObjectDataSource through the wizard, Visual Studio automatically added two `<asp:Parameter>` elements for the `GetProductsPaged` method s input parameters.</span></span> <span data-ttu-id="30709-292">Nastavením `EnablePaging` k `true`, tyto parametry se předají automaticky, pokud se zobrazí také v deklarativní syntaxe, ObjectDataSource se pokusí o předání *čtyři* parametrů `GetProductsPaged` – metoda a dvou parametrů `TotalNumberOfProducts` metody.</span><span class="sxs-lookup"><span data-stu-id="30709-292">By setting `EnablePaging` to `true`, these parameters will be passed automatically; if they also appear in the declarative syntax, the ObjectDataSource will attempt to pass *four* parameters to the `GetProductsPaged` method and two parameters to the `TotalNumberOfProducts` method.</span></span> <span data-ttu-id="30709-293">Pokud zapomenete k jejich odebrání `<asp:Parameter>` elementy, pokud na stránce prostřednictvím prohlížeče, zobrazí se zpráva chyby jako: *Prvek ObjectDataSource "ObjectDataSource1" nenalezl neobecnou metodu 'TotalNumberOfProducts", který obsahuje parametry: startRowIndex, maximumRows*.</span><span class="sxs-lookup"><span data-stu-id="30709-293">If you forget to remove these `<asp:Parameter>` elements, when visiting the page through a browser you'll get an error message like: *ObjectDataSource 'ObjectDataSource1' could not find a non-generic method 'TotalNumberOfProducts' that has parameters: startRowIndex, maximumRows*.</span></span>

<span data-ttu-id="30709-294">Po provedení těchto změn, deklarativní syntaxe prvku ObjectDataSource s by měl vypadat nějak takto:</span><span class="sxs-lookup"><span data-stu-id="30709-294">After making these changes, the ObjectDataSource s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample10.aspx)]

<span data-ttu-id="30709-295">Všimněte si, že `EnablePaging` a `SelectCountMethod` byly nastaveny a `<asp:Parameter>` prvky byly odebrány.</span><span class="sxs-lookup"><span data-stu-id="30709-295">Note that the `EnablePaging` and `SelectCountMethod` properties have been set and the `<asp:Parameter>` elements have been removed.</span></span> <span data-ttu-id="30709-296">Obrázek 16 ukazuje snímek obrazovky okna vlastnosti po provedení těchto změn.</span><span class="sxs-lookup"><span data-stu-id="30709-296">Figure 16 shows a screen shot of the Properties window after these changes have been made.</span></span>


![Pokud chcete použít vlastní stránkování, konfigurace ovládacího prvku ObjectDataSource](efficiently-paging-through-large-amounts-of-data-cs/_static/image18.png)

<span data-ttu-id="30709-298">**Obrázek 16**: Pokud chcete použít vlastní stránkování, konfigurace ovládacího prvku ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="30709-298">**Figure 16**: To Use Custom Paging, Configure the ObjectDataSource Control</span></span>


<span data-ttu-id="30709-299">Po provedení těchto změn, navštivte tuto stránku prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="30709-299">After making these changes, visit this page through a browser.</span></span> <span data-ttu-id="30709-300">Měli byste vidět 10 produkty uvedené, seřazené podle abecedy.</span><span class="sxs-lookup"><span data-stu-id="30709-300">You should see 10 products listed, ordered alphabetically.</span></span> <span data-ttu-id="30709-301">Chcete-li si jednu stránku dat najednou chvíli trvat.</span><span class="sxs-lookup"><span data-stu-id="30709-301">Take a moment to step through the data one page at a time.</span></span> <span data-ttu-id="30709-302">Neplatí žádné rozdíly ve visual z pohledu koncového uživatele s mezi stránkování výchozí a vlastní stránkování, vlastní stránkování efektivněji stránky velkých objemů dat, jak načítat pouze ty záznamy, které je třeba má být zobrazen pro danou stránku.</span><span class="sxs-lookup"><span data-stu-id="30709-302">While there is no visual difference from the end user s perspective between default paging and custom paging, custom paging more efficiently pages through large amounts of data as it only retrieves those records that need to be displayed for a given page.</span></span>


<span data-ttu-id="30709-303">[![Data, Objednáno podle produktu s názvem, je stránkování pomocí vlastní stránkování](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="30709-303">[![The Data, Ordered by the Product s Name, is Paged Using Custom Paging](efficiently-paging-through-large-amounts-of-data-cs/_static/image20.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image19.png)</span></span>

<span data-ttu-id="30709-304">**Obrázek 17**: Data, Objednáno podle produktu s názvem, je stránkování pomocí vlastní stránkování ([kliknutím ji zobrazíte obrázek v plné velikosti](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="30709-304">**Figure 17**: The Data, Ordered by the Product s Name, is Paged Using Custom Paging ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image21.png))</span></span>


> [!NOTE]
> <span data-ttu-id="30709-305">Na stránce s vlastní stránkování, počítat hodnotu vrácenou příkazem ObjectDataSource s `SelectCountMethod` je uložena v prvku GridView s zobrazení stavu.</span><span class="sxs-lookup"><span data-stu-id="30709-305">With custom paging, the page count value returned by the ObjectDataSource�s `SelectCountMethod` is stored in the GridView�s view state.</span></span> <span data-ttu-id="30709-306">Další proměnné ovládacího prvku GridView `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` kolekce a tak dále se ukládají v *stav ovládacích prvků*, což je trvalý bez ohledu na hodnotu GridView s `EnableViewState` Vlastnost.</span><span class="sxs-lookup"><span data-stu-id="30709-306">Other GridView variables the `PageIndex`, `EditIndex`, `SelectedIndex`, `DataKeys` collection, and so on are stored in *control state*, which is persisted regardless of the value of the GridView�s `EnableViewState` property.</span></span> <span data-ttu-id="30709-307">Protože `PageCount` se ukládají hodnoty postbacků pomocí zobrazení stavu, při použití rozhraní stránkování, který zahrnuje odkaz můžete přejít na poslední stránku, je nutné povolit stav zobrazení ovládacího prvku GridView s.</span><span class="sxs-lookup"><span data-stu-id="30709-307">Since the `PageCount` value is persisted across postbacks using view state, when using a paging interface that includes a link to take you to the last page, it is imperative that the GridView�s view state be enabled.</span></span> <span data-ttu-id="30709-308">(Pokud rozhraní stránkování neobsahuje přímý odkaz na poslední stránce, pak můžete kdykoli deaktivovat stavu zobrazení.)</span><span class="sxs-lookup"><span data-stu-id="30709-308">(If your paging interface does not include a direct link to the last page, then you may disable view state.)</span></span>


<span data-ttu-id="30709-309">Kliknutím na odkaz na poslední stránku vyvolá zpětné volání a dává pokyn prvku GridView. Chcete-li aktualizovat jeho `PageIndex` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="30709-309">Clicking the last page link causes a postback and instructs the GridView to update its `PageIndex` property.</span></span> <span data-ttu-id="30709-310">Pokud dojde ke kliknutí na odkaz na poslední stránku, přiřadí prvku GridView jeho `PageIndex` vlastnost na jednu hodnotu menší než jeho `PageCount` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="30709-310">If the last page link is clicked, the GridView assigns its `PageIndex` property to a value one less than its `PageCount` property.</span></span> <span data-ttu-id="30709-311">Zobrazení stavu Zakázáno `PageCount` hodnota se ztratí mezi ostatními postbacků a `PageIndex` přiřazen maximální celočíselnou hodnotu.</span><span class="sxs-lookup"><span data-stu-id="30709-311">With view state disabled, the `PageCount` value is lost across postbacks and the `PageIndex` is assigned the maximum integer value instead.</span></span> <span data-ttu-id="30709-312">V dalším kroku prvku GridView, pokusí se zjistit počáteční index řádku tak, `PageSize` a `PageCount` vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="30709-312">Next, the GridView attempts to determine the starting row index by multiplying the `PageSize` and `PageCount` properties.</span></span> <span data-ttu-id="30709-313">Výsledkem je `OverflowException` od produktu je větší než velikost maximální povolené celé číslo.</span><span class="sxs-lookup"><span data-stu-id="30709-313">This results in an `OverflowException` since the product exceeds the maximum allowed integer size.</span></span>

## <a name="implement-custom-paging-and-sorting"></a><span data-ttu-id="30709-314">Implementujte vlastní stránkování a řazení</span><span class="sxs-lookup"><span data-stu-id="30709-314">Implement Custom Paging and Sorting</span></span>

<span data-ttu-id="30709-315">Naše aktuální vlastní implementaci stránkování vyžaduje objednávky, podle kterého je stránkování dat prostřednictvím staticky při vytváření `GetProductsPaged` uložené procedury.</span><span class="sxs-lookup"><span data-stu-id="30709-315">Our current custom paging implementation requires that the order by which the data is paged through be specified statically when creating the `GetProductsPaged` stored procedure.</span></span> <span data-ttu-id="30709-316">Můžete však pravděpodobně jste si poznamenali, že prvek GridView s inteligentním obsahuje zaškrtávací políčko Povolit řazení kromě možnost Povolit stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-316">However, you may have noted that the GridView s smart tag contains an Enable Sorting checkbox in addition to the Enable Paging option.</span></span> <span data-ttu-id="30709-317">Bohužel přidání podpory pro řazení do prvku GridView s naší aktuální vlastní implementaci stránkování bude pouze se záznamy řadily na aktuálně zobrazené stránce data.</span><span class="sxs-lookup"><span data-stu-id="30709-317">Unfortunately, adding sorting support to the GridView with our current custom paging implementation will only sort the records on the currently viewed page of data.</span></span> <span data-ttu-id="30709-318">Například pokud nakonfigurujete prvku GridView a také podporuje stránkování, při prohlížení na první stránku dat, seřaďte podle názvu produktu v sestupném pořadí, bude převraťte pořadí produktů na stránce 1.</span><span class="sxs-lookup"><span data-stu-id="30709-318">For example, if you configure the GridView to also support paging and then, when viewing the first page of data, sort by product name in descending order, it will reverse the order of the products on page 1.</span></span> <span data-ttu-id="30709-319">Jak ukazuje obrázek 18, například Carnarvon tygři zobrazuje jako první produktu při řazení ve vzestupném abecedním pořadí, které ignoruje 71 jiné produkty, které po Carnarvon tygři abecedně; jen takové záznamy na první stránce jsou považovány za v řazení.</span><span class="sxs-lookup"><span data-stu-id="30709-319">As Figure 18 shows, such shows Carnarvon Tigers as the first product when sorting in reverse alphabetical order, which ignores the 71 other products that come after Carnarvon Tigers, alphabetically; only those records on the first page are considered in the sorting.</span></span>


<span data-ttu-id="30709-320">[![Má řazení proběhnout pouze Data zobrazí na aktuální stránce.](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="30709-320">[![Only the Data Shown on the Current Page is Sorted](efficiently-paging-through-large-amounts-of-data-cs/_static/image23.png)](efficiently-paging-through-large-amounts-of-data-cs/_static/image22.png)</span></span>

<span data-ttu-id="30709-321">**Obrázek 18**: Pouze Data zobrazí na aktuální stránce má řazení proběhnout ([kliknutím ji zobrazíte obrázek v plné velikosti](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="30709-321">**Figure 18**: Only the Data Shown on the Current Page is Sorted ([Click to view full-size image](efficiently-paging-through-large-amounts-of-data-cs/_static/image24.png))</span></span>


<span data-ttu-id="30709-322">Řazení platí pouze pro aktuální stránku dat, protože řazení dochází po načetla data z knihoven BLL s `GetProductsPaged` metoda a tato metoda vrátí pouze záznamy pro konkrétní stránku.</span><span class="sxs-lookup"><span data-stu-id="30709-322">The sorting only applies to the current page of data because the sorting is occurring after the data has been retrieved from the BLL s `GetProductsPaged` method, and this method only returns those records for the specific page.</span></span> <span data-ttu-id="30709-323">K implementaci neřadí správně, musíme předat výraz řazení pro `GetProductsPaged` metoda tak, aby data lze seřadit správně před vrácením konkrétní stránky data.</span><span class="sxs-lookup"><span data-stu-id="30709-323">To implement sorting correctly, we need to pass the sort expression to the `GetProductsPaged` method so that the data can be ranked appropriately before returning the specific page of data.</span></span> <span data-ttu-id="30709-324">Uvidíme, jak to provést v následujícím kurzem.</span><span class="sxs-lookup"><span data-stu-id="30709-324">We'll see how to accomplish this in our next tutorial.</span></span>

## <a name="implementing-custom-paging-and-deleting"></a><span data-ttu-id="30709-325">Implementace vlastní stránkování a odstranění</span><span class="sxs-lookup"><span data-stu-id="30709-325">Implementing Custom Paging and Deleting</span></span>

<span data-ttu-id="30709-326">Pokud jste povolení odstraňování funkce ovládacího prvku GridView, jejichž data se stránkovaného fondu pomocí technik vlastní stránkování, zjistíte, které při odstraňování poslední záznam na poslední stránce, prvku GridView zmizí místo odpovídajícím způsobem dekrementace GridView s `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="30709-326">If you enabling deleting functionality in a GridView whose data is paged using custom paging techniques you will find that when deleting the last record from the last page, the GridView disappears rather than appropriately decrementing the GridView s `PageIndex`.</span></span> <span data-ttu-id="30709-327">Chcete-li tuto chybu reprodukovat, povolte odstranění pro tento kurz, který právě jsme právě vytvořili.</span><span class="sxs-lookup"><span data-stu-id="30709-327">To reproduce this bug, enable deleting for the tutorial just we just created.</span></span> <span data-ttu-id="30709-328">Přejdete na poslední stránku (stránka 9), kde byste měli od jsme procházení 81 produkty, 10 produkty najednou vidět jednoho produktu.</span><span class="sxs-lookup"><span data-stu-id="30709-328">Go to the last page (page 9), where you should see a single product since we are paging through 81 products, 10 products at a time.</span></span> <span data-ttu-id="30709-329">Odstraňte tento produkt.</span><span class="sxs-lookup"><span data-stu-id="30709-329">Delete this product.</span></span>

<span data-ttu-id="30709-330">Při odstraňování poslední produktu prvku GridView *by měl* automaticky přejděte na stránku osmého a tato funkce je vystavených s výchozí stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-330">Upon deleting the last product, the GridView *should* automatically go to the eighth page, and such functionality is exhibited with default paging.</span></span> <span data-ttu-id="30709-331">S vlastní stránkování, ale po odstranění posledního produktu na poslední stránce prvku GridView jednoduše dané zařízení zmizí z obrazovky úplně se vynechá.</span><span class="sxs-lookup"><span data-stu-id="30709-331">With custom paging, however, after deleting that last product on the last page, the GridView simply disappears from the screen altogether.</span></span> <span data-ttu-id="30709-332">Přesný důvod *proč* tomu, že je bit nad rámec tohoto kurzu, najdete v článku [odstranění posledního záznamu na poslední stránce z prvku GridView s vlastní stránkování](http://scottonwriting.net/sowblog/posts/7326.aspx) nízké úrovně podrobnosti jde o zdroje Tento problém.</span><span class="sxs-lookup"><span data-stu-id="30709-332">The precise reason *why* this happens is a bit beyond the scope of this tutorial; see [Deleting the Last Record on the Last Page from a GridView with Custom Paging](http://scottonwriting.net/sowblog/posts/7326.aspx) for the low-level details as to the source of this problem.</span></span> <span data-ttu-id="30709-333">Stručně řečeno ji s z důvodu následující sled kroků, které provádí prvku GridView při kliknutí na tlačítko Odstranit:</span><span class="sxs-lookup"><span data-stu-id="30709-333">In summary it s due to the following sequence of steps that are performed by the GridView when the Delete button is clicked:</span></span>

1. <span data-ttu-id="30709-334">Odstranit záznam</span><span class="sxs-lookup"><span data-stu-id="30709-334">Delete the record</span></span>
2. <span data-ttu-id="30709-335">Získat příslušné záznamy k zobrazení pro danou `PageIndex` a `PageSize`</span><span class="sxs-lookup"><span data-stu-id="30709-335">Get the appropriate records to display for the specified `PageIndex` and `PageSize`</span></span>
3. <span data-ttu-id="30709-336">Zaškrtněte, pokud chcete zajistit, aby `PageIndex` nepřekračuje počet stránek dat ve zdroji dat; pokud ji, automaticky sníží GridView s `PageIndex` vlastnost</span><span class="sxs-lookup"><span data-stu-id="30709-336">Check to ensure that the `PageIndex` does not exceed the number of pages of data in the data source; if it does, automatically decrement the GridView s `PageIndex` property</span></span>
4. <span data-ttu-id="30709-337">Svázat s příslušnou stránku dat prvku GridView pomocí záznamů, kterou jste získali v kroku 2</span><span class="sxs-lookup"><span data-stu-id="30709-337">Bind the appropriate page of data to the GridView using the records obtained in Step 2</span></span>

<span data-ttu-id="30709-338">Problém vyplývá ze skutečnosti, že v kroku 2 `PageIndex` použít, pokud kliknete na záznamy k zobrazení je stále `PageIndex` poslední stránky, jehož jediným záznam právě byl odstraněn.</span><span class="sxs-lookup"><span data-stu-id="30709-338">The problem stems from the fact that in Step 2 the `PageIndex` used when grabbing the records to display is still the `PageIndex` of the last page whose sole record was just deleted.</span></span> <span data-ttu-id="30709-339">Proto se v kroku 2 *žádné* vzhledem k tomu, že poslední stránka dat již obsahuje nějaké záznamy, vrátí se záznamy.</span><span class="sxs-lookup"><span data-stu-id="30709-339">Therefore, in Step 2, *no* records are returned since that last page of data no longer contains any records.</span></span> <span data-ttu-id="30709-340">Pak v kroku 3 prvku GridView realizuje, jeho `PageIndex` vlastnost je větší než celkový počet stránek ve zdroji dat (od jsme ve odstranit poslední záznam na poslední stránce) a sníží proto jeho `PageIndex` vlastnost.</span><span class="sxs-lookup"><span data-stu-id="30709-340">Then, in Step 3, the GridView realizes that its `PageIndex` property is greater than the total number of pages in the data source (since we ve deleted the last record in the last page) and therefore decrements its `PageIndex` property.</span></span> <span data-ttu-id="30709-341">V kroku 4 pokusí samotné připojení k datům získali v kroku 2; prvku GridView. ale v kroku 2 nebyly vráceny žádné záznamy, tedy výsledkem prázdná prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="30709-341">In Step 4 the GridView attempts to bind itself to the data retrieved in Step 2; however, in Step 2 no records were returned, therefore resulting in an empty GridView.</span></span> <span data-ttu-id="30709-342">Pomocí výchozího stránkování, tento problém není t surface protože v kroku 2 *všechny* ze zdroje dat se načítají záznamy.</span><span class="sxs-lookup"><span data-stu-id="30709-342">With default paging, this problem doesn t surface because in Step 2 *all* records are retrieved from the data source.</span></span>

<span data-ttu-id="30709-343">Chcete-li vyřešit tím, který máme k dispozici dvě možnosti.</span><span class="sxs-lookup"><span data-stu-id="30709-343">To fix this we have two options.</span></span> <span data-ttu-id="30709-344">První je vytvořit obslužnou rutinu události pro prvek GridView s `RowDeleted` obslužná rutina události, která určuje, kolik záznamů se zobrazí na stránce, který byl právě odstraněn.</span><span class="sxs-lookup"><span data-stu-id="30709-344">The first is to create an event handler for the GridView s `RowDeleted` event handler that determines how many records were displayed in the page that was just deleted.</span></span> <span data-ttu-id="30709-345">Pokud došlo jenom jeden záznam, pak záznam odstranit jenom nutné, aby byla poslední z nich a My potřebujeme se sníží GridView s `PageIndex`.</span><span class="sxs-lookup"><span data-stu-id="30709-345">If there was only one record, then the record just deleted must have been the last one and we need to decrement the GridView s `PageIndex`.</span></span> <span data-ttu-id="30709-346">Samozřejmě, chceme jenom aktualizovat `PageIndex` Pokud byla operace odstranění ve skutečnosti úspěšně, která se dají určit pomocí zajistit, aby `e.Exception` je vlastnost `null`.</span><span class="sxs-lookup"><span data-stu-id="30709-346">Of course, we only want to update the `PageIndex` if the delete operation was actually successful, which can be determined by ensuring that the `e.Exception` property is `null`.</span></span>

<span data-ttu-id="30709-347">Tento přístup funguje, protože aktualizuje `PageIndex` po kroku 1, ale před kroku 2.</span><span class="sxs-lookup"><span data-stu-id="30709-347">This approach works because it updates the `PageIndex` after Step 1 but before Step 2.</span></span> <span data-ttu-id="30709-348">V kroku 2, proto se vrátí odpovídající sadu záznamů.</span><span class="sxs-lookup"><span data-stu-id="30709-348">Therefore, in Step 2, the appropriate set of records is returned.</span></span> <span data-ttu-id="30709-349">K tomu použijte kód podobný tomuto:</span><span class="sxs-lookup"><span data-stu-id="30709-349">To accomplish this, use code like the following:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample11.cs)]

<span data-ttu-id="30709-350">Alternativní řešení je vytvořit obslužnou rutinu události pro prvek ObjectDataSource s `RowDeleted` událostí a nastavit `AffectedRows` vlastnost na hodnotu 1.</span><span class="sxs-lookup"><span data-stu-id="30709-350">An alternative workaround is to create an event handler for the ObjectDataSource s `RowDeleted` event and to set the `AffectedRows` property to a value of 1.</span></span> <span data-ttu-id="30709-351">Po odstranění záznamu v kroku 1 (ale před opětovné načtení dat v kroku 2), aktualizuje prvku GridView jeho `PageIndex` vlastnost Pokud operace vliv na jeden nebo více řádků.</span><span class="sxs-lookup"><span data-stu-id="30709-351">After deleting the record in Step 1 (but before re-retrieving the data in Step 2), the GridView updates its `PageIndex` property if one or more rows were affected by the operation.</span></span> <span data-ttu-id="30709-352">Ale `AffectedRows` vlastnost není nastavená ObjectDataSource a proto je tento krok vynechat.</span><span class="sxs-lookup"><span data-stu-id="30709-352">However, the `AffectedRows` property is not set by the ObjectDataSource and therefore this step is omitted.</span></span> <span data-ttu-id="30709-353">Jedním ze způsobů, aby tento krok provést je ručně nastavit `AffectedRows` vlastnosti, pokud se operace odstranění úspěšně dokončí.</span><span class="sxs-lookup"><span data-stu-id="30709-353">One way to have this step executed is to manually set the `AffectedRows` property if the delete operation completes successfully.</span></span> <span data-ttu-id="30709-354">Můžete to provést pomocí kódu, jako je následující:</span><span class="sxs-lookup"><span data-stu-id="30709-354">This can be accomplished using code like the following:</span></span>


[!code-csharp[Main](efficiently-paging-through-large-amounts-of-data-cs/samples/sample12.cs)]

<span data-ttu-id="30709-355">Kód pro oba tyto obslužné rutiny události najdete v třídě modelu code-behind `EfficientPaging.aspx` příklad.</span><span class="sxs-lookup"><span data-stu-id="30709-355">The code for both of these events handlers can be found in code-behind class of the `EfficientPaging.aspx` example.</span></span>

## <a name="comparing-the-performance-of-default-and-custom-paging"></a><span data-ttu-id="30709-356">Porovnání výkonu výchozí a vlastní stránkování</span><span class="sxs-lookup"><span data-stu-id="30709-356">Comparing the Performance of Default and Custom Paging</span></span>

<span data-ttu-id="30709-357">Protože vlastní stránkování pouze načte potřebné záznamy, že vrátí výchozí stránkování *všechny* záznamů pro jednotlivé stránky zobrazení, ho s vymazat, je efektivnější než výchozí stránkování vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-357">Since custom paging only retrieves the needed records, whereas default paging returns *all* of the records for each page being viewed, it s clear that custom paging is more efficient than default paging.</span></span> <span data-ttu-id="30709-358">Ale stejně jak mnohem efektivnější je vlastní stránkování?</span><span class="sxs-lookup"><span data-stu-id="30709-358">But just how much more efficient is custom paging?</span></span> <span data-ttu-id="30709-359">Jaký druh zvýšení výkonu můžete zobrazit přechodem z výchozího stránkování na vlastní stránkování?</span><span class="sxs-lookup"><span data-stu-id="30709-359">What sort of performance gains can be seen by moving from default paging to custom paging?</span></span>

<span data-ttu-id="30709-360">Bohužel neexistuje s bez velikosti, která tady všechny odpovědi.</span><span class="sxs-lookup"><span data-stu-id="30709-360">Unfortunately, there s no one size fits all answer here.</span></span> <span data-ttu-id="30709-361">Zvýšení výkonu závisí na několika faktorech, většina viditelného dvě je počet záznamů stránkování prostřednictvím a zatížení umístit do databáze serveru a komunikačních kanálů mezi webovým serverem a serverem databáze.</span><span class="sxs-lookup"><span data-stu-id="30709-361">The performance gain depends on a number of factors, the most prominent two being the number of records being paged through and the load placed on the database server and communication channels between the web server and database server.</span></span> <span data-ttu-id="30709-362">Pro malé tabulky s pár desítek záznamy může být nepatrné rozdíl ve výkonu.</span><span class="sxs-lookup"><span data-stu-id="30709-362">For small tables with just a few dozen records, the performance difference may be negligible.</span></span> <span data-ttu-id="30709-363">Pro velké tabulky s tisíci na stovky tisíc řádků, ale výkon rozdíl je čárkou nad vpravo.</span><span class="sxs-lookup"><span data-stu-id="30709-363">For large tables, with thousands to hundreds of thousands of rows, though, the performance difference is acute.</span></span>

<span data-ttu-id="30709-364">Článek min, [vlastní stránkování v technologii ASP.NET 2.0 pomocí serveru SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), obsahuje některé testy výkonnosti mám spuštěných vykazovat rozdíly ve výkonu mezi tyto dva postupy stránkování při procházení tabulky databáze s 50 000 záznamů.</span><span class="sxs-lookup"><span data-stu-id="30709-364">An article of mine, [Custom Paging in ASP.NET 2.0 with SQL Server 2005](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx), contains some performance tests I ran to exhibit the differences in performance between these two paging techniques when paging through a database table with 50,000 records.</span></span> <span data-ttu-id="30709-365">V těchto testech můžu prověřit, čas k provedení dotazu na úrovni serveru SQL Server (pomocí [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) a na stránku ASP.NET pomocí [funkce trasování s ASP.NET](https://msdn.microsoft.com/library/y13fw6we.aspx).</span><span class="sxs-lookup"><span data-stu-id="30709-365">In these tests I examined both the time to execute the query at the SQL Server level (using [SQL Profiler](https://msdn.microsoft.com/library/ms173757.aspx)) and at the ASP.NET page using [ASP.NET s tracing features](https://msdn.microsoft.com/library/y13fw6we.aspx).</span></span> <span data-ttu-id="30709-366">Mějte na paměti, že tyto testy byly spuštěny na můj vývoj pole s jedním aktivním uživatelem a proto jsou unscientific a ne napodobují vzorů zatížení typické webu.</span><span class="sxs-lookup"><span data-stu-id="30709-366">Keep in mind that these tests were run on my development box with a single active user, and therefore are unscientific and do not mimic typical website load patterns.</span></span> <span data-ttu-id="30709-367">Bez ohledu na to výsledky ukazují relativní rozdíly v čase spuštění pro výchozí a vlastní stránkování při práci s dostatečně velké objemy dat.</span><span class="sxs-lookup"><span data-stu-id="30709-367">Regardless, the results illustrate the relative differences in execution time for default and custom paging when working with sufficiently large amounts of data.</span></span>


|  | <span data-ttu-id="30709-368">**Střední Doba trvání (s)**</span><span class="sxs-lookup"><span data-stu-id="30709-368">**Avg. Duration (sec)**</span></span> | <span data-ttu-id="30709-369">**Operace čtení**</span><span class="sxs-lookup"><span data-stu-id="30709-369">**Reads**</span></span> |
| --- | --- | --- |
| <span data-ttu-id="30709-370">**Výchozí stránkování SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="30709-370">**Default Paging SQL Profiler**</span></span> | <span data-ttu-id="30709-371">1.411</span><span class="sxs-lookup"><span data-stu-id="30709-371">1.411</span></span> | <span data-ttu-id="30709-372">383</span><span class="sxs-lookup"><span data-stu-id="30709-372">383</span></span> |
| <span data-ttu-id="30709-373">**Vlastní stránkování SQL Profiler**</span><span class="sxs-lookup"><span data-stu-id="30709-373">**Custom Paging SQL Profiler**</span></span> | <span data-ttu-id="30709-374">0.002</span><span class="sxs-lookup"><span data-stu-id="30709-374">0.002</span></span> | <span data-ttu-id="30709-375">29</span><span class="sxs-lookup"><span data-stu-id="30709-375">29</span></span> |
| <span data-ttu-id="30709-376">**Výchozí trasování procesu ASP.NET stránkování**</span><span class="sxs-lookup"><span data-stu-id="30709-376">**Default Paging ASP.NET Trace**</span></span> | <span data-ttu-id="30709-377">2.379</span><span class="sxs-lookup"><span data-stu-id="30709-377">2.379</span></span> | <span data-ttu-id="30709-378">*NENÍ K DISPOZICI*</span><span class="sxs-lookup"><span data-stu-id="30709-378">*N/A*</span></span> |
| <span data-ttu-id="30709-379">**Vlastní stránkování ASP.NET trasování**</span><span class="sxs-lookup"><span data-stu-id="30709-379">**Custom Paging ASP.NET Trace**</span></span> | <span data-ttu-id="30709-380">0.029</span><span class="sxs-lookup"><span data-stu-id="30709-380">0.029</span></span> | <span data-ttu-id="30709-381">*NENÍ K DISPOZICI*</span><span class="sxs-lookup"><span data-stu-id="30709-381">*N/A*</span></span> |


<span data-ttu-id="30709-382">Jak je vidět, načtení konkrétní stránky dat vyžaduje 354 méně čtení v průměru a za zlomek času dokončení.</span><span class="sxs-lookup"><span data-stu-id="30709-382">As you can see, retrieving a particular page of data required 354 less reads on average and completed in a fraction of the time.</span></span> <span data-ttu-id="30709-383">Na stránce technologie ASP.NET, vlastní stránka byla schopna vykreslit v blízkosti 1/100<sup>th</sup> dobu, jakou trvalo při použití výchozího stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-383">At the ASP.NET page, custom the page was able to render in close to 1/100<sup>th</sup> of the time it took when using default paging.</span></span> <span data-ttu-id="30709-384">Zobrazit [Moje článku](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) Další informace o těchto výsledků spolu s kódem a databázi, která si můžete stáhnout pro reprodukci tyto testy ve vlastním prostředí.</span><span class="sxs-lookup"><span data-stu-id="30709-384">See [my article](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx) for more information on these results along with code and a database you can download to reproduce these tests in your own environment.</span></span>

## <a name="summary"></a><span data-ttu-id="30709-385">Souhrn</span><span class="sxs-lookup"><span data-stu-id="30709-385">Summary</span></span>

<span data-ttu-id="30709-386">Výchozí stránkování je velmi snadno implementovat pouze kontrola políčko Povolit stránkování v data webového ovládacího prvku s inteligentní značky, ale takové zjednodušení spočívá za cenu výkonu.</span><span class="sxs-lookup"><span data-stu-id="30709-386">Default paging is a cinch to implement just check the Enable Paging checkbox in the data Web control s smart tag but such simplicity comes at the cost of performance.</span></span> <span data-ttu-id="30709-387">Pomocí výchozího stránkování, když si uživatel vyžádá libovolnou stránku dat *všechny* záznamy se vrátí, i když se může zobrazit jenom zlomek je.</span><span class="sxs-lookup"><span data-stu-id="30709-387">With default paging, when a user requests any page of data *all* records are returned, even though only a tiny fraction of them may be shown.</span></span> <span data-ttu-id="30709-388">K boji proti takové nároky na výkon, nabízí ObjectDataSource alternativní stránkování možnost vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-388">To combat this performance overhead, the ObjectDataSource offers an alternative paging option custom paging.</span></span>

<span data-ttu-id="30709-389">Při vlastní stránkování dále to vylepšuje výchozí stránkování problémy s výkonem s načtením jen takové záznamy, které je třeba zobrazit, ho s více potřebný k implementaci vlastní stránkování.</span><span class="sxs-lookup"><span data-stu-id="30709-389">While custom paging improves upon default paging s performance issues by retrieving only those records that need to be displayed, it s more involved to implement custom paging.</span></span> <span data-ttu-id="30709-390">Dotaz musí být nejprve napsané, že, který správně (a efektivně) má přístup k určitou podmnožinu záznamů požadované.</span><span class="sxs-lookup"><span data-stu-id="30709-390">First, a query must be written that correctly (and efficiently) accesses the specific subset of records requested.</span></span> <span data-ttu-id="30709-391">To lze provést různými způsoby; Ten jsme se zaměřili na v tomto kurzu, je použít SQL Server 2005 s novou `ROW_NUMBER()` funkce pro řazení výsledků a pak vrátit pouze ty výsledky jehož pořadí spadají do zadaného rozsahu.</span><span class="sxs-lookup"><span data-stu-id="30709-391">This can be accomplished in a number of ways; the one we examined in this tutorial is to use SQL Server 2005 s new `ROW_NUMBER()` function to rank results, and then to return just those results whose ranking falls within a specified range.</span></span> <span data-ttu-id="30709-392">Kromě toho potřebujeme přidat prostředky, chcete-li zjistit celkový počet záznamů stránkování prostřednictvím.</span><span class="sxs-lookup"><span data-stu-id="30709-392">Furthermore, we need to add a means to determine the total number of records being paged through.</span></span> <span data-ttu-id="30709-393">Po vytvoření tyto vrstvy DAL a BLL metody, musíme také nakonfigurovat ObjectDataSource tak, aby můžete určit, kolik celkem záznamů jsou stránkování prostřednictvím a správně můžete předat hodnoty Start Index řádku a maximální počet řádků BLL.</span><span class="sxs-lookup"><span data-stu-id="30709-393">After creating these DAL and BLL methods, we also need to configure the ObjectDataSource so that it can determine how many total records are being paged through and can correctly pass the Start Row Index and Maximum Rows values to the BLL.</span></span>

<span data-ttu-id="30709-394">Při provádění vlastní stránkování vyžaduje několik kroků a není téměř stejně jednoduché jako výchozího stránkování, vlastní stránkování je nezbytné v případě procházení dostatečně velké objemy dat po stránkách.</span><span class="sxs-lookup"><span data-stu-id="30709-394">While implementing custom paging does require a number of steps and is not nearly as simple as default paging, custom paging is a necessity when paging through sufficiently large amounts of data.</span></span> <span data-ttu-id="30709-395">Jak prozkoumat výsledky ukázala, že, vlastní stránkování můžete zbavit sekund z doba vykreslování stránek ASP.NET a jedné nebo více řádů zesvětlit zatížení na serveru databáze.</span><span class="sxs-lookup"><span data-stu-id="30709-395">As the results examined showed, custom paging can shed seconds off of the ASP.NET page render time and can lighten the load on the database server by one ore more orders of magnitude.</span></span>

<span data-ttu-id="30709-396">Všechno nejlepší programování!</span><span class="sxs-lookup"><span data-stu-id="30709-396">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="30709-397">O autorovi</span><span class="sxs-lookup"><span data-stu-id="30709-397">About the Author</span></span>

<span data-ttu-id="30709-398">[Scott Meisnerová](http://www.4guysfromrolla.com/ScottMitchell.shtml), Autor sedm ASP/ASP.NET knih a Zakladatel [4GuysFromRolla.com](http://www.4guysfromrolla.com), má práce s Microsoft webových technologiích od roku 1998.</span><span class="sxs-lookup"><span data-stu-id="30709-398">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="30709-399">Scott funguje jako nezávislý konzultant, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="30709-399">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="30709-400">Jeho nejnovější knihy [ *Edice nakladatelství Sams naučit sami ASP.NET 2.0 za 24 hodin*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="30709-400">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="30709-401">Může být dosáhl v [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="30709-401">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="30709-402">nebo prostřednictvím jeho blogu, který lze nalézt v [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="30709-402">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="30709-403">[Předchozí](paging-and-sorting-report-data-cs.md)
> [další](sorting-custom-paged-data-cs.md)</span><span class="sxs-lookup"><span data-stu-id="30709-403">[Previous](paging-and-sorting-report-data-cs.md)
[Next](sorting-custom-paged-data-cs.md)</span></span>
