---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: 'Použití Entity Framework 4,0 a ovládacího prvku ObjectDataSource, část 1: Začínáme | Microsoft Docs'
author: tdykstra
description: Tato řada kurzů se sestavuje na webové aplikaci Contoso University, která je vytvořená Začínáme pomocí řady Entity Framework kurzů. Pokud jo...
ms.author: riande
ms.date: 01/26/2011
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 2f14707eb058d438495dd2bc4c17b976c471fc97
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78547290"
---
# <a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="b8173-104">Použití Entity Framework 4,0 a ovládacího prvku ObjectDataSource, část 1: Začínáme</span><span class="sxs-lookup"><span data-stu-id="b8173-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>

<span data-ttu-id="b8173-105">tím, že [Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="b8173-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="b8173-106">Tato řada kurzů se sestavuje na webové aplikaci Contoso University, která je vytvořená [Začínáme pomocí řady kurzů Entity Framework 4,0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="b8173-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="b8173-107">Pokud jste nedokončili předchozí kurzy, jako výchozí bod tohoto kurzu si můžete aplikaci, kterou jste vytvořili, [Stáhnout](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) .</span><span class="sxs-lookup"><span data-stu-id="b8173-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="b8173-108">Můžete si také [Stáhnout aplikaci](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) , která je vytvořená úplnou řadou kurzů.</span><span class="sxs-lookup"><span data-stu-id="b8173-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="b8173-109">Ukázková webová aplikace společnosti Contoso University ukazuje, jak pomocí Entity Framework 4,0 a sady Visual Studio 2010 vytvářet aplikace webových formulářů ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="b8173-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="b8173-110">Ukázková aplikace je web pro fiktivní univerzitě společnosti Contoso.</span><span class="sxs-lookup"><span data-stu-id="b8173-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="b8173-111">Zahrnuje funkce, jako student přijetí, kurz vytvoření a přiřazení instruktorem.</span><span class="sxs-lookup"><span data-stu-id="b8173-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="b8173-112">V tomto kurzu se zobrazí C#příklady v.</span><span class="sxs-lookup"><span data-stu-id="b8173-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="b8173-113">[Ukázka ke stažení](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) obsahuje kód v obou C# i Visual Basic.</span><span class="sxs-lookup"><span data-stu-id="b8173-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="b8173-114">Database First</span><span class="sxs-lookup"><span data-stu-id="b8173-114">Database First</span></span>
> 
> <span data-ttu-id="b8173-115">Existují tři způsoby, jak můžete pracovat s daty v Entity Framework: *Database First*, *model First*a *Code First*.</span><span class="sxs-lookup"><span data-stu-id="b8173-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="b8173-116">Tento kurz je určen pro Database First.</span><span class="sxs-lookup"><span data-stu-id="b8173-116">This tutorial is for Database First.</span></span> <span data-ttu-id="b8173-117">Informace o rozdílech mezi těmito pracovními postupy a pokyny pro výběr nejvhodnějšího řešení pro váš scénář najdete v tématu [Entity Framework vývojové pracovní postupy](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span><span class="sxs-lookup"><span data-stu-id="b8173-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="b8173-118">Webové formuláře</span><span class="sxs-lookup"><span data-stu-id="b8173-118">Web Forms</span></span>
> 
> <span data-ttu-id="b8173-119">Podobně jako u Začínáme řady používá tento kurz model webových formulářů ASP.NET a předpokládá, že víte, jak pracovat s webovými formuláři ASP.NET v sadě Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b8173-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="b8173-120">Pokud to neuděláte, přečtěte si téma [Začínáme s webovými formuláři ASP.NET 4,5](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span><span class="sxs-lookup"><span data-stu-id="b8173-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="b8173-121">Pokud dáváte přednost práci s architekturou ASP.NET MVC, přečtěte si téma [Začínáme s Entity Framework pomocí ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="b8173-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="b8173-122">Verze softwaru</span><span class="sxs-lookup"><span data-stu-id="b8173-122">Software versions</span></span>
> 
> | <span data-ttu-id="b8173-123">**Zobrazuje se v tomto kurzu.**</span><span class="sxs-lookup"><span data-stu-id="b8173-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="b8173-124">**Funguje taky s**</span><span class="sxs-lookup"><span data-stu-id="b8173-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="b8173-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="b8173-125">Windows 7</span></span> | <span data-ttu-id="b8173-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="b8173-126">Windows 8</span></span> |
> | <span data-ttu-id="b8173-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="b8173-127">Visual Studio 2010</span></span> | <span data-ttu-id="b8173-128">Visual Studio 2010 Express for Web.</span><span class="sxs-lookup"><span data-stu-id="b8173-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="b8173-129">Kurz nebyl testován s novějšími verzemi sady Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="b8173-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="b8173-130">Výběry nabídek, dialogová okna a šablony obsahují mnoho rozdílů.</span><span class="sxs-lookup"><span data-stu-id="b8173-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="b8173-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="b8173-131">.NET 4</span></span> | <span data-ttu-id="b8173-132">.NET 4,5 je zpětně kompatibilní s .NET 4, ale kurz nebyl testován pomocí .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="b8173-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="b8173-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="b8173-133">Entity Framework 4</span></span> | <span data-ttu-id="b8173-134">Kurz nebyl testován s novějšími verzemi Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b8173-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="b8173-135">Počínaje Entity Framework 5, EF používá ve výchozím nastavení `DbContext API` zavedené pomocí EF 4,1.</span><span class="sxs-lookup"><span data-stu-id="b8173-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="b8173-136">Ovládací prvek EntityDataSource byl navržený tak, aby používal rozhraní `ObjectContext` API.</span><span class="sxs-lookup"><span data-stu-id="b8173-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="b8173-137">Informace o tom, jak používat ovládací prvek EntityDataSource s rozhraním `DbContext` API, najdete v [tomto blogovém příspěvku](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span><span class="sxs-lookup"><span data-stu-id="b8173-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="b8173-138">Otázky</span><span class="sxs-lookup"><span data-stu-id="b8173-138">Questions</span></span>
> 
> <span data-ttu-id="b8173-139">Pokud máte dotazy, které přímo nesouvisejí s kurzem, můžete je publikovat do [fóra ASP.NET Entity Framework](https://forums.asp.net/1227.aspx), [Entity Framework a LINQ to Entities fóra](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/)nebo [StackOverflow.com](http://stackoverflow.com/).</span><span class="sxs-lookup"><span data-stu-id="b8173-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>

<span data-ttu-id="b8173-140">Ovládací prvek `EntityDataSource` umožňuje vytvořit aplikaci velmi rychle, ale obvykle vyžaduje, abyste zachovali významnou velikost obchodní logiky a logiky přístupu k datům na stránkách *aspx* .</span><span class="sxs-lookup"><span data-stu-id="b8173-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="b8173-141">Pokud očekáváte, že vaše aplikace bude v složitosti složitá a bude vyžadovat trvalou údržbu, můžete ještě víc zvýšit dobu vývoje, abyste mohli vytvořit *n-vrstvou* nebo *vrstvenou* strukturu aplikace, kterou je víc udržovatelnější.</span><span class="sxs-lookup"><span data-stu-id="b8173-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="b8173-142">Pro implementaci této architektury oddělíte prezentační vrstvu od vrstvy obchodní logiky (knihoven BLL) a vrstvy přístupu k datům (DAL).</span><span class="sxs-lookup"><span data-stu-id="b8173-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="b8173-143">Jedním ze způsobů implementace této struktury je použití ovládacího prvku `ObjectDataSource` místo ovládacího prvku `EntityDataSource`.</span><span class="sxs-lookup"><span data-stu-id="b8173-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="b8173-144">Při použití ovládacího prvku `ObjectDataSource` implementujete vlastní kód pro přístup k datům a potom jej vyvoláte na stránkách *aspx* pomocí ovládacího prvku, který má mnoho stejných funkcí jako jiné ovládací prvky zdroje dat.</span><span class="sxs-lookup"><span data-stu-id="b8173-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="b8173-145">To vám umožní kombinovat výhody n-vrstvého přístupu s výhodami použití ovládacího prvku webové formuláře pro přístup k datům.</span><span class="sxs-lookup"><span data-stu-id="b8173-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="b8173-146">Ovládací prvek `ObjectDataSource` poskytuje větší flexibilitu i jiným způsobem.</span><span class="sxs-lookup"><span data-stu-id="b8173-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="b8173-147">Vzhledem k tomu, že píšete vlastní kód pro přístup k datům, je snazší provádět více než jen číst, vkládat, aktualizovat nebo odstraňovat konkrétní typ entity, což jsou úkoly, které je navržený `EntityDataSource` ovládací prvek.</span><span class="sxs-lookup"><span data-stu-id="b8173-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="b8173-148">Můžete například provést protokolování při každé aktualizaci entity, archivovat data při každém odstranění entity nebo automaticky kontrolovat a aktualizovat související data při vložení řádku s hodnotou cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="b8173-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="b8173-149">Obchodní logika a třídy úložiště</span><span class="sxs-lookup"><span data-stu-id="b8173-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="b8173-150">Ovládací prvek `ObjectDataSource` funguje vyvoláním třídy, kterou vytvoříte.</span><span class="sxs-lookup"><span data-stu-id="b8173-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="b8173-151">Třída obsahuje metody, které načítají a aktualizují data, a poskytuje názvy těchto metod ovládacímu prvku `ObjectDataSource` v kódu.</span><span class="sxs-lookup"><span data-stu-id="b8173-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="b8173-152">Při vykreslování nebo zpracování zpětného odeslání `ObjectDataSource` volá metody, které jste zadali.</span><span class="sxs-lookup"><span data-stu-id="b8173-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="b8173-153">Kromě základních operací CRUD může třída, kterou vytvoříte pro použití s ovládacím prvkem `ObjectDataSource`, potřebovat spustit obchodní logiku, když `ObjectDataSource` čte nebo aktualizuje data.</span><span class="sxs-lookup"><span data-stu-id="b8173-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="b8173-154">Když například aktualizujete oddělení, možná budete muset ověřit, že žádní jiná oddělení nemají stejného správce, protože jedna osoba nemůže být správcem více než jednoho oddělení.</span><span class="sxs-lookup"><span data-stu-id="b8173-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="b8173-155">V některé dokumentaci `ObjectDataSource`, jako je například [Přehled třídy ObjectDataSource](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), ovládací prvek volá třídu, která je označována jako *obchodní objekt* , který obsahuje obchodní logiku a logiku přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="b8173-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="b8173-156">V tomto kurzu vytvoříte samostatné třídy pro obchodní logiku a datovou logiku pro přístup k datům.</span><span class="sxs-lookup"><span data-stu-id="b8173-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="b8173-157">Třída, která zapouzdřuje logiku přístupu k datům, se nazývá *úložiště*.</span><span class="sxs-lookup"><span data-stu-id="b8173-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="b8173-158">Třída obchodní logiky zahrnuje metody obchodní logiky i metody přístupu k datům, ale metody přístupu k datům volají úložiště k provádění úloh přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="b8173-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="b8173-159">Vytvoříte také abstrakci vrstvy mezi knihoven BLL a DAL, která usnadňuje automatizované testování částí knihoven BLL.</span><span class="sxs-lookup"><span data-stu-id="b8173-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="b8173-160">Tato abstraktní vrstva je implementována vytvořením rozhraní a použitím rozhraní při vytváření instance úložiště ve třídě Business-Logic.</span><span class="sxs-lookup"><span data-stu-id="b8173-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="b8173-161">Díky tomu je možné poskytnout třídu Business-Logic s odkazem na libovolný objekt, který implementuje rozhraní úložiště.</span><span class="sxs-lookup"><span data-stu-id="b8173-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="b8173-162">Pro běžný provoz zadáte objekt úložiště, který pracuje s Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b8173-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="b8173-163">Pro účely testování poskytnete objekt úložiště, který pracuje s daty uloženými způsobem, který lze snadno manipulovat, například proměnné třídy definované jako kolekce.</span><span class="sxs-lookup"><span data-stu-id="b8173-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="b8173-164">Následující ilustrace znázorňuje rozdíl mezi třídou obchodní logiky, která zahrnuje logiku přístupu k datům bez úložiště a jednoho, který používá úložiště.</span><span class="sxs-lookup"><span data-stu-id="b8173-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="b8173-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="b8173-166">Začnete vytvořením webových stránek, ve kterých je ovládací prvek `ObjectDataSource` vázaný přímo na úložiště, protože provádí pouze základní úlohy přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="b8173-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="b8173-167">V dalším kurzu vytvoříte třídu obchodní logiky s logikou ověřování a navážete ovládací prvek `ObjectDataSource` na tuto třídu místo na třídu úložiště.</span><span class="sxs-lookup"><span data-stu-id="b8173-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="b8173-168">Budete také vytvářet testy jednotek pro logiku ověřování.</span><span class="sxs-lookup"><span data-stu-id="b8173-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="b8173-169">V třetím kurzu v této sérii přidáte funkce řazení a filtrování do aplikace.</span><span class="sxs-lookup"><span data-stu-id="b8173-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="b8173-170">Stránky, které v tomto kurzu vytvoříte, pracují s `Departments` sadou entit datového modelu, kterou jste vytvořili v [Začínáme řadě kurzů](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span><span class="sxs-lookup"><span data-stu-id="b8173-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="b8173-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="b8173-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="b8173-173">Aktualizace databáze a datového modelu</span><span class="sxs-lookup"><span data-stu-id="b8173-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="b8173-174">Tento kurz začnete tím, že v databázi provedete dvě změny, které vyžadují odpovídající změny v datovém modelu, který jste vytvořili v [Začínáme pomocí výukových kurzů Entity Framework a webových formulářů](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) .</span><span class="sxs-lookup"><span data-stu-id="b8173-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="b8173-175">V jednom z těchto kurzů jste ručně provedli změny v návrháři, aby se datový model synchronizoval s databází po změně databáze.</span><span class="sxs-lookup"><span data-stu-id="b8173-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="b8173-176">V tomto kurzu použijete **model aktualizace návrháře z databázového** nástroje k automatické aktualizaci datového modelu.</span><span class="sxs-lookup"><span data-stu-id="b8173-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="b8173-177">Přidání vztahu k databázi</span><span class="sxs-lookup"><span data-stu-id="b8173-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="b8173-178">V sadě Visual Studio otevřete webovou aplikaci Contoso University, kterou jste vytvořili v [Začínáme, pomocí řady kurzů Entity Framework a webové formuláře](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) a pak otevřete databázové diagramy `SchoolDiagram`.</span><span class="sxs-lookup"><span data-stu-id="b8173-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="b8173-179">Pokud se podíváte na `Department` tabulku v databázovém diagramu, uvidíte, že má sloupec `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="b8173-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="b8173-180">Tento sloupec je cizí klíč k tabulce `Person`, ale v databázi není definovaná žádná relace cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="b8173-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="b8173-181">Je nutné vytvořit relaci a aktualizovat datový model tak, aby Entity Framework mohl tento vztah automaticky zpracovat.</span><span class="sxs-lookup"><span data-stu-id="b8173-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="b8173-182">V databázovém diagramu klikněte pravým tlačítkem na tabulku `Department` a vyberte možnost **relace**.</span><span class="sxs-lookup"><span data-stu-id="b8173-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="b8173-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="b8173-184">V poli **relace cizího klíče** klikněte na **Přidat**a potom klikněte na tři tečky pro **specifikace tabulek a sloupců**.</span><span class="sxs-lookup"><span data-stu-id="b8173-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="b8173-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="b8173-186">V dialogovém okně **tabulky a sloupce** nastavte tabulku primárních klíčů a pole tak, aby `Person` a `PersonID`, a nastavte tabulku a pole cizího klíče na `Department` a `Administrator`.</span><span class="sxs-lookup"><span data-stu-id="b8173-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="b8173-187">(Když to uděláte, název vztahu se změní z `FK_Department_Department` na `FK_Department_Person`.)</span><span class="sxs-lookup"><span data-stu-id="b8173-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="b8173-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="b8173-189">Klikněte na **OK** v poli **tabulky a sloupce** , v poli **relace cizího klíče** klikněte na **Zavřít** a změny uložte.</span><span class="sxs-lookup"><span data-stu-id="b8173-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="b8173-190">Pokud se zobrazí dotaz, zda chcete uložit `Person` a `Department` tabulky, klikněte na tlačítko **Ano**.</span><span class="sxs-lookup"><span data-stu-id="b8173-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="b8173-191">Pokud jste odstranili `Person` řádky, které odpovídají datům, která jsou již ve sloupci `Administrator`, nebudete moci tuto změnu uložit.</span><span class="sxs-lookup"><span data-stu-id="b8173-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="b8173-192">V takovém případě použijte Editor tabulek v **Průzkumník serveru** k ujištění, že hodnota `Administrator` v každém `Department` řádku obsahuje ID záznamu, který ve skutečnosti existuje v tabulce `Person`.</span><span class="sxs-lookup"><span data-stu-id="b8173-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="b8173-193">Po uložení změny nebudete moci odstranit řádek z `Person` tabulky, pokud je tato osoba správcem oddělení.</span><span class="sxs-lookup"><span data-stu-id="b8173-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="b8173-194">V produkční aplikaci byste zadali konkrétní chybovou zprávu, když omezení databáze brání odstranění, nebo byste zadali kaskádové odstranění.</span><span class="sxs-lookup"><span data-stu-id="b8173-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="b8173-195">Příklad způsobu určení kaskádového odstranění naleznete v [části Entity Framework a ASP.NET – Začínáme část 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span><span class="sxs-lookup"><span data-stu-id="b8173-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>

### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="b8173-196">Přidání zobrazení do databáze</span><span class="sxs-lookup"><span data-stu-id="b8173-196">Adding a View to the Database</span></span>

<span data-ttu-id="b8173-197">Na stránce Nová *oddělení. aspx* , kterou budete vytvářet, chcete zadat rozevírací seznam instruktorů s názvy ve formátu "poslední, první", aby uživatelé mohli vybrat správce oddělení.</span><span class="sxs-lookup"><span data-stu-id="b8173-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="b8173-198">Abyste to usnadnili, vytvoříte zobrazení v databázi.</span><span class="sxs-lookup"><span data-stu-id="b8173-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="b8173-199">Zobrazení bude obsahovat pouze data potřebná v rozevíracím seznamu: úplný název (správně formátovaný) a klíč záznamu.</span><span class="sxs-lookup"><span data-stu-id="b8173-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="b8173-200">V **Průzkumník serveru**rozbalte *School. mdf*, klikněte pravým tlačítkem na složku **zobrazení** a vyberte **Přidat nové zobrazení**.</span><span class="sxs-lookup"><span data-stu-id="b8173-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="b8173-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="b8173-202">Po zobrazení dialogového okna **Přidat tabulku** klikněte na **Zavřít** a vložte následující příkaz SQL do podokna SQL:</span><span class="sxs-lookup"><span data-stu-id="b8173-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="b8173-203">Uložte zobrazení jako `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="b8173-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="b8173-204">Aktualizace datového modelu</span><span class="sxs-lookup"><span data-stu-id="b8173-204">Updating the Data Model</span></span>

<span data-ttu-id="b8173-205">Ve složce *dal* otevřete soubor *SchoolModel. edmx* , klikněte pravým tlačítkem myši na plochu návrhu a vyberte **aktualizovat model z databáze**.</span><span class="sxs-lookup"><span data-stu-id="b8173-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="b8173-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="b8173-207">V dialogovém okně **Zvolte objekty databáze** vyberte kartu **Přidat** a vyberte zobrazení, které jste právě vytvořili.</span><span class="sxs-lookup"><span data-stu-id="b8173-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="b8173-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="b8173-209">Klikněte na **Finish** (Dokončit).</span><span class="sxs-lookup"><span data-stu-id="b8173-209">Click **Finish**.</span></span>

<span data-ttu-id="b8173-210">V Návrháři vidíte, že nástroj vytvořil `vInstructorName` entitu a nové přidružení mezi entitami `Department` a `Person`.</span><span class="sxs-lookup"><span data-stu-id="b8173-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="b8173-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="b8173-212">Ve **výstupu** a **Seznam chyb** Windows se může zobrazit zpráva upozorňující na to, že nástroj automaticky vytvořil primární klíč pro nové zobrazení `vInstructorName`.</span><span class="sxs-lookup"><span data-stu-id="b8173-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="b8173-213">Toto je očekávané chování.</span><span class="sxs-lookup"><span data-stu-id="b8173-213">This is expected behavior.</span></span>

<span data-ttu-id="b8173-214">Když odkazujete na novou entitu `vInstructorName` v kódu, nechcete použít konvenci databáze pro předponu s malým písmenem "v".</span><span class="sxs-lookup"><span data-stu-id="b8173-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="b8173-215">Proto přejmenujete entitu a sadu entit v modelu.</span><span class="sxs-lookup"><span data-stu-id="b8173-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="b8173-216">Otevřete **prohlížeč modelů**.</span><span class="sxs-lookup"><span data-stu-id="b8173-216">Open the **Model Browser**.</span></span> <span data-ttu-id="b8173-217">V seznamu se zobrazí `vInstructorName` jako typ entity a zobrazení.</span><span class="sxs-lookup"><span data-stu-id="b8173-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="b8173-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="b8173-219">V části **SchoolModel** (ne **SchoolModel. Store**) klikněte pravým tlačítkem myši na **vInstructorName** a vyberte **vlastnosti**.</span><span class="sxs-lookup"><span data-stu-id="b8173-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="b8173-220">V okně **vlastnosti** změňte vlastnost název na **název** "Instructor" a změňte vlastnost **název sady entit** na hodnotu "InstructorNames".</span><span class="sxs-lookup"><span data-stu-id="b8173-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="b8173-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="b8173-222">Uložte a zavřete datový model a pak znovu sestavte projekt.</span><span class="sxs-lookup"><span data-stu-id="b8173-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="b8173-223">Použití třídy úložiště a ovládacího prvku ObjectDataSource</span><span class="sxs-lookup"><span data-stu-id="b8173-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="b8173-224">Ve složce *dal* vytvořte nový soubor třídy, pojmenujte ho *SchoolRepository.cs*a stávající kód nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b8173-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="b8173-225">Tento kód poskytuje jednu `GetDepartments` metodu, která vrátí všechny entity v sadě entit `Departments`.</span><span class="sxs-lookup"><span data-stu-id="b8173-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="b8173-226">Vzhledem k tomu, že víte, že budete mít přístup k vlastnosti navigace `Person` pro každý vrácený řádek, zadáte načtení Eager pro tuto vlastnost pomocí metody `Include`.</span><span class="sxs-lookup"><span data-stu-id="b8173-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="b8173-227">Třída také implementuje rozhraní `IDisposable`, aby bylo zajištěno, že se připojení k databázi uvolní při uvolnění objektu.</span><span class="sxs-lookup"><span data-stu-id="b8173-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="b8173-228">Běžným postupem je vytvoření třídy úložiště pro každý typ entity.</span><span class="sxs-lookup"><span data-stu-id="b8173-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="b8173-229">V tomto kurzu se používá jedna třída úložiště pro několik typů entit.</span><span class="sxs-lookup"><span data-stu-id="b8173-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="b8173-230">Další informace o vzoru úložiště najdete v příspěvkůch na blogu [týmu týmu Entity Framework](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) a na [blogu Julie Lerman](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span><span class="sxs-lookup"><span data-stu-id="b8173-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>

<span data-ttu-id="b8173-231">Metoda `GetDepartments` vrátí objekt `IEnumerable` namísto objektu `IQueryable`, aby bylo zajištěno, že vrácená kolekce bude použitelná i po vyřazení samotného objektu úložiště.</span><span class="sxs-lookup"><span data-stu-id="b8173-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="b8173-232">Objekt `IQueryable` může způsobit přístup k databázi vždy, když se k němu přistupuje, ale objekt úložiště může být uvolněný časem, kdy se ovládací prvek datové vazby pokusí data vykreslit.</span><span class="sxs-lookup"><span data-stu-id="b8173-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="b8173-233">Místo objektu `IEnumerable` můžete vrátit jiný typ kolekce, například objekt `IList`.</span><span class="sxs-lookup"><span data-stu-id="b8173-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="b8173-234">Vrácení objektu `IEnumerable` však zajistí, že můžete provádět typické úlohy zpracování seznamu jen pro čtení, například `foreach` smyčky a dotazy LINQ, ale nemůžete přidávat nebo odebírat položky v kolekci, což by mohlo znamenat, že by tyto změny byly trvale uložené v databázi.</span><span class="sxs-lookup"><span data-stu-id="b8173-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="b8173-235">Vytvořte stránku *oddělení. aspx* , která používá hlavní stránku *Web. Master* , a přidejte následující kód do ovládacího prvku `Content` s názvem `Content2`:</span><span class="sxs-lookup"><span data-stu-id="b8173-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="b8173-236">Tento kód vytvoří ovládací prvek `ObjectDataSource`, který používá třídu úložiště, kterou jste právě vytvořili, a ovládací prvek `GridView` k zobrazení dat.</span><span class="sxs-lookup"><span data-stu-id="b8173-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="b8173-237">Ovládací prvek `GridView` Určuje příkazy pro **Úpravy** a **odstranění** , ale ještě jste nepřidali kód pro jejich podporu.</span><span class="sxs-lookup"><span data-stu-id="b8173-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="b8173-238">Několik sloupců používá `DynamicField` ovládacích prvků, aby bylo možné využívat funkce automatického formátování a ověřování dat.</span><span class="sxs-lookup"><span data-stu-id="b8173-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="b8173-239">Aby fungovaly, budete muset volat metodu `EnableDynamicData` v obslužné rutině události `Page_Init`.</span><span class="sxs-lookup"><span data-stu-id="b8173-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="b8173-240">(`DynamicControl` ovládací prvky nejsou použity v poli `Administrator`, protože nefungují s navigačními vlastnostmi.)</span><span class="sxs-lookup"><span data-stu-id="b8173-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="b8173-241">Atributy `Vertical-Align="Top"` budou důležité později při přidání sloupce, který má vnořený ovládací prvek `GridView` do mřížky.</span><span class="sxs-lookup"><span data-stu-id="b8173-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="b8173-242">Otevřete soubor *departments.aspx.cs* a přidejte následující příkaz `using`:</span><span class="sxs-lookup"><span data-stu-id="b8173-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="b8173-243">Pak přidejte následující obslužnou rutinu pro událost `Init` stránky:</span><span class="sxs-lookup"><span data-stu-id="b8173-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="b8173-244">Ve složce *dal* vytvořte nový soubor třídy s názvem *Department.cs* a nahraďte existující kód následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="b8173-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="b8173-245">Tento kód přidá metadata do datového modelu.</span><span class="sxs-lookup"><span data-stu-id="b8173-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="b8173-246">Určuje, že vlastnost `Budget` entity `Department` ve skutečnosti představuje měnu, i když je její datový typ `Decimal`, a určuje, že hodnota musí být mezi 0 a $1 000 000,00.</span><span class="sxs-lookup"><span data-stu-id="b8173-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="b8173-247">Určuje také, že vlastnost `StartDate` má být formátována jako datum ve formátu mm/dd/rrrr.</span><span class="sxs-lookup"><span data-stu-id="b8173-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="b8173-248">Spusťte stránku *oddělení. aspx* .</span><span class="sxs-lookup"><span data-stu-id="b8173-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="b8173-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="b8173-250">Všimněte si, že i když jste nezadali formátovací řetězec do značky stránky *. aspx* pro sloupce **rozpočtového** **data nebo datum zahájení** , použily se pro ně výchozí měna a formátování data pomocí ovládacích prvků `DynamicField` s použitím metadat, která jste zadali v souboru *Department.cs* .</span><span class="sxs-lookup"><span data-stu-id="b8173-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="b8173-251">Přidávání funkcí INSERT a DELETE</span><span class="sxs-lookup"><span data-stu-id="b8173-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="b8173-252">Otevřete *SchoolRepository.cs*a přidejte následující kód, aby bylo možné vytvořit metodu `Insert` a metodu `Delete`.</span><span class="sxs-lookup"><span data-stu-id="b8173-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="b8173-253">Kód také obsahuje metodu s názvem `GenerateDepartmentID`, která vypočítá další dostupnou hodnotu klíče záznamu pro použití metodou `Insert`.</span><span class="sxs-lookup"><span data-stu-id="b8173-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="b8173-254">K tomu je potřeba, protože databáze není nakonfigurovaná tak, aby se automaticky počítala s `Department` tabulkou.</span><span class="sxs-lookup"><span data-stu-id="b8173-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="b8173-255">Metoda Attach</span><span class="sxs-lookup"><span data-stu-id="b8173-255">The Attach Method</span></span>

<span data-ttu-id="b8173-256">Metoda `DeleteDepartment` volá metodu `Attach`, aby bylo možné znovu vytvořit odkaz, který je udržován ve Správci stavu objektů objektu Context mezi entitou v paměti a řádkem databáze, kterou představuje.</span><span class="sxs-lookup"><span data-stu-id="b8173-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="b8173-257">K tomuto musí dojít před voláním metody `SaveChanges`.</span><span class="sxs-lookup"><span data-stu-id="b8173-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="b8173-258">Pojem *kontext objektu* odkazuje na třídu Entity Framework, která je odvozena od `ObjectContext` třídy, kterou používáte pro přístup k sadám entit a entitám.</span><span class="sxs-lookup"><span data-stu-id="b8173-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="b8173-259">V kódu pro tento projekt je třída pojmenována `SchoolEntities`a instance je vždy pojmenována `context`.</span><span class="sxs-lookup"><span data-stu-id="b8173-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="b8173-260">*Správce stavu objektu* kontextu objektu je třída, která je odvozena od třídy `ObjectStateManager`.</span><span class="sxs-lookup"><span data-stu-id="b8173-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="b8173-261">Kontakt objektu používá správce stavu objektu k ukládání objektů entit a k udržení přehledu o tom, zda je každá z nich synchronizována s odpovídajícím řádkem nebo řádky tabulky v databázi.</span><span class="sxs-lookup"><span data-stu-id="b8173-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="b8173-262">Při čtení entity je kontext objektu uložen ve Správci stavu objektu a udržuje přehled o tom, zda je reprezentace objektu synchronizována s databází.</span><span class="sxs-lookup"><span data-stu-id="b8173-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="b8173-263">Například pokud změníte hodnotu vlastnosti, příznak je nastaven tak, aby označoval, že vlastnost, kterou jste změnili, již není synchronizována s databází.</span><span class="sxs-lookup"><span data-stu-id="b8173-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="b8173-264">Poté při volání metody `SaveChanges` ví kontext objektu, co dělat v databázi, protože správce stavu objektu ví přesně, co se liší od aktuálního stavu entity a stavu databáze.</span><span class="sxs-lookup"><span data-stu-id="b8173-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="b8173-265">Nicméně tento proces obvykle nefunguje ve webové aplikaci, protože instance kontextu objektu, který čte entitu, spolu s vše ve Správci stavu objektu, je po vykreslení stránky uvolněna.</span><span class="sxs-lookup"><span data-stu-id="b8173-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="b8173-266">Instance kontextu objektu, která musí použít změny, je nová instance, která je vytvořena pro zpracování zpětného volání.</span><span class="sxs-lookup"><span data-stu-id="b8173-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="b8173-267">V případě metody `DeleteDepartment` `ObjectDataSource` ovládací prvek znovu vytvoří původní verzi entity z hodnot ve stavu zobrazení, ale tato nově vytvořená `Department` entita neexistuje ve Správci stavu objektu.</span><span class="sxs-lookup"><span data-stu-id="b8173-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="b8173-268">Pokud jste pro tuto znovu vytvořenou entitu volali metodu `DeleteObject`, volání by nebylo úspěšné, protože kontext objektu neví, zda je entita synchronizována s databází.</span><span class="sxs-lookup"><span data-stu-id="b8173-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="b8173-269">Nicméně volání metody `Attach` znovu naváže stejné sledování mezi znovu vytvořenou entitou a hodnotami v databázi, které byly původně provedeny automaticky při čtení entity v dřívější instanci kontextu objektu.</span><span class="sxs-lookup"><span data-stu-id="b8173-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="b8173-270">Existují situace, kdy nechcete, aby kontext objektu sledoval entity ve Správci stavu objektu, a můžete nastavit příznaky, abyste zabránili tomu, aby to bylo možné provést.</span><span class="sxs-lookup"><span data-stu-id="b8173-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="b8173-271">Příklady najdete v dalších kurzech v této sérii.</span><span class="sxs-lookup"><span data-stu-id="b8173-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="b8173-272">Metoda SaveChanges</span><span class="sxs-lookup"><span data-stu-id="b8173-272">The SaveChanges Method</span></span>

<span data-ttu-id="b8173-273">Tato jednoduchá třída úložiště znázorňuje základní principy provádění operací CRUD.</span><span class="sxs-lookup"><span data-stu-id="b8173-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="b8173-274">V tomto příkladu je metoda `SaveChanges` volána ihned po každé aktualizaci.</span><span class="sxs-lookup"><span data-stu-id="b8173-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="b8173-275">V produkční aplikaci můžete chtít zavolat metodu `SaveChanges` od samostatné metody a poskytnout vám větší kontrolu nad tím, kdy se databáze aktualizuje.</span><span class="sxs-lookup"><span data-stu-id="b8173-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="b8173-276">(Na konci dalšího kurzu najdete odkaz na dokument White Paper, který se zabývá vzorem pracovní jednotky, který je jedním z přístupů k koordinaci souvisejících aktualizací.) Všimněte si také, že v příkladu metoda `DeleteDepartment` nezahrnuje kód pro zpracování konfliktů souběžnosti; Tento kód se přidá v pozdějším kurzu této série.</span><span class="sxs-lookup"><span data-stu-id="b8173-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="b8173-277">Načítají se názvy instruktorů k výběru při vložení.</span><span class="sxs-lookup"><span data-stu-id="b8173-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="b8173-278">Uživatelé musí být schopni vybrat správce ze seznamu instruktorů v rozevíracím seznamu při vytváření nových oddělení.</span><span class="sxs-lookup"><span data-stu-id="b8173-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="b8173-279">Proto přidejte následující kód do *SchoolRepository.cs* k vytvoření metody pro načtení seznamu instruktorů pomocí zobrazení, které jste vytvořili dříve:</span><span class="sxs-lookup"><span data-stu-id="b8173-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="b8173-280">Vytvoření stránky pro vkládání oddělení</span><span class="sxs-lookup"><span data-stu-id="b8173-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="b8173-281">Vytvořte stránku *DepartmentsAdd. aspx* , která používá stránku *Web. Master* , a přidejte následující kód do ovládacího prvku `Content` s názvem `Content2`:</span><span class="sxs-lookup"><span data-stu-id="b8173-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="b8173-282">Tento kód vytvoří dva ovládací prvky `ObjectDataSource`, jeden pro vložení nových entit `Department` a jeden pro načtení názvů instruktorů pro ovládací prvek `DropDownList`, který se používá pro výběr správců oddělení.</span><span class="sxs-lookup"><span data-stu-id="b8173-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="b8173-283">Značka vytvoří ovládací prvek `DetailsView` pro zadávání nových oddělení a určuje obslužnou rutinu události `ItemInserting` ovládacího prvku, takže můžete nastavit `Administrator` hodnotu cizího klíče.</span><span class="sxs-lookup"><span data-stu-id="b8173-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="b8173-284">Na konci je ovládací prvek `ValidationSummary` pro zobrazení chybových zpráv.</span><span class="sxs-lookup"><span data-stu-id="b8173-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="b8173-285">Otevřete *DepartmentsAdd.aspx.cs* a přidejte následující příkaz `using`:</span><span class="sxs-lookup"><span data-stu-id="b8173-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="b8173-286">Přidejte následující proměnnou třídy a metody:</span><span class="sxs-lookup"><span data-stu-id="b8173-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="b8173-287">Metoda `Page_Init` povoluje funkci dynamických dat.</span><span class="sxs-lookup"><span data-stu-id="b8173-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="b8173-288">Obslužná rutina události `Init` ovládacího prvku `DropDownList` uloží odkaz na ovládací prvek a obslužná rutina události `Inserting` ovládacího prvku `DetailsView` používá tento odkaz k získání hodnoty `PersonID` vybraného instruktora a aktualizaci vlastnosti `Administrator` cizího klíče entity `Department`.</span><span class="sxs-lookup"><span data-stu-id="b8173-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="b8173-289">Spusťte stránku, přidejte informace pro nové oddělení a potom klikněte na odkaz **Vložit** .</span><span class="sxs-lookup"><span data-stu-id="b8173-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="b8173-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="b8173-291">Zadejte hodnoty pro jiné nové oddělení.</span><span class="sxs-lookup"><span data-stu-id="b8173-291">Enter values for another new department.</span></span> <span data-ttu-id="b8173-292">Do pole **rozpočet** a kartu zadejte číslo větší než 1 000 000,00 do dalšího pole.</span><span class="sxs-lookup"><span data-stu-id="b8173-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="b8173-293">V poli se zobrazí hvězdička, pokud na ni podržíte ukazatel myši, zobrazí se chybová zpráva, kterou jste zadali v metadatech tohoto pole.</span><span class="sxs-lookup"><span data-stu-id="b8173-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="b8173-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="b8173-295">Klikněte na tlačítko **Vložit**a zobrazí se chybová zpráva zobrazená ovládacím prvkem `ValidationSummary` v dolní části stránky.</span><span class="sxs-lookup"><span data-stu-id="b8173-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="b8173-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="b8173-297">Potom zavřete prohlížeč a otevřete stránku *oddělení. aspx* .</span><span class="sxs-lookup"><span data-stu-id="b8173-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="b8173-298">Přidejte možnost odstranění do stránky *oddělení. aspx* přidáním atributu `DeleteMethod` k ovládacímu prvku `ObjectDataSource` a atribut `DataKeyNames` pro ovládací prvek `GridView`.</span><span class="sxs-lookup"><span data-stu-id="b8173-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="b8173-299">Úvodní značky pro tyto ovládací prvky teď budou vypadat podobně jako v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="b8173-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="b8173-300">Spusťte stránku.</span><span class="sxs-lookup"><span data-stu-id="b8173-300">Run the page.</span></span>

<span data-ttu-id="b8173-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="b8173-302">Odstraňte oddělení, které jste přidali při spuštění stránky *DepartmentsAdd. aspx* .</span><span class="sxs-lookup"><span data-stu-id="b8173-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="b8173-303">Přidání funkce Update</span><span class="sxs-lookup"><span data-stu-id="b8173-303">Adding Update Functionality</span></span>

<span data-ttu-id="b8173-304">Otevřete *SchoolRepository.cs* a přidejte následující metodu `Update`:</span><span class="sxs-lookup"><span data-stu-id="b8173-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="b8173-305">Kliknete-li na tlačítko **aktualizovat** na stránce *oddělení. aspx* , ovládací prvek `ObjectDataSource` vytvoří dvě entity `Department`, které budou předána metodě `UpdateDepartment`.</span><span class="sxs-lookup"><span data-stu-id="b8173-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="b8173-306">Jeden obsahuje původní hodnoty, které byly uloženy ve stavu zobrazení, a druhý obsahuje nové hodnoty, které byly zadány v ovládacím prvku `GridView`.</span><span class="sxs-lookup"><span data-stu-id="b8173-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="b8173-307">Kód v metodě `UpdateDepartment` předá entitu `Department`, která má původní hodnoty do metody `Attach`, aby bylo možné navázat sledování mezi entitou a čím se v databázi.</span><span class="sxs-lookup"><span data-stu-id="b8173-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="b8173-308">Potom kód předá `Department` entitu, která má nové hodnoty metody `ApplyCurrentValues`.</span><span class="sxs-lookup"><span data-stu-id="b8173-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="b8173-309">Kontext objektu porovnává staré a nové hodnoty.</span><span class="sxs-lookup"><span data-stu-id="b8173-309">The object context compares the old and new values.</span></span> <span data-ttu-id="b8173-310">Pokud je nová hodnota odlišná od původní hodnoty, kontext objektu změní hodnotu vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="b8173-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="b8173-311">Metoda `SaveChanges` pak aktualizuje pouze změněné sloupce v databázi.</span><span class="sxs-lookup"><span data-stu-id="b8173-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="b8173-312">(Pokud je však funkce Update pro tuto entitu namapována na uloženou proceduru, bude celý řádek aktualizován bez ohledu na to, které sloupce byly změněny.)</span><span class="sxs-lookup"><span data-stu-id="b8173-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="b8173-313">Otevřete soubor *departments. aspx* a přidejte následující atributy do ovládacího prvku `DepartmentsObjectDataSource`:</span><span class="sxs-lookup"><span data-stu-id="b8173-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="b8173-314">To způsobuje, že staré hodnoty budou uloženy ve stavu zobrazení tak, aby je bylo možné porovnat s novými hodnotami v metodě `Update`.</span><span class="sxs-lookup"><span data-stu-id="b8173-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="b8173-315">Tím se ovládací prvek informuje o tom, že název parametru původních hodnot je `origDepartment`.</span><span class="sxs-lookup"><span data-stu-id="b8173-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="b8173-316">Značka pro otevírací značku ovládacího prvku `ObjectDataSource` nyní vypadá podobně jako v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="b8173-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="b8173-317">Přidejte atribut `OnRowUpdating="DepartmentsGridView_RowUpdating"` k ovládacímu prvku `GridView`.</span><span class="sxs-lookup"><span data-stu-id="b8173-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="b8173-318">Použijete ho k nastavení hodnoty vlastnosti `Administrator` na základě řádku, který uživatel vybere v rozevíracím seznamu.</span><span class="sxs-lookup"><span data-stu-id="b8173-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="b8173-319">Počáteční značka `GridView` nyní vypadá podobně jako v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="b8173-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="b8173-320">Do ovládacího prvku `GridView` přidejte ovládací prvek `EditItemTemplate` pro sloupec `Administrator`, a to hned za ovládací prvek `ItemTemplate` pro tento sloupec:</span><span class="sxs-lookup"><span data-stu-id="b8173-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="b8173-321">Tento ovládací prvek `EditItemTemplate` je podobný ovládacímu prvku `InsertItemTemplate` na stránce *DepartmentsAdd. aspx* .</span><span class="sxs-lookup"><span data-stu-id="b8173-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="b8173-322">Rozdíl je v tom, že počáteční hodnota ovládacího prvku je nastavena pomocí atributu `SelectedValue`.</span><span class="sxs-lookup"><span data-stu-id="b8173-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="b8173-323">Před ovládacím prvkem `GridView` přidejte ovládací prvek `ValidationSummary` stejným způsobem jako na stránce *DepartmentsAdd. aspx* .</span><span class="sxs-lookup"><span data-stu-id="b8173-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="b8173-324">Otevřete *departments.aspx.cs* a hned po deklaraci částečné třídy přidejte následující kód, který vytvoří soukromé pole pro odkaz na ovládací prvek `DropDownList`:</span><span class="sxs-lookup"><span data-stu-id="b8173-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="b8173-325">Pak přidejte obslužné rutiny pro událost `Init` ovládacího prvku `DropDownList` a událost `RowUpdating` ovládacího prvku `GridView`:</span><span class="sxs-lookup"><span data-stu-id="b8173-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="b8173-326">Obslužná rutina události `Init` uloží odkaz na ovládací prvek `DropDownList` v poli třída.</span><span class="sxs-lookup"><span data-stu-id="b8173-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="b8173-327">Obslužná rutina události `RowUpdating` používá odkaz k získání hodnoty, kterou uživatel zadal, a jeho použití na vlastnost `Administrator` entity `Department`.</span><span class="sxs-lookup"><span data-stu-id="b8173-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="b8173-328">Pomocí stránky *DepartmentsAdd. aspx* přidejte nové oddělení, potom spusťte stránku *oddělení. aspx* a klikněte na tlačítko **Upravit** na řádku, který jste přidali.</span><span class="sxs-lookup"><span data-stu-id="b8173-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="b8173-329">Nebudete moct upravit řádky, které jste nepřidali (to znamená, že už jsou v databázi), z důvodu neplatných dat v databázi. Správci pro řádky, které byly vytvořeny v databázi, jsou studenti.</span><span class="sxs-lookup"><span data-stu-id="b8173-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="b8173-330">Pokud se pokusíte jeden z nich upravit, zobrazí se chybová stránka, která hlásí chybu, například `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="b8173-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>

<span data-ttu-id="b8173-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="b8173-332">Pokud zadáte neplatnou hodnotu **rozpočtu** a kliknete na **aktualizovat**, zobrazí se stejná hvězdička a chybová zpráva, kterou jste viděli na stránce *oddělení. aspx* .</span><span class="sxs-lookup"><span data-stu-id="b8173-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="b8173-333">Změňte hodnotu pole nebo vyberte jiného správce a klikněte na **aktualizovat**.</span><span class="sxs-lookup"><span data-stu-id="b8173-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="b8173-334">Tato změna se zobrazí.</span><span class="sxs-lookup"><span data-stu-id="b8173-334">The change is displayed.</span></span>

<span data-ttu-id="b8173-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="b8173-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="b8173-336">Tím se dokončí Úvod k použití ovládacího prvku `ObjectDataSource` pro základní operace CRUD (vytvoření, čtení, aktualizace, odstranění) s Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="b8173-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="b8173-337">Vytvořili jste jednoduchou n-vrstvou aplikaci, ale vrstva Business-Logic je stále pevně spojena s vrstvou přístupu k datům, což ztěžuje automatizované testování částí.</span><span class="sxs-lookup"><span data-stu-id="b8173-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="b8173-338">V následujícím kurzu se dozvíte, jak implementovat vzor úložiště pro usnadnění testování částí.</span><span class="sxs-lookup"><span data-stu-id="b8173-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="b8173-339">Next</span><span class="sxs-lookup"><span data-stu-id="b8173-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
