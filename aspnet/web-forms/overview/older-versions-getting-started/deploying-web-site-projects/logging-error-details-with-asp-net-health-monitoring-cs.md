---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
title: Protokolování podrobností o chybách pomocí monitorování stavu ASP.NETC#() | Microsoft Docs
author: rick-anderson
description: Systém sledování stavu společnosti Microsoft poskytuje snadný a přizpůsobitelný způsob, jak protokolovat různé webové události, včetně neošetřených výjimek. Tento kurz projde p...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: b1abb452-642a-4ff3-8504-37b85590ff79
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
msc.type: authoredcontent
ms.openlocfilehash: e52ed94f78d053701771690fce432d5a1d465b62
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/28/2019
ms.locfileid: "74637277"
---
# <a name="logging-error-details-with-aspnet-health-monitoring-c"></a><span data-ttu-id="40af3-104">Protokolování podrobností o chybách pomocí monitorování stavu v ASP.NET (C#)</span><span class="sxs-lookup"><span data-stu-id="40af3-104">Logging Error Details with ASP.NET Health Monitoring (C#)</span></span>

<span data-ttu-id="40af3-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="40af3-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="40af3-106">[Stažení kódu](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) nebo [stažení PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="40af3-106">[Download Code](https://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) or [Download PDF](https://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span></span>

> <span data-ttu-id="40af3-107">Systém sledování stavu společnosti Microsoft poskytuje snadný a přizpůsobitelný způsob, jak protokolovat různé webové události, včetně neošetřených výjimek.</span><span class="sxs-lookup"><span data-stu-id="40af3-107">Microsoft's health monitoring system provides an easy and customizable way to log various web events, including unhandled exceptions.</span></span> <span data-ttu-id="40af3-108">Tento kurz vás provede nastavením systému monitorování stavu, aby protokoloval neošetřené výjimky do databáze a upozornil vývojářům prostřednictvím e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="40af3-108">This tutorial walks through setting up the health monitoring system to log unhandled exceptions to a database and to notify developers via an email message.</span></span>

## <a name="introduction"></a><span data-ttu-id="40af3-109">Úvod</span><span class="sxs-lookup"><span data-stu-id="40af3-109">Introduction</span></span>

<span data-ttu-id="40af3-110">Protokolování je užitečný nástroj pro monitorování stavu nasazené aplikace a diagnostikování všech problémů, které mohou nastat.</span><span class="sxs-lookup"><span data-stu-id="40af3-110">Logging is a useful tool for monitoring the health of a deployed application and for diagnosing any problems that may arise.</span></span> <span data-ttu-id="40af3-111">Je obzvláště důležité protokolovat chyby, ke kterým dochází v nasazené aplikaci, aby bylo možné je odstranit.</span><span class="sxs-lookup"><span data-stu-id="40af3-111">It is especially important to log errors that occur in a deployed application so that they can be remedied.</span></span> <span data-ttu-id="40af3-112">Událost `Error` je vyvolána pokaždé, když dojde k neošetřené výjimce v aplikaci ASP.NET; [předchozí kurz](processing-unhandled-exceptions-cs.md) ukázal, jak upozorněte vývojáře na chybu a protokolovat své podrobnosti vytvořením obslužné rutiny události pro událost `Error`.</span><span class="sxs-lookup"><span data-stu-id="40af3-112">The `Error` event is raised whenever an unhandled exception occurs in an ASP.NET application; the [preceding tutorial](processing-unhandled-exceptions-cs.md) showed how to notify a developer of an error and log its details by creating an event handler for the `Error` event.</span></span> <span data-ttu-id="40af3-113">Nicméně vytvoření obslužné rutiny události `Error` k zaznamenání podrobností o chybě a informování o tom, že vývojář bude zbytečný, protože tuto úlohu může provádět ASP. *Systém monitorování stavu*sítě.</span><span class="sxs-lookup"><span data-stu-id="40af3-113">However, creating an `Error` event handler to log the error's details and notify a developer is unnecessary, as this task can be performed by ASP.NET's *health monitoring system*.</span></span>

<span data-ttu-id="40af3-114">Systém sledování stavu byl představený v ASP.NET 2,0 a je navržený tak, aby monitoroval stav nasazené aplikace ASP.NET protokolováním událostí, ke kterým dojde během doby platnosti aplikace nebo žádosti.</span><span class="sxs-lookup"><span data-stu-id="40af3-114">The health monitoring system was introduced in ASP.NET 2.0 and is designed to monitor the health of a deployed ASP.NET application by logging events that occur during the application or request's lifetime.</span></span> <span data-ttu-id="40af3-115">Události zaznamenané systémem sledování stavu se nazývají *události monitorování stavu* nebo *webové události*a zahrnují:</span><span class="sxs-lookup"><span data-stu-id="40af3-115">The events logged by the health monitoring system are referred to as *health monitoring events* or *Web events*, and include:</span></span>

- <span data-ttu-id="40af3-116">Události životního cyklu aplikace, například při spuštění nebo zastavení aplikace</span><span class="sxs-lookup"><span data-stu-id="40af3-116">Application lifetime events, such as when an application starts or stops</span></span>
- <span data-ttu-id="40af3-117">Události zabezpečení, včetně neúspěšných pokusů o přihlášení a nezdařených žádostí o ověření adresy URL</span><span class="sxs-lookup"><span data-stu-id="40af3-117">Security events, including failed login attempts and failed URL authorization requests</span></span>
- <span data-ttu-id="40af3-118">Chyby aplikace, včetně neošetřených výjimek, zobrazování výjimek při analýze stavu, žádosti o ověření a chyby kompilace, a to mimo jiné typy chyb.</span><span class="sxs-lookup"><span data-stu-id="40af3-118">Application errors, including unhandled exceptions, view state parsing exceptions, request validation exceptions, and compilation errors, among other types of errors.</span></span>

<span data-ttu-id="40af3-119">Když se aktivuje událost monitorování stavu, může se přihlásit k libovolnému počtu zadaných *zdrojů protokolu*.</span><span class="sxs-lookup"><span data-stu-id="40af3-119">When a health monitoring event is raised it can be logged to any number of specified *log sources*.</span></span> <span data-ttu-id="40af3-120">Systém monitorování stavu je dodáván se zdroji protokolů, které protokolují webové události do databáze Microsoft SQL Server, do protokolu událostí systému Windows nebo prostřednictvím e-mailové zprávy, mimo jiné.</span><span class="sxs-lookup"><span data-stu-id="40af3-120">The health monitoring system ships with log sources that log Web events to a Microsoft SQL Server database, to the Windows Event Log, or via an email message, among others.</span></span> <span data-ttu-id="40af3-121">Můžete také vytvořit vlastní zdroje protokolů.</span><span class="sxs-lookup"><span data-stu-id="40af3-121">You can also create your own log sources.</span></span>

<span data-ttu-id="40af3-122">V `Web.config`se definují události v systémových protokolech monitorování stavu společně s použitými zdroji protokolů.</span><span class="sxs-lookup"><span data-stu-id="40af3-122">The events the health monitoring system logs, along with the log sources used, are defined in `Web.config`.</span></span> <span data-ttu-id="40af3-123">Pomocí několika řádků kódu konfigurace můžete použít sledování stavu k protokolování všech neošetřených výjimek do databáze a k informování o výjimce prostřednictvím e-mailu.</span><span class="sxs-lookup"><span data-stu-id="40af3-123">With a few lines of configuration markup you can use health monitoring to log all unhandled exceptions to a database and to notify you of the exception via email.</span></span>

## <a name="exploring-the-health-monitoring-systems-configuration"></a><span data-ttu-id="40af3-124">Zkoumání konfigurace systému sledování stavu</span><span class="sxs-lookup"><span data-stu-id="40af3-124">Exploring the Health Monitoring System's Configuration</span></span>

<span data-ttu-id="40af3-125">Chování systému monitorování stavu je definováno pomocí informací o konfiguraci, které jsou umístěny v [prvku`<healthMonitoring>`](https://msdn.microsoft.com/library/2fwh2ss9.aspx) v `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="40af3-125">The health monitoring system's behavior is defined by its configuration information, which is located in the [`<healthMonitoring>` element](https://msdn.microsoft.com/library/2fwh2ss9.aspx) in `Web.config`.</span></span> <span data-ttu-id="40af3-126">Tento oddíl konfigurace definuje mimo jiné následující tři důležité informace:</span><span class="sxs-lookup"><span data-stu-id="40af3-126">This configuration section defines, among other things, the following three important pieces of information:</span></span>

1. <span data-ttu-id="40af3-127">Události monitorování stavu, které jsou při vyvolání, by měly být protokolovány,</span><span class="sxs-lookup"><span data-stu-id="40af3-127">The health monitoring events that, when raised, should be logged,</span></span>
2. <span data-ttu-id="40af3-128">Zdroje protokolů a</span><span class="sxs-lookup"><span data-stu-id="40af3-128">The log sources, and</span></span>
3. <span data-ttu-id="40af3-129">Způsob, jakým se každá událost monitorování stavu definovaná v (1) mapuje na zdroje protokolu definované v (2).</span><span class="sxs-lookup"><span data-stu-id="40af3-129">How each health monitoring event defined in (1) is mapped to the log sources defined in (2).</span></span>

<span data-ttu-id="40af3-130">Tyto informace jsou zadány pomocí tří elementů konfigurace podřízených: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx)a [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx)v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="40af3-130">This information is specified through three children configuration elements: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx), and [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectively.</span></span>

<span data-ttu-id="40af3-131">Výchozí informace o konfiguraci systému monitorování stavu najdete v souboru `Web.config` v `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` složce.</span><span class="sxs-lookup"><span data-stu-id="40af3-131">The default health monitoring system configuration information can be found in the `Web.config` file in `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` folder.</span></span> <span data-ttu-id="40af3-132">Tyto výchozí konfigurační informace s některými odebranými kódy pro zkrácení jsou uvedené níže:</span><span class="sxs-lookup"><span data-stu-id="40af3-132">This default configuration information, with some markup removed for brevity, is shown below:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample1.xml)]

<span data-ttu-id="40af3-133">Události monitorování stavu, které jsou předmětem zájmu, jsou definovány v prvku `<eventMappings>`, který poskytuje lidský popisný název třídy událostí monitorování stavu.</span><span class="sxs-lookup"><span data-stu-id="40af3-133">The health monitoring events of interest are defined in the `<eventMappings>` element, which gives a human-friendly name to a class of health monitoring events.</span></span> <span data-ttu-id="40af3-134">Ve výše uvedeném kódu `<eventMappings>` prvek přiřadí "všechny chyby" uživatelsky přívětivým názvům události monitorování stavu typu `WebBaseErrorEvent` a název "audity selhání" pro události monitorování stavu typu `WebFailureAuditEvent`.</span><span class="sxs-lookup"><span data-stu-id="40af3-134">In the markup above, the `<eventMappings>` element assigns the human-friendly name "All Errors" to the health monitoring events of type `WebBaseErrorEvent` and the name "Failure Audits" to health monitoring events of type `WebFailureAuditEvent`.</span></span>

<span data-ttu-id="40af3-135">Element `<providers>` definuje zdroje protokolů a poskytuje jim uživatelsky přívětivý název a uvádí všechny informace o konfiguraci specifické pro zdroj protokolu.</span><span class="sxs-lookup"><span data-stu-id="40af3-135">The `<providers>` element defines the log sources, giving them a human-friendly name and specifying any log source-specific configuration information.</span></span> <span data-ttu-id="40af3-136">První prvek `<add>` definuje poskytovatele "EventLogProvider", který protokoluje zadané události monitorování stavu pomocí třídy `EventLogWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="40af3-136">The first `<add>` element defines the "EventLogProvider" provider, which logs the specified health monitoring events using the `EventLogWebEventProvider` class.</span></span> <span data-ttu-id="40af3-137">Třída `EventLogWebEventProvider` protokoluje událost do protokolu událostí systému Windows.</span><span class="sxs-lookup"><span data-stu-id="40af3-137">The `EventLogWebEventProvider` class logs the event to the Windows Event Log.</span></span> <span data-ttu-id="40af3-138">Druhý `<add>` prvek definuje poskytovatele "SqlWebEventProvider", který protokoluje události do databáze Microsoft SQL Server prostřednictvím třídy `SqlWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="40af3-138">The second `<add>` element defines the "SqlWebEventProvider" provider, which logs events to a Microsoft SQL Server database via the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="40af3-139">Konfigurace "SqlWebEventProvider" Určuje připojovací řetězec databáze (`connectionStringName`) mezi dalšími možnostmi konfigurace.</span><span class="sxs-lookup"><span data-stu-id="40af3-139">The "SqlWebEventProvider" configuration specifies the database's connection string (`connectionStringName`) among other configuration options.</span></span>

<span data-ttu-id="40af3-140">Element `<rules>` mapuje události zadané v elementu `<eventMappings>` na zdroje protokolu v elementu `<providers>`.</span><span class="sxs-lookup"><span data-stu-id="40af3-140">The `<rules>` element maps the events specified in the `<eventMappings>` element to log sources in the `<providers>` element.</span></span> <span data-ttu-id="40af3-141">Ve výchozím nastavení protokoluje webové aplikace ASP.NET všechny neošetřené výjimky a chyby auditu do protokolu událostí systému Windows.</span><span class="sxs-lookup"><span data-stu-id="40af3-141">By default, ASP.NET web applications log all unhandled exceptions and audit failures to the Windows Event Log.</span></span>

## <a name="logging-events-to-a-database"></a><span data-ttu-id="40af3-142">Protokolování událostí do databáze</span><span class="sxs-lookup"><span data-stu-id="40af3-142">Logging Events to a Database</span></span>

<span data-ttu-id="40af3-143">Výchozí konfiguraci systému sledování stavu lze přizpůsobit na základě webové aplikace pomocí přidání oddílu `<healthMonitoring>` do souboru `Web.config` aplikace.</span><span class="sxs-lookup"><span data-stu-id="40af3-143">The health monitoring system's default configuration can be customized on a web application-by-web application basis by adding a `<healthMonitoring>` section to the application's `Web.config` file.</span></span> <span data-ttu-id="40af3-144">Do sekcí `<eventMappings>`, `<providers>`a `<rules>` můžete zahrnout další prvky pomocí elementu `<add>`.</span><span class="sxs-lookup"><span data-stu-id="40af3-144">You can include additional elements in the `<eventMappings>`, `<providers>`, and `<rules>` sections by using the `<add>` element.</span></span> <span data-ttu-id="40af3-145">Chcete-li odebrat nastavení z výchozí konfigurace, použijte element `<remove>`, nebo pomocí `<clear />` odeberte všechny výchozí hodnoty z jedné z těchto oddílů.</span><span class="sxs-lookup"><span data-stu-id="40af3-145">To remove a setting from the default configuration use the `<remove>` element, or use `<clear />` to remove all default values from one of these sections.</span></span> <span data-ttu-id="40af3-146">Pojďme nakonfigurovat webovou aplikaci recenze knih na protokolování všech neošetřených výjimek do databáze Microsoft SQL Server pomocí `SqlWebEventProvider` třídy.</span><span class="sxs-lookup"><span data-stu-id="40af3-146">Let's configure the Book Reviews web application to log all unhandled exceptions to a Microsoft SQL Server database using the `SqlWebEventProvider` class.</span></span>

<span data-ttu-id="40af3-147">Třída `SqlWebEventProvider` je součástí systému sledování stavu a zapisuje událost monitorování stavu do zadané SQL Server databáze.</span><span class="sxs-lookup"><span data-stu-id="40af3-147">The `SqlWebEventProvider` class is part of the health monitoring system and logs a health monitoring event to a specified SQL Server database.</span></span> <span data-ttu-id="40af3-148">Třída `SqlWebEventProvider` očekává, že zadaná databáze zahrnuje uloženou proceduru s názvem `aspnet_WebEvent_LogEvent`.</span><span class="sxs-lookup"><span data-stu-id="40af3-148">The `SqlWebEventProvider` class expects that the specified database includes a stored procedure named `aspnet_WebEvent_LogEvent`.</span></span> <span data-ttu-id="40af3-149">Tato uložená procedura se dokončí na podrobnosti události a má na úkol ukládání podrobností události.</span><span class="sxs-lookup"><span data-stu-id="40af3-149">This stored procedure is passed the details of the event and is tasked with storing the event details.</span></span> <span data-ttu-id="40af3-150">Dobrá zpráva je, že nemusíte vytvářet tuto uloženou proceduru ani tabulku pro ukládání podrobností události.</span><span class="sxs-lookup"><span data-stu-id="40af3-150">The good news is that you do not need to create this stored procedure nor the table to store the event details.</span></span> <span data-ttu-id="40af3-151">Tyto objekty můžete přidat do databáze pomocí nástroje `aspnet_regsql.exe`.</span><span class="sxs-lookup"><span data-stu-id="40af3-151">You can add these objects to your database using the `aspnet_regsql.exe` tool.</span></span>

> [!NOTE]
> <span data-ttu-id="40af3-152">Nástroj `aspnet_regsql.exe` byl v rámci [ *Konfigurace webu, který používá aplikační služby kurz,* ](configuring-a-website-that-uses-application-services-cs.md) až po přidání podpory pro ASP. Aplikační služby netto.</span><span class="sxs-lookup"><span data-stu-id="40af3-152">The `aspnet_regsql.exe` tool was discussed back in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-cs.md) when we added support for ASP.NET's application services.</span></span> <span data-ttu-id="40af3-153">V důsledku toho již databáze webu recenzí knihy obsahuje `aspnet_WebEvent_LogEvent` uloženou proceduru, která ukládá informace o událostech do tabulky s názvem `aspnet_WebEvent_Events`.</span><span class="sxs-lookup"><span data-stu-id="40af3-153">Consequently, the Book Reviews website's database already contains the `aspnet_WebEvent_LogEvent` stored procedure, which stores the event information into a table named `aspnet_WebEvent_Events`.</span></span>

<span data-ttu-id="40af3-154">Jakmile budete mít do své databáze k dispozici veškerou uloženou proceduru a tabulku, je vše, co je potřeba k tomu, aby se do databáze hlásily všechny neošetřené výjimky.</span><span class="sxs-lookup"><span data-stu-id="40af3-154">Once you have the necessary stored procedure and table added to your database, all that remains is to instruct health monitoring to log all unhandled exceptions to the database.</span></span> <span data-ttu-id="40af3-155">To lze provést přidáním následujícího kódu do souboru `Web.config` vašeho webu:</span><span class="sxs-lookup"><span data-stu-id="40af3-155">Accomplish this by adding the following markup to your website's `Web.config` file:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample2.xml)]

<span data-ttu-id="40af3-156">Výše uvedený kód pro konfiguraci sledování stavu používá `<clear />` prvky k vymazání informací o konfiguraci, které jsou předem definované, v sekcích `<eventMappings>`, `<providers>`a `<rules>`.</span><span class="sxs-lookup"><span data-stu-id="40af3-156">The health monitoring configuration markup above uses `<clear />` elements to wipe the pre-defined health monitoring configuration information from the `<eventMappings>`, `<providers>`, and `<rules>` sections.</span></span> <span data-ttu-id="40af3-157">Pak přidá jednu položku do každého z těchto oddílů.</span><span class="sxs-lookup"><span data-stu-id="40af3-157">It then adds a single entry to each of these sections.</span></span>

- <span data-ttu-id="40af3-158">Element `<eventMappings>` definuje jednu událost monitorování stavu s oznámením s názvem "všechny chyby", která je vyvolána vždy, když dojde k neošetřené výjimce.</span><span class="sxs-lookup"><span data-stu-id="40af3-158">The `<eventMappings>` element defines a single health monitoring event of interest named "All Errors", which is raised whenever an unhandled exception occurs.</span></span>
- <span data-ttu-id="40af3-159">Element `<providers>` definuje jeden zdroj protokolu s názvem "SqlWebEventProvider", který používá třídu `SqlWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="40af3-159">The `<providers>` element defines a single log source named "SqlWebEventProvider" that uses the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="40af3-160">Atribut `connectionStringName` byl nastaven na hodnotu "ReviewsConnectionString", což je název našeho připojovacího řetězce definovaného v části `<connectionStrings>`.</span><span class="sxs-lookup"><span data-stu-id="40af3-160">The `connectionStringName` attribute has been set to "ReviewsConnectionString", which is the name of our connection string defined in the `<connectionStrings>` section.</span></span>
- <span data-ttu-id="40af3-161">Nakonec&gt; prvek &lt;Rules označuje, že když událost všechny chyby ukáže, že by měla být protokolovaná pomocí poskytovatele "SqlWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="40af3-161">Finally, the &lt;rules&gt; element indicates that when an "All Errors" event transpires that it should be logged using the "SqlWebEventProvider" provider.</span></span>

<span data-ttu-id="40af3-162">Tyto informace o konfiguraci instruují systém monitorování stavu, aby protokoloval všechny neošetřené výjimky do databáze recenze knih.</span><span class="sxs-lookup"><span data-stu-id="40af3-162">This configuration information instructs the health monitoring system to log all unhandled exceptions to the Book Reviews database.</span></span>

> [!NOTE]
> <span data-ttu-id="40af3-163">Událost `WebBaseErrorEvent` je aktivována pouze pro chyby serveru; nejsou vyvolány pro chyby protokolu HTTP, jako je například požadavek na prostředek ASP.NET, který nebyl nalezen.</span><span class="sxs-lookup"><span data-stu-id="40af3-163">The `WebBaseErrorEvent` event is only raised for server errors; it is not raised for HTTP errors, such as a request for an ASP.NET resource that is not found.</span></span> <span data-ttu-id="40af3-164">To se liší od chování události `Error` `HttpApplication` třídy, která je vyvolána pro chyby serveru i protokolu HTTP.</span><span class="sxs-lookup"><span data-stu-id="40af3-164">This differs from the behavior of the `HttpApplication` class's `Error` event, which is raised for both server and HTTP errors.</span></span>

<span data-ttu-id="40af3-165">Pokud chcete zobrazit systém monitorování stavu v akci, navštivte web a vygenerujte chybu za běhu návštěvou `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="40af3-165">To see the health monitoring system in action, visit the website and generate a runtime error by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="40af3-166">Měla by se zobrazit příslušná chybová stránka-podrobnosti o výjimce žlutá obrazovka smrti (při místní návštěvě) nebo vlastní chybová stránka (při návštěvě lokality v produkčním prostředí).</span><span class="sxs-lookup"><span data-stu-id="40af3-166">You should see the appropriate error page - either the Exception Details Yellow Screen of Death (when visiting locally) or the custom error page (when visiting the site in production).</span></span> <span data-ttu-id="40af3-167">Na pozadí systém sledování stavu zaznamenal do databáze informace o chybě.</span><span class="sxs-lookup"><span data-stu-id="40af3-167">Behind the scenes, the health monitoring system logged the error information to the database.</span></span> <span data-ttu-id="40af3-168">V tabulce `aspnet_WebEvent_Events` by měl být jeden záznam (viz **Obrázek 1**); Tento záznam obsahuje informace o běhové chybě, ke které došlo pouze.</span><span class="sxs-lookup"><span data-stu-id="40af3-168">There should be one record in the `aspnet_WebEvent_Events` table (see **Figure 1**); this record contains information about the runtime error that just occurred.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image1.png)

<span data-ttu-id="40af3-169">**Obrázek 1**: podrobnosti o chybě se zaznamenaly do `aspnet_WebEvent_Events` tabulky.</span><span class="sxs-lookup"><span data-stu-id="40af3-169">**Figure 1**: The Error Details Were Logged to the `aspnet_WebEvent_Events` Table</span></span>  
<span data-ttu-id="40af3-170">([Kliknutím zobrazíte obrázek v plné velikosti.](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="40af3-170">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span></span>

### <a name="displaying-the-error-log-in-a-web-page"></a><span data-ttu-id="40af3-171">Zobrazení protokolu chyb na webové stránce</span><span class="sxs-lookup"><span data-stu-id="40af3-171">Displaying the Error Log In a Web Page</span></span>

<span data-ttu-id="40af3-172">V případě aktuální konfigurace webu protokoluje systém monitorování stavu všechny neošetřené výjimky do databáze.</span><span class="sxs-lookup"><span data-stu-id="40af3-172">With the website's current configuration, the health monitoring system logs all unhandled exceptions to the database.</span></span> <span data-ttu-id="40af3-173">Monitorování stavu ale neposkytuje žádný mechanismus pro zobrazení protokolu chyb prostřednictvím webové stránky.</span><span class="sxs-lookup"><span data-stu-id="40af3-173">However, health monitoring does not provide any mechanism to view the error log through a web page.</span></span> <span data-ttu-id="40af3-174">Mohli byste však vytvořit stránku ASP.NET, která zobrazí tyto informace z databáze.</span><span class="sxs-lookup"><span data-stu-id="40af3-174">However, you could build an ASP.NET page that displays this information from the database.</span></span> <span data-ttu-id="40af3-175">(Jak budeme pokaždé, když uvidíme za chvíli, můžete se rozhodnout, že budete mít v e-mailové zprávě zasílané podrobnosti o chybě.)</span><span class="sxs-lookup"><span data-stu-id="40af3-175">(As we'll see momentarily, you can opt to have the error details sent to you in an email message.)</span></span>

<span data-ttu-id="40af3-176">Pokud takovou stránku vytvoříte, ujistěte se, že jste provedli kroky, abyste mohli zobrazit podrobnosti o chybě jenom autorizovaným uživatelům.</span><span class="sxs-lookup"><span data-stu-id="40af3-176">If you create such a page, make sure you take steps to allow only authorized users to view the error details.</span></span> <span data-ttu-id="40af3-177">Pokud vaše lokalita už využívá uživatelské účty, můžete použít autorizační pravidla URL k omezení přístupu k této stránce na určité uživatele nebo role.</span><span class="sxs-lookup"><span data-stu-id="40af3-177">If your site already employs user accounts then you can use URL authorization rules to restrict access to the page to certain users or roles.</span></span> <span data-ttu-id="40af3-178">Další informace o tom, jak udělit nebo omezit přístup k webovým stránkám na základě přihlášeného uživatele, najdete v tématu naše [kurzy zabezpečení webu](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span><span class="sxs-lookup"><span data-stu-id="40af3-178">For more information on how to grant or restrict access to web pages based on the logged in user, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

> [!NOTE]
> <span data-ttu-id="40af3-179">V dalším kurzu se prozkoumá alternativní protokolování chyb a systém oznámení s názvem knihovny ELMAH.</span><span class="sxs-lookup"><span data-stu-id="40af3-179">The subsequent tutorial explores an alternative error logging and notification system named ELMAH.</span></span> <span data-ttu-id="40af3-180">KNIHOVNY ELMAH obsahuje integrovaný mechanizmus pro zobrazení protokolu chyb z webové stránky i kanálu RSS.</span><span class="sxs-lookup"><span data-stu-id="40af3-180">ELMAH includes a built-in mechanism to view the error log from both a web page and as an RSS feed.</span></span>

## <a name="logging-events-to-email"></a><span data-ttu-id="40af3-181">Protokolování událostí do e-mailu</span><span class="sxs-lookup"><span data-stu-id="40af3-181">Logging Events to Email</span></span>

<span data-ttu-id="40af3-182">Systém monitorování stavu zahrnuje poskytovatele zdroje protokolu, který protokoluje událost do e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="40af3-182">The health monitoring system includes a log source provider that "logs" an event to an email message.</span></span> <span data-ttu-id="40af3-183">Zdroj protokolu obsahuje stejné informace, které se protokolují do databáze v těle e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="40af3-183">The log source includes the same information that is logged to the database in the email message body.</span></span> <span data-ttu-id="40af3-184">Tento zdroj protokolu můžete použít k upozorňování vývojáře, když dojde k určité události monitorování stavu.</span><span class="sxs-lookup"><span data-stu-id="40af3-184">You can use this log source to notify a developer when a certain health monitoring event occurs.</span></span>

<span data-ttu-id="40af3-185">Pojďme aktualizovat konfiguraci webu recenzí recenze, aby obdržení e-mailu vždycky, když dojde k výjimce.</span><span class="sxs-lookup"><span data-stu-id="40af3-185">Let's update the Book Reviews website's configuration so that we receive an email whenever an exception occurs.</span></span> <span data-ttu-id="40af3-186">K tomu musíme provést tři úkoly:</span><span class="sxs-lookup"><span data-stu-id="40af3-186">To accomplish this we need to perform three tasks:</span></span>

1. <span data-ttu-id="40af3-187">Konfigurace webové aplikace ASP.NET pro odesílání e-mailů</span><span class="sxs-lookup"><span data-stu-id="40af3-187">Configure the ASP.NET web application to send email.</span></span> <span data-ttu-id="40af3-188">To lze provést zadáním způsobu odesílání e-mailových zpráv prostřednictvím elementu konfigurace `<system.net>`.</span><span class="sxs-lookup"><span data-stu-id="40af3-188">This is accomplished by specifying how email messages are sent via the `<system.net>` configuration element.</span></span> <span data-ttu-id="40af3-189">Další informace o posílání e-mailových zpráv v aplikaci ASP.NET najdete [v tématu posílání e-mailů v ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) a [Nejčastější dotazy k System .NET. mailu](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="40af3-189">For more information on sending email messages in an ASP.NET application refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>
2. <span data-ttu-id="40af3-190">Zaregistrujte poskytovatele zdroje e-mailových protokolů v prvku `<providers>` a</span><span class="sxs-lookup"><span data-stu-id="40af3-190">Register the email log source provider in the `<providers>` element, and</span></span>
3. <span data-ttu-id="40af3-191">Přidejte položku do prvku `<rules>`, který mapuje událost všechny chyby na zprostředkovatele zdroje protokolu přidaný v kroku (2).</span><span class="sxs-lookup"><span data-stu-id="40af3-191">Add an entry to the `<rules>` element that maps the "All Errors" event to the log source provider added in step (2).</span></span>

<span data-ttu-id="40af3-192">Systém monitorování stavu zahrnuje dvě třídy poskytovatele zdrojového e-mailového protokolu: `SimpleMailWebEventProvider` a `TemplatedMailWebEventProvider`.</span><span class="sxs-lookup"><span data-stu-id="40af3-192">The health monitoring system includes two email log source provider classes: `SimpleMailWebEventProvider` and `TemplatedMailWebEventProvider`.</span></span> <span data-ttu-id="40af3-193">[Třída`SimpleMailWebEventProvider`](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) pošle e-mailovou zprávu s prostým textem, která obsahuje podrobnosti o události a poskytuje malé přizpůsobení těla e-mailu.</span><span class="sxs-lookup"><span data-stu-id="40af3-193">The [`SimpleMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) sends a plain-text email message that includes the event details and provides little customization of the email body.</span></span> <span data-ttu-id="40af3-194">Pomocí [třídy`TemplatedMailWebEventProvider`](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) zadáte stránku ASP.NET, jejíž vykreslený kód slouží jako tělo e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="40af3-194">With the [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) you specify an ASP.NET page whose rendered markup is used as the body for the email message.</span></span> <span data-ttu-id="40af3-195">[Třída`TemplatedMailWebEventProvider`](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) poskytuje mnohem větší kontrolu nad obsahem a formátem e-mailové zprávy, ale vyžaduje trochu větší práci, protože je třeba vytvořit stránku ASP.NET, která generuje tělo e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="40af3-195">The [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) gives you much greater control over the contents and format of the email message, but requires a bit more upfront work as you have to create the ASP.NET page that generates the email message's body.</span></span> <span data-ttu-id="40af3-196">Tento kurz se zaměřuje na použití `SimpleMailWebEventProvider` třídy.</span><span class="sxs-lookup"><span data-stu-id="40af3-196">This tutorial focuses on using the `SimpleMailWebEventProvider` class.</span></span>

<span data-ttu-id="40af3-197">Aktualizujte `<providers>` prvek systému monitorování stavu v souboru `Web.config` tak, aby zahrnoval zdroj protokolu pro třídu `SimpleMailWebEventProvider`:</span><span class="sxs-lookup"><span data-stu-id="40af3-197">Update the health monitoring system's `<providers>` element in the `Web.config` file to include a log source for the `SimpleMailWebEventProvider` class:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample3.xml)]

<span data-ttu-id="40af3-198">Výše uvedený kód používá třídu `SimpleMailWebEventProvider` jako poskytovatele zdroje protokolu a přiřadí mu popisný název "EmailWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="40af3-198">The above markup uses the `SimpleMailWebEventProvider` class as the log source provider, and assigns it the friendly name "EmailWebEventProvider".</span></span> <span data-ttu-id="40af3-199">Kromě toho atribut `<add>` obsahuje další možnosti konfigurace, jako jsou adresy a a z e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="40af3-199">Moreover, the `<add>` attribute includes additional configuration options, such as the To and From addresses of the email message.</span></span>

<span data-ttu-id="40af3-200">Po definování zdroje protokolu e-mailu je to vše, co je potřeba k tomu, aby systém monitorování stavu používal tento zdroj k neošetřeným výjimkám protokolu.</span><span class="sxs-lookup"><span data-stu-id="40af3-200">With the email log source defined, all that remains is to instruct the health monitoring system to use this source to "log" unhandled exceptions.</span></span> <span data-ttu-id="40af3-201">Toho je možné dosáhnout přidáním nového pravidla do části `<rules>`:</span><span class="sxs-lookup"><span data-stu-id="40af3-201">This is accomplished by adding a new rule in the `<rules>` section:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample4.xml)]

<span data-ttu-id="40af3-202">Oddíl `<rules>` nyní obsahuje dvě pravidla.</span><span class="sxs-lookup"><span data-stu-id="40af3-202">The `<rules>` section now includes two rules.</span></span> <span data-ttu-id="40af3-203">První z nich s názvem "všechny chyby na E-mail" pošle všechny neošetřené výjimky do zdroje protokolu "EmailWebEventProvider".</span><span class="sxs-lookup"><span data-stu-id="40af3-203">The first one, named "All Errors To Email", sends all unhandled exceptions to the "EmailWebEventProvider" log source.</span></span> <span data-ttu-id="40af3-204">Toto pravidlo má vliv na odeslání podrobností o chybách na webu do zadané adresy.</span><span class="sxs-lookup"><span data-stu-id="40af3-204">This rule has the effect of sending details about errors on the website to the specified To address.</span></span> <span data-ttu-id="40af3-205">Pravidlo "všechny chyby na databázi" protokoluje podrobnosti o chybě do databáze lokality.</span><span class="sxs-lookup"><span data-stu-id="40af3-205">The "All Errors To Database" rule logs the error details to the site's database.</span></span> <span data-ttu-id="40af3-206">V důsledku toho dojde při každém výskytu neošetřené výjimky na webu k tomu, že se v databázi protokolují obě podrobnosti a odešlou se na zadanou e-mailovou adresu.</span><span class="sxs-lookup"><span data-stu-id="40af3-206">Consequently, whenever an unhandled exception occurs on the site its details are both logged to the database and sent to specified email address.</span></span>

<span data-ttu-id="40af3-207">**Obrázek 2** ukazuje e-mail generovaný při `SimpleMailWebEventProvider` třídy při návštěvě `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="40af3-207">**Figure 2** shows the email generated by the `SimpleMailWebEventProvider` class when visiting `Genre.aspx?ID=foo`.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image4.png)

<span data-ttu-id="40af3-208">**Obrázek 2**: podrobnosti o chybě se odesílají v e-mailové zprávě.</span><span class="sxs-lookup"><span data-stu-id="40af3-208">**Figure 2**: The Error Details are Sent in an Email Message</span></span>  
<span data-ttu-id="40af3-209">([Kliknutím zobrazíte obrázek v plné velikosti.](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="40af3-209">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span></span>

## <a name="summary"></a><span data-ttu-id="40af3-210">Přehled</span><span class="sxs-lookup"><span data-stu-id="40af3-210">Summary</span></span>

<span data-ttu-id="40af3-211">Systém sledování stavu ASP.NET je navržený tak, aby správcům umožnil monitorovat stav nasazené webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="40af3-211">The ASP.NET health monitoring system is designed to allow administrators to monitor the health of a deployed web application.</span></span> <span data-ttu-id="40af3-212">Události monitorování stavu jsou vyvolány, když jsou určité akce odložení, například při zastavení aplikace, když se uživatel úspěšně přihlásí k webu nebo když dojde k neošetřené výjimce.</span><span class="sxs-lookup"><span data-stu-id="40af3-212">Health monitoring events are raised when certain actions unfold, such as when the application stops, when a user successfully logs onto the site, or when an unhandled exception occurs.</span></span> <span data-ttu-id="40af3-213">Tyto události mohou být protokolovány do libovolného počtu zdrojů protokolů.</span><span class="sxs-lookup"><span data-stu-id="40af3-213">These events can be logged to any number of log sources.</span></span> <span data-ttu-id="40af3-214">Tento kurz ukázal, jak protokolovat podrobnosti neošetřených výjimek do databáze a prostřednictvím e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="40af3-214">This tutorial showed how to log the details of unhandled exceptions to a database and through an email message.</span></span>

<span data-ttu-id="40af3-215">Tento kurz se zaměřuje na použití sledování stavu k protokolování neošetřených výjimek, ale mějte na paměti, že monitorování stavu je navržené tak, aby měřilo celkový stav nasazené aplikace v ASP.NET a zahrnuje širokou řadu událostí monitorování stavu a zdrojů protokolů, které nejsou Prozkoumejte tady.</span><span class="sxs-lookup"><span data-stu-id="40af3-215">This tutorial focused on using health monitoring to log unhandled exceptions, but keep in mind that health monitoring is designed to measure the overall health of a deployed ASP.NET application and includes a wealth of health monitoring events and log sources not explored here.</span></span> <span data-ttu-id="40af3-216">A co víc, můžete vytvořit vlastní události monitorování stavu a zdroje protokolů, které by měly nastat.</span><span class="sxs-lookup"><span data-stu-id="40af3-216">What's more, you can create your own health monitoring events and log sources, should the need arise.</span></span> <span data-ttu-id="40af3-217">Pokud vás zajímá Další informace o monitorování stavu, je dobrým prvním krokem Přečtěte si [Nejčastější dotazy k monitorování stavu](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx) [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span><span class="sxs-lookup"><span data-stu-id="40af3-217">If you are interested in learning more about health monitoring, a good first step is to read through [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)'s [health monitoring FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span></span> <span data-ttu-id="40af3-218">Postup najdete v tématu [Postupy: použití monitorování stavu v ASP.NET 2,0](https://msdn.microsoft.com/library/ms998306.aspx).</span><span class="sxs-lookup"><span data-stu-id="40af3-218">Following that, consult [How To: Use Health Monitoring in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span></span>

<span data-ttu-id="40af3-219">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="40af3-219">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="40af3-220">Další čtení</span><span class="sxs-lookup"><span data-stu-id="40af3-220">Further Reading</span></span>

<span data-ttu-id="40af3-221">Další informace o tématech popsaných v tomto kurzu najdete v následujících zdrojích informací:</span><span class="sxs-lookup"><span data-stu-id="40af3-221">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="40af3-222">Přehled monitorování stavu ASP.NET</span><span class="sxs-lookup"><span data-stu-id="40af3-222">ASP.NET Health Monitoring Overview</span></span>](https://msdn.microsoft.com/library/bb398933.aspx)
- [<span data-ttu-id="40af3-223">Konfigurace a přizpůsobení systému monitorování stavu ASP.NET</span><span class="sxs-lookup"><span data-stu-id="40af3-223">Configuring and Customizing the Health Monitoring System of ASP.NET</span></span>](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [<span data-ttu-id="40af3-224">Nejčastější dotazy týkající se monitorování stavu v ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="40af3-224">FAQ - Health Monitoring in ASP.NET 2.0</span></span>](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [<span data-ttu-id="40af3-225">Postupy: odesílání e-mailů pro oznámení monitorování stavu</span><span class="sxs-lookup"><span data-stu-id="40af3-225">How To: Send E-Mail for Health Monitoring Notifications</span></span>](https://msdn.microsoft.com/library/ms227553.aspx)
- [<span data-ttu-id="40af3-226">Postupy: použití monitorování stavu v ASP.NET</span><span class="sxs-lookup"><span data-stu-id="40af3-226">How To: Use Health Monitoring in ASP.NET</span></span>](https://msdn.microsoft.com/library/ms998306.aspx)
- [<span data-ttu-id="40af3-227">Monitorování stavu v ASP.NET</span><span class="sxs-lookup"><span data-stu-id="40af3-227">Health Monitoring in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="40af3-228">[Předchozí](processing-unhandled-exceptions-cs.md)
> [Další](logging-error-details-with-elmah-cs.md)</span><span class="sxs-lookup"><span data-stu-id="40af3-228">[Previous](processing-unhandled-exceptions-cs.md)
[Next](logging-error-details-with-elmah-cs.md)</span></span>
