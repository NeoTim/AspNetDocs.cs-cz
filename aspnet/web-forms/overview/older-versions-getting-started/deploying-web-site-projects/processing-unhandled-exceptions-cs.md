---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
title: Zpracování neošetřených výjimek (C#) | Microsoft Docs
author: rick-anderson
description: Pokud dojde k chybě za běhu u webové aplikace v produkčním prostředí, je důležité informovat vývojáře a protokolovat chybu, aby mohla být diagnostikována v La...
ms.author: riande
ms.date: 06/09/2009
ms.assetid: 5bc1afd5-2484-4528-b158-ab218ba150e8
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs
msc.type: authoredcontent
ms.openlocfilehash: 27d827238d944f86cd913d2b8ecd12729b99f391
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78629267"
---
# <a name="processing-unhandled-exceptions-c"></a><span data-ttu-id="dab3e-103">Zpracování neošetřených výjimek (C#)</span><span class="sxs-lookup"><span data-stu-id="dab3e-103">Processing Unhandled Exceptions (C#)</span></span>

<span data-ttu-id="dab3e-104">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="dab3e-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="dab3e-105">[Zobrazit nebo stáhnout ukázkový kód](https://github.com/dotnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) ([Jak stáhnout](/aspnet/core/tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="dab3e-105">[View or download sample code](https://github.com/dotnet/AspNetDocs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-cs/samples) ([how to download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span></span>

> <span data-ttu-id="dab3e-106">Pokud dojde k běhové chybě na webové aplikaci v produkčním prostředí, je důležité informovat vývojáře a protokolovat chybu, aby mohla být diagnostikována v pozdějším časovém bodě.</span><span class="sxs-lookup"><span data-stu-id="dab3e-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="dab3e-107">Tento kurz poskytuje přehled o tom, jak ASP.NET zpracovává běhové chyby a vypadá jedním ze způsobů, jak mít vlastní kód proveden kdykoli po neošetřené bublině výjimky až do modulu runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="dab3e-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>

## <a name="introduction"></a><span data-ttu-id="dab3e-108">Úvod</span><span class="sxs-lookup"><span data-stu-id="dab3e-108">Introduction</span></span>

<span data-ttu-id="dab3e-109">Pokud dojde k neošetřené výjimce v aplikaci ASP.NET, poukáže se až na modul runtime ASP.NET, který vyvolá událost `Error` a zobrazí příslušnou chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="dab3e-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="dab3e-110">Existují tři různé typy chybových stránek: Chyba za běhu žlutá obrazovka smrti (YSOD); Podrobnosti výjimky YSOD; a vlastní chybové stránky.</span><span class="sxs-lookup"><span data-stu-id="dab3e-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="dab3e-111">V [předchozím kurzu](displaying-a-custom-error-page-cs.md) jsme nakonfigurovali aplikaci tak, aby pro vzdálené uživatele používala vlastní chybovou stránku, a podrobnosti o výjimce YSOD pro uživatele, kteří navštěvují místně.</span><span class="sxs-lookup"><span data-stu-id="dab3e-111">In the [preceding tutorial](displaying-a-custom-error-page-cs.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="dab3e-112">Použití vlastní uživatelsky přívětivé chybové stránky, která se shoduje s vzhledem a chováním webu, je preferována Výchozí chyba modulu runtime YSOD, ale zobrazení vlastní chybové stránky je jenom jedna část komplexního řešení pro zpracování chyb.</span><span class="sxs-lookup"><span data-stu-id="dab3e-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="dab3e-113">Pokud dojde k chybě v aplikaci v produkčním prostředí, je důležité, aby byli vývojáři upozorněni na chybu, aby mohli odstát příčinu výjimky a vyřešit ji.</span><span class="sxs-lookup"><span data-stu-id="dab3e-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="dab3e-114">Kromě toho by se měly zaprotokolovat podrobnosti o chybě, aby bylo možné chybu prozkoumat a diagnostikovat v pozdějším časovém bodě.</span><span class="sxs-lookup"><span data-stu-id="dab3e-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="dab3e-115">V tomto kurzu se dozvíte, jak získat přístup k podrobnostem o neošetřené výjimce tak, aby mohly být zaprotokolovány a vývojář upozorněni.</span><span class="sxs-lookup"><span data-stu-id="dab3e-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="dab3e-116">V těchto dvou kurzech, které následují po provedení této akce, prozkoumejte knihovny protokolování chyb, které po bitu konfigurace automaticky upozorní vývojáře na chyby za běhu a zaprotokolují jejich podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="dab3e-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="dab3e-117">Informace, které jsou zkoumány v tomto kurzu, jsou nejužitečnější, pokud potřebujete zpracovat neošetřené výjimky v některém jedinečném nebo vlastním přizpůsobeném způsobem.</span><span class="sxs-lookup"><span data-stu-id="dab3e-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="dab3e-118">V případech, kdy stačí pouze zaprotokolovat výjimku a odeslat oznamovateli výstrahu pomocí knihovny protokolování chyb, je způsob, jak jít.</span><span class="sxs-lookup"><span data-stu-id="dab3e-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="dab3e-119">Další dva kurzy poskytují přehled dvou takových knihoven.</span><span class="sxs-lookup"><span data-stu-id="dab3e-119">The next two tutorials provide an overview of two such libraries.</span></span>

## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="dab3e-120">Spouštění kódu při vyvolání události`Error`</span><span class="sxs-lookup"><span data-stu-id="dab3e-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="dab3e-121">Události poskytují objekt mechanismus pro signalizaci, že došlo k něčemu nějakého zajímavého, a pro jiný objekt ke spuštění kódu v reakci.</span><span class="sxs-lookup"><span data-stu-id="dab3e-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="dab3e-122">Jako vývojář ASP.NET jste zvyklí v souvislosti s událostmi.</span><span class="sxs-lookup"><span data-stu-id="dab3e-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="dab3e-123">Pokud chcete spustit nějaký kód, když návštěvník klikne na konkrétní tlačítko, vytvoříte obslužnou rutinu události pro `Click` událost tlačítka a umístíte svůj kód.</span><span class="sxs-lookup"><span data-stu-id="dab3e-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="dab3e-124">Vzhledem k tomu, že modul runtime ASP.NET vyvolává svou [událost`Error`](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) vždy, když dojde k neošetřené výjimce, následuje postup, který by měl kód pro protokolování podrobností o chybě jít v obslužné rutině události.</span><span class="sxs-lookup"><span data-stu-id="dab3e-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="dab3e-125">Ale jak vytvoříte obslužnou rutinu události pro událost `Error`?</span><span class="sxs-lookup"><span data-stu-id="dab3e-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="dab3e-126">Událost `Error` je jednou z mnoha událostí ve [třídě`HttpApplication`](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) , která se vyvolala v určitých fázích kanálu http během životnosti žádosti.</span><span class="sxs-lookup"><span data-stu-id="dab3e-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="dab3e-127">Například [událost`BeginRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) `HttpApplication` třídy je vyvolána na začátku každého požadavku; jeho [událost`AuthenticateRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) je vyvolána, když modul zabezpečení identifikoval žadatele.</span><span class="sxs-lookup"><span data-stu-id="dab3e-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="dab3e-128">Tyto `HttpApplication` události dávají vývojářům stránky způsob, jak provádět vlastní logiku v různých místech životního cyklu žádosti.</span><span class="sxs-lookup"><span data-stu-id="dab3e-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="dab3e-129">Obslužné rutiny událostí `HttpApplication` lze umístit do speciálního souboru s názvem `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="dab3e-130">Chcete-li vytvořit tento soubor na svém webu, přidejte novou položku do kořenového adresáře webu pomocí šablony globální třídy aplikace s názvem `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-cs/_static/image2.png)](processing-unhandled-exceptions-cs/_static/image1.png)

<span data-ttu-id="dab3e-131">**Obrázek 1**: Přidání `Global.asax` do webové aplikace</span><span class="sxs-lookup"><span data-stu-id="dab3e-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
<span data-ttu-id="dab3e-132">([Kliknutím zobrazíte obrázek v plné velikosti.](processing-unhandled-exceptions-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="dab3e-132">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image3.png))</span></span>

<span data-ttu-id="dab3e-133">Obsah a struktura `Global.asax`ho souboru vytvořeného v aplikaci Visual Studio se mírně liší podle toho, zda používáte projekt webové aplikace (WAP) nebo webový projekt (WSP).</span><span class="sxs-lookup"><span data-stu-id="dab3e-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="dab3e-134">Pomocí WAP se `Global.asax` implementuje jako dva samostatné soubory – `Global.asax` a `Global.asax.cs`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.cs`.</span></span> <span data-ttu-id="dab3e-135">`Global.asax` soubor neobsahuje žádnou hodnotu, ale direktivu `@Application`, která odkazuje na soubor `.cs`; obslužné rutiny událostí pro důležité jsou definovány v souboru `Global.asax.cs`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.cs` file; the event handlers of interest are defined in the `Global.asax.cs` file.</span></span> <span data-ttu-id="dab3e-136">Pro WSPs je vytvořen pouze jeden soubor, `Global.asax`a obslužné rutiny událostí jsou definovány v bloku `<script runat="server">`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="dab3e-137">`Global.asax` soubor vytvořený v šabloně WAP šablonou globální třídy aplikace sady Visual Studio obsahuje obslužné rutiny událostí s názvem `Application_BeginRequest`, `Application_AuthenticateRequest`a `Application_Error`, které jsou obslužnými rutinami událostí `HttpApplication` `BeginRequest`, `AuthenticateRequest`a `Error`v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="dab3e-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="dab3e-138">K dispozici jsou také obslužné rutiny událostí s názvem `Application_Start`, `Session_Start`, `Application_End`a `Session_End`, což jsou obslužné rutiny událostí, které se aktivují při spuštění webové aplikace, při spuštění nové relace, při ukončení aplikace a ukončení relace v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="dab3e-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="dab3e-139">`Global.asax` soubor vytvořený v WSP pomocí sady Visual Studio obsahuje jenom obslužné rutiny událostí `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`a `Session_End`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="dab3e-140">Při nasazování aplikace ASP.NET potřebujete zkopírovat soubor `Global.asax` do provozního prostředí.</span><span class="sxs-lookup"><span data-stu-id="dab3e-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="dab3e-141">`Global.asax.cs` soubor, který je vytvořen v WAP, není nutné kopírovat do produkčního prostředí, protože tento kód je zkompilován do sestavení projektu.</span><span class="sxs-lookup"><span data-stu-id="dab3e-141">The `Global.asax.cs` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>

<span data-ttu-id="dab3e-142">Obslužné rutiny událostí vytvořené šablonou globální třídy aplikace sady Visual Studio nejsou vyčerpávající.</span><span class="sxs-lookup"><span data-stu-id="dab3e-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="dab3e-143">Můžete přidat obslužnou rutinu události pro jakoukoli událost `HttpApplication` pojmenováním `Application_EventName`obslužné rutiny události.</span><span class="sxs-lookup"><span data-stu-id="dab3e-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="dab3e-144">Do souboru `Global.asax` například můžete přidat následující kód, který vytvoří obslužnou rutinu události pro [událost`AuthorizeRequest`](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="dab3e-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-cs[Main](processing-unhandled-exceptions-cs/samples/sample1.cs)]

<span data-ttu-id="dab3e-145">Podobně můžete odebrat jakékoli obslužné rutiny událostí vytvořené šablonou globální třídy aplikace, které nejsou potřeba.</span><span class="sxs-lookup"><span data-stu-id="dab3e-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="dab3e-146">Pro tento kurz vyžadujeme pro událost `Error` jenom obslužnou rutinu události; Nebojte se odebrat další obslužné rutiny událostí ze souboru `Global.asax`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="dab3e-147">*Moduly HTTP* nabízejí jiný způsob definování obslužných rutin událostí pro `HttpApplication` události.</span><span class="sxs-lookup"><span data-stu-id="dab3e-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="dab3e-148">Moduly HTTP jsou vytvořeny jako soubor třídy, který lze umístit přímo do projektu webové aplikace nebo rozdělit do samostatné knihovny tříd.</span><span class="sxs-lookup"><span data-stu-id="dab3e-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="dab3e-149">Vzhledem k tomu, že je možné je rozdělit do knihovny tříd, moduly HTTP nabízejí flexibilnější a opakovaně použitelný model pro vytváření obslužných rutin událostí `HttpApplication`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="dab3e-150">Vzhledem k tomu, že `Global.asax` soubor je specifický pro webovou aplikaci, ve které se nachází, moduly HTTP lze zkompilovat do sestavení, kdy je potřeba přidat modul HTTP na web stejně snadno jako vyřazení sestavení ve složce `Bin` a registrace modulu v `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="dab3e-151">Tento kurz se nezobrazuje při vytváření a používání modulů HTTP, ale dvě knihovny protokolování chyb, které se používají v následujících dvou kurzech, se implementují jako moduly HTTP.</span><span class="sxs-lookup"><span data-stu-id="dab3e-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="dab3e-152">Další informace o výhodách modulů HTTP najdete v tématu [použití modulů HTTP a obslužných rutin k vytvoření zapojitelné součásti ASP.NET](https://msdn.microsoft.com/library/aa479332.aspx).</span><span class="sxs-lookup"><span data-stu-id="dab3e-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>

## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="dab3e-153">Načítají se informace o neošetřené výjimce.</span><span class="sxs-lookup"><span data-stu-id="dab3e-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="dab3e-154">V tomto okamžiku máme soubor Global. asax s obslužnou rutinou události `Application_Error`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="dab3e-155">Když se spustí Tato obslužná rutina události, musíme sdělit vývojářům chybu a zaznamenat její podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="dab3e-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="dab3e-156">Aby bylo možné tyto úlohy provést, je nejdříve potřeba určit podrobnosti o výjimce, která byla vyvolána.</span><span class="sxs-lookup"><span data-stu-id="dab3e-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="dab3e-157">K načtení podrobností o neošetřené výjimce, která způsobila vyvolání události `Error`, použijte [metodu`GetLastError`](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) objektu serveru.</span><span class="sxs-lookup"><span data-stu-id="dab3e-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample2.cs)]

<span data-ttu-id="dab3e-158">Metoda `GetLastError` vrátí objekt typu `Exception`, což je základní typ pro všechny výjimky v .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="dab3e-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="dab3e-159">Nicméně v kódu výše přetypování objekt výjimky vrácený `GetLastError` do objektu `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="dab3e-160">Pokud dojde k vyvolání události `Error`, protože při zpracování prostředku ASP.NET došlo k výjimce, vyvolaná výjimka je zabalena do `HttpException`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="dab3e-161">Chcete-li získat skutečnou výjimku, která vyvolala událost chyby, použijte vlastnost `InnerException`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="dab3e-162">Pokud byla událost `Error` vyvolána z důvodu výjimky založené na protokolu HTTP, jako je například požadavek na neexistující stránku, je vyvolána `HttpException`, ale nemá vnitřní výjimku.</span><span class="sxs-lookup"><span data-stu-id="dab3e-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="dab3e-163">Následující kód používá `GetLastErrormessage` k načtení informací o výjimce, která aktivovala událost `Error` a uložení `HttpException` do proměnné s názvem `lastErrorWrapper`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="dab3e-164">Poté uloží typ, zprávu a trasování zásobníku z prvotní výjimky ve třech proměnných řetězce, zkontroluje, zda je `lastErrorWrapper` skutečnou výjimkou, která aktivovala událost `Error` (v případě výjimek založených na protokolu HTTP), nebo je pouze obálkou pro výjimku, která byla vyvolána při zpracování žádosti.</span><span class="sxs-lookup"><span data-stu-id="dab3e-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample3.cs)]

<span data-ttu-id="dab3e-165">V tomto okamžiku máte všechny informace, které potřebujete k psaní kódu, který bude protokolovat podrobnosti o výjimce do databázové tabulky.</span><span class="sxs-lookup"><span data-stu-id="dab3e-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="dab3e-166">Můžete vytvořit databázovou tabulku se sloupci pro každou z podrobností o chybě, která je zajímavá – typ, zprávu, trasování zásobníku a tak dále, a další užitečné informace, jako je adresa URL požadované stránky a jméno aktuálně přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="dab3e-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="dab3e-167">V `Application_Error` obslužné rutině události se pak můžete připojit k databázi a vložit do tabulky záznam.</span><span class="sxs-lookup"><span data-stu-id="dab3e-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="dab3e-168">Podobně můžete přidat kód pro upozornění vývojáře chyby prostřednictvím e-mailu.</span><span class="sxs-lookup"><span data-stu-id="dab3e-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="dab3e-169">Knihovny protokolování chyb v následujících dvou kurzech poskytují funkce, které jsou vyhodnoceny jako dostupné, takže není potřeba sestavovat Toto protokolování chyb a oznámení sami.</span><span class="sxs-lookup"><span data-stu-id="dab3e-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="dab3e-170">Nicméně pro ilustraci, že je vyvolána událost `Error` a že se obslužná rutina `Application_Error` události dá použít k protokolování podrobností o chybách a oznámení vývojáři, přidáme kód, který upozorní vývojáře, když dojde k chybě.</span><span class="sxs-lookup"><span data-stu-id="dab3e-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="dab3e-171">Upozorňování vývojáře, když dojde k neošetřené výjimce</span><span class="sxs-lookup"><span data-stu-id="dab3e-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="dab3e-172">Pokud dojde k neošetřené výjimce v produkčním prostředí, je důležité upozornit vývojového týmu, aby mohli vyhodnotit chybu a určit, jaké akce je třeba provést.</span><span class="sxs-lookup"><span data-stu-id="dab3e-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="dab3e-173">Například pokud dojde k chybě při připojování k databázi, budete muset dvakrát ověřit připojovací řetězec a případně otevřít lístek podpory ve vaší společnosti pro hostování vašeho webu.</span><span class="sxs-lookup"><span data-stu-id="dab3e-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="dab3e-174">Pokud došlo k výjimce z důvodu chyby programování, může být nutné přidat další kód nebo logiku ověřování, aby se předešlo takovým chybám v budoucnu.</span><span class="sxs-lookup"><span data-stu-id="dab3e-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="dab3e-175">.NET Framework třídy v [oboru názvů`System.Net.Mail`](https://msdn.microsoft.com/library/system.net.mail.aspx) usnadňují posílání e-mailů.</span><span class="sxs-lookup"><span data-stu-id="dab3e-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="dab3e-176">[Třída`MailMessage`](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) představuje e-mailovou zprávu a má vlastnosti jako `To`, `From`, `Subject`, `Body`a `Attachments`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="dab3e-177">`SmtpClass` slouží k odeslání objektu `MailMessage` pomocí zadaného serveru SMTP; nastavení serveru SMTP lze zadat programově nebo deklarativně v [prvku`<system.net>`](https://msdn.microsoft.com/library/6484zdc1.aspx) v `Web.config file`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="dab3e-178">Další informace o posílání e-mailových zpráv v aplikaci ASP.NET najdete v článku o [posílání e-mailů v ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)a v tématu [Nejčastější dotazy k System .NET. mailu](http://systemnetmail.com/).</span><span class="sxs-lookup"><span data-stu-id="dab3e-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="dab3e-179">Element `<system.net>` obsahuje nastavení serveru SMTP používaného třídou `SmtpClient` při posílání e-mailu.</span><span class="sxs-lookup"><span data-stu-id="dab3e-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="dab3e-180">Vaše společnost hostující váš web má pravděpodobně server SMTP, který můžete použít k odeslání e-mailu z aplikace.</span><span class="sxs-lookup"><span data-stu-id="dab3e-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="dab3e-181">Informace o nastaveních serveru SMTP, která byste měli použít ve své webové aplikaci, najdete v části věnované podpoře svého webového hostitele.</span><span class="sxs-lookup"><span data-stu-id="dab3e-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>

<span data-ttu-id="dab3e-182">Přidejte následující kód do obslužné rutiny události `Application_Error` k odeslání e-mailu vývojáři, když dojde k chybě:</span><span class="sxs-lookup"><span data-stu-id="dab3e-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample4.cs)]

<span data-ttu-id="dab3e-183">I když je výše uvedený kód poměrně dlouhý, je hromadně vytvořen kód HTML, který se zobrazí v e-mailu odeslanému vývojáři.</span><span class="sxs-lookup"><span data-stu-id="dab3e-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="dab3e-184">Kód začíná odkazem na `HttpException` vrácenou metodou `GetLastError` (`lastErrorWrapper`).</span><span class="sxs-lookup"><span data-stu-id="dab3e-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="dab3e-185">Skutečná výjimka, která byla vyvolána požadavkem, je načtena prostřednictvím `lastErrorWrapper.InnerException` a je přiřazena k proměnné `lastError`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="dab3e-186">Informace o typu, zprávě a trasování zásobníku jsou načteny z `lastError` a uloženy ve třech řetězcových proměnných.</span><span class="sxs-lookup"><span data-stu-id="dab3e-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="dab3e-187">Dále je vytvořen objekt `MailMessage` s názvem `mm`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="dab3e-188">Tělo e-mailu je formátováno ve formátu HTML a zobrazuje adresu URL požadované stránky, jméno aktuálně přihlášeného uživatele a informace o výjimce (typ, zpráva a trasování zásobníku).</span><span class="sxs-lookup"><span data-stu-id="dab3e-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="dab3e-189">Jednou ze studených věcí o `HttpException` třídy je, že můžete vygenerovat kód HTML, který se používá k vytvoření podrobného povýšení obrazovky s podrobnostmi o smrti (YSOD) voláním [metody GetHtmlErrorMessage](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span><span class="sxs-lookup"><span data-stu-id="dab3e-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="dab3e-190">Tato metoda se tady používá k načtení podrobností o výjimce YSOD značky a jejímu přidání do e-mailu jako přílohy.</span><span class="sxs-lookup"><span data-stu-id="dab3e-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="dab3e-191">Jedno slovo s upozorněním: Pokud výjimka, která aktivovala událost `Error`, byla výjimkou založenou na protokolu HTTP (například požadavek na neexistující stránku), vrátí metoda `GetHtmlErrorMessage` `null`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="dab3e-192">Posledním krokem je odeslání `MailMessage`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="dab3e-193">To se provádí vytvořením nové metody `SmtpClient` a voláním její metody `Send`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="dab3e-194">Před použitím tohoto kódu ve webové aplikaci budete chtít změnit hodnoty v `ToAddress` a `FromAddress` konstanty z support@example.com na libovolnou e-mailovou adresu, ze které se má e-mail s oznámením o chybách Odeslat a odkud z něj pochází.</span><span class="sxs-lookup"><span data-stu-id="dab3e-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="dab3e-195">Také budete muset zadat nastavení serveru SMTP v části `<system.net>` v `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="dab3e-196">Pokud chcete zjistit, jaké nastavení serveru SMTP chcete použít, obraťte se na svého poskytovatele webového hostitele.</span><span class="sxs-lookup"><span data-stu-id="dab3e-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>

<span data-ttu-id="dab3e-197">V případě, že je tento kód na místě, kdy je k dispozici chyba, vývojář pošle e-mailovou zprávu, která shrnuje chybu a obsahuje YSOD.</span><span class="sxs-lookup"><span data-stu-id="dab3e-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="dab3e-198">V předchozím kurzu jsme ukázali chybu za běhu, a to návštěvou Žánr. aspx a předáním neplatné `ID`é hodnoty pomocí řetězce dotazu, jako je `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="dab3e-199">Navštívení stránky pomocí souboru `Global.asax` v místě přináší stejné uživatelské prostředí jako v předchozím kurzu – ve vývojovém prostředí budete nadále zobrazovat podrobnosti o výjimce žlutá obrazovka smrti, zatímco v produkčním prostředí uvidíte vlastní chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="dab3e-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="dab3e-200">Kromě tohoto existujícího chování vývojář posílá e-mail.</span><span class="sxs-lookup"><span data-stu-id="dab3e-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="dab3e-201">**Obrázek 2** ukazuje e-mail přijatý při návštěvě `Genre.aspx?ID=foo`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="dab3e-202">Tělo e-mailu shrnuje informace o výjimce, zatímco `YSOD.htm` příloha zobrazuje obsah zobrazený v podrobnostech výjimky YSOD (viz **Obrázek 3**).</span><span class="sxs-lookup"><span data-stu-id="dab3e-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image5.png)](processing-unhandled-exceptions-cs/_static/image4.png)

<span data-ttu-id="dab3e-203">**Obrázek 2**: vývojář pošle e-mailové oznámení vždy, když dojde k neošetřené výjimce.</span><span class="sxs-lookup"><span data-stu-id="dab3e-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
<span data-ttu-id="dab3e-204">([Kliknutím zobrazíte obrázek v plné velikosti.](processing-unhandled-exceptions-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="dab3e-204">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-cs/_static/image8.png)](processing-unhandled-exceptions-cs/_static/image7.png)

<span data-ttu-id="dab3e-205">**Obrázek 3**: e-mailové oznámení obsahují podrobnosti o výjimce YSOD jako příloha.</span><span class="sxs-lookup"><span data-stu-id="dab3e-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
<span data-ttu-id="dab3e-206">([Kliknutím zobrazíte obrázek v plné velikosti.](processing-unhandled-exceptions-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="dab3e-206">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="dab3e-207">Jak používat vlastní chybovou stránku?</span><span class="sxs-lookup"><span data-stu-id="dab3e-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="dab3e-208">Tento kurz ukázal způsob použití `Global.asax` a obslužné rutiny události `Application_Error` ke spuštění kódu, když dojde k neošetřené výjimce.</span><span class="sxs-lookup"><span data-stu-id="dab3e-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="dab3e-209">Konkrétně jsme tuto obslužnou rutinu události použili k oznamování vývojářů chyby. Můžeme ho roztáhnout, aby se do databáze zaprotokoloval také podrobnosti o chybě.</span><span class="sxs-lookup"><span data-stu-id="dab3e-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="dab3e-210">Přítomnost obslužné rutiny události `Application_Error` nemá vliv na činnost koncového uživatele.</span><span class="sxs-lookup"><span data-stu-id="dab3e-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="dab3e-211">Pořád uvidí konfigurovanou chybovou stránku, nastavili jsme podrobnosti o chybě YSOD, chyba modulu runtime YSOD nebo vlastní chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="dab3e-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="dab3e-212">Při použití vlastní chybové stránky je důležité, abyste si zajímá, jestli `Global.asax` soubor a `Application_Error` událost.</span><span class="sxs-lookup"><span data-stu-id="dab3e-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="dab3e-213">Pokud dojde k chybě, zobrazí se uživateli vlastní chybová stránka, takže nemůžeme vložit kód pro informování vývojáře a zaprotokolovat podrobnosti o chybách do třídy kódu na pozadí vlastní chybové stránky?</span><span class="sxs-lookup"><span data-stu-id="dab3e-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="dab3e-214">I když můžete přidat kód do třídy kódu na pozadí vlastní chybové stránky, nemáte přístup k podrobnostem o výjimce, která aktivovala událost `Error` při použití techniky, kterou jsme prozkoumali v předchozím kurzu.</span><span class="sxs-lookup"><span data-stu-id="dab3e-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="dab3e-215">Volání metody `GetLastError` z vlastní chybové stránky vrátí `Nothing`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="dab3e-216">Důvodem tohoto chování je, že vlastní chybová stránka se dorazí přes přesměrování.</span><span class="sxs-lookup"><span data-stu-id="dab3e-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="dab3e-217">Když Neošetřená výjimka dosáhne běhového prostředí ASP.NET, modul ASP.NET vyvolá událost `Error` (která spustí obslužnou rutinu události `Application_Error`) a poté *přesměruje* uživatele na vlastní chybovou stránku vyvoláním `Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="dab3e-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="dab3e-218">Metoda `Response.Redirect` odesílá klientovi odpověď se stavovým kódem HTTP 302, který instruuje prohlížeč, aby si vyžádal novou adresu URL, konkrétně vlastní chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="dab3e-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="dab3e-219">Prohlížeč pak tuto novou stránku automaticky vyžádá.</span><span class="sxs-lookup"><span data-stu-id="dab3e-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="dab3e-220">Můžete říct, že vlastní chybová stránka byla vyžádána nezávisle na stránce, kde došlo k chybě, protože se v adresním řádku prohlížeče změnila adresa URL vlastní chybové stránky (viz **Obrázek 4**).</span><span class="sxs-lookup"><span data-stu-id="dab3e-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-cs/_static/image11.png)](processing-unhandled-exceptions-cs/_static/image10.png)

<span data-ttu-id="dab3e-221">**Obrázek 4**: když dojde k chybě, prohlížeč se přesměruje na adresu URL vlastní chybové stránky.</span><span class="sxs-lookup"><span data-stu-id="dab3e-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
<span data-ttu-id="dab3e-222">([Kliknutím zobrazíte obrázek v plné velikosti.](processing-unhandled-exceptions-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="dab3e-222">([Click to view full-size image](processing-unhandled-exceptions-cs/_static/image12.png))</span></span>

<span data-ttu-id="dab3e-223">Čistým účinkem je to, že žádost, kde došlo k neošetřené výjimce, končí, když server odpoví pomocí přesměrování HTTP 302.</span><span class="sxs-lookup"><span data-stu-id="dab3e-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="dab3e-224">Následující požadavek na vlastní chybovou stránku je zcela nový požadavek. v tomto okamžiku modul ASP.NET zahodil informace o chybě, a navíc nemá žádný způsob, jak přidružit neošetřenou výjimku v předchozí žádosti s novým požadavkem na vlastní chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="dab3e-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="dab3e-225">To je důvod, proč `GetLastError` vrátí `null` při volání z vlastní chybové stránky.</span><span class="sxs-lookup"><span data-stu-id="dab3e-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="dab3e-226">Je ale možné, že se vlastní chybová stránka spustí během stejné žádosti, která způsobila chybu.</span><span class="sxs-lookup"><span data-stu-id="dab3e-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="dab3e-227">Metoda [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) přenáší provádění na zadanou adresu URL a zpracuje ji v rámci stejné žádosti.</span><span class="sxs-lookup"><span data-stu-id="dab3e-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="dab3e-228">Můžete přesunout kód v obslužné rutině události `Application_Error` do třídy s kódem na pozadí vlastní chybové stránky a nahradit ji v `Global.asax` následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="dab3e-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-csharp[Main](processing-unhandled-exceptions-cs/samples/sample5.cs)]

<span data-ttu-id="dab3e-229">Nyní když dojde k neošetřené výjimce, obslužná rutina události `Application_Error` přenáší řízení na příslušnou vlastní chybovou stránku na základě stavového kódu HTTP.</span><span class="sxs-lookup"><span data-stu-id="dab3e-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="dab3e-230">Vzhledem k tomu, že došlo k přenosu ovládacího prvku, vlastní chybová stránka má přístup k neošetřeným informacím o výjimce prostřednictvím `Server.GetLastError` a může oznamovateli informovat vývojáře o chybě a zaznamenat její podrobnosti.</span><span class="sxs-lookup"><span data-stu-id="dab3e-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="dab3e-231">`Server.Transfer` volání zastaví modul ASP.NET před přesměrováním uživatele na vlastní chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="dab3e-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="dab3e-232">Místo toho se jako odpověď na stránku, která generovala chybu, vrátí obsah vlastní chybové stránky.</span><span class="sxs-lookup"><span data-stu-id="dab3e-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="dab3e-233">Souhrn</span><span class="sxs-lookup"><span data-stu-id="dab3e-233">Summary</span></span>

<span data-ttu-id="dab3e-234">Pokud dojde k neošetřené výjimce ve webové aplikaci ASP.NET, modul runtime ASP.NET vyvolá událost `Error` a zobrazí nakonfigurovanou chybovou stránku.</span><span class="sxs-lookup"><span data-stu-id="dab3e-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="dab3e-235">Pro tuto chybu můžeme oznamovatele informovat, zaznamenat její podrobnosti nebo je zpracovat jiným způsobem tak, že vytvoříte obslužnou rutinu události pro událost Error.</span><span class="sxs-lookup"><span data-stu-id="dab3e-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="dab3e-236">Existují dva způsoby, jak vytvořit obslužnou rutinu události pro `HttpApplication` události jako `Error`: v souboru `Global.asax` nebo v modulu HTTP.</span><span class="sxs-lookup"><span data-stu-id="dab3e-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="dab3e-237">V tomto kurzu jste si ukázali, jak vytvořit obslužnou rutinu události `Error` v souboru `Global.asax`, která vývojářům oznamuje chybu prostřednictvím e-mailové zprávy.</span><span class="sxs-lookup"><span data-stu-id="dab3e-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="dab3e-238">Vytvoření obslužné rutiny události `Error` je užitečné, pokud potřebujete zpracovat neošetřené výjimky v některém jedinečném nebo vlastním přizpůsobeném způsobem.</span><span class="sxs-lookup"><span data-stu-id="dab3e-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="dab3e-239">Nicméně vytvoření vlastní obslužné rutiny události `Error` k zaznamenání výjimky nebo pro informování vývojáře není nejúčinnějším využitím času, protože již existuje a snadno se používají knihovny protokolování chyb, které je možné nastavit během několika minut.</span><span class="sxs-lookup"><span data-stu-id="dab3e-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="dab3e-240">Další dva kurzy prozkoumají dvě takové knihovny.</span><span class="sxs-lookup"><span data-stu-id="dab3e-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="dab3e-241">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="dab3e-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="dab3e-242">Další čtení</span><span class="sxs-lookup"><span data-stu-id="dab3e-242">Further Reading</span></span>

<span data-ttu-id="dab3e-243">Další informace o tématech popsaných v tomto kurzu najdete v následujících zdrojích informací:</span><span class="sxs-lookup"><span data-stu-id="dab3e-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="dab3e-244">ASP.NET moduly HTTP a obslužné rutiny HTTP – přehled</span><span class="sxs-lookup"><span data-stu-id="dab3e-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="dab3e-245">Řádně reagovat na neošetřené výjimky zpracování neošetřených výjimek</span><span class="sxs-lookup"><span data-stu-id="dab3e-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="dab3e-246">Třída `HttpApplication` a objekt aplikace ASP.NET</span><span class="sxs-lookup"><span data-stu-id="dab3e-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="dab3e-247">Obslužné rutiny HTTP a moduly HTTP v ASP.NET</span><span class="sxs-lookup"><span data-stu-id="dab3e-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="dab3e-248">Odesílání e-mailů v ASP.NET</span><span class="sxs-lookup"><span data-stu-id="dab3e-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="dab3e-249">Princip souboru `Global.asax`</span><span class="sxs-lookup"><span data-stu-id="dab3e-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="dab3e-250">Použití modulů a obslužných rutin HTTP k vytvoření zapojitelné součásti ASP.NET</span><span class="sxs-lookup"><span data-stu-id="dab3e-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="dab3e-251">Práce se souborem `Global.asax` ASP.NET</span><span class="sxs-lookup"><span data-stu-id="dab3e-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="dab3e-252">Práce s instancemi `HttpApplication`</span><span class="sxs-lookup"><span data-stu-id="dab3e-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="dab3e-253">[Předchozí](displaying-a-custom-error-page-cs.md)
> [Další](logging-error-details-with-asp-net-health-monitoring-cs.md)</span><span class="sxs-lookup"><span data-stu-id="dab3e-253">[Previous](displaying-a-custom-error-page-cs.md)
[Next](logging-error-details-with-asp-net-health-monitoring-cs.md)</span></span>
