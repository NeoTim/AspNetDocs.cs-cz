---
uid: web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12
title: 'Nasazení webové aplikace ASP.NET s SQL serverem Compact pomocí sady Visual Studio nebo Visual Web Developer: Nasazení aktualizace databáze - 9 12 | Dokumentace Microsoftu'
author: tdykstra
description: Tato série kurzů se dozvíte, jak nasadit (publikovat) technologie ASP.NET, která obsahuje databázi systému SQL Server Compact pomocí Visual samostatného projektu webové aplikace...
ms.author: riande
ms.date: 11/17/2011
ms.assetid: a8d776af-4735-4612-87f6-9f326587f2d3
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deployment-to-a-hosting-provider/deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12
msc.type: authoredcontent
ms.openlocfilehash: 3a5600aff3ba63cb7046e42d0bfd587c4181d99e
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/06/2019
ms.locfileid: "65130275"
---
# <a name="deploying-an-aspnet-web-application-with-sql-server-compact-using-visual-studio-or-visual-web-developer-deploying-a-database-update---9-of-12"></a><span data-ttu-id="8885d-103">Nasazení webové aplikace ASP.NET s SQL serverem Compact pomocí sady Visual Studio nebo Visual Web Developer: Nasazení aktualizace databáze - 9 12</span><span class="sxs-lookup"><span data-stu-id="8885d-103">Deploying an ASP.NET Web Application with SQL Server Compact using Visual Studio or Visual Web Developer: Deploying a Database Update - 9 of 12</span></span>

<span data-ttu-id="8885d-104">podle [Petr Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="8885d-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

[<span data-ttu-id="8885d-105">Stáhnout počáteční projekt</span><span class="sxs-lookup"><span data-stu-id="8885d-105">Download Starter Project</span></span>](http://code.msdn.microsoft.com/Deploying-an-ASPNET-Web-4e31366b)

> <span data-ttu-id="8885d-106">Tato série kurzů se dozvíte, jak nasadit (publikovat) technologie ASP.NET webové aplikace, která obsahuje databázi systému SQL Server Compact pomocí sady Visual Studio 2012 RC nebo Visual Studio Express 2012 RC pro Web.</span><span class="sxs-lookup"><span data-stu-id="8885d-106">This series of tutorials shows you how to deploy (publish) an ASP.NET web application project that includes a SQL Server Compact database by using Visual Studio 2012 RC or Visual Studio Express 2012 RC for Web.</span></span> <span data-ttu-id="8885d-107">Můžete také použít Visual Studio 2010 při instalaci aktualizace Publikovat Web.</span><span class="sxs-lookup"><span data-stu-id="8885d-107">You can also use Visual Studio 2010 if you install the Web Publish Update.</span></span> <span data-ttu-id="8885d-108">Úvod do řady, naleznete v tématu [z prvního kurzu této série](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="8885d-108">For an introduction to the series, see [the first tutorial in the series](deployment-to-a-hosting-provider-introduction-1-of-12.md).</span></span>
> 
> <span data-ttu-id="8885d-109">Kurz ukazuje nasazení funkce zavedená po verzi RC sady Visual Studio 2012, ukazuje, jak nasadit edicích systému SQL Server než SQL Server Compact a ukazuje, jak nasadit do Azure App Service Web Apps, najdete v tématu [nasazení webu ASP.NET pomocí sady Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span><span class="sxs-lookup"><span data-stu-id="8885d-109">For a tutorial that shows deployment features introduced after the RC release of Visual Studio 2012, shows how to deploy SQL Server editions other than SQL Server Compact, and shows how to deploy to Azure App Service Web Apps, see [ASP.NET Web Deployment using Visual Studio](../../deployment/visual-studio-web-deployment/introduction.md).</span></span>

## <a name="overview"></a><span data-ttu-id="8885d-110">Přehled</span><span class="sxs-lookup"><span data-stu-id="8885d-110">Overview</span></span>

<span data-ttu-id="8885d-111">V tomto kurzu provedete změnu databáze a změny související kód, otestovat změny v sadě Visual Studio a pak Nasaďte aktualizaci do testovacích i produkčních prostředí.</span><span class="sxs-lookup"><span data-stu-id="8885d-111">In this tutorial, you make a database change and related code changes, test the changes in Visual Studio, then deploy the update to both the test and production environments.</span></span>

<span data-ttu-id="8885d-112">Připomenutí: Pokud se zobrazí chybová zpráva nebo něco nefunguje tak, jak absolvovat kurz, nezapomeňte se podívat [stránka o řešení problémů](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span><span class="sxs-lookup"><span data-stu-id="8885d-112">Reminder: If you get an error message or something doesn't work as you go through the tutorial, be sure to check the [troubleshooting page](deployment-to-a-hosting-provider-creating-and-installing-deployment-packages-12-of-12.md).</span></span>

## <a name="adding-a-new-column-to-a-table"></a><span data-ttu-id="8885d-113">Přidá sloupec do tabulky</span><span class="sxs-lookup"><span data-stu-id="8885d-113">Adding a New Column to a Table</span></span>

<span data-ttu-id="8885d-114">V této části přidáte sloupec Datum narození `Person` základní třída pro `Student` a `Instructor` entity.</span><span class="sxs-lookup"><span data-stu-id="8885d-114">In this section, you add a birth date column to the `Person` base class for the `Student` and `Instructor` entities.</span></span> <span data-ttu-id="8885d-115">Potom aktualizujte stránku, která zobrazuje data kurzů vedených tak, aby zobrazil nový sloupec.</span><span class="sxs-lookup"><span data-stu-id="8885d-115">Then you update the page that displays instructor data so that it displays the new column.</span></span>

<span data-ttu-id="8885d-116">V *ContosoUniversity.DAL* projekt, otevřete *Person.cs* a přidejte následující vlastnost na konci `Person` třídy (měl by existovat dva pravou složenou závorkou následující):</span><span class="sxs-lookup"><span data-stu-id="8885d-116">In the *ContosoUniversity.DAL* project, open *Person.cs* and add the following property at the end of the `Person` class (there should be two closing curly braces following it):</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample1.cs)]

<span data-ttu-id="8885d-117">V dalším kroku aktualizujte metodu počáteční hodnoty tak, aby poskytuje hodnoty pro nový sloupec.</span><span class="sxs-lookup"><span data-stu-id="8885d-117">Next, update the Seed method so that it provides a value for the new column.</span></span> <span data-ttu-id="8885d-118">Otevřít *Migrations\Configuration.cs* a nahraďte blok kódu, který začíná `var instructors = new List<Instructor>` s následující blok kódu, který obsahuje informace o datu narození:</span><span class="sxs-lookup"><span data-stu-id="8885d-118">Open *Migrations\Configuration.cs* and replace the code block that begins `var instructors = new List<Instructor>` with the following code block which includes birth date information:</span></span>

[!code-csharp[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample2.cs)]

<span data-ttu-id="8885d-119">Otevřete v projektu ContosoUniversity *Instructors.aspx* a přidat nové pole šablony se zobrazí datum narození.</span><span class="sxs-lookup"><span data-stu-id="8885d-119">In the ContosoUniversity project, open *Instructors.aspx* and add a new template field to display the birth date.</span></span> <span data-ttu-id="8885d-120">Přidáte mezi pro zařazení data a office přiřazení:</span><span class="sxs-lookup"><span data-stu-id="8885d-120">Add it between the ones for hire date and office assignment:</span></span>

[!code-aspx[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample3.aspx)]

<span data-ttu-id="8885d-121">(Pokud odsazení kódu získá synchronizovaný, můžete stisknutím CTRL-K a pak na kombinaci kláves CTRL + D automaticky přeformátovat soubor.)</span><span class="sxs-lookup"><span data-stu-id="8885d-121">(If code indentation gets out of sync, you can press CTRL-K and then CTRL-D to automatically reformat the file.)</span></span>

<span data-ttu-id="8885d-122">Sestavte řešení a pak otevřete **Konzola správce balíčků** okna.</span><span class="sxs-lookup"><span data-stu-id="8885d-122">Build the solution, and then open the **Package Manager Console** window.</span></span> <span data-ttu-id="8885d-123">Ujistěte se, že ContosoUniversity.DAL je stále vybrán jako **výchozí projekt**.</span><span class="sxs-lookup"><span data-stu-id="8885d-123">Make sure that ContosoUniversity.DAL is still selected as the **Default project**.</span></span>

<span data-ttu-id="8885d-124">V **Konzola správce balíčků** okně **ContosoUniversity.DAL** jako **výchozí projekt**a potom zadejte následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="8885d-124">In the **Package Manager Console** window, select **ContosoUniversity.DAL** as the **Default project**, and then enter the following command:</span></span>

[!code-powershell[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample4.ps1)]

<span data-ttu-id="8885d-125">Po dokončení tohoto příkazu, Visual Studio otevře soubor třídy, která definuje nový `DbMigration` třídy a `Up` metoda se zobrazí kód, který vytvoří nový sloupec.</span><span class="sxs-lookup"><span data-stu-id="8885d-125">When this command finishes, Visual Studio opens the class file that defines the new `DbMigration` class, and in the `Up` method you can see the code that creates the new column.</span></span>

![AddBirthDate_migration_code](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image1.png)

<span data-ttu-id="8885d-127">Sestavte řešení a potom zadejte následující příkaz v **Konzola správce balíčků** okno (ujistěte se, že je stále vybrán projekt ContosoUniversity.DAL):</span><span class="sxs-lookup"><span data-stu-id="8885d-127">Build the solution, and then enter the following command in the **Package Manager Console** window (make sure the ContosoUniversity.DAL project is still selected):</span></span>

[!code-powershell[Main](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/samples/sample5.ps1)]

<span data-ttu-id="8885d-128">Až se příkaz dokončí, spusťte aplikaci a vyberte stránku Instruktoři.</span><span class="sxs-lookup"><span data-stu-id="8885d-128">When the command finishes, run the application and select the Instructors page.</span></span> <span data-ttu-id="8885d-129">Když se stránka načte, uvidíte, že na něm nové pole pro datum narození.</span><span class="sxs-lookup"><span data-stu-id="8885d-129">When the page loads, you see that it has the new birth date field.</span></span>

<span data-ttu-id="8885d-130">[![Instructors_page_with_birth_date](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image3.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image2.png)</span><span class="sxs-lookup"><span data-stu-id="8885d-130">[![Instructors_page_with_birth_date](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image3.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image2.png)</span></span>

## <a name="deploying-the-database-update-to-the-test-environment"></a><span data-ttu-id="8885d-131">Nasazení aktualizace databáze do testovacího prostředí</span><span class="sxs-lookup"><span data-stu-id="8885d-131">Deploying the Database Update to the Test Environment</span></span>

<span data-ttu-id="8885d-132">V **Průzkumníka řešení** vyberte ContosoUniversity projekt.</span><span class="sxs-lookup"><span data-stu-id="8885d-132">In **Solution Explorer** select the ContosoUniversity project.</span></span>

<span data-ttu-id="8885d-133">V **publikování webu jedním kliknutím** nástrojů, vyberte **testovací** profil publikování a potom klikněte na tlačítko **Publikovat Web**.</span><span class="sxs-lookup"><span data-stu-id="8885d-133">In the **Web One Click Publish** toolbar, select the **Test** publish profile, and then click **Publish Web**.</span></span> <span data-ttu-id="8885d-134">(Pokud panelu nástrojů je zakázaná, vyberte projekt ContosoUniversity v **Průzkumníka řešení**.)</span><span class="sxs-lookup"><span data-stu-id="8885d-134">(If the toolbar is disabled, select the ContosoUniversity project in **Solution Explorer**.)</span></span>

<span data-ttu-id="8885d-135">Visual Studio nasadí aktualizované aplikace a prohlížeč otevře domovskou stránku.</span><span class="sxs-lookup"><span data-stu-id="8885d-135">Visual Studio deploys the updated application, and the browser opens to the home page.</span></span> <span data-ttu-id="8885d-136">Spustíte školitelů stránky a ověřte, že se aktualizace úspěšně nasadilo.</span><span class="sxs-lookup"><span data-stu-id="8885d-136">Run the Instructors page to verify that the update was successfully deployed.</span></span> <span data-ttu-id="8885d-137">Když se aplikace pokusí o přístup k databázi pro tuto stránku, Code First aktualizuje schéma databáze a spustí `Seed` metody.</span><span class="sxs-lookup"><span data-stu-id="8885d-137">When the application tries to access the database for this page, Code First updates the database schema and runs the `Seed` method.</span></span> <span data-ttu-id="8885d-138">Jakmile se zobrazí na stránce se zobrazí očekávané **datum narození** sloupce s datem, v ní.</span><span class="sxs-lookup"><span data-stu-id="8885d-138">When the page displays, you see the expected **Birth Date** column with dates in it.</span></span>

<span data-ttu-id="8885d-139">[![Instructors_page_with_birth_date_Test](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="8885d-139">[![Instructors_page_with_birth_date_Test](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image5.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image4.png)</span></span>

## <a name="deploying-the-database-update-to-the-production-environment"></a><span data-ttu-id="8885d-140">Nasazení aktualizace databáze do produkčního prostředí</span><span class="sxs-lookup"><span data-stu-id="8885d-140">Deploying the Database Update to the Production Environment</span></span>

<span data-ttu-id="8885d-141">Teď můžete nasadit do produkčního prostředí.</span><span class="sxs-lookup"><span data-stu-id="8885d-141">You can now deploy to production.</span></span> <span data-ttu-id="8885d-142">Jediným rozdílem je, že budete používat *aplikace\_offline.htm* lze zabránit uživatelům v přístupu k webu a proto aktualizace databáze, zatímco nasazujete změny.</span><span class="sxs-lookup"><span data-stu-id="8885d-142">The only difference is that you'll use *app\_offline.htm* to prevent users from accessing the site and thus updating the database while you're deploying changes.</span></span> <span data-ttu-id="8885d-143">Pro produkční nasazení proveďte následující kroky:</span><span class="sxs-lookup"><span data-stu-id="8885d-143">For production deployment perform the following steps:</span></span>

- <span data-ttu-id="8885d-144">Nahrát *aplikace\_offline.htm* souboru na pracoviště.</span><span class="sxs-lookup"><span data-stu-id="8885d-144">Upload the *app\_offline.htm* file to the production site.</span></span>
- <span data-ttu-id="8885d-145">V sadě Visual Studio, zvolte profilu do produkčního prostředí **publikování webu jedním kliknutím** nástrojů a klikněte na tlačítko **Publikovat Web**.</span><span class="sxs-lookup"><span data-stu-id="8885d-145">In Visual Studio, choose the Production profile in the **Web One Click Publish** toolbar and click **Publish Web**.</span></span>
- <span data-ttu-id="8885d-146">Odstranit *aplikace\_offline.htm* soubor z pracoviště.</span><span class="sxs-lookup"><span data-stu-id="8885d-146">Delete the *app\_offline.htm* file from the production site.</span></span>

> [!NOTE]
> <span data-ttu-id="8885d-147">Když vaše aplikace je používána v provozním prostředí by měl být implementace plánu zálohování.</span><span class="sxs-lookup"><span data-stu-id="8885d-147">While your application is in use in the production environment you should be implementing a backup plan.</span></span> <span data-ttu-id="8885d-148">To znamená, které by měl být pravidelně kopírování *školní-Prod.sdf* a *aspnet Prod.sdf* soubory z produkční lokality do zabezpečeného úložiště, a měli udržování několika generací těchto zálohování.</span><span class="sxs-lookup"><span data-stu-id="8885d-148">That is, you should be periodically copying the *School-Prod.sdf* and *aspnet-Prod.sdf* files from the production site to a secure storage location, and you should be keeping several generations of such backups.</span></span> <span data-ttu-id="8885d-149">Při aktualizaci databáze, měli byste zajistit záložní kopie z bezprostředně před provedením změny.</span><span class="sxs-lookup"><span data-stu-id="8885d-149">When you update the database, you should make a backup copy from immediately before the change.</span></span> <span data-ttu-id="8885d-150">Potom Pokud došlo k chybě a není objevit až po jeho nasazení do produkčního prostředí, stále budete moci obnovit databázi do stavu, ve kterém byl předtím, než začal být poškozen.</span><span class="sxs-lookup"><span data-stu-id="8885d-150">Then, if you make a mistake and don't discover it until after you have deployed it to production, you will still be able to recover the database to the state it was in before it became corrupted.</span></span>

<span data-ttu-id="8885d-151">Když Visual Studio otevře adresu URL domovské stránky v prohlížeči *aplikace\_offline.htm* zobrazí se stránka.</span><span class="sxs-lookup"><span data-stu-id="8885d-151">When Visual Studio opens the home page URL in the browser, the *app\_offline.htm* page is displayed.</span></span> <span data-ttu-id="8885d-152">Po odstranění *aplikace\_offline.htm* soubor, můžete přejít na domovskou stránku znovu a ověřte, že se aktualizace úspěšně nasadilo.</span><span class="sxs-lookup"><span data-stu-id="8885d-152">After you delete the *app\_offline.htm* file, you can browse to your home page again to verify that the update was successfully deployed.</span></span>

<span data-ttu-id="8885d-153">[![Instructors_page_with_birth_date_Prod](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image7.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="8885d-153">[![Instructors_page_with_birth_date_Prod](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image7.png)](deployment-to-a-hosting-provider-deploying-a-database-update-9-of-12/_static/image6.png)</span></span>

<span data-ttu-id="8885d-154">Nyní jste nasadili aktualizaci aplikace, která zahrnuté změny databáze do testovacího a produkčního prostředí.</span><span class="sxs-lookup"><span data-stu-id="8885d-154">You've now deployed an application update that included a database change to both test and production.</span></span> <span data-ttu-id="8885d-155">V dalším kurzu se dozvíte, jak migrovat databázi ze systému SQL Server Compact do systému SQL Server Express a SQL Server.</span><span class="sxs-lookup"><span data-stu-id="8885d-155">The next tutorial shows you how to migrate your database from SQL Server Compact to SQL Server Express and SQL Server.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8885d-156">[Předchozí](deployment-to-a-hosting-provider-deploying-a-code-only-update-8-of-12.md)
> [další](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12.md)</span><span class="sxs-lookup"><span data-stu-id="8885d-156">[Previous](deployment-to-a-hosting-provider-deploying-a-code-only-update-8-of-12.md)
[Next](deployment-to-a-hosting-provider-migrating-to-sql-server-10-of-12.md)</span></span>
