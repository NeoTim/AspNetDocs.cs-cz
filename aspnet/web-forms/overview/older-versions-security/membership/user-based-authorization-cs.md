---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-cs
title: Ověřování založené na uživatelích (C#) | Dokumentace Microsoftu
author: rick-anderson
description: V tomto kurzu se podíváme na omezení přístupu na stránky a omezení funkce na úrovni stránky prostřednictvím různých technik.
ms.author: riande
ms.date: 01/18/2008
ms.assetid: 3c815a9e-2296-4b9b-b945-776d54989daa
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-cs
msc.type: authoredcontent
ms.openlocfilehash: 3078c186431d7662d54bc7e05dde60124de1956d
ms.sourcegitcommit: 51b01b6ff8edde57d8243e4da28c9f1e7f1962b2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 05/06/2019
ms.locfileid: "65131867"
---
# <a name="user-based-authorization-c"></a><span data-ttu-id="49cd0-103">Ověřování založené na uživatelích (C#)</span><span class="sxs-lookup"><span data-stu-id="49cd0-103">User-Based Authorization (C#)</span></span>

<span data-ttu-id="49cd0-104">podle [Scott Meisnerová](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="49cd0-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="49cd0-105">[Stáhněte si kód](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) nebo [stahovat PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="49cd0-105">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_CS.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_cs.pdf)</span></span>

> <span data-ttu-id="49cd0-106">V tomto kurzu se podíváme na omezení přístupu na stránky a omezení funkce na úrovni stránky prostřednictvím různých technik.</span><span class="sxs-lookup"><span data-stu-id="49cd0-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>

## <a name="introduction"></a><span data-ttu-id="49cd0-107">Úvod</span><span class="sxs-lookup"><span data-stu-id="49cd0-107">Introduction</span></span>

<span data-ttu-id="49cd0-108">Většiny webových aplikací, které nabízejí uživatelské účty tak učinit v části omezit určité návštěvníků přístup k určité stránky v rámci stránky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="49cd0-109">V nejvíce online messageboard servery například všichni uživatelé – anonymní a ověřené - budou moct zobrazit messageboard příspěvky, ale jenom ověření uživatelé navštívit webovou stránku, aby se vytvoří nový příspěvek.</span><span class="sxs-lookup"><span data-stu-id="49cd0-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="49cd0-110">A může být pro správu stránky, které jsou přístupné pro konkrétního uživatele (nebo konkrétní sadu uživatelů).</span><span class="sxs-lookup"><span data-stu-id="49cd0-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="49cd0-111">Kromě toho funkce na úrovni stránky se může lišit na základě uživatele uživatelů.</span><span class="sxs-lookup"><span data-stu-id="49cd0-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="49cd0-112">Při prohlížení seznam příspěvků, ověřeným uživatelům se zobrazí rozhraní pro hodnocení každého příspěvku, že toto rozhraní není k dispozici pro anonymní návštěvníků.</span><span class="sxs-lookup"><span data-stu-id="49cd0-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="49cd0-113">Technologie ASP.NET umožňuje snadno definovat pravidla ověřování na základě uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="49cd0-114">S jen trochu jazyka `Web.config`, konkrétní webové stránky nebo celou adresáře můžete být uzamčen, tak, aby pouze jsou přístupné pro zadaný podmnožině uživatelů.</span><span class="sxs-lookup"><span data-stu-id="49cd0-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="49cd0-115">Funkce na úrovni stránky je možné zapnout nebo vypnout podle aktuálně přihlášeného uživatele prostřednictvím kódu programu a deklarativní způsobem.</span><span class="sxs-lookup"><span data-stu-id="49cd0-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="49cd0-116">V tomto kurzu se podíváme na omezení přístupu na stránky a omezení funkce na úrovni stránky prostřednictvím různých technik.</span><span class="sxs-lookup"><span data-stu-id="49cd0-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="49cd0-117">Pusťme se do práce!</span><span class="sxs-lookup"><span data-stu-id="49cd0-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="49cd0-118">Podívejte se na pracovní postup autorizace adresy URL</span><span class="sxs-lookup"><span data-stu-id="49cd0-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="49cd0-119">Jak je popsáno v [ *Přehled ověřování založené na formulářích* ](../introduction/an-overview-of-forms-authentication-cs.md) kurz, když modul runtime ASP.NET zpracovává žádost pro prostředek ASP.NET žádost umocnit číslo události během životního cyklu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="49cd0-120">*Z modulů HTTP* jsou spravované třídy, jejíž kód je prováděn v reakci na konkrétní událost v životního cyklu požadavku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="49cd0-121">Technologie ASP.NET se dodává s celou řadou z modulů HTTP, který provádění základních úloh na pozadí.</span><span class="sxs-lookup"><span data-stu-id="49cd0-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="49cd0-122">Jeden takový modul HTTP je [ `FormsAuthenticationModule` ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span><span class="sxs-lookup"><span data-stu-id="49cd0-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="49cd0-123">Jak je popsáno v předchozích kurzech primárních funkcí `FormsAuthenticationModule` je k určení identity aktuálního požadavku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="49cd0-124">To se provádí kontrola lístek ověřování pomocí formulářů, které je umístěný v souboru cookie nebo vložené v rámci adresy URL.</span><span class="sxs-lookup"><span data-stu-id="49cd0-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="49cd0-125">Tato identifikace dojde během [ `AuthenticateRequest` události](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span><span class="sxs-lookup"><span data-stu-id="49cd0-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="49cd0-126">Je jiný důležité modul HTTP [ `UrlAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), která je vyvolána v reakci na [ `AuthorizeRequest` události](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (který se stane po `AuthenticateRequest` událostí).</span><span class="sxs-lookup"><span data-stu-id="49cd0-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="49cd0-127">`UrlAuthorizationModule` Zkontroluje konfiguraci značek v `Web.config` slouží k určení, zda aktuální identita má oprávnění naleznete na stránce zadané.</span><span class="sxs-lookup"><span data-stu-id="49cd0-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="49cd0-128">Tento proces se označuje jako *autorizace adres URL*.</span><span class="sxs-lookup"><span data-stu-id="49cd0-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="49cd0-129">Prozkoumáme syntaxe autorizačních pravidel adres URL v kroku 1, ale nejprve Pojďme podívat na co `UrlAuthorizationModule` nemá v závislosti na tom, zda je požadavek autorizován nebo ne.</span><span class="sxs-lookup"><span data-stu-id="49cd0-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="49cd0-130">Pokud `UrlAuthorizationModule` zjistí, že je požadavek autorizován, a to nemá žádný účinek a požadavek pokračuje přes životního cyklu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="49cd0-131">Ale pokud se jedná *není* oprávnění, pak bude `UrlAuthorizationModule` zruší životní cyklus a předá instrukci `Response` objektu, který chcete vrátit [HTTP 401 neoprávněný](http://www.checkupdown.com/status/E401.html) stav.</span><span class="sxs-lookup"><span data-stu-id="49cd0-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="49cd0-132">Při použití ověřování pomocí formulářů tento stav HTTP 401 je nikdy vrácen do klienta protože pokud `FormsAuthenticationModule` zjistí HTTP 401 je stav změní na [přesměrování HTTP 302](http://www.checkupdown.com/status/E302.html) na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="49cd0-133">Obrázek 1 ukazuje pracovní postup kanálu ASP.NET `FormsAuthenticationModule`a `UrlAuthorizationModule` při přijetí neoprávněného požadavku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="49cd0-134">Konkrétně se obrázek 1 ukazuje požadavek anonymní návštěvníkem pro `ProtectedPage.aspx`, což je stránka, která se odepře přístup pro anonymní uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="49cd0-135">Protože je k anonymní, návštěvník `UrlAuthorizationModule` zruší požadavek a vrátí HTTP 401 Unauthorized status.</span><span class="sxs-lookup"><span data-stu-id="49cd0-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="49cd0-136">`FormsAuthenticationModule` Stavu 401 převede po přesměrování 302 na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="49cd0-137">Po ověření uživatele přes stránku pro přihlášení, že je přesměrován na `ProtectedPage.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="49cd0-138">Tentokrát `FormsAuthenticationModule` identifikuje uživatele na základě jeho lístku ověřování.</span><span class="sxs-lookup"><span data-stu-id="49cd0-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="49cd0-139">Teď, když je ověřen návštěvníka, `UrlAuthorizationModule` povoluje přístup ke stránce.</span><span class="sxs-lookup"><span data-stu-id="49cd0-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>

<span data-ttu-id="49cd0-140">[![Ověřování pomocí formulářů a pracovní postup autorizace adresy URL](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-cs/_static/image2.png)](user-based-authorization-cs/_static/image1.png)</span></span>

<span data-ttu-id="49cd0-141">**Obrázek 1**: Ověřování pomocí formulářů a pracovní postup autorizace adresy URL ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-cs/_static/image3.png))</span></span>

<span data-ttu-id="49cd0-142">Obrázek 1 znázorňuje interakci, která nastane, pokud anonymní návštěvníka pokusí získat přístup k prostředku, který není k dispozici pro anonymní uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="49cd0-143">V takovém případě anonymní návštěvníka přesměruje na přihlašovací stránku s stránku, kterou se uživatel pokusil navštivte zadané v poli řetězec dotazu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="49cd0-144">Po úspěšném přihlášení uživatele si budete automaticky přesměrováni zpět na prostředek, který uživatel byl zpočátku pokusu o zobrazení.</span><span class="sxs-lookup"><span data-stu-id="49cd0-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="49cd0-145">Po provedení neautorizované žádosti anonymního uživatele, tento pracovní postup je jednoduché a snadno pro návštěvníka pochopit, co se stalo a proč.</span><span class="sxs-lookup"><span data-stu-id="49cd0-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="49cd0-146">Ale mějte na paměti, že `FormsAuthenticationModule` přesměruje *jakékoli* neoprávněný uživatel na přihlašovací stránku i v případě, že byla podána žádost od ověřeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="49cd0-147">Pokud ověřený uživatel se pokusí najdete na stránce, u kterého uživatel nemá autority to může vést matoucí činnost koncového uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="49cd0-148">Představte si, že náš web měli jeho autorizačních pravidel adres URL nakonfigurovaná tak, aby stránka technologie ASP.NET `OnlyTito.aspx` bylo accessibly pouze Tito.</span><span class="sxs-lookup"><span data-stu-id="49cd0-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="49cd0-149">Nyní, imagine Sam navštíví web, přihlášení a poté se pokusí navštivte `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="49cd0-150">`UrlAuthorizationModule` Zastaví životního cyklu požadavku, který se vrátí HTTP 401 Unauthorized status, které `FormsAuthenticationModule` rozpozná a potom přesměrujte Sam na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="49cd0-151">Vzhledem k tomu, že již byl přihlášen Sam, ale marcela může zajímat, proč si byl odeslán zpět na stránku pro přihlášení.</span><span class="sxs-lookup"><span data-stu-id="49cd0-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="49cd0-152">Marcela může být z důvodu, že její přihlašovací údaje byly ztraceny nějakým způsobem, nebo že Jana zadané neplatné přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="49cd0-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="49cd0-153">Pokud Sam znovu vstoupí svých přihlašovacích údajů z přihlašovací stránky Jana se přihlášení (znovu) a přesměrování na `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="49cd0-154">`UrlAuthorizationModule` Zjistí, že Sam nemůžou navštívit tuto stránku, a Jana se vrátit na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="49cd0-155">Obrázek 2 znázorňuje tento pracovní postup matoucí.</span><span class="sxs-lookup"><span data-stu-id="49cd0-155">Figure 2 depicts this confusing workflow.</span></span>

<span data-ttu-id="49cd0-156">[![Výchozí pracovní postup může mít za následek matoucí cyklu](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-cs/_static/image5.png)](user-based-authorization-cs/_static/image4.png)</span></span>

<span data-ttu-id="49cd0-157">**Obrázek 2**: Výchozí pracovní postup může mít za následek cyklus matoucí ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-cs/_static/image6.png))</span></span>

<span data-ttu-id="49cd0-158">Pracovní postup znázorněné na obrázku 2 můžete rychle befuddle i většinu počítače koumák návštěvníka.</span><span class="sxs-lookup"><span data-stu-id="49cd0-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="49cd0-159">Podíváme se na způsoby, jak tomu zabránit, matoucí cyklus v kroku 2.</span><span class="sxs-lookup"><span data-stu-id="49cd0-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="49cd0-160">ASP.NET používá k určení, zda má aktuální uživatel přístup konkrétní webovou stránku dva mechanismy: Ověřování adresy URL a souborů.</span><span class="sxs-lookup"><span data-stu-id="49cd0-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="49cd0-161">Autorizace souboru je implementované [ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), který určuje o požadované soubory seznamů řízení přístupu autorita.</span><span class="sxs-lookup"><span data-stu-id="49cd0-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="49cd0-162">Autorizace souboru se nejčastěji používá s ověřováním Windows, protože seznamy ACL jsou oprávnění, které se vztahují na účty Windows.</span><span class="sxs-lookup"><span data-stu-id="49cd0-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="49cd0-163">Při použití ověřování pomocí formulářů, všechny požadavky operačního systému a soubor úrovni systému jsou spouštěny příkazem stejný účet Windows, bez ohledu na následujícím webu uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="49cd0-164">Protože v této sérii kurzů se zaměřuje na ověřování pomocí formulářů, společnost Microsoft nebude mluvit o autorizace souboru.</span><span class="sxs-lookup"><span data-stu-id="49cd0-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>

### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="49cd0-165">Obor autorizace adres URL</span><span class="sxs-lookup"><span data-stu-id="49cd0-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="49cd0-166">`UrlAuthorizationModule` Je spravovaný kód, který je součástí modulu runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="49cd0-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="49cd0-167">Starší než verze 7 od Microsoftu [Internetové informační služby (IIS)](https://www.iis.net/) webový server, se liší bariéru mezi kanálu protokolu HTTP služby IIS a modulu runtime ASP.NET kanálu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="49cd0-168">Stručně řečeno, IIS 6 a dřívějších verzí ASP. NET společnosti `UrlAuthorizationModule` provede jenom v případě požadavku se deleguje ze služby IIS na modul runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="49cd0-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="49cd0-169">Ve výchozím nastavení, služba IIS zpracovává statický obsah, samotný – například stránky HTML a CSS, JavaScript a soubory obrázků – a pouze předá požadavky na modul runtime ASP.NET, pokud stránka s rozšířením `.aspx`, `.asmx`, nebo `.ashx` je požadováno.</span><span class="sxs-lookup"><span data-stu-id="49cd0-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="49cd0-170">Integrované služby IIS a ASP.NET IIS 7, ale umožňuje spouštění kanálů.</span><span class="sxs-lookup"><span data-stu-id="49cd0-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="49cd0-171">S několika nastavení konfigurace můžete nastavit službu IIS 7, který má být vyvolán `UrlAuthorizationModule` pro *všechny* požadavky, což znamená, že pro soubory libovolného typu je možné definovat autorizačních pravidel adres URL.</span><span class="sxs-lookup"><span data-stu-id="49cd0-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="49cd0-172">Kromě toho zahrnuje IIS 7 svůj vlastní stroj autorizace adresy URL.</span><span class="sxs-lookup"><span data-stu-id="49cd0-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="49cd0-173">Další informace o integrace technologie ASP.NET a IIS 7 nativních funkcí autorizace adresy URL, najdete v části [autorizace adres URL pro službu IIS7 Principy](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="49cd0-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="49cd0-174">Podrobnější rozbor integraci technologie ASP.NET a IIS 7, vyberte kopii Shahram Khosravi knihy *Professional IIS 7 a ASP.NET integrovaný programovací* (ISBN: 978-0470152539).</span><span class="sxs-lookup"><span data-stu-id="49cd0-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="49cd0-175">Řečeno v kostce ve verzích před IIS 7, adresa URL autorizační pravidla platí pouze pro prostředky, zpracovává modul runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="49cd0-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="49cd0-176">Se službou IIS 7 je však možné používat funkce na nativní autorizace adresy URL služby IIS nebo integrovat ASP. NET společnosti `UrlAuthorizationModule` do kanálu HTTP služby IIS, tím rozšiřuje tuto funkci pro všechny požadavky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="49cd0-177">Existují určité jednoduchý, ale důležité rozdíly v tom ASP. NET společnosti `UrlAuthorizationModule` a funkce autorizace adresy URL služby IIS 7 zpracování autorizačních pravidel.</span><span class="sxs-lookup"><span data-stu-id="49cd0-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="49cd0-178">Funkce autorizace adresy URL služby IIS 7 nebo rozdíly mezi jak analyzuje autorizační pravidla ve srovnání s nezkoumá v tomto kurzu `UrlAuthorizationModule`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="49cd0-179">Další informace o těchto tématech naleznete v dokumentaci služby IIS 7 na webu MSDN nebo na [www.iis.net](https://www.iis.net/).</span><span class="sxs-lookup"><span data-stu-id="49cd0-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>

## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="49cd0-180">Krok 1: Definování autorizačních pravidel adres URL v`Web.config`</span><span class="sxs-lookup"><span data-stu-id="49cd0-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="49cd0-181">`UrlAuthorizationModule` Určuje, jestli se má udělit nebo odepřít přístup k požadovanému prostředku pro konkrétní identity na základě pravidel autorizace URL definované v konfiguraci vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="49cd0-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="49cd0-182">Autorizační pravidla jsou vypsány v [ `<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) ve formě `<allow>` a `<deny>` podřízené prvky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="49cd0-183">Každý `<allow>` a `<deny>` podřízený prvek můžete zadat:</span><span class="sxs-lookup"><span data-stu-id="49cd0-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="49cd0-184">Určitého uživatele</span><span class="sxs-lookup"><span data-stu-id="49cd0-184">A particular user</span></span>
- <span data-ttu-id="49cd0-185">Seznam uživatelů oddělených čárkou</span><span class="sxs-lookup"><span data-stu-id="49cd0-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="49cd0-186">Všichni anonymní uživatelé označeny otazníkem (?)</span><span class="sxs-lookup"><span data-stu-id="49cd0-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="49cd0-187">Všichni uživatelé, označený hvězdičkou (\*)</span><span class="sxs-lookup"><span data-stu-id="49cd0-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="49cd0-188">Následující kód ukazuje, jak můžete uživatelům Tito a Scott povolit a zakázat všechny ostatní autorizačních pravidel adres URL:</span><span class="sxs-lookup"><span data-stu-id="49cd0-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample1.xml)]

<span data-ttu-id="49cd0-189">`<allow>` Element definuje, co uživatelé jsou povolené - Tito a Scott – zatímco `<deny>` element, který instruuje *všechny* uživatelé mají odepřený.</span><span class="sxs-lookup"><span data-stu-id="49cd0-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="49cd0-190">`<allow>` a `<deny>` prvky můžete také určit autorizační pravidla pro role.</span><span class="sxs-lookup"><span data-stu-id="49cd0-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="49cd0-191">Prozkoumáme ověřování na základě role v budoucích kurzech.</span><span class="sxs-lookup"><span data-stu-id="49cd0-191">We will examine role-based authorization in a future tutorial.</span></span>

<span data-ttu-id="49cd0-192">Následující nastavení povolí přístup všem uživatelům kromě Sam (včetně anonymních návštěvníci):</span><span class="sxs-lookup"><span data-stu-id="49cd0-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample2.xml)]

<span data-ttu-id="49cd0-193">Umožňuje pouze ověřeným uživatelům, použijte následující konfiguraci, čímž se odmítne přístup všichni anonymní uživatelé:</span><span class="sxs-lookup"><span data-stu-id="49cd0-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample3.xml)]

<span data-ttu-id="49cd0-194">Autorizační pravidla jsou definována v rámci `<system.web>` prvek `Web.config` a platí pro všechny prostředky technologie ASP.NET ve webové aplikaci.</span><span class="sxs-lookup"><span data-stu-id="49cd0-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="49cd0-195">Aplikace často, má jiné autorizačních pravidel pro různé oddíly.</span><span class="sxs-lookup"><span data-stu-id="49cd0-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="49cd0-196">Například na webu elektronického obchodování, všechny návštěvníky může zobrazit produkty, podívat na hodnocení produktu, vyhledejte v katalogu atd.</span><span class="sxs-lookup"><span data-stu-id="49cd0-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="49cd0-197">Pouze ověřeným uživatelům může dosáhnout však rezervace nebo na stránkách ke správě svých přesouvání historie.</span><span class="sxs-lookup"><span data-stu-id="49cd0-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="49cd0-198">Kromě toho může být částí webu, které jsou přístupné pro výběr uživatelů, třeba o správce lokality.</span><span class="sxs-lookup"><span data-stu-id="49cd0-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="49cd0-199">Technologie ASP.NET umožňuje snadno definovat různé autorizačních pravidel pro různé soubory a složky v lokalitě.</span><span class="sxs-lookup"><span data-stu-id="49cd0-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="49cd0-200">Autorizační pravidla zadaná v kořenové složce `Web.config` souboru se vztahují na všechny prostředky technologie ASP.NET v lokalitě.</span><span class="sxs-lookup"><span data-stu-id="49cd0-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="49cd0-201">Však lze přepsat toto výchozí nastavení autorizace pro konkrétní složku tak, že přidáte `Web.config` s `<authorization>` oddílu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="49cd0-202">Umožňuje aktualizovat našeho webu tak, aby pouze ověřeným uživatelům najdete na stránkách ASP.NET `Membership` složky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="49cd0-203">K tomu je potřeba přidat `Web.config` do souboru `Membership` složku a její nastavení autorizace anonymním uživatelům odepřít.</span><span class="sxs-lookup"><span data-stu-id="49cd0-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="49cd0-204">Klikněte pravým tlačítkem myši `Membership` složku v Průzkumníku řešení zvolte v nabídce Přidat novou položku v místní nabídce a přidejte nový soubor webové konfigurace s názvem `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>

<span data-ttu-id="49cd0-205">[![Přidat soubor Web.config ke složce členství](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-cs/_static/image8.png)](user-based-authorization-cs/_static/image7.png)</span></span>

<span data-ttu-id="49cd0-206">**Obrázek 3**: Přidat `Web.config` do souboru `Membership` složky ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-cs/_static/image9.png))</span></span>

<span data-ttu-id="49cd0-207">Váš projekt v tomto okamžiku by měla obsahovat dva `Web.config` soubory: jeden v kořenovém adresáři a druhý v `Membership` složky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>

<span data-ttu-id="49cd0-208">[![Vaše aplikace by měla nyní obsahovat dva soubory Web.config](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-cs/_static/image11.png)](user-based-authorization-cs/_static/image10.png)</span></span>

<span data-ttu-id="49cd0-209">**Obrázek 4**: Vaše aplikace by měla nyní obsahovat dvě `Web.config` soubory ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-cs/_static/image12.png))</span></span>

<span data-ttu-id="49cd0-210">Aktualizovat konfigurační soubor v `Membership` složku tak, že zakazují přístup pro anonymní uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample4.xml)]

<span data-ttu-id="49cd0-211">A je to!</span><span class="sxs-lookup"><span data-stu-id="49cd0-211">That's all there is to it!</span></span>

<span data-ttu-id="49cd0-212">K otestování této změny, přejděte na domovskou stránku v prohlížeči a ujistěte se, že jste se přihlásili navýšení kapacity. Protože výchozí chování aplikace technologie ASP.NET je umožnit všem návštěvníkům a vzhledem k tomu, že jsme nevytvořili žádné změny autorizace do kořenového adresáře `Web.config` souboru, jsme schopní navštivte soubory v kořenovém adresáři jako anonymní návštěvníka.</span><span class="sxs-lookup"><span data-stu-id="49cd0-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="49cd0-213">Kliknutím na odkaz vytváření uživatelských účtů v levém sloupci.</span><span class="sxs-lookup"><span data-stu-id="49cd0-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="49cd0-214">Tím přejdete na `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="49cd0-215">Protože `Web.config` ve `Membership` složky definuje autorizační pravidla za účelem zakázat anonymní přístup `UrlAuthorizationModule` zruší požadavek a vrátí HTTP 401 Unauthorized status.</span><span class="sxs-lookup"><span data-stu-id="49cd0-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="49cd0-216">`FormsAuthenticationModule` Upraví to 302 stavu přesměrování, odeslání na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="49cd0-217">Všimněte si, že na stránce jsme se pokouší o přístup (`CreatingUserAccounts.aspx`) je předána na stránku pro přihlášení přes `ReturnUrl` parametr řetězce dotazu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>

<span data-ttu-id="49cd0-218">[![Od adresy URL autorizační pravidla zakázat anonymní přístup jsme přesměrováni na stránku pro přihlášení](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-cs/_static/image14.png)](user-based-authorization-cs/_static/image13.png)</span></span>

<span data-ttu-id="49cd0-219">**Obrázek 5**: Od adresy URL autorizační pravidla zakázat anonymní přístup, jsme přesměrováni na stránku pro přihlášení ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-cs/_static/image15.png))</span></span>

<span data-ttu-id="49cd0-220">Po úspěšném přihlášení, jsme přesměrováni `CreatingUserAccounts.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="49cd0-221">Tentokrát `UrlAuthorizationModule` povoluje přístup na stránku, protože jsme už nejsou anonymní.</span><span class="sxs-lookup"><span data-stu-id="49cd0-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="49cd0-222">Použití autorizačních pravidel adres URL do určitého umístění</span><span class="sxs-lookup"><span data-stu-id="49cd0-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="49cd0-223">Povolení nastavení definovaných v `<system.web>` část `Web.config` platí pro všechny prostředky technologie ASP.NET v tomto adresáři a jeho podadresářích (dokud přepsány jiným `Web.config` souboru).</span><span class="sxs-lookup"><span data-stu-id="49cd0-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="49cd0-224">V některých případech se však může chceme, všech prostředků ASP.NET v daném adresáři mít konkrétní autorizace konfigurace s výjimkou jednoho nebo dvou konkrétní stránky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="49cd0-225">Toho lze dosáhnout tak, že přidáte `<location>` prvek `Web.config`, odkazující na soubor, jehož autorizační pravidla se liší a definování jeho jedinečné autorizační pravidla v něm.</span><span class="sxs-lookup"><span data-stu-id="49cd0-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="49cd0-226">Pro ilustraci použití `<location>` prvek, který chcete přepsat nastavení konfigurace pro určitý prostředek, můžeme přizpůsobit nastavení autorizace tak, aby navštívit pouze Tito `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="49cd0-227">Chcete-li to provést, přidejte `<location>` elementu `Membership` složky `Web.config` souboru a aktualizujte svůj kód tak, aby vypadal jako následující:</span><span class="sxs-lookup"><span data-stu-id="49cd0-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample5.xml)]

<span data-ttu-id="49cd0-228">`<authorization>` Prvek `<system.web>` definuje výchozí adresa URL autorizační pravidla pro prostředky technologie ASP.NET v `Membership` složce a jejích podsložkách.</span><span class="sxs-lookup"><span data-stu-id="49cd0-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="49cd0-229">`<location>` Element umožňuje přepsat tato pravidla pro určitý prostředek.</span><span class="sxs-lookup"><span data-stu-id="49cd0-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="49cd0-230">Ve výše uvedené značky `<location>` elementu odkazy `CreatingUserAccounts.aspx` stránky a určí, jeho autorizační pravidla, například za účelem povolení Tito, ale všichni ostatní odepřít.</span><span class="sxs-lookup"><span data-stu-id="49cd0-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="49cd0-231">K otestování této změny autorizace, začněte návštěvou webu jako anonymní uživatel.</span><span class="sxs-lookup"><span data-stu-id="49cd0-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="49cd0-232">Pokud při pokusu o návštěvu všechny stránky v `Membership` složky, například `UserBasedAuthorization.aspx`, `UrlAuthorizationModule` odmítne žádost a budete přesměrováni na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="49cd0-233">Po přihlášení jako například Scott, můžete navštívit libovolné stránky `Membership` složky *s výjimkou* pro `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="49cd0-234">Pokus o navštivte `CreatingUserAccounts.aspx` přihlášeni jako kdokoli, ale Tito dojde pokusu o neoprávněný přístup budete přesměrování zpět na stránku pro přihlášení.</span><span class="sxs-lookup"><span data-stu-id="49cd0-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="49cd0-235">`<location>` Elementu musí nacházet mimo v konfiguraci `<system.web>` elementu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="49cd0-236">Musíte použít samostatné `<location>` – element pro každý prostředek, jehož nastavení ověřování, kterou chcete přepsat.</span><span class="sxs-lookup"><span data-stu-id="49cd0-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>

### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="49cd0-237">Podívejte se na tom, jak`UrlAuthorizationModule`používá autorizační pravidla udělit nebo odepřít přístup</span><span class="sxs-lookup"><span data-stu-id="49cd0-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="49cd0-238">`UrlAuthorizationModule` Určuje, jestli k autorizaci konkrétní identitu pro určitou adresu URL díky analýze autorizace adres URL pravidla postupně, počínaje první z nich a funguje směrem dolů.</span><span class="sxs-lookup"><span data-stu-id="49cd0-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="49cd0-239">Jakmile se najde shoda, je uživatel povolen nebo odepřen přístup, v závislosti na if v byla nalezena shoda `<allow>` nebo `<deny>` elementu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="49cd0-240"><strong>Pokud není nalezena žádná shoda, uživateli je udělen přístup.</strong></span><span class="sxs-lookup"><span data-stu-id="49cd0-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="49cd0-241">V důsledku toho pokud chcete omezit přístup, je nutné použít `<deny>` prvek jako poslední prvek v konfiguraci autorizace adresy URL.</span><span class="sxs-lookup"><span data-stu-id="49cd0-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="49cd0-242"><strong>Vynecháte-li</strong><strong>`<deny>`</strong><strong>elementu, všichni uživatelé budou mít přístup.</strong></span><span class="sxs-lookup"><span data-stu-id="49cd0-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="49cd0-243">Abyste lépe pochopili proces využívaný sadou `UrlAuthorizationModule` určit autority, podívejte se na příklad autorizačních pravidel adres URL, které jsme se podívali na dříve v tomto kroku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="49cd0-244">První pravidlo je `<allow>` element, který umožňuje přístup ke Tito a Scott.</span><span class="sxs-lookup"><span data-stu-id="49cd0-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="49cd0-245">Je druhá pravidla `<deny>` element, který se odepře přístup všem uživatelům.</span><span class="sxs-lookup"><span data-stu-id="49cd0-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="49cd0-246">Pokud anonymní uživatel navštíví, `UrlAuthorizationModule` začne s dotazem, je anonymní Scott nebo Tito?</span><span class="sxs-lookup"><span data-stu-id="49cd0-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="49cd0-247">Odpověď, samozřejmě, je Ne, tak pokračuje do druhé pravidlo.</span><span class="sxs-lookup"><span data-stu-id="49cd0-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="49cd0-248">Je anonymní v sadě všichni?</span><span class="sxs-lookup"><span data-stu-id="49cd0-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="49cd0-249">Protože odpověď je tady Ano, `<deny>` pravidlo je umístěn v platnosti a návštěvníka se přesměruje na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="49cd0-250">Podobně, pokud je návštěva Jisun, `UrlAuthorizationModule` začne s dotazem, je Jisun Scott nebo Tito?</span><span class="sxs-lookup"><span data-stu-id="49cd0-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="49cd0-251">Vzhledem k tomu, že uživatel není `UrlAuthorizationModule` pokračuje na druhou otázku Jisun je v sadě všichni?</span><span class="sxs-lookup"><span data-stu-id="49cd0-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="49cd0-252">Marcela se tak, že příliš, je odepřen přístup.</span><span class="sxs-lookup"><span data-stu-id="49cd0-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="49cd0-253">Nakonec, pokud Tito návštěvy, na první otázku kompenzaci `UrlAuthorizationModule` se kladná odpověď, aby Tito je udělen přístup.</span><span class="sxs-lookup"><span data-stu-id="49cd0-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="49cd0-254">Protože `UrlAuthorizationModule` povolení pravidla shora dolů, zastavování na žádná shoda, je důležité mít konkrétnější pravidla předcházet ta méně konkrétní procesy.</span><span class="sxs-lookup"><span data-stu-id="49cd0-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="49cd0-255">To znamená Chcete-li definovat autorizační pravidla, která zakazuje Jisun a anonymní uživatele, ale všechny ostatní ověřeným uživatelům umožnit, by začít s nejspecifičtější pravidla – jeden ovlivňuje Jisun – a pak pokračujte s méně konkrétní pravidla - pravidla povolení všech ostatních ověřené uživatele, ale odepření všichni anonymní uživatelé.</span><span class="sxs-lookup"><span data-stu-id="49cd0-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="49cd0-256">Následující adresa URL autorizační pravidla implementuje tyto zásady tak, že nejprve odepření Jisun a potom odepření anonymní uživatel.</span><span class="sxs-lookup"><span data-stu-id="49cd0-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="49cd0-257">Každý ověřený uživatel než Jisun bude udělen přístup protože ani jedno z těchto `<deny>` příkazy budou odpovídat.</span><span class="sxs-lookup"><span data-stu-id="49cd0-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="49cd0-258">Krok 2: Oprava pracovního postupu pro neoprávněné, ověřeného uživatele</span><span class="sxs-lookup"><span data-stu-id="49cd0-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="49cd0-259">Jak jsme probírali dříve v tomto kurzu v A podívejte se na část pracovní postup autorizace adresy URL, kdykoli ukáže neoprávněného požadavku, `UrlAuthorizationModule` zruší požadavek a vrátí HTTP 401 Unauthorized status.</span><span class="sxs-lookup"><span data-stu-id="49cd0-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="49cd0-260">Tento stav 401 je upraven na `FormsAuthenticationModule` do 302 přesměrování stav, který se odešle uživatel na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="49cd0-261">Tento pracovní postup probíhá na neoprávněného požadavku, i když je uživatel ověřený.</span><span class="sxs-lookup"><span data-stu-id="49cd0-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="49cd0-262">Vrací ověřeného uživatele na přihlašovací stránku se pravděpodobně je matoucí, protože jste už přihlášení do systému.</span><span class="sxs-lookup"><span data-stu-id="49cd0-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="49cd0-263">Stačí nepatrné práce můžeme vylepšit tento pracovní postup přesměrováním ověřeným uživatelům, kteří žádají neoprávněné požadavky na stránku, která vysvětluje, že se pokusí otevřít stránku s omezeným přístupem.</span><span class="sxs-lookup"><span data-stu-id="49cd0-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="49cd0-264">Začněte tím, že vytvoříte novou stránku ASP.NET v kořenové složce webové aplikace s názvem `UnauthorizedAccess.aspx`; nezapomeňte přidružit tuto stránku `Site.master` stránky předlohy.</span><span class="sxs-lookup"><span data-stu-id="49cd0-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="49cd0-265">Po vytvoření této stránky, odebrat ovládací prvek obsahu, který odkazuje `LoginContent` ContentPlaceHolder tak, aby výchozí obsahu stránky předlohy se zobrazí.</span><span class="sxs-lookup"><span data-stu-id="49cd0-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="49cd0-266">Dále přidejte zprávu, která popisuje situaci, a to, že se uživatel pokusil o přístup k chráněnému prostředku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="49cd0-267">Po přidání zpráva, `UnauthorizedAccess.aspx` deklarativním označení stránky by měl vypadat nějak takto:</span><span class="sxs-lookup"><span data-stu-id="49cd0-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample7.aspx)]

<span data-ttu-id="49cd0-268">Nyní potřebujeme ke změně pracovního postupu tak, že pokud neoprávněného požadavku se provádí pomocí ověřeného uživatele jsou odeslány do `UnauthorizedAccess.aspx` stránky místo na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="49cd0-269">Logika, která přesměruje neoprávněné požadavky na přihlašovací stránku je schovaný v rámci privátní metoda `FormsAuthenticationModule` třídy, takže jsme nemůže upravit toto chování.</span><span class="sxs-lookup"><span data-stu-id="49cd0-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="49cd0-270">Co můžeme udělat, ale je přidat vlastní logiku na přihlašovací stránku, který přesměruje uživatele na `UnauthorizedAccess.aspx`, v případě potřeby.</span><span class="sxs-lookup"><span data-stu-id="49cd0-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="49cd0-271">Když `FormsAuthenticationModule` neoprávněné návštěvníka přesměruje na přihlašovací stránku přidá požadovaná, neoprávněným adresa URL řetězec dotazu s názvem `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="49cd0-272">Například při pokusu o neoprávněný uživatel navštívit `OnlyTito.aspx`, `FormsAuthenticationModule` by přesměrovat je na `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="49cd0-273">Proto když se dosáhne přihlašovací stránku od ověřeného uživatele pomocí řetězce dotazu, který obsahuje `ReturnUrl` parametr a potom budeme vědět, že tento neověřený uživatel se pokusil pouze na stránce uživatel nemá oprávnění k zobrazení.</span><span class="sxs-lookup"><span data-stu-id="49cd0-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="49cd0-274">V takovém případě se chceme přesměrování jí `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="49cd0-275">Chcete-li to provést, přidejte následující kód na přihlašovací stránku `Page_Load` obslužné rutiny události:</span><span class="sxs-lookup"><span data-stu-id="49cd0-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample8.cs)]

<span data-ttu-id="49cd0-276">Výše uvedený kód přesměruje ověřený, neoprávněným uživatelům `UnauthorizedAccess.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="49cd0-277">Pokud chcete zobrazit tuto logiku v akci, přejděte na web jako anonymní návštěvníka a klikněte na odkaz vytváření uživatelských účtů v levém sloupci.</span><span class="sxs-lookup"><span data-stu-id="49cd0-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="49cd0-278">Tím přejdete na `~/Membership/CreatingUserAccounts.aspx` stránky, která v kroku 1 jsme nakonfigurovali pouze povolit přístup k Tito.</span><span class="sxs-lookup"><span data-stu-id="49cd0-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="49cd0-279">Protože jsou zakázány anonymním uživatelům, `FormsAuthenticationModule` nám přesměruje zpátky na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="49cd0-280">V tuto chvíli jsme jsou anonymní, takže `Request.IsAuthenticated` vrátí `false` a My se přesměruje na `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `false` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="49cd0-281">Místo toho se zobrazí přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="49cd0-282">Přihlaste se pod jiným než Tito, jako je například Bruce.</span><span class="sxs-lookup"><span data-stu-id="49cd0-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="49cd0-283">Po zadání příslušných přihlašovacích údajů, přihlašovací stránce přesměruje nám zpět na `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="49cd0-284">Ale vzhledem k tomu, že tato stránka je přístupná pouze pro Tito, jsme jsou neoprávněný přístup k jeho zobrazení a o tom bezodkladně informuje přesměrováni na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="49cd0-285">Tentokrát ale `Request.IsAuthenticated` vrátí `true` (a `ReturnUrl` parametr querystring existuje), takže jsme se přesměrují na `UnauthorizedAccess.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-285">This time, however, `Request.IsAuthenticated` returns `true` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>

<span data-ttu-id="49cd0-286">[![Ověření, neoprávněným uživatelům se přesměrují na UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-cs/_static/image17.png)](user-based-authorization-cs/_static/image16.png)</span></span>

<span data-ttu-id="49cd0-287">**Obrázek 6**: Ověření, neoprávněným uživatelům se přesměrují na `UnauthorizedAccess.aspx` ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-cs/_static/image18.png))</span></span>

<span data-ttu-id="49cd0-288">Tato vlastní pracovní postup představuje rozumné a jednoduché uživatelské prostředí podle krátký circuiting cyklu znázorněno na obrázku 2.</span><span class="sxs-lookup"><span data-stu-id="49cd0-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="49cd0-289">Krok 3: Omezení funkcí podle aktuálně přihlášeného uživatele</span><span class="sxs-lookup"><span data-stu-id="49cd0-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="49cd0-290">Autorizace adres URL umožňuje snadno určit hrubý autorizačních pravidel.</span><span class="sxs-lookup"><span data-stu-id="49cd0-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="49cd0-291">Jak jsme viděli v kroku 1, s autorizace adres URL jsme můžete stručně stavu identit, které jsou povolené a které z nich byl odepřen v zobrazení konkrétní stránky nebo všech stránek ve složce.</span><span class="sxs-lookup"><span data-stu-id="49cd0-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="49cd0-292">V některých případech však může Chceme všem uživatelům najdete na stránce, ale omezit na stránce funkce na základě uživatele na jeho.</span><span class="sxs-lookup"><span data-stu-id="49cd0-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="49cd0-293">Podívejte se na webu elektronického obchodování, která umožňuje ověřeným návštěvníkům Zkontrolujte své produkty.</span><span class="sxs-lookup"><span data-stu-id="49cd0-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="49cd0-294">Anonymní uživatel navštíví stránku konkrétního produktu, uvidí jenom informace o produktu a nebude mít možnost ponechat kontrolu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="49cd0-295">Ověřený uživatel na stejné stránce by ale uvidí revize rozhraní.</span><span class="sxs-lookup"><span data-stu-id="49cd0-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="49cd0-296">Pokud ověřený uživatel nebyl zatím Nezkontrolováno tohoto produktu, rozhraní by jim povolit odešlete recenzi; v opačném případě se zobrazí jejich jejich kontrola byla odeslána.</span><span class="sxs-lookup"><span data-stu-id="49cd0-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="49cd0-297">Abyste mohli tento scénář krok dále, na stránce produktu může zobrazit další informace a nabízí rozšířené funkce pro uživatele, kteří pracují pro elektronické obchodování společnosti.</span><span class="sxs-lookup"><span data-stu-id="49cd0-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="49cd0-298">Na stránce produktu může být například seznam inventáře v zásobách a zahrnují možnost Upravit ceny a popis, když uživatel zaměstnanec produktu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="49cd0-299">Takové nich spočívá v jemné autorizační pravidla je možné implementovat buď deklarativně nebo prostřednictvím kódu programu (nebo pomocí kombinace obou).</span><span class="sxs-lookup"><span data-stu-id="49cd0-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="49cd0-300">V další části uvidíme, jak implementovat nich spočívá v jemné autorizace pomocí ovládacího prvku LoginView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="49cd0-301">Pod se podíváme na programový techniky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="49cd0-302">Předtím, než abychom se mohli podívat na použití nich spočívá v jemné autorizační pravidla, ale nejprve musíme vytvořit stránku, jehož funkce závisí na uživatele na jeho.</span><span class="sxs-lookup"><span data-stu-id="49cd0-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="49cd0-303">Pojďme vytvořit stránku, která obsahuje soubory v určitém adresáři v rámci GridView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="49cd0-304">Spolu s výpisem název každého souboru, velikost a další informace, prvku GridView bude obsahovat dva sloupce LinkButtons: jednu s názvem zobrazení a jednu s názvem odstranit.</span><span class="sxs-lookup"><span data-stu-id="49cd0-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="49cd0-305">Pokud dojde ke kliknutí na prvek LinkButton zobrazení, zobrazí se obsah na vybraný soubor; Pokud dojde ke kliknutí na prvek LinkButton odstranit, soubor se odstraní.</span><span class="sxs-lookup"><span data-stu-id="49cd0-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="49cd0-306">Nejprve vytvoříme tuto stránku tak, aby jeho zobrazení a odstraněných funkcí je k dispozici všem uživatelům.</span><span class="sxs-lookup"><span data-stu-id="49cd0-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="49cd0-307">V použití části ovládacího prvku LoginView a omezení funkce prostřednictvím kódu programu, uvidíme, jak povolit nebo zakázat tyto funkce na základě uživatele na stránce.</span><span class="sxs-lookup"><span data-stu-id="49cd0-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="49cd0-308">Stránky ASP.NET, které se chystáte vytvořit používá k zobrazení seznamu souborů ovládacího prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="49cd0-309">Od tohoto kurzu, kterou řada se zaměřuje na ověřování pomocí formulářů, autorizace, uživatelských účtů a rolí nechci strávit příliš mnoho času diskuze o vnitřní fungování ovládacího prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="49cd0-310">Tento kurz poskytuje konkrétní podrobné pokyny pro nastavení této stránky, ne delve podrobnosti, proč byly provedeny některé možnosti, nebo konkrétní vlastnosti vliv mají na vykresleného výstupu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="49cd0-311">Důkladné přezkoumání ovládacího prvku GridView, poraďte Moje *[pracovat s daty v ASP.NET 2.0](../../data-access/index.md)* série kurzů.</span><span class="sxs-lookup"><span data-stu-id="49cd0-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="49cd0-312">Začněte otevřením `UserBasedAuthorization.aspx` soubor `Membership` složky a přidání ovládacího prvku GridView na stránku s názvem `FilesGrid`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="49cd0-313">Z prvku GridView inteligentní značky klikněte na odkaz Upravit sloupce spustit dialogové okno pole.</span><span class="sxs-lookup"><span data-stu-id="49cd0-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="49cd0-314">Z tohoto místa, zrušte zaškrtnutí políčka automaticky generovat pole v levém dolním rohu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="49cd0-315">Dále přidejte tlačítko pro výběr, tlačítko pro odstranění a dva BoundFields z levého horního rohu (tlačítka pro výběr a odstranění najdete v části Typ CommandField).</span><span class="sxs-lookup"><span data-stu-id="49cd0-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="49cd0-316">Vyberte tlačítko nastavit `SelectText` vlastnosti k zobrazení a první vlastnost BoundField `HeaderText` a `DataField` vlastnosti Name.</span><span class="sxs-lookup"><span data-stu-id="49cd0-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="49cd0-317">Nastavit druhý Vlastnost BoundField `HeaderText` vlastnost na velikost v bajtech, jeho `DataField` vlastnost Length, jeho `DataFormatString` vlastnost {0:N0} a jeho `HtmlEncode` vlastnost na hodnotu False.</span><span class="sxs-lookup"><span data-stu-id="49cd0-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="49cd0-318">Po dokončení konfigurace sloupce prvku GridView, kliknutím na OK zavřete dialogové okno pole.</span><span class="sxs-lookup"><span data-stu-id="49cd0-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="49cd0-319">V okně Vlastnosti nastavte prvku GridView `DataKeyNames` vlastnost `FullName`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="49cd0-320">V tuto chvíli deklarativním označení prvku GridView, by měl vypadat nějak takto:</span><span class="sxs-lookup"><span data-stu-id="49cd0-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample9.aspx)]

<span data-ttu-id="49cd0-321">Pomocí vytvoření značky prvku GridView jsme připraveni napsat kód, který načte soubory v určitém adresáři a svázat ho s prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="49cd0-322">Přidejte následující kód na stránku `Page_Load` obslužné rutiny události:</span><span class="sxs-lookup"><span data-stu-id="49cd0-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample10.cs)]

<span data-ttu-id="49cd0-323">Výše uvedený kód používá [ `DirectoryInfo` třídy](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) získat seznam souborů v kořenové složce vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="49cd0-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="49cd0-324">[ `GetFiles()` Metoda](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) vrátí všechny soubory v adresáři jako pole [ `FileInfo` objekty](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), který je pak vázán na prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="49cd0-325">`FileInfo` Objekt má celé řady různých doprovodných vlastností, jako například `Name`, `Length`, a `IsReadOnly`, mimo jiné.</span><span class="sxs-lookup"><span data-stu-id="49cd0-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="49cd0-326">Jak je vidět z jeho deklarativním označení prvku GridView zobrazí pouze `Name` a `Length` vlastnosti.</span><span class="sxs-lookup"><span data-stu-id="49cd0-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="49cd0-327">`DirectoryInfo` a `FileInfo` třídy se nacházejí v [ `System.IO` obor názvů](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="49cd0-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="49cd0-328">Proto bude buď nutnosti začínat tyto názvy tříd s jejich názvy oborů názvů nebo obor názvů importovat do souboru třídy (prostřednictvím `using System.IO`).</span><span class="sxs-lookup"><span data-stu-id="49cd0-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `using System.IO`).</span></span>

<span data-ttu-id="49cd0-329">Za chvíli tuto stránku prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="49cd0-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="49cd0-330">Zobrazí seznam souborů, které se nacházejí v kořenovém adresáři aplikace.</span><span class="sxs-lookup"><span data-stu-id="49cd0-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="49cd0-331">Kliknutím na Zobrazit nebo odstranit LinkButtons způsobí zpětné volání, ale nic se dojít, protože jsme dosud k vytvoření obslužné rutiny událostí nezbytné.</span><span class="sxs-lookup"><span data-stu-id="49cd0-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>

<span data-ttu-id="49cd0-332">[![GridView Vypíše soubory v kořenovém adresáři webové aplikace](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-cs/_static/image20.png)](user-based-authorization-cs/_static/image19.png)</span></span>

<span data-ttu-id="49cd0-333">**Obrázek 7**: GridView Vypíše soubory v kořenovém adresáři webové aplikace ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-cs/_static/image21.png))</span></span>

<span data-ttu-id="49cd0-334">Potřebujeme způsob zobrazení obsahu na vybraný soubor.</span><span class="sxs-lookup"><span data-stu-id="49cd0-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="49cd0-335">Vraťte se do sady Visual Studio a přidejte textové pole s názvem `FileContents` nad prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="49cd0-336">Nastavte jeho `TextMode` vlastnost `MultiLine` a jeho `Columns` a `Rows` vlastností 95 % a 10, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="49cd0-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample11.aspx)]

<span data-ttu-id="49cd0-337">Dále vytvořte obslužnou rutinu události pro prvku GridView [ `SelectedIndexChanged` události](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) a přidejte následující kód:</span><span class="sxs-lookup"><span data-stu-id="49cd0-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample12.cs)]

<span data-ttu-id="49cd0-338">Tento kód používá prvku GridView `SelectedValue` a určí název úplný soubor vybraný soubor.</span><span class="sxs-lookup"><span data-stu-id="49cd0-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="49cd0-339">Interně jsou `DataKeys` kolekce se odkazuje, aby bylo možné získat `SelectedValue`, takže je nutné nastavit prvku GridView `DataKeyNames` vlastnost na název, jak je popsáno dříve v tomto kroku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="49cd0-340">[ `File` Třídy](https://msdn.microsoft.com/library/system.io.file.aspx) slouží k načtení obsahu vybraný soubor do řetězce, který je poté přiřazen `FileContents` textového `Text` vlastnost, a tím zobrazení obsahu vybraný soubor na stránce.</span><span class="sxs-lookup"><span data-stu-id="49cd0-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>

<span data-ttu-id="49cd0-341">[![Soubor vybraný obsah se zobrazí v textovém poli](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-cs/_static/image23.png)](user-based-authorization-cs/_static/image22.png)</span></span>

<span data-ttu-id="49cd0-342">**Obrázek 8**: Soubor vybraný obsah se zobrazí v textovém poli ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-cs/_static/image24.png))</span></span>

> [!NOTE]
> <span data-ttu-id="49cd0-343">Je-li zobrazit obsah souboru, který obsahuje kód HTML a pak se pokusíte zobrazit nebo odstranit soubor, dostanete `HttpRequestValidationException` chyby.</span><span class="sxs-lookup"><span data-stu-id="49cd0-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="49cd0-344">K tomu dochází, protože na zpětné obsah v textovém poli odesílají zpět do webového serveru.</span><span class="sxs-lookup"><span data-stu-id="49cd0-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="49cd0-345">Ve výchozím nastavení, vyvolá ASP.NET `HttpRequestValidationException` chyba pokaždé, když se zjistí potenciálně nebezpečný obsah v zpětného volání, jako je značka jazyka HTML.</span><span class="sxs-lookup"><span data-stu-id="49cd0-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="49cd0-346">Chcete-li zakázat výskytu této chyby, vypněte ověření žádosti pro stránku tak, že přidáte `ValidateRequest="false"` k `@Page` směrnice.</span><span class="sxs-lookup"><span data-stu-id="49cd0-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="49cd0-347">Další informace o výhodách ověření žádosti jako i jaká opatření byste měli podniknout při zakázání, najdete v článku [ověření požadavku – prevence útoků skript](https://asp.net/learn/whitepapers/request-validation/).</span><span class="sxs-lookup"><span data-stu-id="49cd0-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>

<span data-ttu-id="49cd0-348">Nakonec přidejte obslužnou rutinu události s následujícím kódem pro prvku GridView [ `RowDeleting` události](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span><span class="sxs-lookup"><span data-stu-id="49cd0-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample13.cs)]

<span data-ttu-id="49cd0-349">Kód jednoduše zobrazí celý název souboru k odstranění ve `FileContents` TextBox *bez* skutečného odstranění souboru.</span><span class="sxs-lookup"><span data-stu-id="49cd0-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>

<span data-ttu-id="49cd0-350">[![Kliknutím na tlačítko Odstranit neodstraní ve skutečnosti soubor](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-cs/_static/image26.png)](user-based-authorization-cs/_static/image25.png)</span></span>

<span data-ttu-id="49cd0-351">**Obrázek 9**: Kliknutím odstranit tlačítko ve skutečnosti neodstraní na soubor ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-cs/_static/image27.png))</span></span>

<span data-ttu-id="49cd0-352">V kroku 1 jsme nakonfigurovali zakázat anonymní uživatelé ze zobrazení stránek v autorizačních pravidel adres URL `Membership` složky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="49cd0-353">Aby bylo možné lépe vykazovat nich spočívá v jemné ověřování, můžeme povolit anonymní uživatelé přejdete `UserBasedAuthorization.aspx` stránky, ale s omezenou funkčností.</span><span class="sxs-lookup"><span data-stu-id="49cd0-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="49cd0-354">Otevřete tuto stránku Pokud chcete mít přístup všichni uživatelé, přidejte následující `<location>` elementu `Web.config` soubor `Membership` složky:</span><span class="sxs-lookup"><span data-stu-id="49cd0-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-cs/samples/sample14.xml)]

<span data-ttu-id="49cd0-355">Po přidání tohoto `<location>` elementu, otestujte nový autorizačních pravidel adres URL protokolování mimo lokalitu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="49cd0-356">Jako anonymní uživatel by měl povolena navštívit `UserBasedAuthorization.aspx` stránky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="49cd0-357">V současné době můžete navštívit každý ověřený nebo anonymní uživatel `UserBasedAuthorization.aspx` stránce a zobrazovat a odstraňovat soubory.</span><span class="sxs-lookup"><span data-stu-id="49cd0-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="49cd0-358">Tak, aby pouze ověřeným uživatelům může zobrazit obsah souboru a soubor lze odstranit pouze Tito ho vytvoříme.</span><span class="sxs-lookup"><span data-stu-id="49cd0-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="49cd0-359">Tato pravidla autorizace nich spočívá v jemné lze použít deklarativně, prostřednictvím kódu programu nebo kombinací obou metod.</span><span class="sxs-lookup"><span data-stu-id="49cd0-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="49cd0-360">S použitím deklarativní přístup omezit, kdo může zobrazit obsah souboru použijeme programový přístup k omezení toho, kdo může odstranit soubor.</span><span class="sxs-lookup"><span data-stu-id="49cd0-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="49cd0-361">Použití ovládacího prvku LoginView</span><span class="sxs-lookup"><span data-stu-id="49cd0-361">Using the LoginView Control</span></span>

<span data-ttu-id="49cd0-362">Jak jsme viděli v posledních kurzy, ovládacího prvku LoginView je užitečné pro zobrazení různých rozhraní pro uživatele ověřeného a anonymní a nabízí snadný způsob, jak skrýt funkce, které nejsou dostupné pro anonymní uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="49cd0-363">Protože anonymní uživatelé nemohou zobrazit nebo odstranit soubory, potřebujeme jenom zobrazit `FileContents` textového pole při návštěvě stránky ověřeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="49cd0-364">K dosažení tohoto cíle, přidejte ovládací prvek zobrazení přihlášení na stránku, pojmenujte ho `LoginViewForFileContentsTextBox`a přesunout `FileContents` textového deklarativní do ovládacího prvku LoginView `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample15.aspx)]

<span data-ttu-id="49cd0-365">Webové ovládací prvky v prvku LoginView šablony už nejsou přímo dostupné z třídy modelu code-behind.</span><span class="sxs-lookup"><span data-stu-id="49cd0-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="49cd0-366">Například `FilesGrid` prvku GridView `SelectedIndexChanged` a `RowDeleting` obslužné rutiny událostí aktuálně odkazují `FileContents` ovládací prvek TextBox s kódem, jako jsou:</span><span class="sxs-lookup"><span data-stu-id="49cd0-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample16.cs)]

<span data-ttu-id="49cd0-367">Tento kód je však již nebude platný.</span><span class="sxs-lookup"><span data-stu-id="49cd0-367">However, this code is no longer valid.</span></span> <span data-ttu-id="49cd0-368">Přechodem `FileContents` textového pole do `LoggedInTemplate` textového pole nelze přistupovat přímo.</span><span class="sxs-lookup"><span data-stu-id="49cd0-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="49cd0-369">Místo toho, musíme použít `FindControl("controlId")` metoda prostřednictvím kódu programu odkazovat na ovládací prvek.</span><span class="sxs-lookup"><span data-stu-id="49cd0-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="49cd0-370">Aktualizace `FilesGrid` obslužných rutin událostí k odkazování textové pole takto:</span><span class="sxs-lookup"><span data-stu-id="49cd0-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample17.cs)]

<span data-ttu-id="49cd0-371">Po přesunutí textového pole LoginView `LoggedInTemplate` a aktualizaci na stránku kódu do textového pole pomocí odkazu `FindControl("controlId")` vzorku naleznete na stránce jako anonymní uživatel.</span><span class="sxs-lookup"><span data-stu-id="49cd0-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="49cd0-372">Obrázek 10 ukazuje, `FileContents` textové pole nezobrazí.</span><span class="sxs-lookup"><span data-stu-id="49cd0-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="49cd0-373">Na prvek LinkButton zobrazení je však stále zobrazen.</span><span class="sxs-lookup"><span data-stu-id="49cd0-373">However, the View LinkButton is still displayed.</span></span>

<span data-ttu-id="49cd0-374">[![Ovládacího prvku LoginView pouze vykresluje textové pole FileContents ověřených uživatelů](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-cs/_static/image29.png)](user-based-authorization-cs/_static/image28.png)</span></span>

<span data-ttu-id="49cd0-375">**Obrázek 10**: Zobrazení přihlášení pouze vykresluje `FileContents` textové pole pro ověřené uživatele ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-cs/_static/image30.png))</span></span>

<span data-ttu-id="49cd0-376">Jeden způsob, jak skrýt tlačítko pro anonymní uživatele je převést na pole TemplateField pole ovládacího prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="49cd0-377">Tím se vygeneruje šablonu, která obsahuje deklarativní LinkButton zobrazení.</span><span class="sxs-lookup"><span data-stu-id="49cd0-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="49cd0-378">My pak přidání ovládacího prvku LoginView pole TemplateField a umístěte odkazem (LinkButton) v rámci prvku LoginView `LoggedInTemplate`, a tím skrytí tlačítka zobrazit z anonymního návštěvníků.</span><span class="sxs-lookup"><span data-stu-id="49cd0-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="49cd0-379">K tomu, klikněte na odkaz Upravit sloupce v prvku GridView inteligentních značek ke spuštění dialogové okno pole.</span><span class="sxs-lookup"><span data-stu-id="49cd0-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="49cd0-380">V dalším kroku vyberte tlačítko pro výběr v seznamu v levém dolním rohu a klikněte na převést toto pole TemplateField propojení.</span><span class="sxs-lookup"><span data-stu-id="49cd0-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="49cd0-381">Tím upraví deklarativní pole od:</span><span class="sxs-lookup"><span data-stu-id="49cd0-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample18.aspx)]

 <span data-ttu-id="49cd0-382">Do:</span><span class="sxs-lookup"><span data-stu-id="49cd0-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-cs/samples/sample19.aspx)]

<span data-ttu-id="49cd0-383">V tuto chvíli můžeme přidat zobrazení přihlášení pole TemplateField.</span><span class="sxs-lookup"><span data-stu-id="49cd0-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="49cd0-384">Následující kód zobrazí zobrazení odkazem (LinkButton) pouze pro ověřené uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-384">The following markup displays the View LinkButton only for authenticated users.</span></span>

[!code-aspx[Main](user-based-authorization-cs/samples/sample20.aspx)]

<span data-ttu-id="49cd0-385">Jak ukazuje obrázek 11, není konečný výsledek, že poměrně jako zobrazení sloupce se stále zobrazí i v případě, že jsou skryté LinkButtons zobrazení ve sloupci.</span><span class="sxs-lookup"><span data-stu-id="49cd0-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="49cd0-386">Podíváme se na tom, jak skrýt celý sloupec ovládacího prvku GridView (a ne jenom na prvek LinkButton) v další části.</span><span class="sxs-lookup"><span data-stu-id="49cd0-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>

<span data-ttu-id="49cd0-387">[![Ovládacího prvku LoginView skryje LinkButtons zobrazení pro anonymní uživatelé](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-cs/_static/image32.png)](user-based-authorization-cs/_static/image31.png)</span></span>

<span data-ttu-id="49cd0-388">**Obrázek 11**: Ovládacího prvku LoginView skryje LinkButtons zobrazení pro anonymní uživatelé ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-cs/_static/image33.png))</span></span>

### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="49cd0-389">Programová omezení funkcí</span><span class="sxs-lookup"><span data-stu-id="49cd0-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="49cd0-390">V některých případech deklarativní techniky nedostačují k omezení funkcí na stránku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="49cd0-391">Dostupnost funkcí některé stránky může být například závislé na kritériích nad rámec, jestli je uživatel na stránce ověřený nebo anonymní.</span><span class="sxs-lookup"><span data-stu-id="49cd0-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="49cd0-392">V takových případech můžete zobrazení nebo skrytí programové způsoby různé prvky uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="49cd0-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="49cd0-393">Aby bylo možné omezit funkčnost prostřednictvím kódu programu, musíme provést dvě úlohy:</span><span class="sxs-lookup"><span data-stu-id="49cd0-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="49cd0-394">Určení, zda má uživatel na stránce přístup je funkce, a</span><span class="sxs-lookup"><span data-stu-id="49cd0-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="49cd0-395">Programová změna uživatelské rozhraní založené na tom, jestli má uživatel přístup k funkci dotyčný.</span><span class="sxs-lookup"><span data-stu-id="49cd0-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="49cd0-396">Abychom si předvedli aplikace tyto dvě úlohy, jenom povolíme Tito odstranit soubory z prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="49cd0-397">Naše první úkol, je zjistit, jestli je na stránce Tito.</span><span class="sxs-lookup"><span data-stu-id="49cd0-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="49cd0-398">Po zjištění, které potřebujeme pro skrytí (nebo zobrazení) odstranit sloupec prvku GridView.</span><span class="sxs-lookup"><span data-stu-id="49cd0-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="49cd0-399">Sloupce prvku GridView jsou přístupné prostřednictvím jeho `Columns` vlastnost; sloupec je vykreslen pouze, pokud jeho `Visible` je nastavena na `true` (výchozí).</span><span class="sxs-lookup"><span data-stu-id="49cd0-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `true` (the default).</span></span>

<span data-ttu-id="49cd0-400">Přidejte následující kód, který `Page_Load` obslužná rutina události před vazbě dat na prvku GridView:</span><span class="sxs-lookup"><span data-stu-id="49cd0-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample21.cs)]

<span data-ttu-id="49cd0-401">Jak jsme probírali v [ *Přehled ověřování založené na formulářích* ](../introduction/an-overview-of-forms-authentication-cs.md) kurzu `User.Identity.Name` vrátí název identity.</span><span class="sxs-lookup"><span data-stu-id="49cd0-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="49cd0-402">To odpovídá zadané v ovládacím prvku přihlašovací uživatelské jméno.</span><span class="sxs-lookup"><span data-stu-id="49cd0-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="49cd0-403">Pokud se Tito navštívit stránky, druhý sloupec prvku GridView `Visible` je nastavena na `true`; v opačném případě je nastavený na `false`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `true`; otherwise, it is set to `false`.</span></span> <span data-ttu-id="49cd0-404">Net výsledkem je, že pokud někdo jiný než Tito navštíví stránku, jiný uživatel ověřený nebo anonymní uživatel, odstranit sloupec není vykreslen (viz obrázek 12); Pokud však Tito navštíví stránku, odstranit sloupec je k dispozici (viz obrázek 13).</span><span class="sxs-lookup"><span data-stu-id="49cd0-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>

<span data-ttu-id="49cd0-405">[![Odstranit sloupec není vykresleno při navštívené podle někdo jiný než Tito (například Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-cs/_static/image35.png)](user-based-authorization-cs/_static/image34.png)</span></span>

<span data-ttu-id="49cd0-406">**Obrázek 12**: Odstranit sloupec není vykresleno při navštívené podle někdo jiný než Tito (například Bruce) ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-cs/_static/image36.png))</span></span>

<span data-ttu-id="49cd0-407">[![Odstranit sloupec je vykreslen pro Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-407">[![The Delete Column is Rendered for Tito](user-based-authorization-cs/_static/image38.png)](user-based-authorization-cs/_static/image37.png)</span></span>

<span data-ttu-id="49cd0-408">**Obrázek 13**: Odstranit sloupec je vykreslen pro Tito ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-cs/_static/image39.png))</span></span>

## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="49cd0-409">Krok 4: Použití ověřovacích pravidel u tříd a metod</span><span class="sxs-lookup"><span data-stu-id="49cd0-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="49cd0-410">V kroku 3 jsme zakázán anonymní uživatelé ze zobrazení obsahu souboru zpřístupníme a všichni uživatelé, ale Tito odstraňování souborů.</span><span class="sxs-lookup"><span data-stu-id="49cd0-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="49cd0-411">Toho dosáhlo tím, že skryjete prvky přidružené uživatelského rozhraní pro neoprávněné návštěvníků prostřednictvím deklarativní a programová techniky.</span><span class="sxs-lookup"><span data-stu-id="49cd0-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="49cd0-412">Náš jednoduchý příklad správně skrytí prvky uživatelského rozhraní bylo jednoznačné, ale co složitější lokality tam, kde mohou existovat mnoho různých způsobů, jak provádět stejné funkce?</span><span class="sxs-lookup"><span data-stu-id="49cd0-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="49cd0-413">V omezení, které tuto funkci neoprávněným uživatelům, co se stane, pokud jsme zapomněli pro skrytí nebo zakázat všechny prvky odpovídající uživatelské rozhraní?</span><span class="sxs-lookup"><span data-stu-id="49cd0-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="49cd0-414">Snadný způsob, jak zajistit, že konkrétní funkce nelze přistupovat jakýkoli neoprávněný uživatel je k vyplnění této třídy nebo metody pomocí [ `PrincipalPermission` atribut](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="49cd0-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="49cd0-415">Pokud modul .NET runtime používá třídu nebo spustí jednu z jeho metod, zkontroluje, ujistěte se, že aktuální kontext zabezpečení má oprávnění k použití třídy nebo proveďte metodu.</span><span class="sxs-lookup"><span data-stu-id="49cd0-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="49cd0-416">`PrincipalPermission` Atribut poskytuje mechanismus, pomocí kterého definujeme tato pravidla.</span><span class="sxs-lookup"><span data-stu-id="49cd0-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="49cd0-417">Přiblížíme pomocí `PrincipalPermission` atribut v prvku GridView `SelectedIndexChanged` a `RowDeleting` obslužných rutin událostí k zakázat spouštění anonymní uživatelé a uživatelé než Tito, v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="49cd0-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="49cd0-418">Všechno, co musíme udělat, je přidání odpovídajícího atributu imitovaná každá definice funkce:</span><span class="sxs-lookup"><span data-stu-id="49cd0-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample22.cs)]

<span data-ttu-id="49cd0-419">Atribut pro `SelectedIndexChanged` určují obslužné rutiny událostí, které jenom ověření uživatelé můžete spustit obslužnou rutinu události, kde jako atribut `RowDeleting` tak provedení Tito omezuje obslužné rutiny události.</span><span class="sxs-lookup"><span data-stu-id="49cd0-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

<span data-ttu-id="49cd0-420">Pokud nějakým způsobem, jiným uživatelem, než Tito pokusy o spuštění `RowDeleting` obslužná rutina události nebo jiné ověřený uživatel pokusí spustit `SelectedIndexChanged` obslužná rutina události, vyvolá se modul .NET runtime `SecurityException`.</span><span class="sxs-lookup"><span data-stu-id="49cd0-420">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>

<span data-ttu-id="49cd0-421">[![Pokud je kontext zabezpečení nemá oprávnění k provádění metody, je vyvolána SecurityException –](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="49cd0-421">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-cs/_static/image41.png)](user-based-authorization-cs/_static/image40.png)</span></span>

<span data-ttu-id="49cd0-422">**Obrázek 14**: Pokud je kontext zabezpečení nemá oprávnění k provádění metody, `SecurityException` je vyvolána výjimka ([kliknutím ji zobrazíte obrázek v plné velikosti](user-based-authorization-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="49cd0-422">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-cs/_static/image42.png))</span></span>

> [!NOTE]
> <span data-ttu-id="49cd0-423">Pokud chcete povolit více kontexty zabezpečení pro přístup k tříd nebo metod, uspořádání třídy nebo metody pomocí `PrincipalPermission` atribut pro každý kontext zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="49cd0-423">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="49cd0-424">To znamená aby Tito a Bruce spustit `RowDeleting` obslužná rutina události, přidejte *dvě* `PrincipalPermission` atributy:</span><span class="sxs-lookup"><span data-stu-id="49cd0-424">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>

[!code-csharp[Main](user-based-authorization-cs/samples/sample23.cs)]

<span data-ttu-id="49cd0-425">Kromě stránek ASP.NET mají mnoho aplikací také architekturu, která zahrnuje různé vrstvy, jako je například obchodní logiky a vrstvy přístupu k datům.</span><span class="sxs-lookup"><span data-stu-id="49cd0-425">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="49cd0-426">Tyto vrstvy jsou obvykle implementovány jako knihovny tříd a nabízejí třídy a metody pro provádění obchodní logiku a data související funkce.</span><span class="sxs-lookup"><span data-stu-id="49cd0-426">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="49cd0-427">`PrincipalPermission` Atribut je užitečné pro použití autorizačních pravidel pro tyto vrstvy.</span><span class="sxs-lookup"><span data-stu-id="49cd0-427">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="49cd0-428">Další informace o používání `PrincipalPermission` atribut pro definování pravidel autorizace na třídy a metody, přečtěte si [Scott Guthrie](https://weblogs.asp.net/scottgu/)na blogu [přidáním autorizačních pravidel a obchodních dat pomocí vrstvy `PrincipalPermissionAttributes` ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="49cd0-428">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="49cd0-429">Souhrn</span><span class="sxs-lookup"><span data-stu-id="49cd0-429">Summary</span></span>

<span data-ttu-id="49cd0-430">V tomto kurzu jsme se podívali na tom, jak aplikovat autorizační pravidla založená na uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-430">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="49cd0-431">Začali jsme s podívat, ASP. Na .NET framework autorizace adresy URL.</span><span class="sxs-lookup"><span data-stu-id="49cd0-431">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="49cd0-432">V každé žádosti, modul ASP.NET `UrlAuthorizationModule` zkontroluje autorizačních pravidel adres URL definované v konfiguraci vaší aplikace k určení, zda je oprávněn identitu pro přístup k požadovanému prostředku.</span><span class="sxs-lookup"><span data-stu-id="49cd0-432">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="49cd0-433">Stručně řečeno autorizace adres URL umožňuje snadno určit autorizační pravidla pro konkrétní stránky, nebo pro všechny stránky v určitém adresáři.</span><span class="sxs-lookup"><span data-stu-id="49cd0-433">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="49cd0-434">Rozhraní autorizace adresy URL použije pravidla autorizace na základě stránku po stránce.</span><span class="sxs-lookup"><span data-stu-id="49cd0-434">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="49cd0-435">S autorizace adres URL je žádost o identitu oprávnění pro přístup k určitému prostředku nebo ne.</span><span class="sxs-lookup"><span data-stu-id="49cd0-435">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="49cd0-436">Mnoho scénářů, ale volání pro další nich spočívá v jemné autorizačních pravidel.</span><span class="sxs-lookup"><span data-stu-id="49cd0-436">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="49cd0-437">Místo definovat, kdo smí získat přístup na stránku, možná potřebujeme umožňuje všem uživatelům přístup ke stránce, ale zobrazení jiných dat nebo nabízejí různé funkce v závislosti na uživatele na stránce.</span><span class="sxs-lookup"><span data-stu-id="49cd0-437">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="49cd0-438">Autorizaci na úrovni stránky obvykle zahrnuje, aby bylo možné zabránit neoprávněným uživatelům v přístupu k zakázané funkce skrytí prvky konkrétní uživatelského rozhraní.</span><span class="sxs-lookup"><span data-stu-id="49cd0-438">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="49cd0-439">Kromě toho je možné použít atributy k omezení přístupu k třídy a spuštění z jeho metod pro určité uživatele.</span><span class="sxs-lookup"><span data-stu-id="49cd0-439">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="49cd0-440">Všechno nejlepší programování!</span><span class="sxs-lookup"><span data-stu-id="49cd0-440">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="49cd0-441">Další čtení</span><span class="sxs-lookup"><span data-stu-id="49cd0-441">Further Reading</span></span>

<span data-ttu-id="49cd0-442">Další informace o tématech, které jsou popsané v tomto kurzu najdete na následujících odkazech:</span><span class="sxs-lookup"><span data-stu-id="49cd0-442">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="49cd0-443">Přidání obchodní a datové vrstvy pomocí autorizačních pravidel `PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="49cd0-443">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="49cd0-444">Povolení technologie ASP.NET</span><span class="sxs-lookup"><span data-stu-id="49cd0-444">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="49cd0-445">Změny mezi IIS6 a zabezpečení služby IIS7</span><span class="sxs-lookup"><span data-stu-id="49cd0-445">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="49cd0-446">Konfigurace určité soubory a podadresáře</span><span class="sxs-lookup"><span data-stu-id="49cd0-446">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="49cd0-447">Omezení funkcí pro úpravu dat podle uživatele</span><span class="sxs-lookup"><span data-stu-id="49cd0-447">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-cs.md)
- [<span data-ttu-id="49cd0-448">Šablony rychlý start ovládací prvek zobrazení přihlášení</span><span class="sxs-lookup"><span data-stu-id="49cd0-448">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="49cd0-449">Principy autorizace adres URL služby IIS7</span><span class="sxs-lookup"><span data-stu-id="49cd0-449">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="49cd0-450">`UrlAuthorizationModule` Technická dokumentace</span><span class="sxs-lookup"><span data-stu-id="49cd0-450">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="49cd0-451">Práce s daty v technologii ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="49cd0-451">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="49cd0-452">O autorovi</span><span class="sxs-lookup"><span data-stu-id="49cd0-452">About the Author</span></span>

<span data-ttu-id="49cd0-453">Scott Meisnerová, Autor více ASP/ASP.NET knih a zakladatelem 4GuysFromRolla.com, má pracovali Microsoft webových technologiích od roku 1998.</span><span class="sxs-lookup"><span data-stu-id="49cd0-453">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="49cd0-454">Scott funguje jako nezávislý konzultant, trainer a zapisovače.</span><span class="sxs-lookup"><span data-stu-id="49cd0-454">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="49cd0-455">Jeho nejnovější knihy  *[Edice nakladatelství Sams naučit sami ASP.NET 2.0 za 24 hodin](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="49cd0-455">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="49cd0-456">Scott může být dostupný na adrese [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) nebo prostřednictvím na svém blogu [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="49cd0-456">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="49cd0-457">Speciální k</span><span class="sxs-lookup"><span data-stu-id="49cd0-457">Special Thanks To</span></span>

<span data-ttu-id="49cd0-458">V této sérii kurzů byl recenzován uživatelem mnoho užitečných revidující.</span><span class="sxs-lookup"><span data-stu-id="49cd0-458">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="49cd0-459">Zajímat téma Moje nadcházejících článcích MSDN?</span><span class="sxs-lookup"><span data-stu-id="49cd0-459">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="49cd0-460">Pokud ano, vyřaďte mě řádek na [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="49cd0-460">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="49cd0-461">[Předchozí](validating-user-credentials-against-the-membership-user-store-cs.md)
> [další](storing-additional-user-information-cs.md)</span><span class="sxs-lookup"><span data-stu-id="49cd0-461">[Previous](validating-user-credentials-against-the-membership-user-store-cs.md)
[Next](storing-additional-user-information-cs.md)</span></span>
