---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
title: Konfigurace ověřování formulářů a Pokročilá témataC#() | Microsoft Docs
author: rick-anderson
description: V tomto kurzu prověříme různá nastavení ověřování pomocí formulářů a zjistíte, jak je upravovat pomocí elementu Forms. To má za následek detailní...
ms.author: riande
ms.date: 01/14/2008
ms.assetid: b9c29865-a34e-48bb-92c0-c443a72cb860
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
msc.type: authoredcontent
ms.openlocfilehash: b296f31da1c73df97175d94402b4d618df425d8d
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/28/2019
ms.locfileid: "74579349"
---
# <a name="forms-authentication-configuration-and-advanced-topics-c"></a><span data-ttu-id="25cbb-104">Konfigurace ověřování pomocí formuláře a pokročilá témata (C#)</span><span class="sxs-lookup"><span data-stu-id="25cbb-104">Forms Authentication Configuration and Advanced Topics (C#)</span></span>

<span data-ttu-id="25cbb-105">[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="25cbb-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="25cbb-106">[Stažení kódu](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) nebo [stažení PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="25cbb-106">[Download Code](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) or [Download PDF](https://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span></span>

> <span data-ttu-id="25cbb-107">V tomto kurzu prověříme různá nastavení ověřování pomocí formulářů a zjistíte, jak je upravovat pomocí elementu Forms.</span><span class="sxs-lookup"><span data-stu-id="25cbb-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="25cbb-108">To bude mít podrobnější přehled o přizpůsobení hodnoty časového limitu ověřovacího lístku formulářů pomocí přihlašovací stránky s vlastní adresou URL (třeba Login. aspx místo Login. aspx) a ověřovacími lístky pro formuláře bez souborů cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>

## <a name="introduction"></a><span data-ttu-id="25cbb-109">Úvod</span><span class="sxs-lookup"><span data-stu-id="25cbb-109">Introduction</span></span>

<span data-ttu-id="25cbb-110">V [předchozím kurzu](an-overview-of-forms-authentication-cs.md) jsme se prohlédli v krocích nezbytných pro implementaci ověřování pomocí formulářů v aplikaci ASP.NET, od zadání nastavení konfigurace v souboru Web. config pro vytvoření přihlašovací stránky pro zobrazení jiného obsahu pro ověřené a anonymní uživatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-110">In the [previous tutorial](an-overview-of-forms-authentication-cs.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="25cbb-111">Odvoláme, že jsme nakonfigurovali web na používání ověřování pomocí formulářů, nastavením atributu Mode&gt; elementu &lt;Authentication na formuláře.</span><span class="sxs-lookup"><span data-stu-id="25cbb-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="25cbb-112">Element &lt;Authentication&gt; může volitelně zahrnovat &lt;Forms&gt; podřízený element, pomocí kterého je možné určit sortiment nastavení ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="25cbb-113">V tomto kurzu prověříme různá nastavení ověřování pomocí formulářů a zjistíte, jak je upravovat pomocí&gt; elementu &lt;Forms.</span><span class="sxs-lookup"><span data-stu-id="25cbb-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="25cbb-114">To bude mít podrobnější přehled o přizpůsobení hodnoty časového limitu ověřovacího lístku formulářů pomocí přihlašovací stránky s vlastní adresou URL (třeba Login. aspx místo Login. aspx) a ověřovacími lístky pro formuláře bez souborů cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="25cbb-115">Podíváme se také na strukturu lístku pro ověřování pomocí formulářů a Prohlédněte si preventivní opatření ASP.NET, která zajistí, aby data lístku byla zabezpečená před kontrolou a manipulací.</span><span class="sxs-lookup"><span data-stu-id="25cbb-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="25cbb-116">Nakonec se podíváme na to, jak ukládat dodatečná uživatelská data v ověřovacím lístku pro formuláře a jak tato data vytvořit prostřednictvím vlastního objektu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="25cbb-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="25cbb-117">Krok 1: Kontrola nastavení konfigurace&gt; &lt;Forms</span><span class="sxs-lookup"><span data-stu-id="25cbb-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="25cbb-118">Systém ověřování pomocí formulářů v ASP.NET nabízí řadu nastavení konfigurace, která je možné přizpůsobit na základě aplikace.</span><span class="sxs-lookup"><span data-stu-id="25cbb-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="25cbb-119">To zahrnuje nastavení jako: životnost lístku pro ověřování formulářů; Jaký je způsob, jakým se tato ochrana používá pro lístek; za jakých podmínek se používají ověřovací lístky bez souborů cookie; Cesta k přihlašovací stránce a další informace.</span><span class="sxs-lookup"><span data-stu-id="25cbb-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="25cbb-120">Chcete-li upravit výchozí hodnoty, přidejte [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) jako podřízený [prvek&lt;ověřování&gt;](https://msdn.microsoft.com/library/532aee0e.aspx)a určete tak hodnoty vlastností, které chcete přizpůsobit jako atributy XML, například takto:</span><span class="sxs-lookup"><span data-stu-id="25cbb-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample1.xml)]

<span data-ttu-id="25cbb-121">Tabulka 1 shrnuje vlastnosti, které lze přizpůsobit pomocí&gt; elementu &lt;Forms.</span><span class="sxs-lookup"><span data-stu-id="25cbb-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="25cbb-122">Vzhledem k tomu, že web. config je soubor XML, názvy atributů v levém sloupci rozlišují velká a malá písmena.</span><span class="sxs-lookup"><span data-stu-id="25cbb-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="25cbb-123"><strong>Atribut</strong></span><span class="sxs-lookup"><span data-stu-id="25cbb-123"><strong>Attribute</strong></span></span> |                                                                                                                                                                                                                                     <span data-ttu-id="25cbb-124"><strong>Popis</strong></span><span class="sxs-lookup"><span data-stu-id="25cbb-124"><strong>Description</strong></span></span>                                                                                                                                                                                                                                      |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|         <span data-ttu-id="25cbb-125">formulář</span><span class="sxs-lookup"><span data-stu-id="25cbb-125">cookieless</span></span>         |                                                                                                                <span data-ttu-id="25cbb-126">Tento atribut určuje, za jakých podmínek je ověřovací lístek uložený v souboru cookie, který je vložený v adrese URL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="25cbb-127">Povolené hodnoty jsou: UseCookies; UseUri; Automatické rozpoznávání a UseDeviceProfile (výchozí).</span><span class="sxs-lookup"><span data-stu-id="25cbb-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="25cbb-128">Krok 2 toto nastavení prověřuje podrobněji.</span><span class="sxs-lookup"><span data-stu-id="25cbb-128">Step 2 examines this setting in more detail.</span></span>                                                                                                                |
|         <span data-ttu-id="25cbb-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="25cbb-129">defaultUrl</span></span>         |                                                                                                                                                         <span data-ttu-id="25cbb-130">Určuje adresu URL, na kterou se uživatelé přesměrují po přihlášení ze stránky pro přihlášení, pokud v řetězci dotazu není zadaná žádná hodnota RedirectUrl.</span><span class="sxs-lookup"><span data-stu-id="25cbb-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="25cbb-131">Výchozí hodnota je Default. aspx.</span><span class="sxs-lookup"><span data-stu-id="25cbb-131">The default value is default.aspx.</span></span>                                                                                                                                                         |
|           <span data-ttu-id="25cbb-132">domain</span><span class="sxs-lookup"><span data-stu-id="25cbb-132">domain</span></span>           | <span data-ttu-id="25cbb-133">Při použití ověřovacích lístků založených na souborech cookie určuje toto nastavení hodnotu domény souboru cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-133">When using cookie-based authentication tickets, this setting specifies the cookie's domain value.</span></span> <span data-ttu-id="25cbb-134">Výchozí hodnota je prázdný řetězec, který způsobí, že prohlížeč použije doménu, ze které byla vydána (například www.yourdomain.com).</span><span class="sxs-lookup"><span data-stu-id="25cbb-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="25cbb-135">V takovém <strong>případě se soubory</strong> cookie neodesílají při vytváření požadavků na subdomény, jako je admin.yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="25cbb-135">In this case, the cookie will <strong>not</strong> be sent when making requests to subdomains, such as admin.yourdomain.com.</span></span> <span data-ttu-id="25cbb-136">Pokud chcete, aby byl soubor cookie předán všem poddoménám, je třeba přizpůsobit atribut domény jeho nastavení na yourdomain.com.</span><span class="sxs-lookup"><span data-stu-id="25cbb-136">If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
|  <span data-ttu-id="25cbb-137">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="25cbb-137">enableCrossAppRedirects</span></span>   |                                                                                                                                                                   <span data-ttu-id="25cbb-138">Logická hodnota označující, zda jsou ověření uživatelé zapamatování při přesměrování na adresy URL v jiných webových aplikacích na stejném serveru.</span><span class="sxs-lookup"><span data-stu-id="25cbb-138">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="25cbb-139">Výchozí hodnota je false.</span><span class="sxs-lookup"><span data-stu-id="25cbb-139">The default is false.</span></span>                                                                                                                                                                   |
|          <span data-ttu-id="25cbb-140">loginUrl</span><span class="sxs-lookup"><span data-stu-id="25cbb-140">loginUrl</span></span>          |                                                                                                                                                                                                                      <span data-ttu-id="25cbb-141">Adresa URL přihlašovací stránky</span><span class="sxs-lookup"><span data-stu-id="25cbb-141">The URL of the login page.</span></span> <span data-ttu-id="25cbb-142">Výchozí hodnota je Login. aspx.</span><span class="sxs-lookup"><span data-stu-id="25cbb-142">The default value is login.aspx.</span></span>                                                                                                                                                                                                                      |
|            <span data-ttu-id="25cbb-143">name</span><span class="sxs-lookup"><span data-stu-id="25cbb-143">name</span></span>            |                                                                                                                                                                                                   <span data-ttu-id="25cbb-144">Pokud používáte ověřovací lístky založené na souborech cookie, název souboru cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-144">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="25cbb-145">Výchozí hodnota je. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="25cbb-145">The default is .ASPXAUTH.</span></span>                                                                                                                                                                                                   |
|            <span data-ttu-id="25cbb-146">cesta</span><span class="sxs-lookup"><span data-stu-id="25cbb-146">path</span></span>            |                                                                             <span data-ttu-id="25cbb-147">Při použití ověřovacích lístků založených na souborech cookie určuje toto nastavení atribut cesty souboru cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-147">When using cookie-based authentication tickets, this setting specifies the cookie's path attribute.</span></span> <span data-ttu-id="25cbb-148">Atribut path umožňuje vývojářům omezit rozsah souboru cookie na konkrétní hierarchii adresářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-148">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="25cbb-149">Výchozí hodnota je/, která informuje prohlížeč o odeslání souboru cookie ověřovacího lístku do jakékoli žádosti provedené v doméně.</span><span class="sxs-lookup"><span data-stu-id="25cbb-149">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span>                                                                              |
|         <span data-ttu-id="25cbb-150">ochrana</span><span class="sxs-lookup"><span data-stu-id="25cbb-150">protection</span></span>         |                                                                                                                                            <span data-ttu-id="25cbb-151">Určuje, jaké techniky se používají k ochraně lístku pro ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-151">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="25cbb-152">Povolené hodnoty jsou: All (výchozí); Šifr NTato a ověření.</span><span class="sxs-lookup"><span data-stu-id="25cbb-152">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="25cbb-153">Tato nastavení jsou podrobněji popsaná v kroku 3.</span><span class="sxs-lookup"><span data-stu-id="25cbb-153">These settings are discussed in detail in Step 3.</span></span>                                                                                                                                            |
|         <span data-ttu-id="25cbb-154">Vlastnost requireSSL</span><span class="sxs-lookup"><span data-stu-id="25cbb-154">requireSSL</span></span>         |                                                                                                                                                                                <span data-ttu-id="25cbb-155">Logická hodnota určující, zda je pro přenos ověřovacího souboru cookie vyžadováno připojení SSL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-155">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="25cbb-156">Výchozí hodnota je False.</span><span class="sxs-lookup"><span data-stu-id="25cbb-156">The default value is false.</span></span>                                                                                                                                                                                |
|     <span data-ttu-id="25cbb-157">Parametr slidingExpiration</span><span class="sxs-lookup"><span data-stu-id="25cbb-157">slidingExpiration</span></span>      |                                                                                                 <span data-ttu-id="25cbb-158">Logická hodnota, která označuje, zda se má resetovat časový limit souboru cookie ověřování pokaždé, když uživatel navštíví web během jedné relace.</span><span class="sxs-lookup"><span data-stu-id="25cbb-158">A Boolean value that indicates whether the authentication cookie's timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="25cbb-159">Výchozí hodnota je true (pravda).</span><span class="sxs-lookup"><span data-stu-id="25cbb-159">The default value is true.</span></span> <span data-ttu-id="25cbb-160">Zásady časového limitu ověřovacího lístku jsou podrobněji popsány v části určení hodnoty časového limitu lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-160">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                 |
|          <span data-ttu-id="25cbb-161">Prodlev</span><span class="sxs-lookup"><span data-stu-id="25cbb-161">timeout</span></span>           |                                                                                                                               <span data-ttu-id="25cbb-162">Určuje dobu v minutách, po jejímž uplynutí vyprší platnost souboru cookie ověřovacího lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-162">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="25cbb-163">Výchozí hodnota je 30.</span><span class="sxs-lookup"><span data-stu-id="25cbb-163">The default value is 30.</span></span> <span data-ttu-id="25cbb-164">Zásady časového limitu ověřovacího lístku jsou podrobněji popsány v části určení hodnoty časového limitu lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-164">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span>                                                                                                                               |

<span data-ttu-id="25cbb-165">**Tabulka 1**: shrnutí atributů &lt;ových formulářů&gt; prvků</span><span class="sxs-lookup"><span data-stu-id="25cbb-165">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="25cbb-166">V ASP.NET 2,0 a novějších jsou výchozí hodnoty ověřování založené na formulářích pevně zakódované ve třídě FormsAuthenticationConfiguration v .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="25cbb-166">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="25cbb-167">V souboru Web. config musí být všechny úpravy aplikovány na jednotlivé aplikace.</span><span class="sxs-lookup"><span data-stu-id="25cbb-167">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="25cbb-168">To se liší od ASP.NET 1. x, kde byly uloženy výchozí hodnoty ověřování pomocí formulářů v souboru Machine. config (a je proto možné je upravit prostřednictvím editace Machine. config).</span><span class="sxs-lookup"><span data-stu-id="25cbb-168">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="25cbb-169">V tématu ASP.NET 1. x je vhodné uvést, že počet nastavení systému ověřování pomocí formulářů má jiné výchozí hodnoty v ASP.NET 2,0 a vyšší než v ASP.NET 1. x.</span><span class="sxs-lookup"><span data-stu-id="25cbb-169">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="25cbb-170">Pokud migrujete aplikaci z prostředí ASP.NET 1. x, je důležité znát tyto rozdíly.</span><span class="sxs-lookup"><span data-stu-id="25cbb-170">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="25cbb-171">Seznam rozdílů najdete [v technické dokumentaci k elementu &lt;forms&gt;](https://msdn.microsoft.com/library/1d3t3c61.aspx) .</span><span class="sxs-lookup"><span data-stu-id="25cbb-171">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-172">Několik nastavení ověřování, jako je například časový limit, doména a cesta, určují podrobnosti pro výsledný soubor cookie lístku ověřování formulářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-172">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="25cbb-173">Pokud chcete získat další informace o souborech cookie, jak fungují a jejich různé vlastnosti, přečtěte si [Tento kurz](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="25cbb-173">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>

### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="25cbb-174">Zadání hodnoty časového limitu lístku</span><span class="sxs-lookup"><span data-stu-id="25cbb-174">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="25cbb-175">Lístek ověřování pomocí formulářů je token, který představuje identitu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-175">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="25cbb-176">U lístků ověřování na základě souborů cookie je tento token uložený ve formě souboru cookie a odeslán na webový server na každém požadavku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-176">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="25cbb-177">Držitel tokenu, v podstatě, deklaruje, jsem *uživatelským jménem*, jsem už přihlášený a používá se k tomu, aby bylo možné pamatovat identitu uživatele v rámci návštěv stránky.</span><span class="sxs-lookup"><span data-stu-id="25cbb-177">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="25cbb-178">Lístek ověřování pomocí formulářů obsahuje jenom identitu uživatele, ale obsahuje taky informace, které vám pomůžou zajistit integritu a zabezpečení tokenu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-178">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="25cbb-179">I když nechcete, aby nekalé uživatel schopný vytvořit padělaný token, nebo nějakým způsobem upravit nevhodný token.</span><span class="sxs-lookup"><span data-stu-id="25cbb-179">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="25cbb-180">Jednou z těchto informací, které jsou součástí lístku, je *vypršení platnosti*, což je datum a čas, kdy lístek již není platný.</span><span class="sxs-lookup"><span data-stu-id="25cbb-180">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="25cbb-181">Pokaždé, když FormsAuthenticationModule zkontroluje ověřovací lístek, zajistí, že platnost lístku ještě neuplynula.</span><span class="sxs-lookup"><span data-stu-id="25cbb-181">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="25cbb-182">Pokud k tomu dojde, ignoruje lístek a identifikuje uživatele jako anonymního.</span><span class="sxs-lookup"><span data-stu-id="25cbb-182">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="25cbb-183">Toto zabezpečení pomáhá chránit před útoky přes opakované přehrání.</span><span class="sxs-lookup"><span data-stu-id="25cbb-183">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="25cbb-184">Bez vypršení platnosti, pokud se hacker mohl dostat do platného ověřovacího lístku uživatele, třeba získáním fyzického přístupu ke svému počítači a jeho kořenem prostřednictvím svých souborů cookie – může poslat požadavek na server pomocí tohoto autentizačního lístku pro ověření a získat položku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-184">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="25cbb-185">I když vypršení platnosti nebrání tomuto scénáři, omezí okno, během kterého může být takový útok úspěšný.</span><span class="sxs-lookup"><span data-stu-id="25cbb-185">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-186">Krok 3 podrobně popisuje další techniky používané systémem pro ověřování pomocí formulářů k ochraně ověřovacího lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-186">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>

<span data-ttu-id="25cbb-187">Když vytváříte ověřovací lístek, systém ověřování pomocí formulářů po konzultaci s nastavením časového limitu určí jeho platnost.</span><span class="sxs-lookup"><span data-stu-id="25cbb-187">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="25cbb-188">Jak je uvedeno v tabulce 1, nastavení časového limitu je standardně nastavené na 30 minut, což znamená, že když se vytvoří lístek pro ověřování pomocí formulářů, nastaví se datum a čas 30 minut v budoucnosti.</span><span class="sxs-lookup"><span data-stu-id="25cbb-188">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="25cbb-189">Vypršení platnosti definuje absolutní čas v budoucnosti, kdy vyprší platnost lístku pro ověřování na formuláři.</span><span class="sxs-lookup"><span data-stu-id="25cbb-189">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="25cbb-190">Vývojáři ale obvykle chtějí implementovat klouzavé vypršení platnosti, což se resetuje pokaždé, když uživatel přenavštíví Web.</span><span class="sxs-lookup"><span data-stu-id="25cbb-190">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="25cbb-191">Toto chování je určeno nastavením parametr slidingExpiration.</span><span class="sxs-lookup"><span data-stu-id="25cbb-191">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="25cbb-192">Pokud je nastavená hodnota true (výchozí), pokaždé, když FormsAuthenticationModule ověřuje uživatele, aktualizuje vypršení platnosti lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-192">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="25cbb-193">Pokud je hodnota nastavena na false, platnost konce platnosti nebude u každého požadavku aktualizována, což způsobí, že lístku vyprší přesně časový limit v minutách po prvním vytvoření lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-193">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-194">Vypršení platnosti uložené v ověřovacím lístku je absolutní hodnota data a času, například 2. srpna 2008 11:34 AM.</span><span class="sxs-lookup"><span data-stu-id="25cbb-194">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="25cbb-195">Datum a čas jsou navíc relativní vzhledem k místnímu času webového serveru.</span><span class="sxs-lookup"><span data-stu-id="25cbb-195">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="25cbb-196">Toto rozhodnutí o návrhu může mít zajímavé vedlejší účinky v oblasti letního času (DST), což znamená, že se hodiny v USA přesunuly před jednu hodinu (za předpokladu, že je webový server hostovaný v národním prostředí, kde se pozoruje letní čas).</span><span class="sxs-lookup"><span data-stu-id="25cbb-196">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="25cbb-197">Zvažte, co se stane pro web ASP.NET s vypršenou platností 30 minut v době, kdy začíná letní čas (což je 2:00 dop.).</span><span class="sxs-lookup"><span data-stu-id="25cbb-197">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="25cbb-198">Představte si, že se návštěvník přihlásí k webu dne 11. března 2008 v 1:55.</span><span class="sxs-lookup"><span data-stu-id="25cbb-198">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="25cbb-199">Tím se vygeneruje lístek ověřování pomocí formulářů, jehož platnost vyprší 11. března 2008 v 2:25 (30 minut v budoucnosti).</span><span class="sxs-lookup"><span data-stu-id="25cbb-199">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="25cbb-200">Po 2:00 se však hodiny přeskočí na 3:00 z důvodu letního času.</span><span class="sxs-lookup"><span data-stu-id="25cbb-200">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="25cbb-201">Když uživatel načte novou stránku šest minut po přihlášení (v 3:01.), FormsAuthenticationModule Poznámkový odkaz, že lístek vypršel, a přesměruje uživatele na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-201">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="25cbb-202">Podrobnější diskuzi o tomto a jiném časovém limitu ověřovacího lístku oddities, jakož i alternativním řešením, najdete v části řešení Stefan Schackow *Professional ASP.NET 2,0 zabezpečení, členství a správy rolí* (ISBN: 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="25cbb-202">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>

<span data-ttu-id="25cbb-203">Obrázek 1 znázorňuje pracovní postup, pokud je parametr slidingExpiration nastaven na hodnotu false a časový limit je nastavený na 30.</span><span class="sxs-lookup"><span data-stu-id="25cbb-203">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="25cbb-204">Všimněte si, že ověřovací lístek generovaný při přihlášení obsahuje datum vypršení platnosti a tato hodnota není aktualizována při dalších požadavcích.</span><span class="sxs-lookup"><span data-stu-id="25cbb-204">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="25cbb-205">Pokud FormsAuthenticationModule zjistí, že platnost lístku vypršela, zahodí ho a považuje požadavek za anonymní.</span><span class="sxs-lookup"><span data-stu-id="25cbb-205">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>

<span data-ttu-id="25cbb-206">[![grafické znázornění vypršení platnosti lístku pro ověřování pomocí formulářů, pokud je parametr slidingExpiration false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-206">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span></span>

<span data-ttu-id="25cbb-207">**Obrázek 01**: grafická reprezentace lístku ověřování pomocí formulářů, pokud je parametr slidingExpiration false ([kliknutím zobrazíte obrázek v plné velikosti](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png)).</span><span class="sxs-lookup"><span data-stu-id="25cbb-207">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span></span>

<span data-ttu-id="25cbb-208">Obrázek 2 ukazuje pracovní postup, pokud je parametr slidingExpiration nastaven na hodnotu true a časový limit je nastavený na 30.</span><span class="sxs-lookup"><span data-stu-id="25cbb-208">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="25cbb-209">Po přijetí ověřené žádosti (s lístkem bez vypršení platnosti) se její vypršení platnosti aktualizuje na časový limit v řádu minut v budoucnosti.</span><span class="sxs-lookup"><span data-stu-id="25cbb-209">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>

<span data-ttu-id="25cbb-210">[![grafické znázornění lístku pro ověřování pomocí formulářů, pokud je hodnota parametr slidingExpiration pravdivá.](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-210">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span></span>

<span data-ttu-id="25cbb-211">**Obrázek 02**: grafická reprezentace lístku pro ověřování pomocí formulářů, když má parametr slidingExpiration hodnotu true ([kliknutím zobrazíte obrázek v plné velikosti](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png)).</span><span class="sxs-lookup"><span data-stu-id="25cbb-211">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true  ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span></span>

<span data-ttu-id="25cbb-212">Když použijete lístky ověřování na základě souborů cookie (výchozí nastavení), bude tato diskuze trochu větší, protože soubory cookie můžou mít také zadané své vlastní vypršení platnosti.</span><span class="sxs-lookup"><span data-stu-id="25cbb-212">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="25cbb-213">Vypršení platnosti souboru cookie (nebo jeho nedostatku) instruuje prohlížeč, kdy by měl být soubor cookie zničen.</span><span class="sxs-lookup"><span data-stu-id="25cbb-213">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="25cbb-214">Pokud soubor cookie nemá vypršení platnosti, je zničen při vypnutí prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="25cbb-214">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="25cbb-215">Pokud dojde k vypršení platnosti, soubor cookie zůstane uložený v počítači uživatele až do doby, kdy uplyne datum a čas zadaný v vypršení platnosti.</span><span class="sxs-lookup"><span data-stu-id="25cbb-215">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="25cbb-216">Když prohlížeč zničí soubor cookie, už se neposílá webovému serveru.</span><span class="sxs-lookup"><span data-stu-id="25cbb-216">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="25cbb-217">Proto je zničení souboru cookie obdobně přihlášeno uživateli z lokality.</span><span class="sxs-lookup"><span data-stu-id="25cbb-217">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-218">Uživatel samozřejmě může proaktivně odebrat všechny soubory cookie uložené v jejich počítači.</span><span class="sxs-lookup"><span data-stu-id="25cbb-218">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="25cbb-219">V aplikaci Internet Explorer 7 přejděte na nástroje, možnosti a klikněte na tlačítko Odstranit v části Historie procházení.</span><span class="sxs-lookup"><span data-stu-id="25cbb-219">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="25cbb-220">Odtud klikněte na tlačítko Odstranit soubory cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-220">From there, click the Delete cookies button.</span></span>

<span data-ttu-id="25cbb-221">Systém ověřování pomocí formulářů vytvoří soubory cookie založené na relacích nebo vypršení platnosti v závislosti na hodnotě předané do parametru *persistCookie* .</span><span class="sxs-lookup"><span data-stu-id="25cbb-221">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="25cbb-222">Odvolat, že metody GetAuthCookie, SetAuthCookie a RedirectFromLoginPage třídy FormsAuthentication přebírají dva vstupní parametry: *username* a *persistCookie*.</span><span class="sxs-lookup"><span data-stu-id="25cbb-222">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="25cbb-223">Přihlašovací stránka, kterou jsme vytvořili v předchozím kurzu, obsahuje zaškrtávací políčko pro zapamatování, které určuje, jestli se vytvořil trvalý soubor cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-223">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="25cbb-224">Trvalé soubory cookie jsou založeny na vypršení platnosti; soubory cookie, které nejsou trvalé, jsou založené na relacích.</span><span class="sxs-lookup"><span data-stu-id="25cbb-224">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="25cbb-225">Koncepty s časovým limitem a parametr slidingExpiration jsou již popsány u souborů cookie relace i vypršení platnosti.</span><span class="sxs-lookup"><span data-stu-id="25cbb-225">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="25cbb-226">Ve vykonání je pouze jeden malý rozdíl: při použití souborů cookie založených na vypršení platnosti s slidingTimeout nastavenou na hodnotu true je platnost souboru cookie aktualizována pouze v případě, že uplynula více než polovina zadaného času.</span><span class="sxs-lookup"><span data-stu-id="25cbb-226">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="25cbb-227">Pojďme aktualizovat zásady časového limitu ověřovacích lístků pro náš web tak, aby lístky s časovým limitem po jedné hodině (60 minut) používaly klouzavé vypršení.</span><span class="sxs-lookup"><span data-stu-id="25cbb-227">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="25cbb-228">Chcete-li tuto změnu změnit, aktualizujte soubor Web. config a přidejte &lt;Forms&gt; elementu do &lt;ověřování&gt; elementu pomocí následujícího kódu:</span><span class="sxs-lookup"><span data-stu-id="25cbb-228">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="25cbb-229">Použití jiné adresy URL přihlašovací stránky než Login. aspx</span><span class="sxs-lookup"><span data-stu-id="25cbb-229">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="25cbb-230">Vzhledem k tomu, že FormsAuthenticationModule automaticky přesměruje neautorizované uživatele na přihlašovací stránku, musí znát adresu URL přihlašovací stránky.</span><span class="sxs-lookup"><span data-stu-id="25cbb-230">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="25cbb-231">Tato adresa URL je určena atributem loginUrl ve&gt; elementu &lt;Forms a má výchozí hodnotu Login. aspx.</span><span class="sxs-lookup"><span data-stu-id="25cbb-231">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="25cbb-232">Pokud předáváte přes existující web, možná už máte přihlašovací stránku s jinou adresou URL, která už je záložkou a indexována vyhledávacími moduly.</span><span class="sxs-lookup"><span data-stu-id="25cbb-232">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="25cbb-233">Místo přejmenování stávající přihlašovací stránky na přihlašovací. aspx a průlomové odkazy a záložky uživatelů můžete místo toho upravit atribut loginUrl tak, aby odkazoval na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-233">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="25cbb-234">Například pokud se vaše přihlašovací stránka jmenovala Login. aspx a byla umístěna v adresáři uživatelé, můžete nastavení konfigurace loginUrl nasměrovat na ~/Users/SignIn.aspx, například:</span><span class="sxs-lookup"><span data-stu-id="25cbb-234">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample3.xml)]

<span data-ttu-id="25cbb-235">Vzhledem k tomu, že naše aktuální aplikace již má přihlašovací stránku s názvem Login. aspx, není nutné zadávat vlastní hodnotu v prvku &lt;Forms&gt; elementu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-235">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="25cbb-236">Krok 2: použití lístků pro ověřování pomocí formulářů bez souborů cookie</span><span class="sxs-lookup"><span data-stu-id="25cbb-236">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="25cbb-237">Ve výchozím nastavení systém ověřování pomocí formulářů určuje, zda se mají ukládat ověřovací lístky do kolekce souborů cookie, nebo je vložit do adresy URL na základě uživatelského agenta, který navštívil web.</span><span class="sxs-lookup"><span data-stu-id="25cbb-237">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="25cbb-238">Všechny běžné desktopové prohlížeče, jako jsou Internet Explorer, Firefox, Opera a Safari, podporují soubory cookie, ale ne všechna mobilní zařízení.</span><span class="sxs-lookup"><span data-stu-id="25cbb-238">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="25cbb-239">Zásady souborů cookie používané systémem pro ověřování pomocí formulářů závisí na nastavení souborů cookie v&gt; elementu &lt;Forms, ke kterému se dá přiřadit jedna ze čtyř hodnot:</span><span class="sxs-lookup"><span data-stu-id="25cbb-239">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="25cbb-240">UseCookies – určuje, zda budou vždy použity ověřovací lístky založené na souborech cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-240">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="25cbb-241">UseUri – označuje, že se nikdy nepoužijí ověřovací lístky založené na souborech cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-241">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="25cbb-242">Automaticky rozpoznat – Pokud profil zařízení nepodporuje soubory cookie, nepoužijí se ověřovací lístky založené na souborech cookie. Pokud profil zařízení podporuje soubory cookie, používá se k určení, jestli jsou soubory cookie povolené, mechanizmus zjišťování.</span><span class="sxs-lookup"><span data-stu-id="25cbb-242">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="25cbb-243">UseDeviceProfile – výchozí; používá lístky ověřování založené na souborech cookie pouze v případě, že profil zařízení podporuje soubory cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-243">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="25cbb-244">Nepoužívá se žádný mechanismus zjišťování.</span><span class="sxs-lookup"><span data-stu-id="25cbb-244">No probing mechanism is used.</span></span>

<span data-ttu-id="25cbb-245">Nastavení automatického rozpoznávání a UseDeviceProfile se spoléhá na *profil zařízení* při zjištění, jestli se má použít ověřovací lístky založené na souborech cookie nebo bez souborů cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-245">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="25cbb-246">ASP.NET udržuje databázi různých zařízení a jejich schopností, jako je třeba to, jestli podporují soubory cookie, jakou verzi JavaScriptu podporují a tak dále.</span><span class="sxs-lookup"><span data-stu-id="25cbb-246">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="25cbb-247">Pokaždé, když zařízení požádá o webovou stránku z webového serveru, pošle se spolu s hlavičkou http *uživatelského agenta* , které identifikuje typ zařízení.</span><span class="sxs-lookup"><span data-stu-id="25cbb-247">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="25cbb-248">ASP.NET automaticky odpovídá zadanému řetězci User-Agent s odpovídajícím profilem zadaným ve své databázi.</span><span class="sxs-lookup"><span data-stu-id="25cbb-248">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-249">Tato databáze možností zařízení je uložena v řadě souborů XML, které vyhovují [schématu definičního souboru prohlížeče](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="25cbb-249">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="25cbb-250">Výchozí soubory profilu zařízení se nacházejí v%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="25cbb-250">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="25cbb-251">Do složky aplikace\_prohlížeče aplikace můžete také přidat vlastní soubory.</span><span class="sxs-lookup"><span data-stu-id="25cbb-251">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="25cbb-252">Další informace naleznete v tématu [How to: Detekce typů prohlížeče na webových stránkách ASP.NET](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="25cbb-252">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>

<span data-ttu-id="25cbb-253">Vzhledem k tomu, že výchozí nastavení je UseDeviceProfile, použijí se lístky pro ověřování pomocí formulářů bez souborů cookie, když se web navštíví zařízením, u kterého profil hlásí, že nepodporuje soubory cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-253">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="25cbb-254">Kódování ověřovacího lístku v adrese URL</span><span class="sxs-lookup"><span data-stu-id="25cbb-254">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="25cbb-255">Soubory cookie jsou přirozené médium pro zahrnutí informací z prohlížeče do jednotlivých požadavků na konkrétní web, což má za následek to, proč výchozí nastavení ověřování pomocí formulářů používá soubory cookie, pokud je hostující zařízení podporuje.</span><span class="sxs-lookup"><span data-stu-id="25cbb-255">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="25cbb-256">Pokud se soubory cookie nepodporují, musí se použít alternativní způsob předání ověřovacího lístku z klienta na server.</span><span class="sxs-lookup"><span data-stu-id="25cbb-256">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="25cbb-257">Běžným řešením použitým v prostředí bez souborů cookie je zakódovat data souborů cookie v adrese URL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-257">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="25cbb-258">Nejlepším způsobem, jak zjistit, jak můžou být tyto informace vložené v rámci adresy URL, je vynutit, aby lokalita používala ověřovací lístky bez souborů cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-258">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="25cbb-259">To je možné dosáhnout nastavením konfigurace nastavení souborů cookie na UseUri:</span><span class="sxs-lookup"><span data-stu-id="25cbb-259">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample4.xml)]

<span data-ttu-id="25cbb-260">Až tuto změnu provedete, navštivte web prostřednictvím prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="25cbb-260">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="25cbb-261">Při návštěvě anonymního uživatele budou adresy URL vypadat stejně jako dříve.</span><span class="sxs-lookup"><span data-stu-id="25cbb-261">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="25cbb-262">Když například navštívíte stránku Default. aspx, na panelu Adresa v prohlížeči se zobrazí následující adresa URL:</span><span class="sxs-lookup"><span data-stu-id="25cbb-262">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="25cbb-263">Po přihlášení se ale ověřovací lístek formulářů vloží do adresy URL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-263">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="25cbb-264">Když například navštívíte přihlašovací stránku a přihlásíte se jako Sam, vrátí se na stránku Default. aspx, ale adresa URL tohoto času:</span><span class="sxs-lookup"><span data-stu-id="25cbb-264">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="25cbb-265">Lístek ověřování formulářů byl vložen v rámci adresy URL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-265">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="25cbb-266">Řetězec (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) představuje informace ověřovacího lístku s šestnáctkovým zakódovaným řetězcem, který je obvykle uložen v souboru cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-266">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="25cbb-267">Aby lístky pro ověřování bez souborů cookie fungovaly, musí systém zakódovat všechny adresy URL na stránce, aby zahrnovali data ověřovacího lístku. v opačném případě se ověřovací lístek ztratí, když uživatel klikne na odkaz.</span><span class="sxs-lookup"><span data-stu-id="25cbb-267">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="25cbb-268">Naštěstí, tato logika vkládání se provádí automaticky.</span><span class="sxs-lookup"><span data-stu-id="25cbb-268">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="25cbb-269">Chcete-li tuto funkci předvést, otevřete stránku Default. aspx a přidejte ovládací prvek hypertextový odkaz, nastavte jeho text a vlastnosti NavigateUrl na test Link a SomePage. aspx v uvedeném pořadí.</span><span class="sxs-lookup"><span data-stu-id="25cbb-269">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="25cbb-270">Nezáleží na tom, že v našem projektu není stránka s názvem SomePage. aspx.</span><span class="sxs-lookup"><span data-stu-id="25cbb-270">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="25cbb-271">Uložte změny do souboru Default. aspx a pak na něj přejděte v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="25cbb-271">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="25cbb-272">Přihlaste se k webu, aby byl lístek ověřování formulářů vložen do adresy URL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-272">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="25cbb-273">Pak z default. aspx klikněte na odkaz test odkazu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-273">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="25cbb-274">Co se stalo?</span><span class="sxs-lookup"><span data-stu-id="25cbb-274">What happened?</span></span> <span data-ttu-id="25cbb-275">Pokud žádná stránka s názvem SomePage. aspx neexistuje, došlo k chybě 404, ale to není důležité.</span><span class="sxs-lookup"><span data-stu-id="25cbb-275">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="25cbb-276">Místo toho se zaměřte na adresní řádek v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="25cbb-276">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="25cbb-277">Všimněte si, že obsahuje lístek ověřování formulářů v adrese URL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-277">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="25cbb-278">Adresa URL SomePage. aspx v odkazu se automaticky převedla na adresu URL, která obsahuje ověřovací lístek – nemuseli jsme psát Lick kódu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-278">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="25cbb-279">Ověřovací lístek formuláře bude automaticky vložen do adresy URL pro všechny hypertextové odkazy, které nezačínají na `http://` ani `/`.</span><span class="sxs-lookup"><span data-stu-id="25cbb-279">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with `http://` or `/`.</span></span> <span data-ttu-id="25cbb-280">Nezáleží na tom, zda se hypertextový odkaz zobrazí ve volání metody Response. Redirect, v ovládacím prvku hypertextový odkaz nebo v ukotveném prvku HTML (tj. `<a href="...">...</a>`).</span><span class="sxs-lookup"><span data-stu-id="25cbb-280">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., `<a href="...">...</a>`).</span></span> <span data-ttu-id="25cbb-281">Dokud se adresa URL nelíbí `http://www.someserver.com/SomePage.aspx` nebo `/SomePage.aspx`, bude pro nás vložen lístek ověřování na formuláři.</span><span class="sxs-lookup"><span data-stu-id="25cbb-281">As long as the URL isn't something like `http://www.someserver.com/SomePage.aspx` or `/SomePage.aspx`, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-282">Lístky ověřování pomocí formulářů bez souborů cookie dodržují stejné zásady časového limitu jako lístky ověřování založené na souborech cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-282">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="25cbb-283">Ověřovací lístky bez souborů cookie jsou ale náchylnější k útokům, protože ověřovací lístek je vložený přímo v adrese URL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-283">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="25cbb-284">Představte si uživatele, který navštíví web, přihlásí se a pak vloží adresu URL do e-mailu kolegovi.</span><span class="sxs-lookup"><span data-stu-id="25cbb-284">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="25cbb-285">Pokud kolega na tento odkaz klikne ještě před dosažením vypršení platnosti, přihlásí se jako uživatel, který e-mail odeslal.</span><span class="sxs-lookup"><span data-stu-id="25cbb-285">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>

## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="25cbb-286">Krok 3: zabezpečení ověřovacího lístku</span><span class="sxs-lookup"><span data-stu-id="25cbb-286">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="25cbb-287">Lístek ověřování pomocí formulářů se přenáší prostřednictvím kabelu buď v souboru cookie, nebo přímo vložený v rámci adresy URL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-287">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="25cbb-288">Kromě informací o identitě může lístek ověřování také zahrnovat uživatelská data (jak uvidíme v kroku 4).</span><span class="sxs-lookup"><span data-stu-id="25cbb-288">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="25cbb-289">V důsledku toho je důležité, aby data lístku byla šifrována z Prying oči a (ještě důležitější), aby systém ověřování pomocí formulářů mohl zaručit, že lístek nebyl zfalšován.</span><span class="sxs-lookup"><span data-stu-id="25cbb-289">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="25cbb-290">Aby bylo zajištěno soukromí dat lístku, může systém ověřování formulářů šifrovat data lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-290">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="25cbb-291">Nepodaří-li se zašifrovat data lístků, odesílají potenciálně citlivé informace prostřednictvím tohoto drátu v prostém textu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-291">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="25cbb-292">Aby bylo zaručeno pravost lístku, systém ověřování pomocí formulářů musí lístek *ověřit* .</span><span class="sxs-lookup"><span data-stu-id="25cbb-292">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="25cbb-293">Ověření je zákonem, který zajišťuje, že konkrétní část dat nebyla upravena a že je zajištěna prostřednictvím *[ověřovacího kódu zprávy (Mac)](http://en.wikipedia.org/wiki/Message_authentication_code)* .</span><span class="sxs-lookup"><span data-stu-id="25cbb-293">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="25cbb-294">V kostce je počítač MAC malými informacemi, které určují data, která je třeba ověřit (v tomto případě lístku).</span><span class="sxs-lookup"><span data-stu-id="25cbb-294">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="25cbb-295">Pokud jsou data reprezentovaná počítačem MAC upravená, pak MAC a data se neshodují.</span><span class="sxs-lookup"><span data-stu-id="25cbb-295">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="25cbb-296">Kromě toho je výpočetní výkon pro hackery vyměněn jak k úpravě dat, tak k vytvoření vlastního počítače MAC, aby odpovídal změněným datům.</span><span class="sxs-lookup"><span data-stu-id="25cbb-296">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="25cbb-297">Při vytváření (nebo úpravách) lístku vytvoří systém ověřování pomocí formulářů počítač MAC a připojí ho k datům lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-297">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="25cbb-298">Po doručení následné žádosti systém ověřováním formulářů porovná údaje v počítačích MAC a lístků a ověří pravost dat lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-298">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="25cbb-299">Obrázek 3 znázorňuje tento pracovní postup graficky.</span><span class="sxs-lookup"><span data-stu-id="25cbb-299">Figure 3 illustrates this workflow graphically.</span></span>

<span data-ttu-id="25cbb-300">[![se pravost lístku zajišťuje prostřednictvím MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-300">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span></span>

<span data-ttu-id="25cbb-301">**Obrázek 03**: pravost lístku se zajišťuje prostřednictvím Mac ([kliknutím zobrazíte obrázek v plné velikosti).](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-301">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span></span>

<span data-ttu-id="25cbb-302">Jaké míry zabezpečení jsou aplikovány na ověřovací lístek, závisí na nastavení ochrany v prvku &lt;Forms&gt; elementu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-302">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="25cbb-303">Nastavení ochrany může být přiřazeno jedné z následujících tří hodnot:</span><span class="sxs-lookup"><span data-stu-id="25cbb-303">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="25cbb-304">Vše – lístek je šifrovaný i digitálně podepsaný (výchozí).</span><span class="sxs-lookup"><span data-stu-id="25cbb-304">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="25cbb-305">Používá se šifrování jen pro šifrování – negeneruje se žádná adresa MAC.</span><span class="sxs-lookup"><span data-stu-id="25cbb-305">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="25cbb-306">Žádné – lístek není šifrovaný ani digitálně podepsaný.</span><span class="sxs-lookup"><span data-stu-id="25cbb-306">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="25cbb-307">Ověření – je vygenerována adresa MAC, ale data lístku jsou odesílána přes drát v prostém textu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-307">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="25cbb-308">Microsoft důrazně doporučuje použít nastavení vše.</span><span class="sxs-lookup"><span data-stu-id="25cbb-308">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="25cbb-309">Nastavení ověřovacích a dešifrovacích klíčů</span><span class="sxs-lookup"><span data-stu-id="25cbb-309">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="25cbb-310">Algoritmy šifrování a hash používané systémem pro ověřování pomocí formulářů k šifrování a ověření ověřovacího lístku jsou přizpůsobitelné pomocí [elementu&lt;machineKey&gt;](https://msdn.microsoft.com/library/w8h3skw9.aspx) v souboru Web. config. Tabulka 2 obsahuje popis atributů prvku &lt;machineKey&gt; a jejich možné hodnoty.</span><span class="sxs-lookup"><span data-stu-id="25cbb-310">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="25cbb-311">**Atribut**</span><span class="sxs-lookup"><span data-stu-id="25cbb-311">**Attribute**</span></span> | <span data-ttu-id="25cbb-312">**Popis**</span><span class="sxs-lookup"><span data-stu-id="25cbb-312">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="25cbb-313">dešifrování</span><span class="sxs-lookup"><span data-stu-id="25cbb-313">decryption</span></span> | <span data-ttu-id="25cbb-314">Určuje algoritmus používaný k šifrování.</span><span class="sxs-lookup"><span data-stu-id="25cbb-314">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="25cbb-315">Tento atribut může mít jednu z následujících čtyř hodnot:-auto-výchozí; Určuje algoritmus na základě délky atributu decryptionKey.</span><span class="sxs-lookup"><span data-stu-id="25cbb-315">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="25cbb-316">-AES – používá algoritmus [Standard AES (Advanced Encryption Standard) (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) .</span><span class="sxs-lookup"><span data-stu-id="25cbb-316">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="25cbb-317">-DES – používá algoritmus [des (Data Encryption Standard)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) , je tento algoritmus považován za výpočetně slabý a neměl by se používat.</span><span class="sxs-lookup"><span data-stu-id="25cbb-317">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="25cbb-318">-3DES – používá algoritmus [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) , který pracuje třikrát po trojnásobné použití algoritmu DES.</span><span class="sxs-lookup"><span data-stu-id="25cbb-318">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="25cbb-319">decryptionKey</span><span class="sxs-lookup"><span data-stu-id="25cbb-319">decryptionKey</span></span> | <span data-ttu-id="25cbb-320">Tajný klíč používaný šifrovacím algoritmem</span><span class="sxs-lookup"><span data-stu-id="25cbb-320">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="25cbb-321">Tato hodnota musí být šestnáctkovým řetězcem příslušné délky (na základě hodnoty v dešifrování), vygenerovat nebo buď pomocí hodnoty připojené k, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="25cbb-321">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="25cbb-322">Přidáním IsolateApps dáte pokyn ASP.NET k použití jedinečné hodnoty pro každou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="25cbb-322">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="25cbb-323">Výchozí hodnota je AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="25cbb-323">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="25cbb-324">ověření</span><span class="sxs-lookup"><span data-stu-id="25cbb-324">validation</span></span> | <span data-ttu-id="25cbb-325">Označuje algoritmus použitý k ověření.</span><span class="sxs-lookup"><span data-stu-id="25cbb-325">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="25cbb-326">Tento atribut může mít jednu z následujících čtyř hodnot:-AES-používá algoritmus standard AES (Advanced Encryption Standard) (AES).</span><span class="sxs-lookup"><span data-stu-id="25cbb-326">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="25cbb-327">-MD5 – používá algoritmus [MD5 (Message-Digest 5)](http://en.wikipedia.org/wiki/MD5) .</span><span class="sxs-lookup"><span data-stu-id="25cbb-327">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="25cbb-328">-SHA1 – používá algoritmus [SHA1](http://en.wikipedia.org/wiki/Sha1) (výchozí).</span><span class="sxs-lookup"><span data-stu-id="25cbb-328">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="25cbb-329">-3DES-používá algoritmus Triple DES.</span><span class="sxs-lookup"><span data-stu-id="25cbb-329">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="25cbb-330">validationKey</span><span class="sxs-lookup"><span data-stu-id="25cbb-330">validationKey</span></span> | <span data-ttu-id="25cbb-331">Tajný klíč používaný algoritmem ověřování.</span><span class="sxs-lookup"><span data-stu-id="25cbb-331">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="25cbb-332">Tato hodnota musí být šestnáctkový řetězec odpovídající délky (na základě hodnoty v ověřování), vygenerovat nebo buď pomocí hodnoty připojené k, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="25cbb-332">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="25cbb-333">Přidáním IsolateApps dáte pokyn ASP.NET k použití jedinečné hodnoty pro každou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="25cbb-333">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="25cbb-334">Výchozí hodnota je AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="25cbb-334">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="25cbb-335">**Tabulka 2**: atributy elementu &lt;machineKey&gt;</span><span class="sxs-lookup"><span data-stu-id="25cbb-335">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="25cbb-336">Důkladná diskuze o těchto možnostech šifrování a ověřování a o specialistech a nevýhody různých algoritmů jsou nad rámec tohoto kurzu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-336">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="25cbb-337">Podrobný pohled na tyto problémy, včetně pokynů k používání šifrovacích a ověřovacích algoritmů, jaké délky klíčů použít a jakým způsobem nejlépe vygenerujete tyto klíče, najdete v článku *profesionální ASP.NET 2,0 zabezpečení, členství a Správa rolí*.</span><span class="sxs-lookup"><span data-stu-id="25cbb-337">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="25cbb-338">Ve výchozím nastavení se klíče používané pro šifrování a ověřování generují automaticky pro každou aplikaci a tyto klíče se ukládají v rámci místního úřadu zabezpečení (LSA).</span><span class="sxs-lookup"><span data-stu-id="25cbb-338">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="25cbb-339">V krátkém případě je ve výchozím nastavení zaručeno použití jedinečných klíčů na webovém serveru a na jednotlivých webových serverech.</span><span class="sxs-lookup"><span data-stu-id="25cbb-339">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="25cbb-340">V důsledku toho toto výchozí chování nebude fungovat v následujících dvou scénářích:</span><span class="sxs-lookup"><span data-stu-id="25cbb-340">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="25cbb-341">**Webové farmy** – ve scénáři [webové farmy](http://en.wikipedia.org/wiki/Web_farm) je jediná webová aplikace hostovaná na více webových serverech pro účely škálovatelnosti a redundance.</span><span class="sxs-lookup"><span data-stu-id="25cbb-341">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="25cbb-342">Všechny příchozí požadavky jsou odesílány na server ve farmě, což znamená, že po celou dobu životnosti uživatelské relace se mohou pro zpracování svých různých požadavků použít různé servery.</span><span class="sxs-lookup"><span data-stu-id="25cbb-342">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="25cbb-343">V důsledku toho musí každý server používat stejné šifrovací a ověřovací klíče, aby byl lístek ověřování pomocí formulářů vytvořený, zašifrovaný a ověřený na jednom serveru možné dešifrovat a ověřit na jiném serveru ve farmě.</span><span class="sxs-lookup"><span data-stu-id="25cbb-343">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="25cbb-344">**Sdílení lístků mezi aplikacemi** – jeden webový server může hostovat několik aplikací ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="25cbb-344">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="25cbb-345">Pokud potřebujete, aby tyto různé aplikace sdílely jeden lístek ověřování pomocí formulářů, je nezbytné, aby se jejich šifrovací a ověřovací klíče shodovaly.</span><span class="sxs-lookup"><span data-stu-id="25cbb-345">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="25cbb-346">Když pracujete v nastavení webové farmy nebo sdílíte ověřovací lístky napříč aplikacemi na stejném serveru, budete muset v ovlivněných aplikacích nakonfigurovat prvek &lt;machineKey&gt;, aby se hodnoty decryptionKey a validationKey shodovaly.</span><span class="sxs-lookup"><span data-stu-id="25cbb-346">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="25cbb-347">I když žádné z výše uvedených scénářů neplatí pro naši ukázkovou aplikaci, můžeme pořád zadat explicitní hodnoty decryptionKey a validationKey a definovat algoritmy, které se mají použít.</span><span class="sxs-lookup"><span data-stu-id="25cbb-347">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="25cbb-348">Přidejte do souboru Web. config nastavení &lt;machineKey&gt;:</span><span class="sxs-lookup"><span data-stu-id="25cbb-348">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample5.xml)]

<span data-ttu-id="25cbb-349">Další informace najdete v tématu [Postup: Konfigurace MachineKey v ASP.NET 2,0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="25cbb-349">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-350">Hodnoty decryptionKey a validationKey byly získány z webové stránky [Steve Gibsons](http://www.grc.com/stevegibson.htm) [Perfect hesly](https://www.grc.com/passwords.htm), která generuje 64 náhodné hexadecimální znaky na každé návštěvě stránky.</span><span class="sxs-lookup"><span data-stu-id="25cbb-350">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="25cbb-351">Chcete-li snížit pravděpodobnost, že tyto klíče přizpůsobují své možnosti v produkčních aplikacích, doporučujeme nahradit výše uvedené klíče náhodným generováním na stránce dokonalých hesel.</span><span class="sxs-lookup"><span data-stu-id="25cbb-351">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>

## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="25cbb-352">Krok 4: uložení dalších uživatelských dat do lístku</span><span class="sxs-lookup"><span data-stu-id="25cbb-352">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="25cbb-353">Mnoho webových aplikací zobrazuje informace o zobrazení stránky v aktuálně přihlášeném uživateli nebo jejich základu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-353">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="25cbb-354">Například webová stránka může zobrazit jméno uživatele a datum posledního přihlášení v horním rohu každé stránky.</span><span class="sxs-lookup"><span data-stu-id="25cbb-354">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="25cbb-355">Lístek ověřování pomocí formulářů uchovává uživatelské jméno aktuálně přihlášeného uživatele, ale pokud potřebujete nějaké další informace, musí stránka přejít do úložiště uživatele – obvykle databáze – pro vyhledávání informací, které nejsou uložené v ověřovacím lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-355">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="25cbb-356">S malým počtem kódů můžeme do lístku pro ověřování pomocí formulářů ukládat Další informace o uživateli.</span><span class="sxs-lookup"><span data-stu-id="25cbb-356">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="25cbb-357">Taková data lze vyjádřit prostřednictvím [vlastnosti UserData](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx)v rámci [třídy FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx).</span><span class="sxs-lookup"><span data-stu-id="25cbb-357">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="25cbb-358">Toto je užitečné místo pro vložení malého množství informací o uživateli, který je často potřeba.</span><span class="sxs-lookup"><span data-stu-id="25cbb-358">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="25cbb-359">Hodnota zadaná ve vlastnosti UserData je obsažena v rámci souboru cookie ověřovacího lístku a, podobně jako ostatní pole lístků, je zašifrováno a ověřeno na základě konfigurace systému ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-359">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="25cbb-360">Ve výchozím nastavení je pro UserData prázdný řetězec.</span><span class="sxs-lookup"><span data-stu-id="25cbb-360">By default, UserData is an empty string.</span></span>

<span data-ttu-id="25cbb-361">Aby bylo možné ukládat data uživatelů do ověřovacího lístku, musíme na přihlašovací stránce napsat část kódu, která bude připravovat informace specifické pro uživatele a uložit je do lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-361">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="25cbb-362">Vzhledem k tomu, že UserData je vlastnost typu řetězec, data, která jsou v něm uložena, musí být správně serializována jako řetězec.</span><span class="sxs-lookup"><span data-stu-id="25cbb-362">Since UserData is a property of type string, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="25cbb-363">Představte si například, že naše úložiště uživatelů zahrnovalo datum narození a jméno svého zaměstnavatele a že jsme chtěli tyto dvě hodnoty vlastností Uložit do ověřovacího lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-363">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="25cbb-364">Tyto hodnoty jsme mohli serializovat na řetězec zřetězením data uživatele o narození řetězce s svislým kanálem (|) následovaným názvem zaměstnavatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-364">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="25cbb-365">Pro uživatele narozené 15. srpna 1974, který spolupracuje s Northwind Traders, přiřadíme tuto vlastnost UserData jako řetězec: 1974-08-15 | Northwind Traders.</span><span class="sxs-lookup"><span data-stu-id="25cbb-365">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="25cbb-366">Kdykoliv potřebujeme přístup k datům uloženým v lístku, můžeme to udělat tak, že převedeme FormsAuthenticationTicket a deserializaci aktuálního požadavku na vlastnost UserData.</span><span class="sxs-lookup"><span data-stu-id="25cbb-366">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="25cbb-367">V případě příkladu data narození a jméno zaměstnavatele by byl řetězec UserData rozdělen do dvou podřetězců na základě oddělovače (|).</span><span class="sxs-lookup"><span data-stu-id="25cbb-367">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>

<span data-ttu-id="25cbb-368">[v ověřovacím lístku mohou být uloženy ![Další informace o uživateli.](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-368">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span></span>

<span data-ttu-id="25cbb-369">**Obrázek 04**: Další informace o uživateli mohou být uloženy v ověřovacím lístku ([kliknutím zobrazíte obrázek v plné velikosti).](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-369">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span></span>

### <a name="writing-information-to-userdata"></a><span data-ttu-id="25cbb-370">Zápis informací do UserData</span><span class="sxs-lookup"><span data-stu-id="25cbb-370">Writing Information to UserData</span></span>

<span data-ttu-id="25cbb-371">Bohužel přidání informací specifických pro uživatele do lístku pro ověřování pomocí formulářů není tak jasné, jako by bylo možné očekávat.</span><span class="sxs-lookup"><span data-stu-id="25cbb-371">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="25cbb-372">Vlastnost UserData třídy FormsAuthenticationTicket je pouze pro čtení a lze ji zadat pouze prostřednictvím konstruktoru třídy FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="25cbb-372">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="25cbb-373">Když zadáte vlastnost UserData v konstruktoru, musíme taky zadat další hodnoty lístku: uživatelské jméno, datum problému, vypršení platnosti atd.</span><span class="sxs-lookup"><span data-stu-id="25cbb-373">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="25cbb-374">Když jsme vytvořili přihlašovací stránku v předchozím kurzu, měla by být pro nás zpracována třídou FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="25cbb-374">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="25cbb-375">Při přidávání UserData do FormsAuthenticationTicket budeme muset napsat kód, který bude replikovat většinu funkcí již poskytovaných třídou FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="25cbb-375">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="25cbb-376">Podíváme se na potřebný kód pro práci s UserData, a to tak, že aktualizujete stránku Login. aspx a zaznamenáte si další informace o uživateli k ověřovacímu lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-376">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="25cbb-377">Předstírat, že naše uživatelské úložiště obsahuje informace o společnosti, pro kterou uživatel pracuje, a o jejich názvu a o tom, že chceme tyto informace zachytit v ověřovacím lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-377">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="25cbb-378">Aktualizujte obslužnou rutinu události LoginButton kliknutí na stránku Login. aspx, aby kód vypadal jako následující:</span><span class="sxs-lookup"><span data-stu-id="25cbb-378">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample6.cs)]

<span data-ttu-id="25cbb-379">Pojďme krokovat tento kód po jednotlivých řádcích.</span><span class="sxs-lookup"><span data-stu-id="25cbb-379">Let's step through this code one line at a time.</span></span> <span data-ttu-id="25cbb-380">Metoda začíná definováním čtyř polí řetězců: uživatelé, hesla, companyName a titleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="25cbb-380">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="25cbb-381">Tato pole obsahují uživatelská jména, hesla, názvy společností a názvy uživatelských účtů v systému, z nichž jsou tři: Scott, Jisun a Sam.</span><span class="sxs-lookup"><span data-stu-id="25cbb-381">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="25cbb-382">V reálné aplikaci se tyto hodnoty dotazují z úložiště uživatele, ale nejsou pevně zakódované ve zdrojovém kódu stránky.</span><span class="sxs-lookup"><span data-stu-id="25cbb-382">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="25cbb-383">V předchozím kurzu, pokud jsou zadané přihlašovací údaje platné, jsme jednoduše volali FormsAuthentication. RedirectFromLoginPage (UserName. text, RememberMe. Checked), který provedl následující kroky:</span><span class="sxs-lookup"><span data-stu-id="25cbb-383">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="25cbb-384">Vytvoření lístku pro ověřování formulářů</span><span class="sxs-lookup"><span data-stu-id="25cbb-384">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="25cbb-385">Lístek se zapsal do příslušného úložiště.</span><span class="sxs-lookup"><span data-stu-id="25cbb-385">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="25cbb-386">Pro lístky ověřování založené na souborech cookie se používá kolekce souborů cookie v prohlížeči. v případě ověřovacích lístků bez souborů cookie jsou data lístků serializovaná na adresu URL.</span><span class="sxs-lookup"><span data-stu-id="25cbb-386">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="25cbb-387">Přesměrováno uživatele na příslušnou stránku</span><span class="sxs-lookup"><span data-stu-id="25cbb-387">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="25cbb-388">Tyto kroky se replikují do výše uvedeného kódu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-388">These steps are replicated in the code above.</span></span> <span data-ttu-id="25cbb-389">Za prvé, řetězec, který nakonec ukládáme do vlastnosti UserData, se vytvoří tak, že se zkombinuje název společnosti a název, přičemž tyto dvě hodnoty se znakem svislé čáry (|).</span><span class="sxs-lookup"><span data-stu-id="25cbb-389">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="25cbb-390">String userDataString = řetězec. Concat (companyName [i]; "|"; titleAtCompany [i]);</span><span class="sxs-lookup"><span data-stu-id="25cbb-390">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span></span>

<span data-ttu-id="25cbb-391">Dále je vyvolána metoda FormsAuthentication. GetAuthCookie, která vytvoří ověřovací lístek, zašifruje ho a ověří ho v závislosti na nastavení konfigurace a umístí ho do objektu HttpCookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-391">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="25cbb-392">HttpCookie authCookie = FormsAuthentication. GetAuthCookie (UserName. text, RememberMe. Checked);</span><span class="sxs-lookup"><span data-stu-id="25cbb-392">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="25cbb-393">Aby bylo možné pracovat s FormAuthenticationTicket vloženým v souboru cookie, musíme volat [metodu dešifrování](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx)třídy FormAuthentication, která předává hodnotu souboru cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-393">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="25cbb-394">FormsAuthenticationTicket lístek = FormsAuthentication. dešifrovat (authCookie. Value);</span><span class="sxs-lookup"><span data-stu-id="25cbb-394">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span></span>

<span data-ttu-id="25cbb-395">Pak vytvoříme *novou* instanci FormsAuthenticationTicket založenou na stávajících hodnotách FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="25cbb-395">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="25cbb-396">Tento nový lístek ale obsahuje informace specifické pro uživatele (userDataString).</span><span class="sxs-lookup"><span data-stu-id="25cbb-396">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="25cbb-397">FormsAuthenticationTicket newTicket = New FormsAuthenticationTicket (Ticket. Verze, lístek. Název, lístek. IssueDate, lístek. Vypršení platnosti, lístek. Persistent, userDataString);</span><span class="sxs-lookup"><span data-stu-id="25cbb-397">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span></span>

<span data-ttu-id="25cbb-398">Pak zašifrujeme (a ověříme) novou instanci FormsAuthenticationTicket voláním [metody Encrypt](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)a tato šifrovaná (a ověřená) data vložte zpátky do authCookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-398">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="25cbb-399">authCookie. Value = FormsAuthentication. Encrypt (newTicket);</span><span class="sxs-lookup"><span data-stu-id="25cbb-399">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span></span>

<span data-ttu-id="25cbb-400">Nakonec se authCookie přidá do kolekce Response. cookies a metoda GetRedirectUrl se zavolá k určení vhodné stránky pro odeslání uživatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-400">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample7.cs)]

<span data-ttu-id="25cbb-401">Veškerý tento kód je nutný, protože vlastnost UserData je jen pro čtení a třída FormsAuthentication neposkytuje žádné metody pro zadání informací o uživatelských geografických metodách ve svých GetAuthCookie, SetAuthCookie nebo RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="25cbb-401">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-402">Kód, který jsme právě prozkoumali, ukládá do ověřovacího lístku založeného na souborech cookie informace specifické pro uživatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-402">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="25cbb-403">Třídy zodpovědné za serializaci ověřovacího lístku Forms na adresu URL jsou interní pro .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="25cbb-403">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="25cbb-404">Dlouhý příběh je krátký. data uživatelů nemůžete ukládat do lístku pro ověřování pomocí formulářů bez souborů cookie.</span><span class="sxs-lookup"><span data-stu-id="25cbb-404">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>

### <a name="accessing-the-userdata-information"></a><span data-ttu-id="25cbb-405">Přístup k informacím o UserData</span><span class="sxs-lookup"><span data-stu-id="25cbb-405">Accessing the UserData Information</span></span>

<span data-ttu-id="25cbb-406">V tomto okamžiku se název a název společnosti každého uživatele uloží do vlastnosti UserData ověřovacího lístku formuláře, když se přihlásí.</span><span class="sxs-lookup"><span data-stu-id="25cbb-406">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="25cbb-407">K těmto informacím můžete získat přístup z ověřovacího lístku na libovolné stránce, aniž byste museli ukládat uživatele do úložiště.</span><span class="sxs-lookup"><span data-stu-id="25cbb-407">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="25cbb-408">Abychom se vypracovali, jak se tyto informace dají načíst z vlastnosti UserData, můžeme aktualizovat default. aspx, aby jeho uvítací zpráva obsahovala nejen jméno uživatele, ale i společnost, pro kterou pracují, a jejich název.</span><span class="sxs-lookup"><span data-stu-id="25cbb-408">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="25cbb-409">V současné době obsahuje default. aspx panel AuthenticatedMessagePanel s ovládacím prvkem popisek s názvem WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="25cbb-409">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="25cbb-410">Tento panel se zobrazuje jenom pro ověřené uživatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-410">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="25cbb-411">Aktualizujte kód na stránce Default. aspx\_obslužnou rutinu události Load, aby vypadala takto:</span><span class="sxs-lookup"><span data-stu-id="25cbb-411">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample8.cs)]

<span data-ttu-id="25cbb-412">Pokud je Request. WelcomeBackMessage nastaven na hodnotu true, vlastnost text na začátku je nejprve nastavena na Vítejte zpět, *uživatelské jméno*.</span><span class="sxs-lookup"><span data-stu-id="25cbb-412">If Request.IsAuthenticated is true, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="25cbb-413">Pak je vlastnost User. identity převedena na objekt FormsIdentity, aby bylo možné získat přístup k základnímu FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="25cbb-413">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="25cbb-414">Jakmile budeme mít FormsAuthenticationTicket, deserializovatme vlastnost UserData na název společnosti a název.</span><span class="sxs-lookup"><span data-stu-id="25cbb-414">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="25cbb-415">To je provedeno rozdělením řetězce na znak kanálu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-415">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="25cbb-416">Název a název společnosti se pak zobrazí v popisku WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="25cbb-416">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="25cbb-417">Obrázek 5 znázorňuje snímek obrazovky s tímto zobrazením v akci.</span><span class="sxs-lookup"><span data-stu-id="25cbb-417">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="25cbb-418">Když se přihlásíte jako Scott, zobrazí se uvítací zpráva s oznámením, která obsahuje společnost a název Scott.</span><span class="sxs-lookup"><span data-stu-id="25cbb-418">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>

<span data-ttu-id="25cbb-419">[Zobrazuje se ![název společnosti a názvu aktuálně přihlášeného uživatele.](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-419">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span></span>

<span data-ttu-id="25cbb-420">**Obrázek 05**: zobrazí se aktuálně přihlášená společnost a název uživatele ([kliknutím zobrazíte obrázek v plné velikosti](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png)).</span><span class="sxs-lookup"><span data-stu-id="25cbb-420">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-421">Vlastnost UserData ověřovacího lístku slouží jako mezipaměť pro úložiště uživatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-421">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="25cbb-422">Stejně jako jakákoli mezipaměť, je nutné ji aktualizovat při změně podkladových dat.</span><span class="sxs-lookup"><span data-stu-id="25cbb-422">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="25cbb-423">Pokud například existuje webová stránka, ze které mohou uživatelé aktualizovat svůj profil, musí být pole uložená v mezipaměti ve vlastnosti UserData aktualizována, aby odrážela změny provedené uživatelem.</span><span class="sxs-lookup"><span data-stu-id="25cbb-423">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>

## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="25cbb-424">Krok 5: použití vlastního objektu zabezpečení</span><span class="sxs-lookup"><span data-stu-id="25cbb-424">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="25cbb-425">U každého příchozího požadavku se FormsAuthenticationModule pokusí ověřit uživatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-425">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="25cbb-426">Pokud je k dispozici ověřovací lístek bez vypršení platnosti, FormsAuthenticationModule přiřadí vlastnost HttpContext. User k novému objektu GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="25cbb-426">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="25cbb-427">Tento objekt GenericPrincipal má identitu typu FormsIdentity, která obsahuje odkaz na lístek ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-427">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="25cbb-428">Třída GenericPrincipal obsahuje minimální funkčnost, kterou vyžaduje třída, která implementuje IPrincipal – má pouze vlastnost identity a metodu IsInRole.</span><span class="sxs-lookup"><span data-stu-id="25cbb-428">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="25cbb-429">Objekt zabezpečení má dvě povinnosti: k určení rolí, do kterých uživatel patří, a k poskytnutí informací o identitě.</span><span class="sxs-lookup"><span data-stu-id="25cbb-429">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="25cbb-430">K tomu je možné využít metodu IsInRole (*roleName*) a vlastnost identity rozhraní IPrincipal (v uvedeném pořadí).</span><span class="sxs-lookup"><span data-stu-id="25cbb-430">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="25cbb-431">Třída GenericPrincipal umožňuje určit pole řetězců názvů rolí prostřednictvím jeho konstruktoru; jeho Metoda IsInRole (*roleName*) pouze kontroluje, zda předaná v *roleName* existuje v poli řetězců.</span><span class="sxs-lookup"><span data-stu-id="25cbb-431">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="25cbb-432">Když FormsAuthenticationModule vytvoří GenericPrincipal, předá do konstruktoru GenericPrincipal v prázdném poli řetězce.</span><span class="sxs-lookup"><span data-stu-id="25cbb-432">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="25cbb-433">V důsledku toho všechna volání IsInRole budou vždycky vracet hodnotu false.</span><span class="sxs-lookup"><span data-stu-id="25cbb-433">Consequently, any call to IsInRole will always return false.</span></span>

<span data-ttu-id="25cbb-434">Třída GenericPrincipal splňuje potřeby většiny scénářů ověřování založených na formulářích, kde se role nepoužívají.</span><span class="sxs-lookup"><span data-stu-id="25cbb-434">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="25cbb-435">V případech, kdy výchozí zpracování role není dostatečné nebo když potřebujete k uživateli přidružit vlastní objekt IIdentity, můžete v pracovním postupu ověřování vytvořit vlastní objekt IPrincipal a přiřadit ho k vlastnosti HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="25cbb-435">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-436">Jak uvidíme v budoucích kurzech, a to v případě ASP. Rozhraní .NET Framework Roles je povoleno, vytvoří vlastní objekt zabezpečení typu [Tento RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) a přepíše objekt GenericPrincipal, který se vytvořil pro ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-436">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="25cbb-437">Provede to pro přizpůsobení metody IsInRole objektu zabezpečení rozhraní rozhraní API architektury rolí.</span><span class="sxs-lookup"><span data-stu-id="25cbb-437">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>

<span data-ttu-id="25cbb-438">Vzhledem k tomu, že jsme se ještě dodržovali s rolemi, jediným důvodem, proč by bylo vytvoření vlastního objektu zabezpečení v tomto situaci, bylo přidružit k objektu zabezpečení vlastní objekt IIdentity.</span><span class="sxs-lookup"><span data-stu-id="25cbb-438">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="25cbb-439">V kroku 4 jsme se podívali na ukládání dalších informací o uživatelích do vlastnosti UserData ověřovacího lístku, zejména podle názvu společnosti a jejich názvu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-439">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="25cbb-440">Informace o UserData jsou ale přístupné jenom prostřednictvím ověřovacího lístku a pak jako serializovaného řetězce, což znamená, že kdykoli chceme zobrazit informace o uživateli uložené v lístku, potřebujeme analyzovat vlastnost UserData.</span><span class="sxs-lookup"><span data-stu-id="25cbb-440">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="25cbb-441">Prostředí pro vývojáře můžeme vylepšit vytvořením třídy, která implementuje IIdentity a obsahuje vlastnosti CompanyName a title.</span><span class="sxs-lookup"><span data-stu-id="25cbb-441">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="25cbb-442">Díky tomu může vývojář získat přístup k názvu a názvu společnosti aktuálně přihlášeného uživatele přímo prostřednictvím vlastností CompanyName a title, aniž by bylo nutné znát způsob, jak analyzovat vlastnost UserData.</span><span class="sxs-lookup"><span data-stu-id="25cbb-442">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="25cbb-443">Vytvoření vlastní třídy identity a objektů zabezpečení</span><span class="sxs-lookup"><span data-stu-id="25cbb-443">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="25cbb-444">Pro tento kurz vytvoříme vlastní objekty zabezpečení a identity ve složce App\_Code.</span><span class="sxs-lookup"><span data-stu-id="25cbb-444">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="25cbb-445">Začněte tím, že do svého projektu přidáte aplikaci\_kódu, kliknete pravým tlačítkem myši na název projektu v Průzkumník řešení, vyberete možnost Přidat složku ASP.NET a zvolíte\_kód aplikace.</span><span class="sxs-lookup"><span data-stu-id="25cbb-445">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="25cbb-446">Složka\_kódu aplikace je speciální složka ASP.NET, která obsahuje soubory třídy specifické pro web.</span><span class="sxs-lookup"><span data-stu-id="25cbb-446">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="25cbb-447">Složka\_kódu aplikace by měla být použita pouze při správě projektu prostřednictvím modelu projektu webu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-447">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="25cbb-448">Pokud používáte [model projektu webové aplikace](https://msdn.microsoft.com/asp.net/Aa336618.aspx), vytvořte standardní složku a přidejte do ní třídy.</span><span class="sxs-lookup"><span data-stu-id="25cbb-448">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="25cbb-449">Můžete například přidat novou složku s názvem Classes a umístit svůj kód do tohoto umístění.</span><span class="sxs-lookup"><span data-stu-id="25cbb-449">For example, you could add a new folder named Classes, and place your code there.</span></span>

<span data-ttu-id="25cbb-450">V dalším kroku přidejte do složky\_kódu aplikace dva nové soubory třídy, jednu s názvem CustomIdentity.cs a jednu s názvem CustomPrincipal.cs.</span><span class="sxs-lookup"><span data-stu-id="25cbb-450">Next, add two new class files to the App\_Code folder, one named CustomIdentity.cs and one named CustomPrincipal.cs.</span></span>

<span data-ttu-id="25cbb-451">[![do projektu přidejte třídy CustomIdentity a CustomPrincipal.](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-451">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span></span>

<span data-ttu-id="25cbb-452">**Obrázek 06**: přidejte do projektu třídy CustomIdentity a CustomPrincipal ([kliknutím zobrazíte obrázek v plné velikosti](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png)).</span><span class="sxs-lookup"><span data-stu-id="25cbb-452">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span></span>

<span data-ttu-id="25cbb-453">Třída CustomIdentity zodpovídá za implementaci rozhraní IIdentity, které definuje vlastnosti AuthenticationType, Authenticated a Name.</span><span class="sxs-lookup"><span data-stu-id="25cbb-453">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="25cbb-454">Kromě požadovaných vlastností vás zajímá vystavení základního autentizačního lístku s formuláři a také vlastností pro název a název společnosti uživatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-454">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="25cbb-455">Do třídy CustomIdentity zadejte následující kód.</span><span class="sxs-lookup"><span data-stu-id="25cbb-455">Enter the following code into the CustomIdentity class.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample9.cs)]

<span data-ttu-id="25cbb-456">Všimněte si, že třída obsahuje členskou proměnnou FormsAuthenticationTicket (\_lístek) a že informace o lístku musí být dodány prostřednictvím konstruktoru.</span><span class="sxs-lookup"><span data-stu-id="25cbb-456">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="25cbb-457">Tato data lístku se používají při vracení názvu identity. vlastnost UserData je analyzována tak, aby vracela hodnoty vlastností CompanyName a title.</span><span class="sxs-lookup"><span data-stu-id="25cbb-457">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="25cbb-458">Dále vytvořte třídu CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="25cbb-458">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="25cbb-459">Vzhledem k tomu, že s rolemi v tomto situaci nejsou obavy, konstruktor třídy CustomPrincipal přijímá pouze objekt CustomIdentity; jeho Metoda IsInRole vždy vrátí hodnotu false.</span><span class="sxs-lookup"><span data-stu-id="25cbb-459">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns false.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample10.cs)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="25cbb-460">Přiřazení objektu CustomPrincipal k kontextu zabezpečení příchozího požadavku</span><span class="sxs-lookup"><span data-stu-id="25cbb-460">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="25cbb-461">Nyní máme třídu, která rozšiřuje výchozí specifikaci IIdentity, aby zahrnovala vlastnosti CompanyName a title, a také vlastní třídu zabezpečení, která používá vlastní identitu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-461">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="25cbb-462">Jsme připraveni přejít do kanálu ASP.NET a přiřazovat vlastní objekt zabezpečení do kontextu zabezpečení příchozího požadavku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-462">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="25cbb-463">Kanál ASP.NET přijímá příchozí požadavek a zpracovává ho pomocí několika kroků.</span><span class="sxs-lookup"><span data-stu-id="25cbb-463">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="25cbb-464">V každém kroku se vyvolá konkrétní událost, která vývojářům umožní klepnout do kanálu ASP.NET a upravit požadavek v určitých fázích životního cyklu.</span><span class="sxs-lookup"><span data-stu-id="25cbb-464">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="25cbb-465">FormsAuthenticationModule například počká, až ASP.NET vyvolá [událost AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx). v takovém případě zkontroluje příchozí požadavek na ověřovací lístek.</span><span class="sxs-lookup"><span data-stu-id="25cbb-465">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="25cbb-466">Pokud se najde ověřovací lístek, vytvoří se objekt GenericPrincipal a přiřadí se k vlastnosti HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="25cbb-466">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="25cbb-467">Po události AuthenticateRequest kanál ASP.NET vyvolá [událost PostAuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), což je místo, kde můžeme nahradit objekt GenericPrincipal vytvořený FormsAuthenticationModule s instancí našeho objektu CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="25cbb-467">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="25cbb-468">Obrázek 7 znázorňuje tento pracovní postup.</span><span class="sxs-lookup"><span data-stu-id="25cbb-468">Figure 7 depicts this workflow.</span></span>

<span data-ttu-id="25cbb-469">[![GenericPrincipal nahrazuje CustomPrincipal v události PostAuthenticationRequest](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-469">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span></span>

<span data-ttu-id="25cbb-470">**Obrázek 07**: GenericPrincipal se nahrazuje CustomPrincipal v události PostAuthenticationRequest ([kliknutím zobrazíte obrázek v plné velikosti](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png)).</span><span class="sxs-lookup"><span data-stu-id="25cbb-470">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span></span>

<span data-ttu-id="25cbb-471">Aby bylo možné spustit kód v reakci na událost kanálu ASP.NET, můžeme buď vytvořit příslušnou obslužnou rutinu události v Global. asax, nebo vytvořit vlastní modul HTTP.</span><span class="sxs-lookup"><span data-stu-id="25cbb-471">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="25cbb-472">V tomto kurzu vytvoříme obslužnou rutinu události v Global. asax.</span><span class="sxs-lookup"><span data-stu-id="25cbb-472">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="25cbb-473">Začněte tím, že do svého webu přidáte Global. asax.</span><span class="sxs-lookup"><span data-stu-id="25cbb-473">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="25cbb-474">Klikněte pravým tlačítkem myši na název projektu v Průzkumník řešení a přidejte položku typu globální třída aplikace s názvem Global. asax.</span><span class="sxs-lookup"><span data-stu-id="25cbb-474">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>

<span data-ttu-id="25cbb-475">[![přidat soubor Global. asax na web](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="25cbb-475">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span></span>

<span data-ttu-id="25cbb-476">**Obrázek 08**: Přidání souboru Global. asax na web ([kliknutím zobrazíte obrázek v plné velikosti](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="25cbb-476">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span></span>

<span data-ttu-id="25cbb-477">Výchozí šablona Global. asax obsahuje obslužné rutiny událostí pro určitý počet událostí kanálu ASP.NET, včetně události Start, end a [Error](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), mimo jiné.</span><span class="sxs-lookup"><span data-stu-id="25cbb-477">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="25cbb-478">Nebojte se odebrat tyto obslužné rutiny událostí, protože je pro tuto aplikaci nepotřebujeme.</span><span class="sxs-lookup"><span data-stu-id="25cbb-478">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="25cbb-479">Událost, které vás zajímá, je PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="25cbb-479">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="25cbb-480">Aktualizujte soubor Global. asax tak, aby jeho značky vypadaly podobně jako v následujícím příkladu:</span><span class="sxs-lookup"><span data-stu-id="25cbb-480">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample11.aspx)]

<span data-ttu-id="25cbb-481">Metoda aplikace\_OnPostAuthenticateRequest se spustí pokaždé, když modul runtime ASP.NET vyvolá událost PostAuthenticateRequest, která se stane jednou u každé příchozí žádosti stránky.</span><span class="sxs-lookup"><span data-stu-id="25cbb-481">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="25cbb-482">Obslužná rutina události se spustí tak, že zkontroluje, jestli je uživatel ověřený a ověřený přes ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-482">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="25cbb-483">Pokud ano, vytvoří se nový objekt CustomIdentity a v jeho konstruktoru se předala ověřovací lístek aktuální žádosti.</span><span class="sxs-lookup"><span data-stu-id="25cbb-483">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="25cbb-484">Za tímto je vytvořen objekt CustomPrincipal a byl v jeho konstruktoru předán právě vytvořený objekt CustomIdentity.</span><span class="sxs-lookup"><span data-stu-id="25cbb-484">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="25cbb-485">Nakonec je kontext zabezpečení aktuální žádosti přiřazen k nově vytvořenému objektu CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="25cbb-485">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="25cbb-486">Všimněte si, že poslední krok a přidružení objektu CustomPrincipal k kontextu zabezpečení žádosti – přiřadí objekt zabezpečení dvěma vlastnostem: HttpContext. User a Thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="25cbb-486">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="25cbb-487">Tato dvě přiřazení jsou nezbytná z důvodu způsobu zpracování kontextů zabezpečení v ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="25cbb-487">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="25cbb-488">.NET Framework přidruží kontext zabezpečení ke každému běžícímu vláknu; Tyto informace jsou k dispozici jako objekt IPrincipal prostřednictvím [vlastnosti CurrentPrincipal](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx) [objektu vlákna](https://msdn.microsoft.com/library/system.threading.thread.aspx).</span><span class="sxs-lookup"><span data-stu-id="25cbb-488">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="25cbb-489">To je matoucí, že ASP.NET má vlastní informace o kontextu zabezpečení (HttpContext. User).</span><span class="sxs-lookup"><span data-stu-id="25cbb-489">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="25cbb-490">V některých případech je při určování kontextu zabezpečení prověřena vlastnost Thread. CurrentPrincipal. v jiných scénářích se používá HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="25cbb-490">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="25cbb-491">Například existují funkce zabezpečení v rozhraní .NET, které vývojářům umožňují deklarativní určení toho, jakým způsobem mohou uživatelé nebo role vytvářet instance třídy nebo volat konkrétní metody (viz [Přidání autorizačních pravidel do obchodních a datových vrstev pomocí PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="25cbb-491">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="25cbb-492">Pod rámec těchto vazeb tyto deklarativní techniky určují kontext zabezpečení prostřednictvím vlastnosti Thread. CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="25cbb-492">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="25cbb-493">V jiných scénářích je použita vlastnost HttpContext. User.</span><span class="sxs-lookup"><span data-stu-id="25cbb-493">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="25cbb-494">Například v předchozím kurzu jsme tuto vlastnost použili k zobrazení aktuálně přihlášeného uživatelského jména uživatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-494">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="25cbb-495">Jasně je nutné, aby se informace o kontextu zabezpečení ve vlastnostech vlákna. CurrentPrincipal a HttpContext. User shodovaly.</span><span class="sxs-lookup"><span data-stu-id="25cbb-495">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="25cbb-496">Modul runtime ASP.NET automaticky synchronizuje Tyto hodnoty vlastností pro nás.</span><span class="sxs-lookup"><span data-stu-id="25cbb-496">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="25cbb-497">Tato synchronizace se však vyskytne po události AuthenticateRequest, ale *před* událostí PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="25cbb-497">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="25cbb-498">V důsledku toho, aby při přidávání vlastního objektu zabezpečení v události PostAuthenticateRequest bylo nutné, aby bylo jisté, že ručně přiřadí vlákna. CurrentPrincipal nebo else Thread. CurrentPrincipal a HttpContext. uživatel nebude synchronizován. Podrobnější diskusi k tomuto problému najdete v tématu [kontext. User vs. Thread. CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) .</span><span class="sxs-lookup"><span data-stu-id="25cbb-498">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="25cbb-499">Přístup k vlastnostem CompanyName a názvu</span><span class="sxs-lookup"><span data-stu-id="25cbb-499">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="25cbb-500">Pokaždé, když požadavek dorazí a odešle do modulu ASP.NET, aktivuje se obslužná rutina události aplikace\_OnPostAuthenticateRequest v Global. asax.</span><span class="sxs-lookup"><span data-stu-id="25cbb-500">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="25cbb-501">Pokud byl požadavek úspěšně ověřen serverem FormsAuthenticationModule, obslužná rutina události vytvoří nový objekt CustomPrincipal s objektem CustomIdentity na základě lístku pro ověřování pomocí formulářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-501">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="25cbb-502">Díky této logice je přístup k informacím o aktuálně přihlášeném uživatelskému jménu a názvu společnosti neuvěřitelně přímočarý.</span><span class="sxs-lookup"><span data-stu-id="25cbb-502">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="25cbb-503">Vraťte se na stránku\_načíst obslužnou rutinu události ve formátu default. aspx, kde v kroku 4 jste napsali kód pro načtení lístku ověřování formuláře a k analýze vlastnosti UserData, aby se zobrazil název a název společnosti uživatele.</span><span class="sxs-lookup"><span data-stu-id="25cbb-503">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="25cbb-504">U aktuálně používaných objektů CustomPrincipal a CustomIdentity není nutné analyzovat hodnoty z vlastnosti UserData lístku.</span><span class="sxs-lookup"><span data-stu-id="25cbb-504">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="25cbb-505">Místo toho jednoduše Získejte odkaz na objekt CustomIdentity a použijte jeho vlastnosti CompanyName a title:</span><span class="sxs-lookup"><span data-stu-id="25cbb-505">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample12.cs)]

## <a name="summary"></a><span data-ttu-id="25cbb-506">Přehled</span><span class="sxs-lookup"><span data-stu-id="25cbb-506">Summary</span></span>

<span data-ttu-id="25cbb-507">V tomto kurzu jsme prozkoumali, jak přizpůsobit nastavení systému ověřování pomocí formulářů pomocí souboru Web. config. Prohlédli jsme se na tom, jak se zpracovává vypršení platnosti ověřovacího lístku a jak se používají ochranná a ověřovací ochrana k ochraně lístku před kontrolou a úpravou.</span><span class="sxs-lookup"><span data-stu-id="25cbb-507">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="25cbb-508">Nakonec jsme probrali použití vlastnosti UserData v ověřovacím lístku pro ukládání dalších informací o uživateli do samotného lístku a použití vlastních objektů zabezpečení a identity k zveřejnění těchto informací v lépe přívětivém způsobu vývojářů.</span><span class="sxs-lookup"><span data-stu-id="25cbb-508">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="25cbb-509">V tomto kurzu se uzavírá naše zkoumání ověřování formulářů v ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="25cbb-509">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="25cbb-510">Další kurz spustí naši cestu do prostředí členství.</span><span class="sxs-lookup"><span data-stu-id="25cbb-510">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="25cbb-511">Šťastné programování!</span><span class="sxs-lookup"><span data-stu-id="25cbb-511">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="25cbb-512">Další čtení</span><span class="sxs-lookup"><span data-stu-id="25cbb-512">Further Reading</span></span>

<span data-ttu-id="25cbb-513">Další informace o tématech popsaných v tomto kurzu najdete v následujících zdrojích informací:</span><span class="sxs-lookup"><span data-stu-id="25cbb-513">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="25cbb-514">Rozhmyz ověřování formulářů</span><span class="sxs-lookup"><span data-stu-id="25cbb-514">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="25cbb-515">Vysvětlení: ověřování prostřednictvím formulářů v ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="25cbb-515">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="25cbb-516">Postupy: ochrana ověřování pomocí formulářů v ASP.NET 2,0</span><span class="sxs-lookup"><span data-stu-id="25cbb-516">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="25cbb-517">[Professional ASP.NET 2,0 zabezpečení, členství a Správa rolí](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span><span class="sxs-lookup"><span data-stu-id="25cbb-517">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="25cbb-518">Zabezpečení ovládacích prvků přihlášení</span><span class="sxs-lookup"><span data-stu-id="25cbb-518">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="25cbb-519">&gt; element ověřování &lt;</span><span class="sxs-lookup"><span data-stu-id="25cbb-519">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="25cbb-520">&gt; prvek &lt;Forms pro &lt;ověřování&gt;</span><span class="sxs-lookup"><span data-stu-id="25cbb-520">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="25cbb-521">Element &lt;machineKey&gt;</span><span class="sxs-lookup"><span data-stu-id="25cbb-521">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="25cbb-522">Princip lístku a souboru cookie pro ověřování formulářů</span><span class="sxs-lookup"><span data-stu-id="25cbb-522">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="25cbb-523">Výukové video o tématech obsažených v tomto kurzu</span><span class="sxs-lookup"><span data-stu-id="25cbb-523">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="25cbb-524">Postup změny vlastností ověřování formulářů</span><span class="sxs-lookup"><span data-stu-id="25cbb-524">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="25cbb-525">Jak nastavit a používat ověřování bez souborů cookie v aplikaci ASP.NET</span><span class="sxs-lookup"><span data-stu-id="25cbb-525">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="25cbb-526">Přemístění formulářů ASP pro přihlášení</span><span class="sxs-lookup"><span data-stu-id="25cbb-526">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="25cbb-527">Konfigurace vlastního klíče přihlašovacích formulářů</span><span class="sxs-lookup"><span data-stu-id="25cbb-527">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="25cbb-528">Přidání vlastních dat do metody ověřování</span><span class="sxs-lookup"><span data-stu-id="25cbb-528">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="25cbb-529">Použití vlastních hlavních objektů</span><span class="sxs-lookup"><span data-stu-id="25cbb-529">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="25cbb-530">O autorovi</span><span class="sxs-lookup"><span data-stu-id="25cbb-530">About the Author</span></span>

<span data-ttu-id="25cbb-531">Scott Mitchell, autor několika stránek ASP/ASP. NET Books a zakladatel of 4GuysFromRolla.com, pracoval s webovými technologiemi Microsoftu od 1998.</span><span class="sxs-lookup"><span data-stu-id="25cbb-531">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="25cbb-532">Scott funguje jako nezávislý konzultant, Trainer a zapisovač.</span><span class="sxs-lookup"><span data-stu-id="25cbb-532">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="25cbb-533">Nejnovější kniha je *[Sams naučit se ASP.NET 2,0 za 24 hodin](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* .</span><span class="sxs-lookup"><span data-stu-id="25cbb-533">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="25cbb-534">Scott se dá kontaktovat [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) nebo prostřednictvím svého blogu na [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="25cbb-534">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="25cbb-535">Zvláštní díky</span><span class="sxs-lookup"><span data-stu-id="25cbb-535">Special Thanks To</span></span>

<span data-ttu-id="25cbb-536">Tato řada kurzů byla přezkoumána mnoha užitečnými kontrolory.</span><span class="sxs-lookup"><span data-stu-id="25cbb-536">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="25cbb-537">Kontrolor pro tento kurz byl Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="25cbb-537">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="25cbb-538">Uvažujete o přezkoumání mých nadcházejících článků na webu MSDN?</span><span class="sxs-lookup"><span data-stu-id="25cbb-538">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="25cbb-539">Pokud ano, vyřaďte mi řádek na [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="25cbb-539">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="25cbb-540">[Předchozí](an-overview-of-forms-authentication-cs.md)
> [Další](security-basics-and-asp-net-support-vb.md)</span><span class="sxs-lookup"><span data-stu-id="25cbb-540">[Previous](an-overview-of-forms-authentication-cs.md)
[Next](security-basics-and-asp-net-support-vb.md)</span></span>
