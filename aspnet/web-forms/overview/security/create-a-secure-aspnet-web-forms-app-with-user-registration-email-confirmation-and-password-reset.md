---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: Vytvoření zabezpečené aplikace webových formulářů ASP.NET pomocí registrace uživatele, potvrzení e-mailu a resetování hesla (C#) | Microsoft Docs
author: Erikre
description: V tomto kurzu se dozvíte, jak vytvořit aplikaci webových formulářů ASP.NET s registrací uživatele, potvrzením e-mailu a resetováním hesla pomocí člena ASP.NET Identity...
ms.author: riande
ms.date: 10/02/2014
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: af3653bc164810126bc3bf8f1b1794d75642d807
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78625151"
---
# <a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="37396-103">Vytvoření zabezpečené aplikace webových formulářů ASP.NET s registrací uživatele, potvrzením e-mailu a resetováním hesla (C#)</span><span class="sxs-lookup"><span data-stu-id="37396-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>

<span data-ttu-id="37396-104">od [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="37396-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="37396-105">V tomto kurzu se dozvíte, jak vytvořit aplikaci webových formulářů ASP.NET s registrací uživatele, potvrzením e-mailu a resetováním hesla pomocí systému členství v ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="37396-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="37396-106">Tento kurz vychází z [kurzu MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md)pro Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="37396-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>

## <a name="introduction"></a><span data-ttu-id="37396-107">Úvod</span><span class="sxs-lookup"><span data-stu-id="37396-107">Introduction</span></span>

<span data-ttu-id="37396-108">Tento kurz vás provede kroky potřebnými k vytvoření aplikace webových formulářů ASP.NET pomocí sady Visual Studio a ASP.NET 4,5 k vytvoření zabezpečené aplikace webových formulářů s registrací uživatelů, potvrzením e-mailu a resetováním hesla.</span><span class="sxs-lookup"><span data-stu-id="37396-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="37396-109">Úlohy a informace kurzu:</span><span class="sxs-lookup"><span data-stu-id="37396-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="37396-110">Vytvoření aplikace webových formulářů v ASP.NET</span><span class="sxs-lookup"><span data-stu-id="37396-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="37396-111">Připojit SendGrid</span><span class="sxs-lookup"><span data-stu-id="37396-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="37396-112">Vyžadovat před přihlášením e-mailové potvrzení</span><span class="sxs-lookup"><span data-stu-id="37396-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="37396-113">Obnovení a resetování hesla</span><span class="sxs-lookup"><span data-stu-id="37396-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="37396-114">Poslat znovu odkaz na potvrzení e-mailu</span><span class="sxs-lookup"><span data-stu-id="37396-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="37396-115">Řešení potíží s aplikací</span><span class="sxs-lookup"><span data-stu-id="37396-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="37396-116">Další zdroje</span><span class="sxs-lookup"><span data-stu-id="37396-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="37396-117">Vytvoření aplikace webových formulářů v ASP.NET</span><span class="sxs-lookup"><span data-stu-id="37396-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="37396-118">Začněte instalací a spuštěním [Visual Studio Express 2013 pro web](https://go.microsoft.com/fwlink/?LinkId=299058) nebo [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="37396-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="37396-119">Nainstalujte taky [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) nebo vyšší.</span><span class="sxs-lookup"><span data-stu-id="37396-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="37396-120">Upozornění: k dokončení tohoto kurzu je nutné nainstalovat [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) nebo vyšší.</span><span class="sxs-lookup"><span data-stu-id="37396-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>

1. <span data-ttu-id="37396-121">Vytvořte nový projekt (**soubor** -&gt; **Nový projekt**) a v dialogovém okně **Nový projekt** vyberte šablonu **Webová aplikace ASP.NET** a nejnovější verzi .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="37396-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="37396-122">V dialogovém okně **Nový projekt ASP.NET** vyberte šablonu **webových formulářů** .</span><span class="sxs-lookup"><span data-stu-id="37396-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="37396-123">U **jednotlivých uživatelských účtů**ponechte výchozí ověřování.</span><span class="sxs-lookup"><span data-stu-id="37396-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="37396-124">Pokud chcete aplikaci hostovat v Azure, ponechejte zaškrtnuté políčko **hostitel v cloudu** .</span><span class="sxs-lookup"><span data-stu-id="37396-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="37396-125">Potom kliknutím na tlačítko **OK** vytvořte nový projekt.</span><span class="sxs-lookup"><span data-stu-id="37396-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="37396-126">Dialogové okno ![nový projekt v ASP.NET](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="37396-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="37396-127">Povolte SSL (Secure Sockets Layer) (SSL) pro projekt.</span><span class="sxs-lookup"><span data-stu-id="37396-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="37396-128">Postupujte podle kroků, které jsou k dispozici v části **povolení SSL pro projekt** v Začínáme v rámci [řady kurzů pro webové formuláře](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="37396-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="37396-129">Spusťte aplikaci, klikněte na odkaz **zaregistrovat** a zaregistrujte nového uživatele.</span><span class="sxs-lookup"><span data-stu-id="37396-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="37396-130">V tomto okamžiku je jediným ověřením e-mailu založené na atributu [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) , aby byla e-mailová adresa ve správném formátu.</span><span class="sxs-lookup"><span data-stu-id="37396-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="37396-131">Úpravou kódu budete moct přidat potvrzení e-mailu.</span><span class="sxs-lookup"><span data-stu-id="37396-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="37396-132">Zavřete okno prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="37396-132">Close the browser window.</span></span>
5. <span data-ttu-id="37396-133">V **Průzkumník serveru** sady Visual Studio (**zobrazení** -&gt; **Průzkumník serveru**) přejděte na **Connections\DefaultConnection\Tables\AspNetUsers dat**, klikněte pravým tlačítkem a vyberte možnost **Otevřít definici tabulky**.</span><span class="sxs-lookup"><span data-stu-id="37396-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="37396-134">Následující obrázek ukazuje schéma `AspNetUsers` tabulky:</span><span class="sxs-lookup"><span data-stu-id="37396-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Schéma tabulky AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="37396-136">V **Průzkumník serveru**klikněte pravým tlačítkem myši na tabulku **AspNetUsers** a vyberte možnost **Zobrazit data tabulky**.</span><span class="sxs-lookup"><span data-stu-id="37396-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Data tabulky AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="37396-138">V tomto okamžiku nebyl potvrzen e-mail pro registrovaného uživatele.</span><span class="sxs-lookup"><span data-stu-id="37396-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="37396-139">Pokud chcete uživatele odstranit, klikněte na řádek a vyberte Odstranit.</span><span class="sxs-lookup"><span data-stu-id="37396-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="37396-140">Tento e-mail přidáte znovu v dalším kroku a odešlete potvrzovací zprávu na e-mailovou adresu.</span><span class="sxs-lookup"><span data-stu-id="37396-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="37396-141">Potvrzení e-mailu</span><span class="sxs-lookup"><span data-stu-id="37396-141">Email Confirmation</span></span>

<span data-ttu-id="37396-142">Je osvědčeným postupem ověření e-mailu při registraci nového uživatele, aby se ověřilo, že nezosobňuje někoho jiného (tj. není zaregistrovaný v e-mailu někoho jiného).</span><span class="sxs-lookup"><span data-stu-id="37396-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="37396-143">Předpokládejme, že máte diskuzní fórum, chcete zabránit `"bob@cpandl.com"` registraci jako `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="37396-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="37396-144">Bez potvrzení e-mailu `"joe@contoso.com"` možné z vaší aplikace získat nechtěný e-mail.</span><span class="sxs-lookup"><span data-stu-id="37396-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="37396-145">Předpokládejme, že se Bob omylem zaregistrovali jako `"bib@cpandl.com"` a jste si ho všimli, ale nemohlo použít obnovení hesla, protože aplikace nemá správný e-mail.</span><span class="sxs-lookup"><span data-stu-id="37396-145">Suppose Bob accidentally registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="37396-146">Potvrzení e-mailu poskytuje jenom omezené ochrany z roboty a neposkytuje ochranu před určenými odesilateli nevyžádané pošty.</span><span class="sxs-lookup"><span data-stu-id="37396-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="37396-147">Obecně je vhodné zabránit novým uživatelům v posílání jakýchkoli dat na web před potvrzením e-mailu, textové zprávy SMS nebo jiného mechanismu.</span><span class="sxs-lookup"><span data-stu-id="37396-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="37396-148">V níže uvedených částech povolíme e-mailové potvrzení a upravíte kód tak, aby se nově zaregistrovaní uživatelé nemohli přihlásit, dokud se nepotvrdí jejich e-maily.</span><span class="sxs-lookup"><span data-stu-id="37396-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="37396-149">V tomto kurzu použijete e-mailovou službu SendGrid.</span><span class="sxs-lookup"><span data-stu-id="37396-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="37396-150">Připojit SendGrid</span><span class="sxs-lookup"><span data-stu-id="37396-150">Hook up SendGrid</span></span>

<span data-ttu-id="37396-151">SendGrid změnila rozhraní API od chvíle, kdy byl tento kurz napsán.</span><span class="sxs-lookup"><span data-stu-id="37396-151">SendGrid has changed it's API since this tutorial was written.</span></span> <span data-ttu-id="37396-152">Aktuální pokyny pro SendGrid najdete v tématu [SendGrid](http://sendgrid.com/) nebo [Povolení potvrzení účtu a obnovení hesla](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span><span class="sxs-lookup"><span data-stu-id="37396-152">For current SendGrid instructions, see [SendGrid](http://sendgrid.com/) or [Enable account confirmation and password recovery](xref:security/authentication/accconfirm#enable-account-confirmation-and-password-recovery).</span></span>

<span data-ttu-id="37396-153">I když tento kurz ukazuje, jak přidat e-mailové oznámení prostřednictvím [SendGrid](http://sendgrid.com/), můžete posílat e-maily pomocí protokolu SMTP a dalších mechanismů (viz [Další zdroje informací](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="37396-153">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="37396-154">V aplikaci Visual Studio otevřete **konzolu správce** balíčků (**nástroje** -&gt; správce **balíčků NuGet** -&gt; **konzole správce balíčků**) a zadejte následující příkaz:</span><span class="sxs-lookup"><span data-stu-id="37396-154">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="37396-155">Přejdete na [stránku registrace Azure SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) a zaregistrujete se na bezplatný účet SendGrid.</span><span class="sxs-lookup"><span data-stu-id="37396-155">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="37396-156">Bezplatný účet SendGrid můžete také zaregistrovat přímo na [webu SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="37396-156">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="37396-157">Z **Průzkumník řešení** otevřete soubor *IdentityConfig.cs* ve složce *App\_Start* a přidejte následující kód zvýrazněný žlutě do třídy `EmailService`, abyste mohli nakonfigurovat **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="37396-157">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="37396-158">Na začátek souboru *IdentityConfig.cs* přidejte také následující příkazy `using`:</span><span class="sxs-lookup"><span data-stu-id="37396-158">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="37396-159">Chcete-li tuto ukázku uchovávat snadno, uložte hodnoty účtu e-mailové služby do části `appSettings` v souboru *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="37396-159">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="37396-160">Přidejte následující kód XML zvýrazněný žlutě do souboru *Web. config* v kořenovém adresáři projektu:</span><span class="sxs-lookup"><span data-stu-id="37396-160">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="37396-161">Zabezpečení – nikdy neukládejte citlivá data ve zdrojovém kódu.</span><span class="sxs-lookup"><span data-stu-id="37396-161">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="37396-162">V tomto příkladu je účet a přihlašovací údaje uložené v části **AppSetting** souboru *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="37396-162">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="37396-163">V Azure můžete tyto hodnoty bezpečně uložit na kartě **[Konfigurace](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** v Azure Portal.</span><span class="sxs-lookup"><span data-stu-id="37396-163">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="37396-164">Související informace najdete v tématu Rick Anderson s názvem [osvědčené postupy pro nasazování hesel a dalších citlivých dat do ASP.NET a Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="37396-164">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="37396-165">Přidejte hodnoty e-mailové služby tak, aby odrážely vaše hodnoty ověřování SendGrid (uživatelské jméno a heslo), abyste mohli úspěšně odesílat e-maily z vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="37396-165">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="37396-166">Nezapomeňte místo e-mailové adresy, kterou jste zadali SendGrid, použít název svého účtu SendGrid.</span><span class="sxs-lookup"><span data-stu-id="37396-166">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="37396-167">Povolit potvrzení e-mailu</span><span class="sxs-lookup"><span data-stu-id="37396-167">Enable Email Confirmation</span></span>

 <span data-ttu-id="37396-168">Chcete-li povolit e-mailové potvrzení, upravte registrační kód pomocí následujících kroků.</span><span class="sxs-lookup"><span data-stu-id="37396-168">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  

1. <span data-ttu-id="37396-169">Ve složce *account (účet* ) otevřete kód *Register.aspx.cs* a aktualizujte metodu `CreateUser_Click`, abyste povolili následující zvýrazněné změny:</span><span class="sxs-lookup"><span data-stu-id="37396-169">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="37396-170">V **Průzkumník řešení**klikněte pravým tlačítkem myši na *Default. aspx* a vyberte **nastavit jako úvodní stránku**.</span><span class="sxs-lookup"><span data-stu-id="37396-170">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="37396-171">Spusťte aplikaci stisknutím klávesy **F5.**</span><span class="sxs-lookup"><span data-stu-id="37396-171">Run the app by pressing **F5.**</span></span> <span data-ttu-id="37396-172">Po zobrazení stránky klikněte na odkaz **zaregistrovat** , aby se zobrazila stránka registrace.</span><span class="sxs-lookup"><span data-stu-id="37396-172">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="37396-173">Zadejte svůj e-mail a heslo a potom kliknutím na tlačítko **zaregistrovat** odešlete e-mailovou zprávu přes SendGrid.</span><span class="sxs-lookup"><span data-stu-id="37396-173">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
   <span data-ttu-id="37396-174">Aktuální stav projektu a kódu umožní uživateli, aby se přihlásili po dokončení registračního formuláře, i když nepotvrzují svůj účet.</span><span class="sxs-lookup"><span data-stu-id="37396-174">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="37396-175">Zkontrolujte svůj e-mailový účet a kliknutím na odkaz potvrďte svůj e-mail.</span><span class="sxs-lookup"><span data-stu-id="37396-175">Check your email account and click on the link to confirm your email.</span></span>  
   <span data-ttu-id="37396-176">Po odeslání registračního formuláře budete přihlášeni.</span><span class="sxs-lookup"><span data-stu-id="37396-176">Once you submit the registration form, you will be logged in.</span></span>  
    ![Ukázkový web – přihlášený](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="37396-178">Vyžadovat před přihlášením e-mailové potvrzení</span><span class="sxs-lookup"><span data-stu-id="37396-178">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="37396-179">I když jste e-mailový účet potvrdili, nemusíte v tomto okamžiku kliknout na odkaz obsažený v ověřovacím e-mailu, abyste mohli plně přihlášeni.</span><span class="sxs-lookup"><span data-stu-id="37396-179">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="37396-180">V následující části upravíte kód, který vyžaduje, aby noví uživatelé měli potvrzené e-maily, než se přihlásí (budou ověřeni).</span><span class="sxs-lookup"><span data-stu-id="37396-180">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="37396-181">V **Průzkumník řešení** sady Visual Studio aktualizujte událost `CreateUser_Click` v kódu *Register.aspx.cs* na pozadí, který je obsažený ve složce *Accounts* , s následujícími zvýrazněnými změnami:</span><span class="sxs-lookup"><span data-stu-id="37396-181">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="37396-182">Aktualizujte metodu `LogIn` v kódu *Login.aspx.cs* na pozadí s následujícími zvýrazněnými změnami:</span><span class="sxs-lookup"><span data-stu-id="37396-182">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="37396-183">Spuštění aplikace</span><span class="sxs-lookup"><span data-stu-id="37396-183">Run the Application</span></span>

 <span data-ttu-id="37396-184">Teď, když jste implementovali kód, abyste zkontrolovali, jestli je e-mailová adresa uživatele potvrzená, můžete zjistit **funkčnost na** **přihlašovacích a přihlašovacích** stránkách.</span><span class="sxs-lookup"><span data-stu-id="37396-184">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="37396-185">Odstraňte všechny účty v tabulce **AspNetUsers** , které obsahují e-mailový alias, který chcete otestovat.</span><span class="sxs-lookup"><span data-stu-id="37396-185">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="37396-186">Spusťte aplikaci (**F5**) a ověřte, že se nemůžete zaregistrovat jako uživatel, dokud nepotvrdíte svoji e-mailovou adresu.</span><span class="sxs-lookup"><span data-stu-id="37396-186">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="37396-187">Před potvrzením nového účtu prostřednictvím e-mailu, který se právě poslal, se pokuste přihlásit pomocí nového účtu.</span><span class="sxs-lookup"><span data-stu-id="37396-187">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="37396-188">Uvidíte, že se nemůžete přihlásit a že musíte mít potvrzený e-mailový účet.</span><span class="sxs-lookup"><span data-stu-id="37396-188">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="37396-189">Po potvrzení své e-mailové adresy se přihlaste k aplikaci.</span><span class="sxs-lookup"><span data-stu-id="37396-189">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="37396-190">Obnovení a resetování hesla</span><span class="sxs-lookup"><span data-stu-id="37396-190">Password Recovery and Reset</span></span>

1. <span data-ttu-id="37396-191">V aplikaci Visual Studio odeberte znaky komentářů z metody `Forgot` v kódu *Forgot.aspx.cs* na pozadí, který je obsažený ve složce *účtu* , aby se metoda zobrazila takto:</span><span class="sxs-lookup"><span data-stu-id="37396-191">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="37396-192">Otevřete stránku *Login. aspx* .</span><span class="sxs-lookup"><span data-stu-id="37396-192">Open the *Login.aspx* page.</span></span> <span data-ttu-id="37396-193">Nahraďte značku na konci oddílu **loginForm** , jak je zvýrazněno níže:</span><span class="sxs-lookup"><span data-stu-id="37396-193">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="37396-194">Otevřete *Login.aspx.cs* kód na pozadí a odkomentujte následující řádek kódu zvýrazněný žlutě od obslužné rutiny události `Page_Load`:</span><span class="sxs-lookup"><span data-stu-id="37396-194">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="37396-195">Spusťte aplikaci stisknutím klávesy **F5.**</span><span class="sxs-lookup"><span data-stu-id="37396-195">Run the app by pressing **F5.**</span></span> <span data-ttu-id="37396-196">Po zobrazení stránky klikněte na odkaz **Přihlásit** se.</span><span class="sxs-lookup"><span data-stu-id="37396-196">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="37396-197">Klikněte na odkaz **zapomenuté heslo?** . zobrazí se stránka **zapomenuté heslo** .</span><span class="sxs-lookup"><span data-stu-id="37396-197">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="37396-198">Zadejte svou e-mailovou adresu a kliknutím na tlačítko **Odeslat** odešlete e-mail na adresu, která vám umožní resetovat heslo.</span><span class="sxs-lookup"><span data-stu-id="37396-198">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
   <span data-ttu-id="37396-199">Ověřte e-mailový účet a kliknutím na odkaz zobrazte stránku pro **resetování hesla** .</span><span class="sxs-lookup"><span data-stu-id="37396-199">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="37396-200">Na stránce **resetovat heslo** zadejte svůj e-mail, heslo a potvrzení hesla.</span><span class="sxs-lookup"><span data-stu-id="37396-200">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="37396-201">Pak stiskněte tlačítko **obnovit** .</span><span class="sxs-lookup"><span data-stu-id="37396-201">Then, press the **Reset** button.</span></span>  
   <span data-ttu-id="37396-202">Po úspěšném resetování hesla se zobrazí stránka **změněné heslo** .</span><span class="sxs-lookup"><span data-stu-id="37396-202">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="37396-203">Nyní se můžete přihlásit pomocí nového hesla.</span><span class="sxs-lookup"><span data-stu-id="37396-203">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="37396-204">Poslat znovu odkaz na potvrzení e-mailu</span><span class="sxs-lookup"><span data-stu-id="37396-204">Resend Email Confirmation Link</span></span>

<span data-ttu-id="37396-205">Jakmile uživatel vytvoří nový místní účet, pošlete jim odkaz na potvrzení, že se musí použít, aby se mohli přihlásit.</span><span class="sxs-lookup"><span data-stu-id="37396-205">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="37396-206">Pokud uživatel omylem odstraní potvrzovací e-mail nebo e-mail nikdy nepřijde, bude potřebovat poslat potvrzovací odkaz znovu.</span><span class="sxs-lookup"><span data-stu-id="37396-206">If the user accidentally deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="37396-207">Následující změny kódu ukazují, jak tuto možnost povolit.</span><span class="sxs-lookup"><span data-stu-id="37396-207">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="37396-208">V aplikaci Visual Studio otevřete **Login.aspx.cs** kód na pozadí a přidejte následující obslužnou rutinu události za obslužnou rutinu události `LogIn`:</span><span class="sxs-lookup"><span data-stu-id="37396-208">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="37396-209">Upravte obslužnou rutinu události `LogIn` v kódu *Login.aspx.cs* na pozadí změnou kódu zvýrazněného žlutě následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="37396-209">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="37396-210">Stránku *Login. aspx* aktualizujte tak, že přidáte kód zvýrazněný žlutě, jak je znázorněno níže:</span><span class="sxs-lookup"><span data-stu-id="37396-210">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="37396-211">Odstraňte všechny účty v tabulce **AspNetUsers** , které obsahují e-mailový alias, který chcete otestovat.</span><span class="sxs-lookup"><span data-stu-id="37396-211">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="37396-212">Spusťte aplikaci (**F5**) a zaregistrujte svou e-mailovou adresu.</span><span class="sxs-lookup"><span data-stu-id="37396-212">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="37396-213">Před potvrzením nového účtu prostřednictvím e-mailu, který se právě poslal, se pokuste přihlásit pomocí nového účtu.</span><span class="sxs-lookup"><span data-stu-id="37396-213">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
   <span data-ttu-id="37396-214">Uvidíte, že se nemůžete přihlásit a že musíte mít potvrzený e-mailový účet.</span><span class="sxs-lookup"><span data-stu-id="37396-214">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="37396-215">Kromě toho teď můžete znovu poslat potvrzovací zprávu na váš e-mailový účet.</span><span class="sxs-lookup"><span data-stu-id="37396-215">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="37396-216">Zadejte svou e-mailovou adresu a heslo a potom klikněte na tlačítko **znovu odeslat potvrzení** .</span><span class="sxs-lookup"><span data-stu-id="37396-216">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="37396-217">Po potvrzení e-mailové adresy na základě nově odeslané e-mailové zprávy se přihlaste k aplikaci.</span><span class="sxs-lookup"><span data-stu-id="37396-217">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="37396-218">Řešení potíží s aplikací</span><span class="sxs-lookup"><span data-stu-id="37396-218">Troubleshooting the App</span></span>

<span data-ttu-id="37396-219">Pokud neobdržíte e-mail obsahující odkaz pro ověření vašich přihlašovacích údajů:</span><span class="sxs-lookup"><span data-stu-id="37396-219">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="37396-220">Ověřte složku s nevyžádanou poštou nebo spamem.</span><span class="sxs-lookup"><span data-stu-id="37396-220">Check your junk or spam folder.</span></span>
- <span data-ttu-id="37396-221">Přihlaste se k účtu SendGrid a klikněte na [odkaz e-mailová aktivita](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="37396-221">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="37396-222">Měli byste použít název uživatelského účtu SendGrid jako hodnotu *Web. config* , a ne svou e-mailovou adresu účtu SendGrid.</span><span class="sxs-lookup"><span data-stu-id="37396-222">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="37396-223">Další prostředky</span><span class="sxs-lookup"><span data-stu-id="37396-223">Additional Resources</span></span>

- [<span data-ttu-id="37396-224">Odkazy na ASP.NET Identity doporučené prostředky</span><span class="sxs-lookup"><span data-stu-id="37396-224">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="37396-225">Potvrzení účtu a obnovení hesla pomocí ASP.NET Identity</span><span class="sxs-lookup"><span data-stu-id="37396-225">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="37396-226">Série kurzů pro webové formuláře v ASP.NET – přidání poskytovatele OAuth 2,0</span><span class="sxs-lookup"><span data-stu-id="37396-226">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="37396-227">Nasazení zabezpečené aplikace webových formulářů ASP.NET pomocí členství, protokolu OAuth a SQL Database pro Azure App Service</span><span class="sxs-lookup"><span data-stu-id="37396-227">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="37396-228">Série kurzů pro webové formuláře v ASP.NET – povolení SSL pro projekt</span><span class="sxs-lookup"><span data-stu-id="37396-228">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
