---
uid: web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
title: Rezervace a platby pomocí služby PayPal | Microsoft Docs
author: Erikre
description: V této sérii kurzů se seznámíte se základy vytváření aplikací webových formulářů ASP.NET pomocí ASP.NET 4,5 a Microsoft Visual Studio Express 2013 pro My...
ms.author: riande
ms.date: 09/08/2014
ms.assetid: 664ec95e-b0c9-4f43-a39f-798d0f2a7e08
msc.legacyurl: /web-forms/overview/getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal
msc.type: authoredcontent
ms.openlocfilehash: 62d00a86c6c5845fb894896df65002c7086d039f
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/28/2019
ms.locfileid: "74615138"
---
# <a name="checkout-and-payment-with-paypal"></a><span data-ttu-id="6a25e-103">Pokladna a platba přes PayPal</span><span class="sxs-lookup"><span data-stu-id="6a25e-103">Checkout and Payment with PayPal</span></span>

<span data-ttu-id="6a25e-104">od [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="6a25e-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

<span data-ttu-id="6a25e-105">[Stáhnout vzorový projekt Wingtip Toys (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) nebo [Stáhnout elektronickou knihu (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span><span class="sxs-lookup"><span data-stu-id="6a25e-105">[Download Wingtip Toys Sample Project (C#)](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) or [Download E-book (PDF)](https://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20ASP.NET%204.5%20Web%20Forms%20and%20Visual%20Studio%202013.pdf)</span></span>

> <span data-ttu-id="6a25e-106">V této sérii kurzů se naučíte základy vytváření webových formulářů ASP.NET pomocí ASP.NET 4,5 a Microsoft Visual Studio Express 2013 pro web.</span><span class="sxs-lookup"><span data-stu-id="6a25e-106">This tutorial series will teach you the basics of building an ASP.NET Web Forms application using ASP.NET 4.5 and Microsoft Visual Studio Express 2013 for Web.</span></span> <span data-ttu-id="6a25e-107">K dispozici je Visual Studio 2013 [projekt se C# zdrojovým kódem](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) , který se doprovází v této sérii kurzů.</span><span class="sxs-lookup"><span data-stu-id="6a25e-107">A Visual Studio 2013 [project with C# source code](https://go.microsoft.com/fwlink/?LinkID=389434&clcid=0x409) is available to accompany this tutorial series.</span></span>

<span data-ttu-id="6a25e-108">V tomto kurzu se dozvíte, jak upravit ukázkovou aplikaci Wingtip Toys, která zahrnuje autorizaci, registraci a platbu uživatelů pomocí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-108">This tutorial describes how to modify the Wingtip Toys sample application to include user authorization, registration, and payment using PayPal.</span></span> <span data-ttu-id="6a25e-109">K nákupu produktů budou mít autorizaci jenom uživatelé, kteří jsou přihlášení.</span><span class="sxs-lookup"><span data-stu-id="6a25e-109">Only users who are logged in will have authorization to purchase products.</span></span> <span data-ttu-id="6a25e-110">Integrovaná funkce registrace uživatele šablony projektu ASP.NET 4,5 již obsahuje mnoho toho, co potřebujete.</span><span class="sxs-lookup"><span data-stu-id="6a25e-110">The ASP.NET 4.5 Web Forms project template's built-in user registration functionality already includes much of what you need.</span></span> <span data-ttu-id="6a25e-111">Přidáte funkci pro rezervaci služby PayPal Express.</span><span class="sxs-lookup"><span data-stu-id="6a25e-111">You will add PayPal Express Checkout functionality.</span></span> <span data-ttu-id="6a25e-112">V tomto kurzu používáte testovací prostředí pro vývojáře PayPal, takže se nepřesunou žádné skutečné prostředky.</span><span class="sxs-lookup"><span data-stu-id="6a25e-112">In this tutorial you be using the PayPal developer testing environment, so no actual funds will be transferred.</span></span> <span data-ttu-id="6a25e-113">Na konci kurzu aplikaci otestujete tak, že vyberete produkty, které chcete přidat do nákupního košíku, kliknete na tlačítko rezervovat a přesunete data na web služby PayPal testování.</span><span class="sxs-lookup"><span data-stu-id="6a25e-113">At the end of the tutorial, you will test the application by selecting products to add to the shopping cart, clicking the checkout button, and transferring data to the PayPal testing web site.</span></span> <span data-ttu-id="6a25e-114">Na webu služby PayPal testování si potvrdíte informace o expedici a platbách a pak se vrátíte do místní ukázkové aplikace Wingtip Toys, abyste mohli potvrdit a dokončit nákup.</span><span class="sxs-lookup"><span data-stu-id="6a25e-114">On the PayPal testing web site, you will confirm your shipping and payment information and then return to the local Wingtip Toys sample application to confirm and complete the purchase.</span></span>

<span data-ttu-id="6a25e-115">Existuje několik zkušených platebních procesorů třetích stran, které se specializují na Online nákupy, které řeší škálovatelnost a zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="6a25e-115">There are several experienced third-party payment processors that specialize in online shopping that address scalability and security.</span></span> <span data-ttu-id="6a25e-116">Vývojáři ASP.NET by měli zvážit výhody využívání řešení pro platby třetí strany před implementací řešení nákupu a nákupu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-116">ASP.NET developers should consider the advantages of utilizing a third party payment solution before implementing a shopping and purchasing solution.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="6a25e-117">Ukázková aplikace Wingtip Toys byla navržena tak, aby zobrazovala konkrétní koncepty a funkce ASP.NET, které jsou k dispozici pro webové vývojáře ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="6a25e-117">The Wingtip Toys sample application was designed to shown specific ASP.NET concepts and features available to ASP.NET web developers.</span></span> <span data-ttu-id="6a25e-118">Tato ukázková aplikace nebyla optimalizována pro všechny možné situace v souvislosti s škálovatelností a zabezpečením.</span><span class="sxs-lookup"><span data-stu-id="6a25e-118">This sample application was not optimized for all possible circumstances in regard to scalability and security.</span></span>

## <a name="what-youll-learn"></a><span data-ttu-id="6a25e-119">Co se naučíte:</span><span class="sxs-lookup"><span data-stu-id="6a25e-119">What you'll learn:</span></span>

- <span data-ttu-id="6a25e-120">Omezení přístupu ke konkrétním stránkám ve složce.</span><span class="sxs-lookup"><span data-stu-id="6a25e-120">How to restrict access to specific pages in a folder.</span></span>
- <span data-ttu-id="6a25e-121">Jak vytvořit známý nákupní košík z anonymního nákupního košíku</span><span class="sxs-lookup"><span data-stu-id="6a25e-121">How to create a known shopping cart from an anonymous shopping cart.</span></span>
- <span data-ttu-id="6a25e-122">Jak povolit protokol SSL pro projekt.</span><span class="sxs-lookup"><span data-stu-id="6a25e-122">How to enable SSL for the project.</span></span>
- <span data-ttu-id="6a25e-123">Postup přidání poskytovatele OAuth do projektu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-123">How to add an OAuth provider to the project.</span></span>
- <span data-ttu-id="6a25e-124">Jak používat PayPal k nákupu produktů pomocí testovacího prostředí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-124">How to use PayPal to purchase products using the PayPal testing environment.</span></span>
- <span data-ttu-id="6a25e-125">Jak zobrazit podrobnosti z PayPal v ovládacím prvku **DetailsView** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-125">How to display details from PayPal in a **DetailsView** control.</span></span>
- <span data-ttu-id="6a25e-126">Postup aktualizace databáze aplikace Wingtip Toys s podrobnostmi získanými z PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-126">How to update the database of the Wingtip Toys application with details obtained from PayPal.</span></span>

## <a name="adding-order-tracking"></a><span data-ttu-id="6a25e-127">Přidání sledování objednávky</span><span class="sxs-lookup"><span data-stu-id="6a25e-127">Adding Order Tracking</span></span>

<span data-ttu-id="6a25e-128">V tomto kurzu vytvoříte dvě nové třídy, abyste mohli sledovat data z objednávky, kterou uživatel vytvořil.</span><span class="sxs-lookup"><span data-stu-id="6a25e-128">In this tutorial, you'll create two new classes to track data from the order a user has created.</span></span> <span data-ttu-id="6a25e-129">Třídy budou sledovat data o dodávkách, celkovém nákupu a potvrzení platby.</span><span class="sxs-lookup"><span data-stu-id="6a25e-129">The classes will track data regarding shipping information, purchase total, and payment confirmation.</span></span>

### <a name="add-the-order-and-orderdetail-model-classes"></a><span data-ttu-id="6a25e-130">Přidání tříd modelu Order a OrderDetail</span><span class="sxs-lookup"><span data-stu-id="6a25e-130">Add the Order and OrderDetail Model Classes</span></span>

<span data-ttu-id="6a25e-131">Dříve v této sérii kurzů jste definovali schéma pro kategorie, produkty a položky nákupních košíků tím, že ve složce *modely* vytvoříte `Category`, `Product`a třídy `CartItem`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-131">Earlier in this tutorial series, you defined the schema for categories, products, and shopping cart items by creating the `Category`, `Product`, and `CartItem` classes in the *Models* folder.</span></span> <span data-ttu-id="6a25e-132">Nyní přidáte dvě nové třídy pro definování schématu pro pořadí produktů a podrobnosti objednávky.</span><span class="sxs-lookup"><span data-stu-id="6a25e-132">Now you will add two new classes to define the schema for the product order and the details of the order.</span></span>

1. <span data-ttu-id="6a25e-133">Ve složce **modely** přidejte novou třídu s názvem *Order.cs*.</span><span class="sxs-lookup"><span data-stu-id="6a25e-133">In the **Models** folder, add a new class named *Order.cs*.</span></span>   
   <span data-ttu-id="6a25e-134">V editoru se zobrazí nový soubor třídy.</span><span class="sxs-lookup"><span data-stu-id="6a25e-134">The new class file is displayed in the editor.</span></span>
2. <span data-ttu-id="6a25e-135">Výchozí kód nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-135">Replace the default code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample1.cs)]
3. <span data-ttu-id="6a25e-136">Do složky *modely* přidejte třídu *OrderDetail.cs* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-136">Add an *OrderDetail.cs* class to the *Models* folder.</span></span>
4. <span data-ttu-id="6a25e-137">Nahraďte výchozí kód následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-137">Replace the default code with the following code:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample2.cs)]

<span data-ttu-id="6a25e-138">Třídy `Order` a `OrderDetail` obsahují schéma pro definování informací o objednávce používané k nákupu a expedici.</span><span class="sxs-lookup"><span data-stu-id="6a25e-138">The `Order` and `OrderDetail` classes contain the schema to define the order information used for purchasing and shipping.</span></span>

<span data-ttu-id="6a25e-139">Kromě toho budete muset aktualizovat třídu kontextu databáze, která spravuje třídy entit a který poskytuje přístup k datům databáze.</span><span class="sxs-lookup"><span data-stu-id="6a25e-139">In addition, you will need to update the database context class that manages the entity classes and that provides data access to the database.</span></span> <span data-ttu-id="6a25e-140">K tomu přidáte nově vytvořenou objednávku a `OrderDetail` třídy modelu do `ProductContext` třídy.</span><span class="sxs-lookup"><span data-stu-id="6a25e-140">To do this, you will add the newly created Order and `OrderDetail` model classes to `ProductContext` class.</span></span>

1. <span data-ttu-id="6a25e-141">V **Průzkumník řešení**vyhledejte a otevřete soubor *ProductContext.cs* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-141">In **Solution Explorer**, find and open the *ProductContext.cs* file.</span></span>
2. <span data-ttu-id="6a25e-142">Přidejte zvýrazněný kód do souboru *ProductContext.cs* , jak je znázorněno níže:</span><span class="sxs-lookup"><span data-stu-id="6a25e-142">Add the highlighted code to the *ProductContext.cs* file as shown below:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample3.cs?highlight=14-15)]

<span data-ttu-id="6a25e-143">Jak bylo zmíněno dříve v této sérii kurzů, kód v souboru *ProductContext.cs* přidá obor názvů `System.Data.Entity`, abyste měli přístup ke všem základním funkcím Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="6a25e-143">As mentioned previously in this tutorial series, the code in the *ProductContext.cs* file adds the `System.Data.Entity` namespace so that you have access to all the core functionality of the Entity Framework.</span></span> <span data-ttu-id="6a25e-144">Tato funkce zahrnuje možnost dotazování, vkládání, aktualizaci a odstraňování dat pomocí objektů se silnými typy.</span><span class="sxs-lookup"><span data-stu-id="6a25e-144">This functionality includes the capability to query, insert, update, and delete data by working with strongly typed objects.</span></span> <span data-ttu-id="6a25e-145">Výše uvedený kód ve třídě `ProductContext` přidává Entity Framework přístup k nově přidaným třídám `Order` a `OrderDetail`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-145">The above code in the `ProductContext` class adds Entity Framework access to the newly added `Order` and `OrderDetail` classes.</span></span>

## <a name="adding-checkout-access"></a><span data-ttu-id="6a25e-146">Přidávání přístupu k registraci</span><span class="sxs-lookup"><span data-stu-id="6a25e-146">Adding Checkout Access</span></span>

<span data-ttu-id="6a25e-147">Ukázková aplikace Wingtip Toys umožňuje anonymním uživatelům kontrolovat a přidávat produkty do nákupního košíku.</span><span class="sxs-lookup"><span data-stu-id="6a25e-147">The Wingtip Toys sample application allows anonymous users to review and add products to a shopping cart.</span></span> <span data-ttu-id="6a25e-148">Pokud se však anonymní uživatelé rozhodnou koupit produkty přidané do nákupního košíku, musí se přihlásit k webu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-148">However, when anonymous users choose to purchase the products they added to the shopping cart, they must log on to the site.</span></span> <span data-ttu-id="6a25e-149">Jakmile se přihlásí, budou mít přístup ke stránkám s omezeným přístupem webové aplikace, která bude zpracovávat proces registrace a nákupu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-149">Once they have logged on, they can access the restricted pages of the Web application that handle the checkout and purchase process.</span></span> <span data-ttu-id="6a25e-150">Tyto stránky s omezeným přístupem jsou obsaženy ve složce pro *rezervaci* aplikace.</span><span class="sxs-lookup"><span data-stu-id="6a25e-150">These restricted pages are contained in the *Checkout* folder of the application.</span></span>

### <a name="add-a-checkout-folder-and-pages"></a><span data-ttu-id="6a25e-151">Přidat složku a stránky rezervace</span><span class="sxs-lookup"><span data-stu-id="6a25e-151">Add a Checkout Folder and Pages</span></span>

<span data-ttu-id="6a25e-152">Nyní vytvoříte složku pro *rezervaci* a stránky, které bude zákazník uvidí během procesu registrace.</span><span class="sxs-lookup"><span data-stu-id="6a25e-152">You will now create the *Checkout* folder and the pages in it that the customer will see during the checkout process.</span></span> <span data-ttu-id="6a25e-153">Tyto stránky budete aktualizovat později v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-153">You will update these pages later in this tutorial.</span></span>

1. <span data-ttu-id="6a25e-154">V **Průzkumník řešení** klikněte pravým tlačítkem myši na název projektu (**Wingtip Toys**) a vyberte **Přidat novou složku**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-154">Right-click the project name (**Wingtip Toys**) in **Solution Explorer** and select **Add a New Folder**.</span></span> 

    ![Rezervace a platba pomocí služby PayPal – nová složka](checkout-and-payment-with-paypal/_static/image1.png)
2. <span data-ttu-id="6a25e-156">Pojmenujte novou *složku.*</span><span class="sxs-lookup"><span data-stu-id="6a25e-156">Name the new folder *Checkout*.</span></span>
3. <span data-ttu-id="6a25e-157">Klikněte pravým tlačítkem na složku *rezervace* a pak vyberte **Přidat**-&gt;**Nová položka**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-157">Right-click the *Checkout* folder and then select **Add**-&gt;**New Item**.</span></span> 

    ![Rezervace a platby pomocí služby PayPal – nová položka](checkout-and-payment-with-paypal/_static/image2.png)
4. <span data-ttu-id="6a25e-159">Zobrazí se dialogové okno **Přidat novou položku** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-159">The **Add New Item** dialog box is displayed.</span></span>
5. <span data-ttu-id="6a25e-160">Na levé straně vyberte skupinu **Visual C#**  -&gt; **Web** Templates.</span><span class="sxs-lookup"><span data-stu-id="6a25e-160">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="6a25e-161">Pak v prostředním podokně vyberte **webový formulář se stránkou předloha**a pojmenujte ho *CheckoutStart. aspx*.</span><span class="sxs-lookup"><span data-stu-id="6a25e-161">Then, from the middle pane, select **Web Form with Master Page**and name it *CheckoutStart.aspx*.</span></span> 

    ![Registrace a platby pomocí PayPal – dialogové okno Přidat novou položku](checkout-and-payment-with-paypal/_static/image3.png)
6. <span data-ttu-id="6a25e-163">Stejně jako dřív vyberte soubor *Web. Master* jako stránku předlohy.</span><span class="sxs-lookup"><span data-stu-id="6a25e-163">As before, select the *Site.Master* file as the master page.</span></span>
7. <span data-ttu-id="6a25e-164">Přidejte následující další stránky do složky *rezervací* pomocí výše uvedených kroků:</span><span class="sxs-lookup"><span data-stu-id="6a25e-164">Add the following additional pages to the *Checkout* folder using the same steps above:</span></span>   

    - <span data-ttu-id="6a25e-165">CheckoutReview. aspx</span><span class="sxs-lookup"><span data-stu-id="6a25e-165">CheckoutReview.aspx</span></span>
    - <span data-ttu-id="6a25e-166">CheckoutComplete. aspx</span><span class="sxs-lookup"><span data-stu-id="6a25e-166">CheckoutComplete.aspx</span></span>
    - <span data-ttu-id="6a25e-167">CheckoutCancel. aspx</span><span class="sxs-lookup"><span data-stu-id="6a25e-167">CheckoutCancel.aspx</span></span>
    - <span data-ttu-id="6a25e-168">CheckoutError. aspx</span><span class="sxs-lookup"><span data-stu-id="6a25e-168">CheckoutError.aspx</span></span>

### <a name="add-a-webconfig-file"></a><span data-ttu-id="6a25e-169">Přidat soubor Web. config</span><span class="sxs-lookup"><span data-stu-id="6a25e-169">Add a Web.config File</span></span>

<span data-ttu-id="6a25e-170">Přidáním nového souboru *Web. config* do složky pro *rezervaci* budete moci omezit přístup ke všem stránkám obsaženým ve složce.</span><span class="sxs-lookup"><span data-stu-id="6a25e-170">By adding a new *Web.config* file to the *Checkout* folder, you will be able to restrict access to all the pages contained in the folder.</span></span>

1. <span data-ttu-id="6a25e-171">Klikněte pravým tlačítkem na složku *rezervace* a vyberte **Přidat** -&gt; **Nová položka**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-171">Right-click the *Checkout* folder and select **Add** -&gt; **New Item**.</span></span>  
   <span data-ttu-id="6a25e-172">Zobrazí se dialogové okno **Přidat novou položku** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-172">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="6a25e-173">Na levé straně vyberte skupinu **Visual C#**  -&gt; **Web** Templates.</span><span class="sxs-lookup"><span data-stu-id="6a25e-173">Select the **Visual C#** -&gt; **Web** templates group on the left.</span></span> <span data-ttu-id="6a25e-174">Pak v prostředním podokně vyberte **soubor webové konfigurace**, přijměte výchozí název souboru *Web. config*a pak vyberte **Přidat**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-174">Then, from the middle pane, select **Web Configuration File**, accept the default name of *Web.config*, and then select **Add**.</span></span>
3. <span data-ttu-id="6a25e-175">Nahraďte existující obsah XML v souboru *Web. config* následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-175">Replace the existing XML content in the *Web.config* file with the following:</span></span>  

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample4.xml)]
4. <span data-ttu-id="6a25e-176">Uložte soubor *Web. config* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-176">Save the *Web.config* file.</span></span>

<span data-ttu-id="6a25e-177">Soubor *Web. config* určuje, že všem neznámým uživatelům webové aplikace musí být odepřen přístup ke stránkám obsaženým ve složce pro *rezervaci* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-177">The *Web.config* file specifies that all unknown users of the Web application must be denied access to the pages contained in the *Checkout* folder.</span></span> <span data-ttu-id="6a25e-178">Pokud ale uživatel zaregistroval účet a je přihlášený, bude se jednat o známého uživatele a bude mít přístup ke stránkám ve složce pro *rezervaci* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-178">However, if the user has registered an account and is logged on, they will be a known user and will have access to the pages in the *Checkout* folder.</span></span>

<span data-ttu-id="6a25e-179">Je důležité si uvědomit, že konfigurace ASP.NET se řídí hierarchií, kde každý soubor *Web. config* aplikuje konfigurační nastavení do složky, ve které se nachází, a do všech podřízených adresářů pod ním.</span><span class="sxs-lookup"><span data-stu-id="6a25e-179">It's important to note that ASP.NET configuration follows a hierarchy, where each *Web.config* file applies configuration settings to the folder that it is in and to all of the child directories below it.</span></span>

<a id="SSLWebForms"></a>
## <a name="enable-ssl-for-the-project"></a><span data-ttu-id="6a25e-180">Povolit SSL pro projekt</span><span class="sxs-lookup"><span data-stu-id="6a25e-180">Enable SSL for the Project</span></span>

 <span data-ttu-id="6a25e-181">SSL (Secure Sockets Layer) (SSL) je protokol určený k tomu, aby webové servery a webové klienty komunikovaly bezpečněji pomocí šifrování.</span><span class="sxs-lookup"><span data-stu-id="6a25e-181">Secure Sockets Layer (SSL) is a protocol defined to allow Web servers and Web clients to communicate more securely through the use of encryption.</span></span> <span data-ttu-id="6a25e-182">Pokud se SSL nepoužívá, data odesílaná mezi klientem a serverem se otevřou pro monitorování paketů kýmkoli, kdo s fyzickým přístupem k síti.</span><span class="sxs-lookup"><span data-stu-id="6a25e-182">When SSL is not used, data sent between the client and server is open to packet sniffing by anyone with physical access to the network.</span></span> <span data-ttu-id="6a25e-183">Kromě toho několik běžných schémat ověřování není v případě obyčejného protokolu HTTP zabezpečené.</span><span class="sxs-lookup"><span data-stu-id="6a25e-183">Additionally, several common authentication schemes are not secure over plain HTTP.</span></span> <span data-ttu-id="6a25e-184">Konkrétně základní ověřování a ověřování formulářů odesílají nezašifrované přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="6a25e-184">In particular, Basic authentication and forms authentication send unencrypted credentials.</span></span> <span data-ttu-id="6a25e-185">Aby bylo zajištěno zabezpečení, musí tato schémata ověřování používat protokol SSL.</span><span class="sxs-lookup"><span data-stu-id="6a25e-185">To be secure, these authentication schemes must use SSL.</span></span> 

1. <span data-ttu-id="6a25e-186">V **Průzkumník řešení**klikněte na projekt **WingtipToys** a stisknutím klávesy **F4** zobrazte okno **vlastnosti** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-186">In **Solution Explorer**, click the **WingtipToys** project, then press **F4** to display the **Properties** window.</span></span>
2. <span data-ttu-id="6a25e-187">Změňte **povolený protokol SSL** na `true`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-187">Change **SSL Enabled** to `true`.</span></span>
3. <span data-ttu-id="6a25e-188">Zkopírujte **adresu URL SSL** , abyste ji mohli později použít.</span><span class="sxs-lookup"><span data-stu-id="6a25e-188">Copy the **SSL URL** so you can use it later.</span></span>   
 <span data-ttu-id="6a25e-189">Adresa URL protokolu SSL bude `https://localhost:44300/`, pokud jste dříve nevytvořili weby SSL (jak je vidět níže).</span><span class="sxs-lookup"><span data-stu-id="6a25e-189">The SSL URL will be `https://localhost:44300/` unless you've previously created SSL Web Sites (as shown below).</span></span>   
    <span data-ttu-id="6a25e-190">![Vlastnosti projektu](checkout-and-payment-with-paypal/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="6a25e-190">![Project Properties](checkout-and-payment-with-paypal/_static/image4.png)</span></span>
4. <span data-ttu-id="6a25e-191">V **Průzkumník řešení**klikněte pravým tlačítkem na projekt **WingtipToys** a klikněte na **vlastnosti**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-191">In **Solution Explorer**, right click the **WingtipToys** project and click **Properties**.</span></span>
5. <span data-ttu-id="6a25e-192">Na levé kartě klikněte na **Web**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-192">In the left tab, click **Web**.</span></span>
6. <span data-ttu-id="6a25e-193">Změňte **adresu URL projektu** tak, aby používala **adresu URL SSL** , kterou jste předtím uložili.</span><span class="sxs-lookup"><span data-stu-id="6a25e-193">Change the **Project Url** to use the **SSL URL** that you saved earlier.</span></span>   
    <span data-ttu-id="6a25e-194">](checkout-and-payment-with-paypal/_static/image5.png) ![Project Web Properties</span><span class="sxs-lookup"><span data-stu-id="6a25e-194">![Project Web Properties](checkout-and-payment-with-paypal/_static/image5.png)</span></span>
7. <span data-ttu-id="6a25e-195">Uložte stránku stisknutím **kombinace kláves CTRL + S**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-195">Save the page by pressing **CTRL+S**.</span></span>
8. <span data-ttu-id="6a25e-196">Stisknutím **kombinace kláves CTRL + F5** spusťte aplikaci.</span><span class="sxs-lookup"><span data-stu-id="6a25e-196">Press **Ctrl+F5** to run the application.</span></span> <span data-ttu-id="6a25e-197">Visual Studio zobrazí možnost, která vám umožní vyhnout se upozornění SSL.</span><span class="sxs-lookup"><span data-stu-id="6a25e-197">Visual Studio will display an option to allow you to avoid SSL warnings.</span></span>
9. <span data-ttu-id="6a25e-198">Kliknutím na **Ano** důvěřujete IIS Express certifikátu SSL a pokračujte.</span><span class="sxs-lookup"><span data-stu-id="6a25e-198">Click **Yes** to trust the IIS Express SSL certificate and continue.</span></span>   
    <span data-ttu-id="6a25e-199">podrobnosti certifikátu ![IIS Express SSL](checkout-and-payment-with-paypal/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="6a25e-199">![IIS Express SSL certificate details](checkout-and-payment-with-paypal/_static/image6.png)</span></span>  
 <span data-ttu-id="6a25e-200">Zobrazí se upozornění zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="6a25e-200">A Security Warning is displayed.</span></span>
10. <span data-ttu-id="6a25e-201">Kliknutím na **Ano** nainstalujte certifikát pro místního hostitele.</span><span class="sxs-lookup"><span data-stu-id="6a25e-201">Click **Yes** to install the certificate to your localhost.</span></span>   
    <span data-ttu-id="6a25e-202">Dialogové okno upozornění zabezpečení ![](checkout-and-payment-with-paypal/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="6a25e-202">![Security Warning dialog box](checkout-and-payment-with-paypal/_static/image7.png)</span></span>  
 <span data-ttu-id="6a25e-203">Zobrazí se okno prohlížeče.</span><span class="sxs-lookup"><span data-stu-id="6a25e-203">The browser window will be displayed.</span></span>

<span data-ttu-id="6a25e-204">Webovou aplikaci teď můžete snadno testovat v místním prostředí pomocí protokolu SSL.</span><span class="sxs-lookup"><span data-stu-id="6a25e-204">You can now easily test your Web application locally using SSL.</span></span>

<a id="OAuthWebForms"></a>
## <a name="add-an-oauth-20-provider"></a><span data-ttu-id="6a25e-205">Přidat poskytovatele OAuth 2,0</span><span class="sxs-lookup"><span data-stu-id="6a25e-205">Add an OAuth 2.0 Provider</span></span>

<span data-ttu-id="6a25e-206">Webové formuláře ASP.NET poskytují rozšířené možnosti pro členství a ověřování.</span><span class="sxs-lookup"><span data-stu-id="6a25e-206">ASP.NET Web Forms provides enhanced options for membership and authentication.</span></span> <span data-ttu-id="6a25e-207">Mezi tato vylepšení patří OAuth.</span><span class="sxs-lookup"><span data-stu-id="6a25e-207">These enhancements include OAuth.</span></span> <span data-ttu-id="6a25e-208">OAuth je otevřený protokol, který umožňuje zabezpečenou autorizaci v jednoduché a standardní metodě z webových, mobilních a desktopových aplikací.</span><span class="sxs-lookup"><span data-stu-id="6a25e-208">OAuth is an open protocol that allows secure authorization in a simple and standard method from web, mobile, and desktop applications.</span></span> <span data-ttu-id="6a25e-209">Šablona webových formulářů ASP.NET používá OAuth k vystavování služeb Facebook, Twitter, Google a Microsoft jako poskytovatele ověřování.</span><span class="sxs-lookup"><span data-stu-id="6a25e-209">The ASP.NET Web Forms template uses OAuth to expose Facebook, Twitter, Google and Microsoft as authentication providers.</span></span> <span data-ttu-id="6a25e-210">I když tento kurz používá pouze Google jako poskytovatele ověřování, můžete kód snadno upravit, aby používal kteréhokoli poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="6a25e-210">Although this tutorial uses only Google as the authentication provider, you can easily modify the code to use any of the providers.</span></span> <span data-ttu-id="6a25e-211">Postup implementace jiných zprostředkovatelů se podobá postupům, které se v tomto kurzu zobrazí.</span><span class="sxs-lookup"><span data-stu-id="6a25e-211">The steps to implement other providers are very similar to the steps you will see in this tutorial.</span></span>

<span data-ttu-id="6a25e-212">Kromě ověřování bude kurz používat taky role k implementaci autorizace.</span><span class="sxs-lookup"><span data-stu-id="6a25e-212">In addition to authentication, the tutorial will also use roles to implement authorization.</span></span> <span data-ttu-id="6a25e-213">Pouze uživatelé, které přidáte do role `canEdit`, budou moci měnit data (kontakty vytvořit, upravit nebo odstranit).</span><span class="sxs-lookup"><span data-stu-id="6a25e-213">Only those users you add to the `canEdit` role will be able to change data (create, edit, or delete contacts).</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="6a25e-214">Aplikace pro Windows Live přijímají pro pracovní web pouze živou adresu URL, takže pro testování přihlašovacích údajů nemůžete použít adresu URL místního webu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-214">Windows Live applications only accept a live URL for a working website, so you cannot use a local website URL for testing logins.</span></span>

<span data-ttu-id="6a25e-215">Následující postup vám umožní přidat poskytovatele ověřování Google.</span><span class="sxs-lookup"><span data-stu-id="6a25e-215">The following steps will allow you to add a Google authentication provider.</span></span>

1. <span data-ttu-id="6a25e-216">Otevřete soubor *App\_Start\Startup.auth.cs* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-216">Open the *App\_Start\Startup.Auth.cs* file.</span></span>
2. <span data-ttu-id="6a25e-217">Odeberte znaky komentáře z metody `app.UseGoogleAuthentication()` tak, aby se metoda zobrazila takto:</span><span class="sxs-lookup"><span data-stu-id="6a25e-217">Remove the comment characters from the `app.UseGoogleAuthentication()` method so that the method appears as follows:</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample5.cs)]
3. <span data-ttu-id="6a25e-218">Přejděte do [konzoly pro vývojáře Google](https://console.developers.google.com/).</span><span class="sxs-lookup"><span data-stu-id="6a25e-218">Navigate to the [Google Developers Console](https://console.developers.google.com/).</span></span> <span data-ttu-id="6a25e-219">Budete také muset přihlásit se pomocí e-mailového účtu pro vývojáře Google (gmail.com).</span><span class="sxs-lookup"><span data-stu-id="6a25e-219">You will also need to sign-in with your Google developer email account (gmail.com).</span></span> <span data-ttu-id="6a25e-220">Pokud nemáte účet Google, vyberte odkaz **vytvořit účet** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-220">If you do not have a Google account, select the **Create an account** link.</span></span>   
   <span data-ttu-id="6a25e-221">V dalším kroku uvidíte **konzolu pro vývojáře Google**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-221">Next, you'll see the **Google Developers Console**.</span></span>   
    <span data-ttu-id="6a25e-222">![konzole pro vývojáře Google](checkout-and-payment-with-paypal/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="6a25e-222">![Google Developers Console](checkout-and-payment-with-paypal/_static/image8.png)</span></span>
4. <span data-ttu-id="6a25e-223">Klikněte na tlačítko **vytvořit projekt** a zadejte název projektu a ID (můžete použít výchozí hodnoty).</span><span class="sxs-lookup"><span data-stu-id="6a25e-223">Click the **Create Project** button and enter a project name and ID (you can use the default values).</span></span> <span data-ttu-id="6a25e-224">Pak klikněte na **zaškrtávací políčko smlouva** a tlačítko **vytvořit** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-224">Then, click the **agreement checkbox** and the **Create** button.</span></span>  

    ![Google – nový projekt](checkout-and-payment-with-paypal/_static/image9.png)

   <span data-ttu-id="6a25e-226">Během několika sekund se vytvoří nový projekt a v prohlížeči se zobrazí stránka nové projekty.</span><span class="sxs-lookup"><span data-stu-id="6a25e-226">In a few seconds the new project will be created and your browser will display the new projects page.</span></span>
5. <span data-ttu-id="6a25e-227">Na levé kartě klikněte na **rozhraní api &amp; auth**a pak klikněte na **přihlašovací údaje**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-227">In the left tab, click **APIs &amp; auth**, and then click **Credentials**.</span></span>
6. <span data-ttu-id="6a25e-228">V části **OAuth**klikněte na **vytvořit nové ID klienta** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-228">Click the **Create New Client ID** under **OAuth**.</span></span>   
   <span data-ttu-id="6a25e-229">Zobrazí se dialogové okno **vytvořit ID klienta** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-229">The **Create Client ID** dialog will be displayed.</span></span>   
    <span data-ttu-id="6a25e-230">![ID klienta pro Google-Create](checkout-and-payment-with-paypal/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="6a25e-230">![Google - Create Client ID](checkout-and-payment-with-paypal/_static/image10.png)</span></span>
7. <span data-ttu-id="6a25e-231">V dialogovém okně **vytvořit ID klienta** ponechte výchozí **webovou aplikaci** pro typ aplikace.</span><span class="sxs-lookup"><span data-stu-id="6a25e-231">In the **Create Client ID** dialog, keep the default **Web application** for the application type.</span></span>
8. <span data-ttu-id="6a25e-232">Nastavte **autorizované zdroje JavaScriptu** na adresu URL SSL, kterou jste použili dříve v tomto kurzu (`https://localhost:44300/`, pokud jste nevytvořili jiné projekty SSL).</span><span class="sxs-lookup"><span data-stu-id="6a25e-232">Set the **Authorized JavaScript Origins** to the SSL URL you used earlier in this tutorial (`https://localhost:44300/` unless you've created other SSL projects).</span></span>   
   <span data-ttu-id="6a25e-233">Tato adresa URL je zdrojem vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="6a25e-233">This URL is the origin for your application.</span></span> <span data-ttu-id="6a25e-234">V této ukázce budete zadávat jenom adresu URL testu localhost.</span><span class="sxs-lookup"><span data-stu-id="6a25e-234">For this sample, you will only enter the localhost test URL.</span></span> <span data-ttu-id="6a25e-235">Můžete ale zadat více adres URL pro místní localhost a produkční prostředí.</span><span class="sxs-lookup"><span data-stu-id="6a25e-235">However, you can enter multiple URLs to account for localhost and production.</span></span>
9. <span data-ttu-id="6a25e-236">Nastavte **autorizovaný identifikátor URI přesměrování** na následující:</span><span class="sxs-lookup"><span data-stu-id="6a25e-236">Set the **Authorized Redirect URI** to the following:</span></span> 

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample6.html)]

   <span data-ttu-id="6a25e-237">Tato hodnota je identifikátor URI, který ASP.NET uživatele OAuth ke komunikaci se serverem Google OAuth.</span><span class="sxs-lookup"><span data-stu-id="6a25e-237">This value is the URI that ASP.NET OAuth users to communicate with the google OAuth server.</span></span> <span data-ttu-id="6a25e-238">Zapamatujte si adresu URL SSL, kterou jste použili výše (`https://localhost:44300/`, pokud jste nevytvořili jiné projekty SSL).</span><span class="sxs-lookup"><span data-stu-id="6a25e-238">Remember the SSL URL you used above (    `https://localhost:44300/` unless you've created other SSL projects).</span></span>
10. <span data-ttu-id="6a25e-239">Klikněte na tlačítko **vytvořit ID klienta** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-239">Click the **Create Client ID** button.</span></span>
11. <span data-ttu-id="6a25e-240">V nabídce vlevo v konzole pro vývojáře Google klikněte na položku nabídky **obrazovka pro vyjádření souhlasu** a pak nastavte svou e-mailovou adresu a název produktu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-240">On the left menu of the Google Developers Console, click the **Consent screen** menu item, then set your email address and product name.</span></span> <span data-ttu-id="6a25e-241">Po vyplnění formuláře klikněte na **Uložit**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-241">When you have completed the form, click **Save**.</span></span>
12. <span data-ttu-id="6a25e-242">Klikněte na položku nabídky **rozhraní API** , přejděte dolů a klikněte na tlačítko **vypnout** vedle položky **Google + rozhraní API**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-242">Click the **APIs** menu item, scroll down and click the **off** button next to **Google+ API**.</span></span>   
    <span data-ttu-id="6a25e-243">Přijetím této možnosti povolíte rozhraní Google + API.</span><span class="sxs-lookup"><span data-stu-id="6a25e-243">Accepting this option will enable the Google+ API.</span></span>
13. <span data-ttu-id="6a25e-244">Také je nutné aktualizovat balíček NuGet **Microsoft. Owin** na verzi 3.0.0.</span><span class="sxs-lookup"><span data-stu-id="6a25e-244">You must also update the **Microsoft.Owin** NuGet package to version 3.0.0.</span></span>   
    <span data-ttu-id="6a25e-245">V nabídce **nástroje** vyberte **Správce balíčků NuGet** a pak vyberte **Spravovat balíčky NuGet pro řešení**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-245">From the **Tools** menu, select **NuGet Package Manager** and then select **Manage NuGet Packages for Solution**.</span></span>  
    <span data-ttu-id="6a25e-246">V okně **Spravovat balíčky NuGet** vyhledejte a aktualizujte balíček **Microsoft. Owin** na verzi 3.0.0.</span><span class="sxs-lookup"><span data-stu-id="6a25e-246">From the **Manage NuGet Packages** window, find and update the **Microsoft.Owin** package to version 3.0.0.</span></span>
14. <span data-ttu-id="6a25e-247">V aplikaci Visual Studio aktualizujte metodu `UseGoogleAuthentication` stránky *Startup.auth.cs* zkopírováním a vložením **ID klienta** a **tajného klíče klienta** do metody.</span><span class="sxs-lookup"><span data-stu-id="6a25e-247">In Visual Studio, update the `UseGoogleAuthentication` method of the *Startup.Auth.cs* page by copying and pasting the **Client ID** and **Client Secret** into the method.</span></span> <span data-ttu-id="6a25e-248">Níže uvedené hodnoty **ID klienta** a **tajného klíče klienta** jsou ukázky a nebudou fungovat.</span><span class="sxs-lookup"><span data-stu-id="6a25e-248">The **Client ID** and **Client Secret** values shown below are samples and will not work.</span></span> 

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample7.cs?highlight=64-65)]
15. <span data-ttu-id="6a25e-249">Stisknutím **kombinace kláves CTRL + F5** Sestavte a spusťte aplikaci.</span><span class="sxs-lookup"><span data-stu-id="6a25e-249">Press **CTRL+F5** to build and run the application.</span></span> <span data-ttu-id="6a25e-250">Klikněte na odkaz **Přihlásit** se.</span><span class="sxs-lookup"><span data-stu-id="6a25e-250">Click the **Log in** link.</span></span>
16. <span data-ttu-id="6a25e-251">V části **použít jinou službu pro přihlášení**klikněte na **Google**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-251">Under **Use another service to log in**, click **Google**.</span></span>  
    <span data-ttu-id="6a25e-252">![přihlášení](checkout-and-payment-with-paypal/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="6a25e-252">![Log in](checkout-and-payment-with-paypal/_static/image11.png)</span></span>
17. <span data-ttu-id="6a25e-253">Pokud potřebujete zadat svoje přihlašovací údaje, budete přesměrováni na web Google, kam budete zadávat svoje přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="6a25e-253">If you need to enter your credentials, you will be redirected to the google site where you will enter your credentials.</span></span>  
    ![Google – přihlášení](checkout-and-payment-with-paypal/_static/image12.png)
18. <span data-ttu-id="6a25e-255">Po zadání přihlašovacích údajů se zobrazí výzva k udělení oprávnění k této webové aplikaci, kterou jste právě vytvořili.</span><span class="sxs-lookup"><span data-stu-id="6a25e-255">After you enter your credentials, you will be prompted to give permissions to the web application you just created.</span></span>  
    ![Výchozí účet služby projektu](checkout-and-payment-with-paypal/_static/image13.png)
19. <span data-ttu-id="6a25e-257">Klikněte na **přijmout**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-257">Click **Accept**.</span></span> <span data-ttu-id="6a25e-258">Nyní budete přesměrováni zpět na stránku **registrace** aplikace **WingtipToys** , kde můžete zaregistrovat svůj účet Google.</span><span class="sxs-lookup"><span data-stu-id="6a25e-258">You will now be redirected back to the **Register** page of the **WingtipToys** application where you can register your Google account.</span></span>  
    <span data-ttu-id="6a25e-259">Registrace ![s vaším účtem Google](checkout-and-payment-with-paypal/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="6a25e-259">![Register with your Google Account](checkout-and-payment-with-paypal/_static/image14.png)</span></span>
20. <span data-ttu-id="6a25e-260">Máte možnost změnit název místní registrace e-mailu, který se používá pro váš účet Gmail, ale obecně chcete zachovat výchozí alias e-mailu (tj. ten, který jste použili pro ověřování).</span><span class="sxs-lookup"><span data-stu-id="6a25e-260">You have the option of changing the local email registration name used for your Gmail account, but you generally want to keep the default email alias (that is, the one you used for authentication).</span></span> <span data-ttu-id="6a25e-261">Klikněte na **Přihlásit** se, jak je uvedeno výše.</span><span class="sxs-lookup"><span data-stu-id="6a25e-261">Click **Log in** as shown above.</span></span>

### <a name="modifying-login-functionality"></a><span data-ttu-id="6a25e-262">Úprava funkce přihlášení</span><span class="sxs-lookup"><span data-stu-id="6a25e-262">Modifying Login Functionality</span></span>

<span data-ttu-id="6a25e-263">Jak už jsme uvedli v této sérii kurzů, ve výchozím nastavení je většina funkcí registrace uživatelů zahrnutá v šabloně webových formulářů ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="6a25e-263">As previously mentioned in this tutorial series, much of the user registration functionality has been included in the ASP.NET Web Forms template by default.</span></span> <span data-ttu-id="6a25e-264">Nyní upravíte výchozí *přihlašovací stránky. aspx* a *Register. aspx* , které budou volat metodu `MigrateCart`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-264">Now you will modify the default *Login.aspx* and *Register.aspx* pages to call the `MigrateCart` method.</span></span> <span data-ttu-id="6a25e-265">Metoda `MigrateCart` přidruží nově přihlášeného uživatele k anonymnímu nákupnímu košíku.</span><span class="sxs-lookup"><span data-stu-id="6a25e-265">The `MigrateCart` method associates a newly logged in user with an anonymous shopping cart.</span></span> <span data-ttu-id="6a25e-266">Když přidružíte uživatele a nákupní košík, ukázková aplikace Wingtip Toys bude moct zachovat nákupní košík uživatele mezi návštěvami.</span><span class="sxs-lookup"><span data-stu-id="6a25e-266">By associating the user and shopping cart, the Wingtip Toys sample application will be able to maintain the shopping cart of the user between visits.</span></span>

1. <span data-ttu-id="6a25e-267">V **Průzkumník řešení**vyhledejte a otevřete složku *account* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-267">In **Solution Explorer**, find and open the *Account* folder.</span></span>
2. <span data-ttu-id="6a25e-268">Upravte stránku s kódem na pozadí s názvem *Login.aspx.cs* tak, aby zahrnovala kód zvýrazněný žlutě, aby se zobrazila takto:</span><span class="sxs-lookup"><span data-stu-id="6a25e-268">Modify the code-behind page named *Login.aspx.cs* to include the code highlighted in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample8.cs?highlight=41-43)]
3. <span data-ttu-id="6a25e-269">Uložte soubor *Login.aspx.cs* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-269">Save the *Login.aspx.cs* file.</span></span>

<span data-ttu-id="6a25e-270">Prozatím můžete ignorovat upozornění, že není k dispozici žádná definice pro metodu `MigrateCart`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-270">For now, you can ignore the warning that there is no definition for the `MigrateCart` method.</span></span> <span data-ttu-id="6a25e-271">Později v tomto kurzu ho budete moct přidat.</span><span class="sxs-lookup"><span data-stu-id="6a25e-271">You will be adding it a bit later in this tutorial.</span></span>

<span data-ttu-id="6a25e-272">Soubor kódu na pozadí *Login.aspx.cs* podporuje metodu Login.</span><span class="sxs-lookup"><span data-stu-id="6a25e-272">The *Login.aspx.cs* code-behind file supports a LogIn method.</span></span> <span data-ttu-id="6a25e-273">Kontrolou stránky login. aspx uvidíte, že tato stránka obsahuje "přihlášení", které po kliknutí spustí obslužnou rutinu `LogIn` pro kód na pozadí.</span><span class="sxs-lookup"><span data-stu-id="6a25e-273">By inspecting the Login.aspx page, you'll see that this page includes a "Log in" button that when click triggers the `LogIn` handler on the code-behind.</span></span>

<span data-ttu-id="6a25e-274">Při volání metody `Login` v *Login.aspx.cs* se vytvoří nová instance nákupního košíku s názvem `usersShoppingCart`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-274">When the `Login` method on the *Login.aspx.cs* is called, a new instance of the shopping cart named `usersShoppingCart` is created.</span></span> <span data-ttu-id="6a25e-275">ID nákupního košíku (GUID) je načteno a nastaveno na `cartId` proměnnou.</span><span class="sxs-lookup"><span data-stu-id="6a25e-275">The ID of the shopping cart (a GUID) is retrieved and set to the `cartId` variable.</span></span> <span data-ttu-id="6a25e-276">Pak je volána metoda `MigrateCart`, která předá do této metody předání `cartId` a jména přihlášeného uživatele.</span><span class="sxs-lookup"><span data-stu-id="6a25e-276">Then, the `MigrateCart` method is called, passing both the `cartId` and the name of the logged-in user to this method.</span></span> <span data-ttu-id="6a25e-277">Při migraci nákupního košíku se identifikátor GUID, který se používá k identifikaci anonymního nákupního košíku, nahradí uživatelským jménem.</span><span class="sxs-lookup"><span data-stu-id="6a25e-277">When the shopping cart is migrated, the GUID used to identify the anonymous shopping cart is replaced with the user name.</span></span>

<span data-ttu-id="6a25e-278">Kromě změny *Login.aspx.cs* souboru s kódem na pozadí pro migraci nákupního košíku, když se uživatel přihlásí, musíte také upravit *soubor s kódem na pozadí Register.aspx.cs* , aby se migruje nákupní košík, když uživatel vytvoří nový účet a přihlásí se.</span><span class="sxs-lookup"><span data-stu-id="6a25e-278">In addition to modifying the *Login.aspx.cs* code-behind file to migrate the shopping cart when the user logs in, you must also modify the *Register.aspx.cs code-behind file* to migrate the shopping cart when the user creates a new account and logs in.</span></span>

1. <span data-ttu-id="6a25e-279">Ve složce *account (účet* ) otevřete soubor kódu na pozadí s názvem *Register.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="6a25e-279">In the *Account* folder, open the code-behind file named *Register.aspx.cs*.</span></span>
2. <span data-ttu-id="6a25e-280">Upravte soubor kódu na pozadí tak, že kód zahrnete žlutě, takže se zobrazí takto:</span><span class="sxs-lookup"><span data-stu-id="6a25e-280">Modify the code-behind file by including the code in yellow, so that it appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample9.cs?highlight=28-32)]
3. <span data-ttu-id="6a25e-281">Uložte soubor *Register.aspx.cs* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-281">Save the *Register.aspx.cs* file.</span></span> <span data-ttu-id="6a25e-282">Znovu ignorujte upozornění na metodu `MigrateCart`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-282">Once again, ignore the warning about the `MigrateCart` method.</span></span>

<span data-ttu-id="6a25e-283">Všimněte si, že kód, který jste použili v obslužné rutině události `CreateUser_Click`, je velmi podobný kódu, který jste použili v metodě `LogIn`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-283">Notice that the code you used in the `CreateUser_Click` event handler is very similar to the code you used in the `LogIn` method.</span></span> <span data-ttu-id="6a25e-284">Když uživatel zaregistruje nebo přihlásí k lokalitě, bude provedeno volání metody `MigrateCart`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-284">When the user registers or logs in to the site, a call to the `MigrateCart` method will be made.</span></span>

## <a name="migrating-the-shopping-cart"></a><span data-ttu-id="6a25e-285">Migruje se nákupní košík.</span><span class="sxs-lookup"><span data-stu-id="6a25e-285">Migrating the Shopping Cart</span></span>

<span data-ttu-id="6a25e-286">Teď, když máte aktualizovaný proces přihlášení a registrace, můžete přidat kód pro migraci nákupního košíku pomocí metody `MigrateCart`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-286">Now that you have the log-in and registration process updated, you can add the code to migrate the shopping cart using the `MigrateCart` method.</span></span>

1. <span data-ttu-id="6a25e-287">V **Průzkumník řešení**Najděte složku *Logic* a otevřete soubor třídy *ShoppingCartActions.cs* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-287">In **Solution Explorer**, find the *Logic* folder and open the *ShoppingCartActions.cs* class file.</span></span>
2. <span data-ttu-id="6a25e-288">Přidejte kód zvýrazněný žlutě ke stávajícímu kódu v souboru *ShoppingCartActions.cs* , aby se kód v souboru *ShoppingCartActions.cs* zobrazil takto:</span><span class="sxs-lookup"><span data-stu-id="6a25e-288">Add the code highlighted in yellow to the existing code in the *ShoppingCartActions.cs* file, so that the code in the *ShoppingCartActions.cs* file appears as follows:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample10.cs?highlight=215-224)]

<span data-ttu-id="6a25e-289">Metoda `MigrateCart` používá existující cartId k nalezení nákupního košíku uživatele.</span><span class="sxs-lookup"><span data-stu-id="6a25e-289">The `MigrateCart` method uses the existing cartId to find the shopping cart of the user.</span></span> <span data-ttu-id="6a25e-290">Dále kód projde všemi položkami nákupní košíku a nahradí vlastnost `CartId` (jak je určeno schématem `CartItem`) s přihlášeným uživatelským jménem.</span><span class="sxs-lookup"><span data-stu-id="6a25e-290">Next, the code loops through all the shopping cart items and replaces the `CartId` property (as specified by the `CartItem` schema) with the logged-in user name.</span></span>

### <a name="updating-the-database-connection"></a><span data-ttu-id="6a25e-291">Aktualizuje se připojení k databázi.</span><span class="sxs-lookup"><span data-stu-id="6a25e-291">Updating the Database Connection</span></span>

<span data-ttu-id="6a25e-292">Pokud s tímto kurzem používáte **předem vytvořenou** ukázkovou aplikaci Wingtip Toys, musíte znovu vytvořit výchozí databázi členství.</span><span class="sxs-lookup"><span data-stu-id="6a25e-292">If you are following this tutorial using the **prebuilt** Wingtip Toys sample application, you must recreate the default membership database.</span></span> <span data-ttu-id="6a25e-293">Změnou výchozího připojovacího řetězce se databáze členství vytvoří při příštím spuštění aplikace.</span><span class="sxs-lookup"><span data-stu-id="6a25e-293">By modifying the default connection string, the membership database will be created the next time the application runs.</span></span>

1. <span data-ttu-id="6a25e-294">Otevřete soubor *Web. config* v kořenovém adresáři projektu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-294">Open the *Web.config* file at the root of the project.</span></span>
2. <span data-ttu-id="6a25e-295">Aktualizujte výchozí připojovací řetězec tak, aby se zobrazil následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-295">Update the default connection string so that it appears as follows:</span></span>   

    [!code-xml[Main](checkout-and-payment-with-paypal/samples/sample11.xml)]

<a id="PayPalWebForms"></a>
## <a name="integrating-paypal"></a><span data-ttu-id="6a25e-296">Integrace služby PayPal</span><span class="sxs-lookup"><span data-stu-id="6a25e-296">Integrating PayPal</span></span>

<span data-ttu-id="6a25e-297">PayPal je webová platforma pro fakturaci, která přijímá platby na základě online obchodních obchodníků.</span><span class="sxs-lookup"><span data-stu-id="6a25e-297">PayPal is a web-based billing platform that accepts payments by online merchants.</span></span> <span data-ttu-id="6a25e-298">V tomto kurzu se dozvíte, jak integrovat funkci expresního rezervace služby PayPal do vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="6a25e-298">This tutorial next explains how to integrate PayPal's Express Checkout functionality into your application.</span></span> <span data-ttu-id="6a25e-299">Expresní registrace umožňuje zákazníkům používat PayPal pro platby za položky, které přidal do svého nákupního košíku.</span><span class="sxs-lookup"><span data-stu-id="6a25e-299">Express Checkout allows your customers to use PayPal to pay for the items they have added to their shopping cart.</span></span>

### <a name="create-paypal-test-accounts"></a><span data-ttu-id="6a25e-300">Vytváření zkušebních účtů PayPal</span><span class="sxs-lookup"><span data-stu-id="6a25e-300">Create PayPal Test Accounts</span></span>

<span data-ttu-id="6a25e-301">Chcete-li použít testovací prostředí služby PayPal, je nutné vytvořit a ověřit testovací účet vývojář.</span><span class="sxs-lookup"><span data-stu-id="6a25e-301">To use the PayPal testing environment, you must create and verify a developer test account.</span></span> <span data-ttu-id="6a25e-302">K vytvoření účtu testu nákupčího a účtu testu prodávajícího budete používat účet test vývojáře.</span><span class="sxs-lookup"><span data-stu-id="6a25e-302">You will use the developer test account to create a buyer test account and a seller test account.</span></span> <span data-ttu-id="6a25e-303">Pověření k testovacímu účtu pro vývojáře také umožní ukázkové aplikaci Wingtip Toys přístup k testovacímu prostředí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-303">The developer test account credentials also will allow the Wingtip Toys sample application to access the PayPal testing environment.</span></span>

1. <span data-ttu-id="6a25e-304">V prohlížeči přejděte na web PayPal Developer Testing:</span><span class="sxs-lookup"><span data-stu-id="6a25e-304">In a browser, navigate to the PayPal developer testing site:</span></span>   
    [https://developer.paypal.com](https://developer.paypal.com/)
2. <span data-ttu-id="6a25e-305">Pokud nemáte účet vývojáře služby PayPal, vytvořte nový účet kliknutím na **zaregistrovat**a podle pokynů pro registraci.</span><span class="sxs-lookup"><span data-stu-id="6a25e-305">If you don't have a PayPal developer account, create a new account by clicking **Sign Up**and following the sign up steps.</span></span> <span data-ttu-id="6a25e-306">Pokud máte existující účet vývojáře služby PayPal, přihlaste se kliknutím na **Přihlásit se**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-306">If you have an existing PayPal developer account, sign in by clicking **Log In**.</span></span> <span data-ttu-id="6a25e-307">Později v tomto kurzu budete potřebovat vývojářský účet služby PayPal pro testování ukázkové aplikace Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="6a25e-307">You will need your PayPal developer account to test the Wingtip Toys sample application later in this tutorial.</span></span>
3. <span data-ttu-id="6a25e-308">Pokud jste se právě zaregistrovali do svého účtu vývojáře služby PayPal, možná budete muset účet pro vývojáře PayPal ověřit pomocí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-308">If you have just signed up for your PayPal developer account, you may need to verify your PayPal developer account with PayPal.</span></span> <span data-ttu-id="6a25e-309">Svůj účet můžete ověřit podle kroků, které služba PayPal poslala na váš e-mailový účet.</span><span class="sxs-lookup"><span data-stu-id="6a25e-309">You can verify your account by following the steps that PayPal sent to your email account.</span></span> <span data-ttu-id="6a25e-310">Po ověření účtu vývojáře pro vývojáře služby PayPal se znovu přihlaste k webu PayPal Developer Testing.</span><span class="sxs-lookup"><span data-stu-id="6a25e-310">Once you have verified your PayPal developer account, log back into the PayPal developer testing site.</span></span>
4. <span data-ttu-id="6a25e-311">Po přihlášení k webu pro vývojáře služby PayPal pomocí svého účtu vývojáře služby PayPal potřebujete vytvořit zkušební účet nákupčího pro účet PayPal, pokud ho ještě nemáte.</span><span class="sxs-lookup"><span data-stu-id="6a25e-311">After you are logged in to the PayPal developer site with your PayPal developer account you need to create a PayPal buyer test account if you don't already have one.</span></span> <span data-ttu-id="6a25e-312">Chcete-li vytvořit testovací účet nákupčího, klikněte na webu PayPal na kartu **aplikace** a pak klikněte na **účty izolovaného prostoru**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-312">To create a buyer test account, on the PayPal site click the **Applications** tab and then click **Sandbox accounts**.</span></span>   
 <span data-ttu-id="6a25e-313">Zobrazí se stránka **testovací účty izolovaného prostoru** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-313">The **Sandbox test accounts** page is shown.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="6a25e-314">Web pro vývojáře služby PayPal už poskytuje obchodní testovací účet.</span><span class="sxs-lookup"><span data-stu-id="6a25e-314">The PayPal Developer site already provides a merchant test account.</span></span>

    ![Rezervace a platby pomocí účtů služby PayPal – izolovaného prostoru (sandbox)](checkout-and-payment-with-paypal/_static/image15.png)
5. <span data-ttu-id="6a25e-316">Na stránce testovací účty izolovaného prostoru klikněte na **vytvořit účet**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-316">On the Sandbox test accounts page, click **Create Account**.</span></span>
6. <span data-ttu-id="6a25e-317">Na stránce **vytvořit testovací účet** zvolte e-mailový účet nákupčího a heslo podle vašeho výběru.</span><span class="sxs-lookup"><span data-stu-id="6a25e-317">On the **Create test account** page choose a buyer test account email and password of your choice.</span></span>   

    > [!NOTE] 
    > 
    > <span data-ttu-id="6a25e-318">Na konci tohoto kurzu budete potřebovat e-mailové adresy a heslo nákupčího k otestování ukázkové aplikace Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="6a25e-318">You will need the buyer email addresses and password to test the Wingtip Toys sample application at the end of this tutorial.</span></span>

    ![Rezervace a platby pomocí účtů služby PayPal – izolovaného prostoru (sandbox)](checkout-and-payment-with-paypal/_static/image16.png)
7. <span data-ttu-id="6a25e-320">Kliknutím na tlačítko **vytvořit účet** vytvořte testovací účet nákupčího.</span><span class="sxs-lookup"><span data-stu-id="6a25e-320">Create the buyer test account by clicking the **Create Account** button.</span></span>  
 <span data-ttu-id="6a25e-321">Zobrazí se stránka **testovací účty izolovaného prostoru** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-321">The **Sandbox Test accounts** page is displayed.</span></span> 

    ![Rezervace a platby pomocí účtů PayPal a PayPal](checkout-and-payment-with-paypal/_static/image17.png)
8. <span data-ttu-id="6a25e-323">Na stránce **testovací účty izolovaného prostoru** klikněte na e-mailový účet pro **usnadnění** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-323">On the **Sandbox test accounts** page, click the **facilitator** email account.</span></span>  
    <span data-ttu-id="6a25e-324">Zobrazí se možnosti **profilu** a **oznámení** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-324">**Profile** and **Notification** options appear.</span></span>
9. <span data-ttu-id="6a25e-325">Vyberte možnost **profil** a potom kliknutím na **přihlašovací údaje rozhraní API** Zobrazte přihlašovací údaje k rozhraní API pro testovací účet obchodníka.</span><span class="sxs-lookup"><span data-stu-id="6a25e-325">Select the **Profile** option, then click **API credentials** to view your API credentials for the merchant test account.</span></span>
10. <span data-ttu-id="6a25e-326">Zkopírujte přihlašovací údaje rozhraní API testu do poznámkového bloku.</span><span class="sxs-lookup"><span data-stu-id="6a25e-326">Copy the TEST API credentials to notepad.</span></span>

<span data-ttu-id="6a25e-327">Abyste mohli volat rozhraní API z ukázkové aplikace Wingtip Toys do testovacího prostředí služby PayPal, budete potřebovat vaše zobrazená pověření rozhraní API pro klasický TEST (uživatelské jméno, heslo a podpis).</span><span class="sxs-lookup"><span data-stu-id="6a25e-327">You will need your displayed Classic TEST API credentials (Username, Password, and Signature) to make API calls from the Wingtip Toys sample application to the PayPal testing environment.</span></span> <span data-ttu-id="6a25e-328">Přihlašovací údaje budete přidávat v dalším kroku.</span><span class="sxs-lookup"><span data-stu-id="6a25e-328">You will add the credentials in the next step.</span></span>

### <a name="add-paypal-class-and-api-credentials"></a><span data-ttu-id="6a25e-329">Přidání přihlašovacích údajů pro třídu PayPal a rozhraní API</span><span class="sxs-lookup"><span data-stu-id="6a25e-329">Add PayPal Class and API Credentials</span></span>

<span data-ttu-id="6a25e-330">Většinu kódu PayPal umístíte do jediné třídy.</span><span class="sxs-lookup"><span data-stu-id="6a25e-330">You will place the majority of the PayPal code into a single class.</span></span> <span data-ttu-id="6a25e-331">Tato třída obsahuje metody, které slouží ke komunikaci s PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-331">This class contains the methods used to communicate with PayPal.</span></span> <span data-ttu-id="6a25e-332">Do této třídy taky přidáte svoje přihlašovací údaje PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-332">Also, you will add your PayPal credentials to this class.</span></span>

1. <span data-ttu-id="6a25e-333">V ukázkové aplikaci Wingtip Toys v sadě Visual Studio klikněte pravým tlačítkem na složku **Logic** a pak vyberte **Přidat** -&gt; **Nová položka**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-333">In the Wingtip Toys sample application within Visual Studio, right-click the **Logic** folder and then select **Add** -&gt; **New Item**.</span></span>   
   <span data-ttu-id="6a25e-334">Zobrazí se dialogové okno **Přidat novou položku** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-334">The **Add New Item** dialog box is displayed.</span></span>
2. <span data-ttu-id="6a25e-335">V **části C# vizuál** z **nainstalovaného** podokna na levé straně vyberte **kód**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-335">Under **Visual C#** from the **Installed** pane on the left, select **Code**.</span></span>
3. <span data-ttu-id="6a25e-336">V prostředním podokně vyberte **Třída**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-336">From the middle pane, select **Class**.</span></span> <span data-ttu-id="6a25e-337">Pojmenujte tuto novou třídu **PayPalFunctions.cs**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-337">Name this new class **PayPalFunctions.cs**.</span></span>
4. <span data-ttu-id="6a25e-338">Klikněte na tlačítko **Přidat**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-338">Click **Add**.</span></span>  
   <span data-ttu-id="6a25e-339">V editoru se zobrazí nový soubor třídy.</span><span class="sxs-lookup"><span data-stu-id="6a25e-339">The new class file is displayed in the editor.</span></span>
5. <span data-ttu-id="6a25e-340">Nahraďte výchozí kód následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-340">Replace the default code with the following code:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample12.cs)]
6. <span data-ttu-id="6a25e-341">Přidejte přihlašovací údaje k obchodnímu rozhraní API (uživatelské jméno, heslo a podpis), které jste si zobrazili v tomto kurzu, abyste mohli provádět volání funkcí do testovacího prostředí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-341">Add the Merchant API credentials (Username, Password, and Signature) that you displayed earlier in this tutorial so that you can make function calls to the PayPal testing environment.</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample13.cs)]

> [!NOTE] 
> 
> <span data-ttu-id="6a25e-342">V této ukázkové aplikaci jednoduše přidáte přihlašovací údaje do C# souboru (. cs).</span><span class="sxs-lookup"><span data-stu-id="6a25e-342">In this sample application you are simply adding credentials to a C# file (.cs).</span></span> <span data-ttu-id="6a25e-343">V implementovaném řešení byste však měli zvážit šifrování přihlašovacích údajů v konfiguračním souboru.</span><span class="sxs-lookup"><span data-stu-id="6a25e-343">However, in a implemented solution, you should consider encrypting your credentials in a configuration file.</span></span>

<span data-ttu-id="6a25e-344">Třída NVPAPICaller obsahuje většinu funkcí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-344">The NVPAPICaller class contains the majority of the PayPal functionality.</span></span> <span data-ttu-id="6a25e-345">Kód ve třídě poskytuje metody potřebné k provedení testovacího nákupu z testovacího prostředí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-345">The code in the class provides the methods needed to make a test purchase from the PayPal testing environment.</span></span> <span data-ttu-id="6a25e-346">K nákupu se používají následující tři funkce PayPal:</span><span class="sxs-lookup"><span data-stu-id="6a25e-346">The following three PayPal functions are used to make purchases:</span></span>

- <span data-ttu-id="6a25e-347">`SetExpressCheckout` funkce</span><span class="sxs-lookup"><span data-stu-id="6a25e-347">`SetExpressCheckout` function</span></span>
- <span data-ttu-id="6a25e-348">`GetExpressCheckoutDetails` funkce</span><span class="sxs-lookup"><span data-stu-id="6a25e-348">`GetExpressCheckoutDetails` function</span></span>
- <span data-ttu-id="6a25e-349">`DoExpressCheckoutPayment` funkce</span><span class="sxs-lookup"><span data-stu-id="6a25e-349">`DoExpressCheckoutPayment` function</span></span>

<span data-ttu-id="6a25e-350">Metoda `ShortcutExpressCheckout` shromažďuje informace o nákupu testů a údaje o produktech z nákupního košíku a volá funkci služby PayPal `SetExpressCheckout`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-350">The `ShortcutExpressCheckout` method collects the test purchase information and product details from the shopping cart and calls the `SetExpressCheckout` PayPal function.</span></span> <span data-ttu-id="6a25e-351">Metoda `GetCheckoutDetails` potvrdí podrobnosti nákupu a před provedením nákupu testu zavolá funkci služby PayPal `GetExpressCheckoutDetails`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-351">The `GetCheckoutDetails` method confirms purchase details and calls the `GetExpressCheckoutDetails` PayPal function before making the test purchase.</span></span> <span data-ttu-id="6a25e-352">Metoda `DoCheckoutPayment` dokončí nákup testu z testovacího prostředí zavoláním funkce `DoExpressCheckoutPayment` PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-352">The `DoCheckoutPayment` method completes the test purchase from the testing environment by calling the `DoExpressCheckoutPayment` PayPal function.</span></span> <span data-ttu-id="6a25e-353">Zbývající kód podporuje metody a procesy PayPal, jako je například kódování řetězců, dekódování řetězců, zpracování polí a určení přihlašovacích údajů.</span><span class="sxs-lookup"><span data-stu-id="6a25e-353">The remaining code supports the PayPal methods and process, such as encoding strings, decoding strings, processing arrays, and determining credentials.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="6a25e-354">PayPal vám umožní zahrnout volitelné údaje o nákupu na základě [specifikace rozhraní API služby PayPal](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span><span class="sxs-lookup"><span data-stu-id="6a25e-354">PayPal allows you to include optional purchase details based on [PayPal's API specification](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&amp;content_ID=developer/e_howto_api_nvp_r_SetExpressCheckout).</span></span> <span data-ttu-id="6a25e-355">Rozšířením kódu v ukázkové aplikaci Wingtip Toys můžete zahrnout podrobnosti lokalizace, popisy produktů, daň, číslo zákaznické služby a také mnoho dalších volitelných polí.</span><span class="sxs-lookup"><span data-stu-id="6a25e-355">By extending the code in the Wingtip Toys sample application, you can include localization details, product descriptions, tax, a customer service number, as well as many other optional fields.</span></span>

<span data-ttu-id="6a25e-356">Všimněte si, že návratové a zrušené adresy URL, které jsou zadány v metodě **ShortcutExpressCheckout** , používají číslo portu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-356">Notice that the return and cancel URLs that are specified in the **ShortcutExpressCheckout** method use a port number.</span></span>

[!code-html[Main](checkout-and-payment-with-paypal/samples/sample14.html)]

<span data-ttu-id="6a25e-357">Když Visual Web Developer spustí webový projekt pomocí protokolu SSL, pro webový server se běžně používá port 44300.</span><span class="sxs-lookup"><span data-stu-id="6a25e-357">When Visual Web Developer runs a web project using SSL, commonly the port 44300 is used for the web server.</span></span> <span data-ttu-id="6a25e-358">Jak je uvedeno výše, číslo portu je 44300.</span><span class="sxs-lookup"><span data-stu-id="6a25e-358">As shown above, the port number is 44300.</span></span> <span data-ttu-id="6a25e-359">Při spuštění aplikace se zobrazí jiné číslo portu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-359">When you run the application, you could see a different port number.</span></span> <span data-ttu-id="6a25e-360">Číslo portu musí být správně nastaveno v kódu, aby bylo možné na konci tohoto kurzu úspěšně spustit ukázkovou aplikaci Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="6a25e-360">Your port number needs to be correctly set in the code so that you can successful run the Wingtip Toys sample application at the end of this tutorial.</span></span> <span data-ttu-id="6a25e-361">V další části tohoto kurzu se dozvíte, jak načíst číslo portu místního hostitele a aktualizovat třídu PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-361">The next section of this tutorial explains how to retrieve the local host port number and update the PayPal class.</span></span>

### <a name="update-the-localhost-port-number-in-the-paypal-class"></a><span data-ttu-id="6a25e-362">Aktualizace čísla portu LocalHost ve třídě PayPal</span><span class="sxs-lookup"><span data-stu-id="6a25e-362">Update the LocalHost Port Number in the PayPal Class</span></span>

<span data-ttu-id="6a25e-363">Ukázková aplikace Wingtip Toys si koupí produkty tak, že přejde na testovací web PayPal a vrátí se do místní instance ukázkové aplikace Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="6a25e-363">The Wingtip Toys sample application purchases products by navigating to the PayPal testing site and returning to your local instance of the Wingtip Toys sample application.</span></span> <span data-ttu-id="6a25e-364">Aby se službě PayPal vrátila správná adresa URL, musíte v kódu PayPal uvedeného výše zadat číslo portu pro místně běžící ukázkovou aplikaci.</span><span class="sxs-lookup"><span data-stu-id="6a25e-364">In order to have PayPal return to the correct URL, you need to specify the port number of the locally running sample application in the PayPal code mentioned above.</span></span>

1. <span data-ttu-id="6a25e-365">V **Průzkumník řešení** klikněte pravým tlačítkem na název projektu (**WingtipToys**) a vyberte **vlastnosti**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-365">Right-click the project name (**WingtipToys**) in **Solution Explorer** and select **Properties**.</span></span>
2. <span data-ttu-id="6a25e-366">V levém sloupci vyberte kartu **Web** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-366">In the left column, select the **Web** tab.</span></span>
3. <span data-ttu-id="6a25e-367">Načte číslo portu z pole **Adresa URL projektu** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-367">Retrieve the port number from the **Project Url** box.</span></span>
4. <span data-ttu-id="6a25e-368">V případě potřeby aktualizujte `returnURL` a `cancelURL` ve třídě PayPal (`NVPAPICaller`) v souboru *PayPalFunctions.cs* , aby používala číslo portu vaší webové aplikace:</span><span class="sxs-lookup"><span data-stu-id="6a25e-368">If needed, update the `returnURL` and `cancelURL` in the PayPal class (`NVPAPICaller`) in the *PayPalFunctions.cs* file to use the port number of your web application:</span></span>   

    [!code-html[Main](checkout-and-payment-with-paypal/samples/sample15.html?highlight=1-2)]

<span data-ttu-id="6a25e-369">Nově přidaný kód bude odpovídat očekávanému portu vaší místní webové aplikace.</span><span class="sxs-lookup"><span data-stu-id="6a25e-369">Now the code that you added will match the expected port for your local Web application.</span></span> <span data-ttu-id="6a25e-370">PayPal se bude moct vrátit na správnou adresu URL na vašem místním počítači.</span><span class="sxs-lookup"><span data-stu-id="6a25e-370">PayPal will be able to return to the correct URL on your local machine.</span></span>

### <a name="add-the-paypal-checkout-button"></a><span data-ttu-id="6a25e-371">Přidat tlačítko pro rezervaci služby PayPal</span><span class="sxs-lookup"><span data-stu-id="6a25e-371">Add the PayPal Checkout Button</span></span>

<span data-ttu-id="6a25e-372">Teď, když se do ukázkové aplikace přidaly primární funkce PayPal, můžete začít přidávat značky a kód potřebný k volání těchto funkcí.</span><span class="sxs-lookup"><span data-stu-id="6a25e-372">Now that the primary PayPal functions have been added to the sample application, you can begin adding the markup and code needed to call these functions.</span></span> <span data-ttu-id="6a25e-373">Nejdřív je nutné přidat tlačítko pro rezervaci, které uživatel uvidí na stránce nákupní košík.</span><span class="sxs-lookup"><span data-stu-id="6a25e-373">First, you must add the checkout button that the user will see on the shopping cart page.</span></span>

1. <span data-ttu-id="6a25e-374">Otevřete soubor *ShoppingCart. aspx* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-374">Open the *ShoppingCart.aspx* file.</span></span>
2. <span data-ttu-id="6a25e-375">Posuňte se do dolní části souboru a najděte `<!--Checkout Placeholder -->` komentář.</span><span class="sxs-lookup"><span data-stu-id="6a25e-375">Scroll to the bottom of the file and find the `<!--Checkout Placeholder -->` comment.</span></span>
3. <span data-ttu-id="6a25e-376">Nahraďte komentář ovládacím prvkem `ImageButton`, aby se značka nahradila následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-376">Replace the comment with an `ImageButton` control so that the mark up is replaced as follows:</span></span>  

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample16.aspx)]
4. <span data-ttu-id="6a25e-377">V souboru *ShoppingCart.aspx.cs* přidejte po `UpdateBtn_Click` obslužné rutiny události poblíž konce souboru obslužnou rutinu `CheckOutBtn_Click` události:</span><span class="sxs-lookup"><span data-stu-id="6a25e-377">In the *ShoppingCart.aspx.cs* file, after the `UpdateBtn_Click` event handler near the end of the file, add the `CheckOutBtn_Click` event handler:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample17.cs)]
5. <span data-ttu-id="6a25e-378">V souboru *ShoppingCart.aspx.cs* přidejte odkaz na `CheckoutBtn`, aby bylo na tlačítko Nový obrázek odkazováno následujícím způsobem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-378">Also in the *ShoppingCart.aspx.cs* file, add a reference to the `CheckoutBtn`, so that the new image button is referenced as follows:</span></span>  

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample18.cs?highlight=18)]
6. <span data-ttu-id="6a25e-379">Uložte změny do souboru *ShoppingCart. aspx* i do souboru *ShoppingCart.aspx.cs* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-379">Save your changes to both the *ShoppingCart.aspx* file and the *ShoppingCart.aspx.cs* file.</span></span>
7. <span data-ttu-id="6a25e-380">V nabídce vyberte možnost **ladění**-&gt;**WingtipToys sestavení**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-380">From the menu, select **Debug**-&gt;**Build WingtipToys**.</span></span>  
   <span data-ttu-id="6a25e-381">Projekt bude znovu vytvořen s nově přidaným ovládacím prvkem **obrázkové** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-381">The project will be rebuilt with the newly added **ImageButton** control.</span></span>

### <a name="send-purchase-details-to-paypal"></a><span data-ttu-id="6a25e-382">Odeslat podrobnosti o nákupu do služby PayPal</span><span class="sxs-lookup"><span data-stu-id="6a25e-382">Send Purchase Details to PayPal</span></span>

<span data-ttu-id="6a25e-383">Když uživatel klikne na tlačítko **Rezervovat** na stránce nákupního košíku (*ShoppingCart. aspx*), zahájí proces nákupu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-383">When the user clicks the **Checkout** button on the shopping cart page (*ShoppingCart.aspx*), they'll begin the purchase process.</span></span> <span data-ttu-id="6a25e-384">Následující kód volá první funkci PayPal potřebnou k nákupu produktů.</span><span class="sxs-lookup"><span data-stu-id="6a25e-384">The following code calls the first PayPal function needed to purchase products.</span></span>

1. <span data-ttu-id="6a25e-385">Ve složce pro *rezervaci* otevřete soubor kódu na pozadí s názvem *CheckoutStart.aspx.cs*.</span><span class="sxs-lookup"><span data-stu-id="6a25e-385">From the *Checkout* folder, open the code-behind file named *CheckoutStart.aspx.cs*.</span></span>   
   <span data-ttu-id="6a25e-386">Nezapomeňte otevřít soubor kódu na pozadí.</span><span class="sxs-lookup"><span data-stu-id="6a25e-386">Be sure to open the code-behind file.</span></span>
2. <span data-ttu-id="6a25e-387">Existující kód nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-387">Replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample19.cs)]

<span data-ttu-id="6a25e-388">Když uživatel aplikace klikne na tlačítko **Rezervovat** na stránce nákupní košík, prohlížeč přejde na stránku *CheckoutStart. aspx* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-388">When the user of the application clicks the **Checkout** button on the shopping cart page, the browser will navigate to the *CheckoutStart.aspx* page.</span></span> <span data-ttu-id="6a25e-389">Při načtení stránky *CheckoutStart. aspx* se zavolá metoda `ShortcutExpressCheckout`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-389">When the *CheckoutStart.aspx* page loads, the `ShortcutExpressCheckout` method is called.</span></span> <span data-ttu-id="6a25e-390">V tomto okamžiku se uživatel přenese na web PayPal testování.</span><span class="sxs-lookup"><span data-stu-id="6a25e-390">At this point, the user is transferred to the PayPal testing web site.</span></span> <span data-ttu-id="6a25e-391">Na webu PayPal uživatel zadá svoje přihlašovací údaje k účtu PayPal, zkontroluje podrobnosti o nákupu, přijme smlouvu PayPal a vrátí se do ukázkové aplikace Wingtip Toys, kde se `ShortcutExpressCheckout` metoda dokončí.</span><span class="sxs-lookup"><span data-stu-id="6a25e-391">On the PayPal site, the user enters their PayPal credentials, reviews the purchase details, accepts the PayPal agreement and returns to the Wingtip Toys sample application where the `ShortcutExpressCheckout` method completes.</span></span> <span data-ttu-id="6a25e-392">Po dokončení metody `ShortcutExpressCheckout` se uživatel přesměruje na stránku *CheckoutReview. aspx* zadanou v metodě `ShortcutExpressCheckout`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-392">When the `ShortcutExpressCheckout` method is complete, it will redirect the user to the *CheckoutReview.aspx* page specified in the `ShortcutExpressCheckout` method.</span></span> <span data-ttu-id="6a25e-393">Uživatel tak může zkontrolovat podrobnosti objednávky v rámci ukázkové aplikace Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="6a25e-393">This allows the user to review the order details from within the Wingtip Toys sample application.</span></span>

### <a name="review-order-details"></a><span data-ttu-id="6a25e-394">Podrobnosti o revizi objednávky</span><span class="sxs-lookup"><span data-stu-id="6a25e-394">Review Order Details</span></span>

<span data-ttu-id="6a25e-395">Po návratu ze služby PayPal se na stránce *CheckoutReview. aspx* ukázkové aplikace Wingtip Toys zobrazí podrobnosti objednávky.</span><span class="sxs-lookup"><span data-stu-id="6a25e-395">After returning from PayPal, the *CheckoutReview.aspx* page of the Wingtip Toys sample application displays the order details.</span></span> <span data-ttu-id="6a25e-396">Tato stránka umožňuje uživateli před nákupem produktů zkontrolovat podrobnosti o objednávce.</span><span class="sxs-lookup"><span data-stu-id="6a25e-396">This page allows the user to review the order details before purchasing the products.</span></span> <span data-ttu-id="6a25e-397">Stránka *CheckoutReview. aspx* se musí vytvořit takto:</span><span class="sxs-lookup"><span data-stu-id="6a25e-397">The *CheckoutReview.aspx* page must be created as follows:</span></span>

1. <span data-ttu-id="6a25e-398">Ve složce pro *rezervaci* otevřete stránku s názvem *CheckoutReview. aspx*.</span><span class="sxs-lookup"><span data-stu-id="6a25e-398">In the *Checkout* folder, open the page named *CheckoutReview.aspx*.</span></span>
2. <span data-ttu-id="6a25e-399">Existující značku nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-399">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample20.aspx)]
3. <span data-ttu-id="6a25e-400">Otevřete stránku s kódem na pozadí s názvem *CheckoutReview.aspx.cs* a nahraďte existující kód následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-400">Open the code-behind page named *CheckoutReview.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample21.cs)]

<span data-ttu-id="6a25e-401">Ovládací prvek **DetailsView** slouží k zobrazení podrobností objednávky, které byly vráceny ze služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-401">The **DetailsView** control is used to display the order details that have been returned from PayPal.</span></span> <span data-ttu-id="6a25e-402">Výše uvedený kód také uloží podrobnosti objednávky do databáze Wingtip Toys jako objekt `OrderDetail`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-402">Also, the above code saves the order details to the Wingtip Toys database as an `OrderDetail` object.</span></span> <span data-ttu-id="6a25e-403">Když uživatel klikne na tlačítko pro **dokončení objednávky** , budou přesměrováni na stránku *CheckoutComplete. aspx* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-403">When the user clicks on the **Complete Order** button, they are redirected to the *CheckoutComplete.aspx* page.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="6a25e-404">**Popisek**</span><span class="sxs-lookup"><span data-stu-id="6a25e-404">**Tip**</span></span>
> 
> <span data-ttu-id="6a25e-405">V kódu stránky *CheckoutReview. aspx* si všimněte, že značka `<ItemStyle>` slouží ke změně stylu položek v ovládacím prvku **DetailsView** v dolní části stránky.</span><span class="sxs-lookup"><span data-stu-id="6a25e-405">In the markup of the *CheckoutReview.aspx* page, notice that the `<ItemStyle>` tag is used to change the style of the items within the **DetailsView** control near the bottom of the page.</span></span> <span data-ttu-id="6a25e-406">Zobrazením stránky v **návrhovém zobrazení** (výběrem možnosti **Návrh** v levém dolním rohu sady Visual Studio) a následným výběrem ovládacího prvku **DetailsView** a vybráním **inteligentní značky** (ikona šipky v pravé horní části ovládacího prvku) uvidíte **úkoly DetailsView**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-406">By viewing the page in **Design View** (by selecting **Design** at the lower left corner of Visual Studio), then selecting the **DetailsView** control, and selecting the **Smart Tag** (the arrow icon at the top right of the control), you will be able to see the **DetailsView Tasks**.</span></span>
> 
> ![Rezervace a platby pomocí polí pro úpravy PayPal](checkout-and-payment-with-paypal/_static/image18.png)
> 
> <span data-ttu-id="6a25e-408">Když vyberete možnost **Upravit pole**, zobrazí se dialogové okno **pole** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-408">By selecting **Edit Fields**, the **Fields** dialog box will appear.</span></span> <span data-ttu-id="6a25e-409">V tomto dialogovém okně lze snadno ovládat vlastnosti vizuálu, například **ItemStyle**, ovládacího prvku **DetailsView** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-409">In this dialog box you can easily control the visual properties, such as **ItemStyle**, of the **DetailsView** control.</span></span>
> 
> ![Dialogové okno rezervace a platby s poli PayPal – pole](checkout-and-payment-with-paypal/_static/image19.png)

### <a name="complete-purchase"></a><span data-ttu-id="6a25e-411">Dokončit nákup</span><span class="sxs-lookup"><span data-stu-id="6a25e-411">Complete Purchase</span></span>

<span data-ttu-id="6a25e-412">Stránka *CheckoutComplete. aspx* slouží k nákupu z PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-412">*CheckoutComplete.aspx* page makes the purchase from PayPal.</span></span> <span data-ttu-id="6a25e-413">Jak je uvedeno výše, uživatel musí kliknout na tlačítko **Dokončit objednávku** , aby se aplikace mohla přejít na stránku *CheckoutComplete. aspx* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-413">As mentioned above, the user must click on the **Complete Order** button before the application will navigate to the *CheckoutComplete.aspx* page.</span></span>

1. <span data-ttu-id="6a25e-414">Ve složce pro *rezervaci* otevřete stránku s názvem *CheckoutComplete. aspx*.</span><span class="sxs-lookup"><span data-stu-id="6a25e-414">In the *Checkout* folder, open the page named *CheckoutComplete.aspx*.</span></span>
2. <span data-ttu-id="6a25e-415">Existující značku nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-415">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample22.aspx)]
3. <span data-ttu-id="6a25e-416">Otevřete stránku s kódem na pozadí s názvem *CheckoutComplete.aspx.cs* a nahraďte existující kód následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-416">Open the code-behind page named *CheckoutComplete.aspx.cs* and replace the existing code with the following:</span></span>   

    [!code-csharp[Main](checkout-and-payment-with-paypal/samples/sample23.cs)]

<span data-ttu-id="6a25e-417">Když je načtena stránka *CheckoutComplete. aspx* , je volána metoda `DoCheckoutPayment`.</span><span class="sxs-lookup"><span data-stu-id="6a25e-417">When the *CheckoutComplete.aspx* page is loaded, the `DoCheckoutPayment` method is called.</span></span> <span data-ttu-id="6a25e-418">Jak bylo zmíněno dříve, metoda `DoCheckoutPayment` dokončuje nákup z testovacího prostředí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-418">As mentioned earlier, the `DoCheckoutPayment` method completes the purchase from the PayPal testing environment.</span></span> <span data-ttu-id="6a25e-419">Jakmile si PayPal dokončí nákup objednávky, na stránce *CheckoutComplete. aspx* se zobrazí platební transakce `ID` k nákupu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-419">Once PayPal has completed the purchase of the order, the *CheckoutComplete.aspx* page displays a payment transaction `ID` to the purchaser.</span></span>

### <a name="handle-cancel-purchase"></a><span data-ttu-id="6a25e-420">Zrušit nákup s popisovačem</span><span class="sxs-lookup"><span data-stu-id="6a25e-420">Handle Cancel Purchase</span></span>

<span data-ttu-id="6a25e-421">Pokud se uživatel rozhodne zrušit nákup, budou přesměrováni na stránku *CheckoutCancel. aspx* , kde uvidí, že jejich objednávka byla zrušena.</span><span class="sxs-lookup"><span data-stu-id="6a25e-421">If the user decides to cancel the purchase, they will be directed to the *CheckoutCancel.aspx* page where they will see that their order has been cancelled.</span></span>

1. <span data-ttu-id="6a25e-422">Ve složce pro *rezervaci* otevřete stránku s názvem *CheckoutCancel. aspx* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-422">Open the page named *CheckoutCancel.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="6a25e-423">Existující značku nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-423">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample24.aspx)]

### <a name="handle-purchase-errors"></a><span data-ttu-id="6a25e-424">Zpracovat chyby nákupu</span><span class="sxs-lookup"><span data-stu-id="6a25e-424">Handle Purchase Errors</span></span>

<span data-ttu-id="6a25e-425">Chyby během procesu nákupu budou zpracovány stránkou *CheckoutError. aspx* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-425">Errors during the purchase process will be handled by the *CheckoutError.aspx* page.</span></span> <span data-ttu-id="6a25e-426">Kód na pozadí stránky *CheckoutStart. aspx* , stránka *CheckoutReview. aspx* a stránka *CheckoutComplete. aspx* budou přesměrovány na stránku *CheckoutError. aspx* , pokud dojde k chybě.</span><span class="sxs-lookup"><span data-stu-id="6a25e-426">The code-behind of the *CheckoutStart.aspx* page, the *CheckoutReview.aspx* page, and the *CheckoutComplete.aspx* page will each redirect to the *CheckoutError.aspx* page if an error occurs.</span></span>

1. <span data-ttu-id="6a25e-427">Ve složce pro *rezervaci* otevřete stránku s názvem *CheckoutError. aspx* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-427">Open the page named *CheckoutError.aspx* in the *Checkout* folder.</span></span>
2. <span data-ttu-id="6a25e-428">Existující značku nahraďte následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="6a25e-428">Replace the existing markup with the following:</span></span>   

    [!code-aspx[Main](checkout-and-payment-with-paypal/samples/sample25.aspx)]

<span data-ttu-id="6a25e-429">Pokud během procesu registrace dojde k chybě, zobrazí se stránka *CheckoutError. aspx* s podrobnostmi o chybě.</span><span class="sxs-lookup"><span data-stu-id="6a25e-429">The *CheckoutError.aspx* page is displayed with the error details when an error occurs during the checkout process.</span></span>

## <a name="running-the-application"></a><span data-ttu-id="6a25e-430">Spuštění aplikace</span><span class="sxs-lookup"><span data-stu-id="6a25e-430">Running the Application</span></span>

<span data-ttu-id="6a25e-431">Spusťte aplikaci a podívejte se, jak zakoupit produkty.</span><span class="sxs-lookup"><span data-stu-id="6a25e-431">Run the application to see how to purchase products.</span></span> <span data-ttu-id="6a25e-432">Všimněte si, že budete používat prostředí pro testování služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-432">Note that you will be running in the PayPal testing environment.</span></span> <span data-ttu-id="6a25e-433">Neprobíhá výměna skutečných peněz.</span><span class="sxs-lookup"><span data-stu-id="6a25e-433">No actual money is being exchanged.</span></span>

1. <span data-ttu-id="6a25e-434">Zajistěte, aby byly všechny vaše soubory uloženy v aplikaci Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="6a25e-434">Make sure all your files are saved in Visual Studio.</span></span>
2. <span data-ttu-id="6a25e-435">Otevřete webový prohlížeč a přejděte na [https://developer.paypal.com](https://developer.paypal.com/).</span><span class="sxs-lookup"><span data-stu-id="6a25e-435">Open a Web browser and navigate to [https://developer.paypal.com](https://developer.paypal.com/).</span></span>
3. <span data-ttu-id="6a25e-436">Přihlaste se pomocí svého účtu vývojáře služby PayPal, který jste vytvořili dříve v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-436">Login with your PayPal developer account that you created earlier in this tutorial.</span></span>  
   <span data-ttu-id="6a25e-437">Pro izolovaný prostor (sandbox) pro vývojáře služby PayPal musíte být přihlášeni [https://developer.paypal.com](https://developer.paypal.com/) k otestování expresní rezervace.</span><span class="sxs-lookup"><span data-stu-id="6a25e-437">For PayPal's developer sandbox, you need to be logged in at [https://developer.paypal.com](https://developer.paypal.com/) to test express checkout.</span></span> <span data-ttu-id="6a25e-438">To platí jenom pro testování izolovaného prostoru (sandbox) služby PayPal, nikoli na živé prostředí PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-438">This only applies to PayPal's sandbox testing, not to PayPal's live environment.</span></span>
4. <span data-ttu-id="6a25e-439">V aplikaci Visual Studio stiskněte klávesu **F5** a spusťte ukázkovou aplikaci Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="6a25e-439">In Visual Studio, press **F5** to run the Wingtip Toys sample application.</span></span>  
   <span data-ttu-id="6a25e-440">Po opětovném sestavení databáze se v prohlížeči otevře a zobrazí stránka *Default. aspx* .</span><span class="sxs-lookup"><span data-stu-id="6a25e-440">After the database rebuilds, the browser will open and show the *Default.aspx* page.</span></span>
5. <span data-ttu-id="6a25e-441">Přidejte do nákupního košíku tři různé produkty, a to tak, že vyberete kategorii produktů, například "auta", a potom kliknete na **Přidat do košíku** vedle každého produktu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-441">Add three different products to the shopping cart by selecting the product category, such as "Cars" and then clicking **Add to Cart** next to each product.</span></span>  
   <span data-ttu-id="6a25e-442">V nákupním košíku se zobrazí vybraný produkt.</span><span class="sxs-lookup"><span data-stu-id="6a25e-442">The shopping cart will display the product you have selected.</span></span>
6. <span data-ttu-id="6a25e-443">Klikněte na tlačítko **PayPal** a proveďte rezervaci.</span><span class="sxs-lookup"><span data-stu-id="6a25e-443">Click the **PayPal** button to checkout.</span></span> 

    ![Registrace a platba pomocí služby PayPal-košík](checkout-and-payment-with-paypal/_static/image20.png)

   <span data-ttu-id="6a25e-445">Rezervace bude vyžadovat, abyste měli uživatelský účet pro ukázkovou aplikaci Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="6a25e-445">Checking out will require that you have a user account for the Wingtip Toys sample application.</span></span>
7. <span data-ttu-id="6a25e-446">Kliknutím na odkaz **Google** na pravé straně stránky se přihlaste pomocí stávajícího e-mailového účtu Gmail.com.</span><span class="sxs-lookup"><span data-stu-id="6a25e-446">Click the **Google** link on the right of the page to log in with an existing gmail.com email account.</span></span>  
   <span data-ttu-id="6a25e-447">Pokud nemáte účet gmail.com, můžete ho vytvořit pro účely testování na [www.gmail.com](https://www.gmail.com/).</span><span class="sxs-lookup"><span data-stu-id="6a25e-447">If you do not have a gmail.com account, you can create one for testing purposes at [www.gmail.com](https://www.gmail.com/).</span></span> <span data-ttu-id="6a25e-448">Můžete také použít standardní místní účet kliknutím na registrovat.</span><span class="sxs-lookup"><span data-stu-id="6a25e-448">You can also use a standard local account by clicking "Register".</span></span> 

    ![Rezervace a platby pomocí služby PayPal – přihlášení](checkout-and-payment-with-paypal/_static/image21.png)
8. <span data-ttu-id="6a25e-450">Přihlaste se pomocí účtu a hesla gmail.</span><span class="sxs-lookup"><span data-stu-id="6a25e-450">Sign in with your gmail account and password.</span></span> 

    ![Rezervace a platby pomocí služby PayPal – přihlášení ke službě Gmail](checkout-and-payment-with-paypal/_static/image22.png)
9. <span data-ttu-id="6a25e-452">Kliknutím na tlačítko **Přihlásit** zaregistrujete účet Gmail pomocí uživatelského jména ukázkové aplikace Wingtip Toys.</span><span class="sxs-lookup"><span data-stu-id="6a25e-452">Click the **Log in** button to register your gmail account with your Wingtip Toys sample application user name.</span></span> 

    ![Rezervace a platby pomocí služby PayPal – registrace účtu](checkout-and-payment-with-paypal/_static/image23.png)
10. <span data-ttu-id="6a25e-454">Na testovacím webu PayPal přidejte e-mailovou adresu a heslo **nákupčího** , které jste vytvořili dříve v tomto kurzu, a pak klikněte na tlačítko **Přihlásit** se.</span><span class="sxs-lookup"><span data-stu-id="6a25e-454">On the PayPal test site, add your **buyer** email address and password that you created earlier in this tutorial, then click the **Log In** button.</span></span> 

    ![Registrace a platba pomocí PayPal – přihlášení k PayPal](checkout-and-payment-with-paypal/_static/image24.png)
11. <span data-ttu-id="6a25e-456">Přijměte zásady PayPal a klikněte na tlačítko **Souhlasím a pokračovat** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-456">Agree to the PayPal policy and click the **Agree and Continue** button.</span></span>  
    <span data-ttu-id="6a25e-457">Všimněte si, že se tato stránka zobrazuje jenom při prvním použití tohoto účtu PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-457">Note that this page is only displayed the first time you use this PayPal account.</span></span> <span data-ttu-id="6a25e-458">Znovu si všimněte, že se jedná o testovací účet, nevyměňují se skutečné peníze.</span><span class="sxs-lookup"><span data-stu-id="6a25e-458">Again note that this is a test account, no real money is exchanged.</span></span> 

    ![Rezervace a platby pomocí zásad PayPal pro PayPal](checkout-and-payment-with-paypal/_static/image25.png)
12. <span data-ttu-id="6a25e-460">Zkontrolujte informace o objednávce na stránce Kontrola testovacího prostředí služby PayPal a klikněte na **pokračovat**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-460">Review the order information on the PayPal testing environment review page and click **Continue**.</span></span> 

    ![Rezervace a platby pomocí služby PayPal – informace o kontrole](checkout-and-payment-with-paypal/_static/image26.png)
13. <span data-ttu-id="6a25e-462">Na stránce *CheckoutReview. aspx* Ověřte množství objednávky a zobrazte vygenerovanou dodací adresu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-462">On the *CheckoutReview.aspx* page, verify the order amount and view the generated shipping address.</span></span> <span data-ttu-id="6a25e-463">Pak klikněte na tlačítko **Dokončit objednávku** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-463">Then, click the **Complete Order** button.</span></span> 

    ![Rezervace a platba pomocí služby PayPal – přezkoumání objednávek](checkout-and-payment-with-paypal/_static/image27.png)
14. <span data-ttu-id="6a25e-465">Zobrazí se stránka **CheckoutComplete. aspx** s ID platební transakce.</span><span class="sxs-lookup"><span data-stu-id="6a25e-465">The **CheckoutComplete.aspx** page is displayed with a payment transaction ID.</span></span> 

    ![Rezervace a platba pomocí služby PayPal – dokončení rezervace](checkout-and-payment-with-paypal/_static/image28.png)

<a id="ReviewDBWebForms"></a>
## <a name="reviewing-the-database"></a><span data-ttu-id="6a25e-467">Kontrola databáze</span><span class="sxs-lookup"><span data-stu-id="6a25e-467">Reviewing the Database</span></span>

<span data-ttu-id="6a25e-468">Kontrolou aktualizovaných dat v databázi ukázkové aplikace Wingtip Toys po spuštění aplikace uvidíte, že aplikace úspěšně zaznamenala nákup produktů.</span><span class="sxs-lookup"><span data-stu-id="6a25e-468">By reviewing the updated data in the Wingtip Toys sample application database after running the application, you can see that the application successfully recorded the purchase of the products.</span></span>

<span data-ttu-id="6a25e-469">Data obsažená v souboru databáze *wingtiptoys. mdf* můžete zkontrolovat pomocí okna **průzkumník databáze** (**Průzkumník serveru** okno v sadě Visual Studio) stejně jako dříve v této sérii kurzů.</span><span class="sxs-lookup"><span data-stu-id="6a25e-469">You can inspect the data contained in the *Wingtiptoys.mdf* database file by using the **Database Explorer** window (**Server Explorer** window in Visual Studio) as you did earlier in this tutorial series.</span></span>

1. <span data-ttu-id="6a25e-470">Zavřete okno prohlížeče, pokud je stále otevřené.</span><span class="sxs-lookup"><span data-stu-id="6a25e-470">Close the browser window if it is still open.</span></span>
2. <span data-ttu-id="6a25e-471">V aplikaci Visual Studio vyberte ikonu **Zobrazit všechny soubory** v horní části **Průzkumník řešení** , abyste mohli rozšířit složku **\_dat aplikace** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-471">In Visual Studio, select the **Show All Files** icon at the top of **Solution Explorer** to allow you to expand the **App\_Data** folder.</span></span>
3. <span data-ttu-id="6a25e-472">Rozbalte složku **Data\_aplikace** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-472">Expand the **App\_Data** folder.</span></span>  
 <span data-ttu-id="6a25e-473">Možná budete muset pro složku vybrat ikonu **Zobrazit všechny soubory** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-473">You may need to select the **Show All Files** icon for the folder.</span></span>
4. <span data-ttu-id="6a25e-474">Klikněte pravým tlačítkem myši na soubor databáze *wingtiptoys. mdf* a vyberte **otevřít**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-474">Right-click the *Wingtiptoys.mdf* database file and select **Open**.</span></span>  
    <span data-ttu-id="6a25e-475">Zobrazí se **Průzkumník serveru** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-475">**Server Explorer** is displayed.</span></span>
5. <span data-ttu-id="6a25e-476">Rozbalte složku **tabulky** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-476">Expand the **Tables** folder.</span></span>
6. <span data-ttu-id="6a25e-477">Klikněte pravým tlačítkem myši na tabulku **Orders**a vyberte možnost **Zobrazit data tabulky**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-477">Right-click the **Orders**table and select **Show Table Data**.</span></span>  
 <span data-ttu-id="6a25e-478">Zobrazí se tabulka **objednávky** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-478">The **Orders** table is displayed.</span></span>
7. <span data-ttu-id="6a25e-479">Zkontrolujte sloupec **PaymentTransactionID** a potvrďte úspěšné transakce.</span><span class="sxs-lookup"><span data-stu-id="6a25e-479">Review the **PaymentTransactionID** column to confirm successful transactions.</span></span> 

    ![Rezervace a platba pomocí databáze služby PayPal-Revize](checkout-and-payment-with-paypal/_static/image29.png)
8. <span data-ttu-id="6a25e-481">Zavřete okno tabulky **Orders** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-481">Close the **Orders** table window.</span></span>
9. <span data-ttu-id="6a25e-482">V Průzkumník serveru klikněte pravým tlačítkem myši na tabulku **OrderDetails** a vyberte možnost **Zobrazit data tabulky**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-482">In the Server Explorer, right-click the **OrderDetails** table and select **Show Table Data**.</span></span>
10. <span data-ttu-id="6a25e-483">Zkontrolujte hodnoty `OrderId` a `Username` v tabulce **OrderDetails** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-483">Review the `OrderId` and `Username` values in the **OrderDetails** table.</span></span> <span data-ttu-id="6a25e-484">Všimněte si, že tyto hodnoty odpovídají `OrderId` a `Username` hodnoty zahrnuté v tabulce **Orders** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-484">Note that these values match the `OrderId` and `Username` values included in the **Orders** table.</span></span>
11. <span data-ttu-id="6a25e-485">Zavřete okno tabulky **OrderDetails** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-485">Close the **OrderDetails** table window.</span></span>
12. <span data-ttu-id="6a25e-486">Pravým tlačítkem myši klikněte na soubor databáze Wingtip Toys (*wingtiptoys. mdf*) a vyberte **Zavřít připojení**.</span><span class="sxs-lookup"><span data-stu-id="6a25e-486">Right-click the Wingtip Toys database file (*Wingtiptoys.mdf*) and select **Close Connection**.</span></span>
13. <span data-ttu-id="6a25e-487">Pokud se okno **Průzkumník řešení** nezobrazí, klikněte v dolní části okna **Průzkumník serveru** na **Průzkumník řešení** a znovu zobrazte **Průzkumník řešení** .</span><span class="sxs-lookup"><span data-stu-id="6a25e-487">If you do not see the **Solution Explorer** window, click **Solution Explorer** at the bottom of the **Server Explorer** window to show the **Solution Explorer** again.</span></span>

## <a name="summary"></a><span data-ttu-id="6a25e-488">Přehled</span><span class="sxs-lookup"><span data-stu-id="6a25e-488">Summary</span></span>

<span data-ttu-id="6a25e-489">V tomto kurzu jste přidali schémata podrobností o objednávkách a objednávkách pro sledování nákupu produktů.</span><span class="sxs-lookup"><span data-stu-id="6a25e-489">In this tutorial you added order and order detail schemas to track the purchase of products.</span></span> <span data-ttu-id="6a25e-490">Do ukázkové aplikace Wingtip Toys jste také integrovaných funkcí služby PayPal.</span><span class="sxs-lookup"><span data-stu-id="6a25e-490">You also integrated PayPal functionality into the Wingtip Toys sample application.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="6a25e-491">Další materiály a zdroje informací</span><span class="sxs-lookup"><span data-stu-id="6a25e-491">Additional Resources</span></span>

<span data-ttu-id="6a25e-492">[Přehled konfigurace ASP.NET](https://msdn.microsoft.com/library/ms178683(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="6a25e-492">[ASP.NET Configuration Overview](https://msdn.microsoft.com/library/ms178683(v=vs.100).aspx)</span></span>  
[<span data-ttu-id="6a25e-493">Nasazení zabezpečené aplikace webových formulářů ASP.NET pomocí členství, protokolu OAuth a SQL Database pro Azure App Service</span><span class="sxs-lookup"><span data-stu-id="6a25e-493">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)  
[<span data-ttu-id="6a25e-494">Microsoft Azure – bezplatná zkušební verze</span><span class="sxs-lookup"><span data-stu-id="6a25e-494">Microsoft Azure - Free Trial</span></span>](https://azure.microsoft.com/pricing/free-trial/)

## <a name="disclaimer"></a><span data-ttu-id="6a25e-495">Právní omezení</span><span class="sxs-lookup"><span data-stu-id="6a25e-495">Disclaimer</span></span>

<span data-ttu-id="6a25e-496">Tento kurz obsahuje vzorový kód.</span><span class="sxs-lookup"><span data-stu-id="6a25e-496">This tutorial contains sample code.</span></span> <span data-ttu-id="6a25e-497">Vzorový kód je poskytován tak, jak je, bez záruky jakéhokoli druhu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-497">Such sample code is provided "as is" without warranty of any kind.</span></span> <span data-ttu-id="6a25e-498">Proto společnost Microsoft nezaručuje přesnost, integritu ani kvalitu ukázkového kódu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-498">Accordingly, Microsoft does not guarantee the accuracy, integrity, or quality of the sample code.</span></span> <span data-ttu-id="6a25e-499">Souhlasíte s tím, že použijete vzorový kód na vlastní riziko.</span><span class="sxs-lookup"><span data-stu-id="6a25e-499">You agree to use the sample code at your own risk.</span></span> <span data-ttu-id="6a25e-500">Za žádných okolností vám společnost Microsoft nenese žádný vzorový kód, obsah, včetně, ale nikoli omezení, případné chyby nebo opomenutí v jakémkoli vzorovém kódu, obsahu nebo jakékoli ztrátě nebo poškození jakéhokoli druhu, které vznikly v důsledku použití libovolného ukázkového kódu.</span><span class="sxs-lookup"><span data-stu-id="6a25e-500">Under no circumstances will Microsoft be liable to you in any way for any sample code, content, including but not limited to, any errors or omissions in any sample code, content, or any loss or damage of any kind incurred as a result of the use of any sample code.</span></span> <span data-ttu-id="6a25e-501">Souhlasíte s tím, že neškodí škodu proti všem ztrátám, jejich škodám a škodám, škodám nebo škodám jakéhokoli druhu, včetně bez omezení, u kterých vzniklých nebo plynoucích z materiálu, který zveřejníte. přenášet, používat nebo spoléhat na zahrnutí, ale ne omezení na, zobrazení vyjádřená v nich.</span><span class="sxs-lookup"><span data-stu-id="6a25e-501">You are hereby notified and do hereby agree to indemnify, save and hold Microsoft harmless from and against any and all loss, claims of loss, injury or damage of any kind including, without limitation, those occasioned by or arising from material that you post, transmit, use or rely on including, but not limited to, the views expressed therein.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6a25e-502">[Předchozí](shopping-cart.md)
> [Další](membership-and-administration.md)</span><span class="sxs-lookup"><span data-stu-id="6a25e-502">[Previous](shopping-cart.md)
[Next](membership-and-administration.md)</span></span>
