---
uid: web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
title: Použití asynchronních metod v ASP.NET 4,5 | Microsoft Docs
author: Rick-Anderson
description: V tomto kurzu se seznámíte se základy vytváření asynchronní aplikace webového formuláře ASP.NET pomocí Visual Studio Express 2012 pro web, což je zdarma...
ms.author: riande
ms.date: 01/02/2019
ms.assetid: a585c9a2-7c8e-478b-9706-90f3739c50d1
msc.legacyurl: /web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
msc.type: authoredcontent
ms.openlocfilehash: 7abc3d7acc60d7d868958f2a313bc408f96c95a4
ms.sourcegitcommit: 7709c0a091b8d55b7b33bad8849f7b66b23c3d72
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 02/19/2020
ms.locfileid: "77457567"
---
# <a name="using-asynchronous-methods-in-aspnet-45"></a><span data-ttu-id="874db-103">Použití asynchronních metod v ASP.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="874db-103">Using Asynchronous Methods in ASP.NET 4.5</span></span>

<span data-ttu-id="874db-104">od [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="874db-104">by [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

> <span data-ttu-id="874db-105">V tomto kurzu se seznámíte se základy vytváření asynchronní aplikace webového formuláře ASP.NET pomocí [Visual Studio Express 2012 pro web](https://www.microsoft.com/visualstudio/11), což je bezplatná verze Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="874db-105">This tutorial will teach you the basics of building an asynchronous ASP.NET Web Forms application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="874db-106">Můžete také použít [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="874db-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span> <span data-ttu-id="874db-107">V tomto kurzu jsou uvedené následující oddíly.</span><span class="sxs-lookup"><span data-stu-id="874db-107">The following sections are included in this tutorial.</span></span>
> 
> - [<span data-ttu-id="874db-108">Způsob zpracování požadavků fondem vláken</span><span class="sxs-lookup"><span data-stu-id="874db-108">How Requests Are Processed by the Thread Pool</span></span>](#HowRequestsProcessedByTP)
> - [<span data-ttu-id="874db-109">Výběr synchronních nebo asynchronních metod</span><span class="sxs-lookup"><span data-stu-id="874db-109">Choosing Synchronous or Asynchronous Methods</span></span>](#ChoosingSyncVasync)
> - [<span data-ttu-id="874db-110">Ukázková aplikace</span><span class="sxs-lookup"><span data-stu-id="874db-110">The Sample Application</span></span>](#SampleApp)
> - [<span data-ttu-id="874db-111">Synchronní stránka Gizma</span><span class="sxs-lookup"><span data-stu-id="874db-111">The Gizmos Synchronous Page</span></span>](#GizmosSynch)
> - [<span data-ttu-id="874db-112">Vytvoření asynchronní stránky Gizma</span><span class="sxs-lookup"><span data-stu-id="874db-112">Creating an Asynchronous Gizmos Page</span></span>](#CreatingAsynchGizmos)
> - [<span data-ttu-id="874db-113">Paralelní provádění více operací</span><span class="sxs-lookup"><span data-stu-id="874db-113">Performing Multiple Operations in Parallel</span></span>](#Parallel)
> - [<span data-ttu-id="874db-114">Použití tokenu zrušení</span><span class="sxs-lookup"><span data-stu-id="874db-114">Using a Cancellation Token</span></span>](#CancelToken)
> - [<span data-ttu-id="874db-115">Konfigurace serveru pro volání webové služby vysoké souběžnosti nebo vysoké latence</span><span class="sxs-lookup"><span data-stu-id="874db-115">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>](#ServerConfig)
> 
> <span data-ttu-id="874db-116">K dispozici je kompletní ukázka v tomto kurzu.</span><span class="sxs-lookup"><span data-stu-id="874db-116">A complete sample is provided for this tutorial at</span></span>  
> <span data-ttu-id="874db-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) na webu [GitHub](https://github.com/) .</span><span class="sxs-lookup"><span data-stu-id="874db-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) on the [GitHub](https://github.com/) site.</span></span>

<span data-ttu-id="874db-118">Webové stránky ASP.NET 4,5 v kombinaci s [rozhraním .net 4,5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) umožňují registrovat asynchronní metody, které vracejí objekt typu [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="874db-118">ASP.NET 4.5 Web Pages in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to register asynchronous methods that return an object of type [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="874db-119">.NET Framework 4 představila asynchronní programovací koncept, který je označován jako [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) a ASP.NET 4,5, který podporuje [úlohu](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="874db-119">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET 4.5 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="874db-120">Úkoly jsou reprezentovány typem **úkolu** a souvisejícími typy v oboru názvů [System. Threading. Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) .</span><span class="sxs-lookup"><span data-stu-id="874db-120">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="874db-121">.NET Framework 4,5 sestaví k této asynchronní podpoře s klíčovým slovem [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , která umožňují pracovat s objekty [úlohy](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) mnohem méně složitější než předchozí asynchronní přístupy.</span><span class="sxs-lookup"><span data-stu-id="874db-121">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="874db-122">Klíčové slovo [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) je syntaktická zkratka pro značící, že část kódu by měla asynchronně čekat na nějakou jinou část kódu.</span><span class="sxs-lookup"><span data-stu-id="874db-122">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="874db-123">Klíčové slovo [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) představuje pomocný parametr, který můžete použít k označení metod jako asynchronních metod založených na úlohách.</span><span class="sxs-lookup"><span data-stu-id="874db-123">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="874db-124">Kombinace **operátoru await**, **Async**a objektu **Task** usnadňuje psaní asynchronního kódu v rozhraní .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="874db-124">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="874db-125">Nový model pro asynchronní metody se nazývá *asynchronní vzor založený na úlohách* (**klepněte**).</span><span class="sxs-lookup"><span data-stu-id="874db-125">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="874db-126">V tomto kurzu se předpokládá, že máte zkušenosti s asynchronním programováním pomocí klíčových slov [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) a oboru názvů [úkolu](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) .</span><span class="sxs-lookup"><span data-stu-id="874db-126">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="874db-127">Další informace o klíčovém slově [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) a oboru názvů [úkolů](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) naleznete v následujících odkazech.</span><span class="sxs-lookup"><span data-stu-id="874db-127">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="874db-128">Dokument White Paper: asynchronii v .NET</span><span class="sxs-lookup"><span data-stu-id="874db-128">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="874db-129">Nejčastější dotazy k Async/await</span><span class="sxs-lookup"><span data-stu-id="874db-129">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="874db-130">Asynchronní programování v aplikaci Visual Studio</span><span class="sxs-lookup"><span data-stu-id="874db-130">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a><span data-ttu-id="874db-131">Způsob zpracování požadavků fondem vláken</span><span class="sxs-lookup"><span data-stu-id="874db-131">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="874db-132">Na webovém serveru .NET Framework udržuje fond vláken, která se používají k obsluhování požadavků ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="874db-132">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="874db-133">Když požadavek dorazí, vlákno z fondu se odešle do zpracování tohoto požadavku.</span><span class="sxs-lookup"><span data-stu-id="874db-133">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="874db-134">Pokud je požadavek zpracováván synchronně, vlákno, který zpracovává požadavek, je při zpracování žádosti zaneprázdněno a vlákno nemůže obsluhovat jiný požadavek.</span><span class="sxs-lookup"><span data-stu-id="874db-134">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="874db-135">Nemusí se jednat o problém, protože fond vláken je možné dostatečně velký, aby se vešel do mnoha zaneprázdněných vláken.</span><span class="sxs-lookup"><span data-stu-id="874db-135">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="874db-136">Počet vláken ve fondu vláken je ale omezený (výchozí maximum pro .NET 4,5 je 5 000).</span><span class="sxs-lookup"><span data-stu-id="874db-136">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="874db-137">Ve velkých aplikacích s vysokou souběžnou délkou dlouhotrvajících požadavků můžou být všechna dostupná vlákna zaneprázdněná.</span><span class="sxs-lookup"><span data-stu-id="874db-137">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="874db-138">Tato podmínka se označuje jako vyčerpání vlákna.</span><span class="sxs-lookup"><span data-stu-id="874db-138">This condition is known as thread starvation.</span></span> <span data-ttu-id="874db-139">Po dosažení tohoto stavu vyřadí webové servery požadavky.</span><span class="sxs-lookup"><span data-stu-id="874db-139">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="874db-140">Pokud se fronta požadavků zaplní, webový server odmítne žádosti se stavem HTTP 503 (Server je příliš zaneprázdněný).</span><span class="sxs-lookup"><span data-stu-id="874db-140">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="874db-141">Fond vláken CLR má omezení pro vkládání nových vláken.</span><span class="sxs-lookup"><span data-stu-id="874db-141">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="874db-142">Pokud je souběžnost souběžnosti (to znamená, že váš web může náhle obdržet velký počet požadavků) a že všechna dostupná vlákna požadavků jsou zaneprázdněna z důvodu back-endu s vysokou latencí, může vaše aplikace velmi špatně reagovat.</span><span class="sxs-lookup"><span data-stu-id="874db-142">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="874db-143">Každé nové vlákno přidané do fondu vláken má navíc režii (například 1 MB paměti zásobníku).</span><span class="sxs-lookup"><span data-stu-id="874db-143">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="874db-144">Webová aplikace, která používá synchronní metody pro obsluhu vysoké latence, kdy se fond vláken zvětšuje na standard .NET 4,5, ve výchozím nastavení maximum je 5 000 vláken, což by využilo přibližně 5 GB paměti, než je aplikace schopná, aby služba používala stejné požadavky. asynchronní metody a jenom 50 vláken.</span><span class="sxs-lookup"><span data-stu-id="874db-144">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="874db-145">Při asynchronní práci nepoužíváte vždy vlákno.</span><span class="sxs-lookup"><span data-stu-id="874db-145">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="874db-146">Například při provádění asynchronní žádosti webové služby nebude ASP.NET používat žádná vlákna mezi voláním **asynchronní** metody a **await**.</span><span class="sxs-lookup"><span data-stu-id="874db-146">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="874db-147">Použití fondu vláken ke zpracování žádostí s vysokou latencí může způsobit velké nároky na paměť a špatné využití hardwaru serveru.</span><span class="sxs-lookup"><span data-stu-id="874db-147">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="874db-148">Zpracování asynchronních požadavků</span><span class="sxs-lookup"><span data-stu-id="874db-148">Processing Asynchronous Requests</span></span>

<span data-ttu-id="874db-149">Ve webových aplikacích, které zobrazují velký počet souběžných požadavků při spuštění nebo mají zátěžové zatížení (kde se souběžně roste souběžně), probíhá asynchronní volání webové služby, čímž se zvýší rychlost odezvy vaší aplikace.</span><span class="sxs-lookup"><span data-stu-id="874db-149">In web applications that see a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous will increase the responsiveness of your application.</span></span> <span data-ttu-id="874db-150">Asynchronní požadavek trvá zpracování jako synchronní požadavek stejným časem.</span><span class="sxs-lookup"><span data-stu-id="874db-150">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="874db-151">Například pokud požadavek provede volání webové služby, které vyžaduje dokončení dvou sekund, požadavek trvá dvě sekundy, ať už se provádí synchronně nebo asynchronně.</span><span class="sxs-lookup"><span data-stu-id="874db-151">For example, if a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it is performed synchronously or asynchronously.</span></span> <span data-ttu-id="874db-152">Během asynchronního volání však vlákno neblokuje odpověď na jiné požadavky, zatímco čeká na dokončení první žádosti.</span><span class="sxs-lookup"><span data-stu-id="874db-152">However, during an asynchronous call, a thread is not blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="874db-153">Asynchronní požadavky proto zabraňují zařazování požadavků a nárůstu fondu vláken, pokud existuje celá řada souběžných požadavků, které spouštějí dlouhotrvající operace.</span><span class="sxs-lookup"><span data-stu-id="874db-153">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a><span data-ttu-id="874db-154">Výběr synchronních nebo asynchronních metod</span><span class="sxs-lookup"><span data-stu-id="874db-154">Choosing Synchronous or Asynchronous Methods</span></span>

<span data-ttu-id="874db-155">V této části jsou uvedeny pokyny pro použití synchronních nebo asynchronních metod.</span><span class="sxs-lookup"><span data-stu-id="874db-155">This section lists guidelines for when to use synchronous or asynchronous Methods.</span></span> <span data-ttu-id="874db-156">Jsou to jenom pokyny. Prověřte každou aplikaci jednotlivě a určete, zda asynchronní metody pomůžou s výkonem.</span><span class="sxs-lookup"><span data-stu-id="874db-156">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="874db-157">Obecně platí, že použijte synchronní metody pro následující podmínky:</span><span class="sxs-lookup"><span data-stu-id="874db-157">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="874db-158">Operace jsou jednoduché nebo krátkodobé.</span><span class="sxs-lookup"><span data-stu-id="874db-158">The operations are simple or short-running.</span></span>
- <span data-ttu-id="874db-159">Jednoduchost je důležitější než efektivita.</span><span class="sxs-lookup"><span data-stu-id="874db-159">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="874db-160">Operace jsou primárně operace CPU místo operací, které zahrnují velký výkon disku nebo síťové režie.</span><span class="sxs-lookup"><span data-stu-id="874db-160">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="874db-161">Použití asynchronních metod na operacích vázaných na procesor poskytuje žádné výhody a má za následek větší režii.</span><span class="sxs-lookup"><span data-stu-id="874db-161">Using asynchronous methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

<span data-ttu-id="874db-162">Obecně použijte asynchronní metody pro následující podmínky:</span><span class="sxs-lookup"><span data-stu-id="874db-162">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="874db-163">Voláte služby, které mohou být spotřebovány prostřednictvím asynchronních metod, a používáte rozhraní .NET 4,5 nebo vyšší.</span><span class="sxs-lookup"><span data-stu-id="874db-163">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="874db-164">Operace jsou vázané na síť nebo vstupně-výstupní operace, nikoli vázané na procesor.</span><span class="sxs-lookup"><span data-stu-id="874db-164">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="874db-165">Paralelismus je důležitější než jednoduchost kódu.</span><span class="sxs-lookup"><span data-stu-id="874db-165">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="874db-166">Chcete poskytnout mechanismus, který umožňuje uživatelům zrušit dlouho běžící požadavek.</span><span class="sxs-lookup"><span data-stu-id="874db-166">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="874db-167">Pokud výhoda přepínání vláken převáží náklady na přepínač kontextu.</span><span class="sxs-lookup"><span data-stu-id="874db-167">When the benefit of switching threads outweighs the cost of the context switch.</span></span> <span data-ttu-id="874db-168">Obecně byste měli provést asynchronní metodu, pokud synchronní metoda blokuje vlákno žádosti ASP.NET při nečinnosti.</span><span class="sxs-lookup"><span data-stu-id="874db-168">In general, you should make a method asynchronous if the synchronous method blocks the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="874db-169">Voláním asynchronního volání není vlákno požadavku ASP.NET zablokováno, protože při čekání na dokončení požadavku webové služby nebude fungovat.</span><span class="sxs-lookup"><span data-stu-id="874db-169">By making the call asynchronous, the ASP.NET request thread is not blocked doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="874db-170">Testování ukazuje, že blokující operace jsou kritické pro výkon lokality a že služba IIS může obsluhovat více požadavků pomocí asynchronních metod pro tato blokující volání.</span><span class="sxs-lookup"><span data-stu-id="874db-170">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

  <span data-ttu-id="874db-171">Ukázka ke stažení ukazuje, jak efektivně používat asynchronní metody.</span><span class="sxs-lookup"><span data-stu-id="874db-171">The downloadable sample shows how to use asynchronous methods effectively.</span></span> <span data-ttu-id="874db-172">Uvedená ukázka byla navržena tak, aby poskytovala jednoduchou ukázku asynchronního programování v ASP.NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="874db-172">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET 4.5.</span></span> <span data-ttu-id="874db-173">Vzorek není určen jako referenční architektura pro asynchronní programování v ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="874db-173">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET.</span></span> <span data-ttu-id="874db-174">Vzorový program volá metody [ASP.NET webového rozhraní API](../../../web-api/index.md) , které zavolají [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) pro simulaci dlouhotrvajících volání webové služby.</span><span class="sxs-lookup"><span data-stu-id="874db-174">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="874db-175">Většina produkčních aplikací nebude zobrazovat takové zjevné výhody použití asynchronních metod.</span><span class="sxs-lookup"><span data-stu-id="874db-175">Most production applications will not show such obvious benefits to using asynchronous Methods.</span></span>   
  
<span data-ttu-id="874db-176">Několik aplikací vyžaduje, aby všechny metody byly asynchronní.</span><span class="sxs-lookup"><span data-stu-id="874db-176">Few applications require all methods to be asynchronous.</span></span> <span data-ttu-id="874db-177">Často převod několika synchronních metod na asynchronní metody poskytuje nejlepší zvýšení efektivity požadované práce.</span><span class="sxs-lookup"><span data-stu-id="874db-177">Often, converting a few synchronous methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a><span data-ttu-id="874db-178">Ukázková aplikace</span><span class="sxs-lookup"><span data-stu-id="874db-178">The Sample Application</span></span>

<span data-ttu-id="874db-179">Ukázkovou aplikaci si můžete stáhnout z [https://github.com/RickAndMSFT/Async-ASP.NET](https://github.com/RickAndMSFT/Async-ASP.NET) na webu [GitHub](https://github.com/) .</span><span class="sxs-lookup"><span data-stu-id="874db-179">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="874db-180">Úložiště se skládá ze tří projektů:</span><span class="sxs-lookup"><span data-stu-id="874db-180">The repository consists of three projects:</span></span>

- <span data-ttu-id="874db-181">*WebAppAsync*: projekt webových formulářů ASP.NET, který využívá službu webového rozhraní API **WebAPIpwg** .</span><span class="sxs-lookup"><span data-stu-id="874db-181">*WebAppAsync*: The ASP.NET Web Forms project that consumes the Web API **WebAPIpwg** service.</span></span> <span data-ttu-id="874db-182">Většina kódu pro tento kurz je z tohoto projektu.</span><span class="sxs-lookup"><span data-stu-id="874db-182">Most of the code for this tutorial is from the this project.</span></span>
- <span data-ttu-id="874db-183">*WebAPIpgw*: projekt webového rozhraní API ASP.NET MVC 4, který implementuje řadiče `Products, Gizmos and Widgets`.</span><span class="sxs-lookup"><span data-stu-id="874db-183">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="874db-184">Poskytuje data pro projekt *WebAppAsync* a projekt *Mvc4Async* .</span><span class="sxs-lookup"><span data-stu-id="874db-184">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="874db-185">*Mvc4Async*: projekt ASP.NET MVC 4, který obsahuje kód používaný v jiném kurzu.</span><span class="sxs-lookup"><span data-stu-id="874db-185">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in another tutorial.</span></span> <span data-ttu-id="874db-186">Provádí volání rozhraní Web API ke službě **WebAPIpwg** .</span><span class="sxs-lookup"><span data-stu-id="874db-186">It makes Web API calls to the **WebAPIpwg** service.</span></span>

## <a id="GizmosSynch"></a><span data-ttu-id="874db-187">Synchronní stránka Gizma</span><span class="sxs-lookup"><span data-stu-id="874db-187">The Gizmos Synchronous Page</span></span>

 <span data-ttu-id="874db-188">Následující kód ukazuje `Page_Load` synchronní metodu, která slouží k zobrazení seznamu gizma.</span><span class="sxs-lookup"><span data-stu-id="874db-188">The following code shows the `Page_Load` synchronous method that is used to display a list of gizmos.</span></span> <span data-ttu-id="874db-189">(Pro tento článek je Gizmo fiktivní mechanické zařízení.)</span><span class="sxs-lookup"><span data-stu-id="874db-189">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample1.cs)]

<span data-ttu-id="874db-190">Následující kód ukazuje metodu `GetGizmos` služby Gizmo.</span><span class="sxs-lookup"><span data-stu-id="874db-190">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample2.cs)]

<span data-ttu-id="874db-191">Metoda `GizmoService GetGizmos` předává identifikátor URI službě HTTP webového rozhraní API ASP.NET, která vrací seznam dat gizma.</span><span class="sxs-lookup"><span data-stu-id="874db-191">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="874db-192">Projekt *WebAPIpgw* obsahuje implementaci `gizmos, widget` webového rozhraní API a `product`ch řadičů.</span><span class="sxs-lookup"><span data-stu-id="874db-192">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="874db-193">Následující obrázek ukazuje stránku gizma z ukázkového projektu.</span><span class="sxs-lookup"><span data-stu-id="874db-193">The following image shows the gizmos page from the sample project.</span></span>

![Gizma](using-asynchronous-methods-in-aspnet-45/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a><span data-ttu-id="874db-195">Vytvoření asynchronní stránky Gizma</span><span class="sxs-lookup"><span data-stu-id="874db-195">Creating an Asynchronous Gizmos Page</span></span>

<span data-ttu-id="874db-196">Ukázka používá nová klíčová slova [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) a [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (k dispozici v rozhraních .NET 4,5 a Visual Studio 2012), aby kompilátor mohl být zodpovědný za údržbu složitých transformací potřebných pro asynchronní programování.</span><span class="sxs-lookup"><span data-stu-id="874db-196">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="874db-197">Kompilátor umožňuje psát kód pomocí C#konstrukce asynchronního toku řízení a kompilátor automaticky aplikuje transformace potřebné k použití zpětných volání, aby nedocházelo k blokování vláken.</span><span class="sxs-lookup"><span data-stu-id="874db-197">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="874db-198">Asynchronní stránky ASP.NET musí zahrnovat direktivu [stránky](https://msdn.microsoft.com/library/ydy4x04a.aspx) s atributem `Async` nastaveným na hodnotu "true".</span><span class="sxs-lookup"><span data-stu-id="874db-198">ASP.NET asynchronous pages must include the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true".</span></span> <span data-ttu-id="874db-199">Následující kód ukazuje direktivu [stránky](https://msdn.microsoft.com/library/ydy4x04a.aspx) s atributem `Async` nastaveným na hodnotu "true" pro stránku *GizmosAsync. aspx* .</span><span class="sxs-lookup"><span data-stu-id="874db-199">The following code shows the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true" for the *GizmosAsync.aspx* page.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample3.aspx?highlight=1)]

<span data-ttu-id="874db-200">Následující kód ukazuje `Gizmos` metodu synchronního `Page_Load` a `GizmosAsync` asynchronní stránku.</span><span class="sxs-lookup"><span data-stu-id="874db-200">The following code shows the `Gizmos` synchronous `Page_Load` method and the `GizmosAsync` asynchronous page.</span></span> <span data-ttu-id="874db-201">Pokud prohlížeč podporuje [&gt; elementu &lt;značkami HTML 5](http://www.w3.org/wiki/HTML/Elements/mark), uvidíte změny v `GizmosAsync` žlutým zvýrazněním.</span><span class="sxs-lookup"><span data-stu-id="874db-201">If your browser supports the [HTML 5 &lt;mark&gt; element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample4.cs)]

<span data-ttu-id="874db-202">Asynchronní verze:</span><span class="sxs-lookup"><span data-stu-id="874db-202">The asynchronous version:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample5.cs?highlight=3,6-7,9,11)]

 <span data-ttu-id="874db-203">Pro povolení asynchronní stránky `GizmosAsync` byly aplikovány následující změny.</span><span class="sxs-lookup"><span data-stu-id="874db-203">The following changes were applied to allow the `GizmosAsync` page be asynchronous.</span></span>

- <span data-ttu-id="874db-204">Direktiva [stránky](https://msdn.microsoft.com/library/ydy4x04a.aspx) musí mít atribut `Async` nastaven na hodnotu "true".</span><span class="sxs-lookup"><span data-stu-id="874db-204">The [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive must have the `Async` attribute set to "true".</span></span>
- <span data-ttu-id="874db-205">Metoda `RegisterAsyncTask` slouží k registraci asynchronní úlohy obsahující kód, který běží asynchronně.</span><span class="sxs-lookup"><span data-stu-id="874db-205">The `RegisterAsyncTask` method is used to register an asynchronous task containing the code which runs asynchronously.</span></span>
- <span data-ttu-id="874db-206">Nová metoda `GetGizmosSvcAsync` je označena pomocí klíčového slova [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , které kompilátor instruuje, aby vygeneroval zpětná volání pro části těla a automaticky vytvořila vrácenou `Task`.</span><span class="sxs-lookup"><span data-stu-id="874db-206">The new `GetGizmosSvcAsync` method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task` that is returned.</span></span>
- <span data-ttu-id="874db-207">k názvu asynchronní metody byla připojena &quot;Async&quot;.</span><span class="sxs-lookup"><span data-stu-id="874db-207">&quot;Async&quot; was appended to the asynchronous method name.</span></span> <span data-ttu-id="874db-208">Připojení "Async" není vyžadováno, ale je to konvence při psaní asynchronních metod.</span><span class="sxs-lookup"><span data-stu-id="874db-208">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="874db-209">Návratový typ nové metody `GetGizmosSvcAsync` je `Task`.</span><span class="sxs-lookup"><span data-stu-id="874db-209">The return type of the new `GetGizmosSvcAsync` method is `Task`.</span></span> <span data-ttu-id="874db-210">Návratový typ `Task` představuje průběžnou práci a poskytuje volajícím metody s popisovačem, přes který má počkat na dokončení asynchronní operace.</span><span class="sxs-lookup"><span data-stu-id="874db-210">The return type of `Task` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span>
- <span data-ttu-id="874db-211">Klíčové slovo [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) bylo použito pro volání webové služby.</span><span class="sxs-lookup"><span data-stu-id="874db-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="874db-212">Bylo voláno rozhraní API asynchronní webové služby (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="874db-212">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="874db-213">V těle metody `GetGizmosSvcAsync` jiné asynchronní metody je volána `GetGizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="874db-213">Inside of the `GetGizmosSvcAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="874db-214">`GetGizmosAsync` okamžitě vrátí `Task<List<Gizmo>>`, která se nakonec dokončí, když budou data k dispozici.</span><span class="sxs-lookup"><span data-stu-id="874db-214">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="874db-215">Vzhledem k tomu, že nechcete nic dalšího dělat, dokud nebudete mít Gizmo data, kód očekává úlohu (pomocí klíčového slova **await** ).</span><span class="sxs-lookup"><span data-stu-id="874db-215">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="874db-216">Klíčové slovo **await** lze použít pouze v metodách popsaných pomocí klíčového slova **Async** .</span><span class="sxs-lookup"><span data-stu-id="874db-216">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="874db-217">Klíčové slovo **await** neblokuje vlákno, dokud není úloha dokončena.</span><span class="sxs-lookup"><span data-stu-id="874db-217">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="874db-218">Zaregistruje zbytek metody jako zpětné volání na úkolu a okamžitě se vrátí.</span><span class="sxs-lookup"><span data-stu-id="874db-218">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="874db-219">Když se nakonec očekávaný úkol dokončí, vyvolá toto zpětné volání, takže bude pokračovat v provádění metody přímo tam, kde byla vypnuta.</span><span class="sxs-lookup"><span data-stu-id="874db-219">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="874db-220">Další informace o použití klíčových slov [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) a [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) a oboru názvů [úkolů](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) naleznete v tématu [asynchronní odkazy](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="874db-220">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="874db-221">Následující kód ukazuje metody `GetGizmos` a `GetGizmosAsync`.</span><span class="sxs-lookup"><span data-stu-id="874db-221">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample6.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample7.cs?highlight=1,4-8)]

 <span data-ttu-id="874db-222">Asynchronní změny jsou podobné těm, které jste udělali výše v **GizmosAsync** .</span><span class="sxs-lookup"><span data-stu-id="874db-222">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="874db-223">Podpis metody byl opatřen poznámkami pomocí klíčového slova [Async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) , návratový typ byl změněn na `Task<List<Gizmo>>`a k názvu metody byl přidán *Async* .</span><span class="sxs-lookup"><span data-stu-id="874db-223">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="874db-224">Namísto synchronní třídy [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) se používá asynchronní třída [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="874db-224">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the synchronous [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="874db-225">Klíčové slovo [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) bylo použito pro asynchronní metodu [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx)[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) .</span><span class="sxs-lookup"><span data-stu-id="874db-225">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx)[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) asynchronous method.</span></span>

<span data-ttu-id="874db-226">Na následujícím obrázku vidíte zobrazení asynchronního Gizmo.</span><span class="sxs-lookup"><span data-stu-id="874db-226">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-45/_static/image2.png)

<span data-ttu-id="874db-228">Prezentace prohlížečů gizma dat je shodná se zobrazením vytvořeným synchronním voláním.</span><span class="sxs-lookup"><span data-stu-id="874db-228">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="874db-229">Jediným rozdílem je, že asynchronní verze může být větší výkon při velkém zatížení.</span><span class="sxs-lookup"><span data-stu-id="874db-229">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a name="registerasynctask-notes"></a><span data-ttu-id="874db-230">RegisterAsyncTask poznámky</span><span class="sxs-lookup"><span data-stu-id="874db-230">RegisterAsyncTask Notes</span></span>

<span data-ttu-id="874db-231">Metody zapojování s `RegisterAsyncTask` budou spouštěny ihned po provedení [fáze PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span><span class="sxs-lookup"><span data-stu-id="874db-231">Methods hooked up with `RegisterAsyncTask` will run immediately after [PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span></span> <span data-ttu-id="874db-232">Můžete také použít asynchronní události void stránky přímo, jak je znázorněno v následujícím kódu:</span><span class="sxs-lookup"><span data-stu-id="874db-232">You can also use async void page events directly, as shown in the following code:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample8.cs)]

<span data-ttu-id="874db-233">Nevýhodou na asynchronní události void je, že vývojáři již mají při spuštění událostí plnou kontrolu.</span><span class="sxs-lookup"><span data-stu-id="874db-233">The downside to async void events is that developers no longer has full control over when events execute.</span></span> <span data-ttu-id="874db-234">Například pokud. aspx a. Hlavní definice `Page_Load` události a jedna nebo obě jsou asynchronní, pořadí spouštění nelze zaručit.</span><span class="sxs-lookup"><span data-stu-id="874db-234">For example, if both an .aspx and a .Master define `Page_Load` events and one or both of them are asynchronous, the order of execution can't be guaranteed.</span></span> <span data-ttu-id="874db-235">Platí stejné indeterminiate pořadí pro obslužné rutiny událostí bez události (například `async void Button_Click`).</span><span class="sxs-lookup"><span data-stu-id="874db-235">The same indeterminiate order for non event handlers (such as `async void Button_Click` ) applies.</span></span> <span data-ttu-id="874db-236">Pro většinu vývojářů to by mělo být přijatelné, ale ty, kteří vyžadují plnou kontrolu nad pořadím spuštění, by měli používat jenom rozhraní API, jako je `RegisterAsyncTask`, které využívají metody, které vracejí objekt Task.</span><span class="sxs-lookup"><span data-stu-id="874db-236">For most developers this should be acceptable, but those who require full control over the order of execution should only use APIs like `RegisterAsyncTask` that consume methods which return a Task object.</span></span>

## <a id="Parallel"></a><span data-ttu-id="874db-237">Paralelní provádění více operací</span><span class="sxs-lookup"><span data-stu-id="874db-237">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="874db-238">Asynchronní metody mají významnou výhodu oproti synchronním metodám, pokud akce musí provádět několik nezávislých operací.</span><span class="sxs-lookup"><span data-stu-id="874db-238">Asynchronous Methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="874db-239">V zadané ukázce zobrazuje synchronní stránka *pwg. aspx*(pro produkty, widgety a gizma) výsledky tří volání webové služby a získá seznam produktů, widgetů a gizma.</span><span class="sxs-lookup"><span data-stu-id="874db-239">In the sample provided, the synchronous page *PWG.aspx*(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="874db-240">Projekt [webového rozhraní API ASP.NET](../../../web-api/index.md) , který poskytuje tyto služby, používá [Task. Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) k simulaci latence nebo pomalých síťových volání.</span><span class="sxs-lookup"><span data-stu-id="874db-240">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="874db-241">Když je zpoždění nastavené na 500 milisekund, *PWGasync* stránka asynchronního přenosu po dobu delší než 500 ms trvá, zatímco synchronní `PWG`á verze přebírá více než 1 500 milisekund.</span><span class="sxs-lookup"><span data-stu-id="874db-241">When the delay is set to 500 milliseconds, the asynchronous *PWGasync.aspx* page takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="874db-242">Synchronní stránka *pwg. aspx* je zobrazena v následujícím kódu.</span><span class="sxs-lookup"><span data-stu-id="874db-242">The synchronous *PWG.aspx* page is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample9.cs)]

<span data-ttu-id="874db-243">Asynchronní kód `PWGasync` na pozadí je uveden níže.</span><span class="sxs-lookup"><span data-stu-id="874db-243">The asynchronous `PWGasync` code behind is shown below.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample10.cs?highlight=5,11,21)]

<span data-ttu-id="874db-244">Na následujícím obrázku vidíte zobrazení vrácené ze stránky asynchronní *PWGasync. aspx* .</span><span class="sxs-lookup"><span data-stu-id="874db-244">The following image shows the view returned from the asynchronous *PWGasync.aspx* page.</span></span>

![](using-asynchronous-methods-in-aspnet-45/_static/image3.png)

## <a id="CancelToken"></a><span data-ttu-id="874db-245">Použití tokenu zrušení</span><span class="sxs-lookup"><span data-stu-id="874db-245">Using a Cancellation Token</span></span>

<span data-ttu-id="874db-246">Asynchronní metody vracející `Task`jsou zrušitelné, to znamená, že převezmou parametr [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) , pokud je k dispozici atribut `AsyncTimeout` direktivy [stránky](https://msdn.microsoft.com/library/ydy4x04a.aspx) .</span><span class="sxs-lookup"><span data-stu-id="874db-246">Asynchronous Methods returning `Task`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the `AsyncTimeout` attribute of the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive.</span></span> <span data-ttu-id="874db-247">Následující kód ukazuje stránku *GizmosCancelAsync. aspx* s časovým limitem sekund.</span><span class="sxs-lookup"><span data-stu-id="874db-247">The following code shows the *GizmosCancelAsync.aspx* page with a timeout of on second.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample11.aspx?highlight=1)]

<span data-ttu-id="874db-248">Následující kód ukazuje soubor *GizmosCancelAsync.aspx.cs* .</span><span class="sxs-lookup"><span data-stu-id="874db-248">The following code shows the *GizmosCancelAsync.aspx.cs* file.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample12.cs?highlight=6,9)]

<span data-ttu-id="874db-249">V poskytnuté ukázkové aplikaci výběr odkazu *GizmosCancelAsync* volá stránku *GizmosCancelAsync. aspx* a demonstruje zrušení (časování) asynchronního volání.</span><span class="sxs-lookup"><span data-stu-id="874db-249">In the sample application provided, selecting the *GizmosCancelAsync* link calls the *GizmosCancelAsync.aspx* page and demonstrates the cancellation (by timing out) of the asynchronous call.</span></span> <span data-ttu-id="874db-250">Vzhledem k tomu, že doba zpoždění spadá do náhodného rozsahu, může být nutné stránku několikrát aktualizovat, aby se zobrazila chybová zpráva.</span><span class="sxs-lookup"><span data-stu-id="874db-250">Because the delay time is within a random range, you might need to refresh the page a couple times to get the time out error message.</span></span>

## <a id="ServerConfig"></a><span data-ttu-id="874db-251">Konfigurace serveru pro volání webové služby vysoké souběžnosti nebo vysoké latence</span><span class="sxs-lookup"><span data-stu-id="874db-251">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="874db-252">Aby bylo možné využít výhody asynchronní webové aplikace, může být nutné provést některé změny výchozí konfigurace serveru.</span><span class="sxs-lookup"><span data-stu-id="874db-252">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="874db-253">Při konfiguraci a zátěži testování asynchronní webové aplikace mějte na paměti následující skutečnosti.</span><span class="sxs-lookup"><span data-stu-id="874db-253">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="874db-254">Windows 7, Windows Vista, Window 8 a všechny klientské operační systémy Windows mají maximálně 10 souběžných požadavků.</span><span class="sxs-lookup"><span data-stu-id="874db-254">Windows 7, Windows Vista, Window 8, and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="874db-255">Budete potřebovat serverový operační systém Windows, abyste viděli výhody asynchronních metod při vysokém zatížení.</span><span class="sxs-lookup"><span data-stu-id="874db-255">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="874db-256">Pomocí následujícího příkazu zaregistrujte .NET 4,5 se službou IIS z příkazového řádku se zvýšenými oprávněními:</span><span class="sxs-lookup"><span data-stu-id="874db-256">Register .NET 4.5 with IIS from an elevated command prompt using the following command:</span></span>  
  <span data-ttu-id="874db-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis – i</span><span class="sxs-lookup"><span data-stu-id="874db-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis -i</span></span>  
  <span data-ttu-id="874db-258">Viz [registrační nástroj služby IIS pro ASP.NET (Aspnet\_regiis. exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx) .</span><span class="sxs-lookup"><span data-stu-id="874db-258">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="874db-259">Možná budete muset zvýšit limit fronty [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) z výchozí hodnoty 1 000 na 5 000.</span><span class="sxs-lookup"><span data-stu-id="874db-259">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="874db-260">Pokud je nastavení příliš nízké, může se stát, že žádosti o odmítnutí [http. sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) se zobrazí ve stavu HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="874db-260">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="874db-261">Změna limitu fronty HTTP. sys:</span><span class="sxs-lookup"><span data-stu-id="874db-261">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="874db-262">Otevřete Správce služby IIS a přejděte do podokna fondy aplikací.</span><span class="sxs-lookup"><span data-stu-id="874db-262">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="874db-263">Klikněte pravým tlačítkem na cílový fond aplikací a vyberte **Upřesnit nastavení**.</span><span class="sxs-lookup"><span data-stu-id="874db-263">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="874db-264">![pokročilé](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="874db-264">![advanced](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span></span>
    - <span data-ttu-id="874db-265">V dialogovém okně **Upřesnit nastavení** změňte *délku fronty* z 1 000 na 5 000.</span><span class="sxs-lookup"><span data-stu-id="874db-265">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="874db-266">Délka fronty ![](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="874db-266">![Queue length](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span></span>  
  
  <span data-ttu-id="874db-267">Všimněte si, že na obrázcích výše je rozhraní .NET Framework uvedeno jako v 4.0, i když fond aplikací používá rozhraní .NET 4,5.</span><span class="sxs-lookup"><span data-stu-id="874db-267">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="874db-268">Pro pochopení této nesrovnalosti si přečtěte následující informace:</span><span class="sxs-lookup"><span data-stu-id="874db-268">To understand this discrepancy, see the following:</span></span>

- [<span data-ttu-id="874db-269">Verze rozhraní .NET a cílení na více verzí – .NET 4,5 je místní upgrade na rozhraní .NET 4,0</span><span class="sxs-lookup"><span data-stu-id="874db-269">.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0</span></span>](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
- [<span data-ttu-id="874db-270">Jak nastavit aplikaci IIS nebo službu AppPool na použití ASP.NET 3,5 místo 2,0</span><span class="sxs-lookup"><span data-stu-id="874db-270">How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0</span></span>](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
- <span data-ttu-id="874db-271">[.NET Framework verze a závislosti](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span><span class="sxs-lookup"><span data-stu-id="874db-271">[.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)</span></span>

- <span data-ttu-id="874db-272">Pokud vaše aplikace používá webové služby nebo System.NET ke komunikaci s back-endu přes protokol HTTP, může být nutné zvýšit [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span><span class="sxs-lookup"><span data-stu-id="874db-272">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="874db-273">U aplikací ASP.NET to je omezené funkcí Automatická konfigurace na 12 časů počtu procesorů.</span><span class="sxs-lookup"><span data-stu-id="874db-273">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="874db-274">To znamená, že u čtyřjádrových procesů můžete mít maximálně 12 \* 4 = 48 souběžných připojení k koncovému bodu IP adres.</span><span class="sxs-lookup"><span data-stu-id="874db-274">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="874db-275">Vzhledem k tomu, že se jedná o přizpůsobitelné [automatické konfigurace](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), nejjednodušší způsob, jak zvýšit `maxconnection` v aplikaci ASP.NET, je nastavit [System .NET. Třída ServicePointManager. DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programově v metodě `Application_Start` v souboru *Global. asax* .</span><span class="sxs-lookup"><span data-stu-id="874db-275">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="874db-276">Příklad najdete v ukázkovém souboru ke stažení.</span><span class="sxs-lookup"><span data-stu-id="874db-276">See the sample download for an example.</span></span>
- <span data-ttu-id="874db-277">V rozhraní .NET 4,5 by měla být výchozí hodnota 5000 pro [maxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) .</span><span class="sxs-lookup"><span data-stu-id="874db-277">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>

## <a name="contributors"></a><span data-ttu-id="874db-278">Spoluautoři</span><span class="sxs-lookup"><span data-stu-id="874db-278">Contributors</span></span>

- [<span data-ttu-id="874db-279">Broderick dávky</span><span class="sxs-lookup"><span data-stu-id="874db-279">Levi Broderick</span></span>](http://stackoverflow.com/users/59641/levi)
- [<span data-ttu-id="874db-280">Dykstra</span><span class="sxs-lookup"><span data-stu-id="874db-280">Tom Dykstra</span></span>](http://www.bing.com/search?q=site%3Aasp.net+%22Tom+Dykstra%22+-forums.asp.net&amp;qs=n&amp;form=QBRE&amp;pq=site%3Aasp.net+%22tom+dykstra%22+-forums.asp.net&amp;sc=8-42&amp;sp=-1&amp;sk=)
- [<span data-ttu-id="874db-281">Brad Wilson</span><span class="sxs-lookup"><span data-stu-id="874db-281">Brad Wilson</span></span>](http://bradwilson.typepad.com/)
- [<span data-ttu-id="874db-282">HongMei GE</span><span class="sxs-lookup"><span data-stu-id="874db-282">HongMei Ge</span></span>](https://blogs.msdn.com/b/hongmeig/)
