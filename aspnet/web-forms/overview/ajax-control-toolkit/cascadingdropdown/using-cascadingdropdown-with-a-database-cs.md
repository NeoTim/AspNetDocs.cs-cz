---
uid: web-forms/overview/ajax-control-toolkit/cascadingdropdown/using-cascadingdropdown-with-a-database-cs
title: Použití CascadingDropDown s databází (C#) | Microsoft Docs
author: wenz
description: Ovládací prvek CascadingDropDown v sadě nástrojů AJAX Control Toolkit rozšiřuje ovládací prvek DropDownList tak, aby změny v jednom DropDownList načítají přidružené hodnoty v anoth...
ms.author: riande
ms.date: 06/02/2008
ms.assetid: 684f0c28-a490-4e5b-b5e5-5dfb77464b49
msc.legacyurl: /web-forms/overview/ajax-control-toolkit/cascadingdropdown/using-cascadingdropdown-with-a-database-cs
msc.type: authoredcontent
ms.openlocfilehash: bcf453170d17807b4e3b2d2a8b545cba43139f89
ms.sourcegitcommit: 22fbd8863672c4ad6693b8388ad5c8e753fb41a2
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 11/28/2019
ms.locfileid: "74599779"
---
# <a name="using-cascadingdropdown-with-a-database-c"></a><span data-ttu-id="c7694-103">Použití ovládacího prvku CascadingDropDown s databází (C#)</span><span class="sxs-lookup"><span data-stu-id="c7694-103">Using CascadingDropDown with a Database (C#)</span></span>

<span data-ttu-id="c7694-104">od [Christian Wenz](https://github.com/wenz)</span><span class="sxs-lookup"><span data-stu-id="c7694-104">by [Christian Wenz](https://github.com/wenz)</span></span>

<span data-ttu-id="c7694-105">[Stažení kódu](https://download.microsoft.com/download/9/0/7/907760b1-2c60-4f81-aeb6-ca416a573b0d/cascadingdropdown1.cs.zip) nebo [stažení PDF](https://download.microsoft.com/download/2/d/c/2dc10e34-6983-41d4-9c08-f78f5387d32b/cascadingdropdown1CS.pdf)</span><span class="sxs-lookup"><span data-stu-id="c7694-105">[Download Code](https://download.microsoft.com/download/9/0/7/907760b1-2c60-4f81-aeb6-ca416a573b0d/cascadingdropdown1.cs.zip) or [Download PDF](https://download.microsoft.com/download/2/d/c/2dc10e34-6983-41d4-9c08-f78f5387d32b/cascadingdropdown1CS.pdf)</span></span>

> <span data-ttu-id="c7694-106">Ovládací prvek CascadingDropDown v sadě nástrojů AJAX Control Toolkit rozšiřuje ovládací prvek DropDownList tak, aby změny v jednom DropDownList načítají přidružené hodnoty v jiné DropDownList.</span><span class="sxs-lookup"><span data-stu-id="c7694-106">The CascadingDropDown control in the AJAX Control Toolkit extends a DropDownList control so that changes in one DropDownList loads associated values in another DropDownList.</span></span> <span data-ttu-id="c7694-107">Aby to fungovalo, musí být vytvořená speciální webová služba.</span><span class="sxs-lookup"><span data-stu-id="c7694-107">In order for this to work, a special web service must be created.</span></span>

## <a name="overview"></a><span data-ttu-id="c7694-108">Přehled</span><span class="sxs-lookup"><span data-stu-id="c7694-108">Overview</span></span>

<span data-ttu-id="c7694-109">Ovládací prvek CascadingDropDown v sadě nástrojů AJAX Control Toolkit rozšiřuje ovládací prvek DropDownList tak, aby změny v jednom DropDownList načítají přidružené hodnoty v jiné DropDownList.</span><span class="sxs-lookup"><span data-stu-id="c7694-109">The CascadingDropDown control in the AJAX Control Toolkit extends a DropDownList control so that changes in one DropDownList loads associated values in another DropDownList.</span></span> <span data-ttu-id="c7694-110">(Například jeden seznam obsahuje seznam stavů USA a další seznam se pak vyplní hlavními městy v tomto stavu.) Aby to fungovalo, musí být vytvořená speciální webová služba.</span><span class="sxs-lookup"><span data-stu-id="c7694-110">(For instance, one list provides a list of US states, and the next list is then filled with major cities in that state.) In order for this to work, a special web service must be created.</span></span>

## <a name="steps"></a><span data-ttu-id="c7694-111">Uvedené</span><span class="sxs-lookup"><span data-stu-id="c7694-111">Steps</span></span>

<span data-ttu-id="c7694-112">Nejdříve je vyžadován zdroj dat.</span><span class="sxs-lookup"><span data-stu-id="c7694-112">First of all, a data source is required.</span></span> <span data-ttu-id="c7694-113">V této ukázce se používá databáze AdventureWorks a edice Microsoft SQL Server 2005 Express.</span><span class="sxs-lookup"><span data-stu-id="c7694-113">This sample uses the AdventureWorks database and the Microsoft SQL Server 2005 Express Edition.</span></span> <span data-ttu-id="c7694-114">Databáze je volitelnou součástí instalace sady Visual Studio (včetně Express Edition) a je k dispozici také jako samostatné stažení v rámci [https://go.microsoft.com/fwlink/?LinkId=64064](https://go.microsoft.com/fwlink/?LinkId=64064).</span><span class="sxs-lookup"><span data-stu-id="c7694-114">The database is an optional part of a Visual Studio installation (including express edition) and is also available as a separate download under [https://go.microsoft.com/fwlink/?LinkId=64064](https://go.microsoft.com/fwlink/?LinkId=64064).</span></span> <span data-ttu-id="c7694-115">Databáze AdventureWorks je součástí ukázek SQL Server 2005 a ukázkových databází (Stáhnout v [https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;D isplaylang = EN](https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en)).</span><span class="sxs-lookup"><span data-stu-id="c7694-115">The AdventureWorks database is part of the SQL Server 2005 Samples and Sample Databases (download at [https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en](https://www.microsoft.com/downloads/details.aspx?FamilyID=e719ecf7-9f46-4312-af89-6ad8702e4e6e&amp;DisplayLang=en)).</span></span> <span data-ttu-id="c7694-116">Nejjednodušší způsob, jak nastavit databázi, je použít Microsoft SQL Server Management Studio Express ([https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;D isplaylang = EN](https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en)) a připojit soubor databáze `AdventureWorks.mdf`.</span><span class="sxs-lookup"><span data-stu-id="c7694-116">The easiest way to set the database up is to use the Microsoft SQL Server Management Studio Express ([https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en](https://www.microsoft.com/downloads/details.aspx?FamilyID=c243a5ae-4bd1-4e3d-94b8-5a0f62bf7796&amp;DisplayLang=en)) and attach the `AdventureWorks.mdf` database file.</span></span>

<span data-ttu-id="c7694-117">V této ukázce předpokládáme, že instance SQL Server 2005 Express Edition se nazývá `SQLEXPRESS` a nachází se na stejném počítači jako webový server. Toto je také výchozí nastavení.</span><span class="sxs-lookup"><span data-stu-id="c7694-117">For this sample, we assume that the instance of the SQL Server 2005 Express Edition is called `SQLEXPRESS` and resides on the same machine as the web server; this is also the default setup.</span></span> <span data-ttu-id="c7694-118">Pokud se instalace liší, je nutné upravit informace o připojení pro databázi.</span><span class="sxs-lookup"><span data-stu-id="c7694-118">If your setup differs, you have to adapt the connection information for the database.</span></span>

<span data-ttu-id="c7694-119">Aby bylo možné aktivovat funkce ASP.NET AJAX a Control Toolkit, musí být ovládací prvek `ScriptManager` umístěn kdekoli na stránce (ale v &lt;`form`elementu &gt;):</span><span class="sxs-lookup"><span data-stu-id="c7694-119">In order to activate the functionality of ASP.NET AJAX and the Control Toolkit, the `ScriptManager` control must be put anywhere on the page (but within the &lt;`form`&gt; element):</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample1.aspx)]

<span data-ttu-id="c7694-120">V dalším kroku jsou vyžadovány dva ovládací prvky DropDownList.</span><span class="sxs-lookup"><span data-stu-id="c7694-120">In the next step, two DropDownList controls are required.</span></span> <span data-ttu-id="c7694-121">V této ukázce používáme dodavatele a kontaktní údaje od společnosti AdventureWorks, takže vytvoříme jeden seznam pro dostupné dodavatele a jeden pro dostupné kontakty:</span><span class="sxs-lookup"><span data-stu-id="c7694-121">In this sample, we use the vendor and contact information from AdventureWorks, thus we create one list for the available vendors and one for the available contacts:</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample2.aspx)]

<span data-ttu-id="c7694-122">Pak se na stránku musí přidat dva CascadingDropDowny.</span><span class="sxs-lookup"><span data-stu-id="c7694-122">Then, two CascadingDropDown extenders must be added to the page.</span></span> <span data-ttu-id="c7694-123">Jedna vyplní první seznam (dodavatelé) a druhá vyplní druhý seznam (kontakty).</span><span class="sxs-lookup"><span data-stu-id="c7694-123">One fills the first (vendors) list, and the other one fills the second (contacts) list.</span></span> <span data-ttu-id="c7694-124">Je nutné nastavit následující atributy:</span><span class="sxs-lookup"><span data-stu-id="c7694-124">The following attributes must be set:</span></span>

- <span data-ttu-id="c7694-125">`ServicePath`: adresa URL webové služby, která doručuje položky seznamu.</span><span class="sxs-lookup"><span data-stu-id="c7694-125">`ServicePath`: URL of a web service delivering the list entries</span></span>
- <span data-ttu-id="c7694-126">`ServiceMethod`: Webová metoda doručování položek seznamu</span><span class="sxs-lookup"><span data-stu-id="c7694-126">`ServiceMethod`: Web method delivering the list entries</span></span>
- <span data-ttu-id="c7694-127">`TargetControlID`: ID rozevíracího seznamu</span><span class="sxs-lookup"><span data-stu-id="c7694-127">`TargetControlID`: ID of the dropdown list</span></span>
- <span data-ttu-id="c7694-128">`Category`: informace o kategorii, které se odešlou do webové metody při volání</span><span class="sxs-lookup"><span data-stu-id="c7694-128">`Category`: Category information that is submitted to the web method when called</span></span>
- <span data-ttu-id="c7694-129">`PromptText`: text zobrazený při asynchronním načítání dat seznamu ze serveru</span><span class="sxs-lookup"><span data-stu-id="c7694-129">`PromptText`: Text displayed when asynchronously loading list data from the server</span></span>
- <span data-ttu-id="c7694-130">`ParentControlID`: (nepovinný) nadřazený rozevírací seznam, který aktivuje načítání aktuálního seznamu</span><span class="sxs-lookup"><span data-stu-id="c7694-130">`ParentControlID`: (optional) parent dropdown list that triggers loading of the current list</span></span>

<span data-ttu-id="c7694-131">V závislosti na použitém programovacím jazyce se změní název příslušné webové služby, ale všechny ostatní hodnoty atributu jsou stejné.</span><span class="sxs-lookup"><span data-stu-id="c7694-131">Depending on the programming language used, the name of the web service in question changes, but all other attribute values are the same.</span></span> <span data-ttu-id="c7694-132">Tady je prvek CascadingDropDown pro první rozevírací seznam:</span><span class="sxs-lookup"><span data-stu-id="c7694-132">Here is the CascadingDropDown element for the first dropdown list:</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample3.aspx)]

<span data-ttu-id="c7694-133">Rozšířené ovládací prvky pro druhý seznam musí nastavovat atribut `ParentControlID` tak, že výběr položky v seznamu dodavatelů aktivuje načítání přidružených prvků v seznamu kontaktů.</span><span class="sxs-lookup"><span data-stu-id="c7694-133">The control extenders for the second list need to set the `ParentControlID` attribute so that selecting an entry in the vendors list triggers loading associated elements in the contacts list.</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample4.aspx)]

<span data-ttu-id="c7694-134">Skutečná práce se pak provede ve webové službě, která je nastavená takto.</span><span class="sxs-lookup"><span data-stu-id="c7694-134">The actual work is then done in the web service, which is set up as follows.</span></span> <span data-ttu-id="c7694-135">Všimněte si, že je použit atribut `[ScriptService]`, jinak ASP.NET AJAX nemůže vytvořit proxy JavaScript pro přístup k webovým metodám z kódu skriptu na straně klienta.</span><span class="sxs-lookup"><span data-stu-id="c7694-135">Note that the `[ScriptService]` attribute is used, otherwise ASP.NET AJAX cannot create the JavaScript proxy to access the web methods from client-side script code.</span></span>

[!code-aspx[Main](using-cascadingdropdown-with-a-database-cs/samples/sample5.aspx)]

<span data-ttu-id="c7694-136">Signatura webových metod, které volá CascadingDropDown, je následující:</span><span class="sxs-lookup"><span data-stu-id="c7694-136">The signature of the web methods called by CascadingDropDown is as follows:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample6.cs)]

<span data-ttu-id="c7694-137">Proto návratová hodnota musí být pole typu `CascadingDropDownNameValue`, které je definováno pomocí sady nástrojů Control Toolkit.</span><span class="sxs-lookup"><span data-stu-id="c7694-137">So the return value must be an array of type `CascadingDropDownNameValue` which is defined by the Control Toolkit.</span></span> <span data-ttu-id="c7694-138">Metodu `GetVendors()` je poměrně snadno implementovaná: kód se připojuje k databázi AdventureWorks a dotazuje se prvních 25 dodavatelů.</span><span class="sxs-lookup"><span data-stu-id="c7694-138">The `GetVendors()` method is quite easy to implement: The code connects to the AdventureWorks database and queries the first 25 vendors.</span></span> <span data-ttu-id="c7694-139">První parametr v konstruktoru `CascadingDropDownNameValue` je titulek položky seznamu, druhá jeho hodnota (atribut value v HTML &lt;`option`&gt; element).</span><span class="sxs-lookup"><span data-stu-id="c7694-139">The first parameter in the `CascadingDropDownNameValue` constructor is the caption of the list entry, the second one its value (value attribute in HTML's &lt;`option`&gt; element).</span></span> <span data-ttu-id="c7694-140">Zde je kód:</span><span class="sxs-lookup"><span data-stu-id="c7694-140">Here is the code:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample7.cs)]

<span data-ttu-id="c7694-141">Získání přidružených kontaktů pro dodavatele (název metody: `GetContactsForVendor()`) je trickier bitů.</span><span class="sxs-lookup"><span data-stu-id="c7694-141">Getting the associated contacts for a vendor (method name: `GetContactsForVendor()`) is a bit trickier.</span></span> <span data-ttu-id="c7694-142">Nejdříve je třeba určit dodavatele, který byl vybrán v prvním rozevíracím seznamu.</span><span class="sxs-lookup"><span data-stu-id="c7694-142">First of all, the vendor which has been selected in the first dropdown list must be determined.</span></span> <span data-ttu-id="c7694-143">Sada ovládacích prvků definuje pomocnou metodu pro tuto úlohu: metoda `ParseKnownCategoryValuesString()` vrací `StringDictionary` prvek s daty rozevíracího seznamu:</span><span class="sxs-lookup"><span data-stu-id="c7694-143">The Control Toolkit defines a helper method for that task: The `ParseKnownCategoryValuesString()` method returns a `StringDictionary` element with the dropdown data:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample8.cs)]

<span data-ttu-id="c7694-144">Z bezpečnostních důvodů musí být tato data nejprve ověřena.</span><span class="sxs-lookup"><span data-stu-id="c7694-144">For security reasons, this data must be validated first.</span></span> <span data-ttu-id="c7694-145">Takže pokud existuje položka dodavatele (protože vlastnost `Category` prvního prvku CascadingDropDown je nastavená na `"Vendor"`), může se načíst ID vybraného dodavatele:</span><span class="sxs-lookup"><span data-stu-id="c7694-145">So if there is a Vendor entry (because the `Category` property of the first CascadingDropDown element is set to `"Vendor"`), the ID of the selected vendor may be retrieved:</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample9.cs)]

<span data-ttu-id="c7694-146">Zbývající část metody je poměrně přímá a pak.</span><span class="sxs-lookup"><span data-stu-id="c7694-146">The rest of the method is fairly straight-forward, then.</span></span> <span data-ttu-id="c7694-147">ID dodavatele se používá jako parametr pro dotaz SQL, který načte všechny přidružené kontakty pro tohoto dodavatele.</span><span class="sxs-lookup"><span data-stu-id="c7694-147">The vendor's ID is used as a parameter for an SQL query that retrieves all associated contacts for that vendor.</span></span> <span data-ttu-id="c7694-148">Znovu metoda vrátí pole typu `CascadingDropDownNameValue`.</span><span class="sxs-lookup"><span data-stu-id="c7694-148">Once again, the method returns an array of type `CascadingDropDownNameValue`.</span></span>

[!code-csharp[Main](using-cascadingdropdown-with-a-database-cs/samples/sample10.cs)]

<span data-ttu-id="c7694-149">Načtěte stránku ASP.NET a po krátké době se seznam dodavatelů vyplní 25 položkami.</span><span class="sxs-lookup"><span data-stu-id="c7694-149">Load the ASP.NET page, and after a short while the vendor list is filled with 25 entries.</span></span> <span data-ttu-id="c7694-150">Vyberte jednu položku a Všimněte si, jak je druhý rozevírací seznam vyplněn daty.</span><span class="sxs-lookup"><span data-stu-id="c7694-150">Pick one entry and notice how the second dropdown list is filled with data.</span></span>

<span data-ttu-id="c7694-151">[![se první seznam vyplní automaticky](using-cascadingdropdown-with-a-database-cs/_static/image2.png)](using-cascadingdropdown-with-a-database-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c7694-151">[![The first list is filled automatically](using-cascadingdropdown-with-a-database-cs/_static/image2.png)](using-cascadingdropdown-with-a-database-cs/_static/image1.png)</span></span>

<span data-ttu-id="c7694-152">První seznam je vyplněn automaticky ([kliknutím zobrazíte obrázek v plné velikosti).](using-cascadingdropdown-with-a-database-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="c7694-152">The first list is filled automatically ([Click to view full-size image](using-cascadingdropdown-with-a-database-cs/_static/image3.png))</span></span>

<span data-ttu-id="c7694-153">[![se druhý seznam vyplní podle výběru v prvním seznamu.](using-cascadingdropdown-with-a-database-cs/_static/image5.png)](using-cascadingdropdown-with-a-database-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c7694-153">[![The second list is filled according to the selection in the first list](using-cascadingdropdown-with-a-database-cs/_static/image5.png)](using-cascadingdropdown-with-a-database-cs/_static/image4.png)</span></span>

<span data-ttu-id="c7694-154">Druhý seznam je vyplněn podle výběru v prvním seznamu ([kliknutím zobrazíte obrázek v plné velikosti).](using-cascadingdropdown-with-a-database-cs/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="c7694-154">The second list is filled according to the selection in the first list ([Click to view full-size image](using-cascadingdropdown-with-a-database-cs/_static/image6.png))</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="c7694-155">[Předchozí](filling-a-list-using-cascadingdropdown-cs.md)
> [Další](presetting-list-entries-with-cascadingdropdown-cs.md)</span><span class="sxs-lookup"><span data-stu-id="c7694-155">[Previous](filling-a-list-using-cascadingdropdown-cs.md)
[Next](presetting-list-entries-with-cascadingdropdown-cs.md)</span></span>
