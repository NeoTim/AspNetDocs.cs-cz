---
uid: web-pages/overview/security/16-adding-security-and-membership
title: Přidání zabezpečení a členství do webu ASP.NET Web Pages (Razor) | Microsoft Docs
author: Rick-Anderson
description: V této kapitole se dozvíte, jak web zabezpečit, aby byly některé stránky k dispozici pouze uživatelům, kteří se přihlašují. (Uvidíte také, jak vytvářet stránky...
ms.author: riande
ms.date: 02/24/2014
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: 0be3e767a42939a3c343f6d4a730eb1d9a6b367c
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78628385"
---
# <a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="be5a9-104">Přidání zabezpečení a členství do webu ASP.NET Web Pages (Razor)</span><span class="sxs-lookup"><span data-stu-id="be5a9-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>

<span data-ttu-id="be5a9-105">tím, že [FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="be5a9-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="be5a9-106">Tento článek vysvětluje, jak zabezpečit webovou stránku ASP.NET Web Pages (Razor), aby byly některé stránky k dispozici pouze uživatelům, kteří se přihlašují.</span><span class="sxs-lookup"><span data-stu-id="be5a9-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="be5a9-107">(Zobrazí se také informace o tom, jak vytvořit stránky, ke kterým má kdokoli přístup.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="be5a9-108">**Co se naučíte:**</span><span class="sxs-lookup"><span data-stu-id="be5a9-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="be5a9-109">Postup vytvoření webu, který má registrační stránku a přihlašovací stránku, aby bylo možné pro některé stránky omezit přístup pouze na členy.</span><span class="sxs-lookup"><span data-stu-id="be5a9-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="be5a9-110">Jak vytvořit veřejné a jenom členské stránky.</span><span class="sxs-lookup"><span data-stu-id="be5a9-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="be5a9-111">Jak definovat role, které jsou skupiny, které mají odlišná oprávnění zabezpečení na webu a jak přiřadit uživatele k roli.</span><span class="sxs-lookup"><span data-stu-id="be5a9-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="be5a9-112">Jak používat CAPTCHA k zabránění automatizovaným programům (roboty) z vytváření členských účtů.</span><span class="sxs-lookup"><span data-stu-id="be5a9-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="be5a9-113">Jedná se o funkce ASP.NET, které jsou představené v článku:</span><span class="sxs-lookup"><span data-stu-id="be5a9-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="be5a9-114">Šablona webu WebMatrix **Starter**</span><span class="sxs-lookup"><span data-stu-id="be5a9-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="be5a9-115">Pomocná třída `WebSecurity` a `Roles`.</span><span class="sxs-lookup"><span data-stu-id="be5a9-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="be5a9-116">Pomocná rutina `ReCaptcha`</span><span class="sxs-lookup"><span data-stu-id="be5a9-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="be5a9-117">Verze softwaru použité v tomto kurzu</span><span class="sxs-lookup"><span data-stu-id="be5a9-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="be5a9-118">Webové stránky ASP.NET (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="be5a9-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="be5a9-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="be5a9-119">WebMatrix 3</span></span>
> - <span data-ttu-id="be5a9-120">Knihovna webových pomocníků ASP.NET</span><span class="sxs-lookup"><span data-stu-id="be5a9-120">ASP.NET Web Helpers Library</span></span>

<span data-ttu-id="be5a9-121">Můžete nastavit svůj web tak, aby se k němu &#8212; uživatelé mohli přihlásit, aby lokalita podporovala *členství*.</span><span class="sxs-lookup"><span data-stu-id="be5a9-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="be5a9-122">To může být užitečné z mnoha důvodů.</span><span class="sxs-lookup"><span data-stu-id="be5a9-122">This can be useful for many reasons.</span></span> <span data-ttu-id="be5a9-123">Například váš web může mít stránky, které by měly být k dispozici pouze pro členy.</span><span class="sxs-lookup"><span data-stu-id="be5a9-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="be5a9-124">V některých případech můžete vyžadovat, aby se uživatelé přihlásili, aby vám poslali zpětnou vazbu nebo nechali komentář.</span><span class="sxs-lookup"><span data-stu-id="be5a9-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="be5a9-125">I když váš web podporuje členství, uživatelé nemusí nutně vyžadovat, abyste se přihlásili předtím, než použijí některé stránky na webu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="be5a9-126">Uživatelé, kteří nejsou přihlášení, se nazývají *anonymní uživatelé*.</span><span class="sxs-lookup"><span data-stu-id="be5a9-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="be5a9-127">Uživatel se může zaregistrovat na vašem webu a pak se může přihlásit k webu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="be5a9-128">Web vyžaduje uživatelské jméno (e-mailovou adresu) a heslo pro potvrzení, že uživatelé mají nárok.</span><span class="sxs-lookup"><span data-stu-id="be5a9-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="be5a9-129">Tento proces přihlášení a potvrzení identity uživatele se označuje jako *ověřování*.</span><span class="sxs-lookup"><span data-stu-id="be5a9-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="be5a9-130">Zabezpečení a členství můžete nastavit různými způsoby:</span><span class="sxs-lookup"><span data-stu-id="be5a9-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="be5a9-131">Pokud používáte WebMatrix, snadný způsob, jak vytvořit novou lokalitu na základě šablony **webu Starter** .</span><span class="sxs-lookup"><span data-stu-id="be5a9-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="be5a9-132">Tato šablona je již nakonfigurována pro zabezpečení a členství a má již registrační stránku, přihlašovací stránku a tak dále.</span><span class="sxs-lookup"><span data-stu-id="be5a9-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="be5a9-133">Lokalita vytvořená šablonou má taky možnost Povolit uživatelům přihlášení pomocí externího webu, jako je Facebook, Google nebo Twitter.</span><span class="sxs-lookup"><span data-stu-id="be5a9-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="be5a9-134">Pokud chcete přidat zabezpečení do existující lokality nebo pokud nechcete používat šablonu **webu Starter** , můžete vytvořit vlastní registrační stránku, přihlašovací stránku a tak dále.</span><span class="sxs-lookup"><span data-stu-id="be5a9-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="be5a9-135">Tento článek se zaměřuje na první možnost &mdash;, jak přidat zabezpečení pomocí šablony **webu Starter** .</span><span class="sxs-lookup"><span data-stu-id="be5a9-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="be5a9-136">Obsahuje taky některé základní informace o tom, jak implementovat vlastní zabezpečení a pak poskytuje odkazy na Další informace o tom, jak to udělat.</span><span class="sxs-lookup"><span data-stu-id="be5a9-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="be5a9-137">K dispozici jsou také informace o tom, jak povolit externí přihlášení, která jsou podrobněji popsána v samostatném článku.</span><span class="sxs-lookup"><span data-stu-id="be5a9-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="be5a9-138">Vytvoření zabezpečení webu pomocí šablony webu Starter</span><span class="sxs-lookup"><span data-stu-id="be5a9-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="be5a9-139">Ve WebMatrixu můžete pomocí šablony **webu Starter** vytvořit web, který obsahuje následující:</span><span class="sxs-lookup"><span data-stu-id="be5a9-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="be5a9-140">Databáze, která slouží k ukládání uživatelských jmen a hesel pro členy.</span><span class="sxs-lookup"><span data-stu-id="be5a9-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="be5a9-141">Registrační stránka, kde se mohou registrovat anonymní (noví) uživatelé.</span><span class="sxs-lookup"><span data-stu-id="be5a9-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="be5a9-142">Stránka pro přihlášení a odhlášení</span><span class="sxs-lookup"><span data-stu-id="be5a9-142">A login and logout page.</span></span>
- <span data-ttu-id="be5a9-143">Stránka obnovení a obnovení hesla</span><span class="sxs-lookup"><span data-stu-id="be5a9-143">A password recovery and reset page.</span></span>

<span data-ttu-id="be5a9-144">Následující postup popisuje, jak vytvořit lokalitu a nakonfigurovat ji.</span><span class="sxs-lookup"><span data-stu-id="be5a9-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="be5a9-145">Spusťte WebMatrix a na stránce **rychlé zprovoznění** vyberte možnost **lokalita ze šablony**.</span><span class="sxs-lookup"><span data-stu-id="be5a9-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="be5a9-146">Vyberte šablonu **spouštěcího webu** a klikněte na tlačítko **OK**.</span><span class="sxs-lookup"><span data-stu-id="be5a9-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="be5a9-147">WebMatrix vytvoří nový web.</span><span class="sxs-lookup"><span data-stu-id="be5a9-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="be5a9-148">V levém podokně klikněte na selektor pracovního prostoru **soubory** .</span><span class="sxs-lookup"><span data-stu-id="be5a9-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="be5a9-149">V kořenové složce vašeho webu otevřete soubor *\_AppStart. cshtml* , což je speciální soubor, který se používá k tomu, aby obsahoval globální nastavení.</span><span class="sxs-lookup"><span data-stu-id="be5a9-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="be5a9-150">Obsahuje některé příkazy, které jsou zakomentovány pomocí `//`ch znaků:</span><span class="sxs-lookup"><span data-stu-id="be5a9-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="be5a9-151">Tyto příkazy konfigurují pomocný parametr `WebMail`, který se dá použít k odeslání e-mailu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="be5a9-152">Systém členství může pomocí e-mailu odesílat potvrzovací zprávy, když se uživatelé registrují nebo kdy chtějí měnit hesla.</span><span class="sxs-lookup"><span data-stu-id="be5a9-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="be5a9-153">(Například po registraci uživatele obdrží e-mail s odkazem, na který mohou kliknout, aby mohl proces registrace dokončit.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="be5a9-154">Odesílání e-mailů vyžaduje přístup k serveru SMTP, jak je popsáno v tématu [Přidání e-mailu na web webových stránek ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202899).</span><span class="sxs-lookup"><span data-stu-id="be5a9-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="be5a9-155">Nastavení e-mailu uložíte v tomto souboru centrální *\_AppStart. cshtml* , abyste je nemuseli zadávat opakovaně na každou stránku, která může odesílat e-maily.</span><span class="sxs-lookup"><span data-stu-id="be5a9-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="be5a9-156">(Nemusíte konfigurovat nastavení SMTP pro nastavení registrační databáze. Pokud chcete ověřovat uživatele z e-mailového aliasu a nechat si uživatele resetovat zapomenuté heslo, budete potřebovat jenom nastavení SMTP.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="be5a9-157">Odkomentujte příkazy odebráním `//` před každou z nich.</span><span class="sxs-lookup"><span data-stu-id="be5a9-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="be5a9-158">Pokud nechcete nastavit e-mailové potvrzení, můžete tento krok přeskočit a další krok.</span><span class="sxs-lookup"><span data-stu-id="be5a9-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="be5a9-159">Pokud nejsou nastavené hodnoty SMTP, je nový účet hned dostupný bez potvrzovacího e-mailu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="be5a9-160">Upravte následující nastavení související s e-maily v kódu:</span><span class="sxs-lookup"><span data-stu-id="be5a9-160">Modify the following email-related settings in the code:</span></span>

   - <span data-ttu-id="be5a9-161">Nastavte `WebMail.SmtpServer` na název serveru SMTP, ke kterému máte přístup.</span><span class="sxs-lookup"><span data-stu-id="be5a9-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
   - <span data-ttu-id="be5a9-162">Ponechte `WebMail.EnableSsl` nastavenou na `true`.</span><span class="sxs-lookup"><span data-stu-id="be5a9-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="be5a9-163">Toto nastavení zabezpečuje přihlašovací údaje, které se odesílají na server SMTP, pomocí jejich šifrování.</span><span class="sxs-lookup"><span data-stu-id="be5a9-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
   - <span data-ttu-id="be5a9-164">Nastavte `WebMail.UserName` na uživatelské jméno pro svůj účet serveru SMTP.</span><span class="sxs-lookup"><span data-stu-id="be5a9-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
   - <span data-ttu-id="be5a9-165">Nastavte `WebMail.Password` na heslo pro svůj účet serveru SMTP.</span><span class="sxs-lookup"><span data-stu-id="be5a9-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
   - <span data-ttu-id="be5a9-166">Nastavte `WebMail.From` na vlastní e-mailovou adresu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="be5a9-167">Toto je e-mailová adresa, ze které se zpráva odesílá.</span><span class="sxs-lookup"><span data-stu-id="be5a9-167">This is the email address that the message is sent from.</span></span>

     > [!NOTE] 
     > 
     > <span data-ttu-id="be5a9-168">**Tip** Další informace o hodnotách těchto vlastností najdete v tématu [Konfigurace nastavení e-mailu](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) v tématu [přizpůsobení chování pro webové stránky ASP.NET napříč lokalitami](https://go.microsoft.com/fwlink/?LinkID=202906).</span><span class="sxs-lookup"><span data-stu-id="be5a9-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="be5a9-169">Uložte a zavřete *\_AppStart. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="be5a9-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="be5a9-170">Spusťte stránku *Default. cshtml* v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="be5a9-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![zabezpečení-členství – 2](16-adding-security-and-membership/_static/image1.png)

   > [!NOTE]
   > <span data-ttu-id="be5a9-172">Pokud se zobrazí chyba s oznámením, že vlastnost musí být instancí `ExtendedMembershipProvider`, lokalita nemusí být nakonfigurovaná tak, aby používala systém členství na webových stránkách ASP.NET (SimpleMembership).</span><span class="sxs-lookup"><span data-stu-id="be5a9-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="be5a9-173">Tato situace může někdy nastat, pokud je server poskytovatele hostingu nakonfigurován jinak než místní server.</span><span class="sxs-lookup"><span data-stu-id="be5a9-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="be5a9-174">Chcete-li tento problém vyřešit, přidejte následující prvek do souboru *Web. config* webu:</span><span class="sxs-lookup"><span data-stu-id="be5a9-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
   > 
   > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
   > 
   > <span data-ttu-id="be5a9-175">Přidejte tento prvek jako podřízený prvek `<configuration>` a jako partnerský uzel `<system.web>` elementu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="be5a9-176">V pravém horním rohu stránky klikněte na odkaz **zaregistrovat** .</span><span class="sxs-lookup"><span data-stu-id="be5a9-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="be5a9-177">Zobrazí se stránka *Register. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="be5a9-178">Zadejte uživatelské jméno a heslo a potom klikněte na **zaregistrovat**.</span><span class="sxs-lookup"><span data-stu-id="be5a9-178">Enter a user name and password and then click **Register**.</span></span>

    ![zabezpečení-členství – 3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="be5a9-180">Když jste vytvořili web ze šablony **úvodní web** , vytvořila se databáze s názvem *úvodníweb. sdf* ve složce *data App\_e* webu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="be5a9-181">Během registrace se do databáze přidají informace o uživateli.</span><span class="sxs-lookup"><span data-stu-id="be5a9-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="be5a9-182">Pokud nastavíte hodnoty SMTP, zpráva se pošle na e-mailovou adresu, kterou jste použili, abyste mohli dokončit registraci.</span><span class="sxs-lookup"><span data-stu-id="be5a9-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![zabezpečení-členství – 4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="be5a9-184">Přečtěte si e-mailový program a vyhledejte zprávu, která bude mít váš potvrzovací kód a hypertextový odkaz na web.</span><span class="sxs-lookup"><span data-stu-id="be5a9-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="be5a9-185">Kliknutím na hypertextový odkaz aktivujete svůj účet.</span><span class="sxs-lookup"><span data-stu-id="be5a9-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="be5a9-186">Potvrzovací hypertextový odkaz otevře stránku potvrzení registrace.</span><span class="sxs-lookup"><span data-stu-id="be5a9-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![zabezpečení-členství – 5](16-adding-security-and-membership/_static/image4.png)
13. <span data-ttu-id="be5a9-188">Klikněte na odkaz pro **přihlášení** a pak se přihlaste pomocí účtu, který jste zaregistrovali.</span><span class="sxs-lookup"><span data-stu-id="be5a9-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

      <span data-ttu-id="be5a9-189">Po přihlášení se odkazy na **přihlášení** a **registraci** nahrazují odkazem na **odhlášení** .</span><span class="sxs-lookup"><span data-stu-id="be5a9-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="be5a9-190">Vaše přihlašovací jméno se zobrazí jako odkaz.</span><span class="sxs-lookup"><span data-stu-id="be5a9-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="be5a9-191">(Odkaz vám umožní přejít na stránku, kde můžete změnit heslo.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-191">(The link lets you go to a page where you can change your password.)</span></span>

      ![zabezpečení-členství – 6](16-adding-security-and-membership/_static/image5.png)

      > [!NOTE]
      > <span data-ttu-id="be5a9-193">Ve výchozím nastavení odesílají webové stránky ASP.NET přihlašovací údaje na server v podobě prostého textu (jako text čitelný lidmi).</span><span class="sxs-lookup"><span data-stu-id="be5a9-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="be5a9-194">Provozní web by měl používat zabezpečený protokol HTTP (https://, označovaný také jako *Secure Sockets* Layer nebo SSL) k šifrování citlivých informací, které se vyměňují se serverem.</span><span class="sxs-lookup"><span data-stu-id="be5a9-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="be5a9-195">Můžete požadovat odeslání e-mailových zpráv pomocí protokolu SSL nastavením `WebMail.EnableSsl=true` jako v předchozím příkladu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="be5a9-196">Další informace o protokolu SSL najdete v tématu [zabezpečení webové komunikace: certifikáty, SSL a https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span><span class="sxs-lookup"><span data-stu-id="be5a9-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="be5a9-197">Další funkce členství v lokalitě</span><span class="sxs-lookup"><span data-stu-id="be5a9-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="be5a9-198">Vaše lokalita obsahuje další funkce, které uživatelům umožňují spravovat své účty.</span><span class="sxs-lookup"><span data-stu-id="be5a9-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="be5a9-199">Uživatelé můžou provádět tyto akce:</span><span class="sxs-lookup"><span data-stu-id="be5a9-199">Users can do the following:</span></span>

- <span data-ttu-id="be5a9-200">Změnit jejich hesla.</span><span class="sxs-lookup"><span data-stu-id="be5a9-200">Change their passwords.</span></span> <span data-ttu-id="be5a9-201">Po přihlášení můžou kliknout na uživatelské jméno (což je odkaz).</span><span class="sxs-lookup"><span data-stu-id="be5a9-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="be5a9-202">Tím přejdete na stránku, kde mohou vytvořit nové heslo (*účet/ChangePassword. cshtml*).</span><span class="sxs-lookup"><span data-stu-id="be5a9-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="be5a9-203">Obnovení zapomenutého hesla.</span><span class="sxs-lookup"><span data-stu-id="be5a9-203">Recover a forgotten password.</span></span> <span data-ttu-id="be5a9-204">Na přihlašovací stránce se nachází odkaz (**Zapomněli jste heslo?** ), které uživatele přebírají na stránku (*účet/forgotPassword. cshtml*), kde můžou zadat e-mailovou adresu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="be5a9-205">Lokalita jim pošle e-mailovou zprávu s odkazem, na který můžou kliknout, aby si nastavili nové heslo (*account/PasswordReset. cshtml*).</span><span class="sxs-lookup"><span data-stu-id="be5a9-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="be5a9-206">Můžete také umožnit uživatelům přihlášení pomocí externí lokality, jak je vysvětleno později.</span><span class="sxs-lookup"><span data-stu-id="be5a9-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="be5a9-207">Vytvoření stránky jenom pro členy</span><span class="sxs-lookup"><span data-stu-id="be5a9-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="be5a9-208">V době, kdy může kdokoli přejít na libovolnou stránku na webu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="be5a9-209">Ale možná budete chtít mít stránky, které jsou k dispozici pouze uživatelům, kteří se přihlásili (tj. členům).</span><span class="sxs-lookup"><span data-stu-id="be5a9-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="be5a9-210">ASP.NET umožňuje vytvářet stránky, ke kterým mohou být přihlášeni pouze přihlášení členové.</span><span class="sxs-lookup"><span data-stu-id="be5a9-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="be5a9-211">Pokud se anonymní uživatelé pokusí získat přístup na stránku jenom pro členy, přesměrují je na přihlašovací stránku.</span><span class="sxs-lookup"><span data-stu-id="be5a9-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="be5a9-212">V tomto postupu vytvoříte složku, která bude obsahovat stránky, které jsou k dispozici pouze pro přihlášené uživatele.</span><span class="sxs-lookup"><span data-stu-id="be5a9-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="be5a9-213">V kořenovém adresáři lokality vytvořte novou složku.</span><span class="sxs-lookup"><span data-stu-id="be5a9-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="be5a9-214">(Na pásu karet klikněte na šipku pod položkou **nové** a pak zvolte **Nová složka**.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="be5a9-215">Pojmenujte nové *členy*složky.</span><span class="sxs-lookup"><span data-stu-id="be5a9-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="be5a9-216">Uvnitř složky *Členové* vytvořte novou stránku a pojmenujte ji *MembersInformation. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="be5a9-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="be5a9-217">Existující obsah nahraďte následujícím kódem a označením:</span><span class="sxs-lookup"><span data-stu-id="be5a9-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="be5a9-218">Tento kód testuje vlastnost `IsAuthenticated` objektu `WebSecurity`, která vrátí `true`, pokud se uživatel přihlásil.</span><span class="sxs-lookup"><span data-stu-id="be5a9-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="be5a9-219">Pokud uživatel není přihlášen, kód volá `Response.Redirect` k odeslání uživatele do stránky *Login. cshtml* ve složce *account* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="be5a9-220">Adresa URL přesměrování zahrnuje `returnUrl` hodnotu řetězce dotazu, která používá `Request.Url.LocalPath` k nastavení cesty aktuální stránky.</span><span class="sxs-lookup"><span data-stu-id="be5a9-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="be5a9-221">Pokud nastavíte `returnUrl` hodnotu v řetězci dotazu (a pokud je návratová adresa URL místní cesta), přihlašovací stránka po přihlášení vrátí uživatele na tuto stránku.</span><span class="sxs-lookup"><span data-stu-id="be5a9-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="be5a9-222">Kód také nastaví *\_stránku SiteLayout. cshtml* jako stránku rozložení.</span><span class="sxs-lookup"><span data-stu-id="be5a9-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="be5a9-223">(Další informace o stránkách rozložení najdete v tématu [vytvoření konzistentního rozložení v ASP.NET webech webových stránek](https://go.microsoft.com/fwlink/?LinkId=202891).)</span><span class="sxs-lookup"><span data-stu-id="be5a9-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="be5a9-224">Spusťte Web.</span><span class="sxs-lookup"><span data-stu-id="be5a9-224">Run the site.</span></span> <span data-ttu-id="be5a9-225">Pokud jste ještě přihlášení, klikněte na tlačítko **Odhlásit** v horní části stránky.</span><span class="sxs-lookup"><span data-stu-id="be5a9-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="be5a9-226">V prohlížeči požádejte o stránku */members/MembersInformation*.</span><span class="sxs-lookup"><span data-stu-id="be5a9-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="be5a9-227">Adresa URL může vypadat například takto:</span><span class="sxs-lookup"><span data-stu-id="be5a9-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="be5a9-228">(Číslo portu (38366) se pravděpodobně v adrese URL liší.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="be5a9-229">Budete přesměrováni na stránku *Login. cshtml* , protože nejste přihlášeni.</span><span class="sxs-lookup"><span data-stu-id="be5a9-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
7. <span data-ttu-id="be5a9-230">Přihlaste se pomocí účtu, který jste vytvořili dříve.</span><span class="sxs-lookup"><span data-stu-id="be5a9-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="be5a9-231">Budete přesměrováni zpět na stránku *MembersInformation* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="be5a9-232">Vzhledem k tomu, že jste přihlášení, zobrazí se vám tentokrát obsah stránky.</span><span class="sxs-lookup"><span data-stu-id="be5a9-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="be5a9-233">K zabezpečení přístupu k několika stránkám můžete použít tento postup:</span><span class="sxs-lookup"><span data-stu-id="be5a9-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="be5a9-234">Přidejte kontrolu zabezpečení na každou stránku.</span><span class="sxs-lookup"><span data-stu-id="be5a9-234">Add the security check to each page.</span></span>
- <span data-ttu-id="be5a9-235">Vytvořte stránku *\_PageStart. cshtml* ve složce, kam zachováte chráněné stránky, a přidejte kontrolu zabezpečení.</span><span class="sxs-lookup"><span data-stu-id="be5a9-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="be5a9-236">Stránka *\_PageStart. cshtml* funguje jako typ globální stránky pro všechny stránky ve složce.</span><span class="sxs-lookup"><span data-stu-id="be5a9-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="be5a9-237">Tato technika je podrobněji vysvětlena v tématu [přizpůsobení chování pro webové stránky ASP.NET v nejrůznějších lokalitách](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span><span class="sxs-lookup"><span data-stu-id="be5a9-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="be5a9-238">Vytváření zabezpečení pro skupiny uživatelů (role)</span><span class="sxs-lookup"><span data-stu-id="be5a9-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="be5a9-239">Pokud má vaše lokalita mnoho členů, není efektivní zkontrolovat oprávnění pro každého uživatele předtím, než se jim zobrazí stránka.</span><span class="sxs-lookup"><span data-stu-id="be5a9-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="be5a9-240">Místo toho můžete vytvořit skupiny nebo *role*, do kterých patří jednotliví členové.</span><span class="sxs-lookup"><span data-stu-id="be5a9-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="be5a9-241">Pak můžete zaškrtnout oprávnění na základě role.</span><span class="sxs-lookup"><span data-stu-id="be5a9-241">You can then check permissions based on role.</span></span> <span data-ttu-id="be5a9-242">V této části vytvoříte roli správce &quot;&quot; a pak vytvoříte stránku, která je přístupná pro uživatele, kteří patří do této role (kteří patří do).</span><span class="sxs-lookup"><span data-stu-id="be5a9-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="be5a9-243">Systém členství v ASP.NET je nastavený tak, aby podporoval role.</span><span class="sxs-lookup"><span data-stu-id="be5a9-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="be5a9-244">Na rozdíl od registrace členství a přihlášení ale šablona **úvodní lokality** neobsahuje stránky, které vám pomůžou se správou rolí.</span><span class="sxs-lookup"><span data-stu-id="be5a9-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="be5a9-245">(Správa rolí je administrativní úloha, nikoli úkol uživatele.) Skupiny však můžete přidat přímo do databáze členství ve WebMatrixu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="be5a9-246">V části WebMatrix klikněte na selektor pracovního prostoru **databáze** .</span><span class="sxs-lookup"><span data-stu-id="be5a9-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="be5a9-247">V levém podokně otevřete uzel *úvodníweb. sdf* , otevřete uzel **Tables (tabulky** ) a dvakrát klikněte na tabulku *webpages\_role* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![zabezpečení-členství – 7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="be5a9-249">Přidejte roli s názvem &quot;&quot;správce.</span><span class="sxs-lookup"><span data-stu-id="be5a9-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="be5a9-250">Pole *RoleId* se vyplní automaticky.</span><span class="sxs-lookup"><span data-stu-id="be5a9-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="be5a9-251">(Jedná se o primární klíč a byl nastaven jako pole pro identifikaci, jak je vysvětleno v [úvodu k práci s databází na webech webových stránek ASP.NET](https://go.microsoft.com/fwlink/?LinkId=202893).)</span><span class="sxs-lookup"><span data-stu-id="be5a9-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="be5a9-252">Poznamenejte si, jaká je hodnota pro pole *RoleId* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="be5a9-253">(Pokud se jedná o první roli, kterou definujete, bude se jednat o 1.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![zabezpečení-členství-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="be5a9-255">Zavřete tabulku *rolí\_webové stránky* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="be5a9-256">Otevřete tabulku *USERPROFILE* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="be5a9-257">Poznamenejte si hodnotu *ID* uživatele jednoho nebo více uživatelů v tabulce a pak tabulku zavřete.</span><span class="sxs-lookup"><span data-stu-id="be5a9-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="be5a9-258">Otevřete tabulku *webpages\_UserInRoles* a do tabulky zadejte *UserID* a *RoleID* hodnotu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="be5a9-259">Pokud například chcete uživatele přidat do role &quot;správce&quot;, zadejte tyto hodnoty:</span><span class="sxs-lookup"><span data-stu-id="be5a9-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![zabezpečení – členství – 9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="be5a9-261">Zavřete *webové stránky\_tabulce UsersInRoles* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="be5a9-262">Teď, když máte definované role, můžete nakonfigurovat stránku, která je přístupná pro uživatele, kteří jsou v této roli.</span><span class="sxs-lookup"><span data-stu-id="be5a9-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="be5a9-263">V kořenové složce webu vytvořte novou stránku s názvem *AdminError. cshtml* a stávající obsah nahraďte následujícím kódem.</span><span class="sxs-lookup"><span data-stu-id="be5a9-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="be5a9-264">To bude stránka, na kterou budou uživatelé přesměrováni, pokud nemají povolený přístup na stránku.</span><span class="sxs-lookup"><span data-stu-id="be5a9-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="be5a9-265">V kořenové složce webu vytvořte novou stránku s názvem *AdminOnly. cshtml* a nahraďte existující kód následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="be5a9-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="be5a9-266">Metoda `Roles.IsUserInRole` vrátí `true`, pokud je aktuální uživatel členem zadané role (v tomto případě role "správce").</span><span class="sxs-lookup"><span data-stu-id="be5a9-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="be5a9-267">Spusťte *Default. cshtml* v prohlížeči, ale Přihlaste se.</span><span class="sxs-lookup"><span data-stu-id="be5a9-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="be5a9-268">(Pokud jste už přihlášení, odhlaste se.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="be5a9-269">V adresním řádku prohlížeče přidejte *AdminOnly* do adresy URL.</span><span class="sxs-lookup"><span data-stu-id="be5a9-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="be5a9-270">(Jinými slovy, požádejte o soubor *AdminOnly. cshtml* .) Budete přesměrováni na stránku *AdminError. cshtml* , protože v tuto chvíli nejste přihlášeni jako uživatel v roli&quot; správce &quot;.</span><span class="sxs-lookup"><span data-stu-id="be5a9-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="be5a9-271">Vraťte se do *Default. cshtml* a přihlaste se jako uživatel, kterého jste přidali do role&quot; správce &quot;.</span><span class="sxs-lookup"><span data-stu-id="be5a9-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="be5a9-272">Přejděte na stránku *AdminOnly. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="be5a9-273">Tentokrát se zobrazí stránka.</span><span class="sxs-lookup"><span data-stu-id="be5a9-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="be5a9-274">Zabránění automatizovaným programům v připojení k webu</span><span class="sxs-lookup"><span data-stu-id="be5a9-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="be5a9-275">Přihlašovací stránka neukončí automatizované programy (někdy označované jako *Web robots* nebo *roboty*) z registrace k vašemu webu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="be5a9-276">Tento postup popisuje, jak povolit ReCaptcha test na registrační stránce.</span><span class="sxs-lookup"><span data-stu-id="be5a9-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="be5a9-278">Zaregistrujte si web na adrese ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span><span class="sxs-lookup"><span data-stu-id="be5a9-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="be5a9-279">Po dokončení registrace získáte veřejný klíč a soukromý klíč.</span><span class="sxs-lookup"><span data-stu-id="be5a9-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="be5a9-280">Přidejte knihovnu webových pomocníků ASP.NET na web, jak je popsáno v [tématu Instalace pomocníků na webu ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=252372), pokud jste to ještě neudělali.</span><span class="sxs-lookup"><span data-stu-id="be5a9-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="be5a9-281">Ve složce *account (účet* ) otevřete soubor s názvem *Register. cshtml*.</span><span class="sxs-lookup"><span data-stu-id="be5a9-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="be5a9-282">V kódu v horní části stránky Najděte následující řádky a odkomentujte je odebráním znaků `//` komentáře:</span><span class="sxs-lookup"><span data-stu-id="be5a9-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="be5a9-283">Nahraďte `PRIVATE_KEY` vlastním privátním klíčem ReCaptcha.</span><span class="sxs-lookup"><span data-stu-id="be5a9-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="be5a9-284">V značky stránky odeberte `@*` a `*@` znaky komentářů od následujících řádků v kódu stránky:</span><span class="sxs-lookup"><span data-stu-id="be5a9-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="be5a9-285">Nahraďte `PUBLIC_KEY` klíčem.</span><span class="sxs-lookup"><span data-stu-id="be5a9-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="be5a9-286">Pokud jste ho ještě neodebrali, odeberte `<div>` element obsahující text, který začíná na "Pokud chcete povolit ověřování CAPTCHA...".</span><span class="sxs-lookup"><span data-stu-id="be5a9-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="be5a9-287">(Odebrat celý prvek `<div>` a jeho obsah.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-287">(Remove the entire `<div>` element and its contents.)</span></span>

9. <span data-ttu-id="be5a9-288">V prohlížeči spusťte *Default. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="be5a9-289">Pokud jste se k webu přihlásili, klikněte na odkaz **Odhlásit** se.</span><span class="sxs-lookup"><span data-stu-id="be5a9-289">If you're logged into the site, click the **Logout** link.</span></span>
10. <span data-ttu-id="be5a9-290">Klikněte na odkaz **zaregistrovat** a otestujte registraci pomocí testu captcha.</span><span class="sxs-lookup"><span data-stu-id="be5a9-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

     ![zabezpečení-členství – 10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="be5a9-292">Další informace o nástroji `ReCaptcha` Helper najdete v tématu [použití CATPCHA k tomu, aby se zabránilo automatickým programům (roboty) v používání webu ASP.NET](https://go.microsoft.com/fwlink/?LinkId=251967).</span><span class="sxs-lookup"><span data-stu-id="be5a9-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="be5a9-293">Umožnění uživatelům přihlásit se pomocí externího webu</span><span class="sxs-lookup"><span data-stu-id="be5a9-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="be5a9-294">Šablona **úvodní lokality** obsahuje kód a značky, které umožní uživatelům přihlásit se pomocí Facebooku, Windows Live, Twitter, Google nebo Yahoo.</span><span class="sxs-lookup"><span data-stu-id="be5a9-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="be5a9-295">Tato funkce není ve výchozím nastavení povolená.</span><span class="sxs-lookup"><span data-stu-id="be5a9-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="be5a9-296">Obecný postup, jak použít přihlášení uživatelů pomocí těchto externích zprostředkovatelů:</span><span class="sxs-lookup"><span data-stu-id="be5a9-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="be5a9-297">Rozhodněte, které externí weby chcete podporovat.</span><span class="sxs-lookup"><span data-stu-id="be5a9-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="be5a9-298">V případě potřeby přejít na tuto lokalitu a nastavit přihlašovací aplikaci.</span><span class="sxs-lookup"><span data-stu-id="be5a9-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="be5a9-299">(Můžete to třeba udělat, pokud chcete povolit přihlášení na Facebooku.)</span><span class="sxs-lookup"><span data-stu-id="be5a9-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="be5a9-300">V lokalitě nakonfigurujte poskytovatele.</span><span class="sxs-lookup"><span data-stu-id="be5a9-300">In your site, configure the provider.</span></span> <span data-ttu-id="be5a9-301">Ve většině případů stačí pouze zrušit komentář k některému kódu v souboru *\_AppStart. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="be5a9-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="be5a9-302">Přidejte značky na registrační stránku, která uživatelům umožňuje odkaz na externí web pro přihlášení.</span><span class="sxs-lookup"><span data-stu-id="be5a9-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="be5a9-303">Obvykle můžete zkopírovat kód, který potřebujete, a mírně změnit text.</span><span class="sxs-lookup"><span data-stu-id="be5a9-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="be5a9-304">Podrobné pokyny najdete v tématu [Povolení přihlášení z externích webů na webu webové stránky ASP.NET](https://go.microsoft.com/fwlink/?LinkId=251969).</span><span class="sxs-lookup"><span data-stu-id="be5a9-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="be5a9-305">Jakmile se uživatel přihlásí z jiné lokality, uživatel se vrátí k vaší lokalitě a *přidruží* k vašemu webu přihlašovací údaje.</span><span class="sxs-lookup"><span data-stu-id="be5a9-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="be5a9-306">V důsledku toho vytvoří položka členství na webu pro externí přihlášení uživatele.</span><span class="sxs-lookup"><span data-stu-id="be5a9-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="be5a9-307">To vám umožní používat k externímu přihlášení normální zařízení členství (například role).</span><span class="sxs-lookup"><span data-stu-id="be5a9-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="be5a9-308">Přidání zabezpečení na existující web</span><span class="sxs-lookup"><span data-stu-id="be5a9-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="be5a9-309">Postup výše v tomto článku se spoléhá na použití šablony **webu Starter** jako základu pro zabezpečení webu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="be5a9-310">Pokud není vhodné začít od šablony **webu Starter** nebo zkopírovat relevantní stránky z webu na základě této šablony, můžete implementovat stejný typ zabezpečení na vlastní web, a to tak, že ho zakódujete sami.</span><span class="sxs-lookup"><span data-stu-id="be5a9-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="be5a9-311">Vytvoříte stejné typy stránek – registrace, přihlašování a tak dále, a pak použijete pomocníky a třídy k nastavení členství.</span><span class="sxs-lookup"><span data-stu-id="be5a9-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="be5a9-312">Základní postup je popsaný v blogovém příspěvku [nejzákladnější způsob implementace zabezpečení ASP.NET Razor](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span><span class="sxs-lookup"><span data-stu-id="be5a9-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="be5a9-313">Většina práce se provádí pomocí následujících metod a vlastností pomocné rutiny `WebSecurity`:</span><span class="sxs-lookup"><span data-stu-id="be5a9-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="be5a9-314">[WebSecurty. UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity. CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="be5a9-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="be5a9-315">Tyto metody umožňují určit, jestli je někdo už zaregistrovaný, a zaregistrovat ho.</span><span class="sxs-lookup"><span data-stu-id="be5a9-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="be5a9-316">[WebSecurty. Neověřeno](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="be5a9-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="be5a9-317">Tato vlastnost umožňuje určit, zda je aktuální uživatel přihlášen.</span><span class="sxs-lookup"><span data-stu-id="be5a9-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="be5a9-318">To je užitečné pro přesměrování uživatelů na přihlašovací stránku, pokud ještě nejsou přihlášeni.</span><span class="sxs-lookup"><span data-stu-id="be5a9-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="be5a9-319">[WebSecurity. Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity. logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="be5a9-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="be5a9-320">Tyto metody zaprotokolují uživatele do nebo ven.</span><span class="sxs-lookup"><span data-stu-id="be5a9-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="be5a9-321">[WebSecurity. CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="be5a9-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="be5a9-322">Tato vlastnost je užitečná pro zobrazení přihlašovacího jména aktuálního uživatele (Pokud je uživatel přihlášený).</span><span class="sxs-lookup"><span data-stu-id="be5a9-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="be5a9-323">[WebSecurity. ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="be5a9-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="be5a9-324">Tato metoda je užitečná, pokud nastavíte e-mailové potvrzení k registraci.</span><span class="sxs-lookup"><span data-stu-id="be5a9-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="be5a9-325">(Podrobnosti najdete v blogovém příspěvku [pomocí funkce potvrzení pro zabezpečení webových stránek ASP.NET](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span><span class="sxs-lookup"><span data-stu-id="be5a9-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="be5a9-326">Chcete-li spravovat role, můžete použít [role](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) a třídy [členství](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) , jak je popsáno v položce blogu.</span><span class="sxs-lookup"><span data-stu-id="be5a9-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="be5a9-327">Další prostředky</span><span class="sxs-lookup"><span data-stu-id="be5a9-327">Additional Resources</span></span>

- [<span data-ttu-id="be5a9-328">Přizpůsobení chování v celém webu</span><span class="sxs-lookup"><span data-stu-id="be5a9-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="be5a9-329">Zabezpečení webové komunikace: certifikáty, SSL a https://</span><span class="sxs-lookup"><span data-stu-id="be5a9-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="be5a9-330">Nejzákladnější [způsob implementace zabezpečení ASP.NET Razor](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) a [používání funkce potvrzení pro zabezpečení webových stránek ASP.NET](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span><span class="sxs-lookup"><span data-stu-id="be5a9-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="be5a9-331">Jedná se o blogové příspěvky, které popisují implementaci funkcí ASP.NET členství bez použití šablony **webu Starter** .</span><span class="sxs-lookup"><span data-stu-id="be5a9-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="be5a9-332">Povolení přihlášení z externích webů na webu s webovými stránkami ASP.NET</span><span class="sxs-lookup"><span data-stu-id="be5a9-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="be5a9-333">[Referenční dokumentace rozhraní API třídy WebSecurity](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="be5a9-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="be5a9-334">[Reference k rozhraní API třídy SimpleRoleProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="be5a9-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="be5a9-335">[Reference k rozhraní API třídy SimpleMembershipProvider](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="be5a9-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
