---
uid: web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
title: Ukládání dat do mezipaměti na webu ASP.NET Web Pages (Razor) pro lepší výkon | Microsoft Docs
author: Rick-Anderson
description: Svůj web můžete urychlit tím, že ho uložíte – to znamená mezipaměť – výsledky dat, které by obvykle vyžadovaly značnou dobu načtení nebo zpracování...
ms.author: riande
ms.date: 02/14/2014
ms.assetid: 961e525b-7700-469e-8a68-d7010b6fb68c
msc.legacyurl: /web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
msc.type: authoredcontent
ms.openlocfilehash: 01796d3ca699a6af5d9162b22a926551435c2040
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78641517"
---
# <a name="caching-data-in-an-aspnet-web-pages-razor-site-for-better-performance"></a><span data-ttu-id="cd8db-103">Ukládání dat do mezipaměti na webu ASP.NET Web Pages (Razor) pro lepší výkon</span><span class="sxs-lookup"><span data-stu-id="cd8db-103">Caching Data in an ASP.NET Web Pages (Razor) Site for Better Performance</span></span>

<span data-ttu-id="cd8db-104">tím, že [FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="cd8db-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="cd8db-105">Tento článek vysvětluje, jak používat pomocníka k ukládání informací do mezipaměti pro rychlejší výkon na webu ASP.NET Web Pages (Razor).</span><span class="sxs-lookup"><span data-stu-id="cd8db-105">This article explains how to use a helper to cache information for faster performance in an ASP.NET Web Pages (Razor) website.</span></span> <span data-ttu-id="cd8db-106">Svůj web můžete urychlit tím, že jeho úložiště &#8212; ukládá do mezipaměti &#8212; výsledky dat, která by obvykle vyžadovala značnou dobu načítání nebo zpracování a která se často nemění.</span><span class="sxs-lookup"><span data-stu-id="cd8db-106">You can speed up your website by having it store &#8212; that is, cache &#8212; the results of data that ordinarily would take considerable time to retrieve or process and that does not change often.</span></span>
> 
> <span data-ttu-id="cd8db-107">**Co se naučíte:**</span><span class="sxs-lookup"><span data-stu-id="cd8db-107">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="cd8db-108">Jak používat ukládání do mezipaměti ke zlepšení rychlosti odezvy vašeho webu.</span><span class="sxs-lookup"><span data-stu-id="cd8db-108">How to use caching to improve the responsiveness of your website.</span></span>
> 
> <span data-ttu-id="cd8db-109">Jedná se o funkce ASP.NET, které jsou představené v článku:</span><span class="sxs-lookup"><span data-stu-id="cd8db-109">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="cd8db-110">Pomocná rutina `WebCache`</span><span class="sxs-lookup"><span data-stu-id="cd8db-110">The `WebCache` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="cd8db-111">Verze softwaru použité v tomto kurzu</span><span class="sxs-lookup"><span data-stu-id="cd8db-111">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="cd8db-112">Webové stránky ASP.NET (Razor) 3</span><span class="sxs-lookup"><span data-stu-id="cd8db-112">ASP.NET Web Pages (Razor) 3</span></span>
>   
> 
> <span data-ttu-id="cd8db-113">Tento kurz funguje také s ASP.NET webovými stránkami 2.</span><span class="sxs-lookup"><span data-stu-id="cd8db-113">This tutorial also works with ASP.NET Web Pages 2.</span></span>

<span data-ttu-id="cd8db-114">Pokaždé, když někdo požádá o stránku z vaší lokality, musí webový server provést nějakou práci, aby mohl splnit požadavek.</span><span class="sxs-lookup"><span data-stu-id="cd8db-114">Every time someone requests a page from your site, the web server has to do some work in order to fulfill the request.</span></span> <span data-ttu-id="cd8db-115">Pro některé stránky může server potřebovat provádět úlohy, které provádějí (relativně) dlouhou dobu, například načtení dat z databáze.</span><span class="sxs-lookup"><span data-stu-id="cd8db-115">For some of your pages, the server might have to perform tasks that take a (comparatively) long time, such as retrieving data from a database.</span></span> <span data-ttu-id="cd8db-116">I v případě, že tyto úlohy netrvají v absolutních výrazech, může v případě velkého množství provozu celá řada jednotlivých požadavků, které způsobují, že webový server provádí složitou nebo pomalou úlohu, způsobit větší množství práce.</span><span class="sxs-lookup"><span data-stu-id="cd8db-116">Even if these tasks don't take long in absolute terms, if your site experiences a lot of traffic, a whole series of individual requests that cause the web server to perform the complicated or slow task can add up to a lot of work.</span></span> <span data-ttu-id="cd8db-117">To může mít nakonec vliv na výkon lokality.</span><span class="sxs-lookup"><span data-stu-id="cd8db-117">This can ultimately affect the performance of the site.</span></span>

<span data-ttu-id="cd8db-118">Jedním ze způsobů, jak zlepšit výkon webu za takových okolností, je ukládat data do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-118">One way to improve the performance of your website in circumstances like this is to cache data.</span></span> <span data-ttu-id="cd8db-119">Pokud vaše lokalita vrátí opakované požadavky na tytéž informace a informace pro každého uživatele nemusíte měnit a nejedná se o citlivou velikost, místo aby se znovu načetla nebo převedla jejich kalkulace, můžete načíst data jednou a pak výsledky uložit.</span><span class="sxs-lookup"><span data-stu-id="cd8db-119">If your site gets repeated requests for the same information, and the information does not need to be modified for each person, and it's not time sensitive, instead of re-fetching or recalculating it, you can fetch the data once and then store the results.</span></span> <span data-ttu-id="cd8db-120">Až v okamžiku, kdy se do této informace poprvé přijde požadavek, dostanete ho jenom z mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-120">The next time a request comes in for that information, you just get it out of the cache.</span></span>

<span data-ttu-id="cd8db-121">Obecně platí, že ukládáte do mezipaměti informace, které se často nemění.</span><span class="sxs-lookup"><span data-stu-id="cd8db-121">In general, you cache information that doesn't change frequently.</span></span> <span data-ttu-id="cd8db-122">Když vložíte informace do mezipaměti, uloží se do paměti na webovém serveru.</span><span class="sxs-lookup"><span data-stu-id="cd8db-122">When you put information in the cache, it's stored in memory on the web server.</span></span> <span data-ttu-id="cd8db-123">Můžete určit, jak dlouho se má ukládat do mezipaměti, od sekund po dny.</span><span class="sxs-lookup"><span data-stu-id="cd8db-123">You can specify how long it should be cached, from seconds to days.</span></span> <span data-ttu-id="cd8db-124">Po vypršení doby ukládání do mezipaměti jsou informace automaticky odebrány z mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-124">When the caching period expires, the information is automatically removed from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="cd8db-125">Položky v mezipaměti je možné odebrat z jiných důvodů než po jejichž uplynutí vypršela.</span><span class="sxs-lookup"><span data-stu-id="cd8db-125">Entries in the cache might be removed for reasons other than that they've expired.</span></span> <span data-ttu-id="cd8db-126">Webový server může například dočasně spustit nedostatek paměti a jedním ze způsobů, jak může uvolnit paměť, je vygenerování položek z mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-126">For example, the web server might temporarily run low on memory, and one way it can reclaim memory is by throwing entries out of the cache.</span></span> <span data-ttu-id="cd8db-127">Jak vidíte, i když jste do mezipaměti umístili informace, musíte zkontrolovat, jestli je pořád tam, kde ji potřebujete.</span><span class="sxs-lookup"><span data-stu-id="cd8db-127">As you'll see, even if you've put information into the cache, you have to check to be sure it's still there when you need it.</span></span>

<span data-ttu-id="cd8db-128">Představte si, že váš web obsahuje stránku, která zobrazuje aktuální teplotu a předpověď počasí.</span><span class="sxs-lookup"><span data-stu-id="cd8db-128">Imagine your website has a page that displays the current temperature and weather forecast.</span></span> <span data-ttu-id="cd8db-129">K získání tohoto typu informací můžete odeslat žádost externí službě.</span><span class="sxs-lookup"><span data-stu-id="cd8db-129">To get this type of information, you might send a request to an external service.</span></span> <span data-ttu-id="cd8db-130">Vzhledem k tomu, že se tyto informace nezmění (například během doby dvou hodin) a protože externí volání vyžadují dobu a šířku pásma, je dobrým kandidátem na ukládání do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-130">Since this information doesn't change much (within a two-hour time period, for example) and since external calls require time and bandwidth, it's a good candidate for caching.</span></span>

## <a name="adding-caching-to-a-page"></a><span data-ttu-id="cd8db-131">Přidání ukládání do mezipaměti na stránku</span><span class="sxs-lookup"><span data-stu-id="cd8db-131">Adding Caching to a Page</span></span>

<span data-ttu-id="cd8db-132">ASP.NET zahrnuje pomocnou nápovědu pro `WebCache`, která usnadňuje přidání ukládání do mezipaměti do vaší lokality a přidání dat do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-132">ASP.NET includes a `WebCache` helper that makes it easy to add caching to your site and add data to the cache.</span></span> <span data-ttu-id="cd8db-133">V tomto postupu vytvoříte stránku, která ukládá do mezipaměti aktuální čas.</span><span class="sxs-lookup"><span data-stu-id="cd8db-133">In this procedure, you'll create a page that caches the current time.</span></span> <span data-ttu-id="cd8db-134">Nejedná se o reálný příklad, protože aktuální čas je něco, co se často mění a které není složité vypočítat.</span><span class="sxs-lookup"><span data-stu-id="cd8db-134">This isn't a real-world example, since the current time is something that does change often, and that moreover isn't complex to calculate.</span></span> <span data-ttu-id="cd8db-135">Je však dobrým způsobem, jak znázornit ukládání do mezipaměti v akci.</span><span class="sxs-lookup"><span data-stu-id="cd8db-135">However, it's a good way to illustrate caching in action.</span></span>

1. <span data-ttu-id="cd8db-136">Přidejte do webu novou stránku s názvem *webcache. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="cd8db-136">Add a new page named *WebCache.cshtml* to the website.</span></span>
2. <span data-ttu-id="cd8db-137">Přidejte následující kód a značku na stránku:</span><span class="sxs-lookup"><span data-stu-id="cd8db-137">Add the following code and markup to the page:</span></span>

    [!code-cshtml[Main](15-caching-to-improve-the-performance-of-your-website/samples/sample1.cshtml)]

    <span data-ttu-id="cd8db-138">Když ukládáte data do mezipaměti, vložíte je do mezipaměti s použitím názvu, který je jedinečný v rámci webu.</span><span class="sxs-lookup"><span data-stu-id="cd8db-138">When you cache data, you put it into the cache using a name this is unique across the website.</span></span> <span data-ttu-id="cd8db-139">V takovém případě použijete položku mezipaměti s názvem `CachedTime`.</span><span class="sxs-lookup"><span data-stu-id="cd8db-139">In this case, you'll use a cache entry named `CachedTime`.</span></span> <span data-ttu-id="cd8db-140">Toto je `cacheItemKey` zobrazený v příkladu kódu.</span><span class="sxs-lookup"><span data-stu-id="cd8db-140">This is the `cacheItemKey` shown in the code example.</span></span>

    <span data-ttu-id="cd8db-141">Kód nejprve přečte položku `CachedTime` cache.</span><span class="sxs-lookup"><span data-stu-id="cd8db-141">The code first reads the `CachedTime` cache entry.</span></span> <span data-ttu-id="cd8db-142">Pokud je vrácena hodnota (tj. Pokud položka mezipaměti není null), kód pouze nastaví hodnotu proměnné čas na data mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-142">If a value is returned (that is, if the cache entry isn't null), the code just sets the value of the time variable to the cache data.</span></span>

    <span data-ttu-id="cd8db-143">Pokud však položka mezipaměti neexistuje (to znamená, že je null), kód nastaví hodnotu času, přidá ji do mezipaměti a nastaví hodnotu vypršení platnosti na jednu minutu.</span><span class="sxs-lookup"><span data-stu-id="cd8db-143">However, if the cache entry doesn't exist (that is, it's null), the code sets the time value, adds it to the cache, and sets an expiration value to one minute.</span></span> <span data-ttu-id="cd8db-144">Po jedné minutě se položka mezipaměti zahodí.</span><span class="sxs-lookup"><span data-stu-id="cd8db-144">After one minute, the cache entry is discarded.</span></span> <span data-ttu-id="cd8db-145">(Výchozí hodnota vypršení platnosti položky v mezipaměti je 20 minut.) Příkaz `WebCache.Set(cacheItemKey, time, 1, false)` ukazuje, jak přidat aktuální časovou hodnotu do mezipaměti a nastavit její vypršení platnosti na 1 minutu.</span><span class="sxs-lookup"><span data-stu-id="cd8db-145">(The default expiration value for an item in the cache is 20 minutes.) The command `WebCache.Set(cacheItemKey, time, 1, false)` shows how to add the current time value to the cache and set its expiration to 1 minute.</span></span> <span data-ttu-id="cd8db-146">Nastavením parametru *parametr slidingExpiration* na `false` znamená, že se čas vypršení platnosti neobnovuje při každém vyžádání.</span><span class="sxs-lookup"><span data-stu-id="cd8db-146">Setting the *slidingExpiration* parameter to `false` means the expiration time is not renewed each time it is requested.</span></span> <span data-ttu-id="cd8db-147">Platnost vyprší přesně 1 minutu poté, co byla původně přidána do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-147">It will expire exactly 1 minute after it was originally added to the cache.</span></span> <span data-ttu-id="cd8db-148">Pokud tuto hodnotu nastavíte na `true` doba vypršení platnosti 1 minuta se resetuje pokaždé, když se hodnota z mezipaměti vyžádá.</span><span class="sxs-lookup"><span data-stu-id="cd8db-148">If you set this value to `true` the 1 minute expiration time is reset each time the value is requested from the cache.</span></span>

    <span data-ttu-id="cd8db-149">Tento kód ilustruje vzor, který byste měli vždy použít při ukládání dat do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-149">This code illustrates the pattern you should always use when you cache data.</span></span> <span data-ttu-id="cd8db-150">Předtím, než získáte něco z mezipaměti, vždy nejprve ověřte, zda `WebCache.Get` metoda vrátila hodnotu null.</span><span class="sxs-lookup"><span data-stu-id="cd8db-150">Before you get something out of the cache, always check first whether the `WebCache.Get` method has returned null.</span></span> <span data-ttu-id="cd8db-151">Pamatujte na to, že položka mezipaměti mohla vypršet nebo mohla být z nějakého důvodu odebrána, takže se žádné z těchto položek nikdy nezaručuje, že by se v mezipaměti shodovaly.</span><span class="sxs-lookup"><span data-stu-id="cd8db-151">Remember that the cache entry might have expired or might have been removed for some other reason, so any given entry is never guaranteed to be in the cache.</span></span>
3. <span data-ttu-id="cd8db-152">V prohlížeči spusťte *webcache. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="cd8db-152">Run *WebCache.cshtml* in a browser.</span></span> <span data-ttu-id="cd8db-153">(Před spuštěním se ujistěte, že je stránka vybraná v pracovním prostoru **soubory** .) Při prvním požadavku na stránku se data nenacházejí v mezipaměti a kód musí do mezipaměti přidat časový údaj.</span><span class="sxs-lookup"><span data-stu-id="cd8db-153">(Make sure the page is selected in the **Files** workspace before you run it.) The first time you request the page, the time data isn't in the cache, and the code has to add the time value to the cache.</span></span>

    ![cache-1](15-caching-to-improve-the-performance-of-your-website/_static/image1.jpg)
4. <span data-ttu-id="cd8db-155">Obnovte *webcache. cshtml* v prohlížeči.</span><span class="sxs-lookup"><span data-stu-id="cd8db-155">Refresh *WebCache.cshtml* in the browser.</span></span> <span data-ttu-id="cd8db-156">Tentokrát jsou časová data v mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-156">This time, the time data is in the cache.</span></span> <span data-ttu-id="cd8db-157">Všimněte si, že se čas od posledního zobrazení stránky nezměnil.</span><span class="sxs-lookup"><span data-stu-id="cd8db-157">Notice that the time hasn't changed since the last time you viewed the page.</span></span>

    ![cache-2](15-caching-to-improve-the-performance-of-your-website/_static/image2.jpg)
5. <span data-ttu-id="cd8db-159">Počkejte jednu minutu, než se mezipaměť vyprázdní, a pak aktualizujte stránku.</span><span class="sxs-lookup"><span data-stu-id="cd8db-159">Wait one minute for the cache to be emptied, and then refresh the page.</span></span> <span data-ttu-id="cd8db-160">Tato stránka znovu indikuje, že časová data se v mezipaměti nenašly a aktualizovaná doba se přidala do mezipaměti.</span><span class="sxs-lookup"><span data-stu-id="cd8db-160">The page again indicates that the time data wasn't found in the cache, and the updated time is added to the cache.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="cd8db-161">Další prostředky</span><span class="sxs-lookup"><span data-stu-id="cd8db-161">Additional Resources</span></span>

- [<span data-ttu-id="cd8db-162">Zobrazení dat v grafu</span><span class="sxs-lookup"><span data-stu-id="cd8db-162">Displaying Data in a Chart</span></span>](https://go.microsoft.com/fwlink/?LinkId=202895)
- <span data-ttu-id="cd8db-163">[Referenční dokumentace rozhraní webcache API](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="cd8db-163">[WebCache API reference](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span></span>
