---
uid: web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
title: Představení ASP.NET webových stránek – aktualizace dat databáze | Microsoft Docs
author: Rick-Anderson
description: V tomto kurzu se dozvíte, jak aktualizovat (změnit) existující položku databáze při použití webových stránek ASP.NET (Razor). Předpokládá se, že jste dokončili řadu th...
ms.author: riande
ms.date: 01/02/2018
ms.assetid: ac86ec9c-6b69-485b-b9e0-8b9127b13e6b
msc.legacyurl: /web-pages/overview/getting-started/introducing-aspnet-web-pages-2/updating-data
msc.type: authoredcontent
ms.openlocfilehash: 8f8bcfb7d9d2416a2699776cadbdaae8e12415ba
ms.sourcegitcommit: e7e91932a6e91a63e2e46417626f39d6b244a3ab
ms.translationtype: MT
ms.contentlocale: cs-CZ
ms.lasthandoff: 03/06/2020
ms.locfileid: "78574226"
---
# <a name="introducing-aspnet-web-pages---updating-database-data"></a><span data-ttu-id="3abce-104">Představení ASP.NET webových stránek – aktualizace databázových dat</span><span class="sxs-lookup"><span data-stu-id="3abce-104">Introducing ASP.NET Web Pages - Updating Database Data</span></span>

<span data-ttu-id="3abce-105">tím, že [FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="3abce-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="3abce-106">V tomto kurzu se dozvíte, jak aktualizovat (změnit) existující položku databáze při použití webových stránek ASP.NET (Razor).</span><span class="sxs-lookup"><span data-stu-id="3abce-106">This tutorial shows you how to update (change) an existing database entry when you use ASP.NET Web Pages (Razor).</span></span> <span data-ttu-id="3abce-107">Předpokládá, že jste dokončili řadu prostřednictvím [zadávání dat pomocí formulářů pomocí webových stránek ASP.NET](entering-data.md).</span><span class="sxs-lookup"><span data-stu-id="3abce-107">It assumes you have completed the series through [Entering Data by Using Forms Using ASP.NET Web Pages](entering-data.md).</span></span>
> 
> <span data-ttu-id="3abce-108">Naučíte se:</span><span class="sxs-lookup"><span data-stu-id="3abce-108">What you'll learn:</span></span>
> 
> - <span data-ttu-id="3abce-109">Jak vybrat jednotlivý záznam v pomocné rutině `WebGrid`.</span><span class="sxs-lookup"><span data-stu-id="3abce-109">How to select an individual record in the `WebGrid` helper.</span></span>
> - <span data-ttu-id="3abce-110">Jak číst jeden záznam z databáze.</span><span class="sxs-lookup"><span data-stu-id="3abce-110">How to read a single record from a database.</span></span>
> - <span data-ttu-id="3abce-111">Jak přednačíst formulář s hodnotami z databázového záznamu.</span><span class="sxs-lookup"><span data-stu-id="3abce-111">How to preload a form with values from the database record.</span></span>
> - <span data-ttu-id="3abce-112">Jak aktualizovat existující záznam v databázi.</span><span class="sxs-lookup"><span data-stu-id="3abce-112">How to update an existing record in a database.</span></span>
> - <span data-ttu-id="3abce-113">Jak ukládat informace na stránce bez jejich zobrazení</span><span class="sxs-lookup"><span data-stu-id="3abce-113">How to store information in the page without displaying it.</span></span>
> - <span data-ttu-id="3abce-114">Jak pomocí skrytého pole ukládat informace.</span><span class="sxs-lookup"><span data-stu-id="3abce-114">How to use a hidden field to store information.</span></span>
>   
> 
> <span data-ttu-id="3abce-115">Popsané funkce a technologie:</span><span class="sxs-lookup"><span data-stu-id="3abce-115">Features/technologies discussed:</span></span>
> 
> - <span data-ttu-id="3abce-116">Pomocná rutina `WebGrid`</span><span class="sxs-lookup"><span data-stu-id="3abce-116">The `WebGrid` helper.</span></span>
> - <span data-ttu-id="3abce-117">Příkaz SQL `Update`.</span><span class="sxs-lookup"><span data-stu-id="3abce-117">The SQL `Update` command.</span></span>
> - <span data-ttu-id="3abce-118">Metoda `Database.Execute`.</span><span class="sxs-lookup"><span data-stu-id="3abce-118">The `Database.Execute` method.</span></span>
> - <span data-ttu-id="3abce-119">Skrytá pole (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="3abce-119">Hidden fields (`<input type="hidden">`).</span></span>

## <a name="what-youll-build"></a><span data-ttu-id="3abce-120">Co sestavíte</span><span class="sxs-lookup"><span data-stu-id="3abce-120">What You'll Build</span></span>

<span data-ttu-id="3abce-121">V předchozím kurzu jste zjistili, jak přidat záznam do databáze.</span><span class="sxs-lookup"><span data-stu-id="3abce-121">In the previous tutorial, you learned how to add a record to a database.</span></span> <span data-ttu-id="3abce-122">Tady se dozvíte, jak zobrazit záznam pro úpravy.</span><span class="sxs-lookup"><span data-stu-id="3abce-122">Here, you'll learn how to display a record for editing.</span></span> <span data-ttu-id="3abce-123">Na stránce *filmy* aktualizujte pomocníka `WebGrid` tak, aby se zobrazil odkaz pro **Úpravy** vedle každého filmu:</span><span class="sxs-lookup"><span data-stu-id="3abce-123">In the *Movies* page, you'll update the `WebGrid` helper so that it displays an **Edit** link next to each movie:</span></span>

![Zobrazení webgridu, včetně odkazu upravit pro každý film](updating-data/_static/image1.png)

<span data-ttu-id="3abce-125">Když kliknete na odkaz **Upravit** , přejdete na jinou stránku, kde jsou informace o filmu již ve formuláři:</span><span class="sxs-lookup"><span data-stu-id="3abce-125">When you click the **Edit** link, it takes you to a different page, where the movie information is already in a form:</span></span>

![Upravit stránku videa zobrazující film, který se má upravit](updating-data/_static/image2.png)

<span data-ttu-id="3abce-127">Můžete změnit libovolnou z těchto hodnot.</span><span class="sxs-lookup"><span data-stu-id="3abce-127">You can change any of the values.</span></span> <span data-ttu-id="3abce-128">Po odeslání změn kód na stránce aktualizuje databázi a přejde zpět na seznam videí.</span><span class="sxs-lookup"><span data-stu-id="3abce-128">When you submit the changes, the code in the page updates the database and takes you back to the movie listing.</span></span>

<span data-ttu-id="3abce-129">Tato část procesu funguje téměř přesně stejně jako stránka *AddMovie. cshtml* , kterou jste vytvořili v předchozím kurzu, takže mnohé z těchto kurzů budou známé.</span><span class="sxs-lookup"><span data-stu-id="3abce-129">This part of the process works almost exactly like the *AddMovie.cshtml* page you created in the previous tutorial, so much of this tutorial will be familiar.</span></span>

<span data-ttu-id="3abce-130">Existuje několik způsobů, jak můžete implementovat způsob, jak upravit jednotlivý film.</span><span class="sxs-lookup"><span data-stu-id="3abce-130">There are several ways you could implement a way to edit an individual movie.</span></span> <span data-ttu-id="3abce-131">Vybraný přístup byl zvolen, protože je snadné ho implementovat a snadno pochopit.</span><span class="sxs-lookup"><span data-stu-id="3abce-131">The approach shown was chosen because it's easy to implement and easy to understand.</span></span>

## <a name="adding-an-edit-link-to-the-movie-listing"></a><span data-ttu-id="3abce-132">Přidání odkazu pro úpravy do seznamu filmů</span><span class="sxs-lookup"><span data-stu-id="3abce-132">Adding an Edit Link to the Movie Listing</span></span>

<span data-ttu-id="3abce-133">Začněte tím, že aktualizujete stránku *filmy* , aby každý seznam filmů obsahoval i odkaz pro **Úpravy** .</span><span class="sxs-lookup"><span data-stu-id="3abce-133">To begin, you'll update the *Movies* page so that each movie listing also contains an **Edit** link.</span></span>

<span data-ttu-id="3abce-134">Otevřete soubor *Movies. cshtml* .</span><span class="sxs-lookup"><span data-stu-id="3abce-134">Open the *Movies.cshtml* file.</span></span>

<span data-ttu-id="3abce-135">V těle stránky změňte kód `WebGrid` přidáním sloupce.</span><span class="sxs-lookup"><span data-stu-id="3abce-135">In the body of the page, change the `WebGrid` markup by adding a column.</span></span> <span data-ttu-id="3abce-136">Zde je upravený kód:</span><span class="sxs-lookup"><span data-stu-id="3abce-136">Here's the modified markup:</span></span>

[!code-html[Main](updating-data/samples/sample1.html?highlight=6)]

<span data-ttu-id="3abce-137">Nový sloupec je tento:</span><span class="sxs-lookup"><span data-stu-id="3abce-137">The new column is this one:</span></span>

[!code-html[Main](updating-data/samples/sample2.html)]

<span data-ttu-id="3abce-138">V bodě tohoto sloupce je zobrazen odkaz (`<a>` element), jehož text říká "Edit".</span><span class="sxs-lookup"><span data-stu-id="3abce-138">The point of this column is to show a link (`<a>` element) whose text says "Edit".</span></span> <span data-ttu-id="3abce-139">I když je po spuštění stránky potřeba vytvořit odkaz, který vypadá takto: `id` hodnota pro každý film se liší:</span><span class="sxs-lookup"><span data-stu-id="3abce-139">What we're after is to create a link that looks like the following when the page runs, with the `id` value different for each movie:</span></span>

[!code-css[Main](updating-data/samples/sample3.css)]

<span data-ttu-id="3abce-140">Tento odkaz vyvolá stránku s názvem *EditMovie*a předá řetězec dotazu `?id=7` této stránce.</span><span class="sxs-lookup"><span data-stu-id="3abce-140">This link will invoke a page named *EditMovie*, and it will pass the query string `?id=7` to that page.</span></span>

<span data-ttu-id="3abce-141">Syntaxe nového sloupce může vypadat jako složitý, ale je to pouze proto, že se skládá z několika prvků.</span><span class="sxs-lookup"><span data-stu-id="3abce-141">The syntax for the new column might look a bit complex, but that's only because it puts together several elements.</span></span> <span data-ttu-id="3abce-142">Každý jednotlivý prvek je jednoduchý.</span><span class="sxs-lookup"><span data-stu-id="3abce-142">Each individual element is straightforward.</span></span> <span data-ttu-id="3abce-143">Pokud se zaměříte na pouze `<a>` element, uvidíte tento kód:</span><span class="sxs-lookup"><span data-stu-id="3abce-143">If you concentrate on just the `<a>` element, you see this markup:</span></span>

[!code-html[Main](updating-data/samples/sample4.html)]

<span data-ttu-id="3abce-144">Další informace o tom, jak mřížka funguje: Mřížka zobrazuje řádky, jednu pro každý záznam databáze a zobrazuje sloupce pro každé pole v záznamu databáze.</span><span class="sxs-lookup"><span data-stu-id="3abce-144">Some background about how the grid works: the grid displays rows, one for each database record, and it displays columns for each field in the database record.</span></span> <span data-ttu-id="3abce-145">Při sekonstrukci každého řádku mřížky objekt `item` obsahuje záznam databáze (položku) pro tento řádek.</span><span class="sxs-lookup"><span data-stu-id="3abce-145">While each grid row is being constructed, the `item` object contains the database record (item) for that row.</span></span> <span data-ttu-id="3abce-146">Toto uspořádání poskytuje způsob, jak v kódu získat data pro daný řádek.</span><span class="sxs-lookup"><span data-stu-id="3abce-146">This arrangement gives you a way in code to get at the data for that row.</span></span> <span data-ttu-id="3abce-147">To je to, co vidíte tady: výraz `item.ID` získává hodnotu ID aktuální položky databáze.</span><span class="sxs-lookup"><span data-stu-id="3abce-147">That's what you see here: the expression `item.ID` is getting the ID value of the current database item.</span></span> <span data-ttu-id="3abce-148">Můžete získat libovolný z hodnot databáze (název, Žánr nebo rok) stejným způsobem jako při použití `item.Title`, `item.Genre`nebo `item.Year`.</span><span class="sxs-lookup"><span data-stu-id="3abce-148">You could get any of the database values (title, genre, or year) the same way by using `item.Title`, `item.Genre`, or `item.Year`.</span></span>

<span data-ttu-id="3abce-149">Výraz `"~/EditMovie?id=@item.ID` kombinuje pevně zakódovaný součást cílové adresy URL (`~/EditMovie?id=`) s tímto dynamicky odvozeným ID.</span><span class="sxs-lookup"><span data-stu-id="3abce-149">The expression `"~/EditMovie?id=@item.ID` combines the hard-coded part of the target URL (`~/EditMovie?id=`) with this dynamically derived ID.</span></span> <span data-ttu-id="3abce-150">(V předchozím kurzu jste viděli operátor `~`, jedná se o operátor ASP.NET, který představuje aktuální kořenový adresář webu.)</span><span class="sxs-lookup"><span data-stu-id="3abce-150">(You saw the `~` operator in the previous tutorial; it's an ASP.NET operator that represents the current website root.)</span></span>

<span data-ttu-id="3abce-151">Výsledkem je, že tato část kódu ve sloupci jednoduše vytvoří jako následující kód v době běhu něco podobného jako v následujícím kódu:</span><span class="sxs-lookup"><span data-stu-id="3abce-151">The result is that this part of the markup in the column simply produces something like the following markup at run time:</span></span>

[!code-xml[Main](updating-data/samples/sample5.xml)]

<span data-ttu-id="3abce-152">Přirozeně platí, že skutečná hodnota `id` bude pro každý řádek odlišná.</span><span class="sxs-lookup"><span data-stu-id="3abce-152">Naturally, the actual value of `id` will be different for each row.</span></span>

## <a name="creating-a-custom-display-for-a-grid-column"></a><span data-ttu-id="3abce-153">Vytvoření vlastního zobrazení pro sloupec mřížky</span><span class="sxs-lookup"><span data-stu-id="3abce-153">Creating a Custom Display for a Grid Column</span></span>

<span data-ttu-id="3abce-154">Nyní zpět do sloupce Grid.</span><span class="sxs-lookup"><span data-stu-id="3abce-154">Now back to the grid column.</span></span> <span data-ttu-id="3abce-155">Tři sloupce, které jste původně použili v mřížce, zobrazují jenom datové hodnoty (název, Žánr a rok).</span><span class="sxs-lookup"><span data-stu-id="3abce-155">The three columns you originally had in the grid displayed only data values (title, genre, and year).</span></span> <span data-ttu-id="3abce-156">Toto zobrazení jste určili předáním názvu sloupce databáze &mdash; například `grid.Column("Title")`.</span><span class="sxs-lookup"><span data-stu-id="3abce-156">You specified this display by passing the name of the database column &mdash; for example, `grid.Column("Title")`.</span></span>

<span data-ttu-id="3abce-157">Tento nový sloupec odkaz pro **Úpravy** se liší.</span><span class="sxs-lookup"><span data-stu-id="3abce-157">This new **Edit** link column is different.</span></span> <span data-ttu-id="3abce-158">Místo zadání názvu sloupce předáváte `format` parametr.</span><span class="sxs-lookup"><span data-stu-id="3abce-158">Instead of specifying a column name, you're passing a `format` parameter.</span></span> <span data-ttu-id="3abce-159">Tento parametr umožňuje definovat značku, kterou `WebGrid` pomocnou nápovědu vykreslí spolu s hodnotou `item` pro zobrazení dat sloupce jako tučné nebo zelené nebo v jakémkoli požadovaném formátu.</span><span class="sxs-lookup"><span data-stu-id="3abce-159">This parameter lets you define markup that the `WebGrid` helper will render along with the `item` value to display the column data as bold or green or in whatever format that you want.</span></span> <span data-ttu-id="3abce-160">Pokud byste například chtěli, aby se nadpis zobrazoval tučně, mohli byste vytvořit sloupec podobný tomuto příkladu:</span><span class="sxs-lookup"><span data-stu-id="3abce-160">For example, if you wanted the title to appear bold, you could create a column like this example:</span></span>

[!code-html[Main](updating-data/samples/sample6.html)]

<span data-ttu-id="3abce-161">(Různé `@` znaky, které vidíte ve vlastnosti `format` označuje přechod mezi značkami a hodnotou kódu.)</span><span class="sxs-lookup"><span data-stu-id="3abce-161">(The various `@` characters you see in the `format` property mark the transition between markup and a code value.)</span></span>

<span data-ttu-id="3abce-162">Jakmile budete vědět o vlastnosti `format`, je snazší pochopit, jak je nový sloupec odkaz pro **Úpravy** vložen dohromady:</span><span class="sxs-lookup"><span data-stu-id="3abce-162">Once you know about the `format` property, it's easier to understand how the new **Edit** link column is put together:</span></span>

[!code-html[Main](updating-data/samples/sample7.html)]

<span data-ttu-id="3abce-163">Sloupec se skládá *pouze* ze značky, který vykresluje odkaz, a navíc některé informace (ID), které jsou extrahovány z záznamu databáze pro řádek.</span><span class="sxs-lookup"><span data-stu-id="3abce-163">The column consists *only* of the markup that renders the link, plus some information (the ID) that's extracted from the database record for the row.</span></span>

> [!TIP]
> 
> <span data-ttu-id="3abce-164">**Pojmenované parametry a poziční parametry pro metodu**</span><span class="sxs-lookup"><span data-stu-id="3abce-164">**Named Parameters and Positional Parameters for a Method**</span></span>
> 
> <span data-ttu-id="3abce-165">V mnoha případech, kdy jste volali metodu a předali do ní parametry, jste jednoduše zadali hodnoty parametrů oddělené čárkami.</span><span class="sxs-lookup"><span data-stu-id="3abce-165">Many times when you've called a method and passed parameters to it, you've simply listed the parameter values separated by commas.</span></span> <span data-ttu-id="3abce-166">Tady je několik příkladů:</span><span class="sxs-lookup"><span data-stu-id="3abce-166">Here are a couple of examples:</span></span>
> 
> `db.Execute(insertCommand, title, genre, year)`
> 
> `Validation.RequireField("title", "You must enter a title")`
> 
> <span data-ttu-id="3abce-167">Neuváděli jsme problém, když jste si tento kód poprvé viděli, ale v každém případě předáváte parametry metodám v určitém pořadí &mdash; konkrétně, pořadí, ve kterém jsou parametry definované v této metodě.</span><span class="sxs-lookup"><span data-stu-id="3abce-167">We didn't mention the issue when you first saw this code, but in each case, you're passing parameters to the methods in a specific order &mdash; namely, the order in which the parameters are defined in that method.</span></span> <span data-ttu-id="3abce-168">V případě `db.Execute` a `Validation.RequireFields`se při spuštění stránky zobrazí chybová zpráva, když se stránka spustí, nebo alespoň některých neobvyklých výsledků.</span><span class="sxs-lookup"><span data-stu-id="3abce-168">For `db.Execute` and `Validation.RequireFields`, if you mixed up the order of the values you pass, you'd get an error message when the page runs, or at least some strange results.</span></span> <span data-ttu-id="3abce-169">Jasně je nutné znát pořadí předání parametrů v.</span><span class="sxs-lookup"><span data-stu-id="3abce-169">Clearly, you have to know the order to pass the parameters in.</span></span> <span data-ttu-id="3abce-170">(Ve WebMatrix vám IntelliSense může pořídit, jak zjistit název, typ a pořadí parametrů.)</span><span class="sxs-lookup"><span data-stu-id="3abce-170">(In WebMatrix, IntelliSense can help you learn figure out the name, type, and order of the parameters.)</span></span>
> 
> <span data-ttu-id="3abce-171">Jako alternativu k předávání hodnot v pořadí můžete použít *pojmenované parametry*.</span><span class="sxs-lookup"><span data-stu-id="3abce-171">As an alternative to passing values in order, you can use *named parameters*.</span></span> <span data-ttu-id="3abce-172">(Předání parametrů v pořadí se říká použití *pozičních parametrů*.) U pojmenovaných parametrů explicitně zahrnete název parametru při předání jeho hodnoty.</span><span class="sxs-lookup"><span data-stu-id="3abce-172">(Passing parameters in order is known as using *positional parameters*.) For named parameters, you explicitly include the name of the parameter when passing its value.</span></span> <span data-ttu-id="3abce-173">Pojmenované parametry už v těchto kurzech využijete několikrát.</span><span class="sxs-lookup"><span data-stu-id="3abce-173">You've used named parameters already a number of times in these tutorials.</span></span> <span data-ttu-id="3abce-174">Příklad:</span><span class="sxs-lookup"><span data-stu-id="3abce-174">For example:</span></span>
> 
> [!code-csharp[Main](updating-data/samples/sample8.cs)]
> 
> <span data-ttu-id="3abce-175">a</span><span class="sxs-lookup"><span data-stu-id="3abce-175">and</span></span>
> 
> [!code-css[Main](updating-data/samples/sample9.css)]
> 
> <span data-ttu-id="3abce-176">Pojmenované parametry jsou užitečné v několika situacích, zejména v případě, že metoda přijímá mnoho parametrů.</span><span class="sxs-lookup"><span data-stu-id="3abce-176">Named parameters are handy for a couple of situations, especially when a method takes many parameters.</span></span> <span data-ttu-id="3abce-177">Jedním z nich je, že chcete předat jenom jeden nebo dva parametry, ale hodnoty, které chcete předat, nejsou mezi prvními pozicemi v seznamu parametrů.</span><span class="sxs-lookup"><span data-stu-id="3abce-177">One is when you want to pass only one or two parameters, but the values you want to pass are not among the first positions in the parameter list.</span></span> <span data-ttu-id="3abce-178">Další situací je, že chcete, aby byl váš kód čitelnější předáním parametrů v pořadí, které vám dává smysl.</span><span class="sxs-lookup"><span data-stu-id="3abce-178">Another situation is when you want to make your code more readable by passing the parameters in the order that makes the most sense to you.</span></span>
> 
> <span data-ttu-id="3abce-179">Aby bylo možné použít pojmenované parametry, je třeba znát názvy parametrů.</span><span class="sxs-lookup"><span data-stu-id="3abce-179">Obviously, to use named parameters, you have to know the names of the parameters.</span></span> <span data-ttu-id="3abce-180">WebMatrix IntelliSense může *Zobrazit* názvy, ale nemůže je aktuálně vyplnit za vás.</span><span class="sxs-lookup"><span data-stu-id="3abce-180">WebMatrix IntelliSense can *show* you the names, but it cannot currently fill them in for you.</span></span>

## <a name="creating-the-edit-page"></a><span data-ttu-id="3abce-181">Vytvoření stránky pro úpravy</span><span class="sxs-lookup"><span data-stu-id="3abce-181">Creating the Edit Page</span></span>

<span data-ttu-id="3abce-182">Nyní můžete vytvořit stránku *EditMovie* .</span><span class="sxs-lookup"><span data-stu-id="3abce-182">Now you can create the *EditMovie* page.</span></span> <span data-ttu-id="3abce-183">Když uživatel klikne na odkaz pro **Úpravy** , ukončí se na této stránce.</span><span class="sxs-lookup"><span data-stu-id="3abce-183">When users click the **Edit** link, they'll end up on this page.</span></span>

<span data-ttu-id="3abce-184">Vytvořte stránku s názvem *EditMovie. cshtml* a nahraďte obsah souboru následujícím kódem:</span><span class="sxs-lookup"><span data-stu-id="3abce-184">Create a page named *EditMovie.cshtml* and replace what's in the file with the following markup:</span></span>

[!code-cshtml[Main](updating-data/samples/sample10.cshtml)]

<span data-ttu-id="3abce-185">Tato značka a kód se podobá tomu, co máte na stránce *AddMovie* .</span><span class="sxs-lookup"><span data-stu-id="3abce-185">This markup and code is similar to what you have in the *AddMovie* page.</span></span> <span data-ttu-id="3abce-186">V textu tlačítka Odeslat je malý rozdíl.</span><span class="sxs-lookup"><span data-stu-id="3abce-186">There's a small difference in the text for the submit button.</span></span> <span data-ttu-id="3abce-187">Stejně jako u stránky *AddMovie* existuje `Html.ValidationSummary` volání, které zobrazí chyby ověřování, pokud existují.</span><span class="sxs-lookup"><span data-stu-id="3abce-187">As with the *AddMovie* page, there's an `Html.ValidationSummary` call that will display validation errors if there are any.</span></span> <span data-ttu-id="3abce-188">Tentokrát opouštíme volání `Validation.Message`, protože se zobrazí chyby v souhrnu ověření.</span><span class="sxs-lookup"><span data-stu-id="3abce-188">This time we're leaving out calls to `Validation.Message`, since errors will be displayed in the validation summary.</span></span> <span data-ttu-id="3abce-189">Jak je uvedeno v předchozím kurzu, můžete použít souhrn ověření a jednotlivé chybové zprávy v různých kombinacích.</span><span class="sxs-lookup"><span data-stu-id="3abce-189">As noted in the previous tutorial, you can use the validation summary and the individual error messages in various combinations.</span></span>

<span data-ttu-id="3abce-190">Znovu si všimněte, že atribut `method` elementu `<form>` je nastaven na `post`.</span><span class="sxs-lookup"><span data-stu-id="3abce-190">Notice again that the `method` attribute of the `<form>` element is set to `post`.</span></span> <span data-ttu-id="3abce-191">Stejně jako u stránky *AddMovie. cshtml* provede tato stránka změny v databázi.</span><span class="sxs-lookup"><span data-stu-id="3abce-191">As with the *AddMovie.cshtml* page, this page makes changes to the database.</span></span> <span data-ttu-id="3abce-192">Proto by tento formulář měl provádět operaci `POST`.</span><span class="sxs-lookup"><span data-stu-id="3abce-192">Therefore, this form should perform a `POST` operation.</span></span> <span data-ttu-id="3abce-193">(Další informace o rozdílu mezi operacemi `GET` a `POST` najdete v tématu o [bezpečnosti operací GET, post a http](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) v kurzu o formulářích HTML.)</span><span class="sxs-lookup"><span data-stu-id="3abce-193">(For more about the difference between `GET` and `POST` operations, see the [GET, POST, and HTTP Verb Safety](form-basics.md#GET,_POST,_and_HTTP_Verb_Safety) sidebar in the tutorial on HTML forms.)</span></span>

<span data-ttu-id="3abce-194">Jak jste viděli v předchozím kurzu, atributy `value` textových polí se nastavují pomocí kódu Razor, aby je bylo možné předem načíst.</span><span class="sxs-lookup"><span data-stu-id="3abce-194">As you saw in an earlier tutorial, the `value` attributes of the text boxes are being set with Razor code in order to preload them.</span></span> <span data-ttu-id="3abce-195">Tentokrát ale používáte proměnné jako `title` a `genre` pro tuto úlohu místo `Request.Form["title"]`:</span><span class="sxs-lookup"><span data-stu-id="3abce-195">This time, though, you're using variables like `title` and `genre` for that task instead of `Request.Form["title"]`:</span></span>

`<input type="text" name="title" value="@title" />`

<span data-ttu-id="3abce-196">Stejně jako v tomto kódu bude tento kód předem načítat hodnoty textového pole s hodnotami filmu.</span><span class="sxs-lookup"><span data-stu-id="3abce-196">As before, this markup will preload the text box values with the movie values.</span></span> <span data-ttu-id="3abce-197">Zobrazí se čas, proč je užitečné místo použití objektu `Request` použít proměnné.</span><span class="sxs-lookup"><span data-stu-id="3abce-197">You'll see in a moment why it's handy to use variables this time instead of using the `Request` object.</span></span>

<span data-ttu-id="3abce-198">Na této stránce je také `<input type="hidden">` element.</span><span class="sxs-lookup"><span data-stu-id="3abce-198">There's also a `<input type="hidden">` element on this page.</span></span> <span data-ttu-id="3abce-199">Tento element ukládá ID filmu bez toho, aby byl viditelný na stránce.</span><span class="sxs-lookup"><span data-stu-id="3abce-199">This element stores the movie ID without making it visible on the page.</span></span> <span data-ttu-id="3abce-200">ID je zpočátku předáno na stránku pomocí hodnoty řetězce dotazu (`?id=7` nebo podobný v adrese URL).</span><span class="sxs-lookup"><span data-stu-id="3abce-200">The ID is initially passed to the page by using a query string value (`?id=7` or similar in the URL).</span></span> <span data-ttu-id="3abce-201">Vložením hodnoty ID do skrytého pole se můžete ujistit, že je k dispozici při odeslání formuláře, a to i v případě, že již nemáte přístup k původní adrese URL, ve které byla stránka vyvolána.</span><span class="sxs-lookup"><span data-stu-id="3abce-201">By putting the ID value into a hidden field, you can make sure that it's available when the form is submitted, even if you no longer have access to the original URL that the page was invoked with.</span></span>

<span data-ttu-id="3abce-202">Na rozdíl od stránky *AddMovie* má kód stránky *EditMovie* dvě odlišné funkce.</span><span class="sxs-lookup"><span data-stu-id="3abce-202">Unlike the *AddMovie* page, the code for the *EditMovie* page has two distinct functions.</span></span> <span data-ttu-id="3abce-203">První funkce je, že když se stránka zobrazí poprvé (a *pouze* potom), kód získá ID filmu z řetězce dotazu.</span><span class="sxs-lookup"><span data-stu-id="3abce-203">The first function is that when the page is displayed for the first time (and *only* then), the code gets the movie ID from the query string.</span></span> <span data-ttu-id="3abce-204">Kód pak pomocí ID přečte příslušný film z databáze a zobrazí ho (přednačtení) v textových polích.</span><span class="sxs-lookup"><span data-stu-id="3abce-204">The code then uses the ID to read the corresponding movie out of the database and display (preload) it in the text boxes.</span></span>

<span data-ttu-id="3abce-205">Druhá funkce je, že když uživatel klikne na tlačítko **Odeslat změny** , kód musí číst hodnoty textových polí a ověřit je.</span><span class="sxs-lookup"><span data-stu-id="3abce-205">The second function is that when the user clicks the **Submit Changes** button, the code has to read the values of the text boxes and validate them.</span></span> <span data-ttu-id="3abce-206">Kód také musí aktualizovat položku databáze o nové hodnoty.</span><span class="sxs-lookup"><span data-stu-id="3abce-206">The code also has to update the database item with the new values.</span></span> <span data-ttu-id="3abce-207">Tato technika je podobná přidání záznamu, jak jste viděli v *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="3abce-207">This technique is similar to adding a record, as you saw in *AddMovie*.</span></span>

## <a name="adding-code-to-read-a-single-movie"></a><span data-ttu-id="3abce-208">Přidání kódu pro čtení jednoho filmu</span><span class="sxs-lookup"><span data-stu-id="3abce-208">Adding Code to Read a Single Movie</span></span>

<span data-ttu-id="3abce-209">Chcete-li provést první funkci, přidejte tento kód do horní části stránky:</span><span class="sxs-lookup"><span data-stu-id="3abce-209">To perform the first function, add this code to the top of the page:</span></span>

[!code-cshtml[Main](updating-data/samples/sample11.cshtml)]

<span data-ttu-id="3abce-210">Většina tohoto kódu je uvnitř bloku, který začíná `if(!IsPost)`.</span><span class="sxs-lookup"><span data-stu-id="3abce-210">Most of this code is inside a block that starts `if(!IsPost)`.</span></span> <span data-ttu-id="3abce-211">Operátor `!` znamená "NOT", takže výraz znamená, že se nejedná o *příspěvek po odeslání*, což je nepřímý způsob, jak vyjádřit, *zda je tato žádost poprvé, kdy byla tato stránka spuštěna*.</span><span class="sxs-lookup"><span data-stu-id="3abce-211">The `!` operator means "not," so the expression means *if this request is not a post submission*, which is an indirect way of saying *if this request is the first time that this page has been run*.</span></span> <span data-ttu-id="3abce-212">Jak bylo uvedeno dříve, tento kód by měl běžet *pouze* při prvním spuštění stránky.</span><span class="sxs-lookup"><span data-stu-id="3abce-212">As noted earlier, this code should run *only* the first time the page runs.</span></span> <span data-ttu-id="3abce-213">Pokud jste kód nezahrnuli do `if(!IsPost)`, bude spuštěn při každém vyvolání stránky, ať už poprvé, nebo v reakci na kliknutí na tlačítko.</span><span class="sxs-lookup"><span data-stu-id="3abce-213">If you didn't enclose the code in `if(!IsPost)`, it would run every time the page is invoked, whether the first time or in response to a button click.</span></span>

<span data-ttu-id="3abce-214">Všimněte si, že kód obsahuje `else` blokovat tento čas.</span><span class="sxs-lookup"><span data-stu-id="3abce-214">Notice that the code includes an `else` block this time.</span></span> <span data-ttu-id="3abce-215">Jak jsme uvedli, že jsme zavedli `if` bloky, někdy budete chtít spustit alternativní kód, pokud podmínka, kterou testujete, není pravdivá.</span><span class="sxs-lookup"><span data-stu-id="3abce-215">As we said when we introduced `if` blocks, sometimes you want to run alternative code if the condition you're testing isn't true.</span></span> <span data-ttu-id="3abce-216">To je v tomto případě.</span><span class="sxs-lookup"><span data-stu-id="3abce-216">That's the case here.</span></span> <span data-ttu-id="3abce-217">Pokud podmínka projde (to znamená, že pokud je ID předané na stránku ok), přečtěte si řádek z databáze.</span><span class="sxs-lookup"><span data-stu-id="3abce-217">If the condition passes (that is, if the ID passed to the page is ok), you read a row from the database.</span></span> <span data-ttu-id="3abce-218">Nicméně pokud podmínka není splněna, je spuštěn blok `else` a kód nastaví chybovou zprávu.</span><span class="sxs-lookup"><span data-stu-id="3abce-218">However, if the condition doesn't pass, the `else` block runs and the code sets an error message.</span></span>

## <a name="validating-a-value-passed-to-the-page"></a><span data-ttu-id="3abce-219">Ověření hodnoty předané stránce</span><span class="sxs-lookup"><span data-stu-id="3abce-219">Validating a Value Passed to the Page</span></span>

<span data-ttu-id="3abce-220">Kód používá `Request.QueryString["id"]` k získání ID, které je předáno stránce.</span><span class="sxs-lookup"><span data-stu-id="3abce-220">The code uses `Request.QueryString["id"]` to get the ID that's passed to the page.</span></span> <span data-ttu-id="3abce-221">Kód zajišťuje, aby byla hodnota pro ID skutečně předána.</span><span class="sxs-lookup"><span data-stu-id="3abce-221">The code makes sure that a value was actually passed for the ID.</span></span> <span data-ttu-id="3abce-222">Pokud nebyla předána žádná hodnota, kód nastaví chybu ověřování.</span><span class="sxs-lookup"><span data-stu-id="3abce-222">If no value was passed, the code sets a validation error.</span></span>

<span data-ttu-id="3abce-223">Tento kód ukazuje jiný způsob, jak ověřit informace.</span><span class="sxs-lookup"><span data-stu-id="3abce-223">This code shows a different way to validate information.</span></span> <span data-ttu-id="3abce-224">V předchozím kurzu jste pracovali s pomocníkem `Validation`.</span><span class="sxs-lookup"><span data-stu-id="3abce-224">In the previous tutorial, you worked with the `Validation` helper.</span></span> <span data-ttu-id="3abce-225">Zaregistrovali jste pole k ověření a ASP.NET automaticky prošly ověřováním a zobrazenými chybami pomocí `Html.ValidationMessage` a `Html.ValidationSummary`.</span><span class="sxs-lookup"><span data-stu-id="3abce-225">You registered fields to validate, and ASP.NET automatically did the validation and displayed errors by using `Html.ValidationMessage` and `Html.ValidationSummary`.</span></span> <span data-ttu-id="3abce-226">V takovém případě ale neověřujete vstup uživatele.</span><span class="sxs-lookup"><span data-stu-id="3abce-226">In this case, however, you're not really validating user input.</span></span> <span data-ttu-id="3abce-227">Místo toho ověřujete hodnotu, která byla předána stránce jinde.</span><span class="sxs-lookup"><span data-stu-id="3abce-227">Instead, you're validating a value that was passed to the page from elsewhere.</span></span> <span data-ttu-id="3abce-228">Pomocná rutina `Validation` to neudělá za vás.</span><span class="sxs-lookup"><span data-stu-id="3abce-228">The `Validation` helper doesn't do that for you.</span></span>

<span data-ttu-id="3abce-229">Proto si tuto hodnotu zkontrolujete sami tak, že ji otestujete pomocí `if(!Request.QueryString["ID"].IsEmpty()`).</span><span class="sxs-lookup"><span data-stu-id="3abce-229">Therefore, you check the value yourself, by testing it with `if(!Request.QueryString["ID"].IsEmpty()`).</span></span> <span data-ttu-id="3abce-230">Pokud dojde k potížím, můžete zobrazit chybu pomocí `Html.ValidationSummary`, stejně jako u pomocné rutiny `Validation`.</span><span class="sxs-lookup"><span data-stu-id="3abce-230">If there's a problem, you can display the error by using `Html.ValidationSummary`, as you did with the `Validation` helper.</span></span> <span data-ttu-id="3abce-231">Chcete-li to provést, zavolejte `Validation.AddFormError` a předejte jí zprávu k zobrazení.</span><span class="sxs-lookup"><span data-stu-id="3abce-231">To do that, you call `Validation.AddFormError` and pass it a message to display.</span></span> <span data-ttu-id="3abce-232">`Validation.AddFormError` je vestavěná metoda, která umožňuje definovat vlastní zprávy, které se propojují se systémem ověřování, který jste už obeznámeni s nástrojem.</span><span class="sxs-lookup"><span data-stu-id="3abce-232">`Validation.AddFormError` is a built-in method that lets you define custom messages that tie in with the validation system you're already familiar with.</span></span> <span data-ttu-id="3abce-233">(Později v tomto kurzu budeme mluvit o tom, jak tento proces ověřování udělat trochu robustnější.)</span><span class="sxs-lookup"><span data-stu-id="3abce-233">(Later in this tutorial we'll talk about how to make this validation process a little more robust.)</span></span>

<span data-ttu-id="3abce-234">Po ujištění, že je pro film k dispozici ID, přečte tento kód databázi a vyhledá pouze jednu položku databáze.</span><span class="sxs-lookup"><span data-stu-id="3abce-234">After making sure that there's an ID for the movie, the code reads the database, looking for only a single database item.</span></span> <span data-ttu-id="3abce-235">(Pravděpodobně jste si všimli obecný vzor pro databázové operace: Otevřete databázi, definujte příkaz SQL a spusťte příkaz.) Tentokrát příkaz SQL `Select` zahrnuje `WHERE ID = @0`.</span><span class="sxs-lookup"><span data-stu-id="3abce-235">(You probably have noticed the general pattern for database operations: open the database, define a SQL statement, and run the statement.) This time, the SQL `Select` statement includes `WHERE ID = @0`.</span></span> <span data-ttu-id="3abce-236">Vzhledem k tomu, že ID je jedinečné, může být vrácen pouze jeden záznam.</span><span class="sxs-lookup"><span data-stu-id="3abce-236">Because the ID is unique, only one record can be returned.</span></span>

<span data-ttu-id="3abce-237">Dotaz je proveden pomocí `db.QuerySingle` (není `db.Query`, jak jste použili pro záznam filmu) a kód vloží výsledek do proměnné `row`.</span><span class="sxs-lookup"><span data-stu-id="3abce-237">The query is performed by using `db.QuerySingle` (not `db.Query`, as you used for the movie listing), and the code puts the result into the `row` variable.</span></span> <span data-ttu-id="3abce-238">Název `row` je libovolný. proměnné můžete pojmenovat libovolným způsobem.</span><span class="sxs-lookup"><span data-stu-id="3abce-238">The name `row` is arbitrary; you can name the variables anything you like.</span></span> <span data-ttu-id="3abce-239">Proměnné inicializované v horní části se pak vyplní podrobnostmi o videu, aby se tyto hodnoty mohly zobrazit v textových polích.</span><span class="sxs-lookup"><span data-stu-id="3abce-239">The variables initialized at the top are then filled with the movie details so that these values can be displayed in the text boxes.</span></span>

## <a name="testing-the-edit-page-so-far"></a><span data-ttu-id="3abce-240">Testování stránky pro úpravy (zatím daleko)</span><span class="sxs-lookup"><span data-stu-id="3abce-240">Testing the Edit Page (So Far)</span></span>

<span data-ttu-id="3abce-241">Pokud chcete stránku otestovat, spusťte nyní stránku *filmy* a klikněte na odkaz **Upravit** vedle libovolného videa.</span><span class="sxs-lookup"><span data-stu-id="3abce-241">If you'd like to test your page, run the *Movies* page now and click an **Edit** link next to any movie.</span></span> <span data-ttu-id="3abce-242">Zobrazí se stránka *EditMovie* s podrobnostmi, které jste vyplnili pro vybraný film:</span><span class="sxs-lookup"><span data-stu-id="3abce-242">You'll see the *EditMovie* page with the details filled in for the movie you selected:</span></span>

![Upravit stránku videa zobrazující film, který se má upravit](updating-data/_static/image3.png)

<span data-ttu-id="3abce-244">Všimněte si, že adresa URL stránky obsahuje něco jako `?id=10` (nebo nějaké jiné číslo).</span><span class="sxs-lookup"><span data-stu-id="3abce-244">Notice that the URL of the page includes something like `?id=10` (or some other number).</span></span> <span data-ttu-id="3abce-245">Proto jste se seznámili s tím, že na stránce *videa* funguje **Úpravy** , že vaše stránka čte ID z řetězce dotazu a že databázový dotaz, který získá jeden záznam filmu, funguje.</span><span class="sxs-lookup"><span data-stu-id="3abce-245">So far you've tested that **Edit** links in the *Movie* page work, that your page is reading the ID from the query string, and that the database query to get a single movie record is working.</span></span>

<span data-ttu-id="3abce-246">Můžete změnit informace o videu, ale po kliknutí na tlačítko **Odeslat změny**nedojde k žádné akci.</span><span class="sxs-lookup"><span data-stu-id="3abce-246">You can change the movie information, but nothing happens when you click **Submit Changes**.</span></span>

## <a name="adding-code-to-update-the-movie-with-the-users-changes"></a><span data-ttu-id="3abce-247">Přidání kódu pro aktualizaci videa se změnami uživatele</span><span class="sxs-lookup"><span data-stu-id="3abce-247">Adding Code to Update the Movie with the User's Changes</span></span>

<span data-ttu-id="3abce-248">V souboru *EditMovie. cshtml* pro implementaci druhé funkce (uložení změn) přidejte následující kód těsně do uzavírací závorky bloku `@`.</span><span class="sxs-lookup"><span data-stu-id="3abce-248">In the *EditMovie.cshtml* file, to implement the second function (saving changes), add the following code just inside the closing brace of the `@` block.</span></span> <span data-ttu-id="3abce-249">(Pokud si nejste jistí přesně, kam kód vložit, můžete si prohlédnout [kompletní výpis kódu na stránce Upravit film](#Complete_Page_Listing_for_EditMovie) , která se zobrazí na konci tohoto kurzu.)</span><span class="sxs-lookup"><span data-stu-id="3abce-249">(If you're not sure exactly where to put the code, you can look at the [complete code listing for the Edit Movie page](#Complete_Page_Listing_for_EditMovie) that appears at the end of this tutorial.)</span></span>

[!code-csharp[Main](updating-data/samples/sample12.cs)]

<span data-ttu-id="3abce-250">Tento kód je opět podobný kódu v *AddMovie*.</span><span class="sxs-lookup"><span data-stu-id="3abce-250">Again, this markup and code is similar to the code in *AddMovie*.</span></span> <span data-ttu-id="3abce-251">Kód je v bloku `if(IsPost)`, protože tento kód je spuštěn pouze v případě, že uživatel klikne na tlačítko **Odeslat změny** &mdash; to, kdy (a pouze když) byl formulář publikován.</span><span class="sxs-lookup"><span data-stu-id="3abce-251">The code is in an `if(IsPost)` block, because this code runs only when the user clicks the **Submit Changes** button &mdash; that is, when (and only when) the form has been posted.</span></span> <span data-ttu-id="3abce-252">V tomto případě nepoužíváte test jako `if(IsPost && Validation.IsValid())`– to znamená, že nezkombinujete oba testy pomocí a.</span><span class="sxs-lookup"><span data-stu-id="3abce-252">In this case, you're not using a test like `if(IsPost && Validation.IsValid())`— that is, you're not combining both tests by using AND.</span></span> <span data-ttu-id="3abce-253">Na této stránce nejprve určíte, zda se jedná o odeslání formuláře (`if(IsPost)`), a poté zaregistrujte pole pro ověření.</span><span class="sxs-lookup"><span data-stu-id="3abce-253">In this page, you first determine whether there's a form submission (`if(IsPost)`), and only then register the fields for validation.</span></span> <span data-ttu-id="3abce-254">Potom můžete testovat výsledky ověření (`if(Validation.IsValid()`).</span><span class="sxs-lookup"><span data-stu-id="3abce-254">Then you can test the validation results (`if(Validation.IsValid()`).</span></span> <span data-ttu-id="3abce-255">Tok je trochu jiný než na stránce *AddMovie. cshtml* , ale účinek je stejný.</span><span class="sxs-lookup"><span data-stu-id="3abce-255">The flow is slightly different than in the *AddMovie.cshtml* page, but the effect is the same.</span></span>

<span data-ttu-id="3abce-256">Hodnoty textových polí získáte pomocí `Request.Form["title"]` a podobného kódu pro ostatní prvky `<input>`.</span><span class="sxs-lookup"><span data-stu-id="3abce-256">You get the values of the text boxes by using `Request.Form["title"]` and similar code for the other `<input>` elements.</span></span> <span data-ttu-id="3abce-257">Všimněte si, že tentokrát kód získá ID filmu z skrytého pole (`<input type="hidden">`).</span><span class="sxs-lookup"><span data-stu-id="3abce-257">Notice that this time, the code gets the movie ID out of the hidden field (`<input type="hidden">`).</span></span> <span data-ttu-id="3abce-258">Při prvním spuštění stránky kód získal z řetězce dotazu ID.</span><span class="sxs-lookup"><span data-stu-id="3abce-258">When the page ran the first time, the code got the ID out of the query string.</span></span> <span data-ttu-id="3abce-259">Hodnotu z skrytého pole získáte, abyste se ujistili, že získáváte ID původně zobrazeného videa pro případ, že řetězec dotazu byl od té doby nějakým způsobem změněn.</span><span class="sxs-lookup"><span data-stu-id="3abce-259">You get the value from the hidden field to make sure that you're getting the ID of the movie that was originally displayed, in case the query string was somehow altered since then.</span></span>

<span data-ttu-id="3abce-260">Skutečně je důležité rozdíl mezi kódem *AddMovie* a tímto kódem je, že v tomto kódu je místo příkazu `Insert Into` použit příkaz SQL `Update`.</span><span class="sxs-lookup"><span data-stu-id="3abce-260">The really important difference between the *AddMovie* code and this code is that in this code you use the SQL `Update` statement instead of the `Insert Into` statement.</span></span> <span data-ttu-id="3abce-261">Následující příklad ukazuje syntaxi příkazu SQL `Update`:</span><span class="sxs-lookup"><span data-stu-id="3abce-261">The following example shows the syntax of the SQL `Update` statement:</span></span>

`UPDATE table SET col1="value", col2="value", col3="value" ... WHERE ID = value`

<span data-ttu-id="3abce-262">Můžete určit libovolné sloupce v libovolném pořadí a nemusíte nutně aktualizovat každý sloupec během operace `Update`.</span><span class="sxs-lookup"><span data-stu-id="3abce-262">You can specify any columns in any order, and you don't necessarily have to update every column during an `Update` operation.</span></span> <span data-ttu-id="3abce-263">(Samotné ID nemůžete aktualizovat, protože to by v platnosti mělo Uložit záznam jako nový záznam a to není u operace `Update` povolené.)</span><span class="sxs-lookup"><span data-stu-id="3abce-263">(You cannot update the ID itself, because that would in effect save the record as a new record, and that's not allowed for an `Update` operation.)</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="3abce-264">**Důležité** informace Klauzule `Where` s ID je velmi důležitá, protože to je způsob, jakým databáze ví, který záznam databáze chcete aktualizovat.</span><span class="sxs-lookup"><span data-stu-id="3abce-264">**Important** The `Where` clause with the ID is very important, because that's how the database knows which database record you want to update.</span></span> <span data-ttu-id="3abce-265">Pokud jste opustili klauzuli `Where`, databáze by aktualizovala *všechny* záznamy v databázi.</span><span class="sxs-lookup"><span data-stu-id="3abce-265">If you left off the `Where` clause, the database would update *every* record in the database.</span></span> <span data-ttu-id="3abce-266">Ve většině případů se jedná o havárie.</span><span class="sxs-lookup"><span data-stu-id="3abce-266">In most cases, that would be a disaster.</span></span>

<span data-ttu-id="3abce-267">V kódu jsou hodnoty, které se mají aktualizovat, předány příkazu SQL pomocí zástupných symbolů.</span><span class="sxs-lookup"><span data-stu-id="3abce-267">In the code, the values to update are passed to the SQL statement by using placeholders.</span></span> <span data-ttu-id="3abce-268">Pokud chcete opakovat, co jsme řekli: z bezpečnostních důvodů používejte k předávání hodnot do příkazu SQL *jenom* zástupné symboly.</span><span class="sxs-lookup"><span data-stu-id="3abce-268">To repeat what we've said before: for security reasons, *only* use placeholders to pass values to a SQL statement.</span></span>

<span data-ttu-id="3abce-269">Poté, co kód používá `db.Execute` ke spuštění příkazu `Update`, přesměruje zpět na stránku výpisu, kde můžete zobrazit změny.</span><span class="sxs-lookup"><span data-stu-id="3abce-269">After the code uses `db.Execute` to run the `Update` statement, it redirects back to the listing page, where you can see the changes.</span></span>

> [!TIP] 
> 
> <span data-ttu-id="3abce-270">**Různé příkazy SQL, různé metody**</span><span class="sxs-lookup"><span data-stu-id="3abce-270">**Different SQL Statements, Different Methods**</span></span>
> 
> <span data-ttu-id="3abce-271">Možná jste si všimli, že ke spouštění různých příkazů SQL používáte trochu odlišné metody.</span><span class="sxs-lookup"><span data-stu-id="3abce-271">You might have noticed that you use slightly different methods to run different SQL statements.</span></span> <span data-ttu-id="3abce-272">Chcete-li spustit dotaz `Select`, který potenciálně vrátí více záznamů, použijte metodu `Query`.</span><span class="sxs-lookup"><span data-stu-id="3abce-272">To run a `Select` query that potentially returns multiple records, you use the `Query` method.</span></span> <span data-ttu-id="3abce-273">Pokud chcete spustit `Select` dotaz, který znáte, vrátí jenom jednu položku databáze, použijte metodu `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="3abce-273">To run a `Select` query that you know will return only one database item, you use the `QuerySingle` method.</span></span> <span data-ttu-id="3abce-274">Chcete-li spustit příkazy, které provedou změny, ale nevracejí položky databáze, použijte metodu `Execute`.</span><span class="sxs-lookup"><span data-stu-id="3abce-274">To run commands that make changes but that don't return database items, you use the `Execute` method.</span></span>
> 
> <span data-ttu-id="3abce-275">Musíte mít různé metody, protože každá z nich vrací různé výsledky, protože jste viděli rozdíl mezi `Query` a `QuerySingle`.</span><span class="sxs-lookup"><span data-stu-id="3abce-275">You have to have different methods because each of them returns different results, as you saw already in the difference between `Query` and `QuerySingle`.</span></span> <span data-ttu-id="3abce-276">(Metoda `Execute` ve skutečnosti vrací hodnotu také &mdash;, konkrétně počet řádků databáze, které byly ovlivněny příkazem &mdash;, ale zatím jste je dosud nemuseli ignorovat.)</span><span class="sxs-lookup"><span data-stu-id="3abce-276">(The `Execute` method actually returns a value also &mdash; namely, the number of database rows that were affected by the command &mdash; but you've been ignoring that so far.)</span></span>
> 
> <span data-ttu-id="3abce-277">Samozřejmě může metoda `Query` vracet pouze jeden řádek databáze.</span><span class="sxs-lookup"><span data-stu-id="3abce-277">Of course, the `Query` method might return only one database row.</span></span> <span data-ttu-id="3abce-278">ASP.NET však vždy zpracovává výsledky metody `Query` jako kolekci.</span><span class="sxs-lookup"><span data-stu-id="3abce-278">However, ASP.NET always treats the results of the `Query` method as a collection.</span></span> <span data-ttu-id="3abce-279">I v případě, že metoda vrátí pouze jeden řádek, je nutné z kolekce extrahovat jeden řádek.</span><span class="sxs-lookup"><span data-stu-id="3abce-279">Even if the method returns just one row, you have to extract that single row from the collection.</span></span> <span data-ttu-id="3abce-280">Proto v situacích, kdy *víte* , že se dostanete jenom na jeden řádek, je to pro použití `QuerySingle`trochu pohodlnější.</span><span class="sxs-lookup"><span data-stu-id="3abce-280">Therefore, in situations where you *know* you'll get back only one row, it's a bit more convenient to use `QuerySingle`.</span></span>
> 
> <span data-ttu-id="3abce-281">K dispozici je několik dalších metod, které provádějí konkrétní typy databázových operací.</span><span class="sxs-lookup"><span data-stu-id="3abce-281">There are a few other methods that perform specific types of database operations.</span></span> <span data-ttu-id="3abce-282">Seznam metod databáze najdete v [rychlé referenční příručce k rozhraní API webových stránek ASP.NET](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span><span class="sxs-lookup"><span data-stu-id="3abce-282">You can find a listing of database methods in the [ASP.NET Web Pages API Quick Reference](../../api-reference/asp-net-web-pages-api-reference.md#Data).</span></span>

## <a name="making-validation-for-the-id-more-robust"></a><span data-ttu-id="3abce-283">Provádí se ověřování pro robustnější ID.</span><span class="sxs-lookup"><span data-stu-id="3abce-283">Making Validation for the ID More Robust</span></span>

<span data-ttu-id="3abce-284">Při prvním spuštění stránky získáte ID filmu z řetězce dotazu, abyste se mohli dostat k tomuto videu z databáze.</span><span class="sxs-lookup"><span data-stu-id="3abce-284">The first time that the page runs, you get the movie ID from the query string so that you can go get that movie from the database.</span></span> <span data-ttu-id="3abce-285">Provedli jste si, že skutečně existovala hodnota pro vyhledání, kterou jste provedli pomocí tohoto kódu:</span><span class="sxs-lookup"><span data-stu-id="3abce-285">You made sure that there actually was a value to go look for, which you did by using this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample13.cs)]

<span data-ttu-id="3abce-286">Tento kód jste použili k tomu, abyste se ujistili, že pokud se uživatel dostane na stránku *EditMovies* bez předchozího výběru videa na stránce *filmy* , stránka by zobrazila uživatelsky přívětivou chybovou zprávu.</span><span class="sxs-lookup"><span data-stu-id="3abce-286">You used this code to make sure that if a user gets to the *EditMovies* page without first selecting a movie in the *Movies* page, the page would display a user-friendly error message.</span></span> <span data-ttu-id="3abce-287">(V opačném případě se uživatelům zobrazí chyba, která by ji pravděpodobně Zaměňujte.)</span><span class="sxs-lookup"><span data-stu-id="3abce-287">(Otherwise, users would see an error that would probably just confuse them.)</span></span>

<span data-ttu-id="3abce-288">Toto ověřování však není velmi robustní.</span><span class="sxs-lookup"><span data-stu-id="3abce-288">However, this validation isn't very robust.</span></span> <span data-ttu-id="3abce-289">Tato stránka se může vyvolávat taky s těmito chybami:</span><span class="sxs-lookup"><span data-stu-id="3abce-289">The page might also be invoked with these errors:</span></span>

- <span data-ttu-id="3abce-290">ID není číslo.</span><span class="sxs-lookup"><span data-stu-id="3abce-290">The ID isn't a number.</span></span> <span data-ttu-id="3abce-291">Například stránku lze vyvolat pomocí adresy URL, jako je `http://localhost:nnnnn/EditMovie?id=abc`.</span><span class="sxs-lookup"><span data-stu-id="3abce-291">For example, the page could be invoked with a URL like `http://localhost:nnnnn/EditMovie?id=abc`.</span></span>
- <span data-ttu-id="3abce-292">ID je číslo, ale odkazuje na film, který neexistuje (například `http://localhost:nnnnn/EditMovie?id=100934`).</span><span class="sxs-lookup"><span data-stu-id="3abce-292">The ID is a number, but it references a movie that doesn't exist (for example, `http://localhost:nnnnn/EditMovie?id=100934`).</span></span>

<span data-ttu-id="3abce-293">Pokud se zajímá zobrazí chyby, které jsou výsledkem těchto adres URL, spusťte stránku *filmy* .</span><span class="sxs-lookup"><span data-stu-id="3abce-293">If you're curious to see the errors that result from these URLs, run the *Movies* page.</span></span> <span data-ttu-id="3abce-294">Vyberte film, který chcete upravit, a pak změňte adresu URL stránky *EditMovie* na adresu URL, která obsahuje abecední ID nebo ID neexistujícího filmu.</span><span class="sxs-lookup"><span data-stu-id="3abce-294">Select a movie to edit, and then change the URL of the *EditMovie* page to a URL that contains an alphabetic ID or the ID of a non-existent movie.</span></span>

<span data-ttu-id="3abce-295">Co byste měli dělat?</span><span class="sxs-lookup"><span data-stu-id="3abce-295">So what should you do?</span></span> <span data-ttu-id="3abce-296">První oprava je zajistit, aby nejenom bylo předáno ID do stránky, ale toto ID je celé číslo.</span><span class="sxs-lookup"><span data-stu-id="3abce-296">The first fix is to make sure that not only is an ID passed to the page, but that the ID is an integer.</span></span> <span data-ttu-id="3abce-297">Změňte kód pro `!IsPost` testu tak, aby vypadal jako v tomto příkladu:</span><span class="sxs-lookup"><span data-stu-id="3abce-297">Change the code for the `!IsPost` test to look like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample14.cs)]

<span data-ttu-id="3abce-298">Přidali jste do testu `IsEmpty` druhou podmínku, která je propojená s `&&` (logická a):</span><span class="sxs-lookup"><span data-stu-id="3abce-298">You've added a second condition to the `IsEmpty` test, linked with `&&` (logical AND):</span></span>

[!code-csharp[Main](updating-data/samples/sample15.cs)]

<span data-ttu-id="3abce-299">Můžete si pamatovat od kurzu [Úvod k programování webových stránek ASP.NET](../introducing-razor-syntax-c.md) , které metody jako `AsBool` `AsInt` převod řetězce znaků na jiný datový typ.</span><span class="sxs-lookup"><span data-stu-id="3abce-299">You might remember from the [Introduction to ASP.NET Web Pages Programming](../introducing-razor-syntax-c.md) tutorial that methods like `AsBool` an `AsInt` convert a character string to some other data type.</span></span> <span data-ttu-id="3abce-300">Metoda `IsInt` (a další, jako je `IsBool` a `IsDateTime`), jsou podobné.</span><span class="sxs-lookup"><span data-stu-id="3abce-300">The `IsInt` method (and others, like `IsBool` and `IsDateTime`) are similar.</span></span> <span data-ttu-id="3abce-301">Testuje však pouze to, zda *lze* řetězec převést, aniž by bylo nutné převod skutečně provést.</span><span class="sxs-lookup"><span data-stu-id="3abce-301">However, they test only whether you *can* convert the string, without actually performing the conversion.</span></span> <span data-ttu-id="3abce-302">Takže v podstatě říkáte, že *hodnota řetězce dotazu může být převedena na celé číslo...* .</span><span class="sxs-lookup"><span data-stu-id="3abce-302">So here you're essentially saying *If the query string value can be converted to an integer ...*.</span></span>

<span data-ttu-id="3abce-303">Dalším možným problémem je hledání filmu, který neexistuje.</span><span class="sxs-lookup"><span data-stu-id="3abce-303">The other potential problem is looking for a movie that doesn't exist.</span></span> <span data-ttu-id="3abce-304">Kód pro získání filmu vypadá jako tento kód:</span><span class="sxs-lookup"><span data-stu-id="3abce-304">The code to get a movie looks like this code:</span></span>

[!code-csharp[Main](updating-data/samples/sample16.cs)]

<span data-ttu-id="3abce-305">Pokud předáte `movieId` hodnotu metodě `QuerySingle`, která neodpovídá skutečnému filmu, nebude nic vráceno a příkazy, které následují (například `title=row.Title`), mají za následek chyby.</span><span class="sxs-lookup"><span data-stu-id="3abce-305">If you pass a `movieId` value to the `QuerySingle` method that doesn't correspond to an actual movie, nothing is returned and the statements that follow (for example, `title=row.Title`) result in errors.</span></span>

<span data-ttu-id="3abce-306">Teď je k dispozici Snadná oprava.</span><span class="sxs-lookup"><span data-stu-id="3abce-306">Again there's an easy fix.</span></span> <span data-ttu-id="3abce-307">Pokud metoda `db.QuerySingle` nevrátí žádné výsledky, bude mít proměnná `row` hodnotu null.</span><span class="sxs-lookup"><span data-stu-id="3abce-307">If the `db.QuerySingle` method returns no results, the `row` variable will be null.</span></span> <span data-ttu-id="3abce-308">Proto můžete před pokusem o získání hodnot z něj ověřit, zda je proměnná `row` null.</span><span class="sxs-lookup"><span data-stu-id="3abce-308">So you can check whether the `row` variable is null before you try to get values from it.</span></span> <span data-ttu-id="3abce-309">Následující kód přidá `if` blok kolem příkazů, které získávají hodnoty z objektu `row`:</span><span class="sxs-lookup"><span data-stu-id="3abce-309">The following code adds an `if` block around the statements that get the values out of the `row` object:</span></span>

[!code-csharp[Main](updating-data/samples/sample17.cs)]

<span data-ttu-id="3abce-310">U těchto dvou dalších ověřovacích ověřovacích testů se stránka bude více vykazovat jako odrážka.</span><span class="sxs-lookup"><span data-stu-id="3abce-310">With these two additional validation tests, the page becomes more bullet-proof.</span></span> <span data-ttu-id="3abce-311">Úplný kód pro `!IsPost`ovou větev teď vypadá jako v tomto příkladu:</span><span class="sxs-lookup"><span data-stu-id="3abce-311">The complete code for the `!IsPost` branch now looks like this example:</span></span>

[!code-csharp[Main](updating-data/samples/sample18.cs)]

<span data-ttu-id="3abce-312">Jednou z nich si ukážeme, že tento úkol je vhodný pro `else` blok.</span><span class="sxs-lookup"><span data-stu-id="3abce-312">We'll note once more that this task is a good use for an `else` block.</span></span> <span data-ttu-id="3abce-313">Pokud testy neprojde, `else` blokuje nastavování chybových zpráv.</span><span class="sxs-lookup"><span data-stu-id="3abce-313">If the tests don't pass, the `else` blocks set error messages.</span></span>

## <a name="adding-a-link-to-return-to-the-movies-page"></a><span data-ttu-id="3abce-314">Přidání odkazu, který se má vrátit na stránku filmů</span><span class="sxs-lookup"><span data-stu-id="3abce-314">Adding a Link to Return to the Movies Page</span></span>

<span data-ttu-id="3abce-315">Poslední a užitečnou podrobností je přidat odkaz zpátky na stránku *filmy* .</span><span class="sxs-lookup"><span data-stu-id="3abce-315">A final and helpful detail is to add a link back to the *Movies* page.</span></span> <span data-ttu-id="3abce-316">V běžném toku událostí se uživatelé spustí na stránce *filmy* a klikněte na odkaz **Upravit** .</span><span class="sxs-lookup"><span data-stu-id="3abce-316">In the ordinary flow of events, users will start at the *Movies* page and click an **Edit** link.</span></span> <span data-ttu-id="3abce-317">Tím se přidají na stránku *EditMovie* , kde můžou upravovat film a kliknout na tlačítko.</span><span class="sxs-lookup"><span data-stu-id="3abce-317">That brings them to the *EditMovie* page, where they can edit the movie and click the button.</span></span> <span data-ttu-id="3abce-318">Poté, co kód zpracuje změnu, přesměruje zpět na stránku *filmy* .</span><span class="sxs-lookup"><span data-stu-id="3abce-318">After the code processes the change, it redirects back to the *Movies* page.</span></span>

<span data-ttu-id="3abce-319">Naopak</span><span class="sxs-lookup"><span data-stu-id="3abce-319">However:</span></span>

- <span data-ttu-id="3abce-320">Uživatel se může rozhodnout neměnit cokoli.</span><span class="sxs-lookup"><span data-stu-id="3abce-320">The user might decide not to change anything.</span></span>
- <span data-ttu-id="3abce-321">Uživatel se mohl na tuto stránku setkat, aniž byste na stránce *filmy* nejdřív klikli na odkaz pro **Úpravy** .</span><span class="sxs-lookup"><span data-stu-id="3abce-321">The user might have gotten to this page without first clicking an **Edit** link in the *Movies* page.</span></span>

<span data-ttu-id="3abce-322">V obou případech chcete, aby se mohli snadno vrátit do hlavního výpisu.</span><span class="sxs-lookup"><span data-stu-id="3abce-322">Either way, you want to make it easy for them to return to the main listing.</span></span> <span data-ttu-id="3abce-323">Jedná se o snadnou opravu &mdash; přidejte následující značku hned za uzavírací značku `</form>` v kódu:</span><span class="sxs-lookup"><span data-stu-id="3abce-323">It's an easy fix &mdash; add the following markup just after the closing `</form>` tag in the markup:</span></span>

[!code-html[Main](updating-data/samples/sample19.html)]

<span data-ttu-id="3abce-324">Tento kód používá stejnou syntaxi pro `<a>` element, který jste viděli jinde.</span><span class="sxs-lookup"><span data-stu-id="3abce-324">This markup uses the same syntax for an `<a>` element that you've seen elsewhere.</span></span> <span data-ttu-id="3abce-325">Adresa URL zahrnuje `~` "kořen webu".</span><span class="sxs-lookup"><span data-stu-id="3abce-325">The URL includes `~` to mean "root of the website."</span></span>

## <a name="testing-the-movie-update-process"></a><span data-ttu-id="3abce-326">Testování procesu aktualizace filmů</span><span class="sxs-lookup"><span data-stu-id="3abce-326">Testing the Movie Update Process</span></span>

<span data-ttu-id="3abce-327">Nyní můžete provést test.</span><span class="sxs-lookup"><span data-stu-id="3abce-327">Now you can test.</span></span> <span data-ttu-id="3abce-328">Spusťte stránku *filmy* a klikněte na **Upravit** vedle videa.</span><span class="sxs-lookup"><span data-stu-id="3abce-328">Run the *Movies* page, and click **Edit** next to a movie.</span></span> <span data-ttu-id="3abce-329">Když se zobrazí stránka *EditMovie* , proveďte změny ve videu a klikněte na **Odeslat změny**.</span><span class="sxs-lookup"><span data-stu-id="3abce-329">When the *EditMovie* page appears, make changes to the movie and click **Submit Changes**.</span></span> <span data-ttu-id="3abce-330">Když se zobrazí seznam filmů, ujistěte se, že jsou zobrazené vaše změny.</span><span class="sxs-lookup"><span data-stu-id="3abce-330">When the movie listing appears, make sure that your changes are shown.</span></span>

<span data-ttu-id="3abce-331">Pokud chcete zajistit, aby ověřování fungovalo, klikněte na **Upravit** pro jiný film.</span><span class="sxs-lookup"><span data-stu-id="3abce-331">To make sure that validation is working, click **Edit** for another movie.</span></span> <span data-ttu-id="3abce-332">Až se dostanete na stránku *EditMovie* , zrušte zaškrtnutí pole **Žánr** (nebo pole **year** nebo obojí) a zkuste odeslat změny.</span><span class="sxs-lookup"><span data-stu-id="3abce-332">When you get to the *EditMovie* page, clear the **Genre** field (or **Year** field, or both) and try to submit your changes.</span></span> <span data-ttu-id="3abce-333">Zobrazí se chyba, protože byste očekávali:</span><span class="sxs-lookup"><span data-stu-id="3abce-333">You'll see an error, as you'd expect:</span></span>

![Stránka upravit film ukazující chyby ověřování](updating-data/_static/image4.png)

<span data-ttu-id="3abce-335">Kliknutím na odkaz **Přejít na seznam filmů** zrušte změny a vraťte se na stránku *filmy* .</span><span class="sxs-lookup"><span data-stu-id="3abce-335">Click the **Return to movie listing** link to abandon your changes and return to the *Movies* page.</span></span>

## <a name="coming-up-next"></a><span data-ttu-id="3abce-336">Připravujeme další</span><span class="sxs-lookup"><span data-stu-id="3abce-336">Coming Up Next</span></span>

<span data-ttu-id="3abce-337">V dalším kurzu uvidíte, jak odstranit záznam videa.</span><span class="sxs-lookup"><span data-stu-id="3abce-337">In the next tutorial, you'll see how to delete a movie record.</span></span>

## <a name="complete-listing-for-movie-page-updated-with-edit-links"></a><span data-ttu-id="3abce-338">Úplný výpis stránky videa (aktualizovaný pomocí odkazů pro úpravy)</span><span class="sxs-lookup"><span data-stu-id="3abce-338">Complete Listing for Movie Page (Updated with Edit Links)</span></span>

[!code-cshtml[Main](updating-data/samples/sample20.cshtml)]

<a id="Complete_Page_Listing_for_EditMovie"></a>
## <a name="complete-page-listing-for-edit-movie-page"></a><span data-ttu-id="3abce-339">Dokončení výpisu stránky pro stránku Upravit film</span><span class="sxs-lookup"><span data-stu-id="3abce-339">Complete Page Listing for Edit Movie Page</span></span>

[!code-cshtml[Main](updating-data/samples/sample21.cshtml)]

## <a name="additional-resources"></a><span data-ttu-id="3abce-340">Další prostředky</span><span class="sxs-lookup"><span data-stu-id="3abce-340">Additional Resources</span></span>

- [<span data-ttu-id="3abce-341">Seznámení s ASP.NET webovým programováním pomocí syntaxe Razor</span><span class="sxs-lookup"><span data-stu-id="3abce-341">Introduction to ASP.NET Web Programming by Using the Razor Syntax</span></span>](../../getting-started/introducing-razor-syntax-c.md)
- <span data-ttu-id="3abce-342">[Příkaz SQL Update](http://www.w3schools.com/sql/sql_update.asp) na webu w3schools</span><span class="sxs-lookup"><span data-stu-id="3abce-342">[SQL UPDATE Statement](http://www.w3schools.com/sql/sql_update.asp) on the W3Schools site</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="3abce-343">[Předchozí](entering-data.md)
> [Další](deleting-data.md)</span><span class="sxs-lookup"><span data-stu-id="3abce-343">[Previous](entering-data.md)
[Next](deleting-data.md)</span></span>
